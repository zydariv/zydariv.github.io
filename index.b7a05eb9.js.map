{"mappings":"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AAoBW,CAAAA,CAAElD,GAASiD,MAC5EE,OAAOC,cAAAA,CAAepD,GAASiD,GAAK;gBAAEI,YAAAA,CAAY;gBAAMC,KAAKN,CAAAA,CAAWC,EAAAA;YAAAA;QAE1E,GCNDV,EAAoBW,CAAAA,GAAI,CAACK,GAAKC,IAAUL,OAAOM,SAAAA,CAAUC,cAAAA,CAAeC,IAAAA,CAAKJ,GAAKC,ICClFjB,EAAoBqB,CAAAA,GAAK5D,CAAAA;YACH,eAAA,OAAX6D,UAA0BA,OAAOC,WAAAA,IAC1CX,OAAOC,cAAAA,CAAepD,GAAS6D,OAAOC,WAAAA,EAAa;gBAAEC,OAAO;YAAA,IAE7DZ,OAAOC,cAAAA,CAAepD,GAAS,cAAc;gBAAE+D,OAAAA,CAAO;YAAA;QAAO;Q,ICL1D0wJ,GA+DAC,G,I,C;Q,E,C,C,I,E,C,C,G;Y,S,I;Y,S,I;Y,0B,I;Y,yB,I;Y,2B,I;Y,yB,I;Y,a,I;Y,c,I;Y,a,I;Y,c,I;Y,O,I;Y,S,I;Y,U,I;Y,W,I;Y,U,I;Y,gB,I;Y,kB,I;Y,M,I;Y,M,I;Y,oB,I;Y,yB,I;Y,U,I;Y,a,I;Y,e,I;Y,e,I;Y,W,I;Y,W,I;Y,gB,I;Y,wB,I;Y,c,I;Y,kB,I;Y,S,I;Y,iB,I;Y,wB,I;Y,uB,I;Y,2B,I;Y,kB,I;Y,iB,I;Y,O,I;Y,qB,I;Y,uB,I;Y,qB,I;Y,iB,I;Y,kC,I;Y,wB,I;Y,wB,I;Y,2B,I;Y,S,I;Y,U,I;Y,e,I;Y,a,I;Y,c,I;Y,W,I;Y,oB,I;Q,IA9DJ,SAAWD,CAAAA;YACPA,EAAKE,WAAAA,GAAevnJ,CAAAA,IAAQA,GAE5BqnJ,EAAKG,QAAAA,GADL,SAAkBC,CAAAA,GAAQ,GAK1BJ,EAAKK,WAAAA,GAHL,SAAqB1mJ,CAAAA;gBACjB,MAAM,IAAItH;YACd,GAEA2tJ,EAAKM,WAAAA,GAAe3rB,CAAAA;gBAChB,MAAM7lI,IAAM,CAAC;gBACb,KAAK,MAAM1C,KAAQuoI,EACf7lI,CAAAA,CAAI1C,EAAAA,GAAQA;gBAEhB,OAAO0C;YAAG,GAEdkxJ,EAAKO,kBAAAA,GAAsBzxJ,CAAAA;gBACvB,MAAM0xJ,IAAYR,EAAKS,UAAAA,CAAW3xJ,GAAKoF,MAAAA,CAAQhH,CAAAA,IAA6B,YAAA,OAAhB4B,CAAAA,CAAIA,CAAAA,CAAI5B,EAAAA,CAAAA,GAC9DwzJ,IAAW,CAAC;gBAClB,KAAK,MAAMxzJ,KAAKszJ,EACZE,CAAAA,CAASxzJ,EAAAA,GAAK4B,CAAAA,CAAI5B,EAAAA;gBAEtB,OAAO8yJ,EAAKW,YAAAA,CAAaD;YAAS,GAEtCV,EAAKW,YAAAA,GAAgB7xJ,CAAAA,IACVkxJ,EAAKS,UAAAA,CAAW3xJ,GAAK3C,GAAAA,CAAI,SAAUqf,CAAAA;oBACtC,OAAO1c,CAAAA,CAAI0c,EACf;gBAAA,IAEJw0I,EAAKS,UAAAA,GAAoC,cAAA,OAAhB/xJ,OAAO+D,IAAAA,GACzB3D,CAAAA,IAAQJ,OAAO+D,IAAAA,CAAK3D,KACpBme,CAAAA;gBACC,MAAMxa,IAAO,EAAA;gBACb,IAAK,MAAMjE,KAAOye,EACVve,OAAOM,SAAAA,CAAUC,cAAAA,CAAeC,IAAAA,CAAK+d,GAAQze,MAC7CiE,EAAK5G,IAAAA,CAAK2C;gBAGlB,OAAOiE;YAAI,GAEnButJ,EAAK1iG,IAAAA,GAAO,CAAC4zD,GAAK0vC;gBACd,KAAK,MAAMx0J,KAAQ8kH,EACf,IAAI0vC,EAAQx0J,IACR,OAAOA;YAEC,GAEpB4zJ,EAAKa,SAAAA,GAAwC,cAAA,OAArBp2I,OAAOo2I,SAAAA,GACxBloJ,CAAAA,IAAQ8R,OAAOo2I,SAAAA,CAAUloJ,KACzBA,CAAAA,IAAuB,YAAA,OAARA,KAAoBmoJ,SAASnoJ,MAAQnH,KAAKoF,KAAAA,CAAM+B,OAASA,GAM/EqnJ,EAAKe,UAAAA,GALL,SAAoB/pJ,CAAAA,EAAOgqJ,IAAY,KAAA;gBACnC,OAAOhqJ,EACF7K,GAAAA,CAAKwM,CAAAA,IAAwB,YAAA,OAARA,IAAmB,CAAA,CAAA,EAAIA,EAAAA,CAAAA,CAAAA,GAASA,GACrDlM,IAAAA,CAAKu0J;YACd,GAEAhB,EAAKiB,qBAAAA,GAAwB,CAAC5zH,GAAG/9B,IACR,YAAA,OAAVA,IACAA,EAAMrD,QAAAA,KAEVqD;QAEd,EAAE0wJ,KAASA,CAAAA,IAAO,CAAC,CAAA,IAEpB,SAAWC,CAAAA;YACPA,EAAWiB,WAAAA,GAAc,CAACr+B,GAAOs+B,IACtB,CAAA;oBAAA,GACAt+B,CAAAA;oBAAAA,GACAs+B,CAAAA;gBAAAA,CAAAA;QAGd,EAAElB,KAAeA,CAAAA,IAAa,CAAC,CAAA;QAChC,MAAMmB,IAAgBpB,EAAKM,WAAAA,CAAY;YACnC;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SAAA,GAEEe,IAAiB1zJ,CAAAA;YAEnB,OAAA,OADiBA;gBAEb,KAAK;oBACD,OAAOyzJ,EAAcp0J,SAAAA;gBACzB,KAAK;oBACD,OAAOo0J,EAAcziJ,MAAAA;gBACzB,KAAK;oBACD,OAAO9D,MAAMlN,KAAQyzJ,EAAcE,GAAAA,GAAMF,EAAcG,MAAAA;gBAC3D,KAAK;oBACD,OAAOH,EAAcI,OAAAA;gBACzB,KAAK;oBACD,OAAOJ,EAAcK,QAAAA;gBACzB,KAAK;oBACD,OAAOL,EAAcM,MAAAA;gBACzB,KAAK;oBACD,OAAON,EAAcO,MAAAA;gBACzB,KAAK;oBACD,OAAI1rJ,MAAMoX,OAAAA,CAAQ1f,KACPyzJ,EAAcpqJ,KAAAA,GAEZ,SAATrJ,IACOyzJ,EAAcQ,IAAAA,GAErBj0J,EAAK0rB,IAAAA,IACgB,cAAA,OAAd1rB,EAAK0rB,IAAAA,IACZ1rB,EAAKk0J,KAAAA,IACiB,cAAA,OAAfl0J,EAAKk0J,KAAAA,GACLT,EAAcruJ,OAAAA,GAEN,eAAA,OAARynB,OAAuB7sB,aAAgB6sB,MACvC4mI,EAAcj1J,GAAAA,GAEN,eAAA,OAARgX,OAAuBxV,aAAgBwV,MACvCi+I,EAAclqI,GAAAA,GAEL,eAAA,OAAT/lB,QAAwBxD,aAAgBwD,OACxCiwJ,EAAcU,IAAAA,GAElBV,EAAcn0I,MAAAA;gBACzB;oBACI,OAAOm0I,EAAcjnB,OAAAA;YAAAA;QAC7B,GAGE4nB,IAAe/B,EAAKM,WAAAA,CAAY;YAClC;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SAAA;QAMJ,MAAM0B,UAAiB3vJ;YACnB,IAAA,SAAI4vJ;gBACA,OAAO/1J,IAAAA,CAAKg2J,MAChB;YAAA;YACA,YAAYA,CAAAA,CAAAA;gBACRppI,KAAAA,IACA5sB,IAAAA,CAAKg2J,MAAAA,GAAS,EAAA,EACdh2J,IAAAA,CAAKi2J,QAAAA,GAAY1lJ,CAAAA;oBACbvQ,IAAAA,CAAKg2J,MAAAA,GAAS;2BAAIh2J,IAAAA,CAAKg2J,MAAAA;wBAAQzlJ;qBAAI;gBAAA,GAEvCvQ,IAAAA,CAAKk2J,SAAAA,GAAY,CAACC,IAAO,EAAA;oBACrBn2J,IAAAA,CAAKg2J,MAAAA,GAAS;2BAAIh2J,IAAAA,CAAKg2J,MAAAA;2BAAWG;qBAAK;gBAAA;gBAE3C,MAAMC,IAAAA,WAAyBtzJ,SAAAA;gBAC3BN,OAAO6zJ,cAAAA,GAEP7zJ,OAAO6zJ,cAAAA,CAAer2J,IAAAA,EAAMo2J,KAG5Bp2J,IAAAA,CAAKs2J,SAAAA,GAAYF,GAErBp2J,IAAAA,CAAKyuB,IAAAA,GAAO,YACZzuB,IAAAA,CAAKg2J,MAAAA,GAASA;YAClB;YACA,OAAOO,CAAAA,EAAAA;gBACH,MAAMC,IAASD,KACX,SAAUE,CAAAA;oBACN,OAAOA,EAAM97I,OACjB;gBAAA,GACE+7I,IAAc;oBAAEC,SAAS,EAAA;gBAAA,GACzBC,IAAgB3vJ,CAAAA;oBAClB,KAAK,MAAMwvJ,KAASxvJ,EAAM+uJ,MAAAA,CACtB,IAAmB,oBAAfS,EAAM1vC,IAAAA,EACN0vC,EAAMI,WAAAA,CAAY52J,GAAAA,CAAI22J;yBAErB,IAAmB,0BAAfH,EAAM1vC,IAAAA,EACX6vC,EAAaH,EAAMK,eAAAA;yBAElB,IAAmB,wBAAfL,EAAM1vC,IAAAA,EACX6vC,EAAaH,EAAMM,cAAAA;yBAElB,IAA0B,MAAtBN,EAAMhtI,IAAAA,CAAKnpB,MAAAA,EAChBo2J,EAAYC,OAAAA,CAAQh3J,IAAAA,CAAK62J,EAAOC;yBAE/B;wBACD,IAAI5uG,IAAO6uG,GACPl2J,IAAI;wBACR,MAAOA,IAAIi2J,EAAMhtI,IAAAA,CAAKnpB,MAAAA,EAAQ;4BAC1B,MAAM0f,IAAKy2I,EAAMhtI,IAAAA,CAAKjpB,EAAAA;4BACLA,MAAMi2J,EAAMhtI,IAAAA,CAAKnpB,MAAAA,GAAS,IAYvCunD,CAAAA,CAAAA,CAAK7nC,EAAAA,GAAM6nC,CAAAA,CAAK7nC,EAAAA,IAAO;gCAAE22I,SAAS,EAAA;4BAAA,GAClC9uG,CAAAA,CAAK7nC,EAAAA,CAAI22I,OAAAA,CAAQh3J,IAAAA,CAAK62J,EAAOC,GAAAA,IAX7B5uG,CAAAA,CAAK7nC,EAAAA,GAAM6nC,CAAAA,CAAK7nC,EAAAA,IAAO;gCAAE22I,SAAS,EAAA;4BAAA,GAatC9uG,IAAOA,CAAAA,CAAK7nC,EAAAA,EACZxf;wBACJ;oBACJ;gBACJ;gBAGJ,OADAo2J,EAAa52J,IAAAA,GACN02J;YACX;YACA,OAAA,OAActzJ,CAAAA,EAAAA;gBACV,IAAA,CAAMA,CAAAA,aAAiB0yJ,CAAAA,GACnB,MAAM,IAAI3vJ,MAAM,CAAA,gBAAA,EAAmB/C,GAAAA;YAE3C;YACA,WAAArD;gBACI,OAAOC,IAAAA,CAAK2a,OAChB;YAAA;YACA,IAAA,UAAIA;gBACA,OAAOpZ,KAAKC,SAAAA,CAAUxB,IAAAA,CAAKg2J,MAAAA,EAAQlC,EAAKiB,qBAAAA,EAAuB;YACnE;YACA,IAAA,UAAIiC;gBACA,OAA8B,MAAvBh3J,IAAAA,CAAKg2J,MAAAA,CAAO11J,MACvB;YAAA;YACA,QAAQk2J,IAAUC,CAAAA,IAAUA,EAAM97I,OAAAA,AAAAA,EAAAA;gBAC9B,MAAM+7I,IAAc,CAAC,GACfQ,IAAa,EAAA;gBACnB,KAAK,MAAM3mJ,KAAOvQ,IAAAA,CAAKg2J,MAAAA,CACfzlJ,EAAIkZ,IAAAA,CAAKnpB,MAAAA,GAAS,IAClBo2J,CAAAA,CAAAA,CAAYnmJ,EAAIkZ,IAAAA,CAAK,EAAA,CAAA,GAAMitI,CAAAA,CAAYnmJ,EAAIkZ,IAAAA,CAAK,EAAA,CAAA,IAAO,EAAA,EACvDitI,CAAAA,CAAYnmJ,EAAIkZ,IAAAA,CAAK,EAAA,CAAA,CAAI9pB,IAAAA,CAAK62J,EAAOjmJ,GAAAA,IAGrC2mJ,EAAWv3J,IAAAA,CAAK62J,EAAOjmJ;gBAG/B,OAAO;oBAAE2mJ,YAAAA;oBAAYR,aAAAA;gBAAAA;YACzB;YACA,IAAA,aAAIQ;gBACA,OAAOl3J,IAAAA,CAAKi3J,OAAAA;YAChB;QAAA;QAEJnB,EAASl6F,MAAAA,GAAUo6F,CAAAA,IACD,IAAIF,EAASE;QAI/B,MAAMmB,IAAW,CAACV,GAAOh9I;YACrB,IAAIkB;YACJ,OAAQ87I,EAAM1vC,IAAAA;gBACV,KAAK8uC,EAAauB,YAAAA;oBAEVz8I,IADA87I,EAAMY,QAAAA,KAAanC,EAAcp0J,SAAAA,GACvB,aAGA,CAAA,SAAA,EAAY21J,EAAMa,QAAAA,CAAAA,WAAAA,EAAsBb,EAAMY,QAAAA,EAAAA;oBAE5D;gBACJ,KAAKxB,EAAa0B,eAAAA;oBACd58I,IAAU,CAAA,gCAAA,EAAmCpZ,KAAKC,SAAAA,CAAUi1J,EAAMa,QAAAA,EAAUxD,EAAKiB,qBAAAA,GAAAA;oBACjF;gBACJ,KAAKc,EAAa2B,iBAAAA;oBACd78I,IAAU,CAAA,+BAAA,EAAkCm5I,EAAKe,UAAAA,CAAW4B,EAAMlwJ,IAAAA,EAAM,OAAA;oBACxE;gBACJ,KAAKsvJ,EAAa4B,aAAAA;oBACd98I,IAAU;oBACV;gBACJ,KAAKk7I,EAAa6B,2BAAAA;oBACd/8I,IAAU,CAAA,sCAAA,EAAyCm5I,EAAKe,UAAAA,CAAW4B,EAAMx9I,OAAAA,GAAAA;oBACzE;gBACJ,KAAK48I,EAAa8B,kBAAAA;oBACdh9I,IAAU,CAAA,6BAAA,EAAgCm5I,EAAKe,UAAAA,CAAW4B,EAAMx9I,OAAAA,EAAAA,YAAAA,EAAuBw9I,EAAMY,QAAAA,CAAAA,CAAAA,CAAAA;oBAC7F;gBACJ,KAAKxB,EAAa+B,iBAAAA;oBACdj9I,IAAU;oBACV;gBACJ,KAAKk7I,EAAagC,mBAAAA;oBACdl9I,IAAU;oBACV;gBACJ,KAAKk7I,EAAaiC,YAAAA;oBACdn9I,IAAU;oBACV;gBACJ,KAAKk7I,EAAakC,cAAAA;oBACkB,YAAA,OAArBtB,EAAMuB,UAAAA,GACT,cAAcvB,EAAMuB,UAAAA,GACpBr9I,CAAAA,IAAU,CAAA,6BAAA,EAAgC87I,EAAMuB,UAAAA,CAAW/2I,QAAAA,CAAAA,CAAAA,CAAAA,EAClB,YAAA,OAA9Bw1I,EAAMuB,UAAAA,CAAWp+I,QAAAA,IACxBe,CAAAA,IAAU,GAAGA,EAAAA,mDAAAA,EAA6D87I,EAAMuB,UAAAA,CAAWp+I,QAAAA,EAAAA,AAAAA,CAAAA,IAG1F,gBAAgB68I,EAAMuB,UAAAA,GAC3Br9I,IAAU,CAAA,gCAAA,EAAmC87I,EAAMuB,UAAAA,CAAWC,UAAAA,CAAAA,CAAAA,CAAAA,GAEzD,cAAcxB,EAAMuB,UAAAA,GACzBr9I,IAAU,CAAA,8BAAA,EAAiC87I,EAAMuB,UAAAA,CAAW9lI,QAAAA,CAAAA,CAAAA,CAAAA,GAG5D4hI,EAAKK,WAAAA,CAAYsC,EAAMuB,UAAAA,IAI3Br9I,IAD0B,YAArB87I,EAAMuB,UAAAA,GACD,CAAA,QAAA,EAAWvB,EAAMuB,UAAAA,EAAAA,GAGjB;oBAEd;gBACJ,KAAKnC,EAAaqC,SAAAA;oBAEVv9I,IADe,YAAf87I,EAAMhwJ,IAAAA,GACI,CAAA,mBAAA,EAAsBgwJ,EAAM0B,KAAAA,GAAQ,YAAY1B,EAAM2B,SAAAA,GAAY,aAAa,YAAA,CAAA,EAAe3B,EAAM4B,OAAAA,CAAAA,WAAAA,CAAAA,GAC1F,aAAf5B,EAAMhwJ,IAAAA,GACD,CAAA,oBAAA,EAAuBgwJ,EAAM0B,KAAAA,GAAQ,YAAY1B,EAAM2B,SAAAA,GAAY,aAAa,OAAA,CAAA,EAAU3B,EAAM4B,OAAAA,CAAAA,aAAAA,CAAAA,GACtF,aAAf5B,EAAMhwJ,IAAAA,GACD,CAAA,eAAA,EAAkBgwJ,EAAM0B,KAAAA,GAC5B,sBACA1B,EAAM2B,SAAAA,GACF,8BACA,kBAAkB3B,EAAM4B,OAAAA,EAAAA,GACd,WAAf5B,EAAMhwJ,IAAAA,GACD,CAAA,aAAA,EAAgBgwJ,EAAM0B,KAAAA,GAC1B,sBACA1B,EAAM2B,SAAAA,GACF,8BACA,kBAAkB,IAAInzJ,KAAKsZ,OAAOk4I,EAAM4B,OAAAA,IAAAA,GAExC;oBACd;gBACJ,KAAKxC,EAAayC,OAAAA;oBAEV39I,IADe,YAAf87I,EAAMhwJ,IAAAA,GACI,CAAA,mBAAA,EAAsBgwJ,EAAM0B,KAAAA,GAAQ,YAAY1B,EAAM2B,SAAAA,GAAY,YAAY,YAAA,CAAA,EAAe3B,EAAM8B,OAAAA,CAAAA,WAAAA,CAAAA,GACzF,aAAf9B,EAAMhwJ,IAAAA,GACD,CAAA,oBAAA,EAAuBgwJ,EAAM0B,KAAAA,GAAQ,YAAY1B,EAAM2B,SAAAA,GAAY,YAAY,QAAA,CAAA,EAAW3B,EAAM8B,OAAAA,CAAAA,aAAAA,CAAAA,GACtF,aAAf9B,EAAMhwJ,IAAAA,GACD,CAAA,eAAA,EAAkBgwJ,EAAM0B,KAAAA,GAC5B,YACA1B,EAAM2B,SAAAA,GACF,0BACA,YAAA,CAAA,EAAe3B,EAAM8B,OAAAA,EAAAA,GACX,aAAf9B,EAAMhwJ,IAAAA,GACD,CAAA,eAAA,EAAkBgwJ,EAAM0B,KAAAA,GAC5B,YACA1B,EAAM2B,SAAAA,GACF,0BACA,YAAA,CAAA,EAAe3B,EAAM8B,OAAAA,EAAAA,GACX,WAAf9B,EAAMhwJ,IAAAA,GACD,CAAA,aAAA,EAAgBgwJ,EAAM0B,KAAAA,GAC1B,YACA1B,EAAM2B,SAAAA,GACF,6BACA,eAAA,CAAA,EAAkB,IAAInzJ,KAAKsZ,OAAOk4I,EAAM8B,OAAAA,IAAAA,GAExC;oBACd;gBACJ,KAAK1C,EAAa2C,MAAAA;oBACd79I,IAAU;oBACV;gBACJ,KAAKk7I,EAAa4C,0BAAAA;oBACd99I,IAAU;oBACV;gBACJ,KAAKk7I,EAAa6C,eAAAA;oBACd/9I,IAAU,CAAA,6BAAA,EAAgC87I,EAAMkC,UAAAA,EAAAA;oBAChD;gBACJ,KAAK9C,EAAa+C,UAAAA;oBACdj+I,IAAU;oBACV;gBACJ;oBACIA,IAAUlB,EAAKo/I,YAAAA,EACf/E,EAAKK,WAAAA,CAAYsC;YAAAA;YAEzB,OAAO;gBAAE97I,SAAAA;YAAAA;QAAS;QAGtB,IAAIm+I,IAAmB3B;QAIvB,SAAS4B;YACL,OAAOD;QACX;QAEA,MAAME,IAAaC,CAAAA;YACf,MAAA,EAAM,MAAEx3J,CAAAA,EAAI,MAAEgoB,CAAAA,EAAI,WAAEyvI,CAAAA,EAAS,WAAEC,CAAAA,EAAAA,GAAcF,GACvCG,IAAW;mBAAI3vI;mBAAU0vI,EAAU1vI,IAAAA,IAAQ,EAAA;aAAA,EAC3C4vI,IAAY;gBAAA,GACXF,CAAAA;gBACH1vI,MAAM2vI;YAAAA;YAEV,IAAA,KAA0Bt4J,MAAtBq4J,EAAUx+I,OAAAA,EACV,OAAO;gBAAA,GACAw+I,CAAAA;gBACH1vI,MAAM2vI;gBACNz+I,SAASw+I,EAAUx+I,OAAAA;YAAAA;YAG3B,IAAI2+I,IAAe;YACnB,MAAMC,IAAOL,EACRlxJ,MAAAA,CAAQge,CAAAA,IAAAA,CAAAA,CAAQA,GAChBza,KAAAA,GACAwpC,OAAAA;YACL,KAAK,MAAM90C,KAAOs5J,EACdD,IAAer5J,EAAIo5J,GAAW;gBAAE53J,MAAAA;gBAAMo3J,cAAcS;YAAAA,GAAgB3+I,OAAAA;YAExE,OAAO;gBAAA,GACAw+I,CAAAA;gBACH1vI,MAAM2vI;gBACNz+I,SAAS2+I;YAAAA;QACZ;QAGL,SAASE,EAAkBpiI,CAAAA,EAAK+hI,CAAAA;YAC5B,MAAMM,IAAcV,KACdtC,IAAQuC,EAAU;gBACpBG,WAAWA;gBACX13J,MAAM21B,EAAI31B,IAAAA;gBACVgoB,MAAM2N,EAAI3N,IAAAA;gBACVyvI,WAAW;oBACP9hI,EAAIsiI,MAAAA,CAAOC,kBAAAA;oBACXviI,EAAIwiI,cAAAA;oBACJH;oBACAA,MAAgBtC,IAAAA,KAAWr2J,IAAYq2J;iBAAAA,CACzCnvJ,MAAAA,CAAQsE,CAAAA,IAAAA,CAAAA,CAAQA;YAAAA;YAEtB8qB,EAAIsiI,MAAAA,CAAO1D,MAAAA,CAAOr2J,IAAAA,CAAK82J;QAC3B;QACA,MAAMoD;YACF,aAAAlzJ;gBACI3G,IAAAA,CAAKoD,KAAAA,GAAQ;YACjB;YACA,QAAAo1C;gBACuB,YAAfx4C,IAAAA,CAAKoD,KAAAA,IACLpD,CAAAA,IAAAA,CAAKoD,KAAAA,GAAQ,OAAA;YACrB;YACA,QAAA02J;gBACuB,cAAf95J,IAAAA,CAAKoD,KAAAA,IACLpD,CAAAA,IAAAA,CAAKoD,KAAAA,GAAQ,SAAA;YACrB;YACA,OAAA,WAAkBknB,CAAAA,EAAQuJ,CAAAA,EAAAA;gBACtB,MAAMmmI,IAAa,EAAA;gBACnB,KAAK,MAAMhwJ,KAAK6pB,EAAS;oBACrB,IAAiB,cAAb7pB,EAAEsgB,MAAAA,EACF,OAAO2vI;oBACM,YAAbjwJ,EAAEsgB,MAAAA,IACFA,EAAOkuB,KAAAA,IACXwhH,EAAWr6J,IAAAA,CAAKqK,EAAE5G,KAAAA;gBACtB;gBACA,OAAO;oBAAEknB,QAAQA,EAAOlnB,KAAAA;oBAAOA,OAAO42J;gBAAAA;YAC1C;YACA,aAAA,iBAA8B1vI,CAAAA,EAAQmnD,CAAAA,EAAAA;gBAClC,MAAM0oF,IAAY,EAAA;gBAClB,KAAK,MAAM5oF,KAAQE,EAAO;oBACtB,MAAMnvE,IAAAA,MAAYivE,EAAKjvE,GAAAA,EACjBc,IAAAA,MAAcmuE,EAAKnuE,KAAAA;oBACzB+2J,EAAUx6J,IAAAA,CAAK;wBACX2C,KAAAA;wBACAc,OAAAA;oBAAAA;gBAER;gBACA,OAAOy2J,EAAYO,eAAAA,CAAgB9vI,GAAQ6vI;YAC/C;YACA,OAAA,gBAAuB7vI,CAAAA,EAAQmnD,CAAAA,EAAAA;gBAC3B,MAAM4oF,IAAc,CAAC;gBACrB,KAAK,MAAM9oF,KAAQE,EAAO;oBACtB,MAAA,EAAM,KAAEnvE,CAAAA,EAAG,OAAEc,CAAAA,EAAAA,GAAUmuE;oBACvB,IAAmB,cAAfjvE,EAAIgoB,MAAAA,EACJ,OAAO2vI;oBACX,IAAqB,cAAjB72J,EAAMknB,MAAAA,EACN,OAAO2vI;oBACQ,YAAf33J,EAAIgoB,MAAAA,IACJA,EAAOkuB,KAAAA,IACU,YAAjBp1C,EAAMknB,MAAAA,IACNA,EAAOkuB,KAAAA,IACO,gBAAdl2C,EAAIc,KAAAA,IAAAA,KACoB,MAAhBA,EAAMA,KAAAA,IAAAA,CAAyBmuE,EAAK+oF,SAAAA,IAC5CD,CAAAA,CAAAA,CAAY/3J,EAAIc,KAAAA,CAAAA,GAASA,EAAMA,KAAAA,AAAAA;gBAEvC;gBACA,OAAO;oBAAEknB,QAAQA,EAAOlnB,KAAAA;oBAAOA,OAAOi3J;gBAAAA;YAC1C;QAAA;QAEJ,MAAMJ,IAAUz3J,OAAOsD,MAAAA,CAAO;YAC1BwkB,QAAQ;QAAA,IAENiwI,IAASn3J,CAAAA,IAAU,CAAA;gBAAGknB,QAAQ;gBAASlnB,OAAAA;YAAAA,CAAAA,GACvCo3J,IAAMp3J,CAAAA,IAAU,CAAA;gBAAGknB,QAAQ;gBAASlnB,OAAAA;YAAAA,CAAAA,GACpCq3J,IAAanuJ,CAAAA,IAAmB,cAAbA,EAAEge,MAAAA,EACrBowI,IAAWpuJ,CAAAA,IAAmB,YAAbA,EAAEge,MAAAA,EACnB7b,IAAWnC,CAAAA,IAAmB,YAAbA,EAAEge,MAAAA,EACnBqwI,IAAWruJ,CAAAA,IAAyB,eAAA,OAAZ/H,WAA2B+H,aAAa/H;QAiBtE,SAASq2J,EAAuBt3D,CAAAA,EAAU52D,CAAAA,EAAOmuH,CAAAA,EAAM5lH,CAAAA;YACnD,IAAa,QAAT4lH,KAAAA,CAAiB5lH,GAAG,MAAM,IAAIwpG,UAAU;YAC5C,IAAqB,cAAA,OAAV/xG,IAAuB42D,MAAa52D,KAAAA,CAAUuI,IAAAA,CAAKvI,EAAM30B,GAAAA,CAAIurF,IAAW,MAAM,IAAIm7C,UAAU;YACvG,OAAgB,QAAToc,IAAe5lH,IAAa,QAAT4lH,IAAe5lH,EAAEjyC,IAAAA,CAAKsgG,KAAYruD,IAAIA,EAAE7xC,KAAAA,GAAQspC,EAAM/pC,GAAAA,CAAI2gG;QACxF;QAEA,SAASw3D,EAAuBx3D,CAAAA,EAAU52D,CAAAA,EAAOtpC,CAAAA,EAAOy3J,CAAAA,EAAM5lH,CAAAA;YAC1D,IAAa,QAAT4lH,GAAc,MAAM,IAAIpc,UAAU;YACtC,IAAa,QAAToc,KAAAA,CAAiB5lH,GAAG,MAAM,IAAIwpG,UAAU;YAC5C,IAAqB,cAAA,OAAV/xG,IAAuB42D,MAAa52D,KAAAA,CAAUuI,IAAAA,CAAKvI,EAAM30B,GAAAA,CAAIurF,IAAW,MAAM,IAAIm7C,UAAU;YACvG,OAAiB,QAAToc,IAAe5lH,EAAEjyC,IAAAA,CAAKsgG,GAAUlgG,KAAS6xC,IAAIA,EAAE7xC,KAAAA,GAAQA,IAAQspC,EAAM1hB,GAAAA,CAAIs4E,GAAUlgG,IAASA;QACxG;QAOA,IAAI23J,GAMAC,GAAgBC;QAXO,cAAA,OAApBC,mBAAiCA,iBAMxC,SAAWH,CAAAA;YACPA,EAAUI,QAAAA,GAAYxgJ,CAAAA,IAA+B,YAAA,OAAZA,IAAuB;oBAAEA,SAAAA;gBAAAA,IAAYA,KAAW,CAAC,GAC1FogJ,EAAUh7J,QAAAA,GAAY4a,CAAAA,IAA+B,YAAA,OAAZA,IAAuBA,IAAUA,QAAAA,IAAAA,KAAyC,IAASA,EAAQA,OACvI;QAAA,EAAEogJ,KAAcA,CAAAA,IAAY,CAAC,CAAA;QAG9B,MAAMK;YACF,YAAYlrH,CAAAA,EAAQ9sC,CAAAA,EAAOqmB,CAAAA,EAAMnnB,CAAAA,CAAAA;gBAC7BtC,IAAAA,CAAKq7J,WAAAA,GAAc,EAAA,EACnBr7J,IAAAA,CAAKkwC,MAAAA,GAASA,GACdlwC,IAAAA,CAAKyB,IAAAA,GAAO2B,GACZpD,IAAAA,CAAK2gE,KAAAA,GAAQl3C,GACbzpB,IAAAA,CAAKs7J,IAAAA,GAAOh5J;YAChB;YACA,IAAA,OAAImnB;gBASA,OARKzpB,IAAAA,CAAKq7J,WAAAA,CAAY/6J,MAAAA,IACdN,CAAAA,IAAAA,CAAKs7J,IAAAA,YAAgBvxJ,QACrB/J,IAAAA,CAAKq7J,WAAAA,CAAY17J,IAAAA,IAAQK,IAAAA,CAAK2gE,KAAAA,KAAU3gE,IAAAA,CAAKs7J,IAAAA,IAG7Ct7J,IAAAA,CAAKq7J,WAAAA,CAAY17J,IAAAA,IAAQK,IAAAA,CAAK2gE,KAAAA,EAAO3gE,IAAAA,CAAKs7J,IAAAA,CAAAA,GAG3Ct7J,IAAAA,CAAKq7J,WAChB;YAAA;QAAA;QAEJ,MAAME,IAAe,CAACnkI,GAAKhsB;YACvB,IAAIqD,EAAQrD,IACR,OAAO;gBAAEowJ,SAAAA,CAAS;gBAAM/5J,MAAM2J,EAAOhI,KAAAA;YAAAA;YAGrC,IAAA,CAAKg0B,EAAIsiI,MAAAA,CAAO1D,MAAAA,CAAO11J,MAAAA,EACnB,MAAM,IAAI6F,MAAM;YAEpB,OAAO;gBACHq1J,SAAAA,CAAS;gBACT,IAAA,SAAIv0J;oBACA,IAAIjH,IAAAA,CAAKy7J,MAAAA,EACL,OAAOz7J,IAAAA,CAAKy7J,MAAAA;oBAChB,MAAMx0J,IAAQ,IAAI6uJ,EAAS1+H,EAAIsiI,MAAAA,CAAO1D,MAAAA;oBAEtC,OADAh2J,IAAAA,CAAKy7J,MAAAA,GAASx0J,GACPjH,IAAAA,CAAKy7J,MAChB;gBAAA;YAAA;QAER;QAEJ,SAASC,EAAoBzC,CAAAA;YACzB,IAAA,CAAKA,GACD,OAAO,CAAC;YACZ,MAAA,EAAM,UAAE9B,CAAAA,EAAQ,oBAAEwE,CAAAA,EAAkB,gBAAEC,CAAAA,EAAc,aAAEC,CAAAA,EAAAA,GAAgB5C;YACtE,IAAI9B,KAAawE,CAAAA,KAAsBC,CAAAA,GACnC,MAAM,IAAIz1J,MAAM;YAEpB,IAAIgxJ,GACA,OAAO;gBAAEA,UAAUA;gBAAU0E,aAAAA;YAAAA;YAcjC,OAAO;gBAAE1E,UAbS,CAAC2E,GAAK1kI;oBACpB,IAAI9tB,GAAIG;oBACR,MAAA,EAAM,SAAEkR,CAAAA,EAAAA,GAAYs+I;oBACpB,OAAiB,yBAAb6C,EAAI/0C,IAAAA,GACG;wBAAEpsG,SAASA,QAAAA,IAAyCA,IAAUyc,EAAIyhI,YAAAA;oBAAAA,IAAAA,KAErD,MAAbzhI,EAAI31B,IAAAA,GACJ;wBAAEkZ,SAAsF,SAA5ErR,CAAAA,IAAKqR,QAAAA,IAAyCA,IAAUihJ,CAAAA,KAAAA,KAAmC,MAAPtyJ,IAAgBA,IAAK8tB,EAAIyhI,YAAAA;oBAAAA,IAEnH,mBAAbiD,EAAI/0C,IAAAA,GACG;wBAAEpsG,SAASyc,EAAIyhI,YAAAA;oBAAAA,IACnB;wBAAEl+I,SAA0F,SAAhFlR,CAAAA,IAAKkR,QAAAA,IAAyCA,IAAUghJ,CAAAA,KAAAA,KAAuC,MAAPlyJ,IAAgBA,IAAK2tB,EAAIyhI,YAAAA;oBAAAA;gBAAc;gBAExHgD,aAAAA;YAAAA;QAClC;QACA,MAAME;YACF,IAAA,cAAIF;gBACA,OAAO77J,IAAAA,CAAKg8J,IAAAA,CAAKH,WACrB;YAAA;YACA,SAAS37C,CAAAA,EAAAA;gBACL,OAAOi1C,EAAcj1C,EAAMz+G,IAAAA;YAC/B;YACA,gBAAgBy+G,CAAAA,EAAO9oF,CAAAA,EAAAA;gBACnB,OAAQA,KAAO;oBACXsiI,QAAQx5C,EAAMhwE,MAAAA,CAAOwpH,MAAAA;oBACrBj4J,MAAMy+G,EAAMz+G,IAAAA;oBACZ06J,YAAYhH,EAAcj1C,EAAMz+G,IAAAA;oBAChCm4J,gBAAgB55J,IAAAA,CAAKg8J,IAAAA,CAAK7E,QAAAA;oBAC1B1tI,MAAMy2F,EAAMz2F,IAAAA;oBACZymB,QAAQgwE,EAAMhwE,MAAAA;gBAAAA;YAEtB;YACA,oBAAoBgwE,CAAAA,EAAAA;gBAChB,OAAO;oBACH51F,QAAQ,IAAIuvI;oBACZziI,KAAK;wBACDsiI,QAAQx5C,EAAMhwE,MAAAA,CAAOwpH,MAAAA;wBACrBj4J,MAAMy+G,EAAMz+G,IAAAA;wBACZ06J,YAAYhH,EAAcj1C,EAAMz+G,IAAAA;wBAChCm4J,gBAAgB55J,IAAAA,CAAKg8J,IAAAA,CAAK7E,QAAAA;wBAC1B1tI,MAAMy2F,EAAMz2F,IAAAA;wBACZymB,QAAQgwE,EAAMhwE,MAAAA;oBAAAA;gBAAAA;YAG1B;YACA,WAAWgwE,CAAAA,EAAAA;gBACP,MAAM90G,IAASpL,IAAAA,CAAKs8J,MAAAA,CAAOp8C;gBAC3B,IAAIy6C,EAAQvvJ,IACR,MAAM,IAAIjF,MAAM;gBAEpB,OAAOiF;YACX;YACA,YAAY80G,CAAAA,EAAAA;gBACR,MAAM90G,IAASpL,IAAAA,CAAKs8J,MAAAA,CAAOp8C;gBAC3B,OAAO37G,QAAQC,OAAAA,CAAQ4G;YAC3B;YACA,MAAM3J,CAAAA,EAAMw3J,CAAAA,EAAAA;gBACR,MAAM7tJ,IAASpL,IAAAA,CAAKw8J,SAAAA,CAAU/6J,GAAMw3J;gBACpC,IAAI7tJ,EAAOowJ,OAAAA,EACP,OAAOpwJ,EAAO3J,IAAAA;gBAClB,MAAM2J,EAAOnE,KACjB;YAAA;YACA,UAAUxF,CAAAA,EAAMw3J,CAAAA,EAAAA;gBACZ,IAAI3vJ;gBACJ,MAAM8tB,IAAM;oBACRsiI,QAAQ;wBACJ1D,QAAQ,EAAA;wBACRhxF,OAA+E,SAAvE17D,CAAAA,IAAK2vJ,QAAAA,IAAAA,KAAuC,IAASA,EAAOj0F,KAAAA,AAAAA,KAAAA,KAA0B,MAAP17D,KAAgBA;wBACvGqwJ,oBAAoBV,QAAAA,IAAAA,KAAuC,IAASA,EAAO9B,QAAAA;oBAAAA;oBAE/E1tI,MAAAA,AAAOwvI,CAAAA,QAAAA,IAAAA,KAAuC,IAASA,EAAOxvI,IAAAA,AAAAA,KAAS,EAAA;oBACvEmwI,gBAAgB55J,IAAAA,CAAKg8J,IAAAA,CAAK7E,QAAAA;oBAC1BjnH,QAAQ;oBACRzuC,MAAAA;oBACA06J,YAAYhH,EAAc1zJ;gBAAAA,GAExB2J,IAASpL,IAAAA,CAAKq8J,UAAAA,CAAW;oBAAE56J,MAAAA;oBAAMgoB,MAAM2N,EAAI3N,IAAAA;oBAAMymB,QAAQ9Y;gBAAAA;gBAC/D,OAAOmkI,EAAankI,GAAKhsB;YAC7B;YACA,YAAY3J,CAAAA,EAAAA;gBACR,IAAI6H,GAAIG;gBACR,MAAM2tB,IAAM;oBACRsiI,QAAQ;wBACJ1D,QAAQ,EAAA;wBACRhxF,OAAAA,CAAAA,CAAShlE,IAAAA,CAAK,YAAA,CAAaglE,KAAAA;oBAAAA;oBAE/Bv7C,MAAM,EAAA;oBACNmwI,gBAAgB55J,IAAAA,CAAKg8J,IAAAA,CAAK7E,QAAAA;oBAC1BjnH,QAAQ;oBACRzuC,MAAAA;oBACA06J,YAAYhH,EAAc1zJ;gBAAAA;gBAE9B,IAAA,CAAKzB,IAAAA,CAAK,YAAA,CAAaglE,KAAAA,EACnB,IAAA;oBACI,MAAM55D,IAASpL,IAAAA,CAAKq8J,UAAAA,CAAW;wBAAE56J,MAAAA;wBAAMgoB,MAAM,EAAA;wBAAIymB,QAAQ9Y;oBAAAA;oBACzD,OAAO3oB,EAAQrD,KACT;wBACEhI,OAAOgI,EAAOhI,KAAAA;oBAAAA,IAEhB;wBACE4yJ,QAAQ5+H,EAAIsiI,MAAAA,CAAO1D,MAAAA;oBAAAA;gBAE/B,EACA,OAAO3a,GAAAA;oBAC+H,CAAA,SAA7H5xI,CAAAA,IAAsE,SAAhEH,CAAAA,IAAK+xI,QAAAA,IAAAA,KAAiC,IAASA,EAAI1gI,OAAAA,AAAAA,KAAAA,KAA4B,MAAPrR,IAAAA,KAAgB,IAASA,EAAGmzJ,WAAAA,EAAAA,KAAAA,KAAkC,MAAPhzJ,IAAAA,KAAgB,IAASA,EAAGwX,QAAAA,CAAS,cAAA,KAC3KjhB,CAAAA,IAAAA,CAAK,YAAA,CAAaglE,KAAAA,GAAAA,CAAQ,CAAA,GAE9B5tC,EAAIsiI,MAAAA,GAAS;wBACT1D,QAAQ,EAAA;wBACRhxF,OAAAA,CAAO;oBAAA;gBAEf;gBAEJ,OAAOhlE,IAAAA,CAAKu8J,WAAAA,CAAY;oBAAE96J,MAAAA;oBAAMgoB,MAAM,EAAA;oBAAIymB,QAAQ9Y;gBAAAA,GAAOjK,IAAAA,CAAM/hB,CAAAA,IAAWqD,EAAQrD,KAC5E;wBACEhI,OAAOgI,EAAOhI,KAAAA;oBAAAA,IAEhB;wBACE4yJ,QAAQ5+H,EAAIsiI,MAAAA,CAAO1D,MAAAA;oBAAAA;YAE/B;YACA,MAAA,WAAiBv0J,CAAAA,EAAMw3J,CAAAA,EAAAA;gBACnB,MAAM7tJ,IAAAA,MAAepL,IAAAA,CAAK28J,cAAAA,CAAel7J,GAAMw3J;gBAC/C,IAAI7tJ,EAAOowJ,OAAAA,EACP,OAAOpwJ,EAAO3J,IAAAA;gBAClB,MAAM2J,EAAOnE,KACjB;YAAA;YACA,MAAA,eAAqBxF,CAAAA,EAAMw3J,CAAAA,EAAAA;gBACvB,MAAM7hI,IAAM;oBACRsiI,QAAQ;wBACJ1D,QAAQ,EAAA;wBACR2D,oBAAoBV,QAAAA,IAAAA,KAAuC,IAASA,EAAO9B,QAAAA;wBAC3EnyF,OAAAA,CAAO;oBAAA;oBAEXv7C,MAAAA,AAAOwvI,CAAAA,QAAAA,IAAAA,KAAuC,IAASA,EAAOxvI,IAAAA,AAAAA,KAAS,EAAA;oBACvEmwI,gBAAgB55J,IAAAA,CAAKg8J,IAAAA,CAAK7E,QAAAA;oBAC1BjnH,QAAQ;oBACRzuC,MAAAA;oBACA06J,YAAYhH,EAAc1zJ;gBAAAA,GAExBm7J,IAAmB58J,IAAAA,CAAKs8J,MAAAA,CAAO;oBAAE76J,MAAAA;oBAAMgoB,MAAM2N,EAAI3N,IAAAA;oBAAMymB,QAAQ9Y;gBAAAA,IAC/DhsB,IAAAA,MAAgBuvJ,CAAAA,EAAQiC,KACxBA,IACAr4J,QAAQC,OAAAA,CAAQo4J,EAAAA;gBACtB,OAAOrB,EAAankI,GAAKhsB;YAC7B;YACA,OAAOsgJ,CAAAA,EAAO/wI,CAAAA,EAAAA;gBACV,MAAMmiJ,IAAsBrwJ,CAAAA,IACD,YAAA,OAAZkO,KAAAA,KAA2C,MAAZA,IAC/B;wBAAEA,SAAAA;oBAAAA,IAEe,cAAA,OAAZA,IACLA,EAAQlO,KAGRkO;gBAGf,OAAO3a,IAAAA,CAAK+8J,WAAAA,CAAY,CAACtwJ,GAAK2qB;oBAC1B,MAAMhsB,IAASsgJ,EAAMj/I,IACfuwJ,IAAW,IAAM5lI,EAAI6+H,QAAAA,CAAS;4BAChClvC,MAAM8uC,EAAa2C,MAAAA;4BAAAA,GAChBsE,EAAmBrwJ,EAAAA;wBAAAA;oBAE1B,OAAuB,eAAA,OAAZlI,WAA2B6G,aAAkB7G,UAC7C6G,EAAO+hB,IAAAA,CAAM1rB,CAAAA,IAAAA,CAAAA,CACXA,KACDu7J,CAAAA,KAAAA,CACO,CAAA,KAAA,CAAA,CAOd5xJ,KACD4xJ,CAAAA,KAAAA,CACO,CAAA;gBAIX;YAER;YACA,WAAWtR,CAAAA,EAAOwR,CAAAA,EAAAA;gBACd,OAAOl9J,IAAAA,CAAK+8J,WAAAA,CAAY,CAACtwJ,GAAK2qB,IAAAA,CAAAA,CACrBs0H,EAAMj/I,MACP2qB,CAAAA,EAAI6+H,QAAAA,CAAmC,cAAA,OAAnBiH,IACdA,EAAezwJ,GAAK2qB,KACpB8lI,IAAAA,CACC,CAAA;YAMnB;YACA,YAAYD,CAAAA,EAAAA;gBACR,OAAO,IAAIE,GAAW;oBAClBC,QAAQp9J,IAAAA;oBACR4gC,UAAUy8H,GAAsBF,UAAAA;oBAChCG,QAAQ;wBAAE72J,MAAM;wBAAcw2J,YAAAA;oBAAAA;gBAAAA;YAEtC;YACA,YAAYA,CAAAA,EAAAA;gBACR,OAAOj9J,IAAAA,CAAK+8J,WAAAA,CAAYE;YAC5B;YACA,YAAYO,CAAAA,CAAAA;gBAERx9J,IAAAA,CAAKy9J,GAAAA,GAAMz9J,IAAAA,CAAK28J,cAAAA,EAChB38J,IAAAA,CAAKg8J,IAAAA,GAAOwB,GACZx9J,IAAAA,CAAKs+D,KAAAA,GAAQt+D,IAAAA,CAAKs+D,KAAAA,CAAMz9C,IAAAA,CAAK7gB,IAAAA,GAC7BA,IAAAA,CAAKw8J,SAAAA,GAAYx8J,IAAAA,CAAKw8J,SAAAA,CAAU37I,IAAAA,CAAK7gB,IAAAA,GACrCA,IAAAA,CAAK08J,UAAAA,GAAa18J,IAAAA,CAAK08J,UAAAA,CAAW77I,IAAAA,CAAK7gB,IAAAA,GACvCA,IAAAA,CAAK28J,cAAAA,GAAiB38J,IAAAA,CAAK28J,cAAAA,CAAe97I,IAAAA,CAAK7gB,IAAAA,GAC/CA,IAAAA,CAAKy9J,GAAAA,GAAMz9J,IAAAA,CAAKy9J,GAAAA,CAAI58I,IAAAA,CAAK7gB,IAAAA,GACzBA,IAAAA,CAAK68J,MAAAA,GAAS78J,IAAAA,CAAK68J,MAAAA,CAAOh8I,IAAAA,CAAK7gB,IAAAA,GAC/BA,IAAAA,CAAKi9J,UAAAA,GAAaj9J,IAAAA,CAAKi9J,UAAAA,CAAWp8I,IAAAA,CAAK7gB,IAAAA,GACvCA,IAAAA,CAAKu9J,WAAAA,GAAcv9J,IAAAA,CAAKu9J,WAAAA,CAAY18I,IAAAA,CAAK7gB,IAAAA,GACzCA,IAAAA,CAAK09J,QAAAA,GAAW19J,IAAAA,CAAK09J,QAAAA,CAAS78I,IAAAA,CAAK7gB,IAAAA,GACnCA,IAAAA,CAAK29J,QAAAA,GAAW39J,IAAAA,CAAK29J,QAAAA,CAAS98I,IAAAA,CAAK7gB,IAAAA,GACnCA,IAAAA,CAAK49J,OAAAA,GAAU59J,IAAAA,CAAK49J,OAAAA,CAAQ/8I,IAAAA,CAAK7gB,IAAAA,GACjCA,IAAAA,CAAK8K,KAAAA,GAAQ9K,IAAAA,CAAK8K,KAAAA,CAAM+V,IAAAA,CAAK7gB,IAAAA,GAC7BA,IAAAA,CAAK6G,OAAAA,GAAU7G,IAAAA,CAAK6G,OAAAA,CAAQga,IAAAA,CAAK7gB,IAAAA,GACjCA,IAAAA,CAAK69J,EAAAA,GAAK79J,IAAAA,CAAK69J,EAAAA,CAAGh9I,IAAAA,CAAK7gB,IAAAA,GACvBA,IAAAA,CAAK89J,GAAAA,GAAM99J,IAAAA,CAAK89J,GAAAA,CAAIj9I,IAAAA,CAAK7gB,IAAAA,GACzBA,IAAAA,CAAK+c,SAAAA,GAAY/c,IAAAA,CAAK+c,SAAAA,CAAU8D,IAAAA,CAAK7gB,IAAAA,GACrCA,IAAAA,CAAK+9J,KAAAA,GAAQ/9J,IAAAA,CAAK+9J,KAAAA,CAAMl9I,IAAAA,CAAK7gB,IAAAA,GAC7BA,IAAAA,CAAKg+J,OAAAA,GAAUh+J,IAAAA,CAAKg+J,OAAAA,CAAQn9I,IAAAA,CAAK7gB,IAAAA,GACjCA,IAAAA,CAAK21J,KAAAA,GAAQ31J,IAAAA,CAAK21J,KAAAA,CAAM90I,IAAAA,CAAK7gB,IAAAA,GAC7BA,IAAAA,CAAKi+J,QAAAA,GAAWj+J,IAAAA,CAAKi+J,QAAAA,CAASp9I,IAAAA,CAAK7gB,IAAAA,GACnCA,IAAAA,CAAKuI,IAAAA,GAAOvI,IAAAA,CAAKuI,IAAAA,CAAKsY,IAAAA,CAAK7gB,IAAAA,GAC3BA,IAAAA,CAAKk+J,QAAAA,GAAWl+J,IAAAA,CAAKk+J,QAAAA,CAASr9I,IAAAA,CAAK7gB,IAAAA,GACnCA,IAAAA,CAAKm+J,UAAAA,GAAan+J,IAAAA,CAAKm+J,UAAAA,CAAWt9I,IAAAA,CAAK7gB,IAAAA,GACvCA,IAAAA,CAAKo+J,UAAAA,GAAap+J,IAAAA,CAAKo+J,UAAAA,CAAWv9I,IAAAA,CAAK7gB,IAAAA,GACvCA,IAAAA,CAAK,YAAA,GAAe;oBAChB49H,SAAS;oBACTygC,QAAQ;oBACRC,UAAW78J,CAAAA,IAASzB,IAAAA,CAAK,YAAA,CAAayB;gBAAAA;YAE9C;YACA,WAAAi8J;gBACI,OAAOa,GAAY3iG,MAAAA,CAAO57D,IAAAA,EAAMA,IAAAA,CAAKg8J,IAAAA;YACzC;YACA,WAAA2B;gBACI,OAAOa,GAAY5iG,MAAAA,CAAO57D,IAAAA,EAAMA,IAAAA,CAAKg8J,IAAAA;YACzC;YACA,UAAA4B;gBACI,OAAO59J,IAAAA,CAAK29J,QAAAA,GAAWD,QAAAA;YAC3B;YACA,QAAA5yJ;gBACI,OAAO2zJ,GAAS7iG,MAAAA,CAAO57D,IAAAA;YAC3B;YACA,UAAA6G;gBACI,OAAO63J,GAAW9iG,MAAAA,CAAO57D,IAAAA,EAAMA,IAAAA,CAAKg8J,IAAAA;YACxC;YACA,GAAG2C,CAAAA,EAAAA;gBACC,OAAOC,GAAShjG,MAAAA,CAAO;oBAAC57D,IAAAA;oBAAM2+J;iBAAAA,EAAS3+J,IAAAA,CAAKg8J,IAAAA;YAChD;YACA,IAAI6C,CAAAA,EAAAA;gBACA,OAAOC,GAAgBljG,MAAAA,CAAO57D,IAAAA,EAAM6+J,GAAU7+J,IAAAA,CAAKg8J,IAAAA;YACvD;YACA,UAAUj/I,CAAAA,EAAAA;gBACN,OAAO,IAAIogJ,GAAW;oBAAA,GACfzB,EAAoB17J,IAAAA,CAAKg8J,IAAAA,CAAAA;oBAC5BoB,QAAQp9J,IAAAA;oBACR4gC,UAAUy8H,GAAsBF,UAAAA;oBAChCG,QAAQ;wBAAE72J,MAAM;wBAAasW,WAAAA;oBAAAA;gBAAAA;YAErC;YACA,QAAQygJ,CAAAA,EAAAA;gBACJ,MAAMuB,IAAkC,cAAA,OAARvB,IAAqBA,IAAM,IAAMA;gBACjE,OAAO,IAAIwB,GAAW;oBAAA,GACftD,EAAoB17J,IAAAA,CAAKg8J,IAAAA,CAAAA;oBAC5BiD,WAAWj/J,IAAAA;oBACXk/J,cAAcH;oBACdn+H,UAAUy8H,GAAsB2B,UAAAA;gBAAAA;YAExC;YACA,QAAAjB;gBACI,OAAO,IAAIoB,GAAW;oBAClBv+H,UAAUy8H,GAAsB8B,UAAAA;oBAChC14J,MAAMzG,IAAAA;oBAAAA,GACH07J,EAAoB17J,IAAAA,CAAKg8J,IAAAA,CAAAA;gBAAAA;YAEpC;YACA,MAAMwB,CAAAA,EAAAA;gBACF,MAAM4B,IAAgC,cAAA,OAAR5B,IAAqBA,IAAM,IAAMA;gBAC/D,OAAO,IAAI6B,GAAS;oBAAA,GACb3D,EAAoB17J,IAAAA,CAAKg8J,IAAAA,CAAAA;oBAC5BiD,WAAWj/J,IAAAA;oBACXs/J,YAAYF;oBACZx+H,UAAUy8H,GAAsBgC,QAAAA;gBAAAA;YAExC;YACA,SAASxD,CAAAA,EAAAA;gBAEL,OAAO,IADM77J,IAAAA,CAAK2G,WAAAA,CACF;oBAAA,GACT3G,IAAAA,CAAKg8J,IAAAA;oBACRH,aAAAA;gBAAAA;YAER;YACA,KAAKx6I,CAAAA,EAAAA;gBACD,OAAOm+I,GAAY5jG,MAAAA,CAAO57D,IAAAA,EAAMqhB;YACpC;YACA,WAAA68I;gBACI,OAAOuB,GAAY7jG,MAAAA,CAAO57D,IAAAA;YAC9B;YACA,aAAAo+J;gBACI,OAAOp+J,IAAAA,CAAKw8J,SAAAA,CAAAA,KAAU17J,GAAW06J,OACrC;YAAA;YACA,aAAA2C;gBACI,OAAOn+J,IAAAA,CAAKw8J,SAAAA,CAAU,MAAMhB,OAChC;YAAA;QAAA;QAEJ,MAAMkE,IAAY,kBACZC,IAAa,eACbC,IAAY,6BAGZC,IAAY,0FACZC,IAAc,qBACdC,IAAW,oDACXC,IAAgB,4SAahBC,IAAa;QAKnB,IAAIC;QAEJ,MAAMC,IAAY,uHACZC,IAAgB,4IAGhBC,IAAY,ypBACZC,IAAgB,2rBAEhBC,IAAc,oEAEdC,IAAiB,0EAMjBC,IAAkB,qMAClBC,IAAY,IAAI3lI,OAAO,CAAA,CAAA,EAAI0lI,EAAAA,CAAAA,CAAAA;QACjC,SAASE,EAAgBjpJ,CAAAA;YAErB,IAAIkpJ,IAAQ;YAOZ,OANIlpJ,EAAKmpJ,SAAAA,GACLD,IAAQ,GAAGA,EAAAA,OAAAA,EAAelpJ,EAAKmpJ,SAAAA,CAAAA,CAAAA,CAAAA,GAER,QAAlBnpJ,EAAKmpJ,SAAAA,IACVD,CAAAA,IAAQ,GAAGA,EAAAA,UAAAA,CAAAA,AAAAA,GAERA;QACX;QAKA,SAASE,EAAcppJ,CAAAA;YACnB,IAAIkpJ,IAAQ,GAAGH,EAAAA,CAAAA,EAAmBE,EAAgBjpJ,IAAAA;YAClD,MAAM81I,IAAO,EAAA;YAKb,OAJAA,EAAK7tJ,IAAAA,CAAK+X,EAAKopE,KAAAA,GAAQ,OAAO,MAC1BppE,EAAKud,MAAAA,IACLu4H,EAAK7tJ,IAAAA,CAAK,yBACdihK,IAAQ,GAAGA,EAAAA,CAAAA,EAASpT,EAAKjtJ,IAAAA,CAAK,KAAA,CAAA,CAAA,EACvB,IAAIw6B,OAAO,CAAA,CAAA,EAAI6lI,EAAAA,CAAAA,CAAAA;QAC1B;QAUA,SAASG,EAAWC,CAAAA,EAAKC,CAAAA;YACrB,IAAA,CAAKlB,EAAS/1I,IAAAA,CAAKg3I,IACf,OAAA,CAAO;YACX,IAAA;gBACI,MAAA,CAAOtlB,EAAAA,GAAUslB,EAAI3rI,KAAAA,CAAM,MAErBj0B,IAASs6I,EACV1/G,OAAAA,CAAQ,MAAM,KACdA,OAAAA,CAAQ,MAAM,KACdklI,MAAAA,CAAOxlB,EAAOp7I,MAAAA,GAAAA,AAAW,CAAA,IAAKo7I,EAAOp7I,MAAAA,GAAS,CAAA,IAAM,GAAI,MACvD6gK,IAAU5/J,KAAK+8D,KAAAA,CAAM8iG,KAAKhgK;gBAChC,OAAuB,YAAA,OAAZ+/J,KAAoC,SAAZA,KAAAA,CAAAA,CAAAA,CAE9BA,EAAQE,GAAAA,IAAAA,CAAQF,EAAQF,GAAAA,AAAAA,KAAAA,CAAAA,CAEzBA,KAAOE,EAAQF,GAAAA,KAAQA,CAAAA;YAG/B,EACA,OAAO33J,GAAAA;gBACH,OAAA,CAAO;YACX;QACJ;QACA,SAASg4J,GAAYC,CAAAA,EAAI3jC,CAAAA;YACrB,OAAA,CAAiB,CAAA,SAAZA,KAAqBA,KAAAA,CAAYwiC,EAAcp2I,IAAAA,CAAKu3I,EAAAA,KAAAA,CAGxC,CAAA,SAAZ3jC,KAAqBA,KAAAA,CAAY0iC,EAAct2I,IAAAA,CAAKu3I,EAAAA;QAI7D;QACA,MAAMC,WAAkBzF;YACpB,OAAO77C,CAAAA,EAAAA;gBACClgH,IAAAA,CAAKg8J,IAAAA,CAAKyF,MAAAA,IACVvhD,CAAAA,EAAMz+G,IAAAA,GAAOkT,OAAOurG,EAAMz+G,IAAAA,CAAAA;gBAG9B,IADmBzB,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcziJ,MAAAA,EAAQ;oBACrC,MAAM2kB,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcziJ,MAAAA;wBACxB4kJ,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,MAAM3vI,IAAS,IAAIuvI;gBACnB,IAAIziI;gBACJ,KAAK,MAAMs0H,KAAS1rJ,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAC1B,IAAmB,UAAfhW,EAAMmP,IAAAA,EACF36C,EAAMz+G,IAAAA,CAAKnB,MAAAA,GAASorJ,EAAMtoJ,KAAAA,IAC1Bg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAaqC,SAAAA;oBACnBG,SAAS3M,EAAMtoJ,KAAAA;oBACfqD,MAAM;oBACN2xJ,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACPx9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,UAAfkzG,EAAMmP,IAAAA,EACP36C,EAAMz+G,IAAAA,CAAKnB,MAAAA,GAASorJ,EAAMtoJ,KAAAA,IAC1Bg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAayC,OAAAA;oBACnBC,SAAS7M,EAAMtoJ,KAAAA;oBACfqD,MAAM;oBACN2xJ,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACPx9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,aAAfkzG,EAAMmP,IAAAA,EAAmB;oBAC9B,MAAM8G,IAASzhD,EAAMz+G,IAAAA,CAAKnB,MAAAA,GAASorJ,EAAMtoJ,KAAAA,EACnCw+J,IAAW1hD,EAAMz+G,IAAAA,CAAKnB,MAAAA,GAASorJ,EAAMtoJ,KAAAA;oBACvCu+J,CAAAA,KAAUC,CAAAA,KACVxqI,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAC9BuqI,IACAnI,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAayC,OAAAA;wBACnBC,SAAS7M,EAAMtoJ,KAAAA;wBACfqD,MAAM;wBACN2xJ,WAAAA,CAAW;wBACXD,OAAAA,CAAO;wBACPx9I,SAAS+wI,EAAM/wI,OAAAA;oBAAAA,KAGdinJ,KACLpI,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAaqC,SAAAA;wBACnBG,SAAS3M,EAAMtoJ,KAAAA;wBACfqD,MAAM;wBACN2xJ,WAAAA,CAAW;wBACXD,OAAAA,CAAO;wBACPx9I,SAAS+wI,EAAM/wI,OAAAA;oBAAAA,IAGvB2P,EAAOkuB,KAAAA,EAAAA;gBAEf,OACK,IAAmB,YAAfkzG,EAAMmP,IAAAA,EACNoF,EAAWj2I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KACvB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,YAAfkzG,EAAMmP,IAAAA,EACNqF,KACDA,CAAAA,IAAa,IAAInlI,OA5KjB,wDA4KqC,IAAA,GAEpCmlI,EAAWl2I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KACvB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,WAAfkzG,EAAMmP,IAAAA,EACNgF,EAAU71I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KACtB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,aAAfkzG,EAAMmP,IAAAA,EACNiF,EAAY91I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KACxB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,WAAfkzG,EAAMmP,IAAAA,EACN6E,EAAU11I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KACtB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,YAAfkzG,EAAMmP,IAAAA,EACN8E,EAAW31I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KACvB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,WAAfkzG,EAAMmP,IAAAA,EACN+E,EAAU51I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KACtB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,UAAfkzG,EAAMmP,IAAAA,EACX,IAAA;oBACI,IAAInoI,IAAIwtF,EAAMz+G,IAAAA;gBAClB,EACA,OAAO6H,GAAAA;oBACH8tB,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;wBACnB4gI,YAAY;wBACZjxC,MAAM8uC,EAAakC,cAAAA;wBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;oBAAAA,IAEnB2P,EAAOkuB,KAAAA;gBACX;qBAEC,IAAmB,YAAfkzG,EAAMmP,IAAAA,EAAkB;oBAC7BnP,EAAMkV,KAAAA,CAAMiB,SAAAA,GAAY;oBACLnW,EAAMkV,KAAAA,CAAM52I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KAEtC21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;wBACnB4gI,YAAY;wBACZjxC,MAAM8uC,EAAakC,cAAAA;wBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;oBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;gBAEf,OACK,IAAmB,WAAfkzG,EAAMmP,IAAAA,EACX36C,EAAMz+G,IAAAA,GAAOy+G,EAAMz+G,IAAAA,CAAKqgK,IAAAA;qBAEvB,IAAmB,eAAfpW,EAAMmP,IAAAA,EACN36C,EAAMz+G,IAAAA,CAAKwf,QAAAA,CAASyqI,EAAMtoJ,KAAAA,EAAOsoJ,EAAM9xI,QAAAA,KACxCwd,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAakC,cAAAA;oBACnBC,YAAY;wBAAE/2I,UAAUyqI,EAAMtoJ,KAAAA;wBAAOwW,UAAU8xI,EAAM9xI,QAAAA;oBAAAA;oBACrDe,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,kBAAfkzG,EAAMmP,IAAAA,EACX36C,EAAMz+G,IAAAA,GAAOy+G,EAAMz+G,IAAAA,CAAKg7J,WAAAA;qBAEvB,IAAmB,kBAAf/Q,EAAMmP,IAAAA,EACX36C,EAAMz+G,IAAAA,GAAOy+G,EAAMz+G,IAAAA,CAAKsgK,WAAAA;qBAEvB,IAAmB,iBAAfrW,EAAMmP,IAAAA,EACN36C,EAAMz+G,IAAAA,CAAKw2J,UAAAA,CAAWvM,EAAMtoJ,KAAAA,KAC7Bg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAakC,cAAAA;oBACnBC,YAAY;wBAAEC,YAAYvM,EAAMtoJ,KAAAA;oBAAAA;oBAChCuX,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,eAAfkzG,EAAMmP,IAAAA,EACN36C,EAAMz+G,IAAAA,CAAKywB,QAAAA,CAASw5H,EAAMtoJ,KAAAA,KAC3Bg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAakC,cAAAA;oBACnBC,YAAY;wBAAE9lI,UAAUw5H,EAAMtoJ,KAAAA;oBAAAA;oBAC9BuX,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,eAAfkzG,EAAMmP,IAAAA,EACGiG,EAAcpV,GACjB1hI,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KAClB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAakC,cAAAA;oBACnBC,YAAY;oBACZr9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,WAAfkzG,EAAMmP,IAAAA,EACG6F,EACH12I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KAClB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAakC,cAAAA;oBACnBC,YAAY;oBACZr9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,WAAfkzG,EAAMmP,IAAAA,EA5ShB,IAAI9/H,OAAO,CAAA,CAAA,EAAI4lI,EA6ScjV,GAAAA,CAAAA,CAAAA,EACb1hI,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KAClB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAakC,cAAAA;oBACnBC,YAAY;oBACZr9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGS,eAAfkzG,EAAMmP,IAAAA,GACNmF,EAAch2I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KAC1B21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,IAGS,SAAfkzG,EAAMmP,IAAAA,GAvTR0G,CAAAA,IAwTYrhD,EAAMz+G,IAAAA,EAAAA,AAvThB,CAAA,SADEm8H,CAAAA,IAwToB8tB,EAAM9tB,OAAAA,AAAAA,KAvTnBA,KAAAA,CAAYuiC,EAAUn2I,IAAAA,CAAKu3I,EAAAA,KAGpC,CAAA,SAAZ3jC,KAAqBA,KAAAA,CAAYyiC,EAAUr2I,IAAAA,CAAKu3I,EAAAA,KAqTrCnqI,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,CAAAA,IAGS,UAAfkzG,EAAMmP,IAAAA,GACNkG,EAAW7gD,EAAMz+G,IAAAA,EAAMiqJ,EAAMuV,GAAAA,KAC9B7pI,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,IAGS,WAAfkzG,EAAMmP,IAAAA,GACNyG,GAAYphD,EAAMz+G,IAAAA,EAAMiqJ,EAAM9tB,OAAAA,KAC/BxmG,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,IAGS,aAAfkzG,EAAMmP,IAAAA,GACN0F,EAAYv2I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KACxB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,IAGS,gBAAfkzG,EAAMmP,IAAAA,GACN2F,EAAex2I,IAAAA,CAAKk2F,EAAMz+G,IAAAA,KAC3B21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB4gI,YAAY;oBACZjxC,MAAM8uC,EAAakC,cAAAA;oBACnBp9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,IAIXs7G,EAAKK,WAAAA,CAAYzI;gBA/WjC,IAAmB6V,GAAI3jC;gBAkXf,OAAO;oBAAEtzG,QAAQA,EAAOlnB,KAAAA;oBAAOA,OAAO88G,EAAMz+G,IAAAA;gBAAAA;YAChD;YACA,OAAOm/J,CAAAA,EAAO5I,CAAAA,EAAYr9I,CAAAA,EAAAA;gBACtB,OAAO3a,IAAAA,CAAKi9J,UAAAA,CAAYx7J,CAAAA,IAASm/J,EAAM52I,IAAAA,CAAKvoB,IAAO;oBAC/Cu2J,YAAAA;oBACAjxC,MAAM8uC,EAAakC,cAAAA;oBAAAA,GAChBgD,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAE9B;YACA,UAAU+wI,CAAAA,EAAAA;gBACN,OAAO,IAAI8V,GAAU;oBAAA,GACdxhK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BAAI1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBAAQhW;qBAAAA;gBAAAA;YAEtC;YACA,MAAM/wI,CAAAA,EAAAA;gBACF,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAYE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YACjE;YACA,IAAIA,CAAAA,EAAAA;gBACA,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAUE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAC/D;YACA,MAAMA,CAAAA,EAAAA;gBACF,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAYE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YACjE;YACA,KAAKA,CAAAA,EAAAA;gBACD,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAWE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAChE;YACA,OAAOA,CAAAA,EAAAA;gBACH,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAaE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAClE;YACA,KAAKA,CAAAA,EAAAA;gBACD,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAWE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAChE;YACA,MAAMA,CAAAA,EAAAA;gBACF,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAYE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YACjE;YACA,KAAKA,CAAAA,EAAAA;gBACD,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAWE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAChE;YACA,OAAOA,CAAAA,EAAAA;gBACH,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAaE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAClE;YACA,UAAUA,CAAAA,EAAAA;gBAEN,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBAAA,GACHE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAE9B;YACA,IAAI1B,CAAAA,EAAAA;gBACA,OAAOjZ,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAUE,EAAUI,QAAAA,CAASliJ,EAAAA;gBAAAA;YAC/D;YACA,GAAGA,CAAAA,EAAAA;gBACC,OAAOjZ,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAASE,EAAUI,QAAAA,CAASliJ,EAAAA;gBAAAA;YAC9D;YACA,KAAKA,CAAAA,EAAAA;gBACD,OAAOjZ,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAWE,EAAUI,QAAAA,CAASliJ,EAAAA;gBAAAA;YAChE;YACA,SAASA,CAAAA,EAAAA;gBACL,IAAI3P,GAAIG;gBACR,OAAuB,YAAA,OAAZwP,IACAjZ,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNgG,WAAW;oBACX5rI,QAAAA,CAAQ;oBACR6rD,OAAAA,CAAO;oBACPnmE,SAAS1B;gBAAAA,KAGVjZ,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNgG,WAAAA,KAA4F,MAAzE5nJ,CAAAA,QAAAA,IAAAA,KAAyC,IAASA,EAAQ4nJ,SAAAA,AAAAA,IAA6B,OAAO5nJ,QAAAA,IAAAA,KAAyC,IAASA,EAAQ4nJ,SAAAA;oBAC3K5rI,QAAoF,SAA3E3rB,CAAAA,IAAK2P,QAAAA,IAAAA,KAAyC,IAASA,EAAQgc,MAAAA,AAAAA,KAAAA,KAA2B,MAAP3rB,KAAgBA;oBAC5Gw3E,OAAkF,SAA1Er3E,CAAAA,IAAKwP,QAAAA,IAAAA,KAAyC,IAASA,EAAQ6nE,KAAAA,AAAAA,KAAAA,KAA0B,MAAPr3E,KAAgBA;oBAAAA,GACvGsxJ,EAAUI,QAAAA,CAASliJ,QAAAA,IAAAA,KAAyC,IAASA,EAAQ0B,OAAAA,CAAAA;gBAAAA;YAExF;YACA,KAAKA,CAAAA,EAAAA;gBACD,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAQlgJ,SAAAA;gBAAAA;YAC1C;YACA,KAAK1B,CAAAA,EAAAA;gBACD,OAAuB,YAAA,OAAZA,IACAjZ,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNgG,WAAW;oBACXlmJ,SAAS1B;gBAAAA,KAGVjZ,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNgG,WAAAA,KAA4F,MAAzE5nJ,CAAAA,QAAAA,IAAAA,KAAyC,IAASA,EAAQ4nJ,SAAAA,AAAAA,IAA6B,OAAO5nJ,QAAAA,IAAAA,KAAyC,IAASA,EAAQ4nJ,SAAAA;oBAAAA,GACxK9F,EAAUI,QAAAA,CAASliJ,QAAAA,IAAAA,KAAyC,IAASA,EAAQ0B,OAAAA,CAAAA;gBAAAA;YAExF;YACA,SAASA,CAAAA,EAAAA;gBACL,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAAEpH,MAAM;oBAAA,GAAeE,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YACpE;YACA,MAAMimJ,CAAAA,EAAOjmJ,CAAAA,EAAAA;gBACT,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACN+F,OAAOA;oBAAAA,GACJ7F,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAE9B;YACA,SAASvX,CAAAA,EAAO6V,CAAAA,EAAAA;gBACZ,OAAOjZ,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOA;oBACPwW,UAAUX,QAAAA,IAAAA,KAAyC,IAASA,EAAQW,QAAAA;oBAAAA,GACjEmhJ,EAAUI,QAAAA,CAASliJ,QAAAA,IAAAA,KAAyC,IAASA,EAAQ0B,OAAAA,CAAAA;gBAAAA;YAExF;YACA,WAAWvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACd,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOA;oBAAAA,GACJ23J,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAE9B;YACA,SAASvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACZ,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOA;oBAAAA,GACJ23J,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAE9B;YACA,IAAIq7D,CAAAA,EAAWr7D,CAAAA,EAAAA;gBACX,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAO4yE;oBAAAA,GACJ+kF,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAE9B;YACA,IAAIioJ,CAAAA,EAAWjoJ,CAAAA,EAAAA;gBACX,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOw/J;oBAAAA,GACJ7H,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAE9B;YACA,OAAOhD,CAAAA,EAAKgD,CAAAA,EAAAA;gBACR,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOuU;oBAAAA,GACJojJ,EAAUI,QAAAA,CAASxgJ,EAAAA;gBAAAA;YAE9B;YAIA,SAASA,CAAAA,EAAAA;gBACL,OAAO3a,IAAAA,CAAKwK,GAAAA,CAAI,GAAGuwJ,EAAUI,QAAAA,CAASxgJ;YAC1C;YACA,OAAAmnJ;gBACI,OAAO,IAAIN,GAAU;oBAAA,GACdxhK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BAAI1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBAAQ;4BAAE7G,MAAM;wBAAA;qBAAA;gBAAA;YAE9C;YACA,cAAA4B;gBACI,OAAO,IAAI+E,GAAU;oBAAA,GACdxhK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BAAI1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBAAQ;4BAAE7G,MAAM;wBAAA;qBAAA;gBAAA;YAE9C;YACA,cAAAkH;gBACI,OAAO,IAAIP,GAAU;oBAAA,GACdxhK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BAAI1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBAAQ;4BAAE7G,MAAM;wBAAA;qBAAA;gBAAA;YAE9C;YACA,IAAA,aAAIiI;gBACA,OAAA,CAAA,CAAS9iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,eAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,SAAImI;gBACA,OAAA,CAAA,CAAShjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,WAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,SAAIoI;gBACA,OAAA,CAAA,CAASjjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,WAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,aAAIqI;gBACA,OAAA,CAAA,CAASljK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,eAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,UAAIsI;gBACA,OAAA,CAAA,CAASnjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,YAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,QAAIuI;gBACA,OAAA,CAAA,CAASpjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,UAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,UAAIwI;gBACA,OAAA,CAAA,CAASrjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,YAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,SAAIyI;gBACA,OAAA,CAAA,CAAStjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,WAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,WAAI0I;gBACA,OAAA,CAAA,CAASvjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,aAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,SAAI2I;gBACA,OAAA,CAAA,CAASxjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,WAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,UAAI4I;gBACA,OAAA,CAAA,CAASzjK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,YAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,SAAI6I;gBACA,OAAA,CAAA,CAAS1jK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,WAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,OAAI8I;gBACA,OAAA,CAAA,CAAS3jK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,SAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,SAAI+I;gBACA,OAAA,CAAA,CAAS5jK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,WAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,WAAIgJ;gBACA,OAAA,CAAA,CAAS7jK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,aAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,cAAIiJ;gBAEA,OAAA,CAAA,CAAS9jK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,gBAAZA,EAAGlI,IAAAA;YAC9C;YACA,IAAA,YAAI7kF;gBACA,IAAIxrE,IAAM;gBACV,KAAK,MAAMu4J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAZqB,EAAGlI,IAAAA,IACS,CAAA,SAARrwJ,KAAgBu4J,EAAG3/J,KAAAA,GAAQoH,CAAAA,KAC3BA,CAAAA,IAAMu4J,EAAG3/J,KAAAA,AAAAA;gBAGrB,OAAOoH;YACX;YACA,IAAA,YAAIo4J;gBACA,IAAIr9J,IAAM;gBACV,KAAK,MAAMw9J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAZqB,EAAGlI,IAAAA,IACS,CAAA,SAARt1J,KAAgBw9J,EAAG3/J,KAAAA,GAAQmC,CAAAA,KAC3BA,CAAAA,IAAMw9J,EAAG3/J,KAAAA,AAAAA;gBAGrB,OAAOmC;YACX;QAAA;QAYJ,SAASw+J,GAAmBt3J,CAAAA,EAAKmsG,CAAAA;YAC7B,MAAMorD,IAAAA,AAAev3J,CAAAA,EAAI1M,QAAAA,GAAWs1B,KAAAA,CAAM,IAAA,CAAK,EAAA,IAAM,EAAA,EAAI/0B,MAAAA,EACnD2jK,IAAAA,AAAgBrrD,CAAAA,EAAK74G,QAAAA,GAAWs1B,KAAAA,CAAM,IAAA,CAAK,EAAA,IAAM,EAAA,EAAI/0B,MAAAA,EACrD4jK,IAAWF,IAAcC,IAAeD,IAAcC;YAG5D,OAFetxJ,SAASlG,EAAI0F,OAAAA,CAAQ+xJ,GAAUloI,OAAAA,CAAQ,KAAK,OAC3CrpB,SAASimG,EAAKzmG,OAAAA,CAAQ+xJ,GAAUloI,OAAAA,CAAQ,KAAK,OACjC12B,KAAK2J,GAAAA,CAAI,IAAIi1J;QAC7C;QAjBA1C,GAAU5lG,MAAAA,GAAUq9F,CAAAA;YAChB,IAAI3vJ;YACJ,OAAO,IAAIk4J,GAAU;gBACjBE,QAAQ,EAAA;gBACR9gI,UAAUy8H,GAAsBmE,SAAAA;gBAChCC,QAAiF,SAAxEn4J,CAAAA,IAAK2vJ,QAAAA,IAAAA,KAAuC,IAASA,EAAOwI,MAAAA,AAAAA,KAAAA,KAA2B,MAAPn4J,KAAgBA;gBAAAA,GACtGoyJ,EAAoBzC,EAAAA;YAAAA;QACzB;QAWN,MAAMkL,WAAkBpI;YACpB,aAAAp1J;gBACIimB,KAAAA,IAASmrD,YACT/3E,IAAAA,CAAKwK,GAAAA,GAAMxK,IAAAA,CAAKokK,GAAAA,EAChBpkK,IAAAA,CAAKuF,GAAAA,GAAMvF,IAAAA,CAAKqkK,GAAAA,EAChBrkK,IAAAA,CAAK44G,IAAAA,GAAO54G,IAAAA,CAAK24J,UACrB;YAAA;YACA,OAAOz4C,CAAAA,EAAAA;gBACClgH,IAAAA,CAAKg8J,IAAAA,CAAKyF,MAAAA,IACVvhD,CAAAA,EAAMz+G,IAAAA,GAAO8c,OAAO2hG,EAAMz+G,IAAAA,CAAAA;gBAG9B,IADmBzB,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcG,MAAAA,EAAQ;oBACrC,MAAMj+H,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcG,MAAAA;wBACxBgC,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,IAAI7iI;gBACJ,MAAM9M,IAAS,IAAIuvI;gBACnB,KAAK,MAAMnO,KAAS1rJ,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAC1B,IAAmB,UAAfhW,EAAMmP,IAAAA,EACD/G,EAAKa,SAAAA,CAAUz0C,EAAMz+G,IAAAA,KACtB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAU;oBACVD,UAAU;oBACV18I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,UAAfkzG,EAAMmP,IAAAA,EAAgB,AACVnP,CAAAA,EAAM0M,SAAAA,GACjBl4C,EAAMz+G,IAAAA,GAAOiqJ,EAAMtoJ,KAAAA,GACnB88G,EAAMz+G,IAAAA,IAAQiqJ,EAAMtoJ,KAAAA,AAAAA,KAEtBg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAaqC,SAAAA;oBACnBG,SAAS3M,EAAMtoJ,KAAAA;oBACfqD,MAAM;oBACN2xJ,WAAW1M,EAAM0M,SAAAA;oBACjBD,OAAAA,CAAO;oBACPx9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,UAAfkzG,EAAMmP,IAAAA,EAAgB,AACZnP,CAAAA,EAAM0M,SAAAA,GACfl4C,EAAMz+G,IAAAA,GAAOiqJ,EAAMtoJ,KAAAA,GACnB88G,EAAMz+G,IAAAA,IAAQiqJ,EAAMtoJ,KAAAA,AAAAA,KAEtBg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAayC,OAAAA;oBACnBC,SAAS7M,EAAMtoJ,KAAAA;oBACfqD,MAAM;oBACN2xJ,WAAW1M,EAAM0M,SAAAA;oBACjBD,OAAAA,CAAO;oBACPx9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGS,iBAAfkzG,EAAMmP,IAAAA,GACyC,MAAhDkJ,GAAmB7jD,EAAMz+G,IAAAA,EAAMiqJ,EAAMtoJ,KAAAA,KACrCg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAa6C,eAAAA;oBACnBC,YAAYjN,EAAMtoJ,KAAAA;oBAClBuX,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,IAGS,aAAfkzG,EAAMmP,IAAAA,GACNt8I,OAAOq2I,QAAAA,CAAS10C,EAAMz+G,IAAAA,KACvB21B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAa+C,UAAAA;oBACnBj+I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,IAIXs7G,EAAKK,WAAAA,CAAYzI;gBAGzB,OAAO;oBAAEphI,QAAQA,EAAOlnB,KAAAA;oBAAOA,OAAO88G,EAAMz+G,IAAAA;gBAAAA;YAChD;YACA,IAAI2B,CAAAA,EAAOuX,CAAAA,EAAAA;gBACP,OAAO3a,IAAAA,CAAKskK,QAAAA,CAAS,OAAOlhK,GAAAA,CAAO,GAAM23J,EAAUh7J,QAAAA,CAAS4a;YAChE;YACA,GAAGvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACN,OAAO3a,IAAAA,CAAKskK,QAAAA,CAAS,OAAOlhK,GAAAA,CAAO,GAAO23J,EAAUh7J,QAAAA,CAAS4a;YACjE;YACA,IAAIvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACP,OAAO3a,IAAAA,CAAKskK,QAAAA,CAAS,OAAOlhK,GAAAA,CAAO,GAAM23J,EAAUh7J,QAAAA,CAAS4a;YAChE;YACA,GAAGvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACN,OAAO3a,IAAAA,CAAKskK,QAAAA,CAAS,OAAOlhK,GAAAA,CAAO,GAAO23J,EAAUh7J,QAAAA,CAAS4a;YACjE;YACA,SAASkgJ,CAAAA,EAAMz3J,CAAAA,EAAOg1J,CAAAA,EAAWz9I,CAAAA,EAAAA;gBAC7B,OAAO,IAAIwpJ,GAAU;oBAAA,GACdnkK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BACD1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBACb;4BACI7G,MAAAA;4BACAz3J,OAAAA;4BACAg1J,WAAAA;4BACAz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;wBAAAA;qBAAAA;gBAAAA;YAI5C;YACA,UAAU+wI,CAAAA,EAAAA;gBACN,OAAO,IAAIyY,GAAU;oBAAA,GACdnkK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BAAI1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBAAQhW;qBAAAA;gBAAAA;YAEtC;YACA,IAAI/wI,CAAAA,EAAAA;gBACA,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNlgJ,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,SAASA,CAAAA,EAAAA;gBACL,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAO;oBACPg1J,WAAAA,CAAW;oBACXz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,SAASA,CAAAA,EAAAA;gBACL,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAO;oBACPg1J,WAAAA,CAAW;oBACXz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,YAAYA,CAAAA,EAAAA;gBACR,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAO;oBACPg1J,WAAAA,CAAW;oBACXz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,YAAYA,CAAAA,EAAAA;gBACR,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAO;oBACPg1J,WAAAA,CAAW;oBACXz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,WAAWvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACd,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOA;oBACPuX,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,OAAOA,CAAAA,EAAAA;gBACH,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNlgJ,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,KAAKA,CAAAA,EAAAA;gBACD,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNzC,WAAAA,CAAW;oBACXh1J,OAAOmb,OAAOymJ,gBAAAA;oBACdrqJ,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA,GAC7BsnJ,SAAAA,CAAU;oBACTpH,MAAM;oBACNzC,WAAAA,CAAW;oBACXh1J,OAAOmb,OAAO0mJ,gBAAAA;oBACdtqJ,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,IAAA,WAAIuqJ;gBACA,IAAI16J,IAAM;gBACV,KAAK,MAAMu4J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAZqB,EAAGlI,IAAAA,IACS,CAAA,SAARrwJ,KAAgBu4J,EAAG3/J,KAAAA,GAAQoH,CAAAA,KAC3BA,CAAAA,IAAMu4J,EAAG3/J,KAAAA,AAAAA;gBAGrB,OAAOoH;YACX;YACA,IAAA,WAAI26J;gBACA,IAAI5/J,IAAM;gBACV,KAAK,MAAMw9J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAZqB,EAAGlI,IAAAA,IACS,CAAA,SAARt1J,KAAgBw9J,EAAG3/J,KAAAA,GAAQmC,CAAAA,KAC3BA,CAAAA,IAAMw9J,EAAG3/J,KAAAA,AAAAA;gBAGrB,OAAOmC;YACX;YACA,IAAA,QAAI6/J;gBACA,OAAA,CAAA,CAASplK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAOtwG,IAAAA,CAAM2xG,CAAAA,IAAmB,UAAZA,EAAGlI,IAAAA,IACzB,iBAAZkI,EAAGlI,IAAAA,IAAyB/G,EAAKa,SAAAA,CAAUoO,EAAG3/J,KAAAA;YACvD;YACA,IAAA,WAAIwxJ;gBACA,IAAIrvJ,IAAM,MAAMiF,IAAM;gBACtB,KAAK,MAAMu4J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAAQ;oBAC/B,IAAgB,aAAZqB,EAAGlI,IAAAA,IACS,UAAZkI,EAAGlI,IAAAA,IACS,iBAAZkI,EAAGlI,IAAAA,EACH,OAAA,CAAO;oBAEU,UAAZkI,EAAGlI,IAAAA,GAAAA,AACI,CAAA,SAARrwJ,KAAgBu4J,EAAG3/J,KAAAA,GAAQoH,CAAAA,KAC3BA,CAAAA,IAAMu4J,EAAG3/J,KAAAA,AAAAA,IAEI,UAAZ2/J,EAAGlI,IAAAA,IACI,CAAA,SAARt1J,KAAgBw9J,EAAG3/J,KAAAA,GAAQmC,CAAAA,KAC3BA,CAAAA,IAAMw9J,EAAG3/J,KAAAA,AAAAA;gBAErB;gBACA,OAAOmb,OAAOq2I,QAAAA,CAASpqJ,MAAQ+T,OAAOq2I,QAAAA,CAASrvJ;YACnD;QAAA;QAEJ4+J,GAAUvoG,MAAAA,GAAUq9F,CAAAA,IACT,IAAIkL,GAAU;gBACjBzC,QAAQ,EAAA;gBACR9gI,UAAUy8H,GAAsB8G,SAAAA;gBAChC1C,QAAAA,AAASxI,CAAAA,QAAAA,IAAAA,KAAuC,IAASA,EAAOwI,MAAAA,AAAAA,KAAAA,CAAW;gBAAA,GACxE/F,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMoM,WAAkBtJ;YACpB,aAAAp1J;gBACIimB,KAAAA,IAASmrD,YACT/3E,IAAAA,CAAKwK,GAAAA,GAAMxK,IAAAA,CAAKokK,GAAAA,EAChBpkK,IAAAA,CAAKuF,GAAAA,GAAMvF,IAAAA,CAAKqkK,GACpB;YAAA;YACA,OAAOnkD,CAAAA,EAAAA;gBACH,IAAIlgH,IAAAA,CAAKg8J,IAAAA,CAAKyF,MAAAA,EACV,IAAA;oBACIvhD,EAAMz+G,IAAAA,GAAO6jK,OAAOplD,EAAMz+G,IAAAA;gBAC9B,EACA,OAAO6H,GAAAA;oBACH,OAAOtJ,IAAAA,CAAKulK,gBAAAA,CAAiBrlD;gBACjC;gBAGJ,IADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcM,MAAAA,EAC7B,OAAOx1J,IAAAA,CAAKulK,gBAAAA,CAAiBrlD;gBAEjC,IAAI9oF;gBACJ,MAAM9M,IAAS,IAAIuvI;gBACnB,KAAK,MAAMnO,KAAS1rJ,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CAC1B,IAAmB,UAAfhW,EAAMmP,IAAAA,EAAgB,AACLnP,CAAAA,EAAM0M,SAAAA,GACjBl4C,EAAMz+G,IAAAA,GAAOiqJ,EAAMtoJ,KAAAA,GACnB88G,EAAMz+G,IAAAA,IAAQiqJ,EAAMtoJ,KAAAA,AAAAA,KAEtBg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAaqC,SAAAA;oBACnBzxJ,MAAM;oBACN4xJ,SAAS3M,EAAMtoJ,KAAAA;oBACfg1J,WAAW1M,EAAM0M,SAAAA;oBACjBz9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGV,IAAmB,UAAfkzG,EAAMmP,IAAAA,EAAgB,AACZnP,CAAAA,EAAM0M,SAAAA,GACfl4C,EAAMz+G,IAAAA,GAAOiqJ,EAAMtoJ,KAAAA,GACnB88G,EAAMz+G,IAAAA,IAAQiqJ,EAAMtoJ,KAAAA,AAAAA,KAEtBg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAayC,OAAAA;oBACnB7xJ,MAAM;oBACN8xJ,SAAS7M,EAAMtoJ,KAAAA;oBACfg1J,WAAW1M,EAAM0M,SAAAA;oBACjBz9I,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA;qBAGS,iBAAfkzG,EAAMmP,IAAAA,GACP36C,EAAMz+G,IAAAA,GAAOiqJ,EAAMtoJ,KAAAA,KAAUkiK,OAAO,MACpCluI,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAa6C,eAAAA;oBACnBC,YAAYjN,EAAMtoJ,KAAAA;oBAClBuX,SAAS+wI,EAAM/wI,OAAAA;gBAAAA,IAEnB2P,EAAOkuB,KAAAA,EAAAA,IAIXs7G,EAAKK,WAAAA,CAAYzI;gBAGzB,OAAO;oBAAEphI,QAAQA,EAAOlnB,KAAAA;oBAAOA,OAAO88G,EAAMz+G,IAAAA;gBAAAA;YAChD;YACA,iBAAiBy+G,CAAAA,EAAAA;gBACb,MAAM9oF,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;gBAMjC,OALAs5C,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcM,MAAAA;oBACxB6B,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;YACX;YACA,IAAI72J,CAAAA,EAAOuX,CAAAA,EAAAA;gBACP,OAAO3a,IAAAA,CAAKskK,QAAAA,CAAS,OAAOlhK,GAAAA,CAAO,GAAM23J,EAAUh7J,QAAAA,CAAS4a;YAChE;YACA,GAAGvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACN,OAAO3a,IAAAA,CAAKskK,QAAAA,CAAS,OAAOlhK,GAAAA,CAAO,GAAO23J,EAAUh7J,QAAAA,CAAS4a;YACjE;YACA,IAAIvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACP,OAAO3a,IAAAA,CAAKskK,QAAAA,CAAS,OAAOlhK,GAAAA,CAAO,GAAM23J,EAAUh7J,QAAAA,CAAS4a;YAChE;YACA,GAAGvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACN,OAAO3a,IAAAA,CAAKskK,QAAAA,CAAS,OAAOlhK,GAAAA,CAAO,GAAO23J,EAAUh7J,QAAAA,CAAS4a;YACjE;YACA,SAASkgJ,CAAAA,EAAMz3J,CAAAA,EAAOg1J,CAAAA,EAAWz9I,CAAAA,EAAAA;gBAC7B,OAAO,IAAI0qJ,GAAU;oBAAA,GACdrlK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BACD1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBACb;4BACI7G,MAAAA;4BACAz3J,OAAAA;4BACAg1J,WAAAA;4BACAz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;wBAAAA;qBAAAA;gBAAAA;YAI5C;YACA,UAAU+wI,CAAAA,EAAAA;gBACN,OAAO,IAAI2Z,GAAU;oBAAA,GACdrlK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BAAI1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBAAQhW;qBAAAA;gBAAAA;YAEtC;YACA,SAAS/wI,CAAAA,EAAAA;gBACL,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOkiK,OAAO;oBACdlN,WAAAA,CAAW;oBACXz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,SAASA,CAAAA,EAAAA;gBACL,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOkiK,OAAO;oBACdlN,WAAAA,CAAW;oBACXz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,YAAYA,CAAAA,EAAAA;gBACR,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOkiK,OAAO;oBACdlN,WAAAA,CAAW;oBACXz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,YAAYA,CAAAA,EAAAA;gBACR,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOkiK,OAAO;oBACdlN,WAAAA,CAAW;oBACXz9I,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,WAAWvX,CAAAA,EAAOuX,CAAAA,EAAAA;gBACd,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAAA;oBACAuX,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,IAAA,WAAIuqJ;gBACA,IAAI16J,IAAM;gBACV,KAAK,MAAMu4J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAZqB,EAAGlI,IAAAA,IACS,CAAA,SAARrwJ,KAAgBu4J,EAAG3/J,KAAAA,GAAQoH,CAAAA,KAC3BA,CAAAA,IAAMu4J,EAAG3/J,KAAAA,AAAAA;gBAGrB,OAAOoH;YACX;YACA,IAAA,WAAI26J;gBACA,IAAI5/J,IAAM;gBACV,KAAK,MAAMw9J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAZqB,EAAGlI,IAAAA,IACS,CAAA,SAARt1J,KAAgBw9J,EAAG3/J,KAAAA,GAAQmC,CAAAA,KAC3BA,CAAAA,IAAMw9J,EAAG3/J,KAAAA,AAAAA;gBAGrB,OAAOmC;YACX;QAAA;QAEJ8/J,GAAUzpG,MAAAA,GAAUq9F,CAAAA;YAChB,IAAI3vJ;YACJ,OAAO,IAAI+7J,GAAU;gBACjB3D,QAAQ,EAAA;gBACR9gI,UAAUy8H,GAAsBgI,SAAAA;gBAChC5D,QAAiF,SAAxEn4J,CAAAA,IAAK2vJ,QAAAA,IAAAA,KAAuC,IAASA,EAAOwI,MAAAA,AAAAA,KAAAA,KAA2B,MAAPn4J,KAAgBA;gBAAAA,GACtGoyJ,EAAoBzC,EAAAA;YAAAA;QACzB;QAEN,MAAMuM,WAAmBzJ;YACrB,OAAO77C,CAAAA,EAAAA;gBACClgH,IAAAA,CAAKg8J,IAAAA,CAAKyF,MAAAA,IACVvhD,CAAAA,EAAMz+G,IAAAA,GAAOkkH,QAAQzF,EAAMz+G,IAAAA,CAAAA;gBAG/B,IADmBzB,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcI,OAAAA,EAAS;oBACtC,MAAMl+H,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcI,OAAAA;wBACxB+B,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,OAAOO,EAAGt6C,EAAMz+G,IAAAA;YACpB;QAAA;QAEJ+jK,GAAW5pG,MAAAA,GAAUq9F,CAAAA,IACV,IAAIuM,GAAW;gBAClB5kI,UAAUy8H,GAAsBmI,UAAAA;gBAChC/D,QAAAA,AAASxI,CAAAA,QAAAA,IAAAA,KAAuC,IAASA,EAAOwI,MAAAA,AAAAA,KAAAA,CAAW;gBAAA,GACxE/F,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMwM,WAAgB1J;YAClB,OAAO77C,CAAAA,EAAAA;gBACClgH,IAAAA,CAAKg8J,IAAAA,CAAKyF,MAAAA,IACVvhD,CAAAA,EAAMz+G,IAAAA,GAAO,IAAIwD,KAAKi7G,EAAMz+G,IAAAA,CAAAA;gBAGhC,IADmBzB,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcU,IAAAA,EAAM;oBACnC,MAAMx+H,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcU,IAAAA;wBACxByB,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,IAAItrJ,MAAMuxG,EAAMz+G,IAAAA,CAAKikK,OAAAA,KAKjB,OAHAlM,EADYx5J,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,IACV;oBACnB6G,MAAM8uC,EAAaiC,YAAAA;gBAAAA,IAEhBmC;gBAEX,MAAM3vI,IAAS,IAAIuvI;gBACnB,IAAIziI;gBACJ,KAAK,MAAMs0H,KAAS1rJ,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAfhW,EAAMmP,IAAAA,GACF36C,EAAMz+G,IAAAA,CAAKikK,OAAAA,KAAYha,EAAMtoJ,KAAAA,IAC7Bg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAaqC,SAAAA;oBACnBv9I,SAAS+wI,EAAM/wI,OAAAA;oBACfy9I,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACPE,SAAS3M,EAAMtoJ,KAAAA;oBACfqD,MAAM;gBAAA,IAEV6jB,EAAOkuB,KAAAA,EAAAA,IAGS,UAAfkzG,EAAMmP,IAAAA,GACP36C,EAAMz+G,IAAAA,CAAKikK,OAAAA,KAAYha,EAAMtoJ,KAAAA,IAC7Bg0B,CAAAA,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,GAAO9oF,IAClCoiI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAayC,OAAAA;oBACnB39I,SAAS+wI,EAAM/wI,OAAAA;oBACfy9I,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACPI,SAAS7M,EAAMtoJ,KAAAA;oBACfqD,MAAM;gBAAA,IAEV6jB,EAAOkuB,KAAAA,EAAAA,IAIXs7G,EAAKK,WAAAA,CAAYzI;gBAGzB,OAAO;oBACHphI,QAAQA,EAAOlnB,KAAAA;oBACfA,OAAO,IAAI6B,KAAKi7G,EAAMz+G,IAAAA,CAAKikK,OAAAA;gBAAAA;YAEnC;YACA,UAAUha,CAAAA,EAAAA;gBACN,OAAO,IAAI+Z,GAAQ;oBAAA,GACZzlK,IAAAA,CAAKg8J,IAAAA;oBACR0F,QAAQ;2BAAI1hK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA;wBAAQhW;qBAAAA;gBAAAA;YAEtC;YACA,IAAIia,CAAAA,EAAShrJ,CAAAA,EAAAA;gBACT,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOuiK,EAAQD,OAAAA;oBACf/qJ,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,IAAIirJ,CAAAA,EAASjrJ,CAAAA,EAAAA;gBACT,OAAO3a,IAAAA,CAAKiiK,SAAAA,CAAU;oBAClBpH,MAAM;oBACNz3J,OAAOwiK,EAAQF,OAAAA;oBACf/qJ,SAASogJ,EAAUh7J,QAAAA,CAAS4a;gBAAAA;YAEpC;YACA,IAAA,UAAIgrJ;gBACA,IAAIn7J,IAAM;gBACV,KAAK,MAAMu4J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAZqB,EAAGlI,IAAAA,IACS,CAAA,SAARrwJ,KAAgBu4J,EAAG3/J,KAAAA,GAAQoH,CAAAA,KAC3BA,CAAAA,IAAMu4J,EAAG3/J,KAAAA,AAAAA;gBAGrB,OAAc,QAAPoH,IAAc,IAAIvF,KAAKuF,KAAO;YACzC;YACA,IAAA,UAAIo7J;gBACA,IAAIrgK,IAAM;gBACV,KAAK,MAAMw9J,KAAM/iK,IAAAA,CAAKg8J,IAAAA,CAAK0F,MAAAA,CACP,UAAZqB,EAAGlI,IAAAA,IACS,CAAA,SAARt1J,KAAgBw9J,EAAG3/J,KAAAA,GAAQmC,CAAAA,KAC3BA,CAAAA,IAAMw9J,EAAG3/J,KAAAA,AAAAA;gBAGrB,OAAc,QAAPmC,IAAc,IAAIN,KAAKM,KAAO;YACzC;QAAA;QAEJkgK,GAAQ7pG,MAAAA,GAAUq9F,CAAAA,IACP,IAAIwM,GAAQ;gBACf/D,QAAQ,EAAA;gBACRD,QAAAA,AAASxI,CAAAA,QAAAA,IAAAA,KAAuC,IAASA,EAAOwI,MAAAA,AAAAA,KAAAA,CAAW;gBAC3E7gI,UAAUy8H,GAAsBoI,OAAAA;gBAAAA,GAC7B/J,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM4M,WAAkB9J;YACpB,OAAO77C,CAAAA,EAAAA;gBAEH,IADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcO,MAAAA,EAAQ;oBACrC,MAAMr+H,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcO,MAAAA;wBACxB4B,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,OAAOO,EAAGt6C,EAAMz+G,IAAAA;YACpB;QAAA;QAEJokK,GAAUjqG,MAAAA,GAAUq9F,CAAAA,IACT,IAAI4M,GAAU;gBACjBjlI,UAAUy8H,GAAsBwI,SAAAA;gBAAAA,GAC7BnK,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM6M,WAAqB/J;YACvB,OAAO77C,CAAAA,EAAAA;gBAEH,IADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcp0J,SAAAA,EAAW;oBACxC,MAAMs2B,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcp0J,SAAAA;wBACxBu2J,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,OAAOO,EAAGt6C,EAAMz+G,IAAAA;YACpB;QAAA;QAEJqkK,GAAalqG,MAAAA,GAAUq9F,CAAAA,IACZ,IAAI6M,GAAa;gBACpBllI,UAAUy8H,GAAsByI,YAAAA;gBAAAA,GAC7BpK,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM8M,WAAgBhK;YAClB,OAAO77C,CAAAA,EAAAA;gBAEH,IADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcQ,IAAAA,EAAM;oBACnC,MAAMt+H,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcQ,IAAAA;wBACxB2B,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,OAAOO,EAAGt6C,EAAMz+G,IAAAA;YACpB;QAAA;QAEJskK,GAAQnqG,MAAAA,GAAUq9F,CAAAA,IACP,IAAI8M,GAAQ;gBACfnlI,UAAUy8H,GAAsB0I,OAAAA;gBAAAA,GAC7BrK,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM+M,WAAejK;YACjB,aAAAp1J;gBACIimB,KAAAA,IAASmrD,YAET/3E,IAAAA,CAAKimK,IAAAA,GAAAA,CAAO;YAChB;YACA,OAAO/lD,CAAAA,EAAAA;gBACH,OAAOs6C,EAAGt6C,EAAMz+G,IAAAA;YACpB;QAAA;QAEJukK,GAAOpqG,MAAAA,GAAUq9F,CAAAA,IACN,IAAI+M,GAAO;gBACdplI,UAAUy8H,GAAsB2I,MAAAA;gBAAAA,GAC7BtK,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMiN,WAAmBnK;YACrB,aAAAp1J;gBACIimB,KAAAA,IAASmrD,YAET/3E,IAAAA,CAAKmmK,QAAAA,GAAAA,CAAW;YACpB;YACA,OAAOjmD,CAAAA,EAAAA;gBACH,OAAOs6C,EAAGt6C,EAAMz+G,IAAAA;YACpB;QAAA;QAEJykK,GAAWtqG,MAAAA,GAAUq9F,CAAAA,IACV,IAAIiN,GAAW;gBAClBtlI,UAAUy8H,GAAsB6I,UAAAA;gBAAAA,GAC7BxK,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMmN,WAAiBrK;YACnB,OAAO77C,CAAAA,EAAAA;gBACH,MAAM9oF,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;gBAMjC,OALAs5C,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcmR,KAAAA;oBACxBhP,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;YACX;QAAA;QAEJmM,GAASxqG,MAAAA,GAAUq9F,CAAAA,IACR,IAAImN,GAAS;gBAChBxlI,UAAUy8H,GAAsB+I,QAAAA;gBAAAA,GAC7B1K,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMqN,WAAgBvK;YAClB,OAAO77C,CAAAA,EAAAA;gBAEH,IADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcp0J,SAAAA,EAAW;oBACxC,MAAMs2B,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcqR,IAAAA;wBACxBlP,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,OAAOO,EAAGt6C,EAAMz+G,IAAAA;YACpB;QAAA;QAEJ6kK,GAAQ1qG,MAAAA,GAAUq9F,CAAAA,IACP,IAAIqN,GAAQ;gBACf1lI,UAAUy8H,GAAsBiJ,OAAAA;gBAAAA,GAC7B5K,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMwF,WAAiB1C;YACnB,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAG,QAAE9M,CAAAA,EAAAA,GAAWtqB,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C,IAC3Cs9C,IAAMx9J,IAAAA,CAAKg8J,IAAAA;gBACjB,IAAI5kI,EAAI+kI,UAAAA,KAAejH,EAAcpqJ,KAAAA,EAMjC,OALA0uJ,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcpqJ,KAAAA;oBACxBusJ,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;gBAEX,IAAwB,SAApBuD,EAAIgJ,WAAAA,EAAsB;oBAC1B,MAAM7E,IAASvqI,EAAI31B,IAAAA,CAAKnB,MAAAA,GAASk9J,EAAIgJ,WAAAA,CAAYpjK,KAAAA,EAC3Cw+J,IAAWxqI,EAAI31B,IAAAA,CAAKnB,MAAAA,GAASk9J,EAAIgJ,WAAAA,CAAYpjK,KAAAA;oBAC/Cu+J,CAAAA,KAAUC,CAAAA,KACVpI,CAAAA,EAAkBpiI,GAAK;wBACnB2vF,MAAM46C,IAAS9L,EAAayC,OAAAA,GAAUzC,EAAaqC,SAAAA;wBACnDG,SAAUuJ,IAAWpE,EAAIgJ,WAAAA,CAAYpjK,KAAAA,GAAAA,KAAQtC;wBAC7Cy3J,SAAUoJ,IAASnE,EAAIgJ,WAAAA,CAAYpjK,KAAAA,GAAAA,KAAQtC;wBAC3C2F,MAAM;wBACN2xJ,WAAAA,CAAW;wBACXD,OAAAA,CAAO;wBACPx9I,SAAS6iJ,EAAIgJ,WAAAA,CAAY7rJ,OAAAA;oBAAAA,IAE7B2P,EAAOkuB,KAAAA,EAAAA;gBAEf;gBA2BA,IA1BsB,SAAlBglH,EAAIxnF,SAAAA,IACA5+C,EAAI31B,IAAAA,CAAKnB,MAAAA,GAASk9J,EAAIxnF,SAAAA,CAAU5yE,KAAAA,IAChCo2J,CAAAA,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAaqC,SAAAA;oBACnBG,SAASmF,EAAIxnF,SAAAA,CAAU5yE,KAAAA;oBACvBqD,MAAM;oBACN2xJ,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACPx9I,SAAS6iJ,EAAIxnF,SAAAA,CAAUr7D,OAAAA;gBAAAA,IAE3B2P,EAAOkuB,KAAAA,EAAAA,GAGO,SAAlBglH,EAAIoF,SAAAA,IACAxrI,EAAI31B,IAAAA,CAAKnB,MAAAA,GAASk9J,EAAIoF,SAAAA,CAAUx/J,KAAAA,IAChCo2J,CAAAA,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAayC,OAAAA;oBACnBC,SAASiF,EAAIoF,SAAAA,CAAUx/J,KAAAA;oBACvBqD,MAAM;oBACN2xJ,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACPx9I,SAAS6iJ,EAAIoF,SAAAA,CAAUjoJ,OAAAA;gBAAAA,IAE3B2P,EAAOkuB,KAAAA,EAAAA,GAGXphB,EAAIsiI,MAAAA,CAAO10F,KAAAA,EACX,OAAOzgE,QAAQ6+D,GAAAA,CAAI;uBAAIhsC,EAAI31B,IAAAA;iBAAAA,CAAMxB,GAAAA,CAAI,CAACC,GAAMM,IACjCg9J,EAAI/2J,IAAAA,CAAK81J,WAAAA,CAAY,IAAInB,EAAmBhkI,GAAKl3B,GAAMk3B,EAAI3N,IAAAA,EAAMjpB,MACxE2sB,IAAAA,CAAM/hB,CAAAA,IACCyuJ,EAAYE,UAAAA,CAAWzvI,GAAQlf;gBAG9C,MAAMA,IAAS;uBAAIgsB,EAAI31B,IAAAA;iBAAAA,CAAMxB,GAAAA,CAAI,CAACC,GAAMM,IAC7Bg9J,EAAI/2J,IAAAA,CAAK41J,UAAAA,CAAW,IAAIjB,EAAmBhkI,GAAKl3B,GAAMk3B,EAAI3N,IAAAA,EAAMjpB;gBAE3E,OAAOq5J,EAAYE,UAAAA,CAAWzvI,GAAQlf;YAC1C;YACA,IAAA,UAAIq7J;gBACA,OAAOzmK,IAAAA,CAAKg8J,IAAAA,CAAKv1J,IACrB;YAAA;YACA,IAAIuvE,CAAAA,EAAWr7D,CAAAA,EAAAA;gBACX,OAAO,IAAI8jJ,GAAS;oBAAA,GACbz+J,IAAAA,CAAKg8J,IAAAA;oBACRhmF,WAAW;wBAAE5yE,OAAO4yE;wBAAWr7D,SAASogJ,EAAUh7J,QAAAA,CAAS4a;oBAAAA;gBAAAA;YAEnE;YACA,IAAIioJ,CAAAA,EAAWjoJ,CAAAA,EAAAA;gBACX,OAAO,IAAI8jJ,GAAS;oBAAA,GACbz+J,IAAAA,CAAKg8J,IAAAA;oBACR4G,WAAW;wBAAEx/J,OAAOw/J;wBAAWjoJ,SAASogJ,EAAUh7J,QAAAA,CAAS4a;oBAAAA;gBAAAA;YAEnE;YACA,OAAOhD,CAAAA,EAAKgD,CAAAA,EAAAA;gBACR,OAAO,IAAI8jJ,GAAS;oBAAA,GACbz+J,IAAAA,CAAKg8J,IAAAA;oBACRwK,aAAa;wBAAEpjK,OAAOuU;wBAAKgD,SAASogJ,EAAUh7J,QAAAA,CAAS4a;oBAAAA;gBAAAA;YAE/D;YACA,SAASA,CAAAA,EAAAA;gBACL,OAAO3a,IAAAA,CAAKwK,GAAAA,CAAI,GAAGmQ;YACvB;QAAA;QAYJ,SAAS+rJ,GAAetJ,CAAAA;YACpB,IAAIA,aAAkBuJ,IAAW;gBAC7B,MAAMC,IAAW,CAAC;gBAClB,IAAK,MAAMtkK,KAAO86J,EAAOphF,KAAAA,CAAO;oBAC5B,MAAM6qF,IAAczJ,EAAOphF,KAAAA,CAAM15E,EAAAA;oBACjCskK,CAAAA,CAAStkK,EAAAA,GAAOi8J,GAAY3iG,MAAAA,CAAO8qG,GAAeG;gBACtD;gBACA,OAAO,IAAIF,GAAU;oBAAA,GACdvJ,EAAOpB,IAAAA;oBACVhgF,OAAO,IAAM4qF;gBAAAA;YAErB;YACK,OAAIxJ,aAAkBqB,KAChB,IAAIA,GAAS;gBAAA,GACbrB,EAAOpB,IAAAA;gBACVv1J,MAAMigK,GAAetJ,EAAOqJ,OAAAA;YAAAA,KAG3BrJ,aAAkBmB,KAChBA,GAAY3iG,MAAAA,CAAO8qG,GAAetJ,EAAO0J,MAAAA,OAE3C1J,aAAkBoB,KAChBA,GAAY5iG,MAAAA,CAAO8qG,GAAetJ,EAAO0J,MAAAA,OAE3C1J,aAAkB2J,KAChBA,GAASnrG,MAAAA,CAAOwhG,EAAO30B,KAAAA,CAAMxoI,GAAAA,CAAKC,CAAAA,IAASwmK,GAAexmK,OAG1Dk9J;QAEf;QAxCAqB,GAAS7iG,MAAAA,GAAS,CAACwhG,GAAQnE,IAChB,IAAIwF,GAAS;gBAChBh4J,MAAM22J;gBACNpnF,WAAW;gBACX4sF,WAAW;gBACX4D,aAAa;gBACb5lI,UAAUy8H,GAAsBoB,QAAAA;gBAAAA,GAC7B/C,EAAoBzC,EAAAA;YAAAA;QAkC/B,MAAM0N,WAAkB5K;YACpB,aAAAp1J;gBACIimB,KAAAA,IAASmrD,YACT/3E,IAAAA,CAAKgnK,OAAAA,GAAU,MAKfhnK,IAAAA,CAAKinK,SAAAA,GAAYjnK,IAAAA,CAAKknK,WAAAA,EAqCtBlnK,IAAAA,CAAKmnK,OAAAA,GAAUnnK,IAAAA,CAAKonK,MACxB;YAAA;YACA,aAAAC;gBACI,IAAqB,SAAjBrnK,IAAAA,CAAKgnK,OAAAA,EACL,OAAOhnK,IAAAA,CAAKgnK,OAAAA;gBAChB,MAAMhrF,IAAQh8E,IAAAA,CAAKg8J,IAAAA,CAAKhgF,KAAAA,IAClBz1E,IAAOutJ,EAAKS,UAAAA,CAAWv4E;gBAC7B,OAAQh8E,IAAAA,CAAKgnK,OAAAA,GAAU;oBAAEhrF,OAAAA;oBAAOz1E,MAAAA;gBAAAA;YACpC;YACA,OAAO25G,CAAAA,EAAAA;gBAEH,IADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcn0I,MAAAA,EAAQ;oBACrC,MAAMqW,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcn0I,MAAAA;wBACxBs2I,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,MAAA,EAAM,QAAE3vI,CAAAA,EAAM,KAAE8M,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C,IAAAA,EAC3C,OAAElkC,CAAAA,EAAOz1E,MAAM+gK,CAAAA,EAAAA,GAActnK,IAAAA,CAAKqnK,UAAAA,IAClCE,IAAY,EAAA;gBAClB,IAAA,CAAMvnK,CAAAA,IAAAA,CAAKg8J,IAAAA,CAAKwL,QAAAA,YAAoBpB,MACN,YAA1BpmK,IAAAA,CAAKg8J,IAAAA,CAAKyL,WAAAA,AAAAA,GACV,IAAK,MAAMnlK,KAAO80B,EAAI31B,IAAAA,CACb6lK,EAAUrmJ,QAAAA,CAAS3e,MACpBilK,EAAU5nK,IAAAA,CAAK2C;gBAI3B,MAAMmvE,IAAQ,EAAA;gBACd,KAAK,MAAMnvE,KAAOglK,EAAW;oBACzB,MAAMI,IAAe1rF,CAAAA,CAAM15E,EAAAA,EACrBc,IAAQg0B,EAAI31B,IAAAA,CAAKa,EAAAA;oBACvBmvE,EAAM9xE,IAAAA,CAAK;wBACP2C,KAAK;4BAAEgoB,QAAQ;4BAASlnB,OAAOd;wBAAAA;wBAC/Bc,OAAOskK,EAAapL,MAAAA,CAAO,IAAIlB,EAAmBhkI,GAAKh0B,GAAOg0B,EAAI3N,IAAAA,EAAMnnB;wBACxEg4J,WAAWh4J,KAAO80B,EAAI31B,IAAAA;oBAAAA;gBAE9B;gBACA,IAAIzB,IAAAA,CAAKg8J,IAAAA,CAAKwL,QAAAA,YAAoBpB,IAAU;oBACxC,MAAMqB,IAAcznK,IAAAA,CAAKg8J,IAAAA,CAAKyL,WAAAA;oBAC9B,IAAoB,kBAAhBA,GACA,KAAK,MAAMnlK,KAAOilK,EACd91F,EAAM9xE,IAAAA,CAAK;wBACP2C,KAAK;4BAAEgoB,QAAQ;4BAASlnB,OAAOd;wBAAAA;wBAC/Bc,OAAO;4BAAEknB,QAAQ;4BAASlnB,OAAOg0B,EAAI31B,IAAAA,CAAKa,EAAAA;wBAAAA;oBAAAA;yBAIjD,IAAoB,aAAhBmlK,GACDF,EAAUjnK,MAAAA,GAAS,KACnBk5J,CAAAA,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAa2B,iBAAAA;wBACnBjxJ,MAAMghK;oBAAAA,IAEVj9I,EAAOkuB,KAAAA,EAAAA;yBAGV,IAAoB,YAAhBivH,GAEL,MAAM,IAAIthK,MAAM;gBAExB,OACK;oBAED,MAAMqhK,IAAWxnK,IAAAA,CAAKg8J,IAAAA,CAAKwL,QAAAA;oBAC3B,KAAK,MAAMllK,KAAOilK,EAAW;wBACzB,MAAMnkK,IAAQg0B,EAAI31B,IAAAA,CAAKa,EAAAA;wBACvBmvE,EAAM9xE,IAAAA,CAAK;4BACP2C,KAAK;gCAAEgoB,QAAQ;gCAASlnB,OAAOd;4BAAAA;4BAC/Bc,OAAOokK,EAASlL,MAAAA,CAAO,IAAIlB,EAAmBhkI,GAAKh0B,GAAOg0B,EAAI3N,IAAAA,EAAMnnB;4BAEpEg4J,WAAWh4J,KAAO80B,EAAI31B,IAAAA;wBAAAA;oBAE9B;gBACJ;gBACA,OAAI21B,EAAIsiI,MAAAA,CAAO10F,KAAAA,GACJzgE,QAAQC,OAAAA,GACV2oB,IAAAA,CAAK63C;oBACN,MAAMm1F,IAAY,EAAA;oBAClB,KAAK,MAAM5oF,KAAQE,EAAO;wBACtB,MAAMnvE,IAAAA,MAAYivE,EAAKjvE,GAAAA,EACjBc,IAAAA,MAAcmuE,EAAKnuE,KAAAA;wBACzB+2J,EAAUx6J,IAAAA,CAAK;4BACX2C,KAAAA;4BACAc,OAAAA;4BACAk3J,WAAW/oF,EAAK+oF,SAAAA;wBAAAA;oBAExB;oBACA,OAAOH;gBAAS,GAEfhtI,IAAAA,CAAMgtI,CAAAA,IACAN,EAAYO,eAAAA,CAAgB9vI,GAAQ6vI,MAIxCN,EAAYO,eAAAA,CAAgB9vI,GAAQmnD;YAEnD;YACA,IAAA,QAAIuK;gBACA,OAAOh8E,IAAAA,CAAKg8J,IAAAA,CAAKhgF,KAAAA;YACrB;YACA,OAAOrhE,CAAAA,EAAAA;gBAEH,OADAogJ,EAAUI,QAAAA,EACH,IAAIwL,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRyL,aAAa;oBAAA,GAAA,KACG3mK,MAAZ6Z,IACE;wBACEw8I,UAAU,CAACV,GAAOr/H;4BACd,IAAI9tB,GAAIG,GAAIE,GAAIi+J;4BAChB,MAAM/O,IAAgI,SAAhHlvJ,CAAAA,IAA0C,SAApCF,CAAAA,IAAAA,AAAMH,CAAAA,IAAKtJ,IAAAA,CAAKg8J,IAAAA,AAAAA,EAAM7E,QAAAA,AAAAA,KAAAA,KAA6B,MAAP1tJ,IAAAA,KAAgB,IAASA,EAAGzG,IAAAA,CAAKsG,GAAImtJ,GAAOr/H,GAAKzc,OAAAA,AAAAA,KAAAA,KAA4B,MAAPhR,IAAgBA,IAAKytB,EAAIyhI,YAAAA;4BACvK,OAAmB,wBAAfpC,EAAM1vC,IAAAA,GACC;gCACHpsG,SAAwD,SAA9CitJ,CAAAA,IAAK7M,EAAUI,QAAAA,CAASxgJ,GAASA,OAAAA,AAAAA,KAAAA,KAA4B,MAAPitJ,IAAgBA,IAAK/O;4BAAAA,IAEtF;gCACHl+I,SAASk+I;4BAAAA;wBACZ;oBAAA,IAGP,CAAC,CAAA;gBAAA;YAEf;YACA,QAAAgP;gBACI,OAAO,IAAIlB,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRyL,aAAa;gBAAA;YAErB;YACA,cAAAP;gBACI,OAAO,IAAIP,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRyL,aAAa;gBAAA;YAErB;YAkBA,OAAOK,CAAAA,EAAAA;gBACH,OAAO,IAAInB,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRhgF,OAAO,IAAM,CAAA;4BAAA,GACNh8E,IAAAA,CAAKg8J,IAAAA,CAAKhgF,KAAAA,EAAAA;4BAAAA,GACV8rF,CAAAA;wBAAAA,CAAAA;gBAAAA;YAGf;YAMA,MAAME,CAAAA,EAAAA;gBAUF,OATe,IAAIrB,GAAU;oBACzBc,aAAaO,EAAQhM,IAAAA,CAAKyL,WAAAA;oBAC1BD,UAAUQ,EAAQhM,IAAAA,CAAKwL,QAAAA;oBACvBxrF,OAAO,IAAM,CAAA;4BAAA,GACNh8E,IAAAA,CAAKg8J,IAAAA,CAAKhgF,KAAAA,EAAAA;4BAAAA,GACVgsF,EAAQhM,IAAAA,CAAKhgF,KAAAA,EAAAA;wBAAAA,CAAAA;oBAEpBp7C,UAAUy8H,GAAsBsJ,SAAAA;gBAAAA;YAGxC;YAoCA,OAAOrkK,CAAAA,EAAK86J,CAAAA,EAAAA;gBACR,OAAOp9J,IAAAA,CAAKmnK,OAAAA,CAAQ;oBAAE,CAAC7kK,EAAAA,EAAM86J;gBAAAA;YACjC;YAsBA,SAAS5xJ,CAAAA,EAAAA;gBACL,OAAO,IAAIm7J,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRwL,UAAUh8J;gBAAAA;YAElB;YACA,KAAKi/D,CAAAA,EAAAA;gBACD,MAAMuR,IAAQ,CAAC;gBAMf,OALA83E,EAAKS,UAAAA,CAAW9pF,GAAMtsB,OAAAA,CAAS77C,CAAAA;oBACvBmoE,CAAAA,CAAKnoE,EAAAA,IAAQtC,IAAAA,CAAKg8E,KAAAA,CAAM15E,EAAAA,IACxB05E,CAAAA,CAAAA,CAAM15E,EAAAA,GAAOtC,IAAAA,CAAKg8E,KAAAA,CAAM15E,EAAAA,AAAAA;gBAC5B,IAEG,IAAIqkK,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRhgF,OAAO,IAAMA;gBAAAA;YAErB;YACA,KAAKvR,CAAAA,EAAAA;gBACD,MAAMuR,IAAQ,CAAC;gBAMf,OALA83E,EAAKS,UAAAA,CAAWv0J,IAAAA,CAAKg8E,KAAAA,EAAO79B,OAAAA,CAAS77C,CAAAA;oBAC5BmoE,CAAAA,CAAKnoE,EAAAA,IACN05E,CAAAA,CAAAA,CAAM15E,EAAAA,GAAOtC,IAAAA,CAAKg8E,KAAAA,CAAM15E,EAAAA,AAAAA;gBAC5B,IAEG,IAAIqkK,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRhgF,OAAO,IAAMA;gBAAAA;YAErB;YAIA,cAAAmsF;gBACI,OAAOzB,GAAe1mK,IAAAA;YAC1B;YACA,QAAQyqE,CAAAA,EAAAA;gBACJ,MAAMm8F,IAAW,CAAC;gBAUlB,OATA9S,EAAKS,UAAAA,CAAWv0J,IAAAA,CAAKg8E,KAAAA,EAAO79B,OAAAA,CAAS77C,CAAAA;oBACjC,MAAMukK,IAAc7mK,IAAAA,CAAKg8E,KAAAA,CAAM15E,EAAAA;oBAC3BmoE,KAAAA,CAASA,CAAAA,CAAKnoE,EAAAA,GACdskK,CAAAA,CAAStkK,EAAAA,GAAOukK,IAGhBD,CAAAA,CAAStkK,EAAAA,GAAOukK,EAAYnJ,QAAAA;gBAChC,IAEG,IAAIiJ,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRhgF,OAAO,IAAM4qF;gBAAAA;YAErB;YACA,SAASn8F,CAAAA,EAAAA;gBACL,MAAMm8F,IAAW,CAAC;gBAclB,OAbA9S,EAAKS,UAAAA,CAAWv0J,IAAAA,CAAKg8E,KAAAA,EAAO79B,OAAAA,CAAS77C,CAAAA;oBACjC,IAAImoE,KAAAA,CAASA,CAAAA,CAAKnoE,EAAAA,EACdskK,CAAAA,CAAStkK,EAAAA,GAAOtC,IAAAA,CAAKg8E,KAAAA,CAAM15E,EAAAA;yBAE1B;wBAED,IAAIgmK,IADgBtoK,IAAAA,CAAKg8E,KAAAA,CAAM15E,EAAAA;wBAE/B,MAAOgmK,aAAoB/J,IACvB+J,IAAWA,EAAStM,IAAAA,CAAKiD,SAAAA;wBAE7B2H,CAAAA,CAAStkK,EAAAA,GAAOgmK;oBACpB;gBAAA,IAEG,IAAI3B,GAAU;oBAAA,GACd3mK,IAAAA,CAAKg8J,IAAAA;oBACRhgF,OAAO,IAAM4qF;gBAAAA;YAErB;YACA,QAAA2B;gBACI,OAAOC,GAAc1U,EAAKS,UAAAA,CAAWv0J,IAAAA,CAAKg8E,KAAAA;YAC9C;QAAA;QAEJ2qF,GAAU/qG,MAAAA,GAAS,CAACogB,GAAOi9E,IAChB,IAAI0N,GAAU;gBACjB3qF,OAAO,IAAMA;gBACbyrF,aAAa;gBACbD,UAAUpB,GAASxqG,MAAAA;gBACnBh7B,UAAUy8H,GAAsBsJ,SAAAA;gBAAAA,GAC7BjL,EAAoBzC,EAAAA;YAAAA,IAG/B0N,GAAU8B,YAAAA,GAAe,CAACzsF,GAAOi9E,IACtB,IAAI0N,GAAU;gBACjB3qF,OAAO,IAAMA;gBACbyrF,aAAa;gBACbD,UAAUpB,GAASxqG,MAAAA;gBACnBh7B,UAAUy8H,GAAsBsJ,SAAAA;gBAAAA,GAC7BjL,EAAoBzC,EAAAA;YAAAA,IAG/B0N,GAAU+B,UAAAA,GAAa,CAAC1sF,GAAOi9E,IACpB,IAAI0N,GAAU;gBACjB3qF,OAAAA;gBACAyrF,aAAa;gBACbD,UAAUpB,GAASxqG,MAAAA;gBACnBh7B,UAAUy8H,GAAsBsJ,SAAAA;gBAAAA,GAC7BjL,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM2F,WAAiB7C;YACnB,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C,IACnCjnG,IAAUjZ,IAAAA,CAAKg8J,IAAAA,CAAK/iJ,OAAAA;gBAuB1B,IAAIme,EAAIsiI,MAAAA,CAAO10F,KAAAA,EACX,OAAOzgE,QAAQ6+D,GAAAA,CAAInqD,EAAQhZ,GAAAA,CAAI+kE,OAAO25F;oBAClC,MAAMgK,IAAW;wBAAA,GACVvxI,CAAAA;wBACHsiI,QAAQ;4BAAA,GACDtiI,EAAIsiI,MAAAA;4BACP1D,QAAQ,EAAA;wBAAA;wBAEZ9lH,QAAQ;oBAAA;oBAEZ,OAAO;wBACH9kC,QAAAA,MAAcuzJ,EAAOpC,WAAAA,CAAY;4BAC7B96J,MAAM21B,EAAI31B,IAAAA;4BACVgoB,MAAM2N,EAAI3N,IAAAA;4BACVymB,QAAQy4H;wBAAAA;wBAEZvxI,KAAKuxI;oBAAAA;gBACR,IACDx7I,IAAAA,CAxCR,SAAuB0G,CAAAA;oBAEnB,KAAK,MAAMzoB,KAAUyoB,EACjB,IAA6B,YAAzBzoB,EAAOA,MAAAA,CAAOkf,MAAAA,EACd,OAAOlf,EAAOA,MAAAA;oBAGtB,KAAK,MAAMA,KAAUyoB,EACjB,IAA6B,YAAzBzoB,EAAOA,MAAAA,CAAOkf,MAAAA,EAGd,OADA8M,EAAIsiI,MAAAA,CAAO1D,MAAAA,CAAOr2J,IAAAA,IAAQyL,EAAOgsB,GAAAA,CAAIsiI,MAAAA,CAAO1D,MAAAA,GACrC5qJ,EAAOA,MAAAA;oBAItB,MAAMyrJ,IAAchjI,EAAQ5zB,GAAAA,CAAKmL,CAAAA,IAAW,IAAI0qJ,EAAS1qJ,EAAOgsB,GAAAA,CAAIsiI,MAAAA,CAAO1D,MAAAA;oBAK3E,OAJAwD,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAa4B,aAAAA;wBACnBZ,aAAAA;oBAAAA,IAEGoD;gBACX;gBAqBK;oBACD,IAAIzhH;oBACJ,MAAMw9G,IAAS,EAAA;oBACf,KAAK,MAAM2I,KAAU1lJ,EAAS;wBAC1B,MAAM0vJ,IAAW;4BAAA,GACVvxI,CAAAA;4BACHsiI,QAAQ;gCAAA,GACDtiI,EAAIsiI,MAAAA;gCACP1D,QAAQ,EAAA;4BAAA;4BAEZ9lH,QAAQ;wBAAA,GAEN9kC,IAASuzJ,EAAOtC,UAAAA,CAAW;4BAC7B56J,MAAM21B,EAAI31B,IAAAA;4BACVgoB,MAAM2N,EAAI3N,IAAAA;4BACVymB,QAAQy4H;wBAAAA;wBAEZ,IAAsB,YAAlBv9J,EAAOkf,MAAAA,EACP,OAAOlf;wBAEgB,YAAlBA,EAAOkf,MAAAA,IAAuBkuB,KACnCA,CAAAA,IAAQ;4BAAEptC,QAAAA;4BAAQgsB,KAAKuxI;wBAAAA,CAAAA,GAEvBA,EAASjP,MAAAA,CAAO1D,MAAAA,CAAO11J,MAAAA,IACvB01J,EAAOr2J,IAAAA,CAAKgpK,EAASjP,MAAAA,CAAO1D,MAAAA;oBAEpC;oBACA,IAAIx9G,GAEA,OADAphB,EAAIsiI,MAAAA,CAAO1D,MAAAA,CAAOr2J,IAAAA,IAAQ64C,EAAMphB,GAAAA,CAAIsiI,MAAAA,CAAO1D,MAAAA,GACpCx9G,EAAMptC,MAAAA;oBAEjB,MAAMyrJ,IAAcb,EAAO/1J,GAAAA,CAAK+1J,CAAAA,IAAW,IAAIF,EAASE;oBAKxD,OAJAwD,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAa4B,aAAAA;wBACnBZ,aAAAA;oBAAAA,IAEGoD;gBACX;YACJ;YACA,IAAA,UAAIhhJ;gBACA,OAAOjZ,IAAAA,CAAKg8J,IAAAA,CAAK/iJ,OACrB;YAAA;QAAA;QAEJ2lJ,GAAShjG,MAAAA,GAAS,CAAC5U,GAAOiyG,IACf,IAAI2F,GAAS;gBAChB3lJ,SAAS+tC;gBACTpmB,UAAUy8H,GAAsBuB,QAAAA;gBAAAA,GAC7BlD,EAAoBzC,EAAAA;YAAAA;QAU/B,MAAM2P,KAAoBniK,CAAAA,IAClBA,aAAgBoiK,KACTD,GAAiBniK,EAAK22J,MAAAA,IAExB32J,aAAgB02J,KACdyL,GAAiBniK,EAAKw4J,SAAAA,MAExBx4J,aAAgBqiK,KACd;gBAACriK,EAAKrD,KAAAA;aAAAA,GAERqD,aAAgBsiK,KACdtiK,EAAKwS,OAAAA,GAEPxS,aAAgBuiK,KAEdlV,EAAKW,YAAAA,CAAahuJ,EAAKwiK,IAAAA,IAEzBxiK,aAAgBu4J,KACd4J,GAAiBniK,EAAKu1J,IAAAA,CAAKiD,SAAAA,IAE7Bx4J,aAAgBq/J,KACd;gBAAA,KAAChlK;aAAAA,GAEH2F,aAAgBs/J,KACd;gBAAC;aAAA,GAEHt/J,aAAgB83J,KACd;gBAAA,KAACz9J;mBAAc8nK,GAAiBniK,EAAKqgK,MAAAA;aAAAA,GAEvCrgK,aAAgB+3J,KACd;gBAAC;mBAASoK,GAAiBniK,EAAKqgK,MAAAA;aAAAA,GAElCrgK,aAAgB04J,MAGhB14J,aAAgBg5J,KAFdmJ,GAAiBniK,EAAKqgK,MAAAA,MAKxBrgK,aAAgB44J,KACduJ,GAAiBniK,EAAKu1J,IAAAA,CAAKiD,SAAAA,IAG3B,EAAA;QAGf,MAAMiK,WAA8BnN;YAChC,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACzC,IAAI9oF,EAAI+kI,UAAAA,KAAejH,EAAcn0I,MAAAA,EAMjC,OALAy4I,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcn0I,MAAAA;oBACxBs2I,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;gBAEX,MAAMkP,IAAgBnpK,IAAAA,CAAKmpK,aAAAA,EACrBC,IAAqBhyI,EAAI31B,IAAAA,CAAK0nK,EAAAA,EAC9BxK,IAAS3+J,IAAAA,CAAKqpK,UAAAA,CAAW1mK,GAAAA,CAAIymK;gBACnC,OAAKzK,IAQDvnI,EAAIsiI,MAAAA,CAAO10F,KAAAA,GACJ25F,EAAOpC,WAAAA,CAAY;oBACtB96J,MAAM21B,EAAI31B,IAAAA;oBACVgoB,MAAM2N,EAAI3N,IAAAA;oBACVymB,QAAQ9Y;gBAAAA,KAILunI,EAAOtC,UAAAA,CAAW;oBACrB56J,MAAM21B,EAAI31B,IAAAA;oBACVgoB,MAAM2N,EAAI3N,IAAAA;oBACVymB,QAAQ9Y;gBAAAA,KAlBZoiI,CAAAA,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAa6B,2BAAAA;oBACnBz+I,SAASlP,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAKqpK,UAAAA,CAAW9iK,IAAAA;oBACpCkjB,MAAM;wBAAC0/I;qBAAAA;gBAAAA,IAEJlP,CAAAA;YAgBf;YACA,IAAA,gBAAIkP;gBACA,OAAOnpK,IAAAA,CAAKg8J,IAAAA,CAAKmN,aACrB;YAAA;YACA,IAAA,UAAIlwJ;gBACA,OAAOjZ,IAAAA,CAAKg8J,IAAAA,CAAK/iJ,OACrB;YAAA;YACA,IAAA,aAAIowJ;gBACA,OAAOrpK,IAAAA,CAAKg8J,IAAAA,CAAKqN,UACrB;YAAA;YASA,OAAA,OAAcF,CAAAA,EAAelwJ,CAAAA,EAASggJ,CAAAA,EAAAA;gBAElC,MAAMoQ,IAAa,IAAI/6I;gBAEvB,KAAK,MAAM7nB,KAAQwS,EAAS;oBACxB,MAAMqwJ,IAAsBV,GAAiBniK,EAAKu1E,KAAAA,CAAMmtF,EAAAA;oBACxD,IAAA,CAAKG,EAAoBhpK,MAAAA,EACrB,MAAM,IAAI6F,MAAM,CAAA,gCAAA,EAAmCgjK,EAAAA,iDAAAA,CAAAA;oBAEvD,KAAK,MAAM/lK,KAASkmK,EAAqB;wBACrC,IAAID,EAAWtxJ,GAAAA,CAAI3U,IACf,MAAM,IAAI+C,MAAM,CAAA,uBAAA,EAA0BwO,OAAOw0J,GAAAA,qBAAAA,EAAsCx0J,OAAOvR,IAAAA;wBAElGimK,EAAWr+I,GAAAA,CAAI5nB,GAAOqD;oBAC1B;gBACJ;gBACA,OAAO,IAAIyiK,GAAsB;oBAC7BtoI,UAAUy8H,GAAsB6L,qBAAAA;oBAChCC,eAAAA;oBACAlwJ,SAAAA;oBACAowJ,YAAAA;oBAAAA,GACG3N,EAAoBzC,EAAAA;gBAAAA;YAE/B;QAAA;QAEJ,SAASsQ,GAAYnnK,CAAAA,EAAGkQ,CAAAA;YACpB,MAAMk3J,IAAQrU,EAAc/yJ,IACtBqnK,IAAQtU,EAAc7iJ;YAC5B,IAAIlQ,MAAMkQ,GACN,OAAO;gBAAEo3J,OAAAA,CAAO;gBAAMjoK,MAAMW;YAAAA;YAE3B,IAAIonK,MAAUtU,EAAcn0I,MAAAA,IAAU0oJ,MAAUvU,EAAcn0I,MAAAA,EAAQ;gBACvE,MAAM4oJ,IAAQ7V,EAAKS,UAAAA,CAAWjiJ,IACxBs3J,IAAa9V,EACdS,UAAAA,CAAWnyJ,GACX4F,MAAAA,CAAQ1F,CAAAA,IAAAA,OAAQqnK,EAAMlhK,OAAAA,CAAQnG,KAC7B0e,IAAS;oBAAA,GAAK5e,CAAAA;oBAAAA,GAAMkQ,CAAAA;gBAAAA;gBAC1B,KAAK,MAAMhQ,KAAOsnK,EAAY;oBAC1B,MAAMC,IAAcN,GAAYnnK,CAAAA,CAAEE,EAAAA,EAAMgQ,CAAAA,CAAEhQ,EAAAA;oBAC1C,IAAA,CAAKunK,EAAYH,KAAAA,EACb,OAAO;wBAAEA,OAAAA,CAAO;oBAAA;oBAEpB1oJ,CAAAA,CAAO1e,EAAAA,GAAOunK,EAAYpoK,IAC9B;gBAAA;gBACA,OAAO;oBAAEioK,OAAAA,CAAO;oBAAMjoK,MAAMuf;gBAAAA;YAChC;YACK,IAAIwoJ,MAAUtU,EAAcpqJ,KAAAA,IAAS2+J,MAAUvU,EAAcpqJ,KAAAA,EAAO;gBACrE,IAAI1I,EAAE9B,MAAAA,KAAWgS,EAAEhS,MAAAA,EACf,OAAO;oBAAEopK,OAAAA,CAAO;gBAAA;gBAEpB,MAAMI,IAAW,EAAA;gBACjB,IAAK,IAAIt+J,IAAQ,GAAGA,IAAQpJ,EAAE9B,MAAAA,EAAQkL,IAAS;oBAC3C,MAEMq+J,IAAcN,GAFNnnK,CAAAA,CAAEoJ,EAAAA,EACF8G,CAAAA,CAAE9G,EAAAA;oBAEhB,IAAA,CAAKq+J,EAAYH,KAAAA,EACb,OAAO;wBAAEA,OAAAA,CAAO;oBAAA;oBAEpBI,EAASnqK,IAAAA,CAAKkqK,EAAYpoK,IAAAA;gBAC9B;gBACA,OAAO;oBAAEioK,OAAAA,CAAO;oBAAMjoK,MAAMqoK;gBAAAA;YAChC;YACK,OAAIN,MAAUtU,EAAcU,IAAAA,IAC7B6T,MAAUvU,EAAcU,IAAAA,IAAAA,CACvBxzJ,KAAAA,CAAOkQ,IACD;gBAAEo3J,OAAAA,CAAO;gBAAMjoK,MAAMW;YAAAA,IAGrB;gBAAEsnK,OAAAA,CAAO;YAAA;QAExB;QACA,MAAM5K,WAAwB/C;YAC1B,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,QAAE51F,CAAAA,EAAM,KAAE8M,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C,IAC3C6pD,IAAe,CAACC,GAAYC;oBAC9B,IAAIxP,EAAUuP,MAAevP,EAAUwP,IACnC,OAAOhQ;oBAEX,MAAMiQ,IAASX,GAAYS,EAAW5mK,KAAAA,EAAO6mK,EAAY7mK,KAAAA;oBACzD,OAAK8mK,EAAOR,KAAAA,GAAAA,CAAAA,AAMRhP,CAAAA,EAAQsP,MAAetP,EAAQuP,EAAAA,KAC/B3/I,EAAOkuB,KAAAA,IAEJ;wBAAEluB,QAAQA,EAAOlnB,KAAAA;wBAAOA,OAAO8mK,EAAOzoK,IAAAA;oBAAAA,CAAAA,IARzC+3J,CAAAA,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAa4C,0BAAAA;oBAAAA,IAEhBwB,CAAAA;gBAKwC;gBAEvD,OAAI7iI,EAAIsiI,MAAAA,CAAO10F,KAAAA,GACJzgE,QAAQ6+D,GAAAA,CAAI;oBACfpjE,IAAAA,CAAKg8J,IAAAA,CAAKxhJ,IAAAA,CAAK+hJ,WAAAA,CAAY;wBACvB96J,MAAM21B,EAAI31B,IAAAA;wBACVgoB,MAAM2N,EAAI3N,IAAAA;wBACVymB,QAAQ9Y;oBAAAA;oBAEZp3B,IAAAA,CAAKg8J,IAAAA,CAAKxgJ,KAAAA,CAAM+gJ,WAAAA,CAAY;wBACxB96J,MAAM21B,EAAI31B,IAAAA;wBACVgoB,MAAM2N,EAAI3N,IAAAA;wBACVymB,QAAQ9Y;oBAAAA;iBAAAA,EAEbjK,IAAAA,CAAK,CAAA,CAAE3S,GAAMgB,EAAAA,GAAWuuJ,EAAavvJ,GAAMgB,MAGvCuuJ,EAAa/pK,IAAAA,CAAKg8J,IAAAA,CAAKxhJ,IAAAA,CAAK6hJ,UAAAA,CAAW;oBAC1C56J,MAAM21B,EAAI31B,IAAAA;oBACVgoB,MAAM2N,EAAI3N,IAAAA;oBACVymB,QAAQ9Y;gBAAAA,IACRp3B,IAAAA,CAAKg8J,IAAAA,CAAKxgJ,KAAAA,CAAM6gJ,UAAAA,CAAW;oBAC3B56J,MAAM21B,EAAI31B,IAAAA;oBACVgoB,MAAM2N,EAAI3N,IAAAA;oBACVymB,QAAQ9Y;gBAAAA;YAGpB;QAAA;QAEJ0nI,GAAgBljG,MAAAA,GAAS,CAACphD,GAAMgB,GAAOy9I,IAC5B,IAAI6F,GAAgB;gBACvBtkJ,MAAMA;gBACNgB,OAAOA;gBACPolB,UAAUy8H,GAAsByB,eAAAA;gBAAAA,GAC7BpD,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM8N,WAAiBhL;YACnB,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,QAAE51F,CAAAA,EAAM,KAAE8M,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACjD,IAAI9oF,EAAI+kI,UAAAA,KAAejH,EAAcpqJ,KAAAA,EAMjC,OALA0uJ,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcpqJ,KAAAA;oBACxBusJ,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;gBAEX,IAAI7iI,EAAI31B,IAAAA,CAAKnB,MAAAA,GAASN,IAAAA,CAAKg8J,IAAAA,CAAKvzB,KAAAA,CAAMnoI,MAAAA,EAQlC,OAPAk5J,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAaqC,SAAAA;oBACnBG,SAASr4J,IAAAA,CAAKg8J,IAAAA,CAAKvzB,KAAAA,CAAMnoI,MAAAA;oBACzB83J,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACP1xJ,MAAM;gBAAA,IAEHwzJ;gBAAAA,CAEEj6J,IAAAA,CAAKg8J,IAAAA,CAAKmO,IAAAA,IACV/yI,EAAI31B,IAAAA,CAAKnB,MAAAA,GAASN,IAAAA,CAAKg8J,IAAAA,CAAKvzB,KAAAA,CAAMnoI,MAAAA,IAC3Ck5J,CAAAA,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAayC,OAAAA;oBACnBC,SAASv4J,IAAAA,CAAKg8J,IAAAA,CAAKvzB,KAAAA,CAAMnoI,MAAAA;oBACzB83J,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACP1xJ,MAAM;gBAAA,IAEV6jB,EAAOkuB,KAAAA,EAAAA;gBAEX,MAAMiwF,IAAQ;uBAAIrxG,EAAI31B,IAAAA;iBAAAA,CACjBxB,GAAAA,CAAI,CAACC,GAAMkqK;oBACZ,MAAMhN,IAASp9J,IAAAA,CAAKg8J,IAAAA,CAAKvzB,KAAAA,CAAM2hC,EAAAA,IAAcpqK,IAAAA,CAAKg8J,IAAAA,CAAKmO,IAAAA;oBACvD,OAAK/M,IAEEA,EAAOd,MAAAA,CAAO,IAAIlB,EAAmBhkI,GAAKl3B,GAAMk3B,EAAI3N,IAAAA,EAAM2gJ,MADtD;gBACiE,GAE3EpiK,MAAAA,CAAQsE,CAAAA,IAAAA,CAAAA,CAAQA;gBACrB,OAAI8qB,EAAIsiI,MAAAA,CAAO10F,KAAAA,GACJzgE,QAAQ6+D,GAAAA,CAAIqlE,GAAOt7G,IAAAA,CAAM0G,CAAAA,IACrBgmI,EAAYE,UAAAA,CAAWzvI,GAAQuJ,MAInCgmI,EAAYE,UAAAA,CAAWzvI,GAAQm+G;YAE9C;YACA,IAAA,QAAIA;gBACA,OAAOzoI,IAAAA,CAAKg8J,IAAAA,CAAKvzB,KACrB;YAAA;YACA,KAAK0hC,CAAAA,EAAAA;gBACD,OAAO,IAAIpD,GAAS;oBAAA,GACb/mK,IAAAA,CAAKg8J,IAAAA;oBACRmO,MAAAA;gBAAAA;YAER;QAAA;QAEJpD,GAASnrG,MAAAA,GAAS,CAACyuG,GAASpR;YACxB,IAAA,CAAKlvJ,MAAMoX,OAAAA,CAAQkpJ,IACf,MAAM,IAAIlkK,MAAM;YAEpB,OAAO,IAAI4gK,GAAS;gBAChBt+B,OAAO4hC;gBACPzpI,UAAUy8H,GAAsB0J,QAAAA;gBAChCoD,MAAM;gBAAA,GACHzO,EAAoBzC,EAAAA;YAAAA;QACzB;QAEN,MAAMqR,WAAkBvO;YACpB,IAAA,YAAIwO;gBACA,OAAOvqK,IAAAA,CAAKg8J,IAAAA,CAAKwO,OACrB;YAAA;YACA,IAAA,cAAIC;gBACA,OAAOzqK,IAAAA,CAAKg8J,IAAAA,CAAK0O,SACrB;YAAA;YACA,OAAOxqD,CAAAA,EAAAA;gBACH,MAAA,EAAM,QAAE51F,CAAAA,EAAM,KAAE8M,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACjD,IAAI9oF,EAAI+kI,UAAAA,KAAejH,EAAcn0I,MAAAA,EAMjC,OALAy4I,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcn0I,MAAAA;oBACxBs2I,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;gBAEX,MAAMxoF,IAAQ,EAAA,EACR+4F,IAAUxqK,IAAAA,CAAKg8J,IAAAA,CAAKwO,OAAAA,EACpBE,IAAY1qK,IAAAA,CAAKg8J,IAAAA,CAAK0O,SAAAA;gBAC5B,IAAK,MAAMpoK,KAAO80B,EAAI31B,IAAAA,CAClBgwE,EAAM9xE,IAAAA,CAAK;oBACP2C,KAAKkoK,EAAQlO,MAAAA,CAAO,IAAIlB,EAAmBhkI,GAAK90B,GAAK80B,EAAI3N,IAAAA,EAAMnnB;oBAC/Dc,OAAOsnK,EAAUpO,MAAAA,CAAO,IAAIlB,EAAmBhkI,GAAKA,EAAI31B,IAAAA,CAAKa,EAAAA,EAAM80B,EAAI3N,IAAAA,EAAMnnB;oBAC7Eg4J,WAAWh4J,KAAO80B,EAAI31B,IAAAA;gBAAAA;gBAG9B,OAAI21B,EAAIsiI,MAAAA,CAAO10F,KAAAA,GACJ60F,EAAYK,gBAAAA,CAAiB5vI,GAAQmnD,KAGrCooF,EAAYO,eAAAA,CAAgB9vI,GAAQmnD;YAEnD;YACA,IAAA,UAAIg1F;gBACA,OAAOzmK,IAAAA,CAAKg8J,IAAAA,CAAK0O,SACrB;YAAA;YACA,OAAA,OAAc/zC,CAAAA,EAAOs+B,CAAAA,EAAQ0V,CAAAA,EAAAA;gBACzB,OACW,IAAIL,GADXrV,aAAkB8G,IACG;oBACjByO,SAAS7zC;oBACT+zC,WAAWzV;oBACXr0H,UAAUy8H,GAAsBiN,SAAAA;oBAAAA,GAC7B5O,EAAoBiP,EAAAA;gBAAAA,IAGV;oBACjBH,SAAShJ,GAAU5lG,MAAAA;oBACnB8uG,WAAW/zC;oBACX/1F,UAAUy8H,GAAsBiN,SAAAA;oBAAAA,GAC7B5O,EAAoBzG,EAAAA;gBAAAA;YAE/B;QAAA;QAEJ,MAAM2V,WAAe7O;YACjB,IAAA,YAAIwO;gBACA,OAAOvqK,IAAAA,CAAKg8J,IAAAA,CAAKwO,OACrB;YAAA;YACA,IAAA,cAAIC;gBACA,OAAOzqK,IAAAA,CAAKg8J,IAAAA,CAAK0O,SACrB;YAAA;YACA,OAAOxqD,CAAAA,EAAAA;gBACH,MAAA,EAAM,QAAE51F,CAAAA,EAAM,KAAE8M,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACjD,IAAI9oF,EAAI+kI,UAAAA,KAAejH,EAAcj1J,GAAAA,EAMjC,OALAu5J,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcj1J,GAAAA;oBACxBo3J,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;gBAEX,MAAMuQ,IAAUxqK,IAAAA,CAAKg8J,IAAAA,CAAKwO,OAAAA,EACpBE,IAAY1qK,IAAAA,CAAKg8J,IAAAA,CAAK0O,SAAAA,EACtBj5F,IAAQ;uBAAIr6C,EAAI31B,IAAAA,CAAKysC,OAAAA;iBAAAA,CAAWjuC,GAAAA,CAAI,CAAA,CAAEqC,GAAKc,EAAAA,EAAQoI,IAC9C,CAAA;wBACHlJ,KAAKkoK,EAAQlO,MAAAA,CAAO,IAAIlB,EAAmBhkI,GAAK90B,GAAK80B,EAAI3N,IAAAA,EAAM;4BAACje;4BAAO;yBAAA;wBACvEpI,OAAOsnK,EAAUpO,MAAAA,CAAO,IAAIlB,EAAmBhkI,GAAKh0B,GAAOg0B,EAAI3N,IAAAA,EAAM;4BAACje;4BAAO;yBAAA;oBAAA,CAAA;gBAGrF,IAAI4rB,EAAIsiI,MAAAA,CAAO10F,KAAAA,EAAO;oBAClB,MAAM6lG,IAAW,IAAIv8I;oBACrB,OAAO/pB,QAAQC,OAAAA,GAAU2oB,IAAAA,CAAK63C;wBAC1B,KAAK,MAAMuM,KAAQE,EAAO;4BACtB,MAAMnvE,IAAAA,MAAYivE,EAAKjvE,GAAAA,EACjBc,IAAAA,MAAcmuE,EAAKnuE,KAAAA;4BACzB,IAAmB,cAAfd,EAAIgoB,MAAAA,IAAyC,cAAjBlnB,EAAMknB,MAAAA,EAClC,OAAO2vI;4BAEQ,YAAf33J,EAAIgoB,MAAAA,IAAuC,YAAjBlnB,EAAMknB,MAAAA,IAChCA,EAAOkuB,KAAAA,IAEXqyH,EAAS7/I,GAAAA,CAAI1oB,EAAIc,KAAAA,EAAOA,EAAMA,KAAAA;wBAClC;wBACA,OAAO;4BAAEknB,QAAQA,EAAOlnB,KAAAA;4BAAOA,OAAOynK;wBAAAA;oBAAU;gBAExD;gBACK;oBACD,MAAMA,IAAW,IAAIv8I;oBACrB,KAAK,MAAMijD,KAAQE,EAAO;wBACtB,MAAMnvE,IAAMivE,EAAKjvE,GAAAA,EACXc,IAAQmuE,EAAKnuE,KAAAA;wBACnB,IAAmB,cAAfd,EAAIgoB,MAAAA,IAAyC,cAAjBlnB,EAAMknB,MAAAA,EAClC,OAAO2vI;wBAEQ,YAAf33J,EAAIgoB,MAAAA,IAAuC,YAAjBlnB,EAAMknB,MAAAA,IAChCA,EAAOkuB,KAAAA,IAEXqyH,EAAS7/I,GAAAA,CAAI1oB,EAAIc,KAAAA,EAAOA,EAAMA,KAAAA;oBAClC;oBACA,OAAO;wBAAEknB,QAAQA,EAAOlnB,KAAAA;wBAAOA,OAAOynK;oBAAAA;gBAC1C;YACJ;QAAA;QAEJD,GAAOhvG,MAAAA,GAAS,CAAC4uG,GAASE,GAAWzR,IAC1B,IAAI2R,GAAO;gBACdF,WAAAA;gBACAF,SAAAA;gBACA5pI,UAAUy8H,GAAsBuN,MAAAA;gBAAAA,GAC7BlP,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM6R,WAAe/O;YACjB,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,QAAE51F,CAAAA,EAAM,KAAE8M,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACjD,IAAI9oF,EAAI+kI,UAAAA,KAAejH,EAAclqI,GAAAA,EAMjC,OALAwuI,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAclqI,GAAAA;oBACxBqsI,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;gBAEX,MAAMuD,IAAMx9J,IAAAA,CAAKg8J,IAAAA;gBACG,SAAhBwB,EAAIt5B,OAAAA,IACA9sG,EAAI31B,IAAAA,CAAKqO,IAAAA,GAAO0tJ,EAAIt5B,OAAAA,CAAQ9gI,KAAAA,IAC5Bo2J,CAAAA,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAaqC,SAAAA;oBACnBG,SAASmF,EAAIt5B,OAAAA,CAAQ9gI,KAAAA;oBACrBqD,MAAM;oBACN2xJ,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACPx9I,SAAS6iJ,EAAIt5B,OAAAA,CAAQvpH,OAAAA;gBAAAA,IAEzB2P,EAAOkuB,KAAAA,EAAAA,GAGK,SAAhBglH,EAAIr5B,OAAAA,IACA/sG,EAAI31B,IAAAA,CAAKqO,IAAAA,GAAO0tJ,EAAIr5B,OAAAA,CAAQ/gI,KAAAA,IAC5Bo2J,CAAAA,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAayC,OAAAA;oBACnBC,SAASiF,EAAIr5B,OAAAA,CAAQ/gI,KAAAA;oBACrBqD,MAAM;oBACN2xJ,WAAAA,CAAW;oBACXD,OAAAA,CAAO;oBACPx9I,SAAS6iJ,EAAIr5B,OAAAA,CAAQxpH,OAAAA;gBAAAA,IAEzB2P,EAAOkuB,KAAAA,EAAAA;gBAGf,MAAMkyH,IAAY1qK,IAAAA,CAAKg8J,IAAAA,CAAK0O,SAAAA;gBAC5B,SAASK,EAAYC,CAAAA;oBACjB,MAAMC,IAAY,IAAIh0J;oBACtB,KAAK,MAAMwvJ,KAAWuE,EAAU;wBAC5B,IAAuB,cAAnBvE,EAAQn8I,MAAAA,EACR,OAAO2vI;wBACY,YAAnBwM,EAAQn8I,MAAAA,IACRA,EAAOkuB,KAAAA,IACXyyH,EAAU76J,GAAAA,CAAIq2J,EAAQrjK,KAAAA;oBAC1B;oBACA,OAAO;wBAAEknB,QAAQA,EAAOlnB,KAAAA;wBAAOA,OAAO6nK;oBAAAA;gBAC1C;gBACA,MAAMD,IAAW;uBAAI5zI,EAAI31B,IAAAA,CAAKylD,MAAAA;iBAAAA,CAAUjnD,GAAAA,CAAI,CAACC,GAAMM,IAAMkqK,EAAUpO,MAAAA,CAAO,IAAIlB,EAAmBhkI,GAAKl3B,GAAMk3B,EAAI3N,IAAAA,EAAMjpB;gBACtH,OAAI42B,EAAIsiI,MAAAA,CAAO10F,KAAAA,GACJzgE,QAAQ6+D,GAAAA,CAAI4nG,GAAU79I,IAAAA,CAAM69I,CAAAA,IAAaD,EAAYC,MAGrDD,EAAYC;YAE3B;YACA,IAAI9mC,CAAAA,EAASvpH,CAAAA,EAAAA;gBACT,OAAO,IAAImwJ,GAAO;oBAAA,GACX9qK,IAAAA,CAAKg8J,IAAAA;oBACR93B,SAAS;wBAAE9gI,OAAO8gI;wBAASvpH,SAASogJ,EAAUh7J,QAAAA,CAAS4a;oBAAAA;gBAAAA;YAE/D;YACA,IAAIwpH,CAAAA,EAASxpH,CAAAA,EAAAA;gBACT,OAAO,IAAImwJ,GAAO;oBAAA,GACX9qK,IAAAA,CAAKg8J,IAAAA;oBACR73B,SAAS;wBAAE/gI,OAAO+gI;wBAASxpH,SAASogJ,EAAUh7J,QAAAA,CAAS4a;oBAAAA;gBAAAA;YAE/D;YACA,KAAK7K,CAAAA,EAAM6K,CAAAA,EAAAA;gBACP,OAAO3a,IAAAA,CAAKwK,GAAAA,CAAIsF,GAAM6K,GAASpV,GAAAA,CAAIuK,GAAM6K;YAC7C;YACA,SAASA,CAAAA,EAAAA;gBACL,OAAO3a,IAAAA,CAAKwK,GAAAA,CAAI,GAAGmQ;YACvB;QAAA;QAEJmwJ,GAAOlvG,MAAAA,GAAS,CAAC8uG,GAAWzR,IACjB,IAAI6R,GAAO;gBACdJ,WAAAA;gBACAxmC,SAAS;gBACTC,SAAS;gBACTvjG,UAAUy8H,GAAsByN,MAAAA;gBAAAA,GAC7BpP,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMiS,WAAoBnP;YACtB,aAAAp1J;gBACIimB,KAAAA,IAASmrD,YACT/3E,IAAAA,CAAKs+J,QAAAA,GAAWt+J,IAAAA,CAAKmrK,SACzB;YAAA;YACA,OAAOjrD,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACzC,IAAI9oF,EAAI+kI,UAAAA,KAAejH,EAAcK,QAAAA,EAMjC,OALAiE,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcK,QAAAA;oBACxB8B,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;gBAEX,SAASmR,EAAc1zJ,CAAAA,EAAMzQ,CAAAA;oBACzB,OAAO+xJ,EAAU;wBACbv3J,MAAMiW;wBACN+R,MAAM2N,EAAI3N,IAAAA;wBACVyvI,WAAW;4BACP9hI,EAAIsiI,MAAAA,CAAOC,kBAAAA;4BACXviI,EAAIwiI,cAAAA;4BACJb;4BACA5B;yBAAAA,CACFnvJ,MAAAA,CAAQsE,CAAAA,IAAAA,CAAAA,CAAQA;wBAClB6sJ,WAAW;4BACPpyC,MAAM8uC,EAAa+B,iBAAAA;4BACnBb,gBAAgB9vJ;wBAAAA;oBAAAA;gBAG5B;gBACA,SAASokK,EAAiBC,CAAAA,EAASrkK,CAAAA;oBAC/B,OAAO+xJ,EAAU;wBACbv3J,MAAM6pK;wBACN7hJ,MAAM2N,EAAI3N,IAAAA;wBACVyvI,WAAW;4BACP9hI,EAAIsiI,MAAAA,CAAOC,kBAAAA;4BACXviI,EAAIwiI,cAAAA;4BACJb;4BACA5B;yBAAAA,CACFnvJ,MAAAA,CAAQsE,CAAAA,IAAAA,CAAAA,CAAQA;wBAClB6sJ,WAAW;4BACPpyC,MAAM8uC,EAAagC,mBAAAA;4BACnBf,iBAAiB7vJ;wBAAAA;oBAAAA;gBAG7B;gBACA,MAAMgyJ,IAAS;oBAAE9B,UAAU//H,EAAIsiI,MAAAA,CAAOC,kBAAAA;gBAAAA,GAChC4R,IAAKn0I,EAAI31B,IAAAA;gBACf,IAAIzB,IAAAA,CAAKg8J,IAAAA,CAAKsP,OAAAA,YAAmB5M,IAAY;oBAIzC,MAAM5+D,IAAK9/F,IAAAA;oBACX,OAAOw6J,EAAGx1F,eAAAA,GAAmBttD,CAAAA;wBACzB,MAAMzQ,IAAQ,IAAI6uJ,EAAS,EAAA,GACrB0V,IAAAA,MAAmB1rE,EAAGk8D,IAAAA,CAAKtkJ,IAAAA,CAC5BglJ,UAAAA,CAAWhlJ,GAAMuhJ,GACjBtD,KAAAA,CAAOr2I,CAAAA;4BAER,MADArY,EAAMgvJ,QAAAA,CAASmV,EAAc1zJ,GAAM4H,KAC7BrY;wBAAK,IAETmE,IAAAA,MAAeqgK,QAAQ1yJ,KAAAA,CAAMwyJ,GAAIvrK,IAAAA,EAAMwrK;wBAO7C,OAAA,MAN4B1rE,EAAGk8D,IAAAA,CAAKsP,OAAAA,CAAQtP,IAAAA,CAAKv1J,IAAAA,CAC5Ci2J,UAAAA,CAAWtxJ,GAAQ6tJ,GACnBtD,KAAAA,CAAOr2I,CAAAA;4BAER,MADArY,EAAMgvJ,QAAAA,CAASoV,EAAiBjgK,GAAQkU,KAClCrY;wBAAK;oBAGnB;gBACJ;gBACK;oBAID,MAAM64F,IAAK9/F,IAAAA;oBACX,OAAOw6J,EAAG,SAAA,GAAa9iJ,CAAAA;wBACnB,MAAM8zJ,IAAa1rE,EAAGk8D,IAAAA,CAAKtkJ,IAAAA,CAAK8kJ,SAAAA,CAAU9kJ,GAAMuhJ;wBAChD,IAAA,CAAKuS,EAAWhQ,OAAAA,EACZ,MAAM,IAAI1F,EAAS;4BAACsV,EAAc1zJ,GAAM8zJ,EAAWvkK,KAAAA;yBAAAA;wBAEvD,MAAMmE,IAASqgK,QAAQ1yJ,KAAAA,CAAMwyJ,GAAIvrK,IAAAA,EAAMwrK,EAAW/pK,IAAAA,GAC5CiqK,IAAgB5rE,EAAGk8D,IAAAA,CAAKsP,OAAAA,CAAQ9O,SAAAA,CAAUpxJ,GAAQ6tJ;wBACxD,IAAA,CAAKyS,EAAclQ,OAAAA,EACf,MAAM,IAAI1F,EAAS;4BAACuV,EAAiBjgK,GAAQsgK,EAAczkK,KAAAA;yBAAAA;wBAE/D,OAAOykK,EAAcjqK,IACzB;oBAAA;gBACJ;YACJ;YACA,aAAAkqK;gBACI,OAAO3rK,IAAAA,CAAKg8J,IAAAA,CAAKtkJ,IACrB;YAAA;YACA,aAAAk0J;gBACI,OAAO5rK,IAAAA,CAAKg8J,IAAAA,CAAKsP,OACrB;YAAA;YACA,KAAA5zJ,GAAQ+wH,CAAAA,EAAAA;gBACJ,OAAO,IAAIyiC,GAAY;oBAAA,GAChBlrK,IAAAA,CAAKg8J,IAAAA;oBACRtkJ,MAAMqvJ,GAASnrG,MAAAA,CAAO6sE,GAAO0hC,IAAAA,CAAKjE,GAAWtqG,MAAAA;gBAAAA;YAErD;YACA,QAAQgwG,CAAAA,EAAAA;gBACJ,OAAO,IAAIV,GAAY;oBAAA,GAChBlrK,IAAAA,CAAKg8J,IAAAA;oBACRsP,SAASM;gBAAAA;YAEjB;YACA,UAAUx5H,CAAAA,EAAAA;gBAEN,OADsBpyC,IAAAA,CAAKs+D,KAAAA,CAAMlsB;YAErC;YACA,gBAAgBA,CAAAA,EAAAA;gBAEZ,OADsBpyC,IAAAA,CAAKs+D,KAAAA,CAAMlsB;YAErC;YACA,OAAA,OAAc16B,CAAAA,EAAM4zJ,CAAAA,EAASrS,CAAAA,EAAAA;gBACzB,OAAO,IAAIiS,GAAY;oBACnBxzJ,MAAOA,KAEDqvJ,GAASnrG,MAAAA,CAAO,EAAA,EAAIuuG,IAAAA,CAAKjE,GAAWtqG,MAAAA;oBAC1C0vG,SAASA,KAAWpF,GAAWtqG,MAAAA;oBAC/Bh7B,UAAUy8H,GAAsB6N,WAAAA;oBAAAA,GAC7BxP,EAAoBzC,EAAAA;gBAAAA;YAE/B;QAAA;QAEJ,MAAM4P,WAAgB9M;YAClB,IAAA,SAAIqB;gBACA,OAAOp9J,IAAAA,CAAKg8J,IAAAA,CAAK/5J,MAAAA;YACrB;YACA,OAAOi+G,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBAEzC,OADmBlgH,IAAAA,CAAKg8J,IAAAA,CAAK/5J,MAAAA,GACXq6J,MAAAA,CAAO;oBAAE76J,MAAM21B,EAAI31B,IAAAA;oBAAMgoB,MAAM2N,EAAI3N,IAAAA;oBAAMymB,QAAQ9Y;gBAAAA;YACvE;QAAA;QAEJyxI,GAAQjtG,MAAAA,GAAS,CAAC35D,GAAQg3J,IACf,IAAI4P,GAAQ;gBACf5mK,QAAQA;gBACR2+B,UAAUy8H,GAAsBwL,OAAAA;gBAAAA,GAC7BnN,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM6P,WAAmB/M;YACrB,OAAO77C,CAAAA,EAAAA;gBACH,IAAIA,EAAMz+G,IAAAA,KAASzB,IAAAA,CAAKg8J,IAAAA,CAAK54J,KAAAA,EAAO;oBAChC,MAAMg0B,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnBigI,UAAUjgI,EAAI31B,IAAAA;wBACdslH,MAAM8uC,EAAa0B,eAAAA;wBACnBD,UAAUt3J,IAAAA,CAAKg8J,IAAAA,CAAK54J,KAAAA;oBAAAA,IAEjB62J;gBACX;gBACA,OAAO;oBAAE3vI,QAAQ;oBAASlnB,OAAO88G,EAAMz+G,IAAAA;gBAAAA;YAC3C;YACA,IAAA,QAAI2B;gBACA,OAAOpD,IAAAA,CAAKg8J,IAAAA,CAAK54J,KACrB;YAAA;QAAA;QASJ,SAASolK,GAActhH,CAAAA,EAAQ+xG,CAAAA;YAC3B,OAAO,IAAI8P,GAAQ;gBACf7hH,QAAAA;gBACAtmB,UAAUy8H,GAAsB0L,OAAAA;gBAAAA,GAC7BrN,EAAoBzC,EAAAA;YAAAA;QAE/B;QAbA6P,GAAWltG,MAAAA,GAAS,CAACx4D,GAAO61J,IACjB,IAAI6P,GAAW;gBAClB1lK,OAAOA;gBACPw9B,UAAUy8H,GAAsByL,UAAAA;gBAAAA,GAC7BpN,EAAoBzC,EAAAA;YAAAA;QAU/B,MAAM8P,WAAgBhN;YAClB,aAAAp1J;gBACIimB,KAAAA,IAASmrD,YACTijF,EAAehwI,GAAAA,CAAIhrB,IAAAA,EAAAA,KAAM;YAC7B;YACA,OAAOkgH,CAAAA,EAAAA;gBACH,IAA0B,YAAA,OAAfA,EAAMz+G,IAAAA,EAAmB;oBAChC,MAAM21B,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,IAC3B4rD,IAAiB9rK,IAAAA,CAAKg8J,IAAAA,CAAK90G,MAAAA;oBAMjC,OALAsyG,EAAkBpiI,GAAK;wBACnBkgI,UAAUxD,EAAKe,UAAAA,CAAWiX;wBAC1BzU,UAAUjgI,EAAI+kI,UAAAA;wBACdp1C,MAAM8uC,EAAauB,YAAAA;oBAAAA,IAEhB6C;gBACX;gBAIA,IAHKW,EAAuB56J,IAAAA,EAAMg7J,GAAgB,QAC9CF,EAAuB96J,IAAAA,EAAMg7J,GAAgB,IAAI/jJ,IAAIjX,IAAAA,CAAKg8J,IAAAA,CAAK90G,MAAAA,GAAS,MAAA,CAEvE0zG,EAAuB56J,IAAAA,EAAMg7J,GAAgB,KAAKjjJ,GAAAA,CAAImoG,EAAMz+G,IAAAA,GAAO;oBACpE,MAAM21B,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C,IAC3B4rD,IAAiB9rK,IAAAA,CAAKg8J,IAAAA,CAAK90G,MAAAA;oBAMjC,OALAsyG,EAAkBpiI,GAAK;wBACnBigI,UAAUjgI,EAAI31B,IAAAA;wBACdslH,MAAM8uC,EAAa8B,kBAAAA;wBACnB1+I,SAAS6yJ;oBAAAA,IAEN7R;gBACX;gBACA,OAAOO,EAAGt6C,EAAMz+G,IAAAA;YACpB;YACA,IAAA,UAAIwX;gBACA,OAAOjZ,IAAAA,CAAKg8J,IAAAA,CAAK90G,MACrB;YAAA;YACA,IAAA,OAAI+hH;gBACA,MAAM8C,IAAa,CAAC;gBACpB,KAAK,MAAMt/J,KAAOzM,IAAAA,CAAKg8J,IAAAA,CAAK90G,MAAAA,CACxB6kH,CAAAA,CAAWt/J,EAAAA,GAAOA;gBAEtB,OAAOs/J;YACX;YACA,IAAA,SAAIC;gBACA,MAAMD,IAAa,CAAC;gBACpB,KAAK,MAAMt/J,KAAOzM,IAAAA,CAAKg8J,IAAAA,CAAK90G,MAAAA,CACxB6kH,CAAAA,CAAWt/J,EAAAA,GAAOA;gBAEtB,OAAOs/J;YACX;YACA,IAAA,OAAIE;gBACA,MAAMF,IAAa,CAAC;gBACpB,KAAK,MAAMt/J,KAAOzM,IAAAA,CAAKg8J,IAAAA,CAAK90G,MAAAA,CACxB6kH,CAAAA,CAAWt/J,EAAAA,GAAOA;gBAEtB,OAAOs/J;YACX;YACA,QAAQ7kH,CAAAA,EAAQilH,IAASnsK,IAAAA,CAAKg8J,IAAAA,EAAAA;gBAC1B,OAAO+M,GAAQntG,MAAAA,CAAO1U,GAAQ;oBAAA,GACvBlnD,IAAAA,CAAKg8J,IAAAA;oBAAAA,GACLmQ,CAAAA;gBAAAA;YAEX;YACA,QAAQjlH,CAAAA,EAAQilH,IAASnsK,IAAAA,CAAKg8J,IAAAA,EAAAA;gBAC1B,OAAO+M,GAAQntG,MAAAA,CAAO57D,IAAAA,CAAKiZ,OAAAA,CAAQjR,MAAAA,CAAQmzI,CAAAA,IAAAA,CAASj0F,EAAOjmC,QAAAA,CAASk6H,KAAO;oBAAA,GACpEn7I,IAAAA,CAAKg8J,IAAAA;oBAAAA,GACLmQ,CAAAA;gBAAAA;YAEX;QAAA;QAEJnR,IAAiB,IAAIl1D,SACrBijE,GAAQntG,MAAAA,GAAS4sG;QACjB,MAAMQ,WAAsBjN;YACxB,aAAAp1J;gBACIimB,KAAAA,IAASmrD,YACTkjF,EAAqBjwI,GAAAA,CAAIhrB,IAAAA,EAAAA,KAAM;YACnC;YACA,OAAOkgH,CAAAA,EAAAA;gBACH,MAAMmsD,IAAmBvY,EAAKO,kBAAAA,CAAmBr0J,IAAAA,CAAKg8J,IAAAA,CAAK90G,MAAAA,GACrD9vB,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;gBACjC,IAAI9oF,EAAI+kI,UAAAA,KAAejH,EAAcziJ,MAAAA,IACjC2kB,EAAI+kI,UAAAA,KAAejH,EAAcG,MAAAA,EAAQ;oBACzC,MAAMyW,IAAiBhY,EAAKW,YAAAA,CAAa4X;oBAMzC,OALA7S,EAAkBpiI,GAAK;wBACnBkgI,UAAUxD,EAAKe,UAAAA,CAAWiX;wBAC1BzU,UAAUjgI,EAAI+kI,UAAAA;wBACdp1C,MAAM8uC,EAAauB,YAAAA;oBAAAA,IAEhB6C;gBACX;gBAIA,IAHKW,EAAuB56J,IAAAA,EAAMi7J,GAAsB,QACpDH,EAAuB96J,IAAAA,EAAMi7J,GAAsB,IAAIhkJ,IAAI68I,EAAKO,kBAAAA,CAAmBr0J,IAAAA,CAAKg8J,IAAAA,CAAK90G,MAAAA,IAAU,MAAA,CAEtG0zG,EAAuB56J,IAAAA,EAAMi7J,GAAsB,KAAKljJ,GAAAA,CAAImoG,EAAMz+G,IAAAA,GAAO;oBAC1E,MAAMqqK,IAAiBhY,EAAKW,YAAAA,CAAa4X;oBAMzC,OALA7S,EAAkBpiI,GAAK;wBACnBigI,UAAUjgI,EAAI31B,IAAAA;wBACdslH,MAAM8uC,EAAa8B,kBAAAA;wBACnB1+I,SAAS6yJ;oBAAAA,IAEN7R;gBACX;gBACA,OAAOO,EAAGt6C,EAAMz+G,IAAAA;YACpB;YACA,IAAA,OAAIwnK;gBACA,OAAOjpK,IAAAA,CAAKg8J,IAAAA,CAAK90G,MACrB;YAAA;QAAA;QAEJ+zG,IAAuB,IAAIn1D,SAC3BkjE,GAAcptG,MAAAA,GAAS,CAAC1U,GAAQ+xG,IACrB,IAAI+P,GAAc;gBACrB9hH,QAAQA;gBACRtmB,UAAUy8H,GAAsB2L,aAAAA;gBAAAA,GAC7BtN,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMyF,WAAmB3C;YACrB,SAAA+K;gBACI,OAAO9mK,IAAAA,CAAKg8J,IAAAA,CAAKv1J,IACrB;YAAA;YACA,OAAOy5G,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACzC,IAAI9oF,EAAI+kI,UAAAA,KAAejH,EAAcruJ,OAAAA,IAAAA,CACZ,MAArBuwB,EAAIsiI,MAAAA,CAAO10F,KAAAA,EAMX,OALAw0F,EAAkBpiI,GAAK;oBACnB2vF,MAAM8uC,EAAauB,YAAAA;oBACnBE,UAAUpC,EAAcruJ,OAAAA;oBACxBwwJ,UAAUjgI,EAAI+kI,UAAAA;gBAAAA,IAEXlC;gBAEX,MAAMqS,IAAcl1I,EAAI+kI,UAAAA,KAAejH,EAAcruJ,OAAAA,GAC/CuwB,EAAI31B,IAAAA,GACJ8C,QAAQC,OAAAA,CAAQ4yB,EAAI31B,IAAAA;gBAC1B,OAAO+4J,EAAG8R,EAAYn/I,IAAAA,CAAM1rB,CAAAA,IACjBzB,IAAAA,CAAKg8J,IAAAA,CAAKv1J,IAAAA,CAAKi2J,UAAAA,CAAWj7J,GAAM;wBACnCgoB,MAAM2N,EAAI3N,IAAAA;wBACV0tI,UAAU//H,EAAIsiI,MAAAA,CAAOC,kBAAAA;oBAAAA;YAGjC;QAAA;QAEJ+E,GAAW9iG,MAAAA,GAAS,CAACwhG,GAAQnE,IAClB,IAAIyF,GAAW;gBAClBj4J,MAAM22J;gBACNx8H,UAAUy8H,GAAsBqB,UAAAA;gBAAAA,GAC7BhD,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMkE,WAAmBpB;YACrB,YAAAkD;gBACI,OAAOj/J,IAAAA,CAAKg8J,IAAAA,CAAKoB,MACrB;YAAA;YACA,aAAAmP;gBACI,OAAOvsK,IAAAA,CAAKg8J,IAAAA,CAAKoB,MAAAA,CAAOpB,IAAAA,CAAKp7H,QAAAA,KAAay8H,GAAsBF,UAAAA,GAC1Dn9J,IAAAA,CAAKg8J,IAAAA,CAAKoB,MAAAA,CAAOmP,UAAAA,KACjBvsK,IAAAA,CAAKg8J,IAAAA,CAAKoB,MACpB;YAAA;YACA,OAAOl9C,CAAAA,EAAAA;gBACH,MAAA,EAAM,QAAE51F,CAAAA,EAAM,KAAE8M,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C,IAC3Co9C,IAASt9J,IAAAA,CAAKg8J,IAAAA,CAAKsB,MAAAA,IAAU,MAC7BkP,IAAW;oBACbvW,UAAWwW,CAAAA;wBACPjT,EAAkBpiI,GAAKq1I,IACnBA,EAAIh0J,KAAAA,GACJ6R,EAAOwvI,KAAAA,KAGPxvI,EAAOkuB,KAAAA;oBACX;oBAEJ,IAAA,QAAI/uB;wBACA,OAAO2N,EAAI3N,IACf;oBAAA;gBAAA;gBAGJ,IADA+iJ,EAASvW,QAAAA,GAAWuW,EAASvW,QAAAA,CAASp1I,IAAAA,CAAK2rJ,IACvB,iBAAhBlP,EAAO72J,IAAAA,EAAuB;oBAC9B,MAAMimK,IAAYpP,EAAOvgJ,SAAAA,CAAUqa,EAAI31B,IAAAA,EAAM+qK;oBAC7C,IAAIp1I,EAAIsiI,MAAAA,CAAO10F,KAAAA,EACX,OAAOzgE,QAAQC,OAAAA,CAAQkoK,GAAWv/I,IAAAA,CAAK63C,OAAO0nG;wBAC1C,IAAqB,cAAjBpiJ,EAAOlnB,KAAAA,EACP,OAAO62J;wBACX,MAAM7uJ,IAAAA,MAAepL,IAAAA,CAAKg8J,IAAAA,CAAKoB,MAAAA,CAAOb,WAAAA,CAAY;4BAC9C96J,MAAMirK;4BACNjjJ,MAAM2N,EAAI3N,IAAAA;4BACVymB,QAAQ9Y;wBAAAA;wBAEZ,OAAsB,cAAlBhsB,EAAOkf,MAAAA,GACA2vI,IACW,YAAlB7uJ,EAAOkf,MAAAA,IAEU,YAAjBA,EAAOlnB,KAAAA,GADAm3J,EAAMnvJ,EAAOhI,KAAAA,IAGjBgI;oBAAM;oBAGhB;wBACD,IAAqB,cAAjBkf,EAAOlnB,KAAAA,EACP,OAAO62J;wBACX,MAAM7uJ,IAASpL,IAAAA,CAAKg8J,IAAAA,CAAKoB,MAAAA,CAAOf,UAAAA,CAAW;4BACvC56J,MAAMirK;4BACNjjJ,MAAM2N,EAAI3N,IAAAA;4BACVymB,QAAQ9Y;wBAAAA;wBAEZ,OAAsB,cAAlBhsB,EAAOkf,MAAAA,GACA2vI,IACW,YAAlB7uJ,EAAOkf,MAAAA,IAEU,YAAjBA,EAAOlnB,KAAAA,GADAm3J,EAAMnvJ,EAAOhI,KAAAA,IAGjBgI;oBACX;gBACJ;gBACA,IAAoB,iBAAhBkyJ,EAAO72J,IAAAA,EAAuB;oBAC9B,MAAMkmK,IAAqBljH,CAAAA;wBACvB,MAAMr+C,IAASkyJ,EAAOL,UAAAA,CAAWxzG,GAAK+iH;wBACtC,IAAIp1I,EAAIsiI,MAAAA,CAAO10F,KAAAA,EACX,OAAOzgE,QAAQC,OAAAA,CAAQ4G;wBAE3B,IAAIA,aAAkB7G,SAClB,MAAM,IAAI4B,MAAM;wBAEpB,OAAOsjD;oBAAG;oBAEd,IAAA,CAAyB,MAArBryB,EAAIsiI,MAAAA,CAAO10F,KAAAA,EAAiB;wBAC5B,MAAM4nG,IAAQ5sK,IAAAA,CAAKg8J,IAAAA,CAAKoB,MAAAA,CAAOf,UAAAA,CAAW;4BACtC56J,MAAM21B,EAAI31B,IAAAA;4BACVgoB,MAAM2N,EAAI3N,IAAAA;4BACVymB,QAAQ9Y;wBAAAA;wBAEZ,OAAqB,cAAjBw1I,EAAMtiJ,MAAAA,GACC2vI,IACU,CAAA,YAAjB2S,EAAMtiJ,MAAAA,IACNA,EAAOkuB,KAAAA,IAEXm0H,EAAkBC,EAAMxpK,KAAAA,GACjB;4BAAEknB,QAAQA,EAAOlnB,KAAAA;4BAAOA,OAAOwpK,EAAMxpK,KAAAA;wBAAAA,CAAAA;oBAChD;oBAEI,OAAOpD,IAAAA,CAAKg8J,IAAAA,CAAKoB,MAAAA,CACZb,WAAAA,CAAY;wBAAE96J,MAAM21B,EAAI31B,IAAAA;wBAAMgoB,MAAM2N,EAAI3N,IAAAA;wBAAMymB,QAAQ9Y;oBAAAA,GACtDjK,IAAAA,CAAMy/I,CAAAA,IACc,cAAjBA,EAAMtiJ,MAAAA,GACC2vI,IACU,CAAA,YAAjB2S,EAAMtiJ,MAAAA,IACNA,EAAOkuB,KAAAA,IACJm0H,EAAkBC,EAAMxpK,KAAAA,EAAO+pB,IAAAA,CAAK,IAChC,CAAA;gCAAE7C,QAAQA,EAAOlnB,KAAAA;gCAAOA,OAAOwpK,EAAMxpK,KAAAA;4BAAAA,CAAAA,EAAAA;gBAI5D;gBACA,IAAoB,gBAAhBk6J,EAAO72J,IAAAA,EAAsB;oBAC7B,IAAA,CAAyB,MAArB2wB,EAAIsiI,MAAAA,CAAO10F,KAAAA,EAAiB;wBAC5B,MAAM0pF,IAAO1uJ,IAAAA,CAAKg8J,IAAAA,CAAKoB,MAAAA,CAAOf,UAAAA,CAAW;4BACrC56J,MAAM21B,EAAI31B,IAAAA;4BACVgoB,MAAM2N,EAAI3N,IAAAA;4BACVymB,QAAQ9Y;wBAAAA;wBAEZ,IAAA,CAAK3oB,EAAQigJ,IACT,OAAOA;wBACX,MAAMtjJ,IAASkyJ,EAAOvgJ,SAAAA,CAAU2xI,EAAKtrJ,KAAAA,EAAOopK;wBAC5C,IAAIphK,aAAkB7G,SAClB,MAAM,IAAI4B,MAAM;wBAEpB,OAAO;4BAAEmkB,QAAQA,EAAOlnB,KAAAA;4BAAOA,OAAOgI;wBAAAA;oBAC1C;oBAEI,OAAOpL,IAAAA,CAAKg8J,IAAAA,CAAKoB,MAAAA,CACZb,WAAAA,CAAY;wBAAE96J,MAAM21B,EAAI31B,IAAAA;wBAAMgoB,MAAM2N,EAAI3N,IAAAA;wBAAMymB,QAAQ9Y;oBAAAA,GACtDjK,IAAAA,CAAMuhI,CAAAA,IACFjgJ,EAAQigJ,KAENnqJ,QAAQC,OAAAA,CAAQ84J,EAAOvgJ,SAAAA,CAAU2xI,EAAKtrJ,KAAAA,EAAOopK,IAAWr/I,IAAAA,CAAM/hB,CAAAA,IAAW,CAAA;gCAAGkf,QAAQA,EAAOlnB,KAAAA;gCAAOA,OAAOgI;4BAAAA,CAAAA,KADrGsjJ;gBAIvB;gBACAoF,EAAKK,WAAAA,CAAYmJ;YACrB;QAAA;QAEJH,GAAWvhG,MAAAA,GAAS,CAACwhG,GAAQE,GAAQrE,IAC1B,IAAIkE,GAAW;gBAClBC,QAAAA;gBACAx8H,UAAUy8H,GAAsBF,UAAAA;gBAChCG,QAAAA;gBAAAA,GACG5B,EAAoBzC,EAAAA;YAAAA,IAG/BkE,GAAW0P,oBAAAA,GAAuB,CAACC,GAAY1P,GAAQnE,IAC5C,IAAIkE,GAAW;gBAClBC,QAAAA;gBACAE,QAAQ;oBAAE72J,MAAM;oBAAcsW,WAAW+vJ;gBAAAA;gBACzClsI,UAAUy8H,GAAsBF,UAAAA;gBAAAA,GAC7BzB,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMsF,WAAoBxC;YACtB,OAAO77C,CAAAA,EAAAA;gBAEH,OADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcp0J,SAAAA,GACtB05J,EAAAA,KAAG15J,KAEPd,IAAAA,CAAKg8J,IAAAA,CAAKiD,SAAAA,CAAU3C,MAAAA,CAAOp8C;YACtC;YACA,SAAA4mD;gBACI,OAAO9mK,IAAAA,CAAKg8J,IAAAA,CAAKiD,SACrB;YAAA;QAAA;QAEJV,GAAY3iG,MAAAA,GAAS,CAACn1D,GAAMwyJ,IACjB,IAAIsF,GAAY;gBACnBU,WAAWx4J;gBACXm6B,UAAUy8H,GAAsBkB,WAAAA;gBAAAA,GAC7B7C,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMuF,WAAoBzC;YACtB,OAAO77C,CAAAA,EAAAA;gBAEH,OADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcQ,IAAAA,GACtB8E,EAAG,QAEPx6J,IAAAA,CAAKg8J,IAAAA,CAAKiD,SAAAA,CAAU3C,MAAAA,CAAOp8C;YACtC;YACA,SAAA4mD;gBACI,OAAO9mK,IAAAA,CAAKg8J,IAAAA,CAAKiD,SACrB;YAAA;QAAA;QAEJT,GAAY5iG,MAAAA,GAAS,CAACn1D,GAAMwyJ,IACjB,IAAIuF,GAAY;gBACnBS,WAAWx4J;gBACXm6B,UAAUy8H,GAAsBmB,WAAAA;gBAAAA,GAC7B9C,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAM+F,WAAmBjD;YACrB,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACzC,IAAIz+G,IAAO21B,EAAI31B,IAAAA;gBAIf,OAHI21B,EAAI+kI,UAAAA,KAAejH,EAAcp0J,SAAAA,IACjCW,CAAAA,IAAOzB,IAAAA,CAAKg8J,IAAAA,CAAKkD,YAAAA,EAAAA,GAEdl/J,IAAAA,CAAKg8J,IAAAA,CAAKiD,SAAAA,CAAU3C,MAAAA,CAAO;oBAC9B76J,MAAAA;oBACAgoB,MAAM2N,EAAI3N,IAAAA;oBACVymB,QAAQ9Y;gBAAAA;YAEhB;YACA,gBAAA21I;gBACI,OAAO/sK,IAAAA,CAAKg8J,IAAAA,CAAKiD,SACrB;YAAA;QAAA;QAEJD,GAAWpjG,MAAAA,GAAS,CAACn1D,GAAMwyJ,IAChB,IAAI+F,GAAW;gBAClBC,WAAWx4J;gBACXm6B,UAAUy8H,GAAsB2B,UAAAA;gBAChCE,cAAwC,cAAA,OAAnBjG,EAAO+E,OAAAA,GACtB/E,EAAO+E,OAAAA,GACP,IAAM/E,EAAO+E,OAAAA;gBAAAA,GAChBtC,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMoG,WAAiBtD;YACnB,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C,IAEnC8sD,IAAS;oBAAA,GACR51I,CAAAA;oBACHsiI,QAAQ;wBAAA,GACDtiI,EAAIsiI,MAAAA;wBACP1D,QAAQ,EAAA;oBAAA;gBAAA,GAGV5qJ,IAASpL,IAAAA,CAAKg8J,IAAAA,CAAKiD,SAAAA,CAAU3C,MAAAA,CAAO;oBACtC76J,MAAMurK,EAAOvrK,IAAAA;oBACbgoB,MAAMujJ,EAAOvjJ,IAAAA;oBACbymB,QAAQ;wBAAA,GACD88H,CAAAA;oBAAAA;gBAAAA;gBAGX,OAAIrS,EAAQvvJ,KACDA,EAAO+hB,IAAAA,CAAM/hB,CAAAA,IACT,CAAA;wBACHkf,QAAQ;wBACRlnB,OAAyB,YAAlBgI,EAAOkf,MAAAA,GACRlf,EAAOhI,KAAAA,GACPpD,IAAAA,CAAKg8J,IAAAA,CAAKsD,UAAAA,CAAW;4BACnB,IAAA,SAAIr4J;gCACA,OAAO,IAAI6uJ,EAASkX,EAAOtT,MAAAA,CAAO1D,MAAAA;4BACtC;4BACA91C,OAAO8sD,EAAOvrK,IAAAA;wBAAAA;oBAAAA,CAAAA,KAMvB;oBACH6oB,QAAQ;oBACRlnB,OAAyB,YAAlBgI,EAAOkf,MAAAA,GACRlf,EAAOhI,KAAAA,GACPpD,IAAAA,CAAKg8J,IAAAA,CAAKsD,UAAAA,CAAW;wBACnB,IAAA,SAAIr4J;4BACA,OAAO,IAAI6uJ,EAASkX,EAAOtT,MAAAA,CAAO1D,MAAAA;wBACtC;wBACA91C,OAAO8sD,EAAOvrK,IAAAA;oBAAAA;gBAAAA;YAIlC;YACA,cAAAwrK;gBACI,OAAOjtK,IAAAA,CAAKg8J,IAAAA,CAAKiD,SACrB;YAAA;QAAA;QAEJI,GAASzjG,MAAAA,GAAS,CAACn1D,GAAMwyJ,IACd,IAAIoG,GAAS;gBAChBJ,WAAWx4J;gBACXm6B,UAAUy8H,GAAsBgC,QAAAA;gBAChCC,YAAoC,cAAA,OAAjBrG,EAAOtD,KAAAA,GAAuBsD,EAAOtD,KAAAA,GAAQ,IAAMsD,EAAOtD,KAAAA;gBAAAA,GAC1E+F,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMiU,WAAenR;YACjB,OAAO77C,CAAAA,EAAAA;gBAEH,IADmBlgH,IAAAA,CAAKi8J,QAAAA,CAAS/7C,OACdg1C,EAAcE,GAAAA,EAAK;oBAClC,MAAMh+H,IAAMp3B,IAAAA,CAAKk8J,eAAAA,CAAgBh8C;oBAMjC,OALAs5C,EAAkBpiI,GAAK;wBACnB2vF,MAAM8uC,EAAauB,YAAAA;wBACnBE,UAAUpC,EAAcE,GAAAA;wBACxBiC,UAAUjgI,EAAI+kI,UAAAA;oBAAAA,IAEXlC;gBACX;gBACA,OAAO;oBAAE3vI,QAAQ;oBAASlnB,OAAO88G,EAAMz+G,IAAAA;gBAAAA;YAC3C;QAAA;QAEJyrK,GAAOtxG,MAAAA,GAAUq9F,CAAAA,IACN,IAAIiU,GAAO;gBACdtsI,UAAUy8H,GAAsB6P,MAAAA;gBAAAA,GAC7BxR,EAAoBzC,EAAAA;YAAAA;QAG/B,MAAMkU,KAAQjqK,OAAO;QACrB,MAAMi8J,WAAmBpD;YACrB,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,KAAE9oF,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C,IACnCz+G,IAAO21B,EAAI31B,IAAAA;gBACjB,OAAOzB,IAAAA,CAAKg8J,IAAAA,CAAKv1J,IAAAA,CAAK61J,MAAAA,CAAO;oBACzB76J,MAAAA;oBACAgoB,MAAM2N,EAAI3N,IAAAA;oBACVymB,QAAQ9Y;gBAAAA;YAEhB;YACA,SAAA0vI;gBACI,OAAO9mK,IAAAA,CAAKg8J,IAAAA,CAAKv1J,IACrB;YAAA;QAAA;QAEJ,MAAM+4J,WAAoBzD;YACtB,OAAO77C,CAAAA,EAAAA;gBACH,MAAA,EAAM,QAAE51F,CAAAA,EAAM,KAAE8M,CAAAA,EAAAA,GAAQp3B,IAAAA,CAAKo8J,mBAAAA,CAAoBl8C;gBACjD,IAAI9oF,EAAIsiI,MAAAA,CAAO10F,KAAAA,EAqBX,OApBoBA,AAAAA,CAAAA;oBAChB,MAAMooG,IAAAA,MAAiBptK,IAAAA,CAAKg8J,IAAAA,CAAK18F,EAAAA,CAAGi9F,WAAAA,CAAY;wBAC5C96J,MAAM21B,EAAI31B,IAAAA;wBACVgoB,MAAM2N,EAAI3N,IAAAA;wBACVymB,QAAQ9Y;oBAAAA;oBAEZ,OAAwB,cAApBg2I,EAAS9iJ,MAAAA,GACF2vI,IACa,YAApBmT,EAAS9iJ,MAAAA,GACTA,CAAAA,EAAOkuB,KAAAA,IACA+hH,EAAM6S,EAAShqK,KAAAA,CAAAA,IAGfpD,IAAAA,CAAKg8J,IAAAA,CAAK7iC,GAAAA,CAAIojC,WAAAA,CAAY;wBAC7B96J,MAAM2rK,EAAShqK,KAAAA;wBACfqmB,MAAM2N,EAAI3N,IAAAA;wBACVymB,QAAQ9Y;oBAAAA;gBAEhB,CAAA;gBAIH;oBACD,MAAMg2I,IAAWptK,IAAAA,CAAKg8J,IAAAA,CAAK18F,EAAAA,CAAG+8F,UAAAA,CAAW;wBACrC56J,MAAM21B,EAAI31B,IAAAA;wBACVgoB,MAAM2N,EAAI3N,IAAAA;wBACVymB,QAAQ9Y;oBAAAA;oBAEZ,OAAwB,cAApBg2I,EAAS9iJ,MAAAA,GACF2vI,IACa,YAApBmT,EAAS9iJ,MAAAA,GACTA,CAAAA,EAAOkuB,KAAAA,IACA;wBACHluB,QAAQ;wBACRlnB,OAAOgqK,EAAShqK,KAAAA;oBAAAA,CAAAA,IAIbpD,IAAAA,CAAKg8J,IAAAA,CAAK7iC,GAAAA,CAAIkjC,UAAAA,CAAW;wBAC5B56J,MAAM2rK,EAAShqK,KAAAA;wBACfqmB,MAAM2N,EAAI3N,IAAAA;wBACVymB,QAAQ9Y;oBAAAA;gBAGpB;YACJ;YACA,OAAA,OAAch1B,CAAAA,EAAGkQ,CAAAA,EAAAA;gBACb,OAAO,IAAIktJ,GAAY;oBACnBlgG,IAAIl9D;oBACJ+2H,KAAK7mH;oBACLsuB,UAAUy8H,GAAsBmC,WAAAA;gBAAAA;YAExC;QAAA;QAEJ,MAAMC,WAAoB1D;YACtB,OAAO77C,CAAAA,EAAAA;gBACH,MAAM90G,IAASpL,IAAAA,CAAKg8J,IAAAA,CAAKiD,SAAAA,CAAU3C,MAAAA,CAAOp8C,IACpCp6G,IAAUrE,CAAAA,IACRgN,CAAAA,EAAQhN,MACRA,CAAAA,EAAK2B,KAAAA,GAAQZ,OAAOsD,MAAAA,CAAOrE,EAAK2B,KAAAA,CAAAA,GAE7B3B,CAAAA;gBAEX,OAAOk5J,EAAQvvJ,KACTA,EAAO+hB,IAAAA,CAAM1rB,CAAAA,IAASqE,EAAOrE,MAC7BqE,EAAOsF;YACjB;YACA,SAAA07J;gBACI,OAAO9mK,IAAAA,CAAKg8J,IAAAA,CAAKiD,SACrB;YAAA;QAAA;QASJ,SAASzG,GAAO9M,CAAAA,EAAOuN,IAAS,CAAC,CAAA,EAWjCxgJ,CAAAA;YACI,OAAIizI,IACOsa,GAAOpqG,MAAAA,GAAS2hG,WAAAA,CAAY,CAAC97J,GAAM21B;gBACtC,IAAI9tB,GAAIG;gBACR,IAAA,CAAKiiJ,EAAMjqJ,IAAO;oBACd,MAAM6U,IAAsB,cAAA,OAAX2iJ,IACXA,EAAOx3J,KACW,YAAA,OAAXw3J,IACH;wBAAEt+I,SAASs+I;oBAAAA,IACXA,GACJqU,IAA0E,SAAhE7jK,CAAAA,IAAwB,SAAlBH,CAAAA,IAAKgN,EAAEmC,KAAAA,AAAAA,KAAAA,KAA0B,MAAPnP,IAAgBA,IAAKmP,CAAAA,KAAAA,KAA0B,MAAPhP,KAAgBA,GAClG4uF,IAAkB,YAAA,OAAN/hF,IAAiB;wBAAEqE,SAASrE;oBAAAA,IAAMA;oBACpD8gB,EAAI6+H,QAAAA,CAAS;wBAAElvC,MAAM;wBAAA,GAAa1uB,CAAAA;wBAAI5/E,OAAO60J;oBAAAA;gBACjD;YAAA,KAEDtH,GAAOpqG,MAAAA;QAClB;QAlCA6jG,GAAY7jG,MAAAA,GAAS,CAACn1D,GAAMwyJ,IACjB,IAAIwG,GAAY;gBACnBR,WAAWx4J;gBACXm6B,UAAUy8H,GAAsBoC,WAAAA;gBAAAA,GAC7B/D,EAAoBzC,EAAAA;YAAAA;QA+B/B,MAAMsU,KAAO;YACTxsJ,QAAQ4lJ,GAAU+B,UAAAA;QAAAA;QAEtB,IAAIrL;QAAAA,CACJ,SAAWA,CAAAA;YACPA,EAAiC,SAAA,GAAI,aACrCA,EAAiC,SAAA,GAAI,aACrCA,EAA8B,MAAA,GAAI,UAClCA,EAAiC,SAAA,GAAI,aACrCA,EAAkC,UAAA,GAAI,cACtCA,EAA+B,OAAA,GAAI,WACnCA,EAAiC,SAAA,GAAI,aACrCA,EAAoC,YAAA,GAAI,gBACxCA,EAA+B,OAAA,GAAI,WACnCA,EAA8B,MAAA,GAAI,UAClCA,EAAkC,UAAA,GAAI,cACtCA,EAAgC,QAAA,GAAI,YACpCA,EAA+B,OAAA,GAAI,WACnCA,EAAgC,QAAA,GAAI,YACpCA,EAAiC,SAAA,GAAI,aACrCA,EAAgC,QAAA,GAAI,YACpCA,EAA6C,qBAAA,GAAI,yBACjDA,EAAuC,eAAA,GAAI,mBAC3CA,EAAgC,QAAA,GAAI,YACpCA,EAAiC,SAAA,GAAI,aACrCA,EAA8B,MAAA,GAAI,UAClCA,EAA8B,MAAA,GAAI,UAClCA,EAAmC,WAAA,GAAI,eACvCA,EAA+B,OAAA,GAAI,WACnCA,EAAkC,UAAA,GAAI,cACtCA,EAA+B,OAAA,GAAI,WACnCA,EAAkC,UAAA,GAAI,cACtCA,EAAqC,aAAA,GAAI,iBACzCA,EAAmC,WAAA,GAAI,eACvCA,EAAmC,WAAA,GAAI,eACvCA,EAAkC,UAAA,GAAI,cACtCA,EAAgC,QAAA,GAAI,YACpCA,EAAkC,UAAA,GAAI,cACtCA,EAAkC,UAAA,GAAI,cACtCA,EAAmC,WAAA,GAAI,eACvCA,EAAmC,WAAA,GAAI;QAC1C,EAAEA,MAA0BA,CAAAA,KAAwB,CAAC,CAAA;QACtD,MAKMmQ,KAAahM,GAAU5lG,MAAAA,EACvB6xG,KAAatJ,GAAUvoG,MAAAA,EACvB8xG,KAAUR,GAAOtxG,MAAAA,EACjB+xG,KAAatI,GAAUzpG,MAAAA,EACvBgyG,KAAcpI,GAAW5pG,MAAAA,EACzBiyG,KAAWpI,GAAQ7pG,MAAAA,EACnBkyG,KAAajI,GAAUjqG,MAAAA,EACvBmyG,KAAgBjI,GAAalqG,MAAAA,EAC7BoyG,KAAWjI,GAAQnqG,MAAAA,EACnBqyG,KAAUjI,GAAOpqG,MAAAA,EACjBsyG,KAAchI,GAAWtqG,MAAAA,EACzBuyG,KAAY/H,GAASxqG,MAAAA,EACrBwyG,KAAW9H,GAAQ1qG,MAAAA,EACnByyG,KAAY5P,GAAS7iG,MAAAA,EACrB0yG,KAAa3H,GAAU/qG,MAAAA,EACvB2yG,KAAmB5H,GAAU8B,YAAAA,EAC7B+F,KAAY5P,GAAShjG,MAAAA,EACrB6yG,KAAyBvF,GAAsBttG,MAAAA,EAC/C8yG,KAAmB5P,GAAgBljG,MAAAA,EACnC+yG,KAAY5H,GAASnrG,MAAAA,EACrBgzG,KAAatE,GAAU1uG,MAAAA,EACvBizG,KAAUjE,GAAOhvG,MAAAA,EACjBkzG,KAAUhE,GAAOlvG,MAAAA,EACjBmzG,KAAe7D,GAAYtvG,MAAAA,EAC3BozG,KAAWnG,GAAQjtG,MAAAA,EACnBqzG,KAAcnG,GAAWltG,MAAAA,EACzBszG,KAAWnG,GAAQntG,MAAAA,EACnBuzG,KAAiBnG,GAAcptG,MAAAA,EAC/BwzG,KAAc1Q,GAAW9iG,MAAAA,EACzByzG,KAAclS,GAAWvhG,MAAAA,EACzB0zG,KAAe/Q,GAAY3iG,MAAAA,EAC3B2zG,KAAe/Q,GAAY5iG,MAAAA,EAC3B4zG,KAAiBrS,GAAW0P,oBAAAA,EAC5B4C,KAAejQ,GAAY5jG,MAAAA,EAI3B6lG,KAAS;YACXhvJ,QAAUg6J,CAAAA,IAAQjL,GAAU5lG,MAAAA,CAAO;oBAAA,GAAK6wG,CAAAA;oBAAKhL,QAAAA,CAAQ;gBAAA;YACrDpM,QAAUoX,CAAAA,IAAQtI,GAAUvoG,MAAAA,CAAO;oBAAA,GAAK6wG,CAAAA;oBAAKhL,QAAAA,CAAQ;gBAAA;YACrDnM,SAAWmX,CAAAA,IAAQjH,GAAW5pG,MAAAA,CAAO;oBAAA,GAC9B6wG,CAAAA;oBACHhL,QAAAA,CAAQ;gBAAA;YAEZjM,QAAUiX,CAAAA,IAAQpH,GAAUzpG,MAAAA,CAAO;oBAAA,GAAK6wG,CAAAA;oBAAKhL,QAAAA,CAAQ;gBAAA;YACrD7L,MAAQ6W,CAAAA,IAAQhH,GAAQ7pG,MAAAA,CAAO;oBAAA,GAAK6wG,CAAAA;oBAAKhL,QAAAA,CAAQ;gBAAA;QAAA,GAE/CiO,KAAQzV;QAEd,IAAIpxI,KAAiBrmB,OAAOsD,MAAAA,CAAO;YAC/BwwJ,WAAW;YACXqZ,iBAAiBxY;YACjByY,aApyHJ,SAAqB3vK,CAAAA;gBACjB64J,IAAmB74J;YACvB;YAmyHI84J,aAAaA;YACbC,WAAWA;YACX6W,YApwHe,EAAA;YAqwHfrW,mBAAmBA;YACnBK,aAAaA;YACbI,SAASA;YACTM,OAAOA;YACPC,IAAIA;YACJC,WAAWA;YACXC,SAASA;YACTjsJ,SAASA;YACTksJ,SAASA;YACT,IAAA,QAAI7G;gBAAU,OAAOA;YAAM;YAC3B,IAAA,cAAIC;gBAAgB,OAAOA;YAAY;YACvCmB,eAAeA;YACfC,eAAeA;YACf4G,SAASA;YACT+E,eAAeA;YACfU,WAAWA;YACX2C,WAAWA;YACXkB,WAAWA;YACXG,YAAYA;YACZC,SAASA;YACTI,WAAWA;YACXC,cAAcA;YACdC,SAASA;YACTC,QAAQA;YACRE,YAAYA;YACZE,UAAUA;YACVE,SAASA;YACT7H,UAAUA;YACVkI,WAAWA;YACX/H,UAAUA;YACVsK,uBAAuBA;YACvBpK,iBAAiBA;YACjBiI,UAAUA;YACVuD,WAAWA;YACXM,QAAQA;YACRE,QAAQA;YACRI,aAAaA;YACbrC,SAASA;YACTC,YAAYA;YACZC,SAASA;YACTC,eAAeA;YACftK,YAAYA;YACZvB,YAAYA;YACZ2S,gBAAgB3S;YAChBoB,aAAaA;YACbC,aAAaA;YACbQ,YAAYA;YACZK,UAAUA;YACV6N,QAAQA;YACRC,OAAOA;YACPhO,YAAYA;YACZK,aAAaA;YACbC,aAAaA;YACbjH,QAAQA;YACRuX,QAAQhU;YACRiU,WAAWjU;YACXwR,MAAMA;YACN,IAAA,yBAAIlQ;gBAA2B,OAAOA;YAAuB;YAC7DoE,QAAQA;YACRzkG,KAAKixG;YACLnjK,OAAOujK;YACP7Y,QAAQmY;YACRrY,SAASsY;YACThY,MAAMiY;YACNoC,oBAAoBxB;YACpBnR,QAAQ+R;YACR,MAAQH;YACR,UAAYH;YACZ,YAjImB,CAEvBmB,GAAKjX,IAAS;gBACVt+I,SAAS,CAAA,sBAAA,EAAyBu1J,EAAIzhJ,IAAAA,EAAAA;YAAAA,CAAAA,GACpC+pI,GAAQ/2J,CAAAA,IAASA,aAAgByuK,GAAKjX;YA8HxCp9I,cAAc6yJ;YACdyB,MAAMnB;YACNoB,SAASnB;YACThvK,KAAK4uK;YACLzZ,KAAKsY;YACL2C,YAAYlB;YACZ9I,OAAO8H;YACP,MAAQH;YACRrQ,UAAU4R;YACVla,QAAQoY;YACR1sJ,QAAQutJ;YACRgC,UApGa,IAAM1C,KAAclQ,QAAAA;YAqGjC6S,SAtGY,IAAM9C,KAAa/P,QAAAA;YAuG/BA,UAAU4R;YACVkB,SAzGY,IAAMhD,KAAa9P,QAAAA;YA0G/B+S,UAAUhB;YACV3C,YAAY0C;YACZ3oK,SAASuoK;YACTsB,QAAQ9B;YACR5jJ,KAAK8jJ;YACL6B,cAAcpC;YACd97J,QAAQ+6J;YACR/X,QAAQqY;YACR8C,aAAavB;YACbwB,OAAOlC;YACP,WAAaZ;YACb+C,OAAOtC;YACPvgC,SAASigC;YACT,MAAQE;YACRsB,OAAOA;YACP7Z,cAAcA;YACdkb,eA5nImBnuK,CAAAA,IACNrB,KAAKC,SAAAA,CAAUoB,GAAK,MAAM,GAC3Bo5B,OAAAA,CAAQ,eAAe;YA2nInC85H,UAAUA;QAAAA;QCxxId,MAAMkb,KAAmBnoJ,GAAE9H,MAAAA,CAAO;YAC/B0N,MAAM5F,GAAEpW,MAAAA;YACRhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBhtK,OAAOylB,GAAEwsI,MAAAA,GAASoP,GAAAA;QAAAA,IAGfwM,KAAoBpoJ,GAAE9H,MAAAA,CAAO;YAChC0N,MAAM5F,GAAEpW,MAAAA;YACRhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBhtK,OAAOylB,GAAEysI,OAAAA;QAAAA,IAGN4b,KAAqBroJ,GAAE9H,MAAAA,CAAO;YACjC0N,MAAM5F,GAAEpW,MAAAA;YACRhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBhtK,OAAOylB,GAAEwsI,MAAAA;QAAAA,IAGN8b,KAAsBtoJ,GAAE9H,MAAAA,CAAO;YAClC0N,MAAM5F,GAAEpW,MAAAA;YACRhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBhtK,OAAOylB,GAAEpW,MAAAA;QAAAA,IAGN2+J,KAAoBvoJ,GAAE9H,MAAAA,CAAO;YAChC0N,MAAM5F,GAAEpW,MAAAA;YACRhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBhtK,OAAOylB,GAAEpW,MAAAA;QAAAA,IAGN4+J,KAAqBxoJ,GAAE9H,MAAAA,CAAO;YACjC0N,MAAM5F,GAAEpW,MAAAA;YACRhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBhtK,OAAOylB,GAAEpW,MAAAA;QAAAA,IAGN6+J,KAAsBzoJ,GAAE9H,MAAAA,CAAO;YAClC0N,MAAM5F,GAAEpW,MAAAA;YACRhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBhtK,OAAOylB,GAAEwsI,MAAAA;QAAAA,IAGNkc,KAAgB1oJ,GAAEonJ,kBAAAA,CAAmB,QAAQ;YAChDe;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;SAAAA,GAGGE,KAAqB3oJ,GAAE9H,MAAAA,CAAO;YACjC0N,MAAM5F,GAAEpW,MAAAA;YACRhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBqB,OAAO5oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClBrjJ,QAAQwO,GAAEwsI,MAAAA;YACVl7I,OAAO0O,GAAEwsI,MAAAA;YACT/oJ,GAAGuc,GAAEwsI,MAAAA;YACLjrJ,GAAGye,GAAEwsI,MAAAA;YACLz1J,IAAIipB,GAAEwsI,MAAAA;YACNzsI,SAASC,GAAEwsI,MAAAA;YACXqc,YAAY7oJ,GAAE/d,KAAAA,CAAMymK,IAAe7T,QAAAA;YACnCl+G,SAAS32B,GAAEysI,OAAAA;YACXqc,WAAW9oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACtBkU,WAAW/oJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACtBmU,WAAWhpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACtBoU,SAASjpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACpBqU,SAASlpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;QAAAA,IAGjBsU,KAAoBR,GAAmBpK,MAAAA,CAAO;YACjD3lK,MAAMonB,GAAE/d,KAAAA,CAAM+d,GAAEwsI,MAAAA;YAChB4c,UAAUppJ,GAAEunJ,OAAAA,CAAQ;QAAA,IAGjB8B,KAAqBV,GAAmBpK,MAAAA,CAAO;YAClD3lK,MAAMonB,GAAE/d,KAAAA,CAAM+d,GAAEwsI,MAAAA;YAChB4c,UAAUppJ,GAAEunJ,OAAAA,CAAQ;YACpB+B,aAAatpJ,GAAEunJ,OAAAA,CAAQ;QAAA,IAGpBgC,KAAqBZ,GAAmBpK,MAAAA,CAAO;YAClD3lK,MAAMonB,GAAE/d,KAAAA,CAAM+d,GAAEwsI,MAAAA;YAChB4c,UAAUppJ,GAAEunJ,OAAAA,CAAQ;YACpB+B,aAAatpJ,GAAEunJ,OAAAA,CAAQ;QAAA,IAGpBiC,KAA0Bb,GAAmBpK,MAAAA,CAAO;YACvD3lK,MAAMonB,GAAE/d,KAAAA,CAAM+d,GAAEwsI,MAAAA;YAChB4c,UAAUppJ,GAAEunJ,OAAAA,CAAQ;YACpB+B,aAAatpJ,GAAEunJ,OAAAA,CAAQ;QAAA,IAGpBkC,KAAuBd,GAAmBpK,MAAAA,CAAO;YACpD3lK,MAAMonB,GAAEpW,MAAAA;YACRw/J,UAAUppJ,GAAEunJ,OAAAA,CAAQ;YACpB+B,aAAatpJ,GAAEpW,MAAAA,GAASirJ,QAAAA;QAAAA,IAIrB6U,KAA4B1pJ,GAAE9H,MAAAA,CAAO;YACxCzU,GAAGuc,GAAEwsI,MAAAA;YACLjrJ,GAAGye,GAAEwsI,MAAAA;YACLl7I,OAAO0O,GAAEwsI,MAAAA;YACTh7I,QAAQwO,GAAEwsI,MAAAA;YACV5zJ,MAAMonB,GAAEpW,MAAAA;QAAAA,IAEL+/J,KAAyB3pJ,GAAE9H,MAAAA,CAAO;YACrCzU,GAAGuc,GAAEwsI,MAAAA;YACLjrJ,GAAGye,GAAEwsI,MAAAA;YACLl7I,OAAO0O,GAAEwsI,MAAAA;YACTh7I,QAAQwO,GAAEwsI,MAAAA;YACV5zJ,MAAMonB,GAAE/d,KAAAA,CAAM+d,GAAEwsI,MAAAA;QAAAA,IAGbod,KAAsB5pJ,GAAEioJ,KAAAA,CAAM;YACjCyB;YACAC;SAAAA,GAGUE,KAAyBlB,GAAmBpK,MAAAA,CAAO;YAC7DuL,QAAQ9pJ,GAAEwsI,MAAAA;YACVud,QAAQ/pJ,GAAEwsI,MAAAA;YACV/Z,QAAQzyH,GAAE/d,KAAAA,CAAM2nK;YAChBR,UAAUppJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACrByU,aAAatpJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACxBj8J,MAAMonB,GAAE/nB,SAAAA;QAAAA,IAGE+xK,KAAiBhqJ,GAAEioJ,KAAAA,CAAM;YACnCwB;YACAN;YACAE;YACAE;YACAC;YACAK;SAAAA;QAGI,SAASI,GAAcxmK,CAAAA;YAC3B,OAA+B,aAAvBA,EAAU2lK,QACrB;QAAA;QAEO,SAASc,GAAMzmK,CAAAA;YACnB,OAA+B,UAAvBA,EAAU2lK,QAAAA,IAAsBloK,MAAMoX,OAAAA,CAAS7U,EAAU7K,IAAAA;QACpE;QAEA,MAAMuxK,KAAanqJ,GAAE9H,MAAAA,CAAO;YACzBzU,GAAGuc,GAAEwsI,MAAAA;YACLjrJ,GAAGye,GAAEwsI,MAAAA;QAAAA,IAGF4d,KAAepqJ,GAAE/d,KAAAA,CAAMkoK,KAEhBE,KAAYrqJ,GAAE9H,MAAAA,CAAO;YAC/B6S,MAAM/K,GAAEpW,MAAAA;YACRkB,OAAOkV,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClByV,YAAYtqJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACvB0V,WAAWvqJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACtBxY,MAAMr8H,GAAEysI,OAAAA,GAAUoI,QAAAA;YAClB2V,QAAQxqJ,GAAEioJ,KAAAA,CAAM;gBAACjoJ,GAAEunJ,OAAAA,CAAQ;gBAASvnJ,GAAEunJ,OAAAA,CAAQ;gBAAWvnJ,GAAEunJ,OAAAA,CAAQ;gBAAUvnJ,GAAEunJ,OAAAA,CAAQ;aAAA,EAAa1S,QAAAA;YACpG4V,QAAQzqJ,GAAEioJ,KAAAA,CAAM;gBAACjoJ,GAAEunJ,OAAAA,CAAQ;gBAAQvnJ,GAAEunJ,OAAAA,CAAQ;gBAAWvnJ,GAAEunJ,OAAAA,CAAQ;aAAA,EAAY1S,QAAAA;QAAAA,IAG3E6V,KAAc1qJ,GAAE9H,MAAAA,CAAO;YAC1BnhB,IAAIipB,GAAEwsI,MAAAA,GAASqI,QAAAA;YACfjvI,MAAM5F,GAAEpW,MAAAA,GAASirJ,QAAAA;YACjBj3J,MAAMoiB,GAAEpW,MAAAA,GAASirJ,QAAAA;YACjBpxJ,GAAGuc,GAAEwsI,MAAAA,GAASqI,QAAAA;YACdtzJ,GAAGye,GAAEwsI,MAAAA,GAASqI,QAAAA;YACd/6I,UAAUkG,GAAEwsI,MAAAA,GAASqI,QAAAA;YACrBrjJ,QAAQwO,GAAEwsI,MAAAA,GAASqI,QAAAA;YACnBvjJ,OAAO0O,GAAEwsI,MAAAA,GAASqI,QAAAA;YAClBl+G,SAAS32B,GAAEysI,OAAAA,GAAUoI,QAAAA;YACrB8V,KAAK3qJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YAChB9pI,MAAMs/I,GAAUxV,QAAAA;YAChB9gJ,OAAOiM,GAAEysI,OAAAA,GAAUoI,QAAAA;YACnB+V,SAAS5qJ,GAAEysI,OAAAA,GAAUoI,QAAAA;YACrBgW,UAAU7qJ,GAAE/d,KAAAA,CAAMkoK,IAAYtV,QAAAA;YAC9BjkF,SAASw5F,GAAavV,QAAAA;YACtBiW,UAAU9qJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACrBgU,YAAY7oJ,GAAE/d,KAAAA,CAAMymK,IAAe7T,QAAAA;QAAAA,IAGhCtlB,KAAiBvvH,GAAE9H,MAAAA,CAAO;YAC7B20B,UAAU7sB,GAAEwsI,MAAAA;YACZue,QAAQ/qJ,GAAEwsI,MAAAA;QAAAA,IAGPwe,KAAmBhrJ,GAAE9H,MAAAA,CAAO;YAC/B0N,MAAM5F,GAAEpW,MAAAA;YACRqhK,WAAWjrJ,GAAEpW,MAAAA;YACbhM,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBqB,OAAO5oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClBpxJ,GAAGuc,GAAEwsI,MAAAA;YACLjrJ,GAAGye,GAAEwsI,MAAAA;YACLz1J,IAAIipB,GAAEwsI,MAAAA;YACN1hJ,OAAOkV,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClBiU,WAAW9oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACtBkU,WAAW/oJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACtBmU,WAAWhpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACtBoU,SAASjpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACpBqU,SAASlpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACpB90I,SAASC,GAAEwsI,MAAAA;YACXqc,YAAY7oJ,GAAE/d,KAAAA,CAAMymK,IAAe7T,QAAAA;YACnCl+G,SAAS32B,GAAEysI,OAAAA;YACXrpH,SAASpjB,GAAE/d,KAAAA,CAAMyoK;QAAAA,IAGdQ,KAAkBlrJ,GAAE9H,MAAAA,CAAO;YAC9B0N,MAAM5F,GAAEpW,MAAAA;YACRnG,GAAGuc,GAAEwsI,MAAAA;YACLjrJ,GAAGye,GAAEwsI,MAAAA;YACLz1J,IAAIipB,GAAEwsI,MAAAA;YACN5uJ,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBqB,OAAO5oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClB/wI,OAAO9D,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClB90I,SAASC,GAAEwsI,MAAAA;YACXqc,YAAY7oJ,GAAE/d,KAAAA,CAAMymK,IAAe7T,QAAAA;YACnCl+G,SAAS32B,GAAEysI,OAAAA;YACXqc,WAAW9oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACtBsW,SAASnrJ,GAAEysI,OAAAA,GAAUoI,QAAAA;YACrBuW,SAASprJ,GAAEysI,OAAAA,GAAUoI,QAAAA;YACrBkU,WAAW/oJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACtBmU,WAAWhpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACtBoU,SAASjpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACpBqU,SAASlpJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACpBwW,kBAAkBrrJ,GAAEpW,MAAAA,GAASirJ,QAAAA;QAAAA,IAK1ByW,KAAatrJ,GAAEioJ,KAAAA,CAAM;YACxB+B;YACAkB;YACAF;SAAAA,GAIGO,KAAmBvrJ,GAAE9H,MAAAA,CAAO;YAC/B+yJ,WAAWjrJ,GAAEpW,MAAAA;YACb7S,IAAIipB,GAAEwsI,MAAAA,GAASqI,QAAAA;YACfjvI,MAAM5F,GAAEpW,MAAAA;YACRnG,GAAGuc,GAAEwsI,MAAAA;YACLjrJ,GAAGye,GAAEwsI,MAAAA;YACLzsI,SAASC,GAAEwsI,MAAAA;YACXsc,WAAW9oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACtBj3J,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChB5wH,SAAS32B,GAAEysI,OAAAA;YACXrpH,SAASpjB,GAAE/d,KAAAA,CAAMyoK;YACjB7B,YAAY7oJ,GAAE/d,KAAAA,CAAMymK,IAAe7T,QAAAA;QAAAA,IAGzB2W,KAAYxrJ,GAAE9H,MAAAA,CAAO;YAC/BnhB,IAAIipB,GAAEwsI,MAAAA;YACN5uJ,MAAMoiB,GAAEpW,MAAAA,GAASirJ,QAAAA;YACjBrlB,WAAWxvH,GAAE/d,KAAAA,CAAMstI,IAAgBslB,QAAAA;YACnC4W,aAAaF,GAAiB1W,QAAAA;YAC9B6W,aAAa1rJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACxBgU,YAAY7oJ,GAAE/d,KAAAA,CAAMymK,IAAe7T,QAAAA;YAEnC/wI,OAAO9D,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClB8W,aAAa3rJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACxB+W,YAAY5rJ,GAAEwsI,MAAAA,GAASqI,QAAAA;QAAAA,IAGpBgX,KAAuB7rJ,GAAE9H,MAAAA,CAAO;YACnC0N,MAAM5F,GAAEpW,MAAAA;YACRkiK,UAAU9rJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACrB+T,OAAO5oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClBkX,iBAAiB/rJ,GAAEioJ,KAAAA,CAAM;gBACtBjoJ,GAAEunJ,OAAAA,CAAQ;gBACVvnJ,GAAEunJ,OAAAA,CAAQ;gBACVvnJ,GAAEunJ,OAAAA,CAAQ;gBACVvnJ,GAAEunJ,OAAAA,CAAQ;gBACVvnJ,GAAEunJ,OAAAA,CAAQ;gBACVvnJ,GAAEunJ,OAAAA,CAAQ;gBACVvnJ,GAAEunJ,OAAAA,CAAQ;gBACVvnJ,GAAEunJ,OAAAA,CAAQ;gBACVvnJ,GAAEunJ,OAAAA,CAAQ;aAAA,EACV1S,QAAAA;YAEH/wI,OAAO9D,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClB+W,YAAY5rJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACvB8W,aAAa3rJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YACxB3nI,SAASlN,GAAEwsI,MAAAA;YACXwf,YAAYhsJ,GAAEwsI,MAAAA;YACdyf,WAAWjsJ,GAAEwsI,MAAAA;YACb0f,WAAWlsJ,GAAEwsI,MAAAA;YAEb/+H,MAAMzN,GAAE9H,MAAAA,CAAO;gBACZ1G,QAAQwO,GAAEwsI,MAAAA;gBACVl7I,OAAO0O,GAAEwsI,MAAAA;gBACThwE,aAAax8D,GAAEioJ,KAAAA,CAAM;oBAACjoJ,GAAEunJ,OAAAA,CAAQ;oBAAcvnJ,GAAEunJ,OAAAA,CAAQ;iBAAA;YAAA,GACxD1S,QAAAA;YAEHsX,YAAYhC,GAAWtV,QAAAA;YACvBlqI,SAAS3K,GAAEwsI,MAAAA;YACX1+H,QAAQ9N,GAAEwsI,MAAAA;YACVjwD,OAAOv8E,GAAE/d,KAAAA,CAAMupK,IAAW3W,QAAAA;YAC1BgU,YAAY7oJ,GAAE/d,KAAAA,CAAMymK,IAAe7T,QAAAA;QAAAA;QAG/B,SAASuX,GAA0B3oK,CAAAA;YACvC,OAAA,CAAA,CAAUA,EAA2BqgB,KACxC;QAAA;QAEO,SAASuoJ,GAAiC5oK,CAAAA;YAC9C,OAAA,CAAWA,EAA2BqgB,KACzC;QAAA;QAEO,MAAMwoJ,KAAmBT,GAAqBtN,MAAAA,CAAO;YACzDgO,cAAcvsJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YACzBj3J,MAAMoiB,GAAEunJ,OAAAA,CAAQ;YAChBxyC,SAAS/0G,GAAEpW,MAAAA,GAASirJ,QAAAA;QAAAA,IAGjB2X,KAAuBxsJ,GAAE9H,MAAAA,CAAO;YACnC4zJ,UAAU9rJ,GAAEwsI,MAAAA;YACZ9zI,QAAQsH,GAAEpW,MAAAA;QAAAA,IAGA6iK,KAAezsJ,GAAEioJ,KAAAA,CAAM;YAAC4D;YAAsBW;SAAAA,GAE9CE,KAAgB1sJ,GAAE9H,MAAAA,CAAO;YACnCA,QAAQwyJ,GAAYnM,MAAAA,CAAO;gBAAExnK,IAAIipB,GAAEwsI,MAAAA,GAASqI,QAAAA;YAAAA;YAC5C8X,SAASH,GAAqB3X,QAAAA;YAC9Bj3J,MAAMoiB,GAAEunJ,OAAAA,CAAQ;QAAA,IAGNqF,KAAW5sJ,GAAE9H,MAAAA,CAAO;YAC9Bta,MAAMoiB,GAAEpW,MAAAA;YACRg/J,OAAO5oJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YAClB0X,cAAcvsJ,GAAEpW,MAAAA;YAChBmrH,SAAS/0G,GAAEpW,MAAAA;YACX0H,OAAO0O,GAAEwsI,MAAAA;YACTh7I,QAAQwO,GAAEwsI,MAAAA;YACVyf,WAAWjsJ,GAAEwsI,MAAAA;YACbwf,YAAYhsJ,GAAEwsI,MAAAA;YACdqgB,kBAAkB7sJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YAC7BiY,UAAU9sJ,GAAEysI,OAAAA;YACZsgB,aAAa/sJ,GAAEwsI,MAAAA;YACfwgB,cAAchtJ,GAAEwsI,MAAAA;YAChBygB,iBAAiBjtJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YAC5BqY,iBAAiBltJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YAC5BsY,eAAentJ,GAAEwsI,MAAAA,GAASqI,QAAAA;YAC1BuY,aAAaptJ,GAAEunJ,OAAAA,CAAQ,KAAKvS,EAAAA,CAAGh1I,GAAEunJ,OAAAA,CAAQ,MAAM1S,QAAAA;YAC/CwY,cAAcrtJ,GAAEunJ,OAAAA,CAAQ,OAAOvS,EAAAA,CAAGh1I,GAAEunJ,OAAAA,CAAQ,SAAS1S,QAAAA;YACrDr4E,aAAax8D,GAAEioJ,KAAAA,CAAM;gBAACjoJ,GAAEunJ,OAAAA,CAAQ;gBAAcvnJ,GAAEunJ,OAAAA,CAAQ;gBAAevnJ,GAAEunJ,OAAAA,CAAQ;gBAAcvnJ,GAAEunJ,OAAAA,CAAQ;aAAA;YACzG+F,aAAattJ,GAAEioJ,KAAAA,CAAM;gBAACjoJ,GAAEunJ,OAAAA,CAAQ;gBAAevnJ,GAAEunJ,OAAAA,CAAQ;gBAAavnJ,GAAEunJ,OAAAA,CAAQ;gBAAcvnJ,GAAEunJ,OAAAA,CAAQ;aAAA;YACxGgG,iBAAiBvtJ,GAAEpW,MAAAA,GAASirJ,QAAAA;YAC5B2Y,QAAQxtJ,GAAE/d,KAAAA,CAAMqpK;YAChBmC,UAAUztJ,GAAE/d,KAAAA,CAAMwqK;YAClB5D,YAAY7oJ,GAAE/d,KAAAA,CAAMymK,IAAe7T,QAAAA;QAAAA;QAwB/B,SAAS6Y,GAAgBC,CAAAA;YAC7B,OAAA,CAAA,CAAUA,EAAqCl7B,MAClD;QAAA;QAEO,SAASm7B,GAAuBC,CAAAA;YACpC,OAAA,CAAWA,EAA4Bn1J,MAC1C;QAAA;QAEO,SAASo1J,GAAuBD,CAAAA;YACpC,OAAA,CAAA,CAAUA,EAA4Bn1J,MACzC;QAAA;QAGA,MAAMjG;YACH,YAAmBhP,CAAAA,EAAkBlC,CAAAA,EAAkB+P,CAAAA,EAAsBE,CAAAA,CAAAA;gBAA1D,IAAA,CAAA/N,CAAAA,GAAAA,GAAkB,IAAA,CAAAlC,CAAAA,GAAAA,GAAkB,IAAA,CAAA+P,KAAAA,GAAAA,GAAsB,IAAA,CAAAE,MAAAA,GAAAA;YAAkB;YAE/F,QAAQ4E,CAAAA,EAAAA;gBAEL,MAAMzD,IAAQxb,IAAAA,CAAKsM,CAAAA,GAAItM,IAAAA,CAAKma,KAAAA,EACtBsB,IAASzb,IAAAA,CAAKoK,CAAAA,GAAIpK,IAAAA,CAAKqa,MAAAA,EAEvBu8J,IAAa33J,EAAM3S,CAAAA,GAAI2S,EAAM9E,KAAAA,EAC7B08J,IAAc53J,EAAM7U,CAAAA,GAAI6U,EAAM5E,MAAAA,EAE9By8J,IAAWxxK,KAAKC,GAAAA,CAAIiW,GAAOo7J,IAC3BtrI,IAAYhmC,KAAKC,GAAAA,CAAIkW,GAAQo7J;gBASnC,OANoB,IAAIv7J,GACrBhW,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAKsM,CAAAA,EAAG2S,EAAM3S,CAAAA,GACvBhH,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAKoK,CAAAA,EAAG6U,EAAM7U,CAAAA,GACvB0sK,IAAWxxK,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAKsM,CAAAA,EAAG2S,EAAM3S,CAAAA,GAClCg/B,IAAYhmC,KAAKkF,GAAAA,CAAIxK,IAAAA,CAAKoK,CAAAA,EAAG6U,EAAM7U,CAAAA;YAGzC;QAAA;QAII,MAAM2sK;YAAb,aAAA;gBA4VG,IAAA,CAAAC,cAAAA,GAAiB,IAAI17J,GAAY,GAAG,GAAG,GAAG;YA0R7C;YApnBG,cAAclY,CAAAA,EAAAA;gBACX,OAAA,CAAQA;YACX;YACA,eAAeA,CAAAA,EAAAA;gBACZ,OAAOA;oBACJ,KAAK;oBACL,KAAK;wBAAS,OAAA,CAAO;oBACrB,KAAK;wBAAQ,OAAA,CAAO;oBACpB;wBAAS,OAAA,CAAA,CAAUuiH,QAAQviH;gBAAAA;YAEjC;YAEA,YAAYqD,CAAAA,EAA0BrD,CAAAA,EAAAA;gBACnC,OAAa,WAATqD,IACMzG,IAAAA,CAAKk3K,cAAAA,CAAe9zK,KAGjB,UAATqD,KAA2B,YAATA,KAIT,aAATA,IAHMzG,IAAAA,CAAKi3K,aAAAA,CAAc7zK,KAMtBA;YACV;YAEA,qBAAqBi0K,CAAAA,EAAyBh2J,CAAAA,EAAAA;gB,I;gBAC3C,MAAMqwJ,IAAa,EAAA;gBACnB,IAAI2F,GACD,KAAK,IAAIx0K,KAAQw0K,EAAexmI,QAAAA,CAAU;oBACvC,MAAMpqC,IAAsD,SAA/C,CAAA,IAAA5D,EAAKylC,YAAAA,CAAa,OAAA,KAAA,KAA6B,MAAA,IAAA,IAAI;oBAChE,IAAIllC,IAAaP,EAAKylC,YAAAA,CAAa;oBAC9BllC,KACFA,CAAAA,IAAQP,EAAK47H,SAAAA,AAAAA,GAEhBizC,EAAW/xK,IAAAA,CAAK;wBACb8uB,MAAM5rB,EAAKylC,YAAAA,CAAa;wBACxB7hC,MAAMA;wBACNrD,OAAOpD,IAAAA,CAAKm3K,WAAAA,CAAY1wK,GAAMrD;oBAAAA;gBAEpC;gBAEHie,EAAOqwJ,UAAAA,GAAaA;YACvB;YAEA,iBAAiB/iG,CAAAA,EAAettD,CAAAA,EAAAA;gBAE7B,MAAMk2J,IAAc;oBACjB;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;iBAAA,EAIGC,IAAe;oBAClB;oBACA;oBACA;oBACA;iBAAA;gBAGH,KAAK,IAAIx5I,KAAa2wC,EAAK9xC,UAAAA,CACpB06I,EAAY9uK,OAAAA,CAAQu1B,EAAUvP,IAAAA,IAAAA,KAC/BpN,CAAAA,CAAO2c,EAAUvP,IAAAA,CAAAA,GAAQzuB,IAAAA,CAAKi3K,aAAAA,CAAcj5I,EAAU56B,KAAAA,IAC9Co0K,EAAa/uK,OAAAA,CAAQu1B,EAAUvP,IAAAA,IAAAA,KACvCpN,CAAAA,CAAO2c,EAAUvP,IAAAA,CAAAA,GAAQzuB,IAAAA,CAAKk3K,cAAAA,CAAel5I,EAAU56B,KAAAA,IAEvDie,CAAAA,CAAO2c,EAAUvP,IAAAA,CAAAA,GAAQuP,EAAU56B,KAG5C;YAAA;YAQA,iBAAiBs0K,CAAAA,EAAAA;gBACd,IAAyB,eAAA,OAAdC,WAER,OAAA,AADkB,CAAA,IAAIA,SAAAA,EACLC,eAAAA,CAAgBF,GAAK;gBAGzC,IAAA;oBACG,MAAA,EAAM,OAAEG,CAAAA,EAAAA,GAAU,EAAQ;oBAK1B,OAJY,IAAIA,EAAMH,GAAK;wBACxBI,aAAa;wBACb7F,UAAU;oBAAA,GAEFzuK,MAAAA,CAAO+V,QACrB;gBAAA,EAAE,OAAO+F,GAAAA,CAAmB;gBAE5B,MAAMrY,IAAQ,IAAId,MAAM;gBAExB,MADAyS,QAAQ3R,KAAAA,CAAMA,EAAM0T,OAAAA,EAAS1T,IACvBA;YACT;YAEA,YAAY+wK,CAAAA,EAAqBrQ,IAAAA,CAAS,CAAA,EAAA;gB,I,G;gBACvC,MAAM5mJ,IAAc;oBACpBA,MAAc;oBACdA,GAAW;oBACXA,GAAW;gBAAA;gBAENi3J,EAAW1vI,YAAAA,CAAa,eAC1BvnB,CAAAA,EAAOy+B,OAAAA,GAAAA,CAAU,GACjBz+B,EAAO0N,IAAAA,GAAO,IACd1N,EAAO4B,QAAAA,GAAW,GAClB5B,EAAO1G,MAAAA,GAAS,GAChB0G,EAAO5G,KAAAA,GAAQ,CAAA,GAGlBna,IAAAA,CAAKs3K,gBAAAA,CAAiBU,GAAYj3J;gBAGlC,MAAMs2J,IAAiBW,EAAWt5C,aAAAA,CAAc;gBAC5C24C,KACDr3K,IAAAA,CAAKo3K,oBAAAA,CAAqBC,GAAgBt2J;gBAG7C,MAAM6S,IAAOokJ,EAAWt5C,aAAAA,CAAc;gBACtC,IAAI9qG,GAAM;oBACP7S,EAAO6S,IAAAA,GAAO;wBACXA,MAAMA,EAAKmyC,WAAAA;oBAAAA;oBAGd,MAAMotG,IAAav/I,EAAK0U,YAAAA,CAAa;oBACjC6qI,KACDpyJ,CAAAA,EAAO6S,IAAAA,CAAKu/I,UAAAA,GAAaA,CAAAA;oBAG5B,MAAMx/J,IAAQigB,EAAK0U,YAAAA,CAAa;oBAC5B30B,KACDoN,CAAAA,EAAO6S,IAAAA,CAAKjgB,KAAAA,GAAQA,CAAAA;oBAGvB,MAAMy/J,IAAYx/I,EAAK0U,YAAAA,CAAa;oBAChC8qI,KACDryJ,CAAAA,EAAO6S,IAAAA,CAAKw/I,SAAAA,GAAYpzK,IAAAA,CAAKi3K,aAAAA,CAAc7D,EAAAA;oBAG9C,MAAMluB,IAAOtxH,EAAK0U,YAAAA,CAAa;oBAC3B48G,KACDnkI,CAAAA,EAAO6S,IAAAA,CAAKsxH,IAAAA,GAAOllJ,IAAAA,CAAKk3K,cAAAA,CAAehyB,EAAAA;oBAG1C,MAAMouB,IAAS1/I,EAAK0U,YAAAA,CAAa;oBAC7BgrI,KACDvyJ,CAAAA,EAAO6S,IAAAA,CAAK0/I,MAAAA,GAASA,CAAAA;oBAExB,MAAMD,IAASz/I,EAAK0U,YAAAA,CAAa;oBAC7B+qI,KACDtyJ,CAAAA,EAAO6S,IAAAA,CAAKy/I,MAAAA,GAASA,CAAAA;gBAE3B;gBAEc2E,EAAWt5C,aAAAA,CAAc,YAEpC39G,CAAAA,EAAOnE,KAAAA,GAAAA,CAAQ,CAAA;gBAGFo7J,EAAWt5C,aAAAA,CAAc,cAEtC39G,CAAAA,EAAO0yJ,OAAAA,GAAAA,CAAU,CAAA;gBAIpB,MAAMh6F,IAAUu+F,EAAWt5C,aAAAA,CAAc;gBACzC,IAAIjlD,GAAS;oBACV,MAAM19D,IAAuC,SAA9B,CAAA,IAAA09D,EAAQnxC,YAAAA,CAAa,SAAA,KAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAEjT,KAAAA,CAAM;oBACrDtU,EAAO04D,OAAAA,GAAU,EAAA,EACb19D,KACDA,EAAOoiC,OAAAA,CAAQ7nC,CAAAA;wBACZ,MAAMsG,IAAQtG,EAAE+e,KAAAA,CAAM;wBACtBtU,EAAO04D,OAAAA,CAAQ95E,IAAAA,CAAK;4BACjB2M,GAAAA,CAAIsQ,CAAAA,CAAM,EAAA;4BACVxS,GAAAA,CAAIwS,CAAAA,CAAM,EAAA;wBAAA;oBACX;gBAGX;gBAEA,MAAM82J,IAAWsE,EAAWt5C,aAAAA,CAAc;gBAC1C,IAAIg1C,GAAU;oBACX,MAAM33J,IAAwC,SAA/B,CAAA,IAAA23J,EAASprI,YAAAA,CAAa,SAAA,KAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAEjT,KAAAA,CAAM;oBACtDtU,EAAO2yJ,QAAAA,GAAW,EAAA,EACd33J,KACDA,EAAOoiC,OAAAA,CAAQ7nC,CAAAA;wBACZ,MAAMsG,IAAQtG,EAAE+e,KAAAA,CAAM;wBACtBtU,EAAO2yJ,QAAAA,CAAS/zK,IAAAA,CAAK;4BAClB2M,GAAAA,CAAIsQ,CAAAA,CAAM,EAAA;4BACVxS,GAAAA,CAAIwS,CAAAA,CAAM,EAAA;wBAAA;oBACX;gBAGX;gBAEA,IAAI+qJ,GACD,IAAA;oBACG,OAAO4L,GAAYj1G,KAAAA,CAAMv9C;gBAC5B,EAAE,OAAOzB,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,0BAA0B8Z,GAAQzB,IAC1CA;gBACT;gBAEH,OAAOyB;YACV;YAEA,aAAam3J,CAAAA,EAAsBvQ,IAAAA,CAAS,CAAA,EAAA;gBACzC,MAAM6N,IAAe;oBACrBA,SAAkB;oBAClBA,QAAiB;gBAAA;gBAGjB,IAFAx1K,IAAAA,CAAKs3K,gBAAAA,CAAiBY,GAAa1C,IAE/BA,EAAQj0J,MAAAA,EACT,IAAA;oBACG,OAAO+zJ,GAAah3G,KAAAA,CAAMk3G;gBAC7B,EAAE,OAAOl2J,GAAAA;oBACN1G,QAAQ3R,KAAAA,CAAM,oCAAoCuuK,GAASl2J;gBAC9D;gBAGH,KAAK,IAAI64J,KAAgBD,EAAYrnI,QAAAA,CAClC,OAAQsnI,EAAaC,OAAAA;oBAClB,KAAK;wBACFp4K,IAAAA,CAAKo3K,oBAAAA,CAAqBe,GAAc3C;wBACxC;oBAEH,KAAK;wBAAc;4BAChB,MAAMR,IAAkB,CAAC;4BACzBh1K,IAAAA,CAAKs3K,gBAAAA,CAAiBa,GAAcnD,IACpCQ,EAAQR,UAAAA,GAAaA;4BACrB;wBACH;oBACA,KAAK;wBAAQ;4BACV,MAAM1+I,IAAY,CAAC;4BACnBt2B,IAAAA,CAAKs3K,gBAAAA,CAAiBa,GAAc7hJ,IACpCk/I,EAAQl/I,IAAAA,GAAOA;4BACf;wBACH;oBACA,KAAK;wBACFk/I,EAAQ7oJ,KAAAA,GAAQwrJ,EAAa7vI,YAAAA,CAAa,WAC1CktI,EAAQf,UAAAA,GAAaz0K,IAAAA,CAAKi3K,aAAAA,CAAckB,EAAa7vI,YAAAA,CAAa,WAClEktI,EAAQhB,WAAAA,GAAcx0K,IAAAA,CAAKi3K,aAAAA,CAAckB,EAAa7vI,YAAAA,CAAa;wBACnE;oBAEH,KAAK;wBAAQ;4BACLktI,EAAQpwE,KAAAA,IACVowE,CAAAA,EAAQpwE,KAAAA,GAAQ,EAAA,AAAA;4BAEnB,MAAMiB,IAAY,CAAC;4BACnBrmG,IAAAA,CAAKs3K,gBAAAA,CAAiBa,GAAc9xE;4BACpC,KAAK,IAAIgyE,KAAaF,EAAatnI,QAAAA,CAChC,OAAQwnI,EAAUD,OAAAA;gCACf,KAAK;oCACF/xE,EAAK15E,KAAAA,GAAQ0rJ,EAAU/vI,YAAAA,CAAa,WACpC+9D,EAAKouE,UAAAA,GAAaz0K,IAAAA,CAAKi3K,aAAAA,CAAcoB,EAAU/vI,YAAAA,CAAa,WAC5D+9D,EAAKmuE,WAAAA,GAAcx0K,IAAAA,CAAKi3K,aAAAA,CAAcoB,EAAU/vI,YAAAA,CAAa;oCAC7D;gCAEH,KAAK;oCAAe;wCACjB,MAAMgsI,IAAmB;4CACzBA,MAAmB;4CACnBA,MAAmB;4CACnBA,SAAAA,CAAsB;4CACtBA,GAAgB;4CAChBA,GAAgB;4CAChBA,SAAsB;4CACtBA,SAAsB,EAAA;wCAAA;wCACtBt0K,IAAAA,CAAKs3K,gBAAAA,CAAiBe,GAAW/D,IACjCjuE,EAAKiuE,WAAAA,GAAcA;wCAEnB,KAAK,IAAIgE,KAAeD,EAAUxnI,QAAAA,CAAU;4CACzC,MAAM9vB,IAAS/gB,IAAAA,CAAK+3K,WAAAA,CAAYO,GAAa3Q;4CAC7C2M,EAAYroI,OAAAA,CAAQtsC,IAAAA,CAAKohB;wCAC5B;wCACA;oCACH;gCACA,KAAK;oCAAa;wCACf,MAAMs3H,IAAiB,EAAA;wCACvB,KAAK,IAAIkgC,KAAcF,EAAUxnI,QAAAA,CAC9BwnG,EAAU14I,IAAAA,CAAK;4CACZ+1C,UAAU11C,IAAAA,CAAKi3K,aAAAA,CAAcsB,EAAWjwI,YAAAA,CAAa;4CACrDsrI,QAAQ5zK,IAAAA,CAAKi3K,aAAAA,CAAcsB,EAAWjwI,YAAAA,CAAa;wCAAA;wCAIzD+9D,EAAKgyC,SAAAA,GAAYA;wCACjB;oCACH;gCACA,KAAK;oCACFr4I,IAAAA,CAAKo3K,oBAAAA,CAAqBiB,GAAWhyE;4BAAAA;4BAM9C,IAAIshE,GACD,IAAA;gCACG6N,EAAQpwE,KAAAA,CAAMzlG,IAAAA,CAAK00K,GAAU/1G,KAAAA,CAAM+nC;4BACtC,EAAE,OAAO/mF,GAAAA;gCAEN,MADA1G,QAAQ3R,KAAAA,CAAM,wBAAwBo/F,GAAM/mF,IACtCA;4BACT;iCAEAk2J,EAAQpwE,KAAAA,CAAMzlG,IAAAA,CAAK0mG;4BAEtB;wBACH;gBAAA;gBAGN,IAAIshE,GACD,IAAA;oBACG,OAAO2N,GAAah3G,KAAAA,CAAMk3G;gBAC7B,EAAE,OAAOl2J,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,2BAA2BuuK,GAASl2J,IAC5CA;gBACT;gBAEH,OAAOk2J;YACV;YAGA,eAAeiD,CAAAA,EAAoB9C,CAAAA,EAAmBhO,IAAAA,CAAS,CAAA,EAAA;gB,I,G,G,G;gBAC5D,MAAM9mK,IAAa;oBACnBA,MAAa;oBACbA,GAAU;oBACVA,GAAU;oBACVA,SAAgB;oBAChBA,SAAAA,CAAgB;gBAAA;gBAChBb,IAAAA,CAAKs3K,gBAAAA,CAAiBmB,GAAW53K;gBAEjC,KAAK,IAAI63K,KAAcD,EAAU5nI,QAAAA,CAC9B,OAAQ6nI,EAAWN,OAAAA;oBAChB,KAAK;wBACFp4K,IAAAA,CAAKo3K,oBAAAA,CAAqBsB,GAAY73K;wBACtC;oBAEH,KAAK;wBAAQ;4BACV,MAAMoxK,IAAWyG,EAAWpwI,YAAAA,CAAa;4BAErC2pI,KACDpxK,CAAAA,EAAMoxK,QAAAA,GAAWA,CAAAA;4BAGpB,MAAME,IAAcuG,EAAWpwI,YAAAA,CAAa;4BAI5C,IAHI6pI,KACDtxK,CAAAA,EAAMsxK,WAAAA,GAAcA,CAAAA,GAEnBwD,GAAU;gCACX90K,EAAMsZ,KAAAA,GAAQ,GACdtZ,EAAMwZ,MAAAA,GAAS,GACfxZ,EAAMy6I,MAAAA,GAAS,EAAA;gCAEf,IAAItmH,IAAsB,IAAI1Z,GAAY,GAAG,GAAG,GAAG;gCACnD,KAAK,IAAIq9J,KAAYD,EAAW7nI,QAAAA,CAC7B,IAAyB,YAArB8nI,EAASP,OAAAA,EAAqB;oCAC/B,MAAM17B,IAAa,CAAC;oCAEpB,OADA18I,IAAAA,CAAKs3K,gBAAAA,CAAiBqB,GAAUj8B,IACxB77I,EAAMoxK,QAAAA;wCACX,KAAK;4CACFv1B,EAAMj7I,IAAAA,GAA2B,SAApB,CAAA,IAAAk3K,EAAS5yG,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE+7F,IAAAA;4CACnC;wCAEH,KAAK;4CACFplB,EAAMj7I,IAAAA,GAA2B,SAApB,CAAA,IAAAk3K,EAAS5yG,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE1wC,KAAAA,CAAM,KAAKp1B,GAAAA,CAAIL,CAAAA,IAAAA,CAAOA;oCAAAA;oCAM/D,MAAMg5K,IAAc,IAAIt9J,GAAYohI,EAAMpwI,CAAAA,EAAGowI,EAAMtyI,CAAAA,EAAGsyI,EAAMviI,KAAAA,EAAOuiI,EAAMriI,MAAAA;oCAEzE2a,IAASA,EAAOhW,OAAAA,CAAQ45J,IAExB/3K,EAAMy6I,MAAAA,CAAO37I,IAAAA,CAAK+8I;gCACrB;gCAGH77I,EAAMsZ,KAAAA,GAAQ6a,EAAO7a,KAAAA,EACrBtZ,EAAMwZ,MAAAA,GAAS2a,EAAO3a,MAAAA,EACtBxZ,EAAM8xK,MAAAA,GAAS39I,EAAO1oB,CAAAA,EACtBzL,EAAM+xK,MAAAA,GAAS59I,EAAO5qB,CAAAA,EAEtBpK,IAAAA,CAAKg3K,cAAAA,GAAiBh3K,IAAAA,CAAKg3K,cAAAA,CAAeh4J,OAAAA,CAAQ,IAAI1D,GAAYza,EAAM8xK,MAAAA,EAAQ9xK,EAAM+xK,MAAAA,EAAQ/xK,EAAMsZ,KAAAA,EAAOtZ,EAAMwZ,MAAAA;4BAEpH,OACG,OAAQxZ,EAAMoxK,QAAAA;gCACX,KAAK;oCACFpxK,EAAMY,IAAAA,GAA6B,SAAtB,CAAA,IAAAi3K,EAAW3yG,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE+7F,IAAAA;oCACrC;gCAEH,KAAK;oCACFjhK,EAAMY,IAAAA,GAA6B,SAAtB,CAAA,IAAAi3K,EAAW3yG,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,KAAA,IAAA,EAAE1wC,KAAAA,CAAM,KAAKp1B,GAAAA,CAAIL,CAAAA,IAAAA,CAAOA;4BAAAA;wBAKvE;gBAAA;gBAGN,IAAI+nK,GACD,IAAA;oBACG,OAAOwM,GAAW71G,KAAAA,CAAMz9D;gBAC3B,EAAE,OAAOye,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,oCAAoCpG,GAAOye,IACnDA;gBACT;gBAEH,OAAOze;YACV;YAEA,iBAAiBi4K,CAAAA,EAAoBnR,IAAAA,CAAS,CAAA,EAAA;gBAC3C,MAAM78F,IAAa;oBACnBA,MAAa;oBACbA,WAAkB;oBAClBA,SAAAA,CAAgB;oBAChBA,GAAU;oBACVA,GAAU;oBACVA,SAAgB;oBAChBA,SAAgB,EAAA;gBAAA;gBAChB9qE,IAAAA,CAAKs3K,gBAAAA,CAAiBwB,GAAWhuG;gBACjC,KAAK,IAAIiuG,KAAcD,EAAUjoI,QAAAA,CAC9B,OAAQkoI,EAAWX,OAAAA;oBAChB,KAAK;wBACFp4K,IAAAA,CAAKo3K,oBAAAA,CAAqB2B,GAAYjuG;wBACtC;oBAEH,KAAK;wBAAU;4BACZ,MAAM/pD,IAAS/gB,IAAAA,CAAK+3K,WAAAA,CAAYgB,GAAYpR;4BAC5C78F,EAAM7+B,OAAAA,CAAQtsC,IAAAA,CAAKohB;4BACnB;wBACH;gBAAA;gBAIN,IAAI4mJ,GACD,IAAA;oBACG,OAAOwM,GAAW71G,KAAAA,CAAMwM;gBAC3B,EAAE,OAAOxrD,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,gCAAgC6jE,GAAOxrD,IAC/CA;gBACT;gBAEH,OAAOwrD;YACV;YAEA,gBAAgBmuG,CAAAA,EAAoBtR,IAAAA,CAAS,CAAA,EAAA;gBAC1C,MAAMuR,IAAkB;oBACxBA,MAAkB;oBAClBA,SAAAA,CAAqB;oBACrBA,GAAe;oBACfA,GAAe;oBACfA,SAAqB;gBAAA,GAEfvsJ,IAAQssJ,EAAUv6C,aAAAA,CAAc;gBACtCw6C,EAAWvsJ,KAAAA,GAAQA,QAAAA,IAAAA,KAAK,IAALA,EAAO2b,YAAAA,CAAa;gBAEvC,MAAMopI,IAAauH,EAAUv6C,aAAAA,CAAc;gBACvCgzC,KACD1xK,IAAAA,CAAKo3K,oBAAAA,CAAqB1F,GAAYwH;gBAGzC,MAAMhF,IAAmBvnJ,QAAAA,IAAAA,KAAK,IAALA,EAAO2b,YAAAA,CAAa;gBAO7C,IANI4rI,KACDgF,CAAAA,EAAWhF,gBAAAA,GAAmB,MAAMA,CAAAA,GAGvCl0K,IAAAA,CAAKs3K,gBAAAA,CAAiB2B,GAAWC,IAE7BvR,GACD,IAAA;oBACG,OAAOwM,GAAW71G,KAAAA,CAAM46G;gBAC3B,EAAE,OAAO55J,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,yBAAyBiyK,GAAY55J,IAC7CA;gBACT;gBAEH,OAAO45J;YACV;YAEA,sBAAsBE,CAAAA,EAAezR,IAAAA,CAAS,CAAA,EAAA;gBAC3C,MACM0R,IADMr5K,IAAAA,CAAKy3K,gBAAAA,CAAiB2B,GACN16C,aAAAA,CAAc,aACpCi1C,IAAgB;oBACtBA,MAAgB;gBAAA,GACV2F,IAAgBD,EAAgB36C,aAAAA,CAAc;gBAChD46C,KACD3F,CAAAA,EAAS5yJ,MAAAA,GAAS/gB,IAAAA,CAAK+3K,WAAAA,CAAYuB,GAAe3R,EAAAA;gBAGrD,MAAM4R,IAAiBF,EAAgB36C,aAAAA,CAAc;gBAKrD,IAJI66C,KACD5F,CAAAA,EAAS6B,OAAAA,GAAUx1K,IAAAA,CAAKi4K,YAAAA,CAAasB,GAAgB5R,EAAAA,GAGpDA,GACD,IAAA;oBACG,OAAO4N,GAAcj3G,KAAAA,CAAMq1G;gBAC9B,EAAE,OAAOr0J,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,4BAA4B0sK,GAAUr0J,IAC9CA;gBACT;gBAEH,OAAOq0J;YACV;YAMA,qBAAqB8F,CAAAA,EAAgB9R,IAAAA,CAAS,CAAA,EAAA;gBAC3C,MACM+R,IADM15K,IAAAA,CAAKy3K,gBAAAA,CAAiBgC,GACP/6C,aAAAA,CAAc,YAEnC82C,IAAUx1K,IAAAA,CAAKi4K,YAAAA,CAAayB,GAAgB/R;gBAMlD,IAJC6N,EAAgB/uK,IAAAA,GAAO,WACxBzG,IAAAA,CAAKs3K,gBAAAA,CAAiBoC,GAAgBlE,IAGlC7N,GACD,IAAA;oBACG,OAAOwN,GAAiB72G,KAAAA,CAAMk3G;gBACjC,EAAE,OAAOl2J,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,gCAAgCuuK,GAASl2J,IACjDA;gBACT;gBAEH,OAAOk2J;YACV;YAQA,MAAMmE,CAAAA,EAAgBhS,IAAAA,CAAS,CAAA,EAAA;gBAC5B,MACMiS,IADM55K,IAAAA,CAAKy3K,gBAAAA,CAAiBkC,GACXj7C,aAAAA,CAAc,QAE/Bm7C,IAAgB;oBACtBA,MAAgB;oBAChBA,kBAAAA;oBACAA,QAAkB,EAAA;oBAClBA,UAAoB,EAAA;gBAAA;gBAEpB75K,IAAAA,CAAKs3K,gBAAAA,CAAiBsC,GAAYC;gBAElC,MAAMC,IAAc,CAACnrG,GAAeg5F,IAAAA,CAAS,CAAA;oBAC1C,OAAQh5F,EAAKypG,OAAAA;wBACV,KAAK;4BAGF,KAAK,IAAIrlI,KAAS47B,EAAK99B,QAAAA,CACpBipI,EAAY/mI,GAAO40H;4BAEtB;wBAEH,KAAK;4BAAS;gCACX,MAAM9mK,IAAQb,IAAAA,CAAKw4K,cAAAA,CAAe7pG,GAAMkrG,EAASlE,QAAAA,EAAUhO;gCAC3DkS,EAASxD,MAAAA,CAAO12K,IAAAA,CAAKkB;gCAErB;4BACH;wBACA,KAAK;4BACFb,IAAAA,CAAKo3K,oBAAAA,CAAqBzoG,GAAMkrG;4BAChC;wBAEH,KAAK;4BAAW;gCACb,MAAMrE,IAAUx1K,IAAAA,CAAKi4K,YAAAA,CAAatpG,GAAMg5F;gCACxCkS,EAASvD,QAAAA,CAAS32K,IAAAA,CAAK61K;gCACvB;4BACH;wBACA,KAAK;4BAAe;gCACjB,MAAMlB,IAAct0K,IAAAA,CAAK64K,gBAAAA,CAAiBlqG,GAAMg5F;gCAChDkS,EAASxD,MAAAA,CAAO12K,IAAAA,CAAK20K;gCACrB;4BACH;wBACA,KAAK;4BAAc;gCAChB,MAAM4E,IAAal5K,IAAAA,CAAKg5K,eAAAA,CAAgBrqG,GAAMg5F;gCAC9CkS,EAASxD,MAAAA,CAAO12K,IAAAA,CAAKu5K;gCACrB;4BACH;oBAAA;gBACH;gBAIH,KAAK,IAAIa,KAAYH,EAAW/oI,QAAAA,CAC7BipI,EAAYC,GAAUpS;gBAGzB,IAAIA,GACD,IAAA;oBACG,OAAO8N,GAASn3G,KAAAA,CAAMu7G;gBACzB,EAAE,OAAOv6J,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,6BAA6BqY,IACrCA;gBACT;gBAGH,OAAOu6J;YACV;QAAA;Q,I,K,E;QCvhCH,IAAI33E,IACA4c,IACAuoC;QACJ,MAAM2yB,KAAgB;YACpBC,KAAK;gBACHC,iCAAiC,SAAU1uK,CAAAA;oBACzC67I,KAAO,IAAI9b,WAAWzsB,GAASz/G,OAAAA,CAAQ86K,MAAAA,CAAO74I,MAAAA;gBAChD;YAAA;QAAA;QAMJ,MAAM84I;YACJ,OAAAl4E;gBACE,OAAIA,MAGFA,CAAAA,KAFmB,eAAA,OAAVm4E,QAEFA,MAAM,kCAAkCC,IAAMntJ,IAAAA,CAAK5C,CAAAA,IAAYA,EAASjmB,WAAAA,IAAe6oB,IAAAA,CAAK7oB,CAAAA,IAAei2K,YAAYC,WAAAA,CAAYl2K,GAAa01K,KAAgB7sJ,IAAAA,CAAKntB,IAAAA,CAAKsvD,KAAAA,IAG1KirH,YAAYC,WAAAA,CAAYC,OAAOltK,IAAAA,CAAK+sK,IAAM,WAAWN,IAAe7sJ,IAAAA,CAAKntB,IAAAA,CAAKsvD,KAAAA,GAEhF4yC,EAAAA;YACT;YACA,MAAM92F,CAAAA,EAAAA;gBACJ0zG,KAAW1zG,EAAO0zG,QAAAA,EAClBk7D,GAAcC,GAAAA,CAAIC,+BAAAA,CAAgC;YACpD;YAEA,OAAOpvK,CAAAA,EAAO4vK,IAAmB,CAAA,EAAA;gBAC/B,IAAA,CAAK57D,IAAU,MAAM,IAAI34G,MAAM;gBAE/B,MAAMw0K,IAAiB7vK,EAAMmgI,UAAAA,EACvB2vC,IAAgB97D,GAASz/G,OAAAA,CAAQw7K,MAAAA,CAAOF;gBAC9CtzB,GAAKr8H,GAAAA,CAAIlgB,GAAO8vK,IAEhBF,IAAmBA,KAAoBn8J,OAAOugG,GAASz/G,OAAAA,CAAQy7K,yBAAAA,CAA0BF,GAAeD;gBACxG,MAAMI,IAAkBj8D,GAASz/G,OAAAA,CAAQw7K,MAAAA,CAAOH,IAC1CM,IAAal8D,GAASz/G,OAAAA,CAAQ47K,eAAAA,CAAgBF,GAAiBL,GAAkBE,GAAeD,IAEhGO,IAAM7zB,GAAK97I,KAAAA,CAAMwvK,GAAiBA,IAAkBC;gBAG1D,OAFAl8D,GAASz/G,OAAAA,CAAQ87K,IAAAA,CAAKP,IACtB97D,GAASz/G,OAAAA,CAAQ87K,IAAAA,CAAKJ,IACfG;YACT;QAAA;QAmCF,MAAMZ,KAAO;QC3EN,MAAMc;YAMV,OAAA,OAAc35K,CAAAA,EAAc0wK,CAAAA,EAAAA;gBACzB,IAAI3xK,GACD8wE,GACAt+D,GACAqoK,GACAC,GACAt2D;gBAEH,IAAIvjH,EAAKnB,MAAAA,GAAS,IAAI,GACnB,MAAM,IAAI6F,MAAM;gBAGnB,IAAIo1K,IAAO,IAAI5rC,UAAAA,CAAW,IACtB6rC,IAAQ,IAAI7rC,UAAAA,CAAW,IACvB8rC,IAAS,IAAI9rC,UAAAA,CAAW,IACxB+rC,IAAQ,IAAI/rC,UAAAA,CAAW,IACvBgsC,IAAQ,IAAIhsC,UAAAA,CAAW,IACvBisC,IAAgB,IAAIjsC,UAAAA,CAAW,IAC/BksC,IAAiB,IAAIlsC,UAAAA,CAAW;gBAEpC,SAASloE,EAAOq0G,CAAAA;oBACb,IAAI/0D,IAAO+0D,EAAInsC,UAAAA,CAAW;oBAC1B,IAAI5oB,MAASw0D,KAAQx0D,MAAS60D,GAAe,OAAO;oBACpD,IAAI70D,MAASy0D,KAASz0D,MAAS80D,GAAgB,OAAO;oBACtD,IAAI90D,IAAO00D,GAAQ,OAAA;oBACnB,IAAI10D,IAAO00D,IAAS,IAAI,OAAO10D,IAAO00D,IAAS,KAAK;oBACpD,IAAI10D,IAAO40D,IAAQ,IAAI,OAAO50D,IAAO40D;oBACrC,IAAI50D,IAAO20D,IAAQ,IAAI,OAAO30D,IAAO20D,IAAQ;oBAC7C,MAAMv1K,MAAM;gBACf;gBAOA,IAAIwR,IAAMlW,EAAKnB,MAAAA;gBACfg7K,IAAwC,QAAzB75K,EAAKs6K,MAAAA,CAAOpkK,IAAM,KAAa,IAA6B,QAAzBlW,EAAKs6K,MAAAA,CAAOpkK,IAAM,KAAa,IAAI,GAGrFqtG,IAAM,IAAIumB,WAAyB,IAAd9pI,EAAKnB,MAAAA,GAAa,IAAIg7K,IAG3CtoK,IAAIsoK,IAAe,IAAI75K,EAAKnB,MAAAA,GAAS,IAAImB,EAAKnB,MAAAA;gBAE9C,IAAI07K,IAAI;gBAER,SAASr8K,EAAK4P,CAAAA;oBACXy1G,CAAAA,CAAIg3D,IAAAA,GAAOzsK;gBACd;gBAEA,IAAK/O,IAAI,GAAG8wE,IAAI,GAAG9wE,IAAIwS,GAAGxS,KAAK,GAAG8wE,KAAK,EAEpC3xE,EAAAA,AAAY,CAAA,WADZ07K,CAAAA,IAAO5zG,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,OAAO,KAAOinE,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,IAAI,OAAO,KAAOinE,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,IAAI,OAAO,IAAKinE,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,IAAI,GAAA,CAAA,KAC9G,KACzBb,EAAAA,AAAY,CAAA,QAAN07K,CAAAA,KAAiB,IACvB17K,EAAW,MAAN07K;gBAYR,OATqB,MAAjBC,IAED37K,EAAW,MADX07K,CAAAA,IAAO5zG,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,OAAO,IAAMinE,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,IAAI,OAAO,CAAA,KAE5C,MAAjB86K,KAER37K,CAAAA,EAAAA,AADA07K,CAAAA,IAAO5zG,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,OAAO,KAAOinE,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,IAAI,OAAO,IAAMinE,EAAOhmE,EAAKs6K,MAAAA,CAAOv7K,IAAI,OAAO,CAAA,KAC7F,IAAK,MAClBb,EAAW,MAAN07K,EAAAA,GAGD,IAAI92K,QAAQC,CAAAA;oBAChB,MAAMy3K,IAAW,SAAUC,CAAAA;wBAGxB,IAFA,IAAI94K,IAAQ,GAEH5C,IAAI07K,EAAU57K,MAAAA,GAAS,GAAGE,KAAK,GAAGA,IACxC4C,IAAiB,MAARA,IAA8B,IAAf84K,CAAAA,CAAU17K,EAAAA;wBAGrC,OAAO4C;oBACV;oBAIA,IAAI,WAAW+uK,KAAe,WAAWA,GAAa;wBAGnD,IAAIgK,IAAAA,AAFJn3D,CAAAA,IAAAA,AAAM,CAAA,GAAAs1B,GAAA,OAAA,AAAA,EAAat1B,EAAAA,EAEC1kH,MAAAA,GAAS,GACzB8K,IAAS,IAAIrB,MAAcoyK;wBAE/B,IAAK37K,IAAI,GAAGA,IAAI27K,GAAW37K,IACxB4K,CAAAA,CAAO5K,EAAAA,GAAKy7K,EAASj3D,EAAIz5G,KAAAA,CAAU,IAAJ/K,GAAW,IAAJA,IAAQ;wBAEjDgE,EAAQ4G;oBACX;oBAEA,IAAI,WAAW+mK,GAAa;wBACzB,MAAMiK,IAAU,IAAIhC;wBACpBgC,EAAQl6E,IAAAA,GAAO/0E,IAAAA,CAAK;4BAEjB,IAAIgvJ,IAAAA,AADJn3D,CAAAA,IAAMo3D,EAAQ30G,MAAAA,CAAOu9C,EAAAA,EACD1kH,MAAAA,GAAS,GACzB8K,IAAS,IAAIrB,MAAcoyK;4BAE/B,IAAK37K,IAAI,GAAGA,IAAI27K,GAAW37K,IACxB4K,CAAAA,CAAO5K,EAAAA,GAAKy7K,EAASj3D,EAAIz5G,KAAAA,CAAU,IAAJ/K,GAAW,IAAJA,IAAQ;4BAEjDgE,EAAQ4G;wBAAO;oBAErB;oBAGA,IAAA,CAAK+mK,GAAa;wBACXgK,IAAYn3D,EAAI1kH,MAAAA,GAAS,GACzB8K,IAAS,IAAIrB,MAAcoyK;wBAC/B,IAAK37K,IAAI,GAAGA,IAAI27K,GAAW37K,IACxB4K,CAAAA,CAAO5K,EAAAA,GAAKy7K,EAASj3D,EAAIz5G,KAAAA,CAAU,IAAJ/K,GAAW,IAAJA,IAAQ;wBAEjDgE,EAAQ4G;oBACX;gBAAA;YAEN;QAAA;QC3HI,MAAMixK,KAA2B;YACrCC,UAAU;gBACPC,OAAO;YAAA;YAEVC,QAAQ;gBAILA,QAAQ;YAAA;YAEXlxE,QAAQ;gBAMLA,QAAQ;gBACRmxE,MAAM;YAAA;YAETzoI,WAAW;gBAIR0oI,UAAU;YAAA;YAEbC,OAAO;gBAOJC,OAAO;YAAA;YAEVC,WAAW;gBAIRC,MAAM;YAAA;QAAA,GCtCCC,KAA0B/3G,OAAOv7C,GAAcquJ;YACzD,MAAMvtJ,IAAAA,MAAiB8vJ,MAAM5wJ;YAC7B,OAAOquJ,EAAYrb,WAAAA;gBAChB,KAAK;gBAEL;oBAAS,OAAA,MAAalyI,EAASqJ,IAAAA;gBAD/B,KAAK;oBAAQ,OAAA,MAAarJ,EAAS0yC,IAAAA;YAAAA;QAEtC,GCTU+/G,KAAyBvuJ,CAAAA,IACM1N,CAAAA,IAAAA,AAClCA,CAAAA,QAAAA,IAAAA,KAAM,IAANA,EAAQ0N,IAAAA,AAAAA,KAAQA,IACkE,MAA5E1N,EAAO0N,IAAAA,CAAKsF,iBAAAA,GAAoBkpJ,aAAAA,CAAcxuJ,EAAKsF,iBAAAA,MAAAA,AAEtDhT,CAAAA,QAAAA,IAAAA,KAAM,IAANA,EAAQ0N,IAAAA,AAAAA,MAASA,GAIjByuJ,KAA0B9mD,CAAAA,IACMr1G,CAAAA,IAAAA,AACnCA,CAAAA,QAAAA,IAAAA,KAAM,IAANA,EAAQ0wJ,KAAAA,AAAAA,KAASr7C,IACuE,MAAlFr1G,EAAO0wJ,KAAAA,CAAM19I,iBAAAA,GAAoBkpJ,aAAAA,CAAc7mD,EAAUriG,iBAAAA,MAAAA,AAE5DhT,CAAAA,QAAAA,IAAAA,KAAM,IAANA,EAAQ0wJ,KAAAA,AAAAA,MAAUr7C,GAgBlB+mD,KAA4B,CAACC,GAAsBh6K,IACiB2d,CAAAA;gBAC3E,MAAMs8J,IAde,AAAC3L,CAAAA,CAAAA;oBACzB,MAAM2L,IAAY,IAAI/uJ;oBACtB,KAAK,IAAA,CAAKhsB,GAAKc,EAAAA,IAAUsuK,EAAY;wBAClC,IAAI4L,IAAkBl6K;wBACD,YAAA,OAAVA,KACRk6K,CAAAA,IAAkBl6K,EAAM2wB,iBAAAA,EAAAA,GAE3BspJ,EAAUryJ,GAAAA,CAAI1oB,EAAIyxB,iBAAAA,IAAqBupJ;oBAC1C;oBACA,OAAOD;gBAAS,CAAA,EAKwBt8J,EAAO2wJ,UAAAA;gBAE5C,IAAA,KAAc5wK,MAAVsC,GAAqB;oBACtB,IAAIk6K,IAAkBl6K;oBAKtB,OAJqB,YAAA,OAAVA,KACRk6K,CAAAA,IAAkBl6K,EAAM2wB,iBAAAA,EAAAA,GAGpBspJ,EAAU16K,GAAAA,CAAIy6K,EAAarpJ,iBAAAA,QAAyBupJ;gBAC9D;gBACG,OAAOD,EAAUtlK,GAAAA,CAAIqlK,EAAarpJ,iBAAAA;YACrC,GC1COypJ,KAA4B,YAC5BC,KAA4B,YAC5BC,KAA4B,WAM5BC,KAAyBnK,CAAAA,IAAAA,CAAAA,CACzBA,CAAAA,IAAMgK,EAAAA,GAONI,KAAuBpK,CAAAA,IAAAA,CAAAA,CACvBA,CAAAA,IAAMiK,EAAAA,GAONI,KAAuBrK,CAAAA,IAAAA,CAAAA,CACvBA,CAAAA,IAAMkK,EAAAA,GAQNI,KAAmBtK,CAAAA,IACtBA,IAAAA,CAAQgK,CAAAA,KACKC,KACAC,EAAAA;QC/BhB,MAAMK;YAIV,YAA4Bt3K,CAAAA,CAAAA;gBAAA,IAAA,CAAAA,IAAAA,GAAAA,GAHpB,IAAA,CAAAu3K,OAAAA,GAAAA,CAAU,GAClB,IAAA,CAAAlhH,KAAAA,GAAQ,IAAIxuC;YAEiD;YAE7D,SAAA2vJ,GAAYvmK,CAAAA,EAAAA;gBACT,IAAIwtD,IAAWllE,IAAAA,CAAK88D,KAAAA,CAAMn6D,GAAAA,CAAI+U,EAAKnX,IAAAA,CAAK;gBACxC,OAAI2kE,KAIJA,CAAAA,IAAW,IAAIllE,IAAAA,CAAKyG,IAAAA,IAAQiR,IAC5B1X,IAAAA,CAAK88D,KAAAA,CAAM9xC,GAAAA,CAAItT,EAAKnX,IAAAA,CAAK,MAAM2kE,IACxBA,CAAAA;YACV;YAEA,SAAAhe;gBACG,IAAIlnD,IAAAA,CAAKg+K,OAAAA,EACN,OAAOj0K,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAK88D,KAAAA,CAAM5V,MAAAA;gBAEhC,MAAM,IAAI/gD,MAAM;YACnB;YAEA,MAAA,OAAM8jB;gBACH,MAAM85C,IAAYh6D,MAAMwD,IAAAA,CAAKvN,IAAAA,CAAK88D,KAAAA,CAAM5uB,OAAAA,KAClCra,IAAAA,MAAgBtvB,QAAQ25K,UAAAA,CAAWn6G,EAAU9jE,GAAAA,CAAIO,CAAAA,IAAKA,CAAAA,CAAE,EAAA,CAAGypB,IAAAA;gBAGjE,IAAIk0J,IAAU;gBACd,IAAK,IAAI39K,IAAI,GAAGA,IAAIqzB,EAAQvzB,MAAAA,EAAQE,IAAK;oBACtC,MAAM4K,IAASyoB,CAAAA,CAAQrzB,EAAAA;oBACD,eAAlB4K,EAAOkf,MAAAA,IACR1R,CAAAA,QAAQ3R,KAAAA,CAAM,CAAA,0BAAA,EAA6B88D,CAAAA,CAAUvjE,EAAAA,CAAG,EAAA,CAAA,uDAAA,CAAA,EAA6D4K,EAAOgzK,MAAAA,GAC5HD,GAAAA;gBAEN;gBACA,IAAIA,GACD,MAAM,IAAIh4K,MAAM,CAAA,cAAA,EAAiBg4K,EAAAA,UAAAA,CAAAA;gBAEpCn+K,IAAAA,CAAKg+K,OAAAA,GAAAA,CAAU;YAClB;QAAA;Q,I,K,E;QChCI,SAASK,GAA+Bh9J,CAAAA,EAAWi9J,CAAAA;YACvD,IAAA;gBACG,IAAIA,GACD,KAAK,MAAMz7K,KAAQy7K,EAAa;oBAC7B,IAAIl7K,IAAQP,EAAKO,KAAAA;oBACS,YAAA,OAAfP,EAAKO,KAAAA,IACbA,CAAAA,IAAQP,EAAKO,KAAAA,CAAM2wB,iBAAAA,EAAAA,GAEtB1S,EAAOqwJ,UAAAA,CAAW1mJ,GAAAA,CAAInoB,EAAK4rB,IAAAA,CAAKsF,iBAAAA,IAAqB3wB;gBACxD;YAEN,EAAE,OAAOkc,GAAAA;gBACN1G,QAAQ3R,KAAAA,CAAM,CAAA,8BAAA,EAAiCoa,GAAAA,EAAU/B;YAC5D;QACH;QC1BO,SAASi/J,GAAiBC,CAAAA;YAC9B,MAEM1jJ,IAAU0jJ,EAAU9rK,KAAAA,CAFC;YAI3B,IAAIooB,GAED,OADcA,CAAAA,CAAQ,EAEzB;YAEA,MAAM,IAAI30B,MAAM,CAAA,qCAAA,EAAwCq4K,GAAAA;QAC3D;QAEO,SAASC,GAAQD,CAAAA,EAAmBE,CAAAA;YAExC,KAAK,MAAA,EAAM,MAAEj1J,CAAAA,EAAI,QAAEmmH,CAAAA,EAAAA,IAAY8uC,EAC5B,IAAoB,YAAA,OAATj1J,GAAAA;gBACR,IAAI+0J,EAAUv9J,QAAAA,CAASwI,IACpB,OAAOmmH;YAAAA,OAEN;gBACJ,MAAMl9H,IAAQ8rK,EAAU9rK,KAAAA,CAAM+W;gBAC9B,IAAI/W,GACD,OAAOk9H,EAAO5zG,OAAAA,CAAQ,WAAWtpB,CAAAA,CAAM,EAAA;YAE7C;YAEH,OAAO8rK;QACV;QAEO,SAASG,GAAUH,CAAAA,EAAmBE,CAAAA;YAC1C,IAAA,CAAKA,GAAS,OAAA,CAAO;YACrB,KAAK,MAAA,EAAM,MAAEj1J,CAAAA,EAAI,QAAEmmH,CAAAA,EAAAA,IAAY8uC,EAC5B,IAAoB,YAAA,OAATj1J,GAAAA;gBACR,IAAI+0J,EAAUv9J,QAAAA,CAASwI,IACpB,OAAA,CAAO;YAAA,OAEN;gBAEJ,IADc+0J,EAAU9rK,KAAAA,CAAM+W,IAE3B,OAAA,CAAO;YAEb;YAEH,OAAA,CAAO;QACV;QAGO,SAASm1J,GAAmBC,CAAAA,EAAkBC,CAAAA,EAAwBJ,CAAAA;YAC1E,IAAIC,GAAUG,GAAgBJ,MAAYA,GACvC,OAAOD,GAAQK,GAAgBJ;YAIlC,IAAoC,MAAhCI,EAAer2K,OAAAA,CAAQ,MACxB,OAAOq2K;YAGV,MAAMC,IAAcF,EAASxpJ,KAAAA,CAAM,MAC7B2pJ,IAAgBF,EAAezpJ,KAAAA,CAAM;YAK3C,OAHI0pJ,CAAAA,CAAYA,EAAYz+K,MAAAA,GAAS,EAAA,CAAG2gB,QAAAA,CAAS,QAC9C89J,EAAY52J,GAAAA,IAER42J,EAAY1+K,MAAAA,CAAO2+K,GAAez+K,IAAAA,CAAK;QACjD;QCpDO,MAAM0+K;YAQV,YAAYC,CAAAA,CAAAA;gB,I,G,G;gBADZ,IAAA,CAAAxN,UAAAA,GAAa,IAAIpjJ,KAEdtuB,IAAAA,CAAKm/K,WAAAA,GAAcD,EAAMC,WAAAA,EACzBn/K,IAAAA,CAAKyuB,IAAAA,GAAOzuB,IAAAA,CAAKm/K,WAAAA,CAAY1wJ,IAAAA,EAG7BzuB,IAAAA,CAAKyxK,KAAAA,GAAQzxK,IAAAA,CAAKm/K,WAAAA,CAAY14K,IAAAA,EAC9BzG,IAAAA,CAAKJ,EAAAA,GAAwB,SAAnB,CAAA,IAAAI,IAAAA,CAAKm/K,WAAAA,CAAYv/K,EAAAA,AAAAA,KAAAA,KAAE,MAAA,IAAA,IAAA,IAC7BI,IAAAA,CAAKsM,CAAAA,GAAsB,SAAlB,CAAA,IAAAtM,IAAAA,CAAKm/K,WAAAA,CAAY7yK,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI,GAC/BtM,IAAAA,CAAKoK,CAAAA,GAAsB,SAAlB,CAAA,IAAApK,IAAAA,CAAKm/K,WAAAA,CAAY/0K,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI;YAClC;QAAA;QAQI,MAAMg1K,WAAuBH;YAIjC,YAAYE,CAAAA,EAA0BxL,CAAAA,CAAAA;gBAEnC,IADA/mJ,KAAAA,CAAM;oBAACuyJ,aAAAA;gBAAAA,IAAAA,CACFA,EAAYxL,QAAAA,EAAU,MAAM,IAAIxtK,MAAM;gBAM3C,IALAnG,IAAAA,CAAKuhB,MAAAA,GAAS49J,EAAYxL,QAAAA,EAC1B3zK,IAAAA,CAAKq/K,aAAAA,GAAgBF,GACrBn/K,IAAAA,CAAK2zK,QAAAA,GAAWA,GAGZA,EAAS5yJ,MAAAA,EAAQ;oBAClB/gB,IAAAA,CAAKyuB,IAAAA,GAAOzuB,IAAAA,CAAKyuB,IAAAA,IAAQklJ,EAAS5yJ,MAAAA,CAAO0N,IAAAA,EACzCzuB,IAAAA,CAAKyxK,KAAAA,GAAQzxK,IAAAA,CAAKyxK,KAAAA,IAASkC,EAAS5yJ,MAAAA,CAAO0wJ,KAAAA;oBAC3C,KAAK,MAAA,CAAOnvK,GAAKc,EAAAA,IAAUuwK,EAAS5yJ,MAAAA,CAAO2wJ,UAAAA,CAAWxjI,OAAAA,GAC9CluC,IAAAA,CAAK0xK,UAAAA,CAAW35J,GAAAA,CAAIzV,MACtBtC,IAAAA,CAAK0xK,UAAAA,CAAW1mJ,GAAAA,CAAI1oB,GAAKc;gBAGlC;gBAGA,IAAIuwK,EAAS6B,OAAAA,IAAW7B,EAAS5yJ,MAAAA,CAAOo+J,WAAAA,CAAY3L,GAAAA,EAAK;oBACtD,MAAMntE,IAAOstE,EAAS6B,OAAAA,CAAQ8J,YAAAA,CAAa3L,EAAS5yJ,MAAAA,CAAOo+J,WAAAA,CAAY3L,GAAAA;oBACvE,IAAIntE,GAAM;wBACPrmG,IAAAA,CAAKyxK,KAAAA,GAAQzxK,IAAAA,CAAKyxK,KAAAA,IAASprE,EAAKorE,KAAAA;wBAChC,KAAK,MAAA,CAAOnvK,GAAKc,EAAAA,IAAUijG,EAAKqrE,UAAAA,CAAWxjI,OAAAA,GACnCluC,IAAAA,CAAK0xK,UAAAA,CAAW35J,GAAAA,CAAIzV,MACtBtC,IAAAA,CAAK0xK,UAAAA,CAAW1mJ,GAAAA,CAAI1oB,GAAKc;oBAGlC;gBACH;YAGH;QAAA;QAMI,MAAMm8K,WAAqBN;YAC/B,YAAYE,CAAAA,EAA0C3L,CAAAA,EAA6Br5J,CAAAA,EAA+BE,CAAAA,CAAAA;gBAC/GuS,KAAAA,CAAM;oBAACuyJ,aAAAA;gBAAAA,IAD4C,IAAA,CAAA3L,GAAAA,GAAAA,GAA6B,IAAA,CAAAr5J,KAAAA,GAAAA,GAA+B,IAAA,CAAAE,MAAAA,GAAAA;YAElH;QAAA;QAMI,MAAMmlK,WAAcP;QAAAA;QAKpB,MAAMhgI,WAAaggI;YAIvB,YAAYE,CAAAA,EAA0BvrJ,CAAAA,EAAiBzZ,CAAAA,EAAeslK,CAAAA,CAAAA;gB,I,G,G;gBACnE7yJ,KAAAA,CAAM;oBAACuyJ,aAAAA;gBAAAA,IAEPn/K,IAAAA,CAAK+6C,IAAAA,GAAO,IAAI,GAAAwD,IAAAA,CAAK;oBAClBC,QAAuB,SAAf,CAAA,IAAA5qB,EAAKu/I,UAAAA,AAAAA,KAAAA,KAAU,MAAA,IAAA,IAAI;oBAC3Bx/J,OAAOigB,EAAKjgB,KAAAA,GAAQ,GAAAvB,KAAAA,CAAMS,OAAAA,CAAQ+gB,EAAKjgB,KAAAA,IAAS,GAAAvB,KAAAA,CAAMyC,KAAAA;oBACtD/E,MAAoB,SAAd,CAAA,IAAA8jB,EAAKw/I,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI;oBACxBz0H,MAAM,GAAAtF,QAAAA,CAASuF,EAAAA;oBACf1C,WAAWl8C,IAAAA,CAAK0/K,mBAAAA,CAAoB9rJ,EAAKy/I,MAAAA;oBACzCl3H,WAAWn8C,IAAAA,CAAK2/K,sBAAAA,CAAuB/rJ,EAAK0/I,MAAAA;oBAC5C77H,SAASgoI;gBAAAA;gBAGZ,MAAMG,IAAoB,SAAT,CAAA,IAAAhsJ,EAAKsxH,IAAAA,AAAAA,KAAAA,KAAI,MAAA,KAAA;gBAE1BllJ,IAAAA,CAAK4zB,IAAAA,GAAO,IAAI,GAAA,IAAA,CAAO;oBACpBA,MAAMA,EAAKA,IAAAA;oBACXmnB,MAAM/6C,IAAAA,CAAK+6C,IAAAA;oBAAAA,GACP6kI,IAAW;wBACZtrJ,UAAUna,IAAQ;oBAAA,IAClB,CAAC,CAAA;gBAAA;YAEV;YACA,uBAAuB4sG,CAAAA,EAAAA;gBACpB,OAAOA;oBACJ,KAAK;wBACF,OAAO,GAAAxtE,SAAAA,CAAUr+B,MAAAA;oBAEpB,KAAK;wBACF,OAAO,GAAAq+B,SAAAA,CAAUyzE,MAAAA;oBAKpB;wBACG,OAAO,GAAAzzE,SAAAA,CAAUt+B,GAAAA;gBAAAA;YAG1B;YAEA,oBAAoB8rG,CAAAA,EAAAA;gBACjB,OAAOA;oBACJ,KAAK;oBAYL;wBACG,OAAO,GAAAztE,SAAAA,CAAUlrC,IAAAA;oBAVpB,KAAK;wBACF,OAAO,GAAAkrC,SAAAA,CAAUumI,MAAAA;oBAEpB,KAAK;wBACF,OAAO,GAAAvmI,SAAAA,CAAUjrC,KAAAA;oBAEpB,KAAK;wBACF,OAAO,GAAAirC,SAAAA,CAAU6jF,KAAAA;gBAAAA;YAM1B;QAAA;QAMI,MAAM2iD,WAAgBb;YAC1B,YAAYE,CAAAA,EAA0ChlK,CAAAA,EAA+BE,CAAAA,CAAAA;gBAClFuS,KAAAA,CAAM;oBAACuyJ,aAAAA;gBAAAA,IAD4C,IAAA,CAAAhlK,KAAAA,GAAAA,GAA+B,IAAA,CAAAE,MAAAA,GAAAA;YAErF;QAAA;QAMI,MAAMqyE,WAAkBuyF;YAE5B,YAAYE,CAAAA,EAA0ChlK,CAAAA,EAA+BE,CAAAA,EAAgCvI,CAAAA,CAAAA;gBAClH8a,KAAAA,CAAM;oBAACuyJ,aAAAA;gBAAAA,IAD4C,IAAA,CAAAhlK,KAAAA,GAAAA,GAA+B,IAAA,CAAAE,MAAAA,GAAAA,GAAgC,IAAA,CAAAvI,MAAAA,GAAAA;YAErH;QAAA;QAMI,MAAM4zE,WAAgBu5F;YAS1B,YAAYE,CAAAA,EAA0BpjK,CAAAA,CAAAA;gBACnC6Q,KAAAA,CAAM;oBAACuyJ,aAAAA;gBAAAA,IANM,IAAA,CAAApjK,MAAAA,GAAmB,EAAA,EAInB,IAAA,CAAA8gE,WAAAA,GAAwB,EAAA,EAGrC78E,IAAAA,CAAK68E,WAAAA,GAAc9gE,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAAA,AAAK,CAAA,GAAA,GAAA5H,GAAAA,AAAAA,EAAI4H,EAAEhK,CAAAA,EAAGgK,EAAElM,CAAAA,IAC9CpK,IAAAA,CAAK+b,MAAAA,GAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAAA,AAAK,CAAA,GAAA,GAAA5H,GAAAA,AAAAA,EAAI4H,EAAEhK,CAAAA,EAAGgK,EAAElM,CAAAA,EAAGgG,GAAAA,CAAAA,AAAI,CAAA,GAAA,GAAA1B,GAAAA,AAAAA,EAAI1O,IAAAA,CAAKsM,CAAAA,EAAGtM,IAAAA,CAAKoK,CAAAA;YACpE;QAAA;QAMI,MAAM21K,WAAiBd;YAE3B,YAAYE,CAAAA,EAA0BpjK,CAAAA,CAAAA;gBACnC6Q,KAAAA,CAAM;oBAACuyJ,aAAAA;gBAAAA,IAFM,IAAA,CAAApjK,MAAAA,GAAmB,EAAA,EAGhC/b,IAAAA,CAAK+b,MAAAA,GAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAAA,AAAK,CAAA,GAAA,GAAA5H,GAAAA,AAAAA,EAAI4H,EAAEhK,CAAAA,EAAGgK,EAAElM,CAAAA;YAC5C;QAAA;QAWI,SAAS2tK,GAAYh3J,CAAAA,EAAqBmkD,CAAAA;Y,I,G,G,G;YAC9C,IAAI86G;YACJ,IAAIj/J,EAAOnE,KAAAA,EAERojK,IAAY,IAAIR,GAAM;gBAACL,aAAap+J;YAAAA;iBAChC,IAAIA,EAAO0yJ,OAAAA,EACX1yJ,EAAO5G,KAAAA,IAAS4G,EAAO1G,MAAAA,GAExB2lK,CAAAA,IAAY,IAAIF,GAAQ/+J,GAAQA,EAAO5G,KAAAA,EAAO4G,EAAO1G,MAAAA,GACrD2lK,EAAU1zK,CAAAA,IAAKyU,EAAO5G,KAAAA,GAAQ,GAC9B6lK,EAAU51K,CAAAA,IAAK2W,EAAO1G,MAAAA,GAAS,CAAA,IAG/B2lK,IAAY,IAAIF,GAAQ/+J,GAAQ,IAAI;iBAEnC,IAAIA,EAAO04D,OAAAA,EACfumG,IAAY,IAAIt6F,GAAQ3kE,GAAQA,EAAO04D,OAAAA;iBACnC,IAAI14D,EAAO2yJ,QAAAA,EACfsM,IAAY,IAAID,GAASh/J,GAAQA,EAAO2yJ,QAAAA;iBACpC,IAAG3yJ,EAAO6S,IAAAA,EACdosJ,IAAY,IAAI/gI,GAAKl+B,GAAQA,EAAO6S,IAAAA,EAAkB,SAAZ,CAAA,IAAA7S,EAAO5G,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI,GAAwB,SAArB,CAAA,IAAA+qD,QAAAA,IAAAA,KAAQ,IAARA,EAAUu6G,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAI;iBAClF,IAAI1+J,EAAOyyJ,GAAAA,EAAK;gBACpBwM,IAAY,IAAIT,GAAax+J,GAAQA,EAAOyyJ,GAAAA,EAAkB,SAAZ,CAAA,IAAAzyJ,EAAO5G,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI,GAAgB,SAAb,CAAA,IAAA4G,EAAO1G,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI;gBAGtF,MAAMm7J,IAAUtwG,QAAAA,IAAAA,KAAQ,IAARA,EAAU+6G,oBAAAA,CAAqBl/J,EAAOyyJ,GAAAA;gBACtD,IAAIp9C,IAAYr1G,EAAOta,IAAAA;gBACvB,IAAI+uK,GAAS;oBACV,MAAMnvE,IAAOmvE,QAAAA,IAAAA,KAAO,IAAPA,EAAS8J,YAAAA,CAAav+J,EAAOyyJ,GAAAA;oBAE1C,IADAp9C,IAAYA,KAAa/vB,CAAAA,QAAAA,IAAAA,KAAI,IAAJA,EAAMorE,KAAAA,AAAAA,GAC3BprE,QAAAA,IAAAA,KAAI,IAAJA,EAAMqrE,UAAAA,EACP,KAAK,MAAA,CAAOpvK,GAAKc,EAAAA,IAAUijG,EAAKqrE,UAAAA,CAAWxjI,OAAAA,GACnC8xI,EAAUtO,UAAAA,CAAW35J,GAAAA,CAAIzV,MAC3B09K,EAAUtO,UAAAA,CAAW1mJ,GAAAA,CAAI1oB,GAAKc;gBAI1C;gBACA48K,EAAUvO,KAAAA,GAAQr7C;YACrB,OAAO,IAAIr1G,EAAO4yJ,QAAAA,IAAYzuG,GAAU;gBAErC,MAAMyuG,IAAWzuG,EAASg7G,SAAAA,CAAU9uH,IAAAA,CAAK56C,CAAAA,IAAK+nK,GAAiB/nK,EAAE2pK,YAAAA,MAAkB5B,GAAiBx9J,EAAO4yJ,QAAAA;gBAC3G,IAAA,CAAIA,GAID,MAAM,IAAIxtK,MAAM,CAAA,mBAAA,EAAsB4a,EAAOnhB,EAAAA,CAAAA,WAAAA,EAAgBmhB,EAAO0N,IAAAA,CAAAA,oEAAAA,EAA2E1N,EAAO4yJ,QAAAA,CAAAA,0CAAAA,CAAAA;gBAHtJqM,IAAY,IAAIZ,GAAer+J,GAAQ4yJ;YAK7C,OAGMqM,IAFCj/J,EAAO5G,KAAAA,IAAS4G,EAAO1G,MAAAA,GAEZ,IAAIqyE,GAAU3rE,GAAQA,EAAO5G,KAAAA,EAAO4G,EAAO1G,MAAAA,EAAQ,GAAAvM,MAAAA,CAAOC,IAAAA,IAG1D,IAAI2+E,GAAU3rE,GAAQ,IAAI,IAAI,GAAAjT,MAAAA,CAAOG,IAAAA;YAIvD,OADAowK,GAAS2B,GAAWj/J,EAAO2wJ,UAAAA,GACpBsO;QACV;QAQO,SAASI,GAAaC,CAAAA,EAAoCn7G,CAAAA;YAC9D,MAAMj5B,IAA0B,EAAA;YAChC,KAAK,MAAMlrB,KAAUs/J,EAAiBp0I,OAAAA,CAAS;gBAC5C,IAAI+zI,IAA0BjI,GAAYh3J,GAAQmkD;gBAClDj5B,EAAQtsC,IAAAA,CAAKqgL;YAChB;YACA,OAAO/zI;QACV;QCtRO,MAAMq0I;YAMV,YAAYrnK,CAAAA,CAAAA;gBACT,MAAA,EAAM,cAAEknK,CAAAA,EAAY,QAAEp/J,CAAAA,EAAM,eAAEs+J,CAAAA,EAAa,SAAE7J,CAAAA,EAAAA,GAAYv8J;gBACzDjZ,IAAAA,CAAKmgL,YAAAA,GAAeA,GACpBngL,IAAAA,CAAK+gB,MAAAA,GAASA,GACd/gB,IAAAA,CAAKq/K,aAAAA,GAAgBA,GACrBr/K,IAAAA,CAAKw1K,OAAAA,GAAUA;YAClB;QAAA;QCTI,MAAMlvE;YAUV,YAAYrtF,CAAAA,CAAAA;gBAJZ,IAAA,CAAAgzB,OAAAA,GAA0B,EAAA,EAC1B,IAAA,CAAA+kC,SAAAA,GAAwB,EAAA,EACxB,IAAA,CAAAqnE,SAAAA,GAAoD,EAAA,EACpD,IAAA,CAAAq5B,UAAAA,GAAa,IAAIpjJ;gBAEd,MAAA,EAAM,IAAE1uB,CAAAA,EAAE,SAAE41K,CAAAA,EAAO,WAAE+K,CAAAA,EAAAA,GAActnK;gBACnCjZ,IAAAA,CAAKJ,EAAAA,GAAKA,GACVI,IAAAA,CAAKw1K,OAAAA,GAAUA,GACfx1K,IAAAA,CAAKugL,SAAAA,GAAYA,GACjBvgL,IAAAA,CAAKyxK,KAAAA,GAAQ8O,EAAU95K,IAAAA,EAEvB43K,GAASr+K,IAAAA,EAAMugL,EAAU7O,UAAAA,GAErB6O,EAAUjM,WAAAA,IAAeiM,EAAUjM,WAAAA,CAAYroI,OAAAA,IAChDjsC,CAAAA,IAAAA,CAAKisC,OAAAA,GAAUm0I,GAAaG,EAAUjM,WAAAA,CAAAA,GAGrCiM,EAAUloC,SAAAA,IACXr4I,CAAAA,IAAAA,CAAKq4I,SAAAA,GAAYkoC,EAAUloC,SAAAA,AAAAA;YAGjC;QAAA;QAcI,MAAMmoC;YAoBV,YAAYvnK,CAAAA,CAAAA;gB,I,G,G,G,G,G,G,G,G,G;gBAhBZ,IAAA,CAAAwnK,QAAAA,GAAAA,IACA,IAAA,CAAAC,SAAAA,GAAoB,GAEpB,IAAA,CAAAr7E,SAAAA,GAAoB,GACpB,IAAA,CAAAC,UAAAA,GAAqB,GACrB,IAAA,CAAAq7E,UAAAA,GAAAA,AAAqB,CAAA,GAAA,GAAAjyK,GAAAA,AAAAA,EAAI,GAAG,IAE5B,IAAA,CAAA02F,KAAAA,GAAgB,EAAA,EAChB,IAAA,CAAAwvE,eAAAA,GAA0B,cAC1B,IAAA,CAAAvvF,WAAAA,GAA0C,cAC1C,IAAA,CAAAqsF,UAAAA,GAAa,IAAIpjJ;gBAOd,MAAA,EAAM,MAAEG,CAAAA,EAAI,cAAEmyJ,CAAAA,EAAY,OAAEj0J,CAAAA,EAAK,aAAEk0J,CAAAA,EAAW,UAAEJ,CAAAA,EAAAA,GAAaxnK;gBAK7D,IAJAjZ,IAAAA,CAAKyuB,IAAAA,GAAOA,GACZzuB,IAAAA,CAAK4gL,YAAAA,GAAeA,GACpB5gL,IAAAA,CAAKygL,QAAAA,GAAWA,GAEZxL,GAA0B2L,IAAe;oBAC1CvC,GAASr+K,IAAAA,EAAM4gL,EAAalP,UAAAA;oBAC5B,MAAMl+I,IAAUotJ,EAAaptJ,OAAAA,EACvBuC,IAAUzwB,KAAKoF,KAAAA,CAAAA,AAAOk2K,CAAAA,EAAanM,UAAAA,GAAajhJ,CAAAA,IAAYotJ,CAAAA,EAAa9L,SAAAA,GAAYthJ,CAAAA,IACrFsC,IAAOxwB,KAAKoF,KAAAA,CAAAA,AAAOk2K,CAAAA,EAAapM,WAAAA,GAAchhJ,CAAAA,IAAYotJ,CAAAA,EAAa/L,UAAAA,GAAarhJ,CAAAA;oBAkC1F,IAjCAxzB,IAAAA,CAAKyxK,KAAAA,GAAQmP,EAAanP,KAAAA,EAC1BzxK,IAAAA,CAAKqlF,WAAAA,GAA4C,SAA9B,CAAA,IAAiB,SAAjB,CAAA,IAAAu7F,EAAatqJ,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAE+uD,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAI,cACrDrlF,IAAAA,CAAK8gL,uBAAAA,GAA0B,GAAA16J,YAAAA,CAAa7D,QAAAA,GAAW5F,SAAAA,CAAUikK,EAAa9L,SAAAA,EAAW,GAAG7kK,KAAAA,CAAAA,IAAU,IACtGjQ,IAAAA,CAAK+gL,qBAAAA,GAAwB,GAAA36J,YAAAA,CAAa7D,QAAAA,GAAW5F,SAAAA,CAAU,GAAGikK,EAAa/L,UAAAA,EAAY5kK,KAAAA,CAAM,GAAA,KACjGjQ,IAAAA,CAAKghL,qBAAAA,GAAwB,GAAA56J,YAAAA,CAAa7D,QAAAA,GAAW5F,SAAAA,CAAU,GAAG,GAAG9K,MAAAA,CAAAA,CAAQvM,KAAK8G,EAAAA,GAAK,GAAG6D,KAAAA,CAAAA,IAAU,IACpGjQ,IAAAA,CAAK40K,eAAAA,GAA8C,SAA5B,CAAA,IAAAgM,EAAahM,eAAAA,AAAAA,KAAAA,KAAe,MAAA,IAAA,IAA0B,iBAArB50K,IAAAA,CAAKqlF,WAAAA,GAA+B,eAAe,UACvG14D,KACD3sB,CAAAA,IAAAA,CAAKihL,WAAAA,GAAe,GAAAprJ,WAAAA,CAAYQ,eAAAA,CAAgB;wBAC7C1J,OAAAA;wBACA2J,MAAM;4BACHR,MAAAA;4BACAC,SAAAA;4BACAS,aAAaoqJ,EAAa9L,SAAAA;4BAC1Br+I,cAAcmqJ,EAAa/L,UAAAA;wBAAAA;wBAE9BrhJ,SAAS;4BACNkD,cAAc;gCACXpqB,GAAsB,SAAnB,CAAA,IAAAs0K,EAAajqJ,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI;gCAC1BvsB,GAAsB,SAAnB,CAAA,IAAAw2K,EAAajqJ,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI;4BAAA;4BAE7BA,QAAQ;gCACLrqB,GAAuB,SAApB,CAAA,IAAAs0K,EAAaptJ,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI;gCAC3BppB,GAAuB,SAApB,CAAA,IAAAw2K,EAAaptJ,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI;4BAAA;wBAAA;oBAAA,EAAA,GAKvCxzB,IAAAA,CAAK0gL,SAAAA,GAAYE,EAAa7L,SAAAA,EAC9B/0K,IAAAA,CAAKqlG,SAAAA,GAAYu7E,EAAa9L,SAAAA,EAC9B90K,IAAAA,CAAKslG,UAAAA,GAAas7E,EAAa/L,UAAAA,EAC3B+L,EAAa5L,UAAAA,IACdh1K,CAAAA,IAAAA,CAAK2gL,UAAAA,GAAAA,AAAa,CAAA,GAAA,GAAAjyK,GAAAA,AAAAA,EAAIkyK,EAAa5L,UAAAA,CAAW1oK,CAAAA,EAAGs0K,EAAa5L,UAAAA,CAAW5qK,CAAAA,CAAAA,GAExEw2K,EAAax7E,KAAAA,EACd,KAAK,MAAMiB,KAAQu6E,EAAax7E,KAAAA,CAC7BplG,IAAAA,CAAKolG,KAAAA,CAAMzlG,IAAAA,CAAK,IAAI2mG,GAAK;wBACtB1mG,IAAIymG,EAAKzmG,EAAAA;wBACT41K,SAASx1K,IAAAA;wBACTugL,WAAWl6E;wBACL15E,OAAAA;oBAAAA;gBAIlB;gBACA,IAAIuoJ,GAAiC0L,MAAAA,KAA2C9/K,MAA1B8/K,EAAajM,QAAAA,EAAwB;oBACxF30K,IAAAA,CAAK8gL,uBAAAA,GAA0B,GAAA16J,YAAAA,CAAa7D,QAAAA,GAAW5F,SAAAA,CAAUikK,EAAa9L,SAAAA,EAAW,GAAG7kK,KAAAA,CAAAA,IAAU,IACtGjQ,IAAAA,CAAK+gL,qBAAAA,GAAwB,GAAA36J,YAAAA,CAAa7D,QAAAA,GAAW5F,SAAAA,CAAU,GAAGikK,EAAa/L,UAAAA,EAAY5kK,KAAAA,CAAM,GAAA,KACjGjQ,IAAAA,CAAKghL,qBAAAA,GAAwB,GAAA56J,YAAAA,CAAa7D,QAAAA,GAAW5F,SAAAA,CAAU,GAAG,GAAG9K,MAAAA,CAAAA,CAAQvM,KAAK8G,EAAAA,GAAK,GAAG6D,KAAAA,CAAAA,IAAU,IACpGjQ,IAAAA,CAAK40K,eAAAA,GAA8C,SAA5B,CAAA,IAAAgM,EAAahM,eAAAA,AAAAA,KAAAA,KAAe,MAAA,IAAA,IAA0B,iBAArB50K,IAAAA,CAAKqlF,WAAAA,GAA+B,eAAe,UAC3GrlF,IAAAA,CAAKqlF,WAAAA,GAA4C,SAA9B,CAAA,IAAiB,SAAjB,CAAA,IAAAu7F,EAAatqJ,IAAAA,AAAAA,KAAAA,KAAI,MAAA,IAAA,KAAA,IAAA,EAAE+uD,WAAAA,AAAAA,KAAAA,KAAW,MAAA,IAAA,IAAI,cACrDrlF,IAAAA,CAAK0gL,SAAAA,GAAYE,EAAa7L,SAAAA,EAC9B/0K,IAAAA,CAAKqlG,SAAAA,GAAYu7E,EAAa9L,SAAAA,EAC9B90K,IAAAA,CAAKslG,UAAAA,GAAas7E,EAAa/L,UAAAA,EAC3B+L,EAAa5L,UAAAA,IACdh1K,CAAAA,IAAAA,CAAK2gL,UAAAA,GAAAA,AAAa,CAAA,GAAA,GAAAjyK,GAAAA,AAAAA,EAAIkyK,EAAa5L,UAAAA,CAAW1oK,CAAAA,EAAGs0K,EAAa5L,UAAAA,CAAW5qK,CAAAA,CAAAA;oBAE5E,IAAIgqB,IAAoB,EAAA;oBACxB,IAAIwsJ,EAAax7E,KAAAA,EACd,KAAK,MAAMiB,KAAQu6E,EAAax7E,KAAAA,CAAO;wBACpC,MAAMz4E,IAAQk0J,QAAAA,IAAAA,KAAW,IAAXA,EAAal+K,GAAAA,CAAI0jG;wBAC3B15E,KACDyH,EAAQz0B,IAAAA,CAAKgtB,EAAMsG,QAAAA,KAEtBjzB,IAAAA,CAAKolG,KAAAA,CAAMzlG,IAAAA,CAAK,IAAI2mG,GAAK;4BACtB1mG,IAAIymG,EAAKzmG,EAAAA;4BACT41K,SAASx1K,IAAAA;4BACTugL,WAAWl6E;4BACL15E,OAAAA;wBAAAA;oBAEZ;oBAECk0J,KACD7gL,CAAAA,IAAAA,CAAKihL,WAAAA,GAAc,IAAI,GAAAprJ,WAAAA,CAAY;wBAAEzB,SAAAA;oBAAAA,EAAAA;gBAE3C;YACH;YAEA,0BAA0B+sJ,CAAAA,EAAAA;gBAEvB,OAAOA,QAAAA,IAAAA,IAAqBnhL,IAAAA,CAAK40K,eAAAA;oBAC9B,KAAK;wBACF,OAAA,AAAO,CAAA,GAAA,GAAAlmK,GAAAA,AAAAA,EAAI,GAAG;oBAEjB,KAAK;wBACF,OAAA,AAAO,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,IAAK;oBAEnB,KAAK;wBACF,OAAA,AAAO,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,GAAG;oBAEjB,KAAK;wBACF,OAAA,AAAO,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,GAAG;oBAEjB,KAAK;wBACF,OAAA,AAAO,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,IAAK;oBAEnB,KAAK;wBACF,OAAA,AAAO,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,GAAG;oBAEjB,KAAK;oBASL;wBACG,OAAA,AAAO,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,GAAG;oBAPjB,KAAK;wBACF,OAAA,AAAO,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,IAAK;oBAEnB,KAAK;wBACF,OAAA,AAAO,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,GAAG;gBAAA;YAMvB;YAQA,aAAa8kK,CAAAA,EAAAA;gBACV,MACM4N,IADgBtD,GAAgBtK,KACJxzK,IAAAA,CAAKygL,QAAAA;gBAEvC,OADazgL,IAAAA,CAAKolG,KAAAA,CAAMh0C,IAAAA,CAAK56C,CAAAA,IAAKA,EAAE5W,EAAAA,KAAOwhL;YAE9C;YAEA,oBAAoBhrD,CAAAA,EAAAA;gBACjB,OAAOp2H,IAAAA,CAAKolG,KAAAA,CAAMp9F,MAAAA,CAAOk1K,GAAuB9mD;YACnD;YAEA,mBAAmB3nG,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC9B,OAAOpD,IAAAA,CAAKolG,KAAAA,CAAMp9F,MAAAA,CAAOm1K,GAA0B1uJ,GAAMrrB;YAC5D;YAEA,gBAAgBowK,CAAAA,EAAAA;gBACb,MAAMvrK,IAAI01K,GAAsBnK,IAC1BjkK,IAAIquK,GAAoBpK,IACxBrxK,IAAI07K,GAAoBrK,IACxBgO,IAAgB1D,GAAgBtK,IAChCt/I,IAAcstJ,IAAgBxhL,IAAAA,CAAKygL,QAAAA;gBACzC,IAAIzgL,IAAAA,CAAKihL,WAAAA,EAAa;oBACnB,IAAItsJ,IAAS30B,IAAAA,CAAKihL,WAAAA,CAAY7sJ,OAAAA,CAAQF,EAAAA;oBAetC,OAAA,AAdI/xB,CAAAA,KAAK8F,KAAKsH,CAAAA,KACXolB,CAAAA,IAASA,EAAO1iB,KAAAA,EAAAA,GAGf9P,KACDwyB,CAAAA,EAAOhS,QAAAA,GAAAA,CAAYrd,KAAK8G,EAAAA,GAAK,GAC7BuoB,EAAO1kB,KAAAA,GAAAA,AAAQ,CAAA,GAAA,GAAAvB,GAAAA,AAAAA,EAAAA,IAAQ,EAAA,GAEtBzG,KACD0sB,CAAAA,EAAO1kB,KAAAA,GAAAA,AAAQ,CAAA,GAAA,GAAAvB,GAAAA,AAAAA,EAAAA,AAAKvM,CAAAA,IAAI,IAAA,EAAK,IAAKwyB,EAAO1kB,KAAAA,CAAM3D,CAAAA,EAAAA,AAAInK,CAAAA,IAAAA,KAAS,CAAA,IAAKwyB,EAAO1kB,KAAAA,CAAM7F,CAAAA,CAAAA,GAE7EmF,KACDolB,CAAAA,EAAO1kB,KAAAA,GAAAA,AAAQ,CAAA,GAAA,GAAAvB,GAAAA,AAAAA,EAAAA,AAAKvM,CAAAA,IAAAA,KAAS,CAAA,IAAKwyB,EAAO1kB,KAAAA,CAAM3D,CAAAA,EAAAA,AAAInK,CAAAA,IAAI,IAAA,EAAK,IAAKwyB,EAAO1kB,KAAAA,CAAM7F,CAAAA,CAAAA,GAE1EuqB;gBACV;gBACA,MAAM,IAAIxuB,MAAM,CAAA,UAAA,EAAanG,IAAAA,CAAKyuB,IAAAA,CAAAA,kCAAAA,EAAyC+kJ,EAAAA,mBAAAA,EAAyBgO,EAAAA,CAAAA,CAAAA;YACvG;YAEQ,4BAA4BE,CAAAA,EAAAA;gBAGjC,MACMr8E,IAAYrlG,IAAAA,CAAKqlG,SAAAA,EAGjBs8E,IAAiB3hL,IAAAA,CAAKslG,UAAAA,GAAa,GACnCs8E,IAAQF,EAASt3K,CAAAA,GAAIu3K,GACrBE,IAAQH,EAASp1K,CAAAA,GAAIq1K;gBAC3B,OAAA,AAAO,CAAA,GAAA,GAAAjzK,GAAAA,AAAAA,EAAAA,AACHmzK,CAAAA,IAAQD,CAAAA,IAASv8E,IAAY,IARjB,GAAA,AASZw8E,CAAAA,IAAQD,CAAAA,IAASD,IAAiB;YACzC;YAYA,mBAAmBnO,CAAAA,EAAav6J,CAAAA,EAAAA;gBAC7B,IAAA,EAAI,QAAEnH,CAAAA,EAAM,OAAE7B,CAAAA,EAAK,qBAAE8xK,CAAAA,EAAmB,QAAE9sJ,CAAAA,EAAAA,GAAW;oBAClDnjB,QAAQ,GAAAhE,MAAAA,CAAOC,IAAAA;oBACfkC,OAAO,GAAAnC,MAAAA,CAAOE,GAAAA;oBACdinB,QAAQ,GAAAnnB,MAAAA,CAAOC,IAAAA;oBACfg0K,qBAAAA,KAAqBjhL;oBAAAA,GAClBmY,CAAAA;gBAAAA;gBAEN,MAAMosE,IAAc08F,QAAAA,IAAAA,IAAuB/hL,IAAAA,CAAKqlF,WAAAA,EAC1CghB,IAAOrmG,IAAAA,CAAKs/K,YAAAA,CAAa9L,IACzBpoK,IAAqB,EAAA;gBAC3B,IAAIi7F,KAAQA,EAAKp6D,OAAAA,EACd,KAAK,IAAIlrB,KAAUslF,EAAKp6D,OAAAA,CAAS;oBAC9B,IAAIlrB,aAAkB2kE,IAAS;wBAE5B,IAAI3pE,IAASgF,EAAOhF,MAAAA,CAAO9b,GAAAA,CAAIqW,CAAAA,IAAKA,EAAErG,KAAAA,CAAMA;wBAC5C8L,IAAS/b,IAAAA,CAAKgiL,mBAAAA,CAAoBjmK,GAAQy3J,IACtB,gBAAhBnuF,KACDtpE,CAAAA,IAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAKtW,IAAAA,CAAKyhL,2BAAAA,CAA4BnrK,GAAAA,GAE7DyF,IAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAKA,EAAElG,GAAAA,CAAI6kB;wBAC/B,IAAI20D,IAAO,GAAAnE,KAAAA,CAAMC,OAAAA,CAAQ3pE,GAAQ,GAAAjO,MAAAA,CAAOC,IAAAA,EAAAA,CAAM;wBACzC67E,EAAK/E,QAAAA,KAGPz5E,EAAOzL,IAAAA,CAAKiqF,KAFZx+E,EAAOzL,IAAAA,CAAKiqF,EAAKjE,WAAAA;oBAIvB;oBACA,IAAI5kE,aAAkB2rE,IAAW;wBAK9B,IAAI3wE,IAJO,GAAAT,WAAAA,CAAYc,aAAAA,CACpB2E,EAAO5G,KAAAA,GAAQlK,EAAM3D,CAAAA,EACrByU,EAAO1G,MAAAA,GAASpK,EAAM7F,CAAAA,EACtB0H,GACa+K,SAAAA,GAAY5c,GAAAA,CAAIqW,CAAAA,IAAKA,EAAElG,GAAAA,CAAAA,AAAI,CAAA,GAAA,GAAA1B,GAAAA,AAAAA,EAAIqS,EAAOzU,CAAAA,EAAGyU,EAAO3W,CAAAA;wBAC5C,gBAAhBi7E,KACDtpE,CAAAA,IAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAKtW,IAAAA,CAAKyhL,2BAAAA,CAA4BnrK,GAAAA,GAE7DyF,IAAS/b,IAAAA,CAAKgiL,mBAAAA,CAAoBjmK,GAAQy3J,IAC1Cz3J,IAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAKA,EAAElG,GAAAA,CAAI6kB;wBAC/B,MAAMw1E,IAAM,GAAAhlB,KAAAA,CAAMC,OAAAA,CAAQ3pE;wBAC1B3Q,EAAOzL,IAAAA,CAAK8qG;oBACf;oBACA,IAAI1pF,aAAkB++J,IAAS;wBAE5B,IAAImC,IAAAA,AAAc,CAAA,GAAA,GAAAvzK,GAAAA,AAAAA,EAAIqS,EAAOzU,CAAAA,EAAGyU,EAAO3W,CAAAA;wBACnB,gBAAhBi7E,KACD48F,CAAAA,IAAcjiL,IAAAA,CAAKyhL,2BAAAA,CAA4BQ,EAAAA,GAElDA,IAAcA,EAAY7xK,GAAAA,CAAI6kB;wBAC9B,MAAM2W,IAAStmC,KAAKkF,GAAAA,CAAIuW,EAAO5G,KAAAA,GAAQ,GAAG4G,EAAO1G,MAAAA,GAAS,IACpDwgC,IAAS,GAAA4qC,KAAAA,CAAMgD,MAAAA,CAAO78C,GAAQq2I,EAAYhyK,KAAAA,CAAMA;wBACtD7E,EAAOzL,IAAAA,CAAKk7C;oBACf;gBACH;gBAEH,OAAOzvC;YACV;YAOQ,oBAAoB2Q,CAAAA,EAAkBy3J,CAAAA,EAAAA;gBAC3C,MAAMvrK,IAAI01K,GAAsBnK,IAC1BjkK,IAAIquK,GAAoBpK;gBAW9B,OAVUqK,GAAoBrK,MAE3Bz3J,CAAAA,IAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAKtW,IAAAA,CAAKghL,qBAAAA,CAAsBttK,QAAAA,CAAS4C,GAAAA,GAE5DrO,KACD8T,CAAAA,IAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAKtW,IAAAA,CAAK8gL,uBAAAA,CAAwBptK,QAAAA,CAAS4C,GAAAA,GAE9D/G,KACDwM,CAAAA,IAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAKtW,IAAAA,CAAK+gL,qBAAAA,CAAsBrtK,QAAAA,CAAS4C,GAAAA,GAEzDyF;YACV;YAEO,mBAAmBy3J,CAAAA,EAAAA;gB,I;gBACvB,MAAMntE,IAAOrmG,IAAAA,CAAKs/K,YAAAA,CAAa9L;gBAC/B,IAAIntE,KAAsB,CAAA,SAAd,CAAA,IAAAA,EAAKgyC,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,KAAA,IAAA,EAAE/3I,MAAAA,AAAAA,GAAQ;oBACjC,IAAI6hL,IAAoB,EAAA;oBACxB,KAAK,IAAIpxC,KAAS1qC,EAAKgyC,SAAAA,CACpB8pC,EAASxiL,IAAAA,CAAK;wBACXy1C,SAASp1C,IAAAA,CAAKuhL,eAAAA,CAAgBxwC,EAAM6iC,MAAAA,GAAS5zK,IAAAA,CAAKygL,QAAAA;wBAClD/qI,UAAUq7F,EAAMr7F,QAAAA;oBAAAA;oBAGtB,OAAO,IAAI,GAAA1B,SAAAA,CAAU;wBAClBC,QAAQkuI;wBACRjuI,UAAU,GAAAlF,iBAAAA,CAAkB8E,IAAAA;oBAAAA;gBAElC;gBACA,OAAO;YACV;QAAA;QCnWI,MAAMsuI;YAYV,YAAmB34J,CAAAA,EAAcg3J,CAAAA,EAAkBxnK,CAAAA,CAAAA;gBAAhC,IAAA,CAAAwQ,IAAAA,GAAAA,GATH,IAAA,CAAAk+I,MAAAA,GAAAA,CAAkB,GAClB,IAAA,CAAA0a,QAAAA,GAAAA,CAAoB,GACpB,IAAA,CAAAh9F,WAAAA,GAA0C,cAElD,IAAA,CAAAi9F,UAAAA,GAAyBvF;gBAM9B,MAAA,EAAM,YAAEuF,CAAAA,EAAU,QAAEC,CAAAA,EAAM,SAAE7D,CAAAA,EAAO,aAAE8D,CAAAA,EAAW,QAAE7a,CAAAA,EAAM,UAAE0a,CAAAA,EAAQ,aAAEh9F,CAAAA,EAAAA,GAAgB;oBAAA,GAAKpsE,CAAAA;gBAAAA;gBACzFjZ,IAAAA,CAAKqiL,QAAAA,GAAWA,QAAAA,IAAAA,IAAYriL,IAAAA,CAAKqiL,QAAAA,EACjCriL,IAAAA,CAAKqlF,WAAAA,GAAcA,QAAAA,IAAAA,IAAerlF,IAAAA,CAAKqlF,WAAAA,EACvCrlF,IAAAA,CAAK2nK,MAAAA,GAASA,QAAAA,IAAAA,IAAU3nK,IAAAA,CAAK2nK,MAAAA,EAC7B3nK,IAAAA,CAAKsiL,UAAAA,GAAaA,QAAAA,IAAAA,IAActiL,IAAAA,CAAKsiL,UAAAA,EACrCtiL,IAAAA,CAAKwiL,WAAAA,GAAcA,QAAAA,IAAAA,IAAe,IAAIzE,GAAY,GAAAvsJ,WAAAA,GAClDxxB,IAAAA,CAAKuiL,MAAAA,GAASA,QAAAA,IAAAA,IAAU,IAAIxL,IAC5B/2K,IAAAA,CAAKygL,QAAAA,GAAWA,GAChBzgL,IAAAA,CAAK0+K,OAAAA,GAAUA;YAClB;YAEA,MAAA,OAAMz0J;gBACH,MAAMw4J,IAAcziL,IAAAA,CAAKypB,IAAAA,CAAKxI,QAAAA,CAAS,UAAU,QAAQ;gBACzD,IAAA;oBACG,MAAMyhK,IAAAA,MAAoB1iL,IAAAA,CAAKsiL,UAAAA,CAAWtiL,IAAAA,CAAKypB,IAAAA,EAAMg5J;oBACrD,IAAIjN;oBAcJ,IATMA,IAHc,WAAhBiN,IAEGziL,IAAAA,CAAK2nK,MAAAA,GACIwN,GAAiB72G,KAAAA,CAAMokH,KAEvBA,IAIH1iL,IAAAA,CAAKuiL,MAAAA,CAAO/I,oBAAAA,CAAqBkJ,GAAa1iL,IAAAA,CAAK2nK,MAAAA,GAG5DsN,GAA0BO,IAAU;wBACrC,MAAMmN,IAAY/D,GAAmB5+K,IAAAA,CAAKypB,IAAAA,EAAM+rJ,EAAQ7oJ,KAAAA,EAAO3sB,IAAAA,CAAK0+K,OAAAA,GAC9D/xJ,IAAQ3sB,IAAAA,CAAKqiL,QAAAA,GAAAA,KAAWvhL,IAAYd,IAAAA,CAAKwiL,WAAAA,CAAYvE,QAAAA,CAAS0E;wBACpE3iL,IAAAA,CAAKyB,IAAAA,GAAO,IAAI++K,GAAQ;4BACrB/xJ,MAAM+mJ,EAAQ/mJ,IAAAA;4BACdmyJ,cAAcpL;4BACdiL,UAAUzgL,IAAAA,CAAKygL,QAAAA;4BACT9zJ,OAAAA;wBAAAA;oBAEZ;oBAEA,IAAIuoJ,GAAiCM,IAAU;wBAC5C,MAAMqL,IAAc7gL,IAAAA,CAAKqiL,QAAAA,GAAAA,KAAWvhL,IAAY,IAAIwtB;wBACpD,IAAIuyJ,GAAa;4BACd,MAAMh0I,IAAwB,EAAA;4BAC9B,IAAI2oI,EAAQpwE,KAAAA,EACT;gCAAA,KAAK,IAAIiB,KAAQmvE,EAAQpwE,KAAAA,CACtB,IAAIiB,EAAK15E,KAAAA,EAAO;oCACb,MAAMg2J,IAAY/D,GAAmB5+K,IAAAA,CAAKypB,IAAAA,EAAM48E,EAAK15E,KAAAA,EAAO3sB,IAAAA,CAAK0+K,OAAAA,GAC3D/xJ,IAAQ3sB,IAAAA,CAAKwiL,WAAAA,CAAYvE,QAAAA,CAAS0E;oCACxC9B,EAAY71J,GAAAA,CAAIq7E,GAAM15E,IACtBkgB,EAAOltC,IAAAA,CAAKgtB;gCACf;4BAAA;wBAGT;wBAEA6oJ,EAAQb,QAAAA,GAAW30K,IAAAA,CAAKygL,QAAAA,EACxBzgL,IAAAA,CAAKyB,IAAAA,GAAO,IAAI++K,GAAQ;4BACrB/xJ,MAAM+mJ,EAAQ/mJ,IAAAA;4BACdmyJ,cAAcpL;4BACdiL,UAAUzgL,IAAAA,CAAKygL,QAAAA;4BACTI,aAAAA;wBAAAA;oBAEZ;oBAMA,IAJK7gL,IAAAA,CAAKqiL,QAAAA,IAAAA,MACDriL,IAAAA,CAAKwiL,WAAAA,CAAYv4J,IAAAA,IAGtBjqB,IAAAA,CAAKyB,IAAAA,EACN,OAAOzB,IAAAA,CAAKyB,IAGlB;gBAAA,EAAE,OAAO6d,GAAAA;oBAEN,MADA1G,QAAQ3R,KAAAA,CAAM,CAAA,+BAAA,EAAkCjH,IAAAA,CAAKypB,IAAAA,EAAAA,GAC/CnK;gBACT;gBACA,MAAM,IAAInZ,MAAM,CAAA,mBAAA,EAAsBnG,IAAAA,CAAKypB,IAAAA,EAAAA;YAC9C;YAEA,WAAAI;gBACG,OAAA,CAAA,CAAS7pB,IAAAA,CAAKyB,IACjB;YAAA;QAAA;QCxFI,MAAMmhL;YAeV,YAA4BzC,CAAAA,EAAsBlnK,CAAAA,CAAAA;gBAAtB,IAAA,CAAAknK,YAAAA,GAAAA,GARZ,IAAA,CAAAkC,QAAAA,GAAAA,CAAoB,GACpB,IAAA,CAAA1a,MAAAA,GAAAA,CAAkB,GAG1B,IAAA,CAAA2a,UAAAA,GAAyBvF;gBAK9B,MAAA,EAAM,YAAEuF,CAAAA,EAAU,QAAEC,CAAAA,EAAM,SAAE7D,CAAAA,EAAO,aAAE8D,CAAAA,EAAW,QAAE7a,CAAAA,EAAM,UAAE0a,CAAAA,EAAAA,GAAa;oBAAA,GAAIppK,CAAAA;gBAAAA;gBAC3EjZ,IAAAA,CAAKqiL,QAAAA,GAAWA,QAAAA,IAAAA,IAAYriL,IAAAA,CAAKqiL,QAAAA,EACjCriL,IAAAA,CAAK2nK,MAAAA,GAASA,QAAAA,IAAAA,IAAU3nK,IAAAA,CAAK2nK,MAAAA,EAC7B3nK,IAAAA,CAAKsiL,UAAAA,GAAaA,QAAAA,IAAAA,IAActiL,IAAAA,CAAKsiL,UAAAA,EACrCtiL,IAAAA,CAAKwiL,WAAAA,GAAcA,QAAAA,IAAAA,IAAe,IAAIzE,GAAY,GAAAvsJ,WAAAA,GAClDxxB,IAAAA,CAAKuiL,MAAAA,GAASA,QAAAA,IAAAA,IAAU,IAAIxL,IAC5B/2K,IAAAA,CAAK0+K,OAAAA,GAAUA;YAClB;YAEA,WAAA70J;gBACG,OAAA,CAAA,CAAS7pB,IAAAA,CAAKyB,IACjB;YAAA;YAEA,MAAA,OAAMwoB;gBACH,MAAM44J,IAAe7iL,IAAAA,CAAKmgL,YAAAA,CAAal/J,QAAAA,CAAS,SAAS,QAAQ;gBACjE,IAAA;oBACG,MAAM9gB,IAAAA,MAAgBH,IAAAA,CAAKsiL,UAAAA,CAAWtiL,IAAAA,CAAKmgL,YAAAA,EAAc0C;oBACzD,IAAIlP;oBAEDA,IADkB,UAAjBkP,IACU7iL,IAAAA,CAAKuiL,MAAAA,CAAOpJ,qBAAAA,CAAsBh5K,GAASH,IAAAA,CAAK2nK,MAAAA,IAEvD3nK,IAAAA,CAAK2nK,MAAAA,GACK4N,GAAcj3G,KAAAA,CAAMn+D,KAEpBA;oBAGjB,MAAMk/K,IAAgB1L,GAChB5yJ,IAASg3J,GAAYpE,EAAS5yJ,MAAAA;oBACpC,IAAIy0J;oBACJ,IAAI7B,EAAS6B,OAAAA,EAAS;wBAEnB,MAAMsN,IAAclE,GAAmB5+K,IAAAA,CAAKmgL,YAAAA,EAAcxM,EAAS6B,OAAAA,CAAQj0J,MAAAA,EAAQvhB,IAAAA,CAAK0+K,OAAAA,GAClFqE,IAAkB,IAAIX,GAAgBU,GAAanP,EAAS6B,OAAAA,CAAQb,QAAAA,EAAU;4BACjF0N,UAAUriL,IAAAA,CAAKqiL,QAAAA;4BACf1a,QAAQ3nK,IAAAA,CAAK2nK,MAAAA;4BACb2a,YAAYtiL,IAAAA,CAAKsiL,UAAAA;4BACjBE,aAAaxiL,IAAAA,CAAKwiL,WAAAA;4BAClBD,QAAQviL,IAAAA,CAAKuiL,MAAAA;4BACb7D,SAAS1+K,IAAAA,CAAK0+K,OAAAA;wBAAAA;wBAGjBlJ,IAAAA,MAAgBuN,EAAgB94J,IAAAA;oBACnC;oBAEA,OAAOjqB,IAAAA,CAAKyB,IAAAA,GAAO,IAAI6+K,GAAS;wBAC7BH,cAAcngL,IAAAA,CAAKmgL,YAAAA;wBACnBd,eAAAA;wBACAt+J,QAAAA;wBACAy0J,SAAAA;oBAAAA;gBAGN,EAAE,OAAOl2J,GAAAA;oBAGN,MADA1G,QAAQ3R,KAAAA,CAAM,CAAA,2BAAA,EAA8BjH,IAAAA,CAAKmgL,YAAAA,CAAAA,6EAAAA,CAAAA,GAC3C7gK;gBACT;YACH;QAAA;QC3FI,MAAM0jK,WAA2B,GAAArxI,SAAAA;YAErC,YAAY14B,CAAAA,CAAAA;gBACT2T,KAAAA;gBACA,MAAA,EAAM,aAACuyJ,CAAAA,EAAAA,GAAelmK;gBACtBjZ,IAAAA,CAAKm/K,WAAAA,GAAcA;YACtB;QAAA;QCLI,MAAM8D,WAAgC,GAAAtxI,SAAAA;YAE1C,YAAY14B,CAAAA,CAAAA;gBACT2T,KAAAA;gBACA,MAAA,EAAM,gBAAEs2J,CAAAA,EAAAA,GAAmBjqK;gBAC3BjZ,IAAAA,CAAKkjL,cAAAA,GAAiBA;YACzB;QAAA;QCUI,MAAMC;YA2BV,YAAmBD,CAAAA,EAAuCh+G,CAAAA,EAAyCwoF,CAAAA,CAAAA;gBAAhF,IAAA,CAAAw1B,cAAAA,GAAAA,GAAuC,IAAA,CAAAh+G,QAAAA,GAAAA,GAAyC,IAAA,CAAAwoF,KAAAA,GAAAA,GA1B3F,IAAA,CAAA9jI,MAAAA,GAAS,GAAAhT,MAAAA,CAAOS,WAAAA,IAMR,IAAA,CAAA8C,KAAAA,GAAgB,GAIhB,IAAA,CAAAE,MAAAA,GAAiB,GAEjC,IAAA,CAAAq3J,UAAAA,GAAa,IAAIpjJ,KAKjB,IAAA,CAAA7sB,IAAAA,GAAiB,EAAA,EAOT,IAAA,CAAA2hL,cAAAA,GAAiB,IAAI90J,KAG1BtuB,IAAAA,CAAKyuB,IAAAA,GAAOy0J,EAAez0J,IAAAA,EAC3BzuB,IAAAA,CAAKyxK,KAAAA,GAAQyR,EAAezR,KAAAA,EAC5BzxK,IAAAA,CAAKma,KAAAA,GAAQ+oK,EAAe/oK,KAAAA,EAC5Bna,IAAAA,CAAKqa,MAAAA,GAAS6oK,EAAe7oK,MAAAA,EAC7BgkK,GAASr+K,IAAAA,EAAMkjL,EAAexR,UAAAA;YACjC;YAKA,cAAc8B,CAAAA,EAAAA;gB,I;gBACX,OAAmC,SAA5B,CAAA,IAAAxzK,IAAAA,CAAKojL,cAAAA,CAAezgL,GAAAA,CAAI6wK,EAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI,EAC1C;YAAA;YAMA,oBAAoBp9C,CAAAA,EAAAA;gBASjB,OARcp2H,IAAAA,CAAKsjL,YAAAA,CAAal+E,KAAAA,CAAMp9F,MAAAA,CAAOwO,CAAAA;oBAC1C,MAAM+sK,IAAa/sK,EAAE/U,IAAAA,CAAKkB,GAAAA,CAAI05K,GAAyBC,QAAAA,CAASC,KAAAA;oBAChE,OAAA,CAAA,CAAIgH,KACMrG,GAAuB9mD,GAAWmtD;gBAEhC,GAGFtjL,GAAAA,CAAIuW,CAAAA,IAAK,CAAA;wBACnBgtK,QAAQhtK;wBACR+pK,WAAW/pK,EAAE/U,IAAAA,CAAKkB,GAAAA,CAAI05K,GAAyBC,QAAAA,CAASC,KAAAA;oBAAAA,CAAAA;YAE9D;YAOA,mBAAmB9tJ,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAS9B,OARcpD,IAAAA,CAAKsjL,YAAAA,CAAal+E,KAAAA,CAAMp9F,MAAAA,CAAOwO,CAAAA;oBAC1C,MAAM+sK,IAAa/sK,EAAE/U,IAAAA,CAAKkB,GAAAA,CAAI05K,GAAyBC,QAAAA,CAASC,KAAAA;oBAChE,OAAA,CAAA,CAAIgH,KACMpG,GAA0B1uJ,GAAMrrB,GAAOmgL;gBAErC,GAGFtjL,GAAAA,CAAIuW,CAAAA,IAAK,CAAA;wBACnBgtK,QAAQhtK;wBACR+pK,WAAW/pK,EAAE/U,IAAAA,CAAKkB,GAAAA,CAAI05K,GAAyBC,QAAAA,CAASC,KAAAA;oBAAAA,CAAAA;YAE9D;YAEA,eAAelnG,CAAAA,EAAAA;gBACZ,IAAA,CAAKr1E,IAAAA,CAAKsjL,YAAAA,EAEP,OADAtjL,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,iFACV;gBAEV,IAAIrY,IAAAA,CAAKsjL,YAAAA,EAAc;oBACpB,MAAME,IAASxjL,IAAAA,CAAKsjL,YAAAA,CAAar8E,cAAAA,CAAe5xB;oBAChD,IAAA,CAAKmuG,GAAQ,OAAO;oBACpB,MAAMpC,IAAYphL,IAAAA,CAAKsjL,YAAAA,CAAal+E,KAAAA,CAAM38F,OAAAA,CAAQ+6K,IAC5ChQ,IAAMsK,GAAgB99K,IAAAA,CAAKyB,IAAAA,CAAK2/K,EAAAA;oBAEtC,IAAI5N,KAAO,GACR,OAAO;oBAMV,OAAO;wBAAE+M,WAHOvgL,IAAAA,CAAKklE,QAAAA,CAAS+6G,oBAAAA,CAAqBzM,GACzB8L,YAAAA,CAAa9L;wBAEnBgQ,QAAAA;oBAAAA;gBACvB;gBACA,OAAO;YACV;YAEQ,gBAAgBhQ,CAAAA,EAAantE,CAAAA,EAAAA;gBAClC,IAAIjB,IAAyCplG,IAAAA,CAAKojL,cAAAA,CAAezgL,GAAAA,CAAI6wK,IAEjEkQ,IADU1jL,IAAAA,CAAKklE,QAAAA,CAAS+6G,oBAAAA,CAAqBzM,GACzB8L,YAAAA,CAAa9L;gBAChCpuE,IAGFA,EAAMzlG,IAAAA,CAAK;oBAAC6jL,QAAQn9E;oBAAMk6E,WAAWmD;gBAAAA,KAFrCt+E,IAAQ;oBAAC;wBAACo+E,QAAQn9E;wBAAMk6E,WAAWmD;oBAAAA;iBAAAA,EAItC1jL,IAAAA,CAAKojL,cAAAA,CAAep4J,GAAAA,CAAIwoJ,GAAKpuE,IAC7BiB,EAAK5kG,IAAAA,CAAKupB,GAAAA,CAAIqxJ,GAAyBC,QAAAA,CAASC,KAAAA,EAAOmH;YAC1D;YAEQ,WAAWr9E,CAAAA,EAAqBmtE,CAAAA,EAAaoQ,CAAAA,EAAkB96J,CAAAA,EAAa+6J,CAAAA,EAAAA;gBACjF7jL,IAAAA,CAAKyjL,eAAAA,CAAgBjQ,GAAKntE,IACtBrmG,IAAAA,CAAKklE,QAAAA,CAAS4+G,kBAAAA,IAAsBD,KACrCx9E,CAAAA,EAAKQ,KAAAA,GAAAA,CAAQ,CAAA;gBAGhB,MAAM6Z,IAAMra,EAAK1jG,GAAAA,CAAI,GAAA29G,wBAAAA;gBACjBI,KACDA,CAAAA,EAAIF,SAAAA,GAAYxgH,IAAAA,CAAK0tJ,KAAAA,AAAAA;gBAGxB,MAAM8nB,IAAUx1K,IAAAA,CAAKklE,QAAAA,CAAS+6G,oBAAAA,CAAqBzM;gBACnD,IAAI7+I,IAAS6gJ,EAAQ+L,eAAAA,CAAgB/N;gBACjCoQ,KACDjvJ,CAAAA,IAASA,EAAO1iB,KAAAA,IAChB0iB,EAAO7L,IAAAA,GAAOA,CAAAA,GAEjBu9E,EAAKiD,UAAAA,CAAW30E,GAAQ;oBAAEM,QAAQugJ,EAAQmL,UAAAA;gBAAAA;gBAE1C,IAAI1rJ,IAASoxE,EAAKxrF,GAAAA;gBAClB,IAA4B,iBAAxB26J,EAAQnwF,WAAAA,EAETpwD,IAAAA,AAAS,CAAA,GAAA,GAAAvmB,GAAAA,AAAAA,EAAI,GAAG;qBACZ;oBACJ,MAAMi6H,IAAY3oI,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA,GAAY,GAC1Cz6J,IAASra,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;oBACjC5/I,IAAAA,AAAS,CAAA,GAAA,GAAAvmB,GAAAA,AAAAA,EAAIi6H,GAAWtuH;gBAC3B;gBAIA,MAAM22D,IAAYwkG,EAAQsM,kBAAAA,CAAmBtO,GAAK;oBAAEv+I,QAAAA;gBAAAA;gBACpD,KAAK,IAAIy3C,KAAYsE,EAClBq1B,EAAKnxB,WAAAA,CAAYxI;gBAGpB,IAAI2rE,IAAYm9B,EAAQ0M,kBAAAA,CAAmB1O;gBAC3C,IAAIn7B,KACGurC,CAAAA,KACDvrC,CAAAA,IAAYA,EAAUpmI,KAAAA,IACtBomI,EAAUvvH,IAAAA,GAAOA,CAAAA,GAEpBu9E,EAAKmD,aAAAA,IACLnD,EAAKiD,UAAAA,CAAW+uC,GAAW;oBAAEpjH,QAAQugJ,EAAQmL,UAAAA;gBAAAA,IACzC3gL,IAAAA,CAAKklE,QAAAA,CAAS4+G,kBAAAA,AAAAA,GAAoB;oBACnC,MAAMC,IAAUvO,EAAQ8J,YAAAA,CAAa9L,IAC/Bt/H,IAAW6vI,QAAAA,IAAAA,KAAO,IAAPA,EAASrS,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyBroI,SAAAA,CAAU0oI,QAAAA;oBAC5E,IAAIxoI,KAAgC,YAAA,OAAbA,GACpB,OAAQA,EAASuoH,WAAAA;wBACd,KAAK,GAAAztH,iBAAAA,CAAkB+E,GAAAA,CAAI0oH,WAAAA;4BACxBpkB,EAAUnkG,QAAAA,GAAW,GAAAlF,iBAAAA,CAAkB+E,GAAAA;4BACvC;wBAEH,KAAK,GAAA/E,iBAAAA,CAAkBwH,MAAAA,CAAOimH,WAAAA;4BAC3BpkB,EAAUnkG,QAAAA,GAAW,GAAAlF,iBAAAA,CAAkBwH,MAAAA;4BACvC;wBAEH,KAAK,GAAAxH,iBAAAA,CAAkB8E,IAAAA,CAAK2oH,WAAAA;4BACzBpkB,EAAUnkG,QAAAA,GAAW,GAAAlF,iBAAAA,CAAkB8E,IAAAA;4BACvC;wBAEH,KAAK,GAAA9E,iBAAAA,CAAkB4H,QAAAA,CAAS6lH,WAAAA;4BAC7BpkB,EAAUnkG,QAAAA,GAAW,GAAAlF,iBAAAA,CAAkB4H,QAAAA;4BACvC;wBAEH;4BAEG52C,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,CAAA,sCAAA,EAAyCm9J,EAAQ/mJ,IAAAA,CAAAA,aAAAA,EAAoB+kJ,EAAAA,EAAAA,EAAQt/H,GAAAA;oBAAAA;gBAK1G;YAEN;YAEA,MAAA,OAAMjqB;gB,I,G,G,G;gBACH,MAAMppB,IAAQb,IAAAA,CAAKkjL,cAAAA,EACbW,IAAAA,CAAAA,CAAiB7jL,IAAAA,CAAK0xK,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyBM,KAAAA,CAAMC,KAAAA,GAEpEgH,IADU5jL,CAAAA,IAAAA,CAAKkjL,cAAAA,CAAet6J,OAAAA,EAAAA,CAAAA,CAClB5oB,IAAAA,CAAKkjL,cAAAA,CAAevR,SAAAA,AAAAA,GAChC7oJ,IAAO9oB,IAAAA,CAAKkjL,cAAAA,CAAevR,SAAAA,GAAY,GAAAv/J,KAAAA,CAAMS,OAAAA,CAAQ7S,IAAAA,CAAKkjL,cAAAA,CAAevR,SAAAA,IAAa,GAAAv/J,KAAAA,CAAM8D,WAAAA,EAC5F2E,IAAAA,AAAM,CAAA,GAAA,GAAAnM,GAAAA,AAAAA,EAAiB,SAAb,CAAA,IAAA7N,EAAMixK,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,GAAgB,SAAb,CAAA,IAAAjxK,EAAMkxK,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI;gBACjD/xK,IAAAA,CAAKkjL,cAAAA,CAAezhL,IAAAA,IAAQqxK,GAAc9yK,IAAAA,CAAKkjL,cAAAA,IAChDljL,IAAAA,CAAKyB,IAAAA,GAAAA,MAAa25K,GAAQ3zG,MAAAA,CAAOznE,IAAAA,CAAKkjL,cAAAA,CAAezhL,IAAAA,EAAMzB,IAAAA,CAAKkjL,cAAAA,CAAe/Q,WAAAA,IACvEnyK,IAAAA,CAAKkjL,cAAAA,CAAezhL,IAAAA,IAAQsxK,GAAM/yK,IAAAA,CAAKkjL,cAAAA,KAC/CljL,CAAAA,IAAAA,CAAKyB,IAAAA,GAAOzB,IAAAA,CAAKkjL,cAAAA,CAAezhL,IAAAA,AAAAA;gBAGnC,IAAIisJ,IAAQ1tJ,IAAAA,CAAK0tJ,KAAAA,EACbs2B,IAAYhkL,IAAAA,CAAK0xK,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyBG,MAAAA,CAAOA,MAAAA;gBAOpE,IANyB,YAAA,OAAdwH,KACRt2B,CAAAA,IAAQs2B,CAAAA,GAKPhkL,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI01K,QAAAA,IAAYY,GAAgBv2K,IAAAA,CAAKkjL,cAAAA,GAAiB;oBACrE,MAAMl+K,IAAQhF,IAAAA,CAAKklE,QAAAA,CAAS++G,0BAAAA,CAA2BjkL,IAAAA,CAAKkjL,cAAAA,CAAevQ,MAAAA,EAAQ3yK,IAAAA,CAAKkjL,cAAAA,CAAetQ,MAAAA,GACjGsR,IAAAA,AAAmB,CAAA,GAAA,GAAAx1K,GAAAA,AAAAA,EACtB1J,EAAMsH,CAAAA,GAAItM,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA,EAC5B9vK,EAAMoF,CAAAA,GAAIpK,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;oBAC/B70K,IAAAA,CAAKsjL,YAAAA,GAAe,IAAI,GAAAl8C,YAAAA,CAAa;wBAClC34G,MAAMzuB,IAAAA,CAAKyuB,IAAAA;wBACX5T,KAAKA,EAAIzK,GAAAA,CAAI8zK;wBACb5+E,YAAYtlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;wBAC9BxvE,WAAWrlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA;wBAC7B/+I,SAASl1B,EAAMsZ,KAAAA;wBACf2b,MAAMj1B,EAAMwZ,MAAAA;wBACZmmG,WAAWktC;oBAAAA;gBAEjB,OACG1tJ,IAAAA,CAAKsjL,YAAAA,GAAe,IAAI,GAAAl8C,YAAAA,CAAa;oBAClC34G,MAAMzuB,IAAAA,CAAKyuB,IAAAA;oBACX5T,KAAAA;oBACAwqF,WAAWrlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA;oBAC7BxvE,YAAYtlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;oBAC9B9+I,SAASl1B,EAAMsZ,KAAAA;oBACf2b,MAAMj1B,EAAMwZ,MAAAA;oBACZmmG,WAAWktC;gBAAAA;gBAQjB,IAHA1tJ,IAAAA,CAAKsjL,YAAAA,CAAa9jI,OAAAA,GAAUx/C,IAAAA,CAAKkjL,cAAAA,CAAe1jI,OAAAA,EAChDx/C,IAAAA,CAAKsjL,YAAAA,CAAa16J,OAAAA,GAAU5oB,IAAAA,CAAKkjL,cAAAA,CAAet6J,OAAAA,EAChD5oB,IAAAA,CAAKsjL,YAAAA,CAAah9H,YAAAA,CAAa,IAAI28H,GAAwB;oBAAEC,gBAAgBriL;gBAAAA,KACzEA,EAAM+wK,SAAAA,IAAa/wK,EAAMgxK,SAAAA,EAAW;oBACrC,MAAMz+J,IAAAA,AAAS,CAAA,GAAA,GAAA1E,GAAAA,AAAAA,EAAmB,SAAf,CAAA,IAAA7N,EAAM+wK,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI,GAAkB,SAAf,CAAA,IAAA/wK,EAAMgxK,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI;oBAC5D7xK,IAAAA,CAAKsjL,YAAAA,CAAah9H,YAAAA,CAAa,IAAI,GAAAo7C,iBAAAA,CAAkBtuF;gBACxD;gBAEA,IAAIpT,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI01K,QAAAA,IAAYY,GAAgBv2K,IAAAA,CAAKkjL,cAAAA,GAAiB;oBACrE,MAAM1M,IAAYx2K,IAAAA,CAAKkjL,cAAAA;oBACvB,KAAK,IAAIxmC,KAAS18I,IAAAA,CAAKkjL,cAAAA,CAAe5nC,MAAAA,CAAQ;wBAC3C,IAAI6oC,IAAsB,EAAA;wBACtBrR,GAAc9yK,IAAAA,CAAKkjL,cAAAA,IACpBiB,IAAAA,MAAkB/I,GAAQ3zG,MAAAA,CAAOi1E,EAAMj7I,IAAAA,EAA2B+0K,EAAUrE,WAAAA,IACpEY,GAAM/yK,IAAAA,CAAKkjL,cAAAA,KACnBiB,CAAAA,IAAYznC,EAAMj7I,IAAAA,AAAAA;wBAErB,IAAK,IAAIjB,IAAI,GAAGA,IAAI2jL,EAAU7jL,MAAAA,EAAQE,IAAK;4BACxC,MAAMgzK,IAAM2Q,CAAAA,CAAU3jL,EAAAA;4BACtB,IAAW,KAAPgzK,GAAU;gCAEX,MAAMqO,IAASrhL,IAAIk8I,EAAMviI,KAAAA,GAAUuiI,CAAAA,EAAMpwI,CAAAA,GAAItM,IAAAA,CAAKkjL,cAAAA,CAAevQ,MAAAA,AAAAA,GAC3DiP,IAAQt8K,KAAKoF,KAAAA,CAAMlK,IAAIk8I,EAAMviI,KAAAA,IAAUuiI,CAAAA,EAAMtyI,CAAAA,GAAIpK,IAAAA,CAAKkjL,cAAAA,CAAetQ,MAAAA,AAAAA,GACrEvsE,IAAOrmG,IAAAA,CAAKsjL,YAAAA,CAAal+E,KAAAA,CAAMy8E,IAAQD,IAAQ/gL,EAAMsZ,KAAAA,CAAAA;gCAC3Dna,IAAAA,CAAK2jL,UAAAA,CAAWt9E,GAAMmtE,GAAKoQ,GAAS96J,GAAM+6J;4BAC7C;wBACH;oBACH;gBACH,OAEG,IAAK,IAAIrjL,IAAI,GAAGA,IAAIR,IAAAA,CAAKyB,IAAAA,CAAKnB,MAAAA,EAAQE,IAAK;oBACxC,IAAIgzK,IAAMxzK,IAAAA,CAAKyB,IAAAA,CAAKjB,EAAAA;oBACpB,IAAY,MAARgzK,GAAW;wBACZ,MAAMntE,IAAOrmG,IAAAA,CAAKsjL,YAAAA,CAAal+E,KAAAA,CAAM5kG,EAAAA;wBACrCR,IAAAA,CAAK2jL,UAAAA,CAAWt9E,GAAMmtE,GAAKoQ,GAAS96J,GAAM+6J;oBAC7C;gBACH;YAEN;QAAA;QCpRI,MAAMO;YA8BV,cAAc5Q,CAAAA,EAAAA;gB,I;gBACX,OAAmC,SAA5B,CAAA,IAAAxzK,IAAAA,CAAKojL,cAAAA,CAAezgL,GAAAA,CAAI6wK,EAAAA,KAAAA,KAAI,MAAA,IAAA,IAAI,EAC1C;YAAA;YAMA,oBAAoBp9C,CAAAA,EAAAA;gBASjB,OARcp2H,IAAAA,CAAK6oG,OAAAA,CAAQzD,KAAAA,CAAMp9F,MAAAA,CAAOwO,CAAAA;oBACrC,MAAM+sK,IAAa/sK,EAAE/U,IAAAA,CAAKkB,GAAAA,CAAI05K,GAAyBC,QAAAA,CAASC,KAAAA;oBAChE,OAAA,CAAA,CAAIgH,KACMrG,GAAuB9mD,GAAWmtD;gBAEhC,GAGFtjL,GAAAA,CAAIuW,CAAAA,IAAK,CAAA;wBACnBgtK,QAAQhtK;wBACR+pK,WAAW/pK,EAAE/U,IAAAA,CAAKkB,GAAAA,CAAI05K,GAAyBC,QAAAA,CAASC,KAAAA;oBAAAA,CAAAA;YAE9D;YAOA,mBAAmB9tJ,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAS9B,OARcpD,IAAAA,CAAK6oG,OAAAA,CAAQzD,KAAAA,CAAMp9F,MAAAA,CAAOwO,CAAAA;oBACrC,MAAM+sK,IAAa/sK,EAAE/U,IAAAA,CAAKkB,GAAAA,CAAI05K,GAAyBC,QAAAA,CAASC,KAAAA;oBAChE,OAAA,CAAA,CAAIgH,KACMpG,GAA0B1uJ,GAAMrrB,GAAOmgL;gBAErC,GAGFtjL,GAAAA,CAAIuW,CAAAA,IAAK,CAAA;wBACnBgtK,QAAQhtK;wBACR+pK,WAAW/pK,EAAE/U,IAAAA,CAAKkB,GAAAA,CAAI05K,GAAyBC,QAAAA,CAASC,KAAAA;oBAAAA,CAAAA;YAE9D;YAEA,eAAelnG,CAAAA,EAAAA;gBACZ,IAAA,CAAKr1E,IAAAA,CAAK6oG,OAAAA,EAEP,OADA7oG,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,4EACV;gBAEV,IAAIrY,IAAAA,CAAK6oG,OAAAA,EAAS;oBACf,MAAM26E,IAASxjL,IAAAA,CAAK6oG,OAAAA,CAAQ5B,cAAAA,CAAe5xB;oBAC3C,IAAA,CAAKmuG,GAAQ,OAAO;oBACpB,MAAMpC,IAAYphL,IAAAA,CAAK6oG,OAAAA,CAAQzD,KAAAA,CAAM38F,OAAAA,CAAQ+6K,IACvChQ,IAAMsK,GAAgB99K,IAAAA,CAAKyB,IAAAA,CAAK2/K,EAAAA;oBAEtC,IAAI5N,KAAO,GACR,OAAO;oBAMV,OAAO;wBAAE+M,WAHOvgL,IAAAA,CAAKklE,QAAAA,CAAS+6G,oBAAAA,CAAqBzM,GACzB8L,YAAAA,CAAa9L;wBAEnBgQ,QAAAA;oBAAAA;gBACvB;gBACA,OAAO;YACV;YAEA,oBAAoBl3K,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC5B,IAAA,CAAKpK,IAAAA,CAAK6oG,OAAAA,EAEP,OADA7oG,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,iFACV;gBAEV,IAAIrY,IAAAA,CAAK6oG,OAAAA,EAAS;oBACf,MAAM26E,IAASxjL,IAAAA,CAAK6oG,OAAAA,CAAQ7B,OAAAA,CAAQ16F,GAAGlC,IACjCg3K,IAAYphL,IAAAA,CAAK6oG,OAAAA,CAAQzD,KAAAA,CAAM38F,OAAAA,CAAQ+6K,IACvChQ,IAAMsK,GAAgB99K,IAAAA,CAAKyB,IAAAA,CAAK2/K,EAAAA;oBAEtC,IAAI5N,KAAO,GACR,OAAO;oBAMV,OAAO;wBAAE+M,WAHOvgL,IAAAA,CAAKklE,QAAAA,CAAS+6G,oBAAAA,CAAqBzM,GACzB8L,YAAAA,CAAa9L;wBAEnBgQ,QAAAA;oBAAAA;gBACvB;gBACA,OAAO;YACV;YAEA,YAAmBN,CAAAA,EAAuCh+G,CAAAA,EAAyCwoF,CAAAA,CAAAA;gBAAhF,IAAA,CAAAw1B,cAAAA,GAAAA,GAAuC,IAAA,CAAAh+G,QAAAA,GAAAA,GAAyC,IAAA,CAAAwoF,KAAAA,GAAAA,GArH3F,IAAA,CAAA9jI,MAAAA,GAAS,GAAAhT,MAAAA,CAAOS,WAAAA,IAMR,IAAA,CAAA8C,KAAAA,GAAgB,GAIhB,IAAA,CAAAE,MAAAA,GAAiB,GAEjC,IAAA,CAAAq3J,UAAAA,GAAa,IAAIpjJ,KAKjB,IAAA,CAAA7sB,IAAAA,GAAiB,EAAA,EAOT,IAAA,CAAA2hL,cAAAA,GAAiB,IAAI90J,KA8F1BtuB,IAAAA,CAAKyuB,IAAAA,GAAOy0J,EAAez0J,IAAAA,EAC3BzuB,IAAAA,CAAKyxK,KAAAA,GAAQyR,EAAezR,KAAAA,EAC5BzxK,IAAAA,CAAKma,KAAAA,GAAQ+oK,EAAe/oK,KAAAA,EAC5Bna,IAAAA,CAAKqa,MAAAA,GAAS6oK,EAAe7oK,MAAAA,EAC7BgkK,GAASr+K,IAAAA,EAAMkjL,EAAexR,UAAAA;YACjC;YAEQ,gBAAgB8B,CAAAA,EAAantE,CAAAA,EAAAA;gBAClC,IAAIjB,IAAgCplG,IAAAA,CAAKojL,cAAAA,CAAezgL,GAAAA,CAAI6wK,IAExDkQ,IADU1jL,IAAAA,CAAKklE,QAAAA,CAAS+6G,oBAAAA,CAAqBzM,GACzB8L,YAAAA,CAAa9L;gBAChCpuE,IAGFA,EAAMzlG,IAAAA,CAAK;oBAAC6jL,QAAQn9E;oBAAMk6E,WAAWmD;gBAAAA,KAFrCt+E,IAAQ;oBAAC;wBAACo+E,QAAQn9E;wBAAMk6E,WAAWmD;oBAAAA;iBAAAA,EAItC1jL,IAAAA,CAAKojL,cAAAA,CAAep4J,GAAAA,CAAIwoJ,GAAKpuE,IAC7BiB,EAAK5kG,IAAAA,CAAKupB,GAAAA,CAAIqxJ,GAAyBC,QAAAA,CAASC,KAAAA,EAAOmH;YAC1D;YAEQ,WAAWr9E,CAAAA,EAAcmtE,CAAAA,EAAaoQ,CAAAA,EAAkB96J,CAAAA,EAAa+6J,CAAAA,EAAAA;gBAC1E7jL,IAAAA,CAAKyjL,eAAAA,CAAgBjQ,GAAKntE,IACtBrmG,IAAAA,CAAKklE,QAAAA,CAAS4+G,kBAAAA,IAAsBD,KACrCx9E,CAAAA,EAAKQ,KAAAA,GAAAA,CAAQ,CAAA;gBAGhB,MAAM2uE,IAAUx1K,IAAAA,CAAKklE,QAAAA,CAAS+6G,oBAAAA,CAAqBzM,IAC7C6O,IAAWriL,IAAAA,CAAKklE,QAAAA,CAASm9G,QAAAA;gBAE/B,IAAA,CAAKA,GAAU;oBACZ,IAAI1tJ,IAAS6gJ,EAAQ+L,eAAAA,CAAgB/N;oBACjCoQ,KACDjvJ,CAAAA,IAASA,EAAO1iB,KAAAA,IAChB0iB,EAAO7L,IAAAA,GAAOA,CAAAA,GAEjBu9E,EAAKiD,UAAAA,CAAW30E,GAAQ;wBAAEM,QAAQugJ,EAAQmL,UAAAA;oBAAAA;gBAC7C;gBAIA,MAAM3vG,IAAYwkG,EAAQsM,kBAAAA,CAAmBtO;gBAC7C,KAAK,IAAI9mG,KAAYsE,EAClBq1B,EAAKnxB,WAAAA,CAAYxI;gBAGpB,IAAI2rE,IAAYgqC,IAAW,OAAO7M,EAAQ0M,kBAAAA,CAAmB1O;gBAC7D,IAAIn7B,KACGurC,CAAAA,KACDvrC,CAAAA,IAAYA,EAAUpmI,KAAAA,IACtBomI,EAAUvvH,IAAAA,GAAOA,CAAAA,GAEpBu9E,EAAKmD,aAAAA,IACLnD,EAAKiD,UAAAA,CAAW+uC,GAAW;oBAAEpjH,QAAQugJ,EAAQmL,UAAAA;gBAAAA,IACzC3gL,IAAAA,CAAKklE,QAAAA,CAAS4+G,kBAAAA,AAAAA,GAAoB;oBACnC,MAAMC,IAAUvO,EAAQ8J,YAAAA,CAAa9L,IAC/Bt/H,IAAW6vI,QAAAA,IAAAA,KAAO,IAAPA,EAASrS,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyBroI,SAAAA,CAAU0oI,QAAAA;oBAC5E,IAAIxoI,KAAgC,YAAA,OAAbA,GACpB,OAAQA,EAASuoH,WAAAA;wBACd,KAAK,GAAAztH,iBAAAA,CAAkB+E,GAAAA,CAAI0oH,WAAAA;4BACxBpkB,EAAUnkG,QAAAA,GAAW,GAAAlF,iBAAAA,CAAkB+E,GAAAA;4BACvC;wBAEH,KAAK,GAAA/E,iBAAAA,CAAkBwH,MAAAA,CAAOimH,WAAAA;4BAC3BpkB,EAAUnkG,QAAAA,GAAW,GAAAlF,iBAAAA,CAAkBwH,MAAAA;4BACvC;wBAEH,KAAK,GAAAxH,iBAAAA,CAAkB8E,IAAAA,CAAK2oH,WAAAA;4BACzBpkB,EAAUnkG,QAAAA,GAAW,GAAAlF,iBAAAA,CAAkB8E,IAAAA;4BACvC;wBAEH,KAAK,GAAA9E,iBAAAA,CAAkB4H,QAAAA,CAAS6lH,WAAAA;4BAC7BpkB,EAAUnkG,QAAAA,GAAW,GAAAlF,iBAAAA,CAAkB4H,QAAAA;4BACvC;wBAEH;4BAEG52C,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,CAAA,sCAAA,EAAyCm9J,EAAQ/mJ,IAAAA,CAAAA,aAAAA,EAAoB+kJ,EAAAA,EAAAA,EAAQt/H,GAAAA;oBAAAA;gBAK1G;YAEN;YAEA,MAAA,OAAMjqB;gB,I,G,G,G;gBACH,MAAMrB,IAAU5oB,IAAAA,CAAKkjL,cAAAA,CAAet6J,OAAAA,EAC9Bg7J,IAAAA,CAAAA,CAAY5jL,IAAAA,CAAKkjL,cAAAA,CAAevR,SAAAA,EAChC7oJ,IAAO9oB,IAAAA,CAAKkjL,cAAAA,CAAevR,SAAAA,GAAY,GAAAv/J,KAAAA,CAAMS,OAAAA,CAAQ7S,IAAAA,CAAKkjL,cAAAA,CAAevR,SAAAA,IAAa,GAAAv/J,KAAAA,CAAM8D,WAAAA,EAC5F2tK,IAAAA,CAAAA,CAAiB7jL,IAAAA,CAAK0xK,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyBM,KAAAA,CAAMC,KAAAA,GACpE/7K,IAAQb,IAAAA,CAAKkjL,cAAAA,EACbroK,IAAAA,AAAM,CAAA,GAAA,GAAAnM,GAAAA,AAAAA,EAAiB,SAAb,CAAA,IAAA7N,EAAMixK,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,GAAgB,SAAb,CAAA,IAAAjxK,EAAMkxK,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI;gBAQrD,IAPI/xK,IAAAA,CAAKkjL,cAAAA,CAAezhL,IAAAA,IAAQqxK,GAAc9yK,IAAAA,CAAKkjL,cAAAA,IAChDljL,IAAAA,CAAKyB,IAAAA,GAAAA,MAAa25K,GAAQ3zG,MAAAA,CAAOznE,IAAAA,CAAKkjL,cAAAA,CAAezhL,IAAAA,EAAMzB,IAAAA,CAAKkjL,cAAAA,CAAe/Q,WAAAA,IACvEnyK,IAAAA,CAAKkjL,cAAAA,CAAezhL,IAAAA,IAAQsxK,GAAM/yK,IAAAA,CAAKkjL,cAAAA,KAC/CljL,CAAAA,IAAAA,CAAKyB,IAAAA,GAAOzB,IAAAA,CAAKkjL,cAAAA,CAAezhL,IAAAA,AAAAA,GAI/BzB,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI01K,QAAAA,IAAYY,GAAgBv2K,IAAAA,CAAKkjL,cAAAA,GAAiB;oBACrE,MAAMgB,IAAAA,AAAmB,CAAA,GAAA,GAAAx1K,GAAAA,AAAAA,EACtB1O,IAAAA,CAAKkjL,cAAAA,CAAevQ,MAAAA,GAAS3yK,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA,EAC/C90K,IAAAA,CAAKkjL,cAAAA,CAAetQ,MAAAA,GAAS5yK,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;oBAClD70K,IAAAA,CAAK6oG,OAAAA,GAAU,IAAI,GAAA7D,OAAAA,CAAQ;wBACxBv2E,MAAMzuB,IAAAA,CAAKyuB,IAAAA;wBACX5T,KAAKA,EAAIzK,GAAAA,CAAI8zK;wBACb5+E,YAAYtlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;wBAC9BxvE,WAAWrlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA;wBAC7B/+I,SAASl1B,EAAMsZ,KAAAA;wBACf2b,MAAMj1B,EAAMwZ,MAAAA;oBAAAA;gBAElB,OACGra,IAAAA,CAAK6oG,OAAAA,GAAU,IAAI,GAAA7D,OAAAA,CAAQ;oBACxBv2E,MAAMzuB,IAAAA,CAAKyuB,IAAAA;oBACX5T,KAAAA;oBACAwqF,WAAWrlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA;oBAC7BxvE,YAAYtlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;oBAC9B9+I,SAASl1B,EAAMsZ,KAAAA;oBACf2b,MAAMj1B,EAAMwZ,MAAAA;gBAAAA;gBAKlBra,IAAAA,CAAK6oG,OAAAA,CAAQviD,YAAAA,CAAa,IAAI28H,GAAwB;oBAAEC,gBAAgBriL;gBAAAA;gBACxE,MAAMolB,IAAKjmB,IAAAA,CAAK6oG,OAAAA,CAAQlmG,GAAAA,CAAI,GAAAgwC,kBAAAA;gBAC5B,IAAI1sB,GAAI;oBACLA,EAAG4C,CAAAA,GAAI7oB,IAAAA,CAAK0tJ,KAAAA;oBACZ,IAAIs2B,IAAYhkL,IAAAA,CAAK0xK,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyBG,MAAAA,CAAOA,MAAAA;oBAC3C,YAAA,OAAdwH,KACR/9J,CAAAA,EAAG4C,CAAAA,GAAIm7J,CAAAA;gBAEb;gBACA,MAAMlkI,IAAW9/C,IAAAA,CAAK6oG,OAAAA,CAAQlmG,GAAAA,CAAI,GAAA48C,iBAAAA;gBAKlC,IAJIO,KACDA,CAAAA,EAASN,OAAAA,GAAUx/C,IAAAA,CAAKkjL,cAAAA,CAAe1jI,OAAAA,EACvCM,EAASl3B,OAAAA,GAAUA,CAAAA,GAElB/nB,EAAM+wK,SAAAA,IAAa/wK,EAAMgxK,SAAAA,EAAW;oBACrC,MAAMz+J,IAAAA,AAAS,CAAA,GAAA,GAAA1E,GAAAA,AAAAA,EAAmB,SAAf,CAAA,IAAA7N,EAAM+wK,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI,GAAkB,SAAf,CAAA,IAAA/wK,EAAMgxK,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI;oBAC5D7xK,IAAAA,CAAK6oG,OAAAA,CAAQviD,YAAAA,CAAa,IAAI,GAAAo7C,iBAAAA,CAAkBtuF;gBACnD;gBAGA,IAAIpT,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI01K,QAAAA,IAAYY,GAAgBv2K,IAAAA,CAAKkjL,cAAAA,GAAiB;oBACrE,MAAM1M,IAAYx2K,IAAAA,CAAKkjL,cAAAA;oBACvB,KAAK,IAAIxmC,KAAS18I,IAAAA,CAAKkjL,cAAAA,CAAe5nC,MAAAA,CAAQ;wBAC3C,IAAI6oC,IAAsB,EAAA;wBACtBrR,GAAc9yK,IAAAA,CAAKkjL,cAAAA,IACpBiB,IAAAA,MAAkB/I,GAAQ3zG,MAAAA,CAAOi1E,EAAMj7I,IAAAA,EAA2B+0K,EAAUrE,WAAAA,IACpEY,GAAM/yK,IAAAA,CAAKkjL,cAAAA,KACnBiB,CAAAA,IAAYznC,EAAMj7I,IAAAA,AAAAA;wBAGrB,IAAK,IAAIjB,IAAI,GAAGA,IAAI2jL,EAAU7jL,MAAAA,EAAQE,IAAK;4BACxC,MAAMgzK,IAAM2Q,CAAAA,CAAU3jL,EAAAA;4BACtB,IAAW,KAAPgzK,GAAU;gCAEX,MAAMqO,IAASrhL,IAAIk8I,EAAMviI,KAAAA,GAAUuiI,CAAAA,EAAMpwI,CAAAA,GAAItM,IAAAA,CAAKkjL,cAAAA,CAAevQ,MAAAA,AAAAA,GAC3DiP,IAAQt8K,KAAKoF,KAAAA,CAAMlK,IAAIk8I,EAAMviI,KAAAA,IAAUuiI,CAAAA,EAAMtyI,CAAAA,GAAIpK,IAAAA,CAAKkjL,cAAAA,CAAetQ,MAAAA,AAAAA,GACrEvsE,IAAOrmG,IAAAA,CAAK6oG,OAAAA,CAAQzD,KAAAA,CAAMy8E,IAAQD,IAAQ/gL,EAAMsZ,KAAAA,CAAAA;gCACtDna,IAAAA,CAAK2jL,UAAAA,CAAWt9E,GAAMmtE,GAAKoQ,GAAS96J,GAAM+6J;4BAC7C;wBACH;oBACH;gBACH,OAEG,IAAK,IAAIrjL,IAAI,GAAGA,IAAIR,IAAAA,CAAKyB,IAAAA,CAAKnB,MAAAA,EAAQE,IAAK;oBACxC,IAAIgzK,IAAMxzK,IAAAA,CAAKyB,IAAAA,CAAKjB,EAAAA;oBACpB,IAAY,MAARgzK,GAAW;wBACZ,MAAMntE,IAAOrmG,IAAAA,CAAK6oG,OAAAA,CAAQzD,KAAAA,CAAM5kG,EAAAA;wBAChCR,IAAAA,CAAK2jL,UAAAA,CAAWt9E,GAAMmtE,GAAKoQ,GAAS96J,GAAM+6J;oBAC7C;gBACH;YAEN;QAAA;QCpTI,MAAMS;YAWV,YAAmBC,CAAAA,EAA2Cr/G,CAAAA,EAAyCwoF,CAAAA,CAAAA;gBAApF,IAAA,CAAA62B,gBAAAA,GAAAA,GAA2C,IAAA,CAAAr/G,QAAAA,GAAAA,GAAyC,IAAA,CAAAwoF,KAAAA,GAAAA,GAV/F,IAAA,CAAA9jI,MAAAA,GAAS,GAAAhT,MAAAA,CAAOS,WAAAA,IAIxB,IAAA,CAAAq6J,UAAAA,GAAa,IAAIpjJ,KACjB,IAAA,CAAA2d,OAAAA,GAA0B,EAAA,EAC1B,IAAA,CAAAgkE,QAAAA,GAAqB,EAAA,EACb,IAAA,CAAAu0E,eAAAA,GAAkB,IAAIl2J,KACtB,IAAA,CAAAm2J,eAAAA,GAAkB,IAAIn2J,KACtB,IAAA,CAAA0vJ,OAAAA,GAAAA,CAAU,GAEfh+K,IAAAA,CAAKyuB,IAAAA,GAAO81J,EAAiB91J,IAAAA,EAC7BzuB,IAAAA,CAAKyxK,KAAAA,GAAQ8S,EAAiB9S,KAAAA,EAE9B4M,GAASr+K,IAAAA,EAAMukL,EAAiB7S,UAAAA;YACnC;YAEQ,kBAAqDjjJ,CAAAA,EAAAA;gBAC1DzuB,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,CAAA,YAAA,EAAerY,IAAAA,CAAKyuB,IAAAA,CAAAA,oBAAAA,EAA2BA,EAAAA,wBAAAA,CAAAA;YACnE;YAEA,iBAAiBA,CAAAA,EAAAA;gBAEd,OADKzuB,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,qBACnC1kL,IAAAA,CAAKisC,OAAAA,CAAQjkC,MAAAA,CAAOg1K,GAAsBvuJ;YACpD;YAEA,kBAAkBA,CAAAA,EAAAA;gBAEf,OADKzuB,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,sBACnC1kL,IAAAA,CAAKiwG,QAAAA,CAASjoG,MAAAA,CAAOg1K,GAAsBvuJ;YACrD;YAEA,kBAAkB1N,CAAAA,EAAAA;gBAEf,OADK/gB,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,sBACnC1kL,IAAAA,CAAKwkL,eAAAA,CAAgB7hL,GAAAA,CAAIoe;YACnC;YAEA,kBAAkB81E,CAAAA,EAAAA;gBAEf,OADK72F,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,sBACnC1kL,IAAAA,CAAKykL,eAAAA,CAAgB9hL,GAAAA,CAAIk0F;YACnC;YAQA,qBAAqBumF,CAAAA,EAAsBh6K,CAAAA,EAAAA;gBAExC,OADKpD,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,yBACnC1kL,IAAAA,CAAKisC,OAAAA,CAAQjkC,MAAAA,CAAOm1K,GAA0BC,GAAch6K;YACtE;YAKA,sBAAsBg6K,CAAAA,EAAsBh6K,CAAAA,EAAAA;gBAEzC,OADKpD,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,0BACnC1kL,IAAAA,CAAK+kL,oBAAAA,CAAqB3H,GAAch6K,GAAOnD,GAAAA,CAAIsC,CAAAA,IAAKvC,IAAAA,CAAKwkL,eAAAA,CAAgB7hL,GAAAA,CAAIJ,IAAIyF,MAAAA,CAAO5F,CAAAA,IAAAA,CAAAA,CAAOA;YAC7G;YAMA,sBAAsBg0H,CAAAA,EAAAA;gBAEnB,OADKp2H,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,0BACnC1kL,IAAAA,CAAKisC,OAAAA,CAAQjkC,MAAAA,CAAOk1K,GAAuB9mD;YACrD;YAOA,uBAAuBA,CAAAA,EAAAA;gBAEpB,OADKp2H,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,2BACnC1kL,IAAAA,CAAKilL,qBAAAA,CAAsB7uD,GAAWn2H,GAAAA,CAAIsC,CAAAA,IAAKvC,IAAAA,CAAKwkL,eAAAA,CAAgB7hL,GAAAA,CAAIJ,IAAIyF,MAAAA,CAAO5F,CAAAA,IAAAA,CAAAA,CAAOA;YACpG;YAGA,eAAA+iL;gBAEG,OADKnlL,IAAAA,CAAKg+K,OAAAA,IAASh+K,IAAAA,CAAK0kL,iBAAAA,CAAkB,iBACnC1kL,IAAAA,CAAKisC,OAAAA,CAAQjkC,MAAAA,CAAOzF,CAAAA,IAAKA,aAAa68K;YAChD;YAMA,WAAWhpD,CAAAA,EAAAA;gB,I,G,G,G;gBACR,MAAMnhG,IAAAA,AAAS,CAAA,GAAA,GAAAvmB,GAAAA,AAAAA,EAAiC,SAA7B,CAAA,IAAA1O,IAAAA,CAAKukL,gBAAAA,CAAiBzS,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,GAAgC,SAA7B,CAAA,IAAA9xK,IAAAA,CAAKukL,gBAAAA,CAAiBxS,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,IAElF9lI,IAAUjsC,IAAAA,CAAKisC,OAAAA,CAAQ1gC,KAAAA;gBAC7B,KAAK,IAAIwV,KAAUkrB,EAAS;oBACzB,IAAIqiI,IAAavtJ,EAAO0wJ,KAAAA;oBAKxB,IAJI1wJ,aAAkBq+J,MACnB9Q,CAAAA,IAAaA,KAA0BvtJ,EAAO4yJ,QAAAA,CAAS5yJ,MAAAA,CAAO0wJ,KAAAA,AAAAA,GAG7Dr7C,MAAck4C,GAAY;oBAE9B,IAAIj5F,IAAAA,AAAW,CAAA,GAAA,GAAA3mE,GAAAA,AAAAA,EAAAA,AAAa,CAAA,SAAR,CAAA,IAAAqS,EAAOzU,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI,CAAA,IAAK2oB,EAAO3oB,CAAAA,EAAAA,AAAY,CAAA,SAAR,CAAA,IAAAyU,EAAO3W,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI,CAAA,IAAK6qB,EAAO7qB,CAAAA;oBAGlC,gBAAlCpK,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,IACnBhQ,CAAAA,IAAWr1E,IAAAA,CAAKklE,QAAAA,CAAS++G,0BAAAA,CAA2B5uG,EAAS/oE,CAAAA,EAAG+oE,EAASjrE,CAAAA,CAAAA;oBAG5E,MAAMhL,IAAUY,IAAAA,CAAKklE,QAAAA,CAASmgH,SAAAA,CAAU1iL,GAAAA,CAAIyzH;oBAC5C,IAAIh3H,GAAS;wBAEV,MAAM8kD,IAAS9kD,EAAQ;4BACpBi2E,UAAAA;4BACA5mD,MAAM1N,EAAO0N,IAAAA;4BACbgjJ,OAAOnD;4BACPztK,OAAOb,IAAAA;4BACP+gB,QAAAA;4BACA2wJ,YAAY3wJ,EAAO2wJ,UAAAA;wBAAAA;wBAElBxtH,KACDlkD,IAAAA,CAAKslL,0BAAAA,CAA2BvkK,GAAQmjC;oBAE9C;gBACH;YACH;YAEA,iBAAiBnjC,CAAAA,EAAsBykK,CAAAA,EAAiBhQ,CAAAA,EAAAA;gB,I,G,G,G,G,G;gBACrD,MAAM6M,IAAWriL,IAAAA,CAAKklE,QAAAA,CAASm9G,QAAAA,EACzBuB,IAAAA,CAAAA,CAAY5jL,IAAAA,CAAKukL,gBAAAA,CAAiB5S,SAAAA,EAClC7oJ,IAAO9oB,IAAAA,CAAKukL,gBAAAA,CAAiB5S,SAAAA,GAAY,GAAAv/J,KAAAA,CAAMS,OAAAA,CAAQ7S,IAAAA,CAAKukL,gBAAAA,CAAiB5S,SAAAA,IAAa,GAAAv/J,KAAAA,CAAM0C,KAAAA;gBAEtG,IAAIiM,aAAkBw+J,MAAgB/J,GAAS;oBAE5C,MAAM2L,IAAsD,gBAAlCnhL,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,IAAuD,iBAAxBmwF,EAAQnwF,WAAAA,GAA+B,WAAA,KAAWvkF,GACvHgR,IAAS0jK,EAAQ0L,yBAAAA,CAA0BC;oBAEjDqE,EAAS1zK,MAAAA,GAASA;oBAClB,MAAM8oD,IAAAA,AAAkC,CAAA,SAAxB,CAAA,IAAA75C,EAAOo+J,WAAAA,CAAYhlK,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIna,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA,AAAAA,IAAa90K,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA,EACvFj6G,IAAAA,AAAkC,CAAA,SAAxB,CAAA,IAAA95C,EAAOo+J,WAAAA,CAAYhlK,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIna,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA,AAAAA,IAAa90K,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA,EACvF7kK,IAAAA,AAAQ,CAAA,GAAA,GAAAvB,GAAAA,AAAAA,EAAIksD,GAAQC;oBAE1B,IAAA,CAAKwnH,GAAU;wBAEZ,MAAM1tJ,IAAS6gJ,EAAQ+L,eAAAA,CAAgBxgK,EAAOyyJ,GAAAA,EAAKvhK,KAAAA;wBACnD0iB,EAAO3H,QAAAA,CAAS7S,KAAAA,GAAgC,SAAxB,CAAA,IAAA4G,EAAOo+J,WAAAA,CAAYhlK,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAIwa,EAAOxa,KAAAA,EAC3Dwa,EAAO3H,QAAAA,CAAS3S,MAAAA,GAAkC,SAAzB,CAAA,IAAA0G,EAAOo+J,WAAAA,CAAY9kK,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAIsa,EAAOta,MAAAA,EACzDupK,KACDjvJ,CAAAA,EAAO7L,IAAAA,GAAOA,CAAAA,GAGjB08J,EAAS1lI,QAAAA,CAASvoB,GAAAA,CAAI5C,IACtB6wJ,EAAS1lI,QAAAA,CAAS7qB,MAAAA,GAASugJ,EAAQmL,UAAAA;wBAEnC,MAAMtoC,IAAYm9B,EAAQ0M,kBAAAA,CAAmBnhK,EAAOyyJ,GAAAA;wBACpD,IAAIn7B,GAAW;4BACZ,MAAMotC,IAAkBptC,EAAUpmI,KAAAA;4BAClCwzK,EAAgBx1K,KAAAA,GAAQA,GACpB2zK,KACD6B,CAAAA,EAAgB38J,IAAAA,GAAOA,CAAAA,GAE1B08J,EAAS1lI,QAAAA,CAASvoB,GAAAA,CAAIkuJ,IACtBD,EAAS1lI,QAAAA,CAAS7qB,MAAAA,GAASugJ,EAAQmL,UACtC;wBAAA;oBACH;oBAIA,MAAMxmK,IAAiC,SAAxB,CAAA,IAAA4G,EAAOo+J,WAAAA,CAAYhlK,KAAAA,AAAAA,KAAAA,KAAK,MAAA,IAAA,IAAI,GACrCE,IAAmC,SAAzB,CAAA,IAAA0G,EAAOo+J,WAAAA,CAAY9kK,MAAAA,AAAAA,KAAAA,KAAM,MAAA,IAAA,IAAI,GACvCy3J,IAAAA,CAAW33J,IAAQrI,EAAOxF,CAAAA,EAC1BylK,IAAAA,CAAW13J,IAASvI,EAAO1H,CAAAA,EAC3B28H,IAAgB/mI,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA,GAAY,GAC9CxvE,IAAatlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;oBACrC,IAAI5/I,IAAAA,AAAS,CAAA,GAAA,GAAAvmB,GAAAA,AAAAA,EAAIojK,GAASC;oBACY,gBAAlC/xK,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,IACnBpwD,CAAAA,IAAAA,AAAS,CAAA,GAAA,GAAAvmB,GAAAA,AAAAA,EAAIojK,IAAU/qC,GAAegrC,IAAUzsE,IACpB,iBAAxBkwE,EAAQnwF,WAAAA,IAETpwD,CAAAA,IAASA,EAAO1kB,GAAAA,CAAAA,AAAI,CAAA,GAAA,GAAA7B,GAAAA,AAAAA,EAAIq4H,GAAezhC,GAAAA,CAAAA;oBAI7C,MAAMt0B,IAAYwkG,EAAQsM,kBAAAA,CAAmB/gK,EAAOyyJ,GAAAA,EAAK;wBAAE1hK,QAAQ,GAAAhE,MAAAA,CAAOC,IAAAA;wBAAMkC,OAAAA;wBAAOglB,QAAAA;oBAAAA;oBACvF,IAAI+7C,EAAU1wE,MAAAA,EACXklL,EAAS94G,QAAAA,CAASqd,oBAAAA,CAAqB/Y;yBACnC;wBACJ,IAAI72D,IAAQ4G,EAAO5G,KAAAA,EACfE,IAAS0G,EAAO1G,MAAAA;wBACpB,IAAsC,gBAAlCra,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,EAA6B;4BAEhD,MAAMqgG,IAAY3kK,EAAO1G,MAAAA,GAAS;4BAClCF,IAAQurK,GACRrrK,IAASqrK;wBACZ;wBAEA,IAAIC,IAAc,GAAAlgG,KAAAA,CAAM+C,GAAAA,CAAIruE,GAAOE,GAA0C,gBAAlCra,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,GAAAA,AAA8B,CAAA,GAAA,GAAA32E,GAAAA,AAAAA,EAAI,GAAG,KAAA,AAAK,CAAA,GAAA,GAAAA,GAAAA,AAAAA,EAAI,GAAG;wBACxE,gBAAlC1O,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,IACnBsgG,CAAAA,EAAY5pK,MAAAA,GAAS4pK,EAAY5pK,MAAAA,CAAO9b,GAAAA,CAAIqW,CAAAA,IAAKtW,IAAAA,CAAKklE,QAAAA,CAAS++G,0BAAAA,CAA2B3tK,EAAEhK,CAAAA,EAAGgK,EAAElM,CAAAA,EAAAA,GAEpGo7K,EAAS94G,QAAAA,CAAS1hD,GAAAA,CAAI26J;oBACzB;gBACH;gBAMA,IAJI5kK,aAAkBk+B,MACnBumI,EAAS1lI,QAAAA,CAASvoB,GAAAA,CAAIxW,EAAO6S,IAAAA,GAG5B7S,aAAkB2kE,IAAS;oBAC5B,IAAI7qE,IAAAA,AAAM,CAAA,GAAA,GAAAnM,GAAAA,AAAAA,EAAIqS,EAAOzU,CAAAA,EAAGyU,EAAO3W,CAAAA,GAC3B2R,IAASgF,EAAO87D,WAAAA;oBAEkB,gBAAlC78E,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,IACnBxqE,CAAAA,IAAM7a,IAAAA,CAAKklE,QAAAA,CAAS++G,0BAAAA,CAA2BppK,EAAIvO,CAAAA,EAAGuO,EAAIzQ,CAAAA,GAC1D2R,IAASA,EAAO9b,GAAAA,CAAIqW,CAAAA,IAAKtW,IAAAA,CAAKklE,QAAAA,CAAS++G,0BAAAA,CAA2B3tK,EAAEhK,CAAAA,EAAGgK,EAAElM,CAAAA,EAAAA,GAG5Eo7K,EAAS1zK,MAAAA,GAAAA,AAAS,CAAA,GAAA,GAAApD,GAAAA,AAAAA,EAAI,GAAG,IACzB82K,EAAS3qK,GAAAA,GAAMA;oBACf,MAAM4+D,IAAU,GAAAgM,KAAAA,CAAMC,OAAAA,CAAQ3pE,GAAQ,GAAAjO,MAAAA,CAAOC,IAAAA,EAAAA,CAAM;oBAC9C0rE,EAAQoL,QAAAA,KAGV2gG,EAAS94G,QAAAA,CAAS1hD,GAAAA,CAAIyuD,KAFtB+rG,EAAS94G,QAAAA,CAAS1hD,GAAAA,CAAIyuD,EAAQkM,WAAAA;gBAIpC;gBAEA,IAAI5kE,aAAkB2rE,IAAW;oBAC9B84F,EAAS1zK,MAAAA,GAASiP,EAAOjP,MAAAA;oBACzB,IAAI6zK,IAAc,GAAAlgG,KAAAA,CAAM+C,GAAAA,CAAIznE,EAAO5G,KAAAA,EAAO4G,EAAO1G,MAAAA,EAAQ0G,EAAOjP,MAAAA;oBAC1B,gBAAlC9R,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,IACnBsgG,CAAAA,EAAY5pK,MAAAA,GAAS4pK,EAAY5pK,MAAAA,CAAO9b,GAAAA,CAAIqW,CAAAA,IAAKtW,IAAAA,CAAKklE,QAAAA,CAAS++G,0BAAAA,CAA2B3tK,EAAEhK,CAAAA,EAAGgK,EAAElM,CAAAA,EAAAA,GAEpGo7K,EAAS94G,QAAAA,CAAS1hD,GAAAA,CAAI26J;gBACzB;gBAEI5kK,aAAkB++J,MAInB0F,EAAS94G,QAAAA,CAASmd,iBAAAA,CAAkBvkF,KAAKkF,GAAAA,CAAIuW,EAAO5G,KAAAA,EAAO4G,EAAO1G,MAAAA,IAAU;YAElF;YAEA,MAAA,OAAM4P;gB,I,G,G,G,G;gBACH,MAAMrB,IAAU5oB,IAAAA,CAAKukL,gBAAAA,CAAiB37J,OAAAA,EAChCqM,IAAAA,AAAS,CAAA,GAAA,GAAAvmB,GAAAA,AAAAA,EAAiC,SAA7B,CAAA,IAAA1O,IAAAA,CAAKukL,gBAAAA,CAAiBzS,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,GAAgC,SAA7B,CAAA,IAAA9xK,IAAAA,CAAKukL,gBAAAA,CAAiBxS,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,IAClF9lI,IAAUm0I,GAAapgL,IAAAA,CAAKukL,gBAAAA,EAAkBvkL,IAAAA,CAAKklE,QAAAA;gBAEzD,KAAK,IAAInkD,KAAUkrB,EAAS;oBACzB,IAAIopC,IAAAA,AAAW,CAAA,GAAA,GAAA3mE,GAAAA,AAAAA,EAAAA,AAAa,CAAA,SAAR,CAAA,IAAAqS,EAAOzU,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI,CAAA,IAAK2oB,EAAO3oB,CAAAA,EAAAA,AAAY,CAAA,SAAR,CAAA,IAAAyU,EAAO3W,CAAAA,AAAAA,KAAAA,KAAC,MAAA,IAAA,IAAI,CAAA,IAAK6qB,EAAO7qB,CAAAA;oBAGlC,gBAAlCpK,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,IACnBhQ,CAAAA,IAAWr1E,IAAAA,CAAKklE,QAAAA,CAAS++G,0BAAAA,CAA2B5uG,EAAS/oE,CAAAA,EAAG+oE,EAASjrE,CAAAA,CAAAA;oBAG5E,IAsBIw7K,GAtBAtX,IAAavtJ,EAAO0wJ,KAAAA;oBAIxB,IAHI1wJ,aAAkBq+J,MACnB9Q,CAAAA,IAAaA,KAA0BvtJ,EAAO4yJ,QAAAA,CAAS5yJ,MAAAA,CAAO0wJ,KAAAA,AAAAA,GAE7DnD,GAAY;wBACb,MAAMlvK,IAAUY,IAAAA,CAAKklE,QAAAA,CAASmgH,SAAAA,CAAU1iL,GAAAA,CAAI2rK;wBAC5C,IAAIlvK,GAAS;4BACV,MAAM8kD,IAAS9kD,EAAQ;gCACpBi2E,UAAAA;gCACA5mD,MAAM1N,EAAO0N,IAAAA;gCACbgjJ,OAAOnD;gCACPztK,OAAOb,IAAAA;gCACP+gB,QAAAA;gCACA2wJ,YAAY3wJ,EAAO2wJ,UAAAA;4BAAAA;4BAElBxtH,KACDlkD,IAAAA,CAAKslL,0BAAAA,CAA2BvkK,GAAQmjC;4BAE3C;wBACH;oBACH;oBAGA,IAAI8/H,IAAYhkL,IAAAA,CAAK0xK,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyBG,MAAAA,CAAOA,MAAAA;oBAC3C,YAAA,OAAdwH,KACR4B,CAAAA,IAAS5B,CAAAA;oBAGZ,MAAMwB,IAAW,IAAI,GAAAp8F,KAAAA,CAAM;wBACxB36D,MAAM1N,EAAOo+J,WAAAA,CAAY1wJ,IAAAA;wBACzB5T,KAAKw6D;wBACLvjE,QAAQ,GAAAhE,MAAAA,CAAOC,IAAAA;wBACf4U,UAAAA,AAAU,CAAA,GAAA,GAAAtV,SAAAA,AAAAA,EAAqC,SAA3B,CAAA,IAAA0T,EAAOo+J,WAAAA,CAAYx8J,QAAAA,AAAAA,KAAAA,KAAQ,MAAA,IAAA,IAAI;wBACnDkG,GAAG+8J;oBAAAA,IAEA9lI,IAAW0lI,EAAS7iL,GAAAA,CAAI,GAAA48C,iBAAAA;oBAM9B,IALIO,KACDA,CAAAA,EAASN,OAAAA,GAAUx/C,IAAAA,CAAKukL,gBAAAA,CAAiB/kI,OAAAA,IAAAA,CAAAA,KAA2C1+C,MAA/BigB,EAAOo+J,WAAAA,CAAY3/H,OAAAA,IAAAA,CAAAA,CAAiCz+B,EAAOo+J,WAAAA,CAAY3/H,OAAAA,AAAAA,GAC5HM,EAASl3B,OAAAA,GAAUA,CAAAA,GAGgB,gBAAlC5oB,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIolF,WAAAA,EAA6B;wBAChD,MAAMq7B,IAAM,IAAI,GAAAJ,wBAAAA,CAAyB;4BACtCxqF,MAAM91B,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIoa,MAAAA;4BACxB0b,SAAS/1B,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAIka,KAAAA;4BAC3BkrF,WAAWrlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI60K,SAAAA;4BAC7BxvE,YAAYtlG,IAAAA,CAAKklE,QAAAA,CAASjlE,GAAAA,CAAI40K,UAAAA;wBAAAA;wBAEjCn0D,EAAIF,SAAAA,GAAYolE,QAAAA,IAAAA,IAAU5lL,IAAAA,CAAK0tJ,KAAAA,EAC/B83B,EAASl/H,YAAAA,CAAao6D;oBACzB;oBAEA,IAAI1gH,IAAAA,CAAKklE,QAAAA,CAAS4+G,kBAAAA,EAAoB;wBACnC,MAAMx3G,IAAgBvrD,EAAO2wJ,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyBQ,SAAAA,CAAUC,IAAAA;wBAC/E,IAAIxwG,KAA0C,YAAA,OAAlBA,GACzB,OAAQA,EAAcmwF,WAAAA;4BACnB,KAAK,GAAApyF,aAAAA,CAAcuH,MAAAA,CAAO6qF,WAAAA;gCACvB+oB,EAAS1rK,IAAAA,CAAKwyD,aAAAA,GAAgB,GAAAjC,aAAAA,CAAcuH,MAAAA;gCAC5C;4BAEH,KAAK,GAAAvH,aAAAA,CAActV,KAAAA,CAAM0nG,WAAAA;gCACtB+oB,EAAS1rK,IAAAA,CAAKwyD,aAAAA,GAAgB,GAAAjC,aAAAA,CAActV,KAAAA;gCAC5C;4BAEH,KAAK,GAAAsV,aAAAA,CAAcw0B,OAAAA,CAAQ49D,WAAAA;gCACxB+oB,EAAS1rK,IAAAA,CAAKwyD,aAAAA,GAAgB,GAAAjC,aAAAA,CAAcw0B,OAAAA;gCAC5C;4BAEH,KAAK,GAAAx0B,aAAAA,CAAckC,gBAAAA,CAAiBkwF,WAAAA;gCACjC+oB,EAAS1rK,IAAAA,CAAKwyD,aAAAA,GAAgB,GAAAjC,aAAAA,CAAckC,gBAAAA;gCAC5C;4BAEH;gCACGvsE,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,CAAA,gCAAA,EAAmCrY,IAAAA,CAAKyuB,IAAAA,CAAAA,gBAAAA,EAAuB1N,EAAOnhB,EAAAA,CAAAA,UAAAA,EAAemhB,EAAO0N,IAAAA,CAAAA,EAAAA,EAAS69C,GAAAA;wBAAAA;oBAKlI;oBAGA,IAAIvrD,aAAkBq+J,IAAgB;wBAEnC,MAAM5J,IAAUz0J,EAAO4yJ,QAAAA,CAAS6B,OAAAA;wBAC5Bz0J,EAAO4yJ,QAAAA,CAAS5yJ,MAAAA,IACjB/gB,IAAAA,CAAKulL,gBAAAA,CAAiBxkK,EAAO4yJ,QAAAA,CAAS5yJ,MAAAA,EAAQykK,GAAUhQ;oBAE9D,OAAO;wBACJ,IAAIA;wBACAz0J,aAAkBw+J,MACnB/J,CAAAA,IAAUx1K,IAAAA,CAAKklE,QAAAA,CAAS+6G,oBAAAA,CAAqBl/J,EAAOyyJ,GAAAA,CAAAA,GAEvDxzK,IAAAA,CAAKulL,gBAAAA,CAAiBxkK,GAAQykK,GAAUhQ;oBAC3C;oBAEAx1K,IAAAA,CAAKslL,0BAAAA,CAA2BvkK,GAAQykK;gBAC3C;gBAEAxlL,IAAAA,CAAKg+K,OAAAA,GAAAA,CAAU;YAClB;YAEQ,2BAA2Bj9J,CAAAA,EAAsBmjC,CAAAA,EAAAA;gBACtDA,EAAOoC,YAAAA,CAAa,IAAI08H,GAAmB;oBACxC7D,aAAap+J;gBAAAA,KAEhB/gB,IAAAA,CAAKisC,OAAAA,CAAQtsC,IAAAA,CAAKohB,IAClB/gB,IAAAA,CAAKiwG,QAAAA,CAAStwG,IAAAA,CAAKukD,IACnBlkD,IAAAA,CAAKwkL,eAAAA,CAAgBx5J,GAAAA,CAAIjK,GAAQmjC,IACjClkD,IAAAA,CAAKykL,eAAAA,CAAgBz5J,GAAAA,CAAIk5B,GAAQnjC;YACpC;QAAA;QCzXI,MAAM8kK,KAAS,8IACTC,KAAoBloD,CAAAA;YAC7B,IAAuB,YAAA,OAAZA,GACP,MAAM,IAAI6gB,UAAU;YAExB,MAAM/rI,IAAQkrH,EAAQlrH,KAAAA,CAAMmzK;YAC5B,IAAA,CAAKnzK,GACD,MAAM,IAAIvM,MAAM,CAAA,oCAAA,EAAuCy3H,EAAAA,WAAAA,CAAAA;YAG3D,OADAlrH,EAAM8O,KAAAA,IACC9O;QAAK,GAEVqzK,KAAc/7K,CAAAA,IAAY,QAANA,KAAmB,QAANA,KAAmB,QAANA,GAC9Cg8K,KAAYz2K,CAAAA;YACd,MAAMvN,IAAI2Q,SAASpD,GAAG;YACtB,OAAOZ,MAAM3M,KAAKuN,IAAIvN;QAAC,GAGrBikL,KAAiB,CAAC7jL,GAAGkQ;YACvB,IAAIyzK,GAAW3jL,MAAM2jL,GAAWzzK,IAC5B,OAAO;YACX,MAAA,CAAOs0E,GAAIC,EAAAA,GAJG,AAAA,CAAA,CAACzkF,GAAGkQ,IAAAA,OAAalQ,KAAAA,OAAakQ,IAAI;oBAACqC,OAAOvS;oBAAIuS,OAAOrC;iBAAAA,GAAM;oBAAClQ;oBAAGkQ;iBAAAA,AAAAA,EAIlD0zK,GAAS5jL,IAAI4jL,GAAS1zK;YACjD,OAAIs0E,IAAKC,IACE,IACPD,IAAKC,IAAAA,KAEF;QAAC,GAECs/F,KAAkB,CAAC/jL,GAAGkQ;YAC/B,IAAK,IAAI9R,IAAI,GAAGA,IAAI8E,KAAKC,GAAAA,CAAInD,EAAE9B,MAAAA,EAAQgS,EAAEhS,MAAAA,GAASE,IAAK;gBACnD,MAAMyC,IAAIgjL,GAAe7jL,CAAAA,CAAE5B,EAAAA,IAAM,KAAK8R,CAAAA,CAAE9R,EAAAA,IAAM;gBAC9C,IAAU,MAANyC,GACA,OAAOA;YACf;YACA,OAAO;QAAC,GChBCmjL,KAAU,CAACC,GAAIC,GAAIC;YAE5BC,GAAoBD;YAGpB,MAAMt4E,ICfqB,AAAA,CAAA,CAACo4E,GAAIC;gBAEhC,MAAMG,IAAKX,GAAiBO,IACtBK,IAAKZ,GAAiBQ,IAEtBluF,IAAKquF,EAAGt+J,GAAAA,IACRkwE,IAAKquF,EAAGv+J,GAAAA,IAERllB,IAAIkjL,GAAgBM,GAAIC;gBAC9B,OAAU,MAANzjL,IACOA,IAEPm1F,KAAMC,IACC8tF,GAAgB/tF,EAAG/iE,KAAAA,CAAM,MAAMgjE,EAAGhjE,KAAAA,CAAM,QAE1C+iE,KAAMC,IACJD,IAAAA,KAAU,IAEd;YAAC,CAAA,EDHoBiuF,GAAIC;YAChC,OAAOM,EAAAA,CAAeL,EAAAA,CAAUtlK,QAAAA,CAASgtF;QAAI,GAE3C24E,KAAiB;YACnB,KAAK;gBAAC;aAAA;YACN,MAAM;gBAAC;gBAAG;aAAA;YACV,KAAK;gBAAC;aAAA;YACN,MAAM;gBAAA;gBAAK;aAAA;YACX,KAAK;gBAAA;aAAE;YACP,MAAM;gBAAA;gBAAK;aAAA;QAAA,GAETC,KAAmBrkL,OAAO+D,IAAAA,CAAKqgL,KAC/BJ,KAAuBp8B,CAAAA;YACzB,IAAkB,YAAA,OAAPA,GACP,MAAM,IAAI3L,UAAU,oDAAA,OAAyD2L;YAEjF,IAAA,OAAIy8B,GAAiBp+K,OAAAA,CAAQ2hJ,IACzB,MAAM,IAAIjkJ,MAAM,CAAA,kCAAA,EAAqC0gL,GAAiBtmL,IAAAA,CAAK,MAAA;QAC/E;QElCG,MAAMumL;YAMV,YAAmBC,CAAAA,EAAyC7hH,CAAAA,EAAyCwoF,CAAAA,CAAAA;gBAAlF,IAAA,CAAAq5B,eAAAA,GAAAA,GAAyC,IAAA,CAAA7hH,QAAAA,GAAAA,GAAyC,IAAA,CAAAwoF,KAAAA,GAAAA,GAHrG,IAAA,CAAAgkB,UAAAA,GAAa,IAAIpjJ,KACjB,IAAA,CAAA3B,KAAAA,GAA4B,MAC5B,IAAA,CAAAq6J,UAAAA,GAA2B,MAExBhnL,IAAAA,CAAKyuB,IAAAA,GAAOs4J,EAAgBt4J,IAAAA,EAC5BzuB,IAAAA,CAAKyxK,KAAAA,GAAQsV,EAAgBtV,KAAAA,EAC7B4M,GAASr+K,IAAAA,EAAM+mL,EAAgBrV,UAAAA,GAC3BqV,EAAgBp6J,KAAAA,IACjB3sB,CAAAA,IAAAA,CAAK2sB,KAAAA,GAAQ,IAAI,GAAA6E,WAAAA,CAAYotJ,GAAmB5+K,IAAAA,CAAKklE,QAAAA,CAASz7C,IAAAA,EAAMs9J,EAAgBp6J,KAAAA,EAAO3sB,IAAAA,CAAKklE,QAAAA,CAASw5G,OAAAA,EAAAA;YAE/G;YACA,MAAA,OAAMz0J;gB,I,G,G,G;gBACH,MAAMrB,IAAU5oB,IAAAA,CAAK+mL,eAAAA,CAAgBn+J,OAAAA,EAC/Bg7J,IAAAA,CAAAA,CAAY5jL,IAAAA,CAAK+mL,eAAAA,CAAgBpV,SAAAA,EACjC7oJ,IAAO9oB,IAAAA,CAAK+mL,eAAAA,CAAgBpV,SAAAA,GAAY,GAAAv/J,KAAAA,CAAMS,OAAAA,CAAQ7S,IAAAA,CAAK+mL,eAAAA,CAAgBpV,SAAAA,IAAa,GAAAv/J,KAAAA,CAAM0C,KAAAA,EAC9FmgB,IAAAA,AAAS,CAAA,GAAA,GAAAvmB,GAAAA,AAAAA,EAAgC,SAA5B,CAAA,IAAA1O,IAAAA,CAAK+mL,eAAAA,CAAgBjV,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,GAA+B,SAA5B,CAAA,IAAA9xK,IAAAA,CAAK+mL,eAAAA,CAAgBhV,OAAAA,AAAAA,KAAAA,KAAO,MAAA,IAAA,IAAI,IAChFH,IAA0C,SAA9B,CAAA,IAAA5xK,IAAAA,CAAK+mL,eAAAA,CAAgBnV,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI,GAC9CC,IAA0C,SAA9B,CAAA,IAAA7xK,IAAAA,CAAK+mL,eAAAA,CAAgBlV,SAAAA,AAAAA,KAAAA,KAAS,MAAA,IAAA,IAAI;gBACpD,IAAI7xK,IAAAA,CAAK2sB,KAAAA,EAAO;oBACR3sB,IAAAA,CAAKklE,QAAAA,CAASm9G,QAAAA,IAAAA,MACVriL,IAAAA,CAAK2sB,KAAAA,CAAM1C,IAAAA,IAEpBjqB,IAAAA,CAAKgnL,UAAAA,GAAa,IAAI,GAAA59F,KAAAA,CAAM;wBACzB36D,MAAMzuB,IAAAA,CAAK+mL,eAAAA,CAAgBt4J,IAAAA;wBAC3B5T,KAAKoa;wBACLnjB,QAAQ,GAAAhE,MAAAA,CAAOC,IAAAA;wBACf8a,GAAG7oB,IAAAA,CAAK0tJ,KAAAA;oBAAAA,IAEX1tJ,IAAAA,CAAKgnL,UAAAA,CAAW1gI,YAAAA,CAAa,IAAI,GAAAo7C,iBAAAA,CAAAA,AAAkB,CAAA,GAAA,GAAAhzF,GAAAA,AAAAA,EAAIkjK,GAAWC;oBAElE,MAAMl9I,IAAS30B,IAAAA,CAAK2sB,KAAAA,CAAMsG,QAAAA;oBAC1BjzB,IAAAA,CAAKgnL,UAAAA,CAAWlnI,QAAAA,CAASvoB,GAAAA,CAAI5C,IAC7B30B,IAAAA,CAAKgnL,UAAAA,CAAWlnI,QAAAA,CAASN,OAAAA,GAAUx/C,IAAAA,CAAK+mL,eAAAA,CAAgBvnI,OAAAA,EACxDx/C,IAAAA,CAAKgnL,UAAAA,CAAWlnI,QAAAA,CAASl3B,OAAAA,GAAUA,GAC/Bg7J,KACDjvJ,CAAAA,EAAO7L,IAAAA,GAAOA,CAAAA;gBAEpB;YACH;QAAA;QCoGI,MAAMm+J;YAqDV,YAA4Bx9J,CAAAA,EAAcxQ,CAAAA,CAAAA;gBAAd,IAAA,CAAAwQ,IAAAA,GAAAA,GApDpB,IAAA,CAAAG,MAAAA,GAAS,GAAAhT,MAAAA,CAAOS,WAAAA,IAiBxB,IAAA,CAAAi/J,QAAAA,GAAsB,EAAA,EAItB,IAAA,CAAA4J,SAAAA,GAAwB,EAAA,EAQxB,IAAA,CAAA7J,MAAAA,GAAkB,EAAA,EAEF,IAAA,CAAA6Q,SAAAA,GAA2B,OAC3B,IAAA,CAAAvf,MAAAA,GAAAA,CAAkB,GAE3B,IAAA,CAAA0d,SAAAA,GAAY,IAAI/2J,KAEhB,IAAA,CAAAi0J,MAAAA,GAAS,IAAIxL,IAEb,IAAA,CAAAuL,UAAAA,GAAyBvF,IAIhB,IAAA,CAAAoK,WAAAA,GAAsB,GACtB,IAAA,CAAA1H,WAAAA,GAAsB,GACtB,IAAA,CAAAqE,kBAAAA,GAAAA,CAA8B,GAC9B,IAAA,CAAAsD,qBAAAA,GAAAA,CAAiC,GACjC,IAAA,CAAAC,wBAAAA,GAAAA,CAAoC,GACpC,IAAA,CAAAhF,QAAAA,GAAAA,CAAoB,GAE5B,IAAA,CAAAiF,YAAAA,GAAe,IAAIvJ,GAAY,GAAAvsJ,WAAAA,GAC/B,IAAA,CAAA+1J,cAAAA,GAAiB,IAAIxJ,GAAYqE,KACjC,IAAA,CAAAoF,eAAAA,GAAkB,IAAIzJ,GAAY6E;gBAEvC,MAAA,EAAM,mBACH6E,CAAAA,EAAiB,aACjBhI,CAAAA,EAAW,0BACXiI,CAAAA,EAAwB,oBACxB5D,CAAAA,EAAkB,0BAClBuD,CAAAA,EAAwB,uBACxBD,CAAAA,EAAqB,SACrB1I,CAAAA,EAAO,YACP4D,CAAAA,EAAU,QACV3a,CAAAA,EAAM,UACN0a,CAAAA,EAAQ,aACR8E,CAAAA,EAAAA,GACC;oBAAA,GAAKluK,CAAAA;gBAAAA;gBACTjZ,IAAAA,CAAK2nK,MAAAA,GAASA,QAAAA,IAAAA,IAAU3nK,IAAAA,CAAK2nK,MAAAA,EAC7B3nK,IAAAA,CAAKqiL,QAAAA,GAAWA,QAAAA,IAAAA,IAAYriL,IAAAA,CAAKqiL,QAAAA,EACjCriL,IAAAA,CAAK8jL,kBAAAA,GAAqBA,QAAAA,IAAAA,IAAsB9jL,IAAAA,CAAK8jL,kBAAAA,EACrD9jL,IAAAA,CAAKqnL,wBAAAA,GAA2BA,QAAAA,IAAAA,IAA4BrnL,IAAAA,CAAKqnL,wBAAAA,EACjErnL,IAAAA,CAAKonL,qBAAAA,GAAwBA,QAAAA,IAAAA,IAAyBpnL,IAAAA,CAAKonL,qBAAAA,EAC3DpnL,IAAAA,CAAKy/K,WAAAA,GAAcA,QAAAA,IAAAA,IAAez/K,IAAAA,CAAKy/K,WAAAA,EACvCz/K,IAAAA,CAAKmnL,WAAAA,GAAcA,QAAAA,IAAAA,IAAennL,IAAAA,CAAKmnL,WAAAA,EACvCnnL,IAAAA,CAAKsiL,UAAAA,GAAaA,QAAAA,IAAAA,IAActiL,IAAAA,CAAKsiL,UAAAA,EACrCtiL,IAAAA,CAAK0+K,OAAAA,GAAUA;gBACf,IAAK,MAAMp8K,KAAOolL,EACf1nL,IAAAA,CAAK2nL,qBAAAA,CAAsBrlL,GAAKolL,CAAAA,CAAyBplL,EAAAA;gBAE5DtC,IAAAA,CAAKknL,SAAAA,GAAYO,QAAAA,IAAAA,IAAsBh+J,EAAKxI,QAAAA,CAAS,UAAU,QAAQ;YAC1E;YAOA,sBAAsBm1G,CAAAA,EAAmBh3H,CAAAA,EAAAA;gBAKtC,IAJIY,IAAAA,CAAKqlL,SAAAA,CAAUttK,GAAAA,CAAIq+G,MACpBx9G,QAAQP,IAAAA,CAAK,CAAA,kEAAA,EAAqE+9G,EAAAA,0BAAAA,CAAAA,GAErFp2H,IAAAA,CAAKqlL,SAAAA,CAAUr6J,GAAAA,CAAIorG,GAAWh3H,IAC1BY,IAAAA,CAAK6pB,QAAAA,IACN,KAAK,IAAI+9J,KAAe5nL,IAAAA,CAAK6nL,eAAAA,GAC1BD,EAAYxC,UAAAA,CAAWhvD;YAGhC;YAEA,wBAAwBA,CAAAA,EAAAA;gBAChBp2H,IAAAA,CAAKqlL,SAAAA,CAAUttK,GAAAA,CAAIq+G,MACrBx9G,QAAQP,IAAAA,CAAK,CAAA,qDAAA,EAAwD+9G,EAAAA,qBAAAA,CAAAA,GAExEp2H,IAAAA,CAAKqlL,SAAAA,CAAUx2J,MAAAA,CAAOunG;YACzB;YAOA,qBAAqBo9C,CAAAA,EAAAA;gBAClB,MAAMgO,IAAgB1D,GAAgBtK;gBACtC,IAAIxzK,IAAAA,CAAKs2K,QAAAA,EACN;oBAAA,KAAK,IAAId,KAAWx1K,IAAAA,CAAKs2K,QAAAA,CACtB,IAAIkL,KAAiBhM,EAAQiL,QAAAA,IAAYe,KAAiBhM,EAAQiL,QAAAA,GAAWjL,EAAQkL,SAAAA,GAAY,GAC9F,OAAOlL;gBAAAA;gBAIhB,MAAMrvK,MAAM,CAAA,iCAAA,EAAoCqtK,EAAAA,cAAAA,EAAoBgO,EAAAA,EAAAA,CAAAA;YACvE;YAOA,iBAAiB/yJ,CAAAA,EAAAA;gBACd,OAAOzuB,IAAAA,CAAKs2K,QAAAA,CAAStuK,MAAAA,CAAOg1K,GAAsBvuJ;YACrD;YAMA,sBAAsB2nG,CAAAA,EAAAA;gBACnB,OAAOp2H,IAAAA,CAAKs2K,QAAAA,CAAStuK,MAAAA,CAAOk1K,GAAuB9mD;YACtD;YAQA,qBAAqBgnD,CAAAA,EAAsBh6K,CAAAA,EAAAA;gBACxC,OAAOpD,IAAAA,CAAKs2K,QAAAA,CAAStuK,MAAAA,CAAOm1K,GAA0BC,GAAch6K;YACvE;YAOA,2BAA2BgzH,CAAAA,EAAAA;gBACxB,IAAIviG,IAAkB,EAAA;gBACtB,KAAK,IAAI2hJ,KAAWx1K,IAAAA,CAAKs2K,QAAAA,CACtBziJ,IAAUA,EAAQxzB,MAAAA,CAAOm1K,EAAQpwE,KAAAA,CAAMp9F,MAAAA,CAAOk1K,GAAuB9mD;gBAExE,OAAOviG;YACV;YAQA,0BAA0BpF,CAAAA,EAAcrrB,CAAAA,EAAAA;gBACrC,IAAIywB,IAAkB,EAAA;gBACtB,KAAK,IAAI2hJ,KAAWx1K,IAAAA,CAAKs2K,QAAAA,CACtBziJ,IAAUA,EAAQxzB,MAAAA,CAAOm1K,EAAQpwE,KAAAA,CAAMp9F,MAAAA,CAAOm1K,GAA0B1uJ,GAAMrrB;gBAEjF,OAAOywB;YACV;YAQA,cAAc2/I,CAAAA,EAAAA;gBACX,IAA6B,iBAAzBxzK,IAAAA,CAAKC,GAAAA,CAAIolF,WAAAA,EAA8B;oBACxC,IAAIxxD,IAAsB,EAAA;oBAC1B,KAAK,IAAIhzB,KAASb,IAAAA,CAAKooL,aAAAA,GACpBv0J,IAAUA,EAAQxzB,MAAAA,CAAOQ,EAAMwiL,aAAAA,CAAc7P;oBAEhD,OAAO3/I;gBACV;gBAAO;oBACJ,IAAIA,IAA+B,EAAA;oBACnC,KAAK,IAAIhzB,KAASb,IAAAA,CAAKqoL,gBAAAA,GACpBx0J,IAAUA,EAAQxzB,MAAAA,CAAOQ,EAAMwiL,aAAAA,CAAc7P;oBAEhD,OAAO3/I;gBACV;YACH;YAOA,oBAAoBuiG,CAAAA,EAAAA;gBACjB,IAA6B,iBAAzBp2H,IAAAA,CAAKC,GAAAA,CAAIolF,WAAAA,EAA8B;oBACxC,IAAIxxD,IAAsB,EAAA;oBAC1B,KAAK,IAAIhzB,KAASb,IAAAA,CAAKooL,aAAAA,GACpBv0J,IAAUA,EAAQxzB,MAAAA,CAAOQ,EAAMwgL,mBAAAA,CAAoBjrD;oBAEtD,OAAOviG;gBACV;gBAAO;oBACJ,IAAIA,IAA+B,EAAA;oBACnC,KAAK,IAAIhzB,KAASb,IAAAA,CAAKqoL,gBAAAA,GACpBx0J,IAAUA,EAAQxzB,MAAAA,CAAOQ,EAAMwgL,mBAAAA,CAAoBjrD;oBAEtD,OAAOviG;gBACV;YACH;YAQA,mBAAmBpF,CAAAA,EAAcrrB,CAAAA,EAAAA;gBAC9B,IAA6B,iBAAzBpD,IAAAA,CAAKC,GAAAA,CAAIolF,WAAAA,EAA8B;oBACxC,IAAIxxD,IAAsB,EAAA;oBAC1B,KAAK,IAAIhzB,KAASb,IAAAA,CAAKooL,aAAAA,GACpBv0J,IAAUA,EAAQxzB,MAAAA,CAAOQ,EAAMygL,kBAAAA,CAAmB7yJ,GAAMrrB;oBAE3D,OAAOywB;gBACV;gBAAO;oBACJ,IAAIA,IAA+B,EAAA;oBACnC,KAAK,IAAIhzB,KAASb,IAAAA,CAAKqoL,gBAAAA,GACpBx0J,IAAUA,EAAQxzB,MAAAA,CAAOQ,EAAMygL,kBAAAA,CAAmB7yJ,GAAMrrB;oBAE3D,OAAOywB;gBACV;YACH;YAQA,eAAey0J,CAAAA,EAAmBjzG,CAAAA,EAAAA;gBAC/B,IAA6B,gBAAzBr1E,IAAAA,CAAKC,GAAAA,CAAIolF,WAAAA,EAA6B;oBACvC,MAAMxkF,IAAQb,IAAAA,CAAKqoL,gBAAAA,GAAmBj3H,IAAAA,CAAK4rH,GAAsBsL;oBACjE,IAAIznL,GACD,OAAOA,EAAMomG,cAAAA,CAAe5xB;gBAElC,OAAO;oBACJ,MAAMx0E,IAAQb,IAAAA,CAAKooL,aAAAA,GAAgBh3H,IAAAA,CAAK4rH,GAAsBsL;oBAC9D,IAAIznL,GACD,OAAOA,EAAMomG,cAAAA,CAAe5xB;gBAElC;gBAEA,OAAO;YACV;YAQA,gBAAgBA,CAAAA,EAAAA;gBACb,IAA6B,iBAAzBr1E,IAAAA,CAAKC,GAAAA,CAAIolF,WAAAA,EAA8B;oBACxC,IAAIxxD,IAAsB,EAAA;oBAC1B,KAAK,IAAIhzB,KAASb,IAAAA,CAAKooL,aAAAA,GAAiB;wBACrC,MAAM1E,IAAY7iL,EAAMomG,cAAAA,CAAe5xB;wBACnCquG,KACD7vJ,EAAQl0B,IAAAA,CAAK+jL;oBAEnB;oBACA,OAAO7vJ;gBACV;gBAAO;oBACJ,IAAIA,IAA+B,EAAA;oBACnC,KAAK,IAAIhzB,KAASb,IAAAA,CAAKqoL,gBAAAA,GAAoB;wBACxC,MAAM3E,IAAY7iL,EAAMomG,cAAAA,CAAe5xB;wBACnCquG,KACD7vJ,EAAQl0B,IAAAA,CAAK+jL;oBAEnB;oBACA,OAAO7vJ;gBACV;YACH;YAOA,iBAAiBpF,CAAAA,EAAAA;gBACd,IAAIoF,IAA0B,EAAA;gBAC9B,KAAK,IAAI20J,KAAexoL,IAAAA,CAAK6nL,eAAAA,GAC1Bh0J,IAAUA,EAAQxzB,MAAAA,CAAOmoL,EAAY7D,gBAAAA,CAAiBl2J;gBAEzD,OAAOoF;YACV;YAEA,kBAAkBpF,CAAAA,EAAAA;gBACf,IAAIoF,IAAoB,EAAA;gBACxB,KAAK,IAAI20J,KAAexoL,IAAAA,CAAK6nL,eAAAA,GAC1Bh0J,IAAUA,EAAQxzB,MAAAA,CAAOmoL,EAAY5D,iBAAAA,CAAkBn2J;gBAE1D,OAAOoF;YACV;YAEA,kBAAkB9S,CAAAA,EAAAA;gBACf,KAAK,IAAIynK,KAAexoL,IAAAA,CAAK6nL,eAAAA,GAAmB;oBAC7C,MAAM3jI,IAASskI,EAAY3D,iBAAAA,CAAkB9jK;oBAC7C,IAAImjC,GACD,OAAOA;gBAEb;YAEH;YAEA,kBAAkB2yC,CAAAA,EAAAA;gBACf,KAAK,IAAI2xF,KAAexoL,IAAAA,CAAK6nL,eAAAA,GAAmB;oBAC7C,MAAM9mK,IAASynK,EAAY1D,iBAAAA,CAAkBjuF;oBAC7C,IAAI91E,GACD,OAAOA;gBAEb;YAEH;YAQA,qBAAqBq8J,CAAAA,EAAsBh6K,CAAAA,EAAAA;gBACxC,IAAIywB,IAA0B,EAAA;gBAC9B,KAAK,IAAI20J,KAAexoL,IAAAA,CAAK6nL,eAAAA,GAC1Bh0J,IAAUA,EAAQxzB,MAAAA,CAAOmoL,EAAYzD,oBAAAA,CAAqB3H,GAAch6K;gBAE3E,OAAOywB;YACV;YAKA,sBAAsBupJ,CAAAA,EAAsBh6K,CAAAA,EAAAA;gBACzC,IAAIywB,IAAoB,EAAA;gBACxB,KAAK,IAAI20J,KAAexoL,IAAAA,CAAK6nL,eAAAA,GAC1Bh0J,IAAUA,EAAQxzB,MAAAA,CAAOmoL,EAAYxD,qBAAAA,CAAsB5H,GAAch6K;gBAE5E,OAAOywB;YACV;YAMA,sBAAsBuiG,CAAAA,EAAAA;gBACnB,IAAIviG,IAA0B,EAAA;gBAC9B,KAAK,IAAI20J,KAAexoL,IAAAA,CAAK6nL,eAAAA,GAC1Bh0J,IAAUA,EAAQxzB,MAAAA,CAAOmoL,EAAYvD,qBAAAA,CAAsB7uD;gBAE9D,OAAOviG;YACV;YAOA,uBAAuBuiG,CAAAA,EAAAA;gBACpB,IAAIviG,IAAoB,EAAA;gBACxB,KAAK,IAAI20J,KAAexoL,IAAAA,CAAK6nL,eAAAA,GAC1Bh0J,IAAUA,EAAQxzB,MAAAA,CAAOmoL,EAAYtD,sBAAAA,CAAuB9uD;gBAE/D,OAAOviG;YACV;YASA,oBAAoBy0J,CAAAA,EAAmBh8K,CAAAA,EAAWlC,CAAAA,EAAAA;gBAC/C,MAAMvJ,IAAQb,IAAAA,CAAKooL,aAAAA,GAAgBh3H,IAAAA,CAAK4rH,GAAsBsL;gBAC9D,OAAIznL,IACMA,EAAMwjL,mBAAAA,CAAoB/3K,GAAGlC,KAGhC;YACV;YAEA,eAAeqkB,CAAAA,EAAAA;gBACZ,MAAM4nJ,IAASr2K,IAAAA,CAAKq2K,MAAAA,CAAOruK,MAAAA,CAAOgL,CAAAA,IAAKA,aAAa8zK;gBACpD,OAAIr4J,IACM4nJ,EAAOruK,MAAAA,CAAOg1K,GAAsBvuJ,MAEvC4nJ;YACV;YAEA,cAAc5nJ,CAAAA,EAAAA;gBACX,MAAM4nJ,IAASr2K,IAAAA,CAAKq2K,MAAAA,CAAOruK,MAAAA,CAAOgL,CAAAA,IAAKA,aAAaoxK;gBACpD,OAAI31J,IACM4nJ,EAAOruK,MAAAA,CAAOg1K,GAAsBvuJ,MAEvC4nJ;YACV;YAEA,iBAAiB5nJ,CAAAA,EAAAA;gBACd,MAAM4nJ,IAASr2K,IAAAA,CAAKq2K,MAAAA,CAAOruK,MAAAA,CAAOgL,CAAAA,IAAKA,aAAamwK;gBACpD,OAAI10J,IACM4nJ,EAAOruK,MAAAA,CAAOg1K,GAAsBvuJ,MAEvC4nJ;YACV;YAEA,gBAAgB5nJ,CAAAA,EAAAA;gBACb,MAAM4nJ,IAASr2K,IAAAA,CAAKq2K,MAAAA,CAAOruK,MAAAA,CAAOgL,CAAAA,IAAKA,aAAasxK;gBACpD,OAAI71J,IACM4nJ,EAAOruK,MAAAA,CAAOg1K,GAAsBvuJ,MAEvC4nJ;YACV;YAEA,gBAAgB5nJ,CAAAA,EAAAA;gBACb,OAAOzuB,IAAAA,CAAKq2K,MAAAA,CAAOruK,MAAAA,CAAOg1K,GAAsBvuJ;YACnD;YAEA,qBAAqB2nG,CAAAA,EAAAA;gBAClB,OAAOp2H,IAAAA,CAAKq2K,MAAAA,CAAOruK,MAAAA,CAAOk1K,GAAuB9mD;YACpD;YAEA,oBAAoBgnD,CAAAA,EAAsBh6K,CAAAA,EAAAA;gBACvC,OAAOpD,IAAAA,CAAKq2K,MAAAA,CAAOruK,MAAAA,CAAOm1K,GAA0BC,GAAch6K;YACrE;YAEQ,UAAU3B,CAAAA,EAAAA;gBACf,OAAuB,UAAnBzB,IAAAA,CAAKknL,SAAAA,GACClnL,IAAAA,CAAKuiL,MAAAA,CAAOjkH,KAAAA,CAAM78D,GAAMzB,IAAAA,CAAK2nK,MAAAA,IAE7BlmK;YAEb;YAEA,MAAA,OAAMwoB;gB,I;gBACH,MAAMxoB,IAAAA,MAAazB,IAAAA,CAAKsiL,UAAAA,CAAWtiL,IAAAA,CAAKypB,IAAAA,EAAyB,UAAnBzpB,IAAAA,CAAKknL,SAAAA,GAAsB,QAAQ;gBAGjF,IAAIjnL;gBACJ,IAAID,IAAAA,CAAK2nK,MAAAA,EACN,IAAA;oBACG1nK,IAAMD,IAAAA,CAAK6oL,SAAAA,CAAUpnL;gBACxB,EAAE,OAAO6d,GAAAA;oBAGN,MAFA1G,QAAQ3R,KAAAA,CAAM,CAAA,wCAAA,EAA2CjH,IAAAA,CAAKypB,IAAAA,CAAAA,4BAAAA,EAAmCzpB,IAAAA,CAAKknL,SAAAA,CAAAA,0FAAAA,CAAAA,GACtGtuK,QAAQ3R,KAAAA,CAAM,uEACRqY;gBACT;qBAEArf,IAAMD,IAAAA,CAAK6oL,SAAAA,CAAUpnL;gBAGpB2kL,GAAQa,GAAc6B,qBAAAA,EAAuC,SAAhB,CAAA,IAAA7oL,EAAIm1K,YAAAA,AAAAA,KAAAA,KAAY,MAAA,IAAA,IAAI,SAAS,QAC3Ex8J,QAAQP,IAAAA,CAAK,CAAA,+CAAA,EAAkD4uK,GAAc6B,qBAAAA,CAAAA,qCAAAA,EAA6D7oL,EAAIm1K,YAAAA,EAAAA,GAGjJp1K,IAAAA,CAAKC,GAAAA,GAAMA,GAEXD,IAAAA,CAAK+oL,gBAAAA,IACL/oL,IAAAA,CAAKgpL,iBAAAA,IAAAA,MAGCzkL,QAAQ6+D,GAAAA,CAAI;oBACfpjE,IAAAA,CAAKunL,cAAAA,CAAet9J,IAAAA;oBACnBjqB,IAAAA,CAAKqiL,QAAAA,GAAW99K,QAAQC,OAAAA,KAAYxE,IAAAA,CAAKsnL,YAAAA,CAAar9J,IAAAA;oBACvDjqB,IAAAA,CAAKwnL,eAAAA,CAAgBv9J,IAAAA;iBAAAA,GAIxBjqB,IAAAA,CAAKs2K,QAAAA,GAAW;uBAAIt2K,IAAAA,CAAKs2K,QAAAA;uBAAat2K,IAAAA,CAAKunL,cAAAA,CAAergI,MAAAA,GAASjnD,GAAAA,CAAIuW,CAAAA,IAAKA,EAAE/U,IAAAA;iBAAAA,EAC9EzB,IAAAA,CAAKkgL,SAAAA,GAAYlgL,IAAAA,CAAKwnL,eAAAA,CAAgBtgI,MAAAA,GAASjnD,GAAAA,CAAIuW,CAAAA,IAAKA,EAAE/U,IAAAA;gBAG1D,IAAIwnL,IAA0B,EAAA,EAC1Bv7B,IAAQ1tJ,IAAAA,CAAKmnL,WAAAA;gBACjB,KAAK,MAAMtmL,KAASb,IAAAA,CAAKC,GAAAA,CAAIo2K,MAAAA,CAAQ;oBAClC,IAAmB,gBAAfx1K,EAAM4F,IAAAA,EAAsB;wBAC7B,IAA6B,gBAAzBzG,IAAAA,CAAKC,GAAAA,CAAIolF,WAAAA,EAA6B;4BACvC,MAAM6jG,IAAW,IAAI/F,GAAatiL,GAAOb,IAAAA,EAAM0tJ;4BAC/Cu7B,EAAetpL,IAAAA,CAAKupL;wBACvB;wBACA,IAA6B,iBAAzBlpL,IAAAA,CAAKC,GAAAA,CAAIolF,WAAAA,EAA8B;4BACxC,MAAM8jG,IAAY,IAAI/E,GAAUvjL,GAAOb,IAAAA,EAAM0tJ;4BAC7Cu7B,EAAetpL,IAAAA,CAAKwpL;wBACvB;oBACH;oBACA,IAAmB,kBAAftoL,EAAM4F,IAAAA,EAAwB;wBAC/B,MAAM+hL,IAAc,IAAIlE,GAAYzjL,GAAOb,IAAAA,EAAM0tJ;wBACjDu7B,EAAetpL,IAAAA,CAAK6oL;oBACvB;oBACA,IAAmB,iBAAf3nL,EAAM4F,IAAAA,EAAuB;wBAC9B,MAAM2iL,IAAa,IAAItC,GAAWjmL,GAAOb,IAAAA,EAAM0tJ;wBAC/Cu7B,EAAetpL,IAAAA,CAAKypL;oBACvB;oBACA17B;gBACH;gBAAA,MAEMnpJ,QAAQ6+D,GAAAA,CAAI6lH,EAAehpL,GAAAA,CAAIY,CAAAA,IAASA,EAAMopB,IAAAA,MACpDjqB,IAAAA,CAAKq2K,MAAAA,GAAS4S;YACjB;YAEQ,mBAAAF;gBAEL,KAAK,MAAMvT,KAAWx1K,IAAAA,CAAKC,GAAAA,CAAIq2K,QAAAA,CAAU;oBAEtC,IAAIG,GAAuBjB,IAAU;wBAClC,IAAIP,GAA0BO,IAAU;4BACrC,MAAMmN,IAAY/D,GAAmB5+K,IAAAA,CAAKypB,IAAAA,EAAM+rJ,EAAQ7oJ,KAAAA,EAAO3sB,IAAAA,CAAK0+K,OAAAA,GAC9D/xJ,IAAQ3sB,IAAAA,CAAKsnL,YAAAA,CAAarJ,QAAAA,CAAS0E,IACnC0G,IAAkB,IAAI7I,GAAQ;gCACjC/xJ,MAAM+mJ,EAAQ/mJ,IAAAA;gCACdmyJ,cAAcpL;gCACd7oJ,OAAAA;gCACA8zJ,UAAUjL,EAAQb,QAAAA;4BAAAA;4BAErB30K,IAAAA,CAAKs2K,QAAAA,CAAS32K,IAAAA,CAAK0pL;wBACtB;wBACA,IAAInU,GAAiCM,IAAU;4BAC5C,MAAMqL,IAAc,IAAIvyJ;4BACxB,IAAIknJ,EAAQpwE,KAAAA,EACT;gCAAA,KAAK,IAAIiB,KAAQmvE,EAAQpwE,KAAAA,CACtB,IAAIiB,EAAK15E,KAAAA,EAAO;oCACb,MAAMg2J,IAAY/D,GAAmB5+K,IAAAA,CAAKypB,IAAAA,EAAM48E,EAAK15E,KAAAA,EAAO3sB,IAAAA,CAAK0+K,OAAAA,GAC3D/xJ,IAAQ3sB,IAAAA,CAAKsnL,YAAAA,CAAarJ,QAAAA,CAAS0E;oCACzC9B,EAAY71J,GAAAA,CAAIq7E,GAAM15E;gCACzB;4BAAA;4BAGN,MAAM08J,IAAkB,IAAI7I,GAAQ;gCACjC/xJ,MAAM+mJ,EAAQ/mJ,IAAAA;gCACdmyJ,cAAcpL;gCACdqL,aAAAA;gCACAJ,UAAUjL,EAAQb,QAAAA;4BAAAA;4BAErB30K,IAAAA,CAAKs2K,QAAAA,CAAS32K,IAAAA,CAAK0pL;wBACtB;oBACH;oBACA,IAAI1S,GAAuBnB,IAAU;wBAClC,MAAM8T,IAAa1K,GAAmB5+K,IAAAA,CAAKypB,IAAAA,EAAM+rJ,EAAQj0J,MAAAA,EAAQvhB,IAAAA,CAAK0+K,OAAAA;wBACtE1+K,IAAAA,CAAKunL,cAAAA,CAAetJ,QAAAA,CAASqL,GAAY9T,EAAQb,QAAAA,EAC9C;4BACGhN,QAAQ3nK,IAAAA,CAAK2nK,MAAAA;4BACb0a,UAAUriL,IAAAA,CAAKqiL,QAAAA;4BACfE,QAAQviL,IAAAA,CAAKuiL,MAAAA;4BACbD,YAAYtiL,IAAAA,CAAKsiL,UAAAA;4BACjBE,aAAaxiL,IAAAA,CAAKsnL,YAAAA;4BAClB5I,SAAS1+K,IAAAA,CAAK0+K,OAAAA;wBAAAA;oBAEvB;gBACH;YACH;YAEQ,oBAAAsK;gBAEL,IAAI9I,IAAsB,EAAA;gBAC1B,KAAK,MAAMr/K,KAASb,IAAAA,CAAKC,GAAAA,CAAIo2K,MAAAA,CAC1B,IAAmB,kBAAfx1K,EAAM4F,IAAAA,EAAwB;oBAC/B,IAAI8iL,IAAkB1oL,EAAMorC,OAAAA,CAAQjkC,MAAAA,CAAOzF,CAAAA,IAAKA,EAAEoxK,QAAAA,EAAU1zK,GAAAA,CAAIsC,CAAAA,IAAKA,EAAEoxK,QAAAA;oBACvEuM,IAAYA,EAAU7/K,MAAAA,CAAOkpL;gBAChC;gBAGH,MAAMC,IAAsBtJ,EAAUl4K,MAAAA,CAAO,CAAC5E,GAAOoI,GAAOV,IAClDA,EAAMwgH,SAAAA,CAAU7hG,CAAAA,IAAQA,MAASrmB,OAAWoI;gBAItD,KAAK,MAAM20K,KAAgBqJ,EAAqB;oBAC7C,MAAMC,IAAa7K,GAAmB5+K,IAAAA,CAAKypB,IAAAA,EAAM02J,GAAcngL,IAAAA,CAAK0+K,OAAAA;oBACpE1+K,IAAAA,CAAKwnL,eAAAA,CAAgBvJ,QAAAA,CAASwL,GAAY;wBACvC9hB,QAAQ3nK,IAAAA,CAAK2nK,MAAAA;wBACb0a,UAAUriL,IAAAA,CAAKqiL,QAAAA;wBACfE,QAAQviL,IAAAA,CAAKuiL,MAAAA;wBACbD,YAAYtiL,IAAAA,CAAKsiL,UAAAA;wBACjBE,aAAaxiL,IAAAA,CAAKsnL,YAAAA;wBAClB5I,SAAS1+K,IAAAA,CAAK0+K,OAAAA;oBAAAA;gBAEpB;YACH;YAEA,WAAW14H,CAAAA,EAAc/sC,CAAAA,EAAAA;gBACtB,IAAA,CAAKjZ,IAAAA,CAAK6pB,QAAAA,IAEP,OAAA,KADA7pB,IAAAA,CAAK4pB,MAAAA,CAAOvR,IAAAA,CAAK,CAAA,cAAA,EAAiBrY,IAAAA,CAAKypB,IAAAA,CAAAA,qDAAAA,CAAAA;gBAG1C,MAAMkgK,IAAyC;oBAC5C9uK,KAAAA,AAAK,CAAA,GAAA,GAAAnM,GAAAA,AAAAA,EAAI,GAAG;gBAAA,GAAA,EAET,KAAEmM,CAAAA,EAAAA,GAAQ;oBAAA,GAAK8uK,CAAAA;oBAAAA,GAAmB1wK,CAAAA;gBAAAA;gBACxC,KAAK,MAAMpY,KAASb,IAAAA,CAAKq2K,MAAAA,CAAQ;oBAQ9B,IAPIx1K,aAAiBujL,MAClBvjL,CAAAA,EAAMgoG,OAAAA,CAAQhuF,GAAAA,GAAMha,EAAMgoG,OAAAA,CAAQhuF,GAAAA,CAAIzK,GAAAA,CAAIyK,IAC1CmrC,EAAM51C,GAAAA,CAAIvP,EAAMgoG,OAAAA,CAAAA,GAEfhoG,aAAiBsiL,MAClBn9H,EAAM51C,GAAAA,CAAIvP,EAAMyiL,YAAAA,GAEfziL,aAAiByjL,IAClB,KAAK,MAAMpgI,KAAUrjD,EAAMovG,QAAAA,CAAU;wBAClC,MAAMhqF,IAAKi+B,EAAOvhD,GAAAA,CAAI,GAAAgwC,kBAAAA;wBAClB1sB,KACDA,CAAAA,EAAGpL,GAAAA,GAAMoL,EAAGpL,GAAAA,CAAIzK,GAAAA,CAAIyK,EAAAA,GAEvBmrC,EAAM51C,GAAAA,CAAI8zC;oBACb;oBAECrjD,aAAiBimL,MACdjmL,EAAMmmL,UAAAA,IACPnmL,CAAAA,EAAMmmL,UAAAA,CAAWnsK,GAAAA,GAAMha,EAAMmmL,UAAAA,CAAWnsK,GAAAA,CAAIzK,GAAAA,CAAIyK,IAChDmrC,EAAM51C,GAAAA,CAAIvP,EAAMmmL,UAAAA,CAAAA;gBAGzB;gBAEA,IAAIhnL,IAAAA,CAAK8jL,kBAAAA,EAAoB;oBAC1B,MAAM73I,IAAUjsC,IAAAA,CAAK+kL,oBAAAA,CAAqB1I,GAAyB/wE,MAAAA,CAAOA,MAAAA,EAAAA,CAAQ;oBAClF,IAAIr/D,KAAWA,EAAQ3rC,MAAAA,EAAQ;wBAC5B,MAAMspL,IAAe39I,CAAAA,CAAQ,EAAA;wBAC7B,IAAIitB,IAAO;wBACX,MAAM2wH,IAAWD,EAAalY,UAAAA,CAAW/uK,GAAAA,CAAI05K,GAAyB/wE,MAAAA,CAAOmxE,IAAAA;wBACzEoN,KAAgC,YAAA,OAAbA,KACpB3wH,CAAAA,IAAO2wH,CAAAA,GAGmB,gBAAzB7pL,IAAAA,CAAKC,GAAAA,CAAIolF,WAAAA,GACVr/B,EAAM4Q,MAAAA,CAAO/7C,GAAAA,GAAM7a,IAAAA,CAAKikL,0BAAAA,CAA2B2F,EAAat9K,CAAAA,EAAGs9K,EAAax/K,CAAAA,IAEhF47C,EAAM4Q,MAAAA,CAAO/7C,GAAAA,GAAAA,AAAM,CAAA,GAAA,GAAAnM,GAAAA,AAAAA,EAAIk7K,EAAat9K,CAAAA,EAAGs9K,EAAax/K,CAAAA,GAEvD47C,EAAM4Q,MAAAA,CAAOsC,IAAAA,GAAOA;oBACvB;gBACH;gBAEA,IAAIl5D,IAAAA,CAAKqnL,wBAAAA,EAA0B;oBAChC,MAAMyC,IAAa9pL,IAAAA,CAAKooL,aAAAA,EAAAA,CAAgB,EAAA;oBACxC,IAAI0B,GAAY;wBACb,MAAMC,IAAY,GAAAzuK,WAAAA,CAAYc,aAAAA,CAC3Bpc,IAAAA,CAAKC,GAAAA,CAAIka,KAAAA,GAAQna,IAAAA,CAAKC,GAAAA,CAAI60K,SAAAA,EAC1B90K,IAAAA,CAAKC,GAAAA,CAAIoa,MAAAA,GAASra,IAAAA,CAAKC,GAAAA,CAAI40K,UAAAA,EAC3B,GAAA/mK,MAAAA,CAAOC,IAAAA,EAAM8M,EAAIzK,GAAAA,CAAI05K,EAAWjhF,OAAAA,CAAQhuF,GAAAA;wBAC3CmrC,EAAM4Q,MAAAA,CAAO1iB,QAAAA,CAASs2D,iBAAAA,CAAkBu/E;oBAC3C;gBACH;gBAEI/pL,IAAAA,CAAKonL,qBAAAA,IACFpnL,IAAAA,CAAKC,GAAAA,CAAIm2K,eAAAA,IACVpwH,CAAAA,EAAMwI,eAAAA,GAAkB,GAAAp8C,KAAAA,CAAMS,OAAAA,CAAQ7S,IAAAA,CAAKC,GAAAA,CAAIm2K,eAAAA,CAAAA;YAGxD;YAEA,2BAA2B9pK,CAAAA,EAAWlC,CAAAA,EAAAA;gBAGnC,MACMi7F,IAAYrlG,IAAAA,CAAKC,GAAAA,CAAI60K,SAAAA,EACrBxvE,IAAatlG,IAAAA,CAAKC,GAAAA,CAAI40K,UAAAA,EACtB+M,IAAQx3K,IAAIk7F,GACZu8E,IAAQv1K,IAAIg5F;gBAClB,OAAA,AAAO,CAAA,GAAA,GAAA52F,GAAAA,AAAAA,EAAAA,AACHmzK,CAAAA,IAAQD,CAAAA,IAASv8E,IAAY,IANjB,GAAA,AAOZw8E,CAAAA,IAAQD,CAAAA,IAASt8E,IAAa;YACrC;YAEA,WAAAz7E;gBACG,OAAA,CAAA,CAAS7pB,IAAAA,CAAKC,GACjB;YAAA;QAAA;Q,OApqBc,GAAA6oL,qBAAAA,GAAwB,U;IhD1JzC,CAAA;;;AiDAA;;;;;CAKC,GACD,2BAA2B,GAE3B;AAEA,MAAM,SAAS,QAAQ;AACvB,MAAM,UAAU,QAAQ;AACxB,MAAM,sBACJ,AAAC,OAAO,WAAW,cAAc,OAAO,MAAM,CAAC,MAAM,KAAK,WAAY,mCAAmC;GACrG,MAAM,CAAC,MAAM,CAAC,8BAA8B,mCAAmC;GAC/E;AAEN,QAAQ,MAAM,GAAG;AACjB,QAAQ,UAAU,GAAG;AACrB,QAAQ,iBAAiB,GAAG;AAE5B,MAAM,eAAe;AACrB,QAAQ,UAAU,GAAG;AAErB;;;;;;;;;;;;;CAaC,GACD,OAAO,mBAAmB,GAAG;AAE7B,IAAI,CAAC,OAAO,mBAAmB,IAAI,OAAO,YAAY,eAClD,OAAO,QAAQ,KAAK,KAAK,YAC3B,QAAQ,KAAK,CACX;AAKJ,SAAS;IACP,8CAA8C;IAC9C,IAAI;QACF,MAAM,MAAM,IAAI,WAAW;QAC3B,MAAM,QAAQ;YAAE,KAAK;gBAAc,OAAO;YAAG;QAAE;QAC/C,OAAO,cAAc,CAAC,OAAO,WAAW,SAAS;QACjD,OAAO,cAAc,CAAC,KAAK;QAC3B,OAAO,IAAI,GAAG,OAAO;IACvB,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEA,OAAO,cAAc,CAAC,OAAO,SAAS,EAAE,UAAU;IAChD,YAAY;IACZ,KAAK;QACH,IAAI,CAAC,OAAO,QAAQ,CAAC,IAAI,GAAG,OAAO;QACnC,OAAO,IAAI,CAAC,MAAM;IACpB;AACF;AAEA,OAAO,cAAc,CAAC,OAAO,SAAS,EAAE,UAAU;IAChD,YAAY;IACZ,KAAK;QACH,IAAI,CAAC,OAAO,QAAQ,CAAC,IAAI,GAAG,OAAO;QACnC,OAAO,IAAI,CAAC,UAAU;IACxB;AACF;AAEA,SAAS,aAAc,MAAM;IAC3B,IAAI,SAAS,cACX,MAAM,IAAI,WAAW,gBAAgB,SAAS;IAEhD,4CAA4C;IAC5C,MAAM,MAAM,IAAI,WAAW;IAC3B,OAAO,cAAc,CAAC,KAAK,OAAO,SAAS;IAC3C,OAAO;AACT;AAEA;;;;;;;;CAQC,GAED,SAAS,OAAQ,GAAG,EAAE,gBAAgB,EAAE,MAAM;IAC5C,eAAe;IACf,IAAI,OAAO,QAAQ,UAAU;QAC3B,IAAI,OAAO,qBAAqB,UAC9B,MAAM,IAAI,UACR;QAGJ,OAAO,YAAY;IACrB;IACA,OAAO,KAAK,KAAK,kBAAkB;AACrC;AAEA,OAAO,QAAQ,GAAG,KAAK,kCAAkC;;AAEzD,SAAS,KAAM,KAAK,EAAE,gBAAgB,EAAE,MAAM;IAC5C,IAAI,OAAO,UAAU,UACnB,OAAO,WAAW,OAAO;IAG3B,IAAI,YAAY,MAAM,CAAC,QACrB,OAAO,cAAc;IAGvB,IAAI,SAAS,MACX,MAAM,IAAI,UACR,oHAC0C,OAAO;IAIrD,IAAI,WAAW,OAAO,gBACjB,SAAS,WAAW,MAAM,MAAM,EAAE,cACrC,OAAO,gBAAgB,OAAO,kBAAkB;IAGlD,IAAI,OAAO,sBAAsB,eAC5B,CAAA,WAAW,OAAO,sBAClB,SAAS,WAAW,MAAM,MAAM,EAAE,kBAAkB,GACvD,OAAO,gBAAgB,OAAO,kBAAkB;IAGlD,IAAI,OAAO,UAAU,UACnB,MAAM,IAAI,UACR;IAIJ,MAAM,UAAU,MAAM,OAAO,IAAI,MAAM,OAAO;IAC9C,IAAI,WAAW,QAAQ,YAAY,OACjC,OAAO,OAAO,IAAI,CAAC,SAAS,kBAAkB;IAGhD,MAAM,IAAI,WAAW;IACrB,IAAI,GAAG,OAAO;IAEd,IAAI,OAAO,WAAW,eAAe,OAAO,WAAW,IAAI,QACvD,OAAO,KAAK,CAAC,OAAO,WAAW,CAAC,KAAK,YACvC,OAAO,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,WAAW,CAAC,CAAC,WAAW,kBAAkB;IAG5E,MAAM,IAAI,UACR,oHAC0C,OAAO;AAErD;AAEA;;;;;;;EAOE,GACF,OAAO,IAAI,GAAG,SAAU,KAAK,EAAE,gBAAgB,EAAE,MAAM;IACrD,OAAO,KAAK,OAAO,kBAAkB;AACvC;AAEA,kFAAkF;AAClF,4CAA4C;AAC5C,OAAO,cAAc,CAAC,OAAO,SAAS,EAAE,WAAW,SAAS;AAC5D,OAAO,cAAc,CAAC,QAAQ;AAE9B,SAAS,WAAY,IAAI;IACvB,IAAI,OAAO,SAAS,UAClB,MAAM,IAAI,UAAU;SACf,IAAI,OAAO,GAChB,MAAM,IAAI,WAAW,gBAAgB,OAAO;AAEhD;AAEA,SAAS,MAAO,IAAI,EAAE,IAAI,EAAE,QAAQ;IAClC,WAAW;IACX,IAAI,QAAQ,GACV,OAAO,aAAa;IAEtB,IAAI,SAAS,WACX,wDAAwD;IACxD,uDAAuD;IACvD,oCAAoC;IACpC,OAAO,OAAO,aAAa,WACvB,aAAa,MAAM,IAAI,CAAC,MAAM,YAC9B,aAAa,MAAM,IAAI,CAAC;IAE9B,OAAO,aAAa;AACtB;AAEA;;;EAGE,GACF,OAAO,KAAK,GAAG,SAAU,IAAI,EAAE,IAAI,EAAE,QAAQ;IAC3C,OAAO,MAAM,MAAM,MAAM;AAC3B;AAEA,SAAS,YAAa,IAAI;IACxB,WAAW;IACX,OAAO,aAAa,OAAO,IAAI,IAAI,QAAQ,QAAQ;AACrD;AAEA;;GAEG,GACH,OAAO,WAAW,GAAG,SAAU,IAAI;IACjC,OAAO,YAAY;AACrB;AACA;;CAEC,GACD,OAAO,eAAe,GAAG,SAAU,IAAI;IACrC,OAAO,YAAY;AACrB;AAEA,SAAS,WAAY,MAAM,EAAE,QAAQ;IACnC,IAAI,OAAO,aAAa,YAAY,aAAa,IAC/C,WAAW;IAGb,IAAI,CAAC,OAAO,UAAU,CAAC,WACrB,MAAM,IAAI,UAAU,uBAAuB;IAG7C,MAAM,SAAS,WAAW,QAAQ,YAAY;IAC9C,IAAI,MAAM,aAAa;IAEvB,MAAM,SAAS,IAAI,KAAK,CAAC,QAAQ;IAEjC,IAAI,WAAW,QACb,2EAA2E;IAC3E,0EAA0E;IAC1E,oCAAoC;IACpC,MAAM,IAAI,KAAK,CAAC,GAAG;IAGrB,OAAO;AACT;AAEA,SAAS,cAAe,KAAK;IAC3B,MAAM,SAAS,MAAM,MAAM,GAAG,IAAI,IAAI,QAAQ,MAAM,MAAM,IAAI;IAC9D,MAAM,MAAM,aAAa;IACzB,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,KAAK,EAC/B,GAAG,CAAC,EAAE,GAAG,KAAK,CAAC,EAAE,GAAG;IAEtB,OAAO;AACT;AAEA,SAAS,cAAe,SAAS;IAC/B,IAAI,WAAW,WAAW,aAAa;QACrC,MAAM,OAAO,IAAI,WAAW;QAC5B,OAAO,gBAAgB,KAAK,MAAM,EAAE,KAAK,UAAU,EAAE,KAAK,UAAU;IACtE;IACA,OAAO,cAAc;AACvB;AAEA,SAAS,gBAAiB,KAAK,EAAE,UAAU,EAAE,MAAM;IACjD,IAAI,aAAa,KAAK,MAAM,UAAU,GAAG,YACvC,MAAM,IAAI,WAAW;IAGvB,IAAI,MAAM,UAAU,GAAG,aAAc,CAAA,UAAU,CAAA,GAC7C,MAAM,IAAI,WAAW;IAGvB,IAAI;IACJ,IAAI,eAAe,aAAa,WAAW,WACzC,MAAM,IAAI,WAAW;SAChB,IAAI,WAAW,WACpB,MAAM,IAAI,WAAW,OAAO;SAE5B,MAAM,IAAI,WAAW,OAAO,YAAY;IAG1C,4CAA4C;IAC5C,OAAO,cAAc,CAAC,KAAK,OAAO,SAAS;IAE3C,OAAO;AACT;AAEA,SAAS,WAAY,GAAG;IACtB,IAAI,OAAO,QAAQ,CAAC,MAAM;QACxB,MAAM,MAAM,QAAQ,IAAI,MAAM,IAAI;QAClC,MAAM,MAAM,aAAa;QAEzB,IAAI,IAAI,MAAM,KAAK,GACjB,OAAO;QAGT,IAAI,IAAI,CAAC,KAAK,GAAG,GAAG;QACpB,OAAO;IACT;IAEA,IAAI,IAAI,MAAM,KAAK,WAAW;QAC5B,IAAI,OAAO,IAAI,MAAM,KAAK,YAAY,YAAY,IAAI,MAAM,GAC1D,OAAO,aAAa;QAEtB,OAAO,cAAc;IACvB;IAEA,IAAI,IAAI,IAAI,KAAK,YAAY,MAAM,OAAO,CAAC,IAAI,IAAI,GACjD,OAAO,cAAc,IAAI,IAAI;AAEjC;AAEA,SAAS,QAAS,MAAM;IACtB,wEAAwE;IACxE,sDAAsD;IACtD,IAAI,UAAU,cACZ,MAAM,IAAI,WAAW,4DACa,aAAa,QAAQ,CAAC,MAAM;IAEhE,OAAO,SAAS;AAClB;AAEA,SAAS,WAAY,MAAM;IACzB,IAAI,CAAC,UAAU,QACb,SAAS;IAEX,OAAO,OAAO,KAAK,CAAC,CAAC;AACvB;AAEA,OAAO,QAAQ,GAAG,SAAS,SAAU,CAAC;IACpC,OAAO,KAAK,QAAQ,EAAE,SAAS,KAAK,QAClC,MAAM,OAAO,SAAS,CAAC,qDAAqD;;AAChF;AAEA,OAAO,OAAO,GAAG,SAAS,QAAS,CAAC,EAAE,CAAC;IACrC,IAAI,WAAW,GAAG,aAAa,IAAI,OAAO,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,UAAU;IACxE,IAAI,WAAW,GAAG,aAAa,IAAI,OAAO,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,UAAU;IACxE,IAAI,CAAC,OAAO,QAAQ,CAAC,MAAM,CAAC,OAAO,QAAQ,CAAC,IAC1C,MAAM,IAAI,UACR;IAIJ,IAAI,MAAM,GAAG,OAAO;IAEpB,IAAI,IAAI,EAAE,MAAM;IAChB,IAAI,IAAI,EAAE,MAAM;IAEhB,IAAK,IAAI,IAAI,GAAG,MAAM,KAAK,GAAG,CAAC,GAAG,IAAI,IAAI,KAAK,EAAE,EAC/C,IAAI,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,EAAE;QACjB,IAAI,CAAC,CAAC,EAAE;QACR,IAAI,CAAC,CAAC,EAAE;QACR;IACF;IAGF,IAAI,IAAI,GAAG,OAAO;IAClB,IAAI,IAAI,GAAG,OAAO;IAClB,OAAO;AACT;AAEA,OAAO,UAAU,GAAG,SAAS,WAAY,QAAQ;IAC/C,OAAQ,OAAO,UAAU,WAAW;QAClC,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF;AAEA,OAAO,MAAM,GAAG,SAAS,OAAQ,IAAI,EAAE,MAAM;IAC3C,IAAI,CAAC,MAAM,OAAO,CAAC,OACjB,MAAM,IAAI,UAAU;IAGtB,IAAI,KAAK,MAAM,KAAK,GAClB,OAAO,OAAO,KAAK,CAAC;IAGtB,IAAI;IACJ,IAAI,WAAW,WAAW;QACxB,SAAS;QACT,IAAK,IAAI,GAAG,IAAI,KAAK,MAAM,EAAE,EAAE,EAC7B,UAAU,IAAI,CAAC,EAAE,CAAC,MAAM;IAE5B;IAEA,MAAM,SAAS,OAAO,WAAW,CAAC;IAClC,IAAI,MAAM;IACV,IAAK,IAAI,GAAG,IAAI,KAAK,MAAM,EAAE,EAAE,EAAG;QAChC,IAAI,MAAM,IAAI,CAAC,EAAE;QACjB,IAAI,WAAW,KAAK;YAClB,IAAI,MAAM,IAAI,MAAM,GAAG,OAAO,MAAM,EAAE;gBACpC,IAAI,CAAC,OAAO,QAAQ,CAAC,MAAM,MAAM,OAAO,IAAI,CAAC;gBAC7C,IAAI,IAAI,CAAC,QAAQ;YACnB,OACE,WAAW,SAAS,CAAC,GAAG,CAAC,IAAI,CAC3B,QACA,KACA;eAGC,IAAI,CAAC,OAAO,QAAQ,CAAC,MAC1B,MAAM,IAAI,UAAU;aAEpB,IAAI,IAAI,CAAC,QAAQ;QAEnB,OAAO,IAAI,MAAM;IACnB;IACA,OAAO;AACT;AAEA,SAAS,WAAY,MAAM,EAAE,QAAQ;IACnC,IAAI,OAAO,QAAQ,CAAC,SAClB,OAAO,OAAO,MAAM;IAEtB,IAAI,YAAY,MAAM,CAAC,WAAW,WAAW,QAAQ,cACnD,OAAO,OAAO,UAAU;IAE1B,IAAI,OAAO,WAAW,UACpB,MAAM,IAAI,UACR,6FACmB,OAAO;IAI9B,MAAM,MAAM,OAAO,MAAM;IACzB,MAAM,YAAa,UAAU,MAAM,GAAG,KAAK,SAAS,CAAC,EAAE,KAAK;IAC5D,IAAI,CAAC,aAAa,QAAQ,GAAG,OAAO;IAEpC,oCAAoC;IACpC,IAAI,cAAc;IAClB,OACE,OAAQ;QACN,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO;QACT,KAAK;QACL,KAAK;YACH,OAAO,YAAY,QAAQ,MAAM;QACnC,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO,MAAM;QACf,KAAK;YACH,OAAO,QAAQ;QACjB,KAAK;YACH,OAAO,cAAc,QAAQ,MAAM;QACrC;YACE,IAAI,aACF,OAAO,YAAY,KAAK,YAAY,QAAQ,MAAM,CAAC,cAAc;;YAEnE,WAAW,AAAC,CAAA,KAAK,QAAO,EAAG,WAAW;YACtC,cAAc;IAClB;AAEJ;AACA,OAAO,UAAU,GAAG;AAEpB,SAAS,aAAc,QAAQ,EAAE,KAAK,EAAE,GAAG;IACzC,IAAI,cAAc;IAElB,4EAA4E;IAC5E,6BAA6B;IAE7B,2EAA2E;IAC3E,mEAAmE;IACnE,8DAA8D;IAC9D,kEAAkE;IAClE,IAAI,UAAU,aAAa,QAAQ,GACjC,QAAQ;IAEV,6EAA6E;IAC7E,uBAAuB;IACvB,IAAI,QAAQ,IAAI,CAAC,MAAM,EACrB,OAAO;IAGT,IAAI,QAAQ,aAAa,MAAM,IAAI,CAAC,MAAM,EACxC,MAAM,IAAI,CAAC,MAAM;IAGnB,IAAI,OAAO,GACT,OAAO;IAGT,0EAA0E;IAC1E,SAAS;IACT,WAAW;IAEX,IAAI,OAAO,OACT,OAAO;IAGT,IAAI,CAAC,UAAU,WAAW;IAE1B,MAAO,KACL,OAAQ;QACN,KAAK;YACH,OAAO,SAAS,IAAI,EAAE,OAAO;QAE/B,KAAK;QACL,KAAK;YACH,OAAO,UAAU,IAAI,EAAE,OAAO;QAEhC,KAAK;YACH,OAAO,WAAW,IAAI,EAAE,OAAO;QAEjC,KAAK;QACL,KAAK;YACH,OAAO,YAAY,IAAI,EAAE,OAAO;QAElC,KAAK;YACH,OAAO,YAAY,IAAI,EAAE,OAAO;QAElC,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO,aAAa,IAAI,EAAE,OAAO;QAEnC;YACE,IAAI,aAAa,MAAM,IAAI,UAAU,uBAAuB;YAC5D,WAAW,AAAC,CAAA,WAAW,EAAC,EAAG,WAAW;YACtC,cAAc;IAClB;AAEJ;AAEA,+EAA+E;AAC/E,4EAA4E;AAC5E,6EAA6E;AAC7E,2EAA2E;AAC3E,yEAAyE;AACzE,mDAAmD;AACnD,OAAO,SAAS,CAAC,SAAS,GAAG;AAE7B,SAAS,KAAM,CAAC,EAAE,CAAC,EAAE,CAAC;IACpB,MAAM,IAAI,CAAC,CAAC,EAAE;IACd,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;IACX,CAAC,CAAC,EAAE,GAAG;AACT;AAEA,OAAO,SAAS,CAAC,MAAM,GAAG,SAAS;IACjC,MAAM,MAAM,IAAI,CAAC,MAAM;IACvB,IAAI,MAAM,MAAM,GACd,MAAM,IAAI,WAAW;IAEvB,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,KAAK,EAC5B,KAAK,IAAI,EAAE,GAAG,IAAI;IAEpB,OAAO,IAAI;AACb;AAEA,OAAO,SAAS,CAAC,MAAM,GAAG,SAAS;IACjC,MAAM,MAAM,IAAI,CAAC,MAAM;IACvB,IAAI,MAAM,MAAM,GACd,MAAM,IAAI,WAAW;IAEvB,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,KAAK,EAAG;QAC/B,KAAK,IAAI,EAAE,GAAG,IAAI;QAClB,KAAK,IAAI,EAAE,IAAI,GAAG,IAAI;IACxB;IACA,OAAO,IAAI;AACb;AAEA,OAAO,SAAS,CAAC,MAAM,GAAG,SAAS;IACjC,MAAM,MAAM,IAAI,CAAC,MAAM;IACvB,IAAI,MAAM,MAAM,GACd,MAAM,IAAI,WAAW;IAEvB,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,KAAK,EAAG;QAC/B,KAAK,IAAI,EAAE,GAAG,IAAI;QAClB,KAAK,IAAI,EAAE,IAAI,GAAG,IAAI;QACtB,KAAK,IAAI,EAAE,IAAI,GAAG,IAAI;QACtB,KAAK,IAAI,EAAE,IAAI,GAAG,IAAI;IACxB;IACA,OAAO,IAAI;AACb;AAEA,OAAO,SAAS,CAAC,QAAQ,GAAG,SAAS;IACnC,MAAM,SAAS,IAAI,CAAC,MAAM;IAC1B,IAAI,WAAW,GAAG,OAAO;IACzB,IAAI,UAAU,MAAM,KAAK,GAAG,OAAO,UAAU,IAAI,EAAE,GAAG;IACtD,OAAO,aAAa,KAAK,CAAC,IAAI,EAAE;AAClC;AAEA,OAAO,SAAS,CAAC,cAAc,GAAG,OAAO,SAAS,CAAC,QAAQ;AAE3D,OAAO,SAAS,CAAC,MAAM,GAAG,SAAS,OAAQ,CAAC;IAC1C,IAAI,CAAC,OAAO,QAAQ,CAAC,IAAI,MAAM,IAAI,UAAU;IAC7C,IAAI,IAAI,KAAK,GAAG,OAAO;IACvB,OAAO,OAAO,OAAO,CAAC,IAAI,EAAE,OAAO;AACrC;AAEA,OAAO,SAAS,CAAC,OAAO,GAAG,SAAS;IAClC,IAAI,MAAM;IACV,MAAM,MAAM,QAAQ,iBAAiB;IACrC,MAAM,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,KAAK,OAAO,CAAC,WAAW,OAAO,IAAI;IACjE,IAAI,IAAI,CAAC,MAAM,GAAG,KAAK,OAAO;IAC9B,OAAO,aAAa,MAAM;AAC5B;AACA,IAAI,qBACF,OAAO,SAAS,CAAC,oBAAoB,GAAG,OAAO,SAAS,CAAC,OAAO;AAGlE,OAAO,SAAS,CAAC,OAAO,GAAG,SAAS,QAAS,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,SAAS,EAAE,OAAO;IACjF,IAAI,WAAW,QAAQ,aACrB,SAAS,OAAO,IAAI,CAAC,QAAQ,OAAO,MAAM,EAAE,OAAO,UAAU;IAE/D,IAAI,CAAC,OAAO,QAAQ,CAAC,SACnB,MAAM,IAAI,UACR,mFACoB,OAAO;IAI/B,IAAI,UAAU,WACZ,QAAQ;IAEV,IAAI,QAAQ,WACV,MAAM,SAAS,OAAO,MAAM,GAAG;IAEjC,IAAI,cAAc,WAChB,YAAY;IAEd,IAAI,YAAY,WACd,UAAU,IAAI,CAAC,MAAM;IAGvB,IAAI,QAAQ,KAAK,MAAM,OAAO,MAAM,IAAI,YAAY,KAAK,UAAU,IAAI,CAAC,MAAM,EAC5E,MAAM,IAAI,WAAW;IAGvB,IAAI,aAAa,WAAW,SAAS,KACnC,OAAO;IAET,IAAI,aAAa,SACf,OAAO;IAET,IAAI,SAAS,KACX,OAAO;IAGT,WAAW;IACX,SAAS;IACT,eAAe;IACf,aAAa;IAEb,IAAI,IAAI,KAAK,QAAQ,OAAO;IAE5B,IAAI,IAAI,UAAU;IAClB,IAAI,IAAI,MAAM;IACd,MAAM,MAAM,KAAK,GAAG,CAAC,GAAG;IAExB,MAAM,WAAW,IAAI,CAAC,KAAK,CAAC,WAAW;IACvC,MAAM,aAAa,OAAO,KAAK,CAAC,OAAO;IAEvC,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,EAAE,EACzB,IAAI,QAAQ,CAAC,EAAE,KAAK,UAAU,CAAC,EAAE,EAAE;QACjC,IAAI,QAAQ,CAAC,EAAE;QACf,IAAI,UAAU,CAAC,EAAE;QACjB;IACF;IAGF,IAAI,IAAI,GAAG,OAAO;IAClB,IAAI,IAAI,GAAG,OAAO;IAClB,OAAO;AACT;AAEA,+EAA+E;AAC/E,oEAAoE;AACpE,EAAE;AACF,aAAa;AACb,gCAAgC;AAChC,sCAAsC;AACtC,qEAAqE;AACrE,iEAAiE;AACjE,kDAAkD;AAClD,SAAS,qBAAsB,MAAM,EAAE,GAAG,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG;IACnE,8BAA8B;IAC9B,IAAI,OAAO,MAAM,KAAK,GAAG,OAAO;IAEhC,uBAAuB;IACvB,IAAI,OAAO,eAAe,UAAU;QAClC,WAAW;QACX,aAAa;IACf,OAAO,IAAI,aAAa,YACtB,aAAa;SACR,IAAI,aAAa,aACtB,aAAa;IAEf,aAAa,CAAC,WAAW,oBAAoB;;IAC7C,IAAI,YAAY,aACd,4EAA4E;IAC5E,aAAa,MAAM,IAAK,OAAO,MAAM,GAAG;IAG1C,0EAA0E;IAC1E,IAAI,aAAa,GAAG,aAAa,OAAO,MAAM,GAAG;IACjD,IAAI,cAAc,OAAO,MAAM,EAAE;QAC/B,IAAI,KAAK,OAAO;aACX,aAAa,OAAO,MAAM,GAAG;IACpC,OAAO,IAAI,aAAa,GAAG;QACzB,IAAI,KAAK,aAAa;aACjB,OAAO;IACd;IAEA,gBAAgB;IAChB,IAAI,OAAO,QAAQ,UACjB,MAAM,OAAO,IAAI,CAAC,KAAK;IAGzB,iEAAiE;IACjE,IAAI,OAAO,QAAQ,CAAC,MAAM;QACxB,6DAA6D;QAC7D,IAAI,IAAI,MAAM,KAAK,GACjB,OAAO;QAET,OAAO,aAAa,QAAQ,KAAK,YAAY,UAAU;IACzD,OAAO,IAAI,OAAO,QAAQ,UAAU;QAClC,MAAM,MAAM,KAAK,kCAAkC;;QACnD,IAAI,OAAO,WAAW,SAAS,CAAC,OAAO,KAAK,YAAY;YACtD,IAAI,KACF,OAAO,WAAW,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,KAAK;iBAEtD,OAAO,WAAW,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,KAAK;QAE9D;QACA,OAAO,aAAa,QAAQ;YAAC;SAAI,EAAE,YAAY,UAAU;IAC3D;IAEA,MAAM,IAAI,UAAU;AACtB;AAEA,SAAS,aAAc,GAAG,EAAE,GAAG,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG;IACxD,IAAI,YAAY;IAChB,IAAI,YAAY,IAAI,MAAM;IAC1B,IAAI,YAAY,IAAI,MAAM;IAE1B,IAAI,aAAa,WAAW;QAC1B,WAAW,OAAO,UAAU,WAAW;QACvC,IAAI,aAAa,UAAU,aAAa,WACpC,aAAa,aAAa,aAAa,YAAY;YACrD,IAAI,IAAI,MAAM,GAAG,KAAK,IAAI,MAAM,GAAG,GACjC,OAAO;YAET,YAAY;YACZ,aAAa;YACb,aAAa;YACb,cAAc;QAChB;IACF;IAEA,SAAS,KAAM,GAAG,EAAE,CAAC;QACnB,IAAI,cAAc,GAChB,OAAO,GAAG,CAAC,EAAE;aAEb,OAAO,IAAI,YAAY,CAAC,IAAI;IAEhC;IAEA,IAAI;IACJ,IAAI,KAAK;QACP,IAAI,aAAa;QACjB,IAAK,IAAI,YAAY,IAAI,WAAW,IAClC,IAAI,KAAK,KAAK,OAAO,KAAK,KAAK,eAAe,KAAK,IAAI,IAAI,aAAa;YACtE,IAAI,eAAe,IAAI,aAAa;YACpC,IAAI,IAAI,aAAa,MAAM,WAAW,OAAO,aAAa;QAC5D,OAAO;YACL,IAAI,eAAe,IAAI,KAAK,IAAI;YAChC,aAAa;QACf;IAEJ,OAAO;QACL,IAAI,aAAa,YAAY,WAAW,aAAa,YAAY;QACjE,IAAK,IAAI,YAAY,KAAK,GAAG,IAAK;YAChC,IAAI,QAAQ;YACZ,IAAK,IAAI,IAAI,GAAG,IAAI,WAAW,IAC7B,IAAI,KAAK,KAAK,IAAI,OAAO,KAAK,KAAK,IAAI;gBACrC,QAAQ;gBACR;YACF;YAEF,IAAI,OAAO,OAAO;QACpB;IACF;IAEA,OAAO;AACT;AAEA,OAAO,SAAS,CAAC,QAAQ,GAAG,SAAS,SAAU,GAAG,EAAE,UAAU,EAAE,QAAQ;IACtE,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,YAAY,cAAc;AACrD;AAEA,OAAO,SAAS,CAAC,OAAO,GAAG,SAAS,QAAS,GAAG,EAAE,UAAU,EAAE,QAAQ;IACpE,OAAO,qBAAqB,IAAI,EAAE,KAAK,YAAY,UAAU;AAC/D;AAEA,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,GAAG,EAAE,UAAU,EAAE,QAAQ;IAC5E,OAAO,qBAAqB,IAAI,EAAE,KAAK,YAAY,UAAU;AAC/D;AAEA,SAAS,SAAU,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM;IAC5C,SAAS,OAAO,WAAW;IAC3B,MAAM,YAAY,IAAI,MAAM,GAAG;IAC/B,IAAI,CAAC,QACH,SAAS;SACJ;QACL,SAAS,OAAO;QAChB,IAAI,SAAS,WACX,SAAS;IAEb;IAEA,MAAM,SAAS,OAAO,MAAM;IAE5B,IAAI,SAAS,SAAS,GACpB,SAAS,SAAS;IAEpB,IAAI;IACJ,IAAK,IAAI,GAAG,IAAI,QAAQ,EAAE,EAAG;QAC3B,MAAM,SAAS,SAAS,OAAO,MAAM,CAAC,IAAI,GAAG,IAAI;QACjD,IAAI,YAAY,SAAS,OAAO;QAChC,GAAG,CAAC,SAAS,EAAE,GAAG;IACpB;IACA,OAAO;AACT;AAEA,SAAS,UAAW,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM;IAC7C,OAAO,WAAW,YAAY,QAAQ,IAAI,MAAM,GAAG,SAAS,KAAK,QAAQ;AAC3E;AAEA,SAAS,WAAY,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM;IAC9C,OAAO,WAAW,aAAa,SAAS,KAAK,QAAQ;AACvD;AAEA,SAAS,YAAa,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM;IAC/C,OAAO,WAAW,cAAc,SAAS,KAAK,QAAQ;AACxD;AAEA,SAAS,UAAW,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM;IAC7C,OAAO,WAAW,eAAe,QAAQ,IAAI,MAAM,GAAG,SAAS,KAAK,QAAQ;AAC9E;AAEA,OAAO,SAAS,CAAC,KAAK,GAAG,SAAS,MAAO,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ;IACvE,uBAAuB;IACvB,IAAI,WAAW,WAAW;QACxB,WAAW;QACX,SAAS,IAAI,CAAC,MAAM;QACpB,SAAS;IACX,iCAAiC;IACjC,OAAO,IAAI,WAAW,aAAa,OAAO,WAAW,UAAU;QAC7D,WAAW;QACX,SAAS,IAAI,CAAC,MAAM;QACpB,SAAS;IACX,qDAAqD;IACrD,OAAO,IAAI,SAAS,SAAS;QAC3B,SAAS,WAAW;QACpB,IAAI,SAAS,SAAS;YACpB,SAAS,WAAW;YACpB,IAAI,aAAa,WAAW,WAAW;QACzC,OAAO;YACL,WAAW;YACX,SAAS;QACX;IACF,OACE,MAAM,IAAI,MACR;IAIJ,MAAM,YAAY,IAAI,CAAC,MAAM,GAAG;IAChC,IAAI,WAAW,aAAa,SAAS,WAAW,SAAS;IAEzD,IAAI,AAAC,OAAO,MAAM,GAAG,KAAM,CAAA,SAAS,KAAK,SAAS,CAAA,KAAO,SAAS,IAAI,CAAC,MAAM,EAC3E,MAAM,IAAI,WAAW;IAGvB,IAAI,CAAC,UAAU,WAAW;IAE1B,IAAI,cAAc;IAClB,OACE,OAAQ;QACN,KAAK;YACH,OAAO,SAAS,IAAI,EAAE,QAAQ,QAAQ;QAExC,KAAK;QACL,KAAK;YACH,OAAO,UAAU,IAAI,EAAE,QAAQ,QAAQ;QAEzC,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO,WAAW,IAAI,EAAE,QAAQ,QAAQ;QAE1C,KAAK;YACH,2DAA2D;YAC3D,OAAO,YAAY,IAAI,EAAE,QAAQ,QAAQ;QAE3C,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO,UAAU,IAAI,EAAE,QAAQ,QAAQ;QAEzC;YACE,IAAI,aAAa,MAAM,IAAI,UAAU,uBAAuB;YAC5D,WAAW,AAAC,CAAA,KAAK,QAAO,EAAG,WAAW;YACtC,cAAc;IAClB;AAEJ;AAEA,OAAO,SAAS,CAAC,MAAM,GAAG,SAAS;IACjC,OAAO;QACL,MAAM;QACN,MAAM,MAAM,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,EAAE;IACtD;AACF;AAEA,SAAS,YAAa,GAAG,EAAE,KAAK,EAAE,GAAG;IACnC,IAAI,UAAU,KAAK,QAAQ,IAAI,MAAM,EACnC,OAAO,OAAO,aAAa,CAAC;SAE5B,OAAO,OAAO,aAAa,CAAC,IAAI,KAAK,CAAC,OAAO;AAEjD;AAEA,SAAS,UAAW,GAAG,EAAE,KAAK,EAAE,GAAG;IACjC,MAAM,KAAK,GAAG,CAAC,IAAI,MAAM,EAAE;IAC3B,MAAM,MAAM,EAAE;IAEd,IAAI,IAAI;IACR,MAAO,IAAI,IAAK;QACd,MAAM,YAAY,GAAG,CAAC,EAAE;QACxB,IAAI,YAAY;QAChB,IAAI,mBAAmB,AAAC,YAAY,OAChC,IACA,AAAC,YAAY,OACT,IACA,AAAC,YAAY,OACT,IACA;QAEZ,IAAI,IAAI,oBAAoB,KAAK;YAC/B,IAAI,YAAY,WAAW,YAAY;YAEvC,OAAQ;gBACN,KAAK;oBACH,IAAI,YAAY,MACd,YAAY;oBAEd;gBACF,KAAK;oBACH,aAAa,GAAG,CAAC,IAAI,EAAE;oBACvB,IAAI,AAAC,CAAA,aAAa,IAAG,MAAO,MAAM;wBAChC,gBAAgB,AAAC,CAAA,YAAY,IAAG,KAAM,MAAO,aAAa;wBAC1D,IAAI,gBAAgB,MAClB,YAAY;oBAEhB;oBACA;gBACF,KAAK;oBACH,aAAa,GAAG,CAAC,IAAI,EAAE;oBACvB,YAAY,GAAG,CAAC,IAAI,EAAE;oBACtB,IAAI,AAAC,CAAA,aAAa,IAAG,MAAO,QAAQ,AAAC,CAAA,YAAY,IAAG,MAAO,MAAM;wBAC/D,gBAAgB,AAAC,CAAA,YAAY,GAAE,KAAM,MAAM,AAAC,CAAA,aAAa,IAAG,KAAM,MAAO,YAAY;wBACrF,IAAI,gBAAgB,SAAU,CAAA,gBAAgB,UAAU,gBAAgB,MAAK,GAC3E,YAAY;oBAEhB;oBACA;gBACF,KAAK;oBACH,aAAa,GAAG,CAAC,IAAI,EAAE;oBACvB,YAAY,GAAG,CAAC,IAAI,EAAE;oBACtB,aAAa,GAAG,CAAC,IAAI,EAAE;oBACvB,IAAI,AAAC,CAAA,aAAa,IAAG,MAAO,QAAQ,AAAC,CAAA,YAAY,IAAG,MAAO,QAAQ,AAAC,CAAA,aAAa,IAAG,MAAO,MAAM;wBAC/F,gBAAgB,AAAC,CAAA,YAAY,GAAE,KAAM,OAAO,AAAC,CAAA,aAAa,IAAG,KAAM,MAAM,AAAC,CAAA,YAAY,IAAG,KAAM,MAAO,aAAa;wBACnH,IAAI,gBAAgB,UAAU,gBAAgB,UAC5C,YAAY;oBAEhB;YACJ;QACF;QAEA,IAAI,cAAc,MAAM;YACtB,oDAAoD;YACpD,oDAAoD;YACpD,YAAY;YACZ,mBAAmB;QACrB,OAAO,IAAI,YAAY,QAAQ;YAC7B,yCAAyC;YACzC,aAAa;YACb,IAAI,IAAI,CAAC,cAAc,KAAK,QAAQ;YACpC,YAAY,SAAS,YAAY;QACnC;QAEA,IAAI,IAAI,CAAC;QACT,KAAK;IACP;IAEA,OAAO,sBAAsB;AAC/B;AAEA,wEAAwE;AACxE,iDAAiD;AACjD,qCAAqC;AACrC,MAAM,uBAAuB;AAE7B,SAAS,sBAAuB,UAAU;IACxC,MAAM,MAAM,WAAW,MAAM;IAC7B,IAAI,OAAO,sBACT,OAAO,OAAO,YAAY,CAAC,KAAK,CAAC,QAAQ,YAAY,sBAAsB;;IAG7E,wDAAwD;IACxD,IAAI,MAAM;IACV,IAAI,IAAI;IACR,MAAO,IAAI,IACT,OAAO,OAAO,YAAY,CAAC,KAAK,CAC9B,QACA,WAAW,KAAK,CAAC,GAAG,KAAK;IAG7B,OAAO;AACT;AAEA,SAAS,WAAY,GAAG,EAAE,KAAK,EAAE,GAAG;IAClC,IAAI,MAAM;IACV,MAAM,KAAK,GAAG,CAAC,IAAI,MAAM,EAAE;IAE3B,IAAK,IAAI,IAAI,OAAO,IAAI,KAAK,EAAE,EAC7B,OAAO,OAAO,YAAY,CAAC,GAAG,CAAC,EAAE,GAAG;IAEtC,OAAO;AACT;AAEA,SAAS,YAAa,GAAG,EAAE,KAAK,EAAE,GAAG;IACnC,IAAI,MAAM;IACV,MAAM,KAAK,GAAG,CAAC,IAAI,MAAM,EAAE;IAE3B,IAAK,IAAI,IAAI,OAAO,IAAI,KAAK,EAAE,EAC7B,OAAO,OAAO,YAAY,CAAC,GAAG,CAAC,EAAE;IAEnC,OAAO;AACT;AAEA,SAAS,SAAU,GAAG,EAAE,KAAK,EAAE,GAAG;IAChC,MAAM,MAAM,IAAI,MAAM;IAEtB,IAAI,CAAC,SAAS,QAAQ,GAAG,QAAQ;IACjC,IAAI,CAAC,OAAO,MAAM,KAAK,MAAM,KAAK,MAAM;IAExC,IAAI,MAAM;IACV,IAAK,IAAI,IAAI,OAAO,IAAI,KAAK,EAAE,EAC7B,OAAO,mBAAmB,CAAC,GAAG,CAAC,EAAE,CAAC;IAEpC,OAAO;AACT;AAEA,SAAS,aAAc,GAAG,EAAE,KAAK,EAAE,GAAG;IACpC,MAAM,QAAQ,IAAI,KAAK,CAAC,OAAO;IAC/B,IAAI,MAAM;IACV,4EAA4E;IAC5E,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,GAAG,GAAG,KAAK,EACzC,OAAO,OAAO,YAAY,CAAC,KAAK,CAAC,EAAE,GAAI,KAAK,CAAC,IAAI,EAAE,GAAG;IAExD,OAAO;AACT;AAEA,OAAO,SAAS,CAAC,KAAK,GAAG,SAAS,MAAO,KAAK,EAAE,GAAG;IACjD,MAAM,MAAM,IAAI,CAAC,MAAM;IACvB,QAAQ,CAAC,CAAC;IACV,MAAM,QAAQ,YAAY,MAAM,CAAC,CAAC;IAElC,IAAI,QAAQ,GAAG;QACb,SAAS;QACT,IAAI,QAAQ,GAAG,QAAQ;IACzB,OAAO,IAAI,QAAQ,KACjB,QAAQ;IAGV,IAAI,MAAM,GAAG;QACX,OAAO;QACP,IAAI,MAAM,GAAG,MAAM;IACrB,OAAO,IAAI,MAAM,KACf,MAAM;IAGR,IAAI,MAAM,OAAO,MAAM;IAEvB,MAAM,SAAS,IAAI,CAAC,QAAQ,CAAC,OAAO;IACpC,4CAA4C;IAC5C,OAAO,cAAc,CAAC,QAAQ,OAAO,SAAS;IAE9C,OAAO;AACT;AAEA;;CAEC,GACD,SAAS,YAAa,MAAM,EAAE,GAAG,EAAE,MAAM;IACvC,IAAI,AAAC,SAAS,MAAO,KAAK,SAAS,GAAG,MAAM,IAAI,WAAW;IAC3D,IAAI,SAAS,MAAM,QAAQ,MAAM,IAAI,WAAW;AAClD;AAEA,OAAO,SAAS,CAAC,UAAU,GAC3B,OAAO,SAAS,CAAC,UAAU,GAAG,SAAS,WAAY,MAAM,EAAE,UAAU,EAAE,QAAQ;IAC7E,SAAS,WAAW;IACpB,aAAa,eAAe;IAC5B,IAAI,CAAC,UAAU,YAAY,QAAQ,YAAY,IAAI,CAAC,MAAM;IAE1D,IAAI,MAAM,IAAI,CAAC,OAAO;IACtB,IAAI,MAAM;IACV,IAAI,IAAI;IACR,MAAO,EAAE,IAAI,cAAe,CAAA,OAAO,KAAI,EACrC,OAAO,IAAI,CAAC,SAAS,EAAE,GAAG;IAG5B,OAAO;AACT;AAEA,OAAO,SAAS,CAAC,UAAU,GAC3B,OAAO,SAAS,CAAC,UAAU,GAAG,SAAS,WAAY,MAAM,EAAE,UAAU,EAAE,QAAQ;IAC7E,SAAS,WAAW;IACpB,aAAa,eAAe;IAC5B,IAAI,CAAC,UACH,YAAY,QAAQ,YAAY,IAAI,CAAC,MAAM;IAG7C,IAAI,MAAM,IAAI,CAAC,SAAS,EAAE,WAAW;IACrC,IAAI,MAAM;IACV,MAAO,aAAa,KAAM,CAAA,OAAO,KAAI,EACnC,OAAO,IAAI,CAAC,SAAS,EAAE,WAAW,GAAG;IAGvC,OAAO;AACT;AAEA,OAAO,SAAS,CAAC,SAAS,GAC1B,OAAO,SAAS,CAAC,SAAS,GAAG,SAAS,UAAW,MAAM,EAAE,QAAQ;IAC/D,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,OAAO,IAAI,CAAC,OAAO;AACrB;AAEA,OAAO,SAAS,CAAC,YAAY,GAC7B,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,MAAM,EAAE,QAAQ;IACrE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,OAAO,IAAI,CAAC,OAAO,GAAI,IAAI,CAAC,SAAS,EAAE,IAAI;AAC7C;AAEA,OAAO,SAAS,CAAC,YAAY,GAC7B,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,MAAM,EAAE,QAAQ;IACrE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,OAAO,AAAC,IAAI,CAAC,OAAO,IAAI,IAAK,IAAI,CAAC,SAAS,EAAE;AAC/C;AAEA,OAAO,SAAS,CAAC,YAAY,GAC7B,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,MAAM,EAAE,QAAQ;IACrE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IAEjD,OAAO,AAAC,CAAA,AAAC,IAAI,CAAC,OAAO,GAChB,IAAI,CAAC,SAAS,EAAE,IAAI,IACpB,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE,IACtB,IAAI,CAAC,SAAS,EAAE,GAAG;AAC1B;AAEA,OAAO,SAAS,CAAC,YAAY,GAC7B,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,MAAM,EAAE,QAAQ;IACrE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IAEjD,OAAO,AAAC,IAAI,CAAC,OAAO,GAAG,YACpB,CAAA,AAAC,IAAI,CAAC,SAAS,EAAE,IAAI,KACrB,IAAI,CAAC,SAAS,EAAE,IAAI,IACrB,IAAI,CAAC,SAAS,EAAE,AAAD;AACnB;AAEA,OAAO,SAAS,CAAC,eAAe,GAAG,mBAAmB,SAAS,gBAAiB,MAAM;IACpF,SAAS,WAAW;IACpB,eAAe,QAAQ;IACvB,MAAM,QAAQ,IAAI,CAAC,OAAO;IAC1B,MAAM,OAAO,IAAI,CAAC,SAAS,EAAE;IAC7B,IAAI,UAAU,aAAa,SAAS,WAClC,YAAY,QAAQ,IAAI,CAAC,MAAM,GAAG;IAGpC,MAAM,KAAK,QACT,IAAI,CAAC,EAAE,OAAO,GAAG,MACjB,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KACtB,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK;IAExB,MAAM,KAAK,IAAI,CAAC,EAAE,OAAO,GACvB,IAAI,CAAC,EAAE,OAAO,GAAG,MACjB,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KACtB,OAAO,KAAK;IAEd,OAAO,OAAO,MAAO,CAAA,OAAO,OAAO,OAAO,GAAE;AAC9C;AAEA,OAAO,SAAS,CAAC,eAAe,GAAG,mBAAmB,SAAS,gBAAiB,MAAM;IACpF,SAAS,WAAW;IACpB,eAAe,QAAQ;IACvB,MAAM,QAAQ,IAAI,CAAC,OAAO;IAC1B,MAAM,OAAO,IAAI,CAAC,SAAS,EAAE;IAC7B,IAAI,UAAU,aAAa,SAAS,WAClC,YAAY,QAAQ,IAAI,CAAC,MAAM,GAAG;IAGpC,MAAM,KAAK,QAAQ,KAAK,KACtB,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KACtB,IAAI,CAAC,EAAE,OAAO,GAAG,MACjB,IAAI,CAAC,EAAE,OAAO;IAEhB,MAAM,KAAK,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KAC/B,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KACtB,IAAI,CAAC,EAAE,OAAO,GAAG,MACjB;IAEF,OAAO,AAAC,CAAA,OAAO,OAAO,OAAO,GAAE,IAAK,OAAO;AAC7C;AAEA,OAAO,SAAS,CAAC,SAAS,GAAG,SAAS,UAAW,MAAM,EAAE,UAAU,EAAE,QAAQ;IAC3E,SAAS,WAAW;IACpB,aAAa,eAAe;IAC5B,IAAI,CAAC,UAAU,YAAY,QAAQ,YAAY,IAAI,CAAC,MAAM;IAE1D,IAAI,MAAM,IAAI,CAAC,OAAO;IACtB,IAAI,MAAM;IACV,IAAI,IAAI;IACR,MAAO,EAAE,IAAI,cAAe,CAAA,OAAO,KAAI,EACrC,OAAO,IAAI,CAAC,SAAS,EAAE,GAAG;IAE5B,OAAO;IAEP,IAAI,OAAO,KAAK,OAAO,KAAK,GAAG,CAAC,GAAG,IAAI;IAEvC,OAAO;AACT;AAEA,OAAO,SAAS,CAAC,SAAS,GAAG,SAAS,UAAW,MAAM,EAAE,UAAU,EAAE,QAAQ;IAC3E,SAAS,WAAW;IACpB,aAAa,eAAe;IAC5B,IAAI,CAAC,UAAU,YAAY,QAAQ,YAAY,IAAI,CAAC,MAAM;IAE1D,IAAI,IAAI;IACR,IAAI,MAAM;IACV,IAAI,MAAM,IAAI,CAAC,SAAS,EAAE,EAAE;IAC5B,MAAO,IAAI,KAAM,CAAA,OAAO,KAAI,EAC1B,OAAO,IAAI,CAAC,SAAS,EAAE,EAAE,GAAG;IAE9B,OAAO;IAEP,IAAI,OAAO,KAAK,OAAO,KAAK,GAAG,CAAC,GAAG,IAAI;IAEvC,OAAO;AACT;AAEA,OAAO,SAAS,CAAC,QAAQ,GAAG,SAAS,SAAU,MAAM,EAAE,QAAQ;IAC7D,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,IAAI,CAAE,CAAA,IAAI,CAAC,OAAO,GAAG,IAAG,GAAI,OAAQ,IAAI,CAAC,OAAO;IAChD,OAAQ,AAAC,CAAA,OAAO,IAAI,CAAC,OAAO,GAAG,CAAA,IAAK;AACtC;AAEA,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,MAAM,EAAE,QAAQ;IACnE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,MAAM,MAAM,IAAI,CAAC,OAAO,GAAI,IAAI,CAAC,SAAS,EAAE,IAAI;IAChD,OAAO,AAAC,MAAM,SAAU,MAAM,aAAa;AAC7C;AAEA,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,MAAM,EAAE,QAAQ;IACnE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,MAAM,MAAM,IAAI,CAAC,SAAS,EAAE,GAAI,IAAI,CAAC,OAAO,IAAI;IAChD,OAAO,AAAC,MAAM,SAAU,MAAM,aAAa;AAC7C;AAEA,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,MAAM,EAAE,QAAQ;IACnE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IAEjD,OAAO,AAAC,IAAI,CAAC,OAAO,GACjB,IAAI,CAAC,SAAS,EAAE,IAAI,IACpB,IAAI,CAAC,SAAS,EAAE,IAAI,KACpB,IAAI,CAAC,SAAS,EAAE,IAAI;AACzB;AAEA,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,MAAM,EAAE,QAAQ;IACnE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IAEjD,OAAO,AAAC,IAAI,CAAC,OAAO,IAAI,KACrB,IAAI,CAAC,SAAS,EAAE,IAAI,KACpB,IAAI,CAAC,SAAS,EAAE,IAAI,IACpB,IAAI,CAAC,SAAS,EAAE;AACrB;AAEA,OAAO,SAAS,CAAC,cAAc,GAAG,mBAAmB,SAAS,eAAgB,MAAM;IAClF,SAAS,WAAW;IACpB,eAAe,QAAQ;IACvB,MAAM,QAAQ,IAAI,CAAC,OAAO;IAC1B,MAAM,OAAO,IAAI,CAAC,SAAS,EAAE;IAC7B,IAAI,UAAU,aAAa,SAAS,WAClC,YAAY,QAAQ,IAAI,CAAC,MAAM,GAAG;IAGpC,MAAM,MAAM,IAAI,CAAC,SAAS,EAAE,GAC1B,IAAI,CAAC,SAAS,EAAE,GAAG,MACnB,IAAI,CAAC,SAAS,EAAE,GAAG,KAAK,KACvB,CAAA,QAAQ,GAAI,WAAW;IAAd;IAEZ,OAAO,AAAC,CAAA,OAAO,QAAQ,OAAO,GAAE,IAC9B,OAAO,QACP,IAAI,CAAC,EAAE,OAAO,GAAG,MACjB,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KACtB,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK;AAC1B;AAEA,OAAO,SAAS,CAAC,cAAc,GAAG,mBAAmB,SAAS,eAAgB,MAAM;IAClF,SAAS,WAAW;IACpB,eAAe,QAAQ;IACvB,MAAM,QAAQ,IAAI,CAAC,OAAO;IAC1B,MAAM,OAAO,IAAI,CAAC,SAAS,EAAE;IAC7B,IAAI,UAAU,aAAa,SAAS,WAClC,YAAY,QAAQ,IAAI,CAAC,MAAM,GAAG;IAGpC,MAAM,MAAM,AAAC,CAAA,SAAS,EAAC,IAAK,WAAW;IACrC,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KACtB,IAAI,CAAC,EAAE,OAAO,GAAG,MACjB,IAAI,CAAC,EAAE,OAAO;IAEhB,OAAO,AAAC,CAAA,OAAO,QAAQ,OAAO,GAAE,IAC9B,OAAO,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KAC7B,IAAI,CAAC,EAAE,OAAO,GAAG,KAAK,KACtB,IAAI,CAAC,EAAE,OAAO,GAAG,MACjB;AACJ;AAEA,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,MAAM,EAAE,QAAQ;IACnE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,OAAO,QAAQ,IAAI,CAAC,IAAI,EAAE,QAAQ,MAAM,IAAI;AAC9C;AAEA,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,MAAM,EAAE,QAAQ;IACnE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,OAAO,QAAQ,IAAI,CAAC,IAAI,EAAE,QAAQ,OAAO,IAAI;AAC/C;AAEA,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,MAAM,EAAE,QAAQ;IACrE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,OAAO,QAAQ,IAAI,CAAC,IAAI,EAAE,QAAQ,MAAM,IAAI;AAC9C;AAEA,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,MAAM,EAAE,QAAQ;IACrE,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,YAAY,QAAQ,GAAG,IAAI,CAAC,MAAM;IACjD,OAAO,QAAQ,IAAI,CAAC,IAAI,EAAE,QAAQ,OAAO,IAAI;AAC/C;AAEA,SAAS,SAAU,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG;IAClD,IAAI,CAAC,OAAO,QAAQ,CAAC,MAAM,MAAM,IAAI,UAAU;IAC/C,IAAI,QAAQ,OAAO,QAAQ,KAAK,MAAM,IAAI,WAAW;IACrD,IAAI,SAAS,MAAM,IAAI,MAAM,EAAE,MAAM,IAAI,WAAW;AACtD;AAEA,OAAO,SAAS,CAAC,WAAW,GAC5B,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,KAAK,EAAE,MAAM,EAAE,UAAU,EAAE,QAAQ;IACtF,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,aAAa,eAAe;IAC5B,IAAI,CAAC,UAAU;QACb,MAAM,WAAW,KAAK,GAAG,CAAC,GAAG,IAAI,cAAc;QAC/C,SAAS,IAAI,EAAE,OAAO,QAAQ,YAAY,UAAU;IACtD;IAEA,IAAI,MAAM;IACV,IAAI,IAAI;IACR,IAAI,CAAC,OAAO,GAAG,QAAQ;IACvB,MAAO,EAAE,IAAI,cAAe,CAAA,OAAO,KAAI,EACrC,IAAI,CAAC,SAAS,EAAE,GAAG,AAAC,QAAQ,MAAO;IAGrC,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,WAAW,GAC5B,OAAO,SAAS,CAAC,WAAW,GAAG,SAAS,YAAa,KAAK,EAAE,MAAM,EAAE,UAAU,EAAE,QAAQ;IACtF,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,aAAa,eAAe;IAC5B,IAAI,CAAC,UAAU;QACb,MAAM,WAAW,KAAK,GAAG,CAAC,GAAG,IAAI,cAAc;QAC/C,SAAS,IAAI,EAAE,OAAO,QAAQ,YAAY,UAAU;IACtD;IAEA,IAAI,IAAI,aAAa;IACrB,IAAI,MAAM;IACV,IAAI,CAAC,SAAS,EAAE,GAAG,QAAQ;IAC3B,MAAO,EAAE,KAAK,KAAM,CAAA,OAAO,KAAI,EAC7B,IAAI,CAAC,SAAS,EAAE,GAAG,AAAC,QAAQ,MAAO;IAGrC,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,UAAU,GAC3B,OAAO,SAAS,CAAC,UAAU,GAAG,SAAS,WAAY,KAAK,EAAE,MAAM,EAAE,QAAQ;IACxE,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,MAAM;IACtD,IAAI,CAAC,OAAO,GAAI,QAAQ;IACxB,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,aAAa,GAC9B,OAAO,SAAS,CAAC,aAAa,GAAG,SAAS,cAAe,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC9E,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,QAAQ;IACxD,IAAI,CAAC,OAAO,GAAI,QAAQ;IACxB,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,aAAa,GAC9B,OAAO,SAAS,CAAC,aAAa,GAAG,SAAS,cAAe,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC9E,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,QAAQ;IACxD,IAAI,CAAC,OAAO,GAAI,UAAU;IAC1B,IAAI,CAAC,SAAS,EAAE,GAAI,QAAQ;IAC5B,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,aAAa,GAC9B,OAAO,SAAS,CAAC,aAAa,GAAG,SAAS,cAAe,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC9E,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,YAAY;IAC5D,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,OAAO,GAAI,QAAQ;IACxB,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,aAAa,GAC9B,OAAO,SAAS,CAAC,aAAa,GAAG,SAAS,cAAe,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC9E,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,YAAY;IAC5D,IAAI,CAAC,OAAO,GAAI,UAAU;IAC1B,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,SAAS,EAAE,GAAI,QAAQ;IAC5B,OAAO,SAAS;AAClB;AAEA,SAAS,eAAgB,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG;IACnD,WAAW,OAAO,KAAK,KAAK,KAAK,QAAQ;IAEzC,IAAI,KAAK,OAAO,QAAQ,OAAO;IAC/B,GAAG,CAAC,SAAS,GAAG;IAChB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,GAAG;IAChB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,GAAG;IAChB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,GAAG;IAChB,IAAI,KAAK,OAAO,SAAS,OAAO,MAAM,OAAO;IAC7C,GAAG,CAAC,SAAS,GAAG;IAChB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,GAAG;IAChB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,GAAG;IAChB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,GAAG;IAChB,OAAO;AACT;AAEA,SAAS,eAAgB,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG;IACnD,WAAW,OAAO,KAAK,KAAK,KAAK,QAAQ;IAEzC,IAAI,KAAK,OAAO,QAAQ,OAAO;IAC/B,GAAG,CAAC,SAAS,EAAE,GAAG;IAClB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,EAAE,GAAG;IAClB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,EAAE,GAAG;IAClB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,EAAE,GAAG;IAClB,IAAI,KAAK,OAAO,SAAS,OAAO,MAAM,OAAO;IAC7C,GAAG,CAAC,SAAS,EAAE,GAAG;IAClB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,EAAE,GAAG;IAClB,KAAK,MAAM;IACX,GAAG,CAAC,SAAS,EAAE,GAAG;IAClB,KAAK,MAAM;IACX,GAAG,CAAC,OAAO,GAAG;IACd,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,gBAAgB,GAAG,mBAAmB,SAAS,iBAAkB,KAAK,EAAE,SAAS,CAAC;IACjG,OAAO,eAAe,IAAI,EAAE,OAAO,QAAQ,OAAO,IAAI,OAAO;AAC/D;AAEA,OAAO,SAAS,CAAC,gBAAgB,GAAG,mBAAmB,SAAS,iBAAkB,KAAK,EAAE,SAAS,CAAC;IACjG,OAAO,eAAe,IAAI,EAAE,OAAO,QAAQ,OAAO,IAAI,OAAO;AAC/D;AAEA,OAAO,SAAS,CAAC,UAAU,GAAG,SAAS,WAAY,KAAK,EAAE,MAAM,EAAE,UAAU,EAAE,QAAQ;IACpF,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU;QACb,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG,AAAC,IAAI,aAAc;QAE7C,SAAS,IAAI,EAAE,OAAO,QAAQ,YAAY,QAAQ,GAAG,CAAC;IACxD;IAEA,IAAI,IAAI;IACR,IAAI,MAAM;IACV,IAAI,MAAM;IACV,IAAI,CAAC,OAAO,GAAG,QAAQ;IACvB,MAAO,EAAE,IAAI,cAAe,CAAA,OAAO,KAAI,EAAI;QACzC,IAAI,QAAQ,KAAK,QAAQ,KAAK,IAAI,CAAC,SAAS,IAAI,EAAE,KAAK,GACrD,MAAM;QAER,IAAI,CAAC,SAAS,EAAE,GAAG,AAAC,CAAA,AAAC,QAAQ,OAAQ,CAAA,IAAK,MAAM;IAClD;IAEA,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,UAAU,GAAG,SAAS,WAAY,KAAK,EAAE,MAAM,EAAE,UAAU,EAAE,QAAQ;IACpF,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU;QACb,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG,AAAC,IAAI,aAAc;QAE7C,SAAS,IAAI,EAAE,OAAO,QAAQ,YAAY,QAAQ,GAAG,CAAC;IACxD;IAEA,IAAI,IAAI,aAAa;IACrB,IAAI,MAAM;IACV,IAAI,MAAM;IACV,IAAI,CAAC,SAAS,EAAE,GAAG,QAAQ;IAC3B,MAAO,EAAE,KAAK,KAAM,CAAA,OAAO,KAAI,EAAI;QACjC,IAAI,QAAQ,KAAK,QAAQ,KAAK,IAAI,CAAC,SAAS,IAAI,EAAE,KAAK,GACrD,MAAM;QAER,IAAI,CAAC,SAAS,EAAE,GAAG,AAAC,CAAA,AAAC,QAAQ,OAAQ,CAAA,IAAK,MAAM;IAClD;IAEA,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,SAAS,GAAG,SAAS,UAAW,KAAK,EAAE,MAAM,EAAE,QAAQ;IACtE,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,MAAM;IACtD,IAAI,QAAQ,GAAG,QAAQ,OAAO,QAAQ;IACtC,IAAI,CAAC,OAAO,GAAI,QAAQ;IACxB,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC5E,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,QAAQ;IACxD,IAAI,CAAC,OAAO,GAAI,QAAQ;IACxB,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC5E,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,QAAQ;IACxD,IAAI,CAAC,OAAO,GAAI,UAAU;IAC1B,IAAI,CAAC,SAAS,EAAE,GAAI,QAAQ;IAC5B,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC5E,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,YAAY;IAC5D,IAAI,CAAC,OAAO,GAAI,QAAQ;IACxB,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC5E,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UAAU,SAAS,IAAI,EAAE,OAAO,QAAQ,GAAG,YAAY;IAC5D,IAAI,QAAQ,GAAG,QAAQ,aAAa,QAAQ;IAC5C,IAAI,CAAC,OAAO,GAAI,UAAU;IAC1B,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,SAAS,EAAE,GAAI,UAAU;IAC9B,IAAI,CAAC,SAAS,EAAE,GAAI,QAAQ;IAC5B,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,eAAe,GAAG,mBAAmB,SAAS,gBAAiB,KAAK,EAAE,SAAS,CAAC;IAC/F,OAAO,eAAe,IAAI,EAAE,OAAO,QAAQ,CAAC,OAAO,uBAAuB,OAAO;AACnF;AAEA,OAAO,SAAS,CAAC,eAAe,GAAG,mBAAmB,SAAS,gBAAiB,KAAK,EAAE,SAAS,CAAC;IAC/F,OAAO,eAAe,IAAI,EAAE,OAAO,QAAQ,CAAC,OAAO,uBAAuB,OAAO;AACnF;AAEA,SAAS,aAAc,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG;IACtD,IAAI,SAAS,MAAM,IAAI,MAAM,EAAE,MAAM,IAAI,WAAW;IACpD,IAAI,SAAS,GAAG,MAAM,IAAI,WAAW;AACvC;AAEA,SAAS,WAAY,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,YAAY,EAAE,QAAQ;IAC7D,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UACH,aAAa,KAAK,OAAO,QAAQ,GAAG,wBAAwB;IAE9D,QAAQ,KAAK,CAAC,KAAK,OAAO,QAAQ,cAAc,IAAI;IACpD,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC5E,OAAO,WAAW,IAAI,EAAE,OAAO,QAAQ,MAAM;AAC/C;AAEA,OAAO,SAAS,CAAC,YAAY,GAAG,SAAS,aAAc,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC5E,OAAO,WAAW,IAAI,EAAE,OAAO,QAAQ,OAAO;AAChD;AAEA,SAAS,YAAa,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,YAAY,EAAE,QAAQ;IAC9D,QAAQ,CAAC;IACT,SAAS,WAAW;IACpB,IAAI,CAAC,UACH,aAAa,KAAK,OAAO,QAAQ,GAAG,yBAAyB;IAE/D,QAAQ,KAAK,CAAC,KAAK,OAAO,QAAQ,cAAc,IAAI;IACpD,OAAO,SAAS;AAClB;AAEA,OAAO,SAAS,CAAC,aAAa,GAAG,SAAS,cAAe,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC9E,OAAO,YAAY,IAAI,EAAE,OAAO,QAAQ,MAAM;AAChD;AAEA,OAAO,SAAS,CAAC,aAAa,GAAG,SAAS,cAAe,KAAK,EAAE,MAAM,EAAE,QAAQ;IAC9E,OAAO,YAAY,IAAI,EAAE,OAAO,QAAQ,OAAO;AACjD;AAEA,4EAA4E;AAC5E,OAAO,SAAS,CAAC,IAAI,GAAG,SAAS,KAAM,MAAM,EAAE,WAAW,EAAE,KAAK,EAAE,GAAG;IACpE,IAAI,CAAC,OAAO,QAAQ,CAAC,SAAS,MAAM,IAAI,UAAU;IAClD,IAAI,CAAC,OAAO,QAAQ;IACpB,IAAI,CAAC,OAAO,QAAQ,GAAG,MAAM,IAAI,CAAC,MAAM;IACxC,IAAI,eAAe,OAAO,MAAM,EAAE,cAAc,OAAO,MAAM;IAC7D,IAAI,CAAC,aAAa,cAAc;IAChC,IAAI,MAAM,KAAK,MAAM,OAAO,MAAM;IAElC,2BAA2B;IAC3B,IAAI,QAAQ,OAAO,OAAO;IAC1B,IAAI,OAAO,MAAM,KAAK,KAAK,IAAI,CAAC,MAAM,KAAK,GAAG,OAAO;IAErD,yBAAyB;IACzB,IAAI,cAAc,GAChB,MAAM,IAAI,WAAW;IAEvB,IAAI,QAAQ,KAAK,SAAS,IAAI,CAAC,MAAM,EAAE,MAAM,IAAI,WAAW;IAC5D,IAAI,MAAM,GAAG,MAAM,IAAI,WAAW;IAElC,cAAc;IACd,IAAI,MAAM,IAAI,CAAC,MAAM,EAAE,MAAM,IAAI,CAAC,MAAM;IACxC,IAAI,OAAO,MAAM,GAAG,cAAc,MAAM,OACtC,MAAM,OAAO,MAAM,GAAG,cAAc;IAGtC,MAAM,MAAM,MAAM;IAElB,IAAI,IAAI,KAAK,UAAU,OAAO,WAAW,SAAS,CAAC,UAAU,KAAK,YAChE,iDAAiD;IACjD,IAAI,CAAC,UAAU,CAAC,aAAa,OAAO;SAEpC,WAAW,SAAS,CAAC,GAAG,CAAC,IAAI,CAC3B,QACA,IAAI,CAAC,QAAQ,CAAC,OAAO,MACrB;IAIJ,OAAO;AACT;AAEA,SAAS;AACT,0CAA0C;AAC1C,0CAA0C;AAC1C,sDAAsD;AACtD,OAAO,SAAS,CAAC,IAAI,GAAG,SAAS,KAAM,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,QAAQ;IAC9D,uBAAuB;IACvB,IAAI,OAAO,QAAQ,UAAU;QAC3B,IAAI,OAAO,UAAU,UAAU;YAC7B,WAAW;YACX,QAAQ;YACR,MAAM,IAAI,CAAC,MAAM;QACnB,OAAO,IAAI,OAAO,QAAQ,UAAU;YAClC,WAAW;YACX,MAAM,IAAI,CAAC,MAAM;QACnB;QACA,IAAI,aAAa,aAAa,OAAO,aAAa,UAChD,MAAM,IAAI,UAAU;QAEtB,IAAI,OAAO,aAAa,YAAY,CAAC,OAAO,UAAU,CAAC,WACrD,MAAM,IAAI,UAAU,uBAAuB;QAE7C,IAAI,IAAI,MAAM,KAAK,GAAG;YACpB,MAAM,OAAO,IAAI,UAAU,CAAC;YAC5B,IAAI,AAAC,aAAa,UAAU,OAAO,OAC/B,aAAa,UACf,uEAAuE;YACvE,MAAM;QAEV;IACF,OAAO,IAAI,OAAO,QAAQ,UACxB,MAAM,MAAM;SACP,IAAI,OAAO,QAAQ,WACxB,MAAM,OAAO;IAGf,qEAAqE;IACrE,IAAI,QAAQ,KAAK,IAAI,CAAC,MAAM,GAAG,SAAS,IAAI,CAAC,MAAM,GAAG,KACpD,MAAM,IAAI,WAAW;IAGvB,IAAI,OAAO,OACT,OAAO,IAAI;IAGb,QAAQ,UAAU;IAClB,MAAM,QAAQ,YAAY,IAAI,CAAC,MAAM,GAAG,QAAQ;IAEhD,IAAI,CAAC,KAAK,MAAM;IAEhB,IAAI;IACJ,IAAI,OAAO,QAAQ,UACjB,IAAK,IAAI,OAAO,IAAI,KAAK,EAAE,EACzB,IAAI,CAAC,EAAE,GAAG;SAEP;QACL,MAAM,QAAQ,OAAO,QAAQ,CAAC,OAC1B,MACA,OAAO,IAAI,CAAC,KAAK;QACrB,MAAM,MAAM,MAAM,MAAM;QACxB,IAAI,QAAQ,GACV,MAAM,IAAI,UAAU,gBAAgB,MAClC;QAEJ,IAAK,IAAI,GAAG,IAAI,MAAM,OAAO,EAAE,EAC7B,IAAI,CAAC,IAAI,MAAM,GAAG,KAAK,CAAC,IAAI,IAAI;IAEpC;IAEA,OAAO,IAAI;AACb;AAEA,gBAAgB;AAChB,gBAAgB;AAEhB,+DAA+D;AAC/D,MAAM,SAAS,CAAC;AAChB,SAAS,EAAG,GAAG,EAAE,UAAU,EAAE,IAAI;IAC/B,MAAM,CAAC,IAAI,GAAG,MAAM,kBAAkB;QACpC,aAAe;YACb,KAAK;YAEL,OAAO,cAAc,CAAC,IAAI,EAAE,WAAW;gBACrC,OAAO,WAAW,KAAK,CAAC,IAAI,EAAE;gBAC9B,UAAU;gBACV,cAAc;YAChB;YAEA,mEAAmE;YACnE,IAAI,CAAC,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;YACnC,0EAA0E;YAC1E,iBAAiB;YACjB,IAAI,CAAC,KAAK,CAAC,4CAA4C;;YACvD,qCAAqC;YACrC,OAAO,IAAI,CAAC,IAAI;QAClB;QAEA,IAAI,OAAQ;YACV,OAAO;QACT;QAEA,IAAI,KAAM,KAAK,EAAE;YACf,OAAO,cAAc,CAAC,IAAI,EAAE,QAAQ;gBAClC,cAAc;gBACd,YAAY;gBACZ;gBACA,UAAU;YACZ;QACF;QAEA,WAAY;YACV,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,GAAG,EAAE,IAAI,CAAC,OAAO,EAAE;QACjD;IACF;AACF;AAEA,EAAE,4BACA,SAAU,IAAI;IACZ,IAAI,MACF,OAAO,GAAG,KAAK,4BAA4B,CAAC;IAG9C,OAAO;AACT,GAAG;AACL,EAAE,wBACA,SAAU,IAAI,EAAE,MAAM;IACpB,OAAO,CAAC,KAAK,EAAE,KAAK,iDAAiD,EAAE,OAAO,QAAQ;AACxF,GAAG;AACL,EAAE,oBACA,SAAU,GAAG,EAAE,KAAK,EAAE,KAAK;IACzB,IAAI,MAAM,CAAC,cAAc,EAAE,IAAI,kBAAkB,CAAC;IAClD,IAAI,WAAW;IACf,IAAI,OAAO,SAAS,CAAC,UAAU,KAAK,GAAG,CAAC,SAAS,KAAK,IACpD,WAAW,sBAAsB,OAAO;SACnC,IAAI,OAAO,UAAU,UAAU;QACpC,WAAW,OAAO;QAClB,IAAI,QAAQ,OAAO,MAAM,OAAO,OAAO,QAAQ,CAAE,CAAA,OAAO,MAAM,OAAO,GAAE,GACrE,WAAW,sBAAsB;QAEnC,YAAY;IACd;IACA,OAAO,CAAC,YAAY,EAAE,MAAM,WAAW,EAAE,UAAU;IACnD,OAAO;AACT,GAAG;AAEL,SAAS,sBAAuB,GAAG;IACjC,IAAI,MAAM;IACV,IAAI,IAAI,IAAI,MAAM;IAClB,MAAM,QAAQ,GAAG,CAAC,EAAE,KAAK,MAAM,IAAI;IACnC,MAAO,KAAK,QAAQ,GAAG,KAAK,EAC1B,MAAM,CAAC,CAAC,EAAE,IAAI,KAAK,CAAC,IAAI,GAAG,KAAK,KAAK;IAEvC,OAAO,GAAG,IAAI,KAAK,CAAC,GAAG,KAAK,KAAK;AACnC;AAEA,kBAAkB;AAClB,kBAAkB;AAElB,SAAS,YAAa,GAAG,EAAE,MAAM,EAAE,UAAU;IAC3C,eAAe,QAAQ;IACvB,IAAI,GAAG,CAAC,OAAO,KAAK,aAAa,GAAG,CAAC,SAAS,WAAW,KAAK,WAC5D,YAAY,QAAQ,IAAI,MAAM,GAAI,CAAA,aAAa,CAAA;AAEnD;AAEA,SAAS,WAAY,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,MAAM,EAAE,UAAU;IAC3D,IAAI,QAAQ,OAAO,QAAQ,KAAK;QAC9B,MAAM,IAAI,OAAO,QAAQ,WAAW,MAAM;QAC1C,IAAI;QACJ,IAAI,aAAa;YACf,IAAI,QAAQ,KAAK,QAAQ,OAAO,IAC9B,QAAQ,CAAC,IAAI,EAAE,EAAE,QAAQ,EAAE,EAAE,IAAI,EAAE,AAAC,CAAA,aAAa,CAAA,IAAK,IAAI,GAAG;iBAE7D,QAAQ,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,AAAC,CAAA,aAAa,CAAA,IAAK,IAAI,IAAI,EAAE,aAAa,CAAC,GAC5D,GAAG,AAAC,CAAA,aAAa,CAAA,IAAK,IAAI,IAAI,GAAG;eAG3C,QAAQ,CAAC,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,GAAG;QAE3C,MAAM,IAAI,OAAO,gBAAgB,CAAC,SAAS,OAAO;IACpD;IACA,YAAY,KAAK,QAAQ;AAC3B;AAEA,SAAS,eAAgB,KAAK,EAAE,IAAI;IAClC,IAAI,OAAO,UAAU,UACnB,MAAM,IAAI,OAAO,oBAAoB,CAAC,MAAM,UAAU;AAE1D;AAEA,SAAS,YAAa,KAAK,EAAE,MAAM,EAAE,IAAI;IACvC,IAAI,KAAK,KAAK,CAAC,WAAW,OAAO;QAC/B,eAAe,OAAO;QACtB,MAAM,IAAI,OAAO,gBAAgB,CAAC,QAAQ,UAAU,cAAc;IACpE;IAEA,IAAI,SAAS,GACX,MAAM,IAAI,OAAO,wBAAwB;IAG3C,MAAM,IAAI,OAAO,gBAAgB,CAAC,QAAQ,UACR,CAAC,GAAG,EAAE,OAAO,IAAI,EAAE,QAAQ,EAAE,QAAQ,EACrC;AACpC;AAEA,mBAAmB;AACnB,mBAAmB;AAEnB,MAAM,oBAAoB;AAE1B,SAAS,YAAa,GAAG;IACvB,uDAAuD;IACvD,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE;IACvB,wFAAwF;IACxF,MAAM,IAAI,IAAI,GAAG,OAAO,CAAC,mBAAmB;IAC5C,8CAA8C;IAC9C,IAAI,IAAI,MAAM,GAAG,GAAG,OAAO;IAC3B,uFAAuF;IACvF,MAAO,IAAI,MAAM,GAAG,MAAM,EACxB,MAAM,MAAM;IAEd,OAAO;AACT;AAEA,SAAS,YAAa,MAAM,EAAE,KAAK;IACjC,QAAQ,SAAS;IACjB,IAAI;IACJ,MAAM,SAAS,OAAO,MAAM;IAC5B,IAAI,gBAAgB;IACpB,MAAM,QAAQ,EAAE;IAEhB,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,EAAE,EAAG;QAC/B,YAAY,OAAO,UAAU,CAAC;QAE9B,yBAAyB;QACzB,IAAI,YAAY,UAAU,YAAY,QAAQ;YAC5C,uBAAuB;YACvB,IAAI,CAAC,eAAe;gBAClB,cAAc;gBACd,IAAI,YAAY,QAAQ;oBACtB,mBAAmB;oBACnB,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,IAAI,MAAM,IAAI,CAAC,MAAM,MAAM;oBAC9C;gBACF,OAAO,IAAI,IAAI,MAAM,QAAQ;oBAC3B,gBAAgB;oBAChB,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,IAAI,MAAM,IAAI,CAAC,MAAM,MAAM;oBAC9C;gBACF;gBAEA,aAAa;gBACb,gBAAgB;gBAEhB;YACF;YAEA,mBAAmB;YACnB,IAAI,YAAY,QAAQ;gBACtB,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,IAAI,MAAM,IAAI,CAAC,MAAM,MAAM;gBAC9C,gBAAgB;gBAChB;YACF;YAEA,uBAAuB;YACvB,YAAY,AAAC,CAAA,gBAAgB,UAAU,KAAK,YAAY,MAAK,IAAK;QACpE,OAAO,IAAI,eACT,2CAA2C;QAC3C;YAAA,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,IAAI,MAAM,IAAI,CAAC,MAAM,MAAM;QAAI;QAGpD,gBAAgB;QAEhB,cAAc;QACd,IAAI,YAAY,MAAM;YACpB,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,GAAG;YACtB,MAAM,IAAI,CAAC;QACb,OAAO,IAAI,YAAY,OAAO;YAC5B,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,GAAG;YACtB,MAAM,IAAI,CACR,aAAa,MAAM,MACnB,YAAY,OAAO;QAEvB,OAAO,IAAI,YAAY,SAAS;YAC9B,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,GAAG;YACtB,MAAM,IAAI,CACR,aAAa,MAAM,MACnB,aAAa,MAAM,OAAO,MAC1B,YAAY,OAAO;QAEvB,OAAO,IAAI,YAAY,UAAU;YAC/B,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,GAAG;YACtB,MAAM,IAAI,CACR,aAAa,OAAO,MACpB,aAAa,MAAM,OAAO,MAC1B,aAAa,MAAM,OAAO,MAC1B,YAAY,OAAO;QAEvB,OACE,MAAM,IAAI,MAAM;IAEpB;IAEA,OAAO;AACT;AAEA,SAAS,aAAc,GAAG;IACxB,MAAM,YAAY,EAAE;IACpB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM,EAAE,EAAE,EAChC,sDAAsD;IACtD,UAAU,IAAI,CAAC,IAAI,UAAU,CAAC,KAAK;IAErC,OAAO;AACT;AAEA,SAAS,eAAgB,GAAG,EAAE,KAAK;IACjC,IAAI,GAAG,IAAI;IACX,MAAM,YAAY,EAAE;IACpB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM,EAAE,EAAE,EAAG;QACnC,IAAI,AAAC,CAAA,SAAS,CAAA,IAAK,GAAG;QAEtB,IAAI,IAAI,UAAU,CAAC;QACnB,KAAK,KAAK;QACV,KAAK,IAAI;QACT,UAAU,IAAI,CAAC;QACf,UAAU,IAAI,CAAC;IACjB;IAEA,OAAO;AACT;AAEA,SAAS,cAAe,GAAG;IACzB,OAAO,OAAO,WAAW,CAAC,YAAY;AACxC;AAEA,SAAS,WAAY,GAAG,EAAE,GAAG,EAAE,MAAM,EAAE,MAAM;IAC3C,IAAI;IACJ,IAAK,IAAI,GAAG,IAAI,QAAQ,EAAE,EAAG;QAC3B,IAAI,AAAC,IAAI,UAAU,IAAI,MAAM,IAAM,KAAK,IAAI,MAAM,EAAG;QACrD,GAAG,CAAC,IAAI,OAAO,GAAG,GAAG,CAAC,EAAE;IAC1B;IACA,OAAO;AACT;AAEA,mFAAmF;AACnF,qEAAqE;AACrE,mDAAmD;AACnD,SAAS,WAAY,GAAG,EAAE,IAAI;IAC5B,OAAO,eAAe,QACnB,OAAO,QAAQ,IAAI,WAAW,IAAI,QAAQ,IAAI,WAAW,CAAC,IAAI,IAAI,QACjE,IAAI,WAAW,CAAC,IAAI,KAAK,KAAK,IAAI;AACxC;AACA,SAAS,YAAa,GAAG;IACvB,mBAAmB;IACnB,OAAO,QAAQ,IAAI,sCAAsC;;AAC3D;AAEA,4CAA4C;AAC5C,mDAAmD;AACnD,MAAM,sBAAsB,AAAC;IAC3B,MAAM,WAAW;IACjB,MAAM,QAAQ,IAAI,MAAM;IACxB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,EAAE,EAAG;QAC3B,MAAM,MAAM,IAAI;QAChB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,EAAE,EACxB,KAAK,CAAC,MAAM,EAAE,GAAG,QAAQ,CAAC,EAAE,GAAG,QAAQ,CAAC,EAAE;IAE9C;IACA,OAAO;AACT;AAEA,yDAAyD;AACzD,SAAS,mBAAoB,EAAE;IAC7B,OAAO,OAAO,WAAW,cAAc,yBAAyB;AAClE;AAEA,SAAS;IACP,MAAM,IAAI,MAAM;AAClB;;;ACzjEA;AAEA,QAAQ,UAAU,GAAG;AACrB,QAAQ,WAAW,GAAG;AACtB,QAAQ,aAAa,GAAG;AAExB,IAAI,SAAS,EAAE;AACf,IAAI,YAAY,EAAE;AAClB,IAAI,MAAM,OAAO,eAAe,cAAc,aAAa;AAE3D,IAAI,OAAO;AACX,IAAK,IAAI,IAAI,GAAG,MAAM,KAAK,MAAM,EAAE,IAAI,KAAK,EAAE,EAAG;IAC/C,MAAM,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE;IACnB,SAAS,CAAC,KAAK,UAAU,CAAC,GAAG,GAAG;AAClC;AAEA,6DAA6D;AAC7D,6DAA6D;AAC7D,SAAS,CAAC,IAAI,UAAU,CAAC,GAAG,GAAG;AAC/B,SAAS,CAAC,IAAI,UAAU,CAAC,GAAG,GAAG;AAE/B,SAAS,QAAS,GAAG;IACnB,IAAI,MAAM,IAAI,MAAM;IAEpB,IAAI,MAAM,IAAI,GACZ,MAAM,IAAI,MAAM;IAGlB,yDAAyD;IACzD,yDAAyD;IACzD,IAAI,WAAW,IAAI,OAAO,CAAC;IAC3B,IAAI,aAAa,IAAI,WAAW;IAEhC,IAAI,kBAAkB,aAAa,MAC/B,IACA,IAAK,WAAW;IAEpB,OAAO;QAAC;QAAU;KAAgB;AACpC;AAEA,4DAA4D;AAC5D,SAAS,WAAY,GAAG;IACtB,IAAI,OAAO,QAAQ;IACnB,IAAI,WAAW,IAAI,CAAC,EAAE;IACtB,IAAI,kBAAkB,IAAI,CAAC,EAAE;IAC7B,OAAO,AAAE,CAAA,WAAW,eAAc,IAAK,IAAI,IAAK;AAClD;AAEA,SAAS,YAAa,GAAG,EAAE,QAAQ,EAAE,eAAe;IAClD,OAAO,AAAE,CAAA,WAAW,eAAc,IAAK,IAAI,IAAK;AAClD;AAEA,SAAS,YAAa,GAAG;IACvB,IAAI;IACJ,IAAI,OAAO,QAAQ;IACnB,IAAI,WAAW,IAAI,CAAC,EAAE;IACtB,IAAI,kBAAkB,IAAI,CAAC,EAAE;IAE7B,IAAI,MAAM,IAAI,IAAI,YAAY,KAAK,UAAU;IAE7C,IAAI,UAAU;IAEd,sEAAsE;IACtE,IAAI,MAAM,kBAAkB,IACxB,WAAW,IACX;IAEJ,IAAI;IACJ,IAAK,IAAI,GAAG,IAAI,KAAK,KAAK,EAAG;QAC3B,MACE,AAAC,SAAS,CAAC,IAAI,UAAU,CAAC,GAAG,IAAI,KAChC,SAAS,CAAC,IAAI,UAAU,CAAC,IAAI,GAAG,IAAI,KACpC,SAAS,CAAC,IAAI,UAAU,CAAC,IAAI,GAAG,IAAI,IACrC,SAAS,CAAC,IAAI,UAAU,CAAC,IAAI,GAAG;QAClC,GAAG,CAAC,UAAU,GAAG,AAAC,OAAO,KAAM;QAC/B,GAAG,CAAC,UAAU,GAAG,AAAC,OAAO,IAAK;QAC9B,GAAG,CAAC,UAAU,GAAG,MAAM;IACzB;IAEA,IAAI,oBAAoB,GAAG;QACzB,MACE,AAAC,SAAS,CAAC,IAAI,UAAU,CAAC,GAAG,IAAI,IAChC,SAAS,CAAC,IAAI,UAAU,CAAC,IAAI,GAAG,IAAI;QACvC,GAAG,CAAC,UAAU,GAAG,MAAM;IACzB;IAEA,IAAI,oBAAoB,GAAG;QACzB,MACE,AAAC,SAAS,CAAC,IAAI,UAAU,CAAC,GAAG,IAAI,KAChC,SAAS,CAAC,IAAI,UAAU,CAAC,IAAI,GAAG,IAAI,IACpC,SAAS,CAAC,IAAI,UAAU,CAAC,IAAI,GAAG,IAAI;QACvC,GAAG,CAAC,UAAU,GAAG,AAAC,OAAO,IAAK;QAC9B,GAAG,CAAC,UAAU,GAAG,MAAM;IACzB;IAEA,OAAO;AACT;AAEA,SAAS,gBAAiB,GAAG;IAC3B,OAAO,MAAM,CAAC,OAAO,KAAK,KAAK,GAC7B,MAAM,CAAC,OAAO,KAAK,KAAK,GACxB,MAAM,CAAC,OAAO,IAAI,KAAK,GACvB,MAAM,CAAC,MAAM,KAAK;AACtB;AAEA,SAAS,YAAa,KAAK,EAAE,KAAK,EAAE,GAAG;IACrC,IAAI;IACJ,IAAI,SAAS,EAAE;IACf,IAAK,IAAI,IAAI,OAAO,IAAI,KAAK,KAAK,EAAG;QACnC,MACE,AAAC,CAAA,AAAC,KAAK,CAAC,EAAE,IAAI,KAAM,QAAO,IAC1B,CAAA,AAAC,KAAK,CAAC,IAAI,EAAE,IAAI,IAAK,MAAK,IAC3B,CAAA,KAAK,CAAC,IAAI,EAAE,GAAG,IAAG;QACrB,OAAO,IAAI,CAAC,gBAAgB;IAC9B;IACA,OAAO,OAAO,IAAI,CAAC;AACrB;AAEA,SAAS,cAAe,KAAK;IAC3B,IAAI;IACJ,IAAI,MAAM,MAAM,MAAM;IACtB,IAAI,aAAa,MAAM,EAAE,sCAAsC;;IAC/D,IAAI,QAAQ,EAAE;IACd,IAAI,iBAAiB,MAAM,wBAAwB;;IAEnD,+EAA+E;IAC/E,IAAK,IAAI,IAAI,GAAG,OAAO,MAAM,YAAY,IAAI,MAAM,KAAK,eACtD,MAAM,IAAI,CAAC,YAAY,OAAO,GAAG,AAAC,IAAI,iBAAkB,OAAO,OAAQ,IAAI;IAG7E,sEAAsE;IACtE,IAAI,eAAe,GAAG;QACpB,MAAM,KAAK,CAAC,MAAM,EAAE;QACpB,MAAM,IAAI,CACR,MAAM,CAAC,OAAO,EAAE,GAChB,MAAM,CAAC,AAAC,OAAO,IAAK,KAAK,GACzB;IAEJ,OAAO,IAAI,eAAe,GAAG;QAC3B,MAAM,AAAC,CAAA,KAAK,CAAC,MAAM,EAAE,IAAI,CAAA,IAAK,KAAK,CAAC,MAAM,EAAE;QAC5C,MAAM,IAAI,CACR,MAAM,CAAC,OAAO,GAAG,GACjB,MAAM,CAAC,AAAC,OAAO,IAAK,KAAK,GACzB,MAAM,CAAC,AAAC,OAAO,IAAK,KAAK,GACzB;IAEJ;IAEA,OAAO,MAAM,IAAI,CAAC;AACpB;;;ACrJA,uFAAuF,GACvF,QAAQ,IAAI,GAAG,SAAU,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM;IACzD,IAAI,GAAG;IACP,IAAI,OAAO,AAAC,SAAS,IAAK,OAAO;IACjC,IAAI,OAAO,AAAC,CAAA,KAAK,IAAG,IAAK;IACzB,IAAI,QAAQ,QAAQ;IACpB,IAAI,QAAQ;IACZ,IAAI,IAAI,OAAQ,SAAS,IAAK;IAC9B,IAAI,IAAI,OAAO,KAAK;IACpB,IAAI,IAAI,MAAM,CAAC,SAAS,EAAE;IAE1B,KAAK;IAEL,IAAI,IAAK,AAAC,CAAA,KAAM,CAAC,KAAK,IAAK;IAC3B,MAAO,CAAC;IACR,SAAS;IACT,MAAO,QAAQ,GAAG,IAAI,AAAC,IAAI,MAAO,MAAM,CAAC,SAAS,EAAE,EAAE,KAAK,GAAG,SAAS;IAEvE,IAAI,IAAK,AAAC,CAAA,KAAM,CAAC,KAAK,IAAK;IAC3B,MAAO,CAAC;IACR,SAAS;IACT,MAAO,QAAQ,GAAG,IAAI,AAAC,IAAI,MAAO,MAAM,CAAC,SAAS,EAAE,EAAE,KAAK,GAAG,SAAS;IAEvE,IAAI,MAAM,GACR,IAAI,IAAI;SACH,IAAI,MAAM,MACf,OAAO,IAAI,MAAO,AAAC,CAAA,IAAI,KAAK,CAAA,IAAK;SAC5B;QACL,IAAI,IAAI,KAAK,GAAG,CAAC,GAAG;QACpB,IAAI,IAAI;IACV;IACA,OAAO,AAAC,CAAA,IAAI,KAAK,CAAA,IAAK,IAAI,KAAK,GAAG,CAAC,GAAG,IAAI;AAC5C;AAEA,QAAQ,KAAK,GAAG,SAAU,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM;IACjE,IAAI,GAAG,GAAG;IACV,IAAI,OAAO,AAAC,SAAS,IAAK,OAAO;IACjC,IAAI,OAAO,AAAC,CAAA,KAAK,IAAG,IAAK;IACzB,IAAI,QAAQ,QAAQ;IACpB,IAAI,KAAM,SAAS,KAAK,KAAK,GAAG,CAAC,GAAG,OAAO,KAAK,GAAG,CAAC,GAAG,OAAO;IAC9D,IAAI,IAAI,OAAO,IAAK,SAAS;IAC7B,IAAI,IAAI,OAAO,IAAI;IACnB,IAAI,IAAI,QAAQ,KAAM,UAAU,KAAK,IAAI,QAAQ,IAAK,IAAI;IAE1D,QAAQ,KAAK,GAAG,CAAC;IAEjB,IAAI,MAAM,UAAU,UAAU,UAAU;QACtC,IAAI,MAAM,SAAS,IAAI;QACvB,IAAI;IACN,OAAO;QACL,IAAI,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,SAAS,KAAK,GAAG;QACzC,IAAI,QAAS,CAAA,IAAI,KAAK,GAAG,CAAC,GAAG,CAAC,EAAC,IAAK,GAAG;YACrC;YACA,KAAK;QACP;QACA,IAAI,IAAI,SAAS,GACf,SAAS,KAAK;aAEd,SAAS,KAAK,KAAK,GAAG,CAAC,GAAG,IAAI;QAEhC,IAAI,QAAQ,KAAK,GAAG;YAClB;YACA,KAAK;QACP;QAEA,IAAI,IAAI,SAAS,MAAM;YACrB,IAAI;YACJ,IAAI;QACN,OAAO,IAAI,IAAI,SAAS,GAAG;YACzB,IAAI,AAAC,CAAA,AAAC,QAAQ,IAAK,CAAA,IAAK,KAAK,GAAG,CAAC,GAAG;YACpC,IAAI,IAAI;QACV,OAAO;YACL,IAAI,QAAQ,KAAK,GAAG,CAAC,GAAG,QAAQ,KAAK,KAAK,GAAG,CAAC,GAAG;YACjD,IAAI;QACN;IACF;IAEA,MAAO,QAAQ,GAAG,MAAM,CAAC,SAAS,EAAE,GAAG,IAAI,MAAM,KAAK,GAAG,KAAK,KAAK,QAAQ;IAE3E,IAAI,AAAC,KAAK,OAAQ;IAClB,QAAQ;IACR,MAAO,OAAO,GAAG,MAAM,CAAC,SAAS,EAAE,GAAG,IAAI,MAAM,KAAK,GAAG,KAAK,KAAK,QAAQ;IAE1E,MAAM,CAAC,SAAS,IAAI,EAAE,IAAI,IAAI;AAChC;;;ACpFA;;;ACAA,OAAO,OAAO,GAAG,QAAQ,oBAAwB,YAAY,CAAC,WAAW,yBAAyB,MAAM,KAAK,GAAG;;;ACAhH;AAEA,IAAI,YAAY,CAAC;AACjB,SAAS,mBAAmB,EAAE;IAC5B,IAAI,QAAQ,SAAS,CAAC,GAAG;IACzB,IAAI,CAAC,OAAO;QACV,QAAQ;QACR,SAAS,CAAC,GAAG,GAAG;IAClB;IACA,OAAO;AACT;AACA,SAAS;IACP,IAAI;QACF,MAAM,IAAI;IACZ,EAAE,OAAO,KAAK;QACZ,IAAI,UAAU,AAAC,CAAA,KAAK,IAAI,KAAK,AAAD,EAAG,KAAK,CAAC;QACrC,IAAI,SACF,2EAA2E;QAC3E,mEAAmE;QACnE,OAAO,WAAW,OAAO,CAAC,EAAE;IAEhC;IACA,OAAO;AACT;AACA,SAAS,WAAW,GAAG;IACrB,OAAO,AAAC,CAAA,KAAK,GAAE,EAAG,OAAO,CAAC,2EAA2E,QAAQ;AAC/G;AAEA,kFAAkF;AAClF,SAAS,UAAU,GAAG;IACpB,IAAI,UAAU,AAAC,CAAA,KAAK,GAAE,EAAG,KAAK,CAAC;IAC/B,IAAI,CAAC,SACH,MAAM,IAAI,MAAM;IAElB,OAAO,OAAO,CAAC,EAAE;AACnB;AACA,QAAQ,YAAY,GAAG;AACvB,QAAQ,UAAU,GAAG;AACrB,QAAQ,SAAS,GAAG;;;ACtCpB,OAAO,OAAO,GAAG,QAAQ,oBAAwB,YAAY,CAAC,WAAW,4BAA4B,MAAM,KAAK,GAAG;;;ACAnH,OAAO,OAAO,GAAG,QAAQ,oBAAwB,YAAY,CAAC,WAAW,wCAAwC,MAAM,KAAK,GAAG;;;ACA/H,OAAO,OAAO,GAAG,QAAQ,oBAAwB,YAAY,CAAC,WAAW,sBAAsB,MAAM,KAAK,GAAG;;;ACA7G,OAAO,OAAO,GAAG,QAAQ,oBAAwB,YAAY,CAAC,WAAW,2BAA2B,MAAM,KAAK,GAAG;;;ACAlH,OAAO,OAAO,GAAG,QAAQ,oBAAwB,YAAY,CAAC,WAAW,yBAAyB,MAAM,KAAK,GAAG;;;;;ACUhH,4CAAa;AAVb;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEO,MAAM,eAAe,WAAG,KAAK;IAChC,YAAY,GAAc,CAAE;QACxB,KAAK,CAAC;YACF;YACA,OAAO;YACP,QAAQ;YACR,eAAe,WAAG,aAAa,CAAC,MAAM;QAC1C,SAGJ,mBAAmB,SAoGX,eAAe;IAtGvB;IAGA,kCAAkC;IAClC,aAAa,MAAiB,EAAQ;QAClC,OAAO,YAAY,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI;QACpD,MAAM,oBAAoB,WAAG,WAAW,CAAC,eAAe,CAAC;YACrD,OAAO,CAAA,GAAA,oBAAS,AAAD,EAAE,kBAAkB;YACnC,MAAM;gBACF,aAAa;gBACb,cAAc;gBACd,MAAM;gBACN,SAAS;YACb;QACJ;QAEA,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,MAAM,YAAY,IAAI,WAAG,SAAS,CAAC;YAC/B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc;QAGhC,MAAM,SAAS,IAAI,WAAG,SAAS,CAAC;YAC5B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW;QAE7B,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,IAAI,CAAC,gBAAgB,GAAG;QAExB,0GAA0G;QAG1G,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,MAAM,YAAY,IAAI,WAAG,SAAS,CAAC;YAC/B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc;QAEhC,MAAM,SAAS,IAAI,WAAG,SAAS,CAAC;YAC5B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW;QAE7B,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;IACnC;IAGA,YAAY,MAAiB,EAAE,SAAiB,EAAQ;QACpD,IAAI,MAAM,WAAG,MAAM,CAAC,IAAI;QACxB,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,gBAAgB;QAC3D,MAAM,QAAQ;QACd,MAAM,YAAY;QAElB,MAAM,KAAK,OAAO,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC;QACpC,MAAM,KAAK,GAAG,SAAS,CAAC,WAAG,OAAO,CAAC,MAAM;QACzC,MAAM,OAAO,GAAG,SAAS,CAAC,WAAG,OAAO,CAAC,QAAQ;QAC7C,MAAM,OAAO,GAAG,SAAS,CAAC,WAAG,OAAO,CAAC,QAAQ;QAC7C,MAAM,QAAQ,GAAG,SAAS,CAAC,WAAG,OAAO,CAAC,SAAS;QAE/C,6BAA6B;QAC7B,IAAI,CAAA,GAAA,4BAAa,AAAD,EAAE,aAAa,IAAI,OAAO;YACtC,KAAK;YACL,IACI,OAAO,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAG,IAAI,CAAC,OAAO,KAE3C,KAAK,aAAa,MAAM,OAAO,SAAS,MAAM,OAAO,SAAS,MAAM,QAAQ,SAAS,QAAQ,KAAK,SAAS,KAE3G,CAAA,GAAA,sBAAU,AAAD,EAAE,cAAc,CAAC,CAAC,GAAG,KAAM,0BAA0B;cACjE;gBACE,IAAI,CAAC,GAAG;gBACR,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG;gBACtC,IAAI,CAAC,gBAAgB,GAAG;YAC5B,OAGK,IACD,OAAO,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAG,IAAI,CAAC,SAAS,KAE7C,OAAO,aAAa,QAAQ,KAAK,SAAS,QAAQ,OAAO,SAAS,QAAQ,QAAQ,SAAS,QAAQ,KAAK,SAAS,KAEjH,CAAA,GAAA,sBAAU,AAAD,EAAE,cAAc,CAAC,CAAC,GAAG,IAAK,4BAA4B;cAClE;gBACE,IAAI,CAAC,GAAG;gBACR,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG;gBACtC,IAAI,CAAC,gBAAgB,GAAG;YAC5B,OAGK,IACD,OAAO,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAG,IAAI,CAAC,UAAU,KAE9C,QAAQ,EAAE,2EAA2E;gBAErF,CAAA,GAAA,sBAAU,AAAD,EAAE,cAAc,CAAC,CAAC,GAAG,KACjC;gBACE,IAAI,CAAC,GAAG;gBACR,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG;gBACtC,IAAI,CAAC,gBAAgB,GAAG;YAC5B,OAGK,IACD,OAAO,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAG,IAAI,CAAC,SAAS,KAE7C,OAAO,EAAE,yEAAyE;gBAElF,CAAA,GAAA,sBAAU,AAAD,EAAE,cAAc,CAAC,CAAC,GAAG,MACjC;gBACE,IAAI,CAAC,GAAG;gBACR,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG;gBACtC,IAAI,CAAC,gBAAgB,GAAG;YAC5B;YAEA,IAAI,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,GACzB,MAAM,IAAI,SAAS;YAGvB,IAAI,CAAC,GAAG,GAAG,IAAI,KAAK,CAAC,CAAA,GAAA,cAAM,AAAD,EAAE,WAAW;QAEvC,0CAA0C;QAC1C,yDAAyD;QACzD,GAAG;QACP;IAEJ;IAEA,sBAAsB,IAAiB,EAAE,KAAkB,EAAE,IAAa,EAAE,OAA4B,EAAQ;QAC5G,MAAM,aAAa,MAAM,KAAK;QAC9B,IAAI,sBAAsB,WAAG,OAAO,EAChC,KAAK,IAAI,gBAAgB,QAAQ,MAAM,CAAE;YACrC,wCAAwC;YACxC,MAAM,YAAY,WAAW,cAAc,CAAC,aAAa,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS;YAC/E,IAAI,WAAW,OAAO;gBAClB,MAAM,aAAa,UAAU,GAAG,CAAC,CAAC,GAAI,UAAU,KAAK,GAAG;gBACxD,MAAM,aAAa,UAAU,GAAG,CAAC,CAAC,GAAI,UAAU,MAAM,GAAG;gBACzD,0EAA0E;gBAC1E,IAAI,IAAI,CAAC,YAAY,KAAK,eAAe,IAAI,CAAC,YAAY,KAAK;oBAC3D,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,YACb,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI;yBAEd,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI;uBAGlB,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,YACb,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI;qBAEd,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI;gBAGtB;YACJ;QACJ;QAEJ,IAAI,sBAAsB,CAAA,GAAA,YAAK,AAAD,GAAG;YAC7B,WAAW,IAAI;YACf,CAAA,GAAA,4BAAa,AAAD,EAAE,GAAG,CAAC,8CAA8C;QACpE;QAEA,IAAI,sBAAsB,CAAA,GAAA,cAAM,AAAD;YAC3B,IAAI,CAAA,GAAA,sBAAU,AAAD,EAAE,eAAe,IAAI,OAClC,CAAA,GAAA,4BAAa,AAAD,EAAE,GAAG,CAAC,8EAA8E;iBAE5F,CAAA,GAAA,4BAAa,AAAD,EAAE,GAAG,CAAC,sBAAsB;;QAIhD,IAAI,sBAAsB,CAAA,GAAA,QAAG,AAAD;YACxB,IAAI,CAAA,GAAA,sBAAU,AAAD,EAAE,eAAe,IAAI,OAClC,CAAA,GAAA,4BAAa,AAAD,EAAE,GAAG,CAAC,2EAA2E;iBAEzF,CAAA,GAAA,4BAAa,AAAD,EAAE,GAAG,CAAC,kGAAkG;;IAIhI;AACJ;;;;;4CC1Pa;AAAN,MAAM,SAAS;IAClB,aAAa;IACb,kBAAkB;AACtB;;;ACHA,QAAQ,cAAc,GAAG,SAAU,CAAC;IAClC,OAAO,KAAK,EAAE,UAAU,GAAG,IAAI;QAAC,SAAS;IAAC;AAC5C;AAEA,QAAQ,iBAAiB,GAAG,SAAU,CAAC;IACrC,OAAO,cAAc,CAAC,GAAG,cAAc;QAAC,OAAO;IAAI;AACrD;AAEA,QAAQ,SAAS,GAAG,SAAU,MAAM,EAAE,IAAI;IACxC,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,SAAU,GAAG;QACvC,IACE,QAAQ,aACR,QAAQ,gBACR,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,MAE3C;QAGF,OAAO,cAAc,CAAC,MAAM,KAAK;YAC/B,YAAY;YACZ,KAAK;gBACH,OAAO,MAAM,CAAC,IAAI;YACpB;QACF;IACF;IAEA,OAAO;AACT;AAEA,QAAQ,MAAM,GAAG,SAAU,IAAI,EAAE,QAAQ,EAAE,GAAG;IAC5C,OAAO,cAAc,CAAC,MAAM,UAAU;QACpC,YAAY;QACZ,KAAK;IACP;AACF;;;;;AC7BA,2CAAa;AALb;AACA;AACA;AACA;AAEO,MAAM,cAAc,WAAG,KAAK;IAC/B,YAAY,GAAc,CAAE;QACxB,KAAK,CAAC;YACF;YACA,OAAO;YACP,QAAQ;YACR,eAAe,WAAG,aAAa,CAAC,KAAK;QACzC,SAGJ,mBAAmB,eA4BX,eAAe;IA9BvB;IAIA,aAAa,MAAiB,EAAQ;QAClC,MAAM,mBAAmB,WAAG,WAAW,CAAC,eAAe,CAAC;YACpD,OAAO,CAAA,GAAA,oBAAS,AAAD,EAAE,UAAU;YAC3B,MAAM;gBACF,aAAa;gBACb,cAAc;gBACd,MAAM;gBACN,SAAS;YACb;QACJ;QAEA,MAAM,SAAS,IAAI,WAAG,SAAS,CAAC;YAC5B,QAAQ;gBACJ;oBAAC,SAAS,iBAAiB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC7F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAU;QAE5B,MAAM,OAAO,IAAI,WAAG,SAAS,CAAC;YAC1B,QAAQ;gBACJ;oBAAC,SAAS,iBAAiB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC7F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ;IAC9B;IAIA,YAAY,MAAiB,EAAE,SAAiB,EAAQ;QACpD,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,gBAAgB;IAC/D;IAEA,sBAAsB,IAAiB,EAAE,KAAkB,EAAE,IAAa,EAAE,OAA4B,EAAQ,CAChH;IAEO,OAAa;QAChB,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG;QACtC,IAAI,CAAC,gBAAgB,GAAC;QACtB,CAAA,GAAA,sBAAU,AAAD,EAAE,eAAe,GAAG;IACjC;AACJ;;;;;ACtDA,gDAAa;AAHb;AAGO,MAAM;;aAEF,kBAAkB;;;QAEzB,6BAA6B;aACtB,WAAsC;;;QAE7C,sEAAsE;aAC/D,iBAA4B,WAAG,GAAG,CAAC,GAAG;;AAEjD;;;ACbA,mBAAmB;;;AAGnB,mDAAa;AAAN,MAAM;;aAEJ,gBAAgB;;IAEvB,OAAO,KAAK,MAAkB,EAAE;QAC9B,IAAI,CAAC,MAAM,GAAG;IAChB;IAEA,OAAO,IAAI,IAAY,EAAE,MAAe,EAAE;QACxC,IAAI,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC;QACvC,IAAI,CAAC,aAAa,GAAG;IACzB;AACF;;;;;ACRA,4CAAa;AAPb;AACA;AACA;AAKO,MAAM,eAAe,WAAG,KAAK;IAChC,YAAY,GAAc,CAAE;QACxB,KAAK,CAAC;YACF;YACA,OAAO;YACP,QAAQ;YACR,eAAe,WAAG,aAAa,CAAC,KAAK;QACzC,SAGJ,mBAAmB,SAiGX,eAAe;IAnGvB;IAGA,kCAAkC;IAClC,aAAa,MAAiB,EAAQ;QAClC,MAAM,oBAAoB,WAAG,WAAW,CAAC,eAAe,CAAC;YACrD,OAAO,CAAA,GAAA,oBAAS,AAAD,EAAE,iBAAiB;YAClC,MAAM;gBACF,aAAa;gBACb,cAAc;gBACd,MAAM;gBACN,SAAS;YACb;QACJ;QAEA,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC5F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC/F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,MAAM,YAAY,IAAI,WAAG,SAAS,CAAC;YAC/B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc;QAGhC,MAAM,SAAS,IAAI,WAAG,SAAS,CAAC;YAC5B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW;QAE7B,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC5F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC5F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC5F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC/F;QACL;QACA,SAAS,KAAK,GAAG,WAAG,GAAG,CAAC,KAAI;QAC5B,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,IAAI,CAAC,gBAAgB,GAAG;QAExB,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,MAAM,YAAY,IAAI,WAAG,SAAS,CAAC;YAC/B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc;QAEhC,MAAM,SAAS,IAAI,WAAG,SAAS,CAAC;YAC5B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW;QAE7B,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;IACnC;IAGA,YAAY,MAAiB,EAAE,SAAiB,EAAQ;QACpD,IAAI,MAAM,WAAG,MAAM,CAAC,IAAI;QACxB,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,gBAAgB;QAGvD,IAAI,CAAC,GAAG;IAKhB;IAEA,sBAAsB,IAAiB,EAAE,KAAkB,EAAE,IAAa,EAAE,OAA4B,EAAQ,CAChH;AACJ;;;;;AC3HA,yCAAa;AAPb;AACA;AACA;AAKO,MAAM,YAAY,WAAG,KAAK;IAC7B,YAAY,GAAc,CAAE;QACxB,KAAK,CAAC;YACF;YACA,OAAO;YACP,QAAQ;YACR,eAAe,WAAG,aAAa,CAAC,KAAK;QACzC,SAGJ,mBAAmB,SAiGX,eAAe;IAnGvB;IAGA,kCAAkC;IAClC,aAAa,MAAiB,EAAQ;QAClC,MAAM,oBAAoB,WAAG,WAAW,CAAC,eAAe,CAAC;YACrD,OAAO,CAAA,GAAA,oBAAS,AAAD,EAAE,iBAAiB;YAClC,MAAM;gBACF,aAAa;gBACb,cAAc;gBACd,MAAM;gBACN,SAAS;YACb;QACJ;QAEA,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC5F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC/F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,MAAM,YAAY,IAAI,WAAG,SAAS,CAAC;YAC/B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc;QAGhC,MAAM,SAAS,IAAI,WAAG,SAAS,CAAC;YAC5B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW;QAE7B,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,SAAS,KAAK,GAAG,WAAG,GAAG,CAAC,KAAI;QAC5B,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,IAAI,CAAC,gBAAgB,GAAG;QAExB,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC5F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,IAAI;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC/F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;QAE/B,MAAM,YAAY,IAAI,WAAG,SAAS,CAAC;YAC/B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc;QAEhC,MAAM,SAAS,IAAI,WAAG,SAAS,CAAC;YAC5B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW;QAE7B,MAAM,WAAW,IAAI,WAAG,SAAS,CAAC;YAC9B,QAAQ;gBACJ;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;gBAC3F;oBAAC,SAAS,kBAAkB,SAAS,CAAC,GAAG;oBAAiB,UAAU,CAAA,GAAA,cAAM,AAAD,EAAE,gBAAgB;gBAAA;aAC9F;QACL;QACA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa;IACnC;IAGA,YAAY,MAAiB,EAAE,SAAiB,EAAQ;QACpD,IAAI,MAAM,WAAG,MAAM,CAAC,IAAI;QACxB,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,gBAAgB;QAGvD,IAAI,CAAC,GAAG;IAKhB;IAEA,sBAAsB,IAAiB,EAAE,KAAkB,EAAE,IAAa,EAAE,OAA4B,EAAQ,CAChH;AACJ;;;;;AC/HA,gDAAa;AAHb;AACA;AAEO,MAAM,mBAAmB,WAAG,KAAK;IAgBpC,YAAY,GAAc,EAAE,KAAa,EAAE,MAAc,CAAE;QACvD,KAAK,CAAC;YACF;YACA,OAAO;YACP,QAAQ;YACR,eAAe,WAAG,aAAa,CAAC,gBAAgB;YAChD,QAAQ,IAAI,WAAG,MAAM,CAAC,GAAG;YACzB,GAAG;QACP,SAvBI,WAA+B,WAC/B,UAA8B,WAC9B,SAA6B,WAC7B,WAAqB,EAAE,OACvB,iBAAiB,QACjB,0BAA0B,YAC1B,WAAW,IAEnB,oBAAoB;aACZ,aAA4B,WAC5B,eAA8B,WAC9B,eAA8B,WAC9B,cAAsB,QACtB,kBAAmD;IAW3D;IAEA,aAAa,MAAiB,EAAQ;QAClC,6CAA6C;QAC7C,IAAI,CAAC,QAAQ,GAAG,SAAS,cAAc,CAAC;QACxC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,EAAE,cAAc;QAC5C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,EAAE,cAAc;QAE3C,8EAA8E;QAC9E,MAAM,OAAO,SAAS,cAAc,CAAC;QACrC,IAAI,MAAM;YACN,KAAK,gBAAgB,CAAC,aAAa,CAAC;gBAChC,EAAE,cAAc;gBAChB,IAAI,CAAC,OAAO;YAChB;YACA,KAAK,gBAAgB,CAAC,eAAe,CAAC,IAAM,EAAE,cAAc;QAChE;QAEA,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,iGAAiG;YACjG,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,aAAa,CAAC;gBACzC,EAAE,cAAc;gBAChB,IAAI,CAAC,OAAO;YAChB;YACA,wEAAwE;YACxE,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,eAAe,CAAC,IAAM,EAAE,cAAc;YAErE,oFAAoF;YACpF,OAAO,gBAAgB,CAAC,UAAU;gBAC9B,MAAM,UAAU,OAAO,WAAW,IAAI,OAAO,UAAU,GAAG,aAAa;gBACvE,IAAI,YAAY,IAAI,CAAC,eAAe,EAAE;oBAClC,IAAI,CAAC,eAAe,GAAG;oBACvB,IAAI,IAAI,CAAC,SAAS,MAAM,IAAI,CAAC,QAAQ,EAAE;wBACnC,MAAM,OAAO,IAAI,CAAC,cAAc;wBAChC,iCAAiC;wBACjC,IAAI,CAAC,aAAa;wBAClB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ;wBAC9B,qEAAqE;wBACrE,IAAI,CAAC,cAAc,GAAG,KAAK,GAAG,CAAC,MAAM,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG;wBAC5D,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc;oBACxC,OACI,gCAAgC;oBAChC,IAAI,CAAC,aAAa;gBAE1B;YACJ;YAEA,wCAAwC;YACxC,IAAI,CAAC,aAAa;QACtB;IACJ;IAEA,YAAY,MAAiB,EAAE,OAAe,EAAQ;QAClD,MAAM,KAAK,OAAO,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC;QACpC,2GAA2G;QAC3G,IAAI,OAAO,KAAK,CAAC,QAAQ,CAAC,WAAW,CAAC,WAAG,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,SAAS,IAClE,IAAI,CAAC,OAAO;QAGhB,MAAM,eAAe,GAAG,SAAS,CAAC,WAAG,OAAO,CAAC,KAAK,IAAI;QACtD,IAAI,IAAI,CAAC,uBAAuB,IAAI,CAAC,gBAAgB,IAAI,CAAC,SAAS,IAC/D,sBAAsB;QACtB,IAAI,CAAC,OAAO;QAEhB,IAAI,CAAC,uBAAuB,GAAG;IACnC;IAEQ,YAAY;QAChB,OAAO,IAAI,CAAC,QAAQ,EAAE,UAAU,SAAS,cAAc;IAC3D;IAEQ,gBAAgB;QACpB,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QACrC,kHAAkH;QAClH,IAAI,iBAAiB;QACrB,IAAI,aAAa;QACjB,IAAI,gBAAgB;QACpB,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI;YACnB,aAAa,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO;YACxC,gBAAgB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,UAAU;YAC9C,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG;YAC9B,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,UAAU,GAAG;YACjC,eAAe;YACf,IAAI,CAAC,QAAQ,CAAC,qBAAqB;YACnC,iBAAiB;QACrB;QAEA,MAAM,YAAY,IAAI,CAAC,OAAO;QAC9B,MAAM,YAAY,OAAO,gBAAgB,CAAC;QAC1C,MAAM,iBAAiB,UAAU,WAAW;QAC5C,MAAM,kBAAkB,UAAU,YAAY;QAE9C,+CAA+C;QAC/C,IAAI,kBAAkB,IAAI,CAAC,QAAQ,EAAE;YACjC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG;YAC9B,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,UAAU,GAAG;QACrC;QACA,QAAQ,GAAG,CAAC,kBAAkB,gBAAgB,mBAAmB;QACjE,iFAAiF;QACjF,IAAI,kBAAkB,kBAAkB,IAAI,kBAAkB;QAC9D,IAAI,mBAAmB,GAAG;YACtB,MAAM,SAAS,SAAS,cAAc,CAAC;YACvC,IAAI,QAAQ;gBACR,MAAM,QAAQ,OAAO,qBAAqB;gBAC1C,0DAA0D;gBAC1D,kBAAkB,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,MAAM,MAAM,GAAG;gBACzD,QAAQ,GAAG,CAAC,gBAAgB,MAAM,MAAM,EAAE,sBAAsB;YACpE,OAAO;gBACH,kBAAkB,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,OAAO,WAAW,GAAG;gBAC/D,QAAQ,GAAG,CAAC,sBAAsB,OAAO,WAAW,EAAE,sBAAsB;YAChF;QACJ;QACA,yCAAyC;QACzC,MAAM,cAAc;QACpB,MAAM,yBAAyB;QAC/B,MAAM,eAAe,iBAAiB,qBAAqB;QAE3D,6DAA6D;QAC7D,MAAM,aAAa,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,AAAC,eAAe,cAAe;QAC1E,MAAM,eAAe,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,aAAa;QAC1D,QAAQ,GAAG,CAAC;QACZ,iDAAiD;QACjD,UAAU,KAAK,CAAC,QAAQ,GAAG,aAAa;QACxC,UAAU,KAAK,CAAC,UAAU,GAAG,eAAe;QAE5C,2DAA2D;QAC3D,MAAM,OAAO,SAAS,aAAa,CAAC;QACpC,KAAK,KAAK,CAAC,UAAU,GAAG;QACxB,KAAK,KAAK,CAAC,QAAQ,GAAG;QACtB,KAAK,KAAK,CAAC,UAAU,GAAG;QACxB,KAAK,KAAK,CAAC,UAAU,GAAG,UAAU,UAAU;QAC5C,KAAK,KAAK,CAAC,QAAQ,GAAG,aAAa;QACnC,KAAK,WAAW,GAAG;QACnB,SAAS,IAAI,CAAC,WAAW,CAAC;QAC1B,MAAM,eAAe,KAAK,qBAAqB,GAAG,KAAK,GAAI,CAAA,KAAK,WAAW,EAAE,UAAU,CAAA;QACvF,SAAS,IAAI,CAAC,WAAW,CAAC;QAE1B,MAAM,eAAe,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,iBAAiB;QAC7D,MAAM,cAAc,aAAa,mCAAmC;QAEpE,wDAAwD;QACxD,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,WAAW,GAAG,cAAY;QAC/B,IAAI,CAAC,eAAe,GAAG,OAAO,WAAW,IAAI,OAAO,UAAU,GAAG,aAAa;IAClF;IAEQ,OAAO;QACX,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QACpB,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC;QAC5B,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,eAAe;QAC1C,gDAAgD;QAChD,CAAA,GAAA,4BAAa,AAAD,EAAE,aAAa,GAAG;QAC9B,qEAAqE;QACrE,IAAI,CAAC,uBAAuB,GAAG;IACnC;IAEQ,OAAO;QACX,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QACpB,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC;QAC/B,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,eAAe;QAC1C,iDAAiD;QACjD,CAAA,GAAA,4BAAa,AAAD,EAAE,aAAa,GAAG;IAClC;IAEQ,YAAY,KAAa,EAAE;QAC/B,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;QACnB,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI;QACnD,0BAA0B;QAC1B,IAAI,IAAI,CAAC,MAAM;YACX,IAAI,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,GAC7C,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG;iBAE5B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG;;IAGxC;IAEA,2CAA2C,GAC3C,AAAQ,UAAU;QACd,IAAI,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,GAAG;YAChD,IAAI,CAAC,cAAc,IAAI;YACvB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc;QACxC,OAAO;YACH,IAAI,CAAC,IAAI;YACT,IAAI,CAAC,QAAQ,GAAG,EAAE;YAClB,IAAI,CAAC,cAAc,GAAG;QAC1B;IACJ;IAEA,8DAA8D,GAC9D,AAAO,OAAO;QACV,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,OAAO;IACtC;IAEO,YAAY,aAAqB,EAAE;QACtC,0DAA0D;QAC1D,IAAI,CAAC,QAAQ,GAAG;QAChB,6DAA6D;QAC7D,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YACjC,sDAAsD;YACtD,IAAI,CAAC,QAAQ,GAAG;gBAAC;aAAc;YAC/B,IAAI,CAAC,cAAc,GAAG;YACtB,IAAI,CAAC,IAAI;YACT,IAAI,CAAC,WAAW,CAAC;YACjB;QACJ;QAEA,wEAAwE;QACxE,MAAM,qBAAqB,OAAO,WAAW,IAAI,OAAO,UAAU,GAAG,aAAa;QAClF,IAAI,IAAI,CAAC,eAAe,KAAK,QAAQ,IAAI,CAAC,eAAe,KAAK,oBAC1D,IAAI,CAAC,aAAa;QAGtB,oDAAoD;QACpD,MAAM,YAAY,IAAI,CAAC,OAAO;QAC9B,MAAM,YAAY,OAAO,gBAAgB,CAAC;QAC1C,MAAM,iBAAiB,UAAU,WAAW;QAE5C,qEAAqE;QACrE,MAAM,eAAe,IAAI,CAAC,YAAY,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,iBAAiB;QAClF,MAAM,cAAc,IAAI,CAAC,WAAW;QACpC,MAAM,WAAW,eAAe;QAEhC,MAAM,QAAQ,cAAc,KAAK,CAAC,UAAU,kBAAkB;QAC9D,MAAM,WAAqB,EAAE;QAC7B,IAAI,UAAU;QAEd,KAAK,MAAM,KAAK,MAAO;YACnB,MAAM,OAAO,UAAU;YACvB,IAAI,KAAK,MAAM,GAAG,YAAY,QAAQ,MAAM,GAAG,GAAG;gBAC9C,SAAS,IAAI,CAAC,QAAQ,IAAI;gBAC1B,qCAAqC;gBACrC,IAAI,EAAE,MAAM,GAAG,UAAU;oBACrB,IAAI,OAAO;oBACX,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,MAAM,EAAE,IAAK;wBAC/B,QAAQ,CAAC,CAAC,EAAE;wBACZ,IAAI,KAAK,MAAM,IAAI,UAAU;4BACzB,SAAS,IAAI,CAAC;4BACd,OAAO;wBACX;oBACJ;oBACA,UAAU;gBACd,OACI,UAAU;YAElB,OACI,UAAU;QAElB;QACA,IAAI,QAAQ,IAAI,GAAG,MAAM,GAAG,GAAG,SAAS,IAAI,CAAC,QAAQ,IAAI;QAEzD,IAAI,CAAC,QAAQ,GAAG,SAAS,MAAM,GAAG,WAAW;YAAC;SAAc;QAC5D,IAAI,CAAC,cAAc,GAAG;QACtB,IAAI,CAAC,WAAW,CAAC;QACjB,IAAI,CAAC,IAAI;IACb;AACJ;;;AC9RA,CAAC,SAAS,CAAC,EAAC,CAAC;IAAoD,OAAO,OAAO,GAAC;AAA8H,EAAE,QAAO;IAAW,OAAO,SAAS,CAAC;QAAE,IAAI,IAAE,CAAC;QAAE,SAAS,EAAE,CAAC;YAAE,IAAG,CAAC,CAAC,EAAE,EAAC,OAAO,CAAC,CAAC,EAAE,CAAC,OAAO;YAAC,IAAI,IAAE,CAAC,CAAC,EAAE,GAAC;gBAAC,GAAE;gBAAE,GAAE,CAAC;gBAAE,SAAQ,CAAC;YAAC;YAAE,OAAO,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,OAAO,EAAC,GAAE,EAAE,OAAO,EAAC,IAAG,EAAE,CAAC,GAAC,CAAC,GAAE,EAAE,OAAO;QAAA;QAAC,OAAO,EAAE,CAAC,GAAC,GAAE,EAAE,CAAC,GAAC,GAAE,EAAE,CAAC,GAAC,SAAS,CAAC,EAAC,CAAC,EAAC,CAAC;YAAE,EAAE,CAAC,CAAC,GAAE,MAAI,OAAO,cAAc,CAAC,GAAE,GAAE;gBAAC,YAAW,CAAC;gBAAE,KAAI;YAAC;QAAE,GAAE,EAAE,CAAC,GAAC,SAAS,CAAC;YAAE,eAAa,OAAO,UAAQ,OAAO,WAAW,IAAE,OAAO,cAAc,CAAC,GAAE,OAAO,WAAW,EAAC;gBAAC,OAAM;YAAQ,IAAG,OAAO,cAAc,CAAC,GAAE,cAAa;gBAAC,OAAM,CAAC;YAAC;QAAE,GAAE,EAAE,CAAC,GAAC,SAAS,CAAC,EAAC,CAAC;YAAE,IAAG,IAAE,KAAI,CAAA,IAAE,EAAE,EAAC,GAAG,IAAE,GAAE,OAAO;YAAE,IAAG,IAAE,KAAG,YAAU,OAAO,KAAG,KAAG,EAAE,UAAU,EAAC,OAAO;YAAE,IAAI,IAAE,OAAO,MAAM,CAAC;YAAM,IAAG,EAAE,CAAC,CAAC,IAAG,OAAO,cAAc,CAAC,GAAE,WAAU;gBAAC,YAAW,CAAC;gBAAE,OAAM;YAAC,IAAG,IAAE,KAAG,YAAU,OAAO,GAAE,IAAI,IAAI,KAAK,EAAE,EAAE,CAAC,CAAC,GAAE,GAAE,CAAA,SAAS,CAAC;gBAAE,OAAO,CAAC,CAAC,EAAE;YAAA,CAAA,EAAE,IAAI,CAAC,MAAK;YAAI,OAAO;QAAC,GAAE,EAAE,CAAC,GAAC,SAAS,CAAC;YAAE,IAAI,IAAE,KAAG,EAAE,UAAU,GAAC;gBAAW,OAAO,EAAE,OAAO;YAAA,IAAE;gBAAW,OAAO;YAAC;YAAE,OAAO,EAAE,CAAC,CAAC,GAAE,KAAI,IAAG;QAAC,GAAE,EAAE,CAAC,GAAC,SAAS,CAAC,EAAC,CAAC;YAAE,OAAO,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,GAAE;QAAE,GAAE,EAAE,CAAC,GAAC,IAAG,EAAE,EAAE,CAAC,GAAC;IAAE,EAAE;QAAC,SAAS,CAAC,EAAC,CAAC,EAAC,CAAC;YAAE;YAAa,EAAE,CAAC,CAAC;YAAG,IAAI,GAAE,IAAE,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAE,EAAE,CAAC,GAAC,EAAE,CAAC,EAAC,IAAE,EAAE,CAAC,GAAC,EAAE,CAAC;gBAAC,OAAO,KAAK,IAAI,CAAC,IAAE,IAAE,IAAE;YAAE,GAAE,IAAE,SAAS,CAAC;gBAAE,OAAO,IAAG,CAAA,KAAK,EAAE,GAAC,GAAE;YAAE,GAAE,IAAE,SAAS,CAAC;gBAAE,OAAO,IAAG,CAAA,MAAI,KAAK,EAAE,AAAD;YAAE,GAAE,IAAE,IAAI,KAAI,IAAE,SAAS,CAAC;gBAAE,EAAE,GAAG,CAAC,MAAI,aAAa,EAAE,GAAG,CAAC,KAAI,EAAE,GAAG,CAAC,GAAE,WAAW,GAAE;YAAK,GAAE,IAAE,SAAS,CAAC,EAAC,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAI,GAAE,IAAE,EAAE,KAAK,CAAC,WAAU,IAAE,GAAE,IAAE,EAAE,MAAM,EAAC,KAAG,EAAE,IAAE,CAAC,CAAC,EAAE,EAAC,EAAE,gBAAgB,GAAC,EAAE,gBAAgB,CAAC,GAAE,GAAE,CAAC,KAAG,EAAE,WAAW,IAAE,EAAE,WAAW,CAAC,GAAE;YAAE,GAAE,IAAE,SAAS,CAAC,EAAC,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAI,GAAE,IAAE,EAAE,KAAK,CAAC,WAAU,IAAE,GAAE,IAAE,EAAE,MAAM,EAAC,KAAG,EAAE,IAAE,CAAC,CAAC,EAAE,EAAC,EAAE,mBAAmB,GAAC,EAAE,mBAAmB,CAAC,GAAE,KAAG,EAAE,WAAW,IAAE,EAAE,WAAW,CAAC,GAAE;YAAE,GAAE,IAAE,SAAS,CAAC;gBAAE,OAAO,EAAE,cAAc,IAAG,EAAE,IAAI,CAAC,KAAK,CAAC,YAAU,EAAE,cAAc,GAAC;YAAC,GAAE,IAAE;gBAAW,OAAM;oBAAC,GAAE,KAAK,MAAI,OAAO,WAAW,GAAC,OAAO,WAAW,GAAC,AAAC,CAAA,SAAS,eAAe,IAAE,SAAS,IAAI,CAAC,UAAU,IAAE,SAAS,IAAI,AAAD,EAAG,UAAU;oBAAC,GAAE,KAAK,MAAI,OAAO,WAAW,GAAC,OAAO,WAAW,GAAC,AAAC,CAAA,SAAS,eAAe,IAAE,SAAS,IAAI,CAAC,UAAU,IAAE,SAAS,IAAI,AAAD,EAAG,SAAS;gBAAA;YAAC,GAAE,IAAE,SAAS,CAAC,EAAC,CAAC;gBAAE,EAAE,GAAG,IAAE,EAAE,KAAK,IAAE,EAAE,MAAM,IAAE,EAAE,IAAI,GAAE,CAAA,EAAE,KAAK,CAAC,GAAG,GAAC,EAAE,GAAG,EAAC,EAAE,KAAK,CAAC,KAAK,GAAC,EAAE,KAAK,EAAC,EAAE,KAAK,CAAC,MAAM,GAAC,EAAE,MAAM,EAAC,EAAE,KAAK,CAAC,IAAI,GAAC,EAAE,IAAI,AAAD,IAAI,CAAA,EAAE,KAAK,CAAC,IAAI,GAAC,EAAE,CAAC,GAAC,MAAK,EAAE,KAAK,CAAC,GAAG,GAAC,EAAE,CAAC,GAAC,IAAG;YAAE,GAAE,IAAE,SAAS,CAAC,EAAC,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAE,EAAE;gBAAG,IAAI,IAAI,KAAK,EAAE,IAAG,EAAE,cAAc,CAAC;oBAAG,IAAG,YAAU,OAAO,GAAE,CAAC,CAAC,EAAE,GAAC,IAAE,MAAI;yBAAM;wBAAC,IAAI,IAAI,IAAE,IAAG,IAAE,GAAE,IAAE,EAAE,MAAM,EAAC,IAAE,GAAE,KAAG,EAAE,KAAG,CAAC,CAAC,EAAE,GAAC,MAAI,IAAE;wBAAK,CAAC,CAAC,EAAE,GAAC,EAAE,KAAK,CAAC,GAAE;oBAAG;;gBAAC,OAAO;YAAC,GAAE,IAAE,SAAS,CAAC;gBAAE,IAAI,IAAE,CAAC;gBAAE,CAAC,CAAC,EAAE,GAAC;gBAAG,OAAM;oBAAC;oBAAS;oBAAM;iBAAI,CAAC,OAAO,CAAC,SAAS,CAAC;oBAAE,CAAC,CAAC,IAAE,EAAE,MAAM,CAAC,GAAG,WAAW,KAAG,EAAE,KAAK,CAAC,GAAG,GAAC;gBAAE,IAAG;YAAC,GAAE,IAAE,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAI,KAAK,EAAE,EAAE,cAAc,CAAC,MAAK,CAAA,CAAC,CAAC,EAAE,GAAC,CAAC,CAAC,EAAE,AAAD;gBAAG,OAAO;YAAC,GAAE,IAAE,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAG,EAAE,MAAM,EAAC,IAAI,IAAI,IAAE,GAAE,IAAE,EAAE,MAAM,EAAC,IAAE,GAAE,KAAG,EAAE,EAAE,CAAC,CAAC,EAAE;qBAAO,EAAE;YAAE,GAAE,IAAE,CAAC,CAAE,CAAA,kBAAiB,MAAK,GAAG,IAAE,CAAC,CAAC,OAAO,YAAY,EAAC,IAAE,CAAC,CAAC,OAAO,cAAc,EAAC,IAAE;gBAAC,OAAM;gBAAY,MAAK;gBAAY,KAAI;YAAS,GAAE,IAAE,CAAC;YAAE,SAAS,KAAI;YAAC,IAAE,IAAE;gBAAC,OAAM;gBAAc,MAAK;gBAAc,KAAI;YAA0B,IAAE,IAAE,IAAE;gBAAC,OAAM;gBAAgB,MAAK;gBAAgB,KAAI;YAAa,IAAE,IAAG,CAAA,IAAE;gBAAC,OAAM;gBAAa,MAAK;gBAAY,KAAI;YAAuB,GAAE,IAAE,CAAA,IAAG,IAAE,GAAE,EAAE,SAAS,CAAC,EAAE,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,GAAE,IAAE,EAAE,KAAK,CAAC;gBAAU,IAAI,CAAC,UAAU,GAAC,IAAI,CAAC,UAAU,IAAE,CAAC;gBAAE,IAAI,IAAI,IAAE,GAAE,IAAE,EAAE,MAAM,EAAC,KAAG,EAAE,IAAE,CAAC,CAAC,EAAE,EAAC,IAAI,CAAC,UAAU,CAAC,EAAE,GAAC,IAAI,CAAC,UAAU,CAAC,EAAE,IAAE,EAAE,EAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC;gBAAG,OAAO,IAAI;YAAA,GAAE,EAAE,SAAS,CAAC,GAAG,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,OAAO,IAAI,CAAC,UAAU,GAAC,IAAI,CAAC,UAAU,IAAE,CAAC,GAAE,KAAK,MAAI,IAAE,IAAI,CAAC,UAAU,GAAC,CAAC,IAAE,KAAK,MAAI,IAAE,IAAI,CAAC,UAAU,CAAC,EAAE,GAAC,OAAK,IAAI,CAAC,UAAU,CAAC,EAAE,IAAE,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,CAAC,MAAI,KAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,CAAC,IAAG,IAAG,IAAI;YAAA,GAAE,EAAE,SAAS,CAAC,OAAO,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,GAAE,IAAE,IAAI,EAAC,IAAE,EAAE,KAAK,CAAC;gBAAU,EAAE,UAAU,GAAC,EAAE,UAAU,IAAE,CAAC;gBAAE,IAAI,IAAI,IAAE,GAAE,IAAE,EAAE,MAAM,EAAC,KAAG,EAAE,IAAE,CAAC,CAAC,EAAE,EAAC,EAAE,UAAU,CAAC,EAAE,IAAE,EAAE,UAAU,CAAC,EAAE,CAAC,MAAM,IAAE,EAAE,UAAU,CAAC,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;oBAAE,EAAE,IAAI,CAAC,GAAE;wBAAC,MAAK;wBAAE,QAAO;oBAAC,GAAE;gBAAE;YAAE,GAAE,EAAE,SAAS,CAAC,MAAM,GAAC,SAAS,CAAC;gBAAE,IAAI,CAAC,OAAO,GAAC,IAAI,CAAC,QAAQ,IAAE,CAAC,GAAE,KAAI,CAAA,IAAI,CAAC,OAAO,GAAC,SAAS,CAAC,EAAC,CAAC;oBAAE,IAAI,IAAE,CAAC;oBAAE,IAAI,IAAI,KAAK,EAAE,EAAE,cAAc,CAAC,MAAI,EAAE,cAAc,CAAC,KAAG,CAAC,CAAC,EAAE,GAAC,CAAC,CAAC,EAAE,GAAC,EAAE,cAAc,CAAC,MAAK,CAAA,CAAC,CAAC,EAAE,GAAC,CAAC,CAAC,EAAE,AAAD;oBAAG,OAAO;gBAAC,EAAE,IAAI,CAAC,OAAO,EAAC,EAAC;YAAE,GAAE,EAAE,SAAS,CAAC,OAAO,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAE,IAAI;gBAAC,OAAO,EAAE,aAAa,GAAC,EAAE,aAAa,IAAE,CAAC,GAAE,EAAE,aAAa,CAAC,EAAE,GAAC;oBAAW,cAAY,OAAO,CAAC,CAAC,OAAK,EAAE,GAAC,CAAC,CAAC,OAAK,EAAE,CAAC,KAAK,CAAC,GAAE,aAAW,QAAQ,IAAI,CAAC,4BAA0B,IAAE;gBAAa,GAAE,EAAE,GAAE,CAAC,CAAC,EAAE,EAAC,EAAE,aAAa,CAAC,EAAE,GAAE,CAAC,CAAC,EAAE,IAAE,EAAE,GAAE,CAAC,CAAC,EAAE,EAAC,EAAE,aAAa,CAAC,EAAE,GAAE;YAAC,GAAE,EAAE,SAAS,CAAC,SAAS,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,OAAO,IAAI,CAAC,aAAa,GAAC,IAAI,CAAC,aAAa,IAAE,CAAC,GAAE,EAAE,GAAE,CAAC,CAAC,EAAE,EAAC,IAAI,CAAC,aAAa,CAAC,EAAE,GAAE,CAAC,CAAC,EAAE,IAAE,EAAE,GAAE,CAAC,CAAC,EAAE,EAAC,IAAI,CAAC,aAAa,CAAC,EAAE,GAAE,OAAO,IAAI,CAAC,aAAa,CAAC,EAAE,EAAC,IAAI;YAAA;YAAE,IAAI,IAAE;YAAE,SAAS,EAAE,CAAC,EAAC,CAAC;gBAAE,OAAO,IAAI,CAAC,UAAU,GAAC,EAAE,UAAU,EAAC,IAAI,CAAC,QAAQ,GAAC,EAAE,QAAQ,EAAC,IAAI,CAAC,aAAa,GAAC,EAAE,aAAa,EAAC,IAAI,CAAC,UAAU,GAAC,GAAE,IAAI,CAAC,QAAQ,GAAC;oBAAC,MAAK;oBAAI,WAAU;oBAAG,OAAM;oBAAQ,UAAS;oBAAI,UAAS,CAAC;oBAAE,cAAa,CAAC;oBAAE,aAAY;oBAAG,MAAK;oBAAU,MAAK,SAAS,IAAI;oBAAC,OAAM,CAAC;oBAAE,OAAM,CAAC;oBAAE,OAAM;gBAAQ,GAAE,IAAI,CAAC,MAAM,CAAC,IAAG,cAAY,IAAI,CAAC,OAAO,CAAC,IAAI,IAAG,CAAA,IAAI,CAAC,OAAO,CAAC,WAAW,GAAC,CAAA,GAAG,IAAI,CAAC,EAAE,GAAC,EAAE,EAAE,EAAC,EAAE,EAAE,IAAE,GAAE,IAAI,CAAC,OAAO,GAAG,OAAO,IAAG,IAAI,CAAC,QAAQ,GAAC;oBAAC,IAAG,IAAI,CAAC,EAAE,CAAC,EAAE;oBAAC,IAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI;oBAAE,KAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI;oBAAE,MAAK,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI;oBAAE,MAAK,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI;oBAAE,KAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI;oBAAE,QAAO,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI;oBAAE,SAAQ,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI;oBAAE,aAAY,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI;oBAAE,gBAAe,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI;oBAAE,kBAAiB,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI;oBAAE,SAAQ,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI;oBAAE,UAAS,IAAI,CAAC,QAAQ;oBAAC,eAAc,IAAI,CAAC,aAAa;oBAAC,IAAG,IAAI,CAAC,EAAE;oBAAC,YAAW,IAAI,CAAC,UAAU;oBAAC,IAAG,IAAI,CAAC,EAAE;oBAAC,SAAQ,IAAI,CAAC,OAAO;gBAAA,GAAE,IAAI,CAAC,QAAQ;YAAA;YAAC,EAAE,SAAS,GAAC,IAAI,GAAE,EAAE,WAAW,GAAC,GAAE,EAAE,EAAE,GAAC,GAAE,EAAE,SAAS,CAAC,OAAO,GAAC,SAAS,CAAC;gBAAE,OAAO,IAAI,CAAC,EAAE,GAAC,CAAC,GAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAC,IAAI,GAAE,CAAA,IAAI,CAAC,EAAE,CAAC,EAAE,GAAC,SAAS,aAAa,CAAC,QAAO,IAAI,CAAC,EAAE,CAAC,IAAI,GAAC,SAAS,aAAa,CAAC,QAAO,IAAI,CAAC,EAAE,CAAC,KAAK,GAAC,SAAS,aAAa,CAAC,QAAO,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,SAAS,GAAC,uBAAqB,IAAI,CAAC,UAAU,CAAC,EAAE,EAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,GAAC,QAAO,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,GAAC,SAAQ,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,YAAY,CAAC,MAAK,YAAU,IAAI,CAAC,UAAU,CAAC,EAAE,GAAC,MAAI,IAAI,CAAC,EAAE,GAAE,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,GAAE,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,GAAE,IAAI,AAAD;YAAE,GAAE,EAAE,SAAS,CAAC,OAAO,GAAC;gBAAW,IAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAC,OAAO,IAAI;gBAAC,IAAI,IAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAC,MAAK,IAAE,SAAS,CAAC,EAAC,CAAC;oBAAE,IAAI,IAAE,EAAE;oBAAG,IAAI,IAAI,KAAK,EAAE,EAAE,cAAc,CAAC,MAAK,CAAA,CAAC,CAAC,EAAE,GAAC,CAAA;oBAAG,OAAO;gBAAC,EAAE,gBAAe,QAAO,IAAE,EAAE,cAAa,WAAU,IAAG,IAAE,CAAC;gBAAE,OAAO,EAAE,EAAE,GAAC;oBAAC,UAAS;oBAAW,SAAQ,IAAI,CAAC,OAAO,CAAC,WAAW;oBAAC,SAAQ;oBAAQ,QAAO;gBAAG,GAAE,EAAE,IAAI,GAAC;oBAAC,UAAS;oBAAW,SAAQ;oBAAQ,OAAM,IAAI,CAAC,OAAO,CAAC,IAAI,GAAC;oBAAK,QAAO,IAAI,CAAC,OAAO,CAAC,IAAI,GAAC;oBAAK,MAAK;oBAAE,YAAW,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,GAAC,IAAE;oBAAK,WAAU,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,GAAC,IAAE;oBAAK,YAAW,IAAI,CAAC,OAAO,CAAC,KAAK;oBAAC,SAAQ;gBAAI,GAAE,EAAE,KAAK,GAAC;oBAAC,OAAM,IAAI,CAAC,OAAO,CAAC,IAAI,GAAC,IAAE;oBAAK,QAAO,IAAI,CAAC,OAAO,CAAC,IAAI,GAAC,IAAE;oBAAK,UAAS;oBAAW,SAAQ;oBAAQ,MAAK;oBAAE,YAAW,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,GAAC,IAAE;oBAAK,WAAU,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,GAAC,IAAE;oBAAK,YAAW,IAAI,CAAC,OAAO,CAAC,KAAK;oBAAC,SAAQ;oBAAK,WAAU;gBAAqB,GAAE,EAAE,EAAE,EAAE,EAAC,IAAG,aAAW,IAAI,CAAC,OAAO,CAAC,KAAK,IAAE,EAAE,EAAE,IAAI,EAAC,IAAG,EAAE,EAAE,KAAK,EAAC,IAAG,IAAI,CAAC,WAAW,CAAC,IAAG,IAAI;YAAA,GAAE,EAAE,SAAS,CAAC,WAAW,GAAC,SAAS,CAAC;gBAAE,IAAI,IAAI,KAAK,IAAI,CAAC,EAAE,CAAC,IAAG,IAAI,CAAC,EAAE,CAAC,cAAc,CAAC,IAAG,IAAI,IAAI,KAAK,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,GAAC,CAAC,CAAC,EAAE,CAAC,EAAE;gBAAC,OAAO,IAAI;YAAA,GAAE,EAAE,SAAS,CAAC,QAAQ,GAAC;gBAAW,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAE,SAAS,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,IAAE,IAAI,GAAE,CAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,GAAE,IAAI,AAAD;YAAE,GAAE,EAAE,SAAS,CAAC,aAAa,GAAC;gBAAW,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAE,CAAC,SAAS,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,IAAE,IAAI,GAAE,CAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,GAAE,IAAI,AAAD;YAAE,GAAE,EAAE,SAAS,CAAC,OAAO,GAAC;gBAAW,aAAa,IAAI,CAAC,aAAa,GAAE,aAAa,IAAI,CAAC,WAAW,GAAE,aAAa,IAAI,CAAC,WAAW,GAAE,IAAI,CAAC,OAAO,CAAC,aAAY,IAAI,CAAC,QAAQ,GAAE,IAAI,CAAC,aAAa,IAAG,IAAI,CAAC,GAAG;YAAE,GAAE,EAAE,SAAS,CAAC,IAAI,GAAC,SAAS,CAAC;gBAAE,IAAI,IAAE,IAAI;gBAAC,OAAO,EAAE,OAAO,CAAC,QAAQ,GAAC,IAAG,CAAA,aAAa,EAAE,aAAa,GAAE,aAAa,EAAE,WAAW,GAAE,aAAa,EAAE,WAAW,GAAE,EAAE,QAAQ,IAAG,EAAE,YAAY,IAAG,WAAW;oBAAW,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,GAAC;gBAAC,GAAE,IAAG,EAAE,WAAW,GAAC,WAAW;oBAAW,EAAE,OAAO,CAAC,SAAQ,EAAE,QAAQ,GAAE,cAAY,OAAO,KAAG,EAAE,IAAI,CAAC,IAAI;gBAAC,GAAE,EAAE,OAAO,CAAC,QAAQ,GAAE,CAAA;YAAE,GAAE,EAAE,SAAS,CAAC,IAAI,GAAC,SAAS,CAAC;gBAAE,IAAI,IAAE,IAAI;gBAAC,IAAG,EAAE,OAAO,CAAC,QAAQ,EAAC,OAAO;gBAAE,IAAG,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,GAAC,EAAE,OAAO,CAAC,WAAW,EAAC,aAAa,EAAE,aAAa,GAAE,aAAa,EAAE,WAAW,GAAE,aAAa,EAAE,WAAW,GAAE,EAAE,aAAa,GAAC,WAAW;oBAAW,IAAI,IAAE,cAAY,EAAE,OAAO,CAAC,IAAI,GAAC,SAAO;oBAAQ,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,GAAC,GAAE,cAAY,OAAO,KAAG,EAAE,IAAI,CAAC,IAAG,EAAE,OAAO,CAAC,UAAS,EAAE,QAAQ;gBAAC,GAAE,EAAE,OAAO,CAAC,QAAQ,GAAE,EAAE,OAAO,CAAC,YAAY,EAAC;oBAAC,IAAI,IAAE,EAAE,OAAO,CAAC,YAAY,EAAC,IAAE,CAAC;oBAAE,EAAE,CAAC,GAAC,CAAC,MAAI,KAAG,CAAC,MAAI,EAAE,CAAC,GAAC,IAAE,EAAE,QAAQ,CAAC,aAAa,CAAC,CAAC,EAAC,EAAE,CAAC,GAAC,CAAC,MAAI,KAAG,CAAC,MAAI,EAAE,CAAC,GAAC,IAAE,EAAE,QAAQ,CAAC,aAAa,CAAC,CAAC,EAAC,EAAE,WAAW,CAAC,GAAE;gBAAE;gBAAC,OAAO;YAAC,GAAE,EAAE,SAAS,CAAC,WAAW,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAE,IAAI;gBAAC,EAAE,aAAa,GAAC;oBAAC,GAAE,EAAE,CAAC;oBAAC,GAAE,EAAE,CAAC;gBAAA;gBAAE,IAAI,IAAE,EAAE,OAAO,CAAC,QAAQ,GAAC,MAAK,IAAE,CAAC;gBAAE,EAAE,KAAK,GAAC,EAAE,cAAa;oBAAC;iBAAY,EAAC;gBAAG,IAAI,IAAE;oBAAC,OAAM,CAAC;gBAAC;gBAAE,EAAE,KAAK,GAAC;oBAAC,WAAU,eAAa,EAAE,aAAa,CAAC,CAAC,GAAC,QAAM,EAAE,aAAa,CAAC,CAAC,GAAC;gBAAK,GAAE,EAAE,WAAW,CAAC,IAAG,EAAE,WAAW,CAAC,IAAG,EAAE,WAAW,GAAC,WAAW;oBAAW,cAAY,OAAO,KAAG,EAAE,IAAI,CAAC,IAAG,EAAE,YAAY;gBAAE,GAAE,EAAE,OAAO,CAAC,QAAQ;YAAC,GAAE,EAAE,SAAS,CAAC,YAAY,GAAC;gBAAW,IAAI,IAAE,CAAC;gBAAE,EAAE,KAAK,GAAC,EAAE,cAAa,QAAO,KAAI,IAAI,CAAC,WAAW,CAAC,IAAG,IAAI,CAAC,OAAO,CAAC,UAAS,IAAI,CAAC,QAAQ;YAAC,GAAE,EAAE,SAAS,CAAC,cAAc,GAAC;gBAAW,IAAI,CAAC,SAAS,GAAC;oBAAC,GAAE,CAAC;oBAAE,GAAE,CAAC;oBAAE,OAAM,CAAC;gBAAC;YAAC,GAAE,EAAE,SAAS,CAAC,gBAAgB,GAAC,SAAS,CAAC;gBAAE,IAAI,GAAE,GAAE,GAAE,IAAE,EAAE,KAAK,CAAC,MAAM,EAAC,IAAE,KAAK,EAAE,GAAC,GAAE,IAAE,KAAK,EAAE,GAAC;gBAAE,IAAG,IAAE,KAAG,IAAE,IAAE,KAAG,CAAC,EAAE,KAAK,GAAC,IAAE,OAAK,IAAE,CAAC,KAAG,KAAG,KAAG,CAAC,EAAE,KAAK,GAAC,IAAE,SAAO,IAAE,IAAE,CAAC,KAAG,KAAG,CAAC,KAAG,CAAC,EAAE,KAAK,GAAC,IAAE,SAAO,EAAE,KAAK,IAAG,CAAA,IAAE,OAAM,GAAG,EAAE,KAAK,IAAG,CAAA,IAAE,IAAE,CAAC,KAAG,IAAE,IAAE,SAAO,OAAM,GAAG,EAAE,KAAK,IAAG,CAAA,IAAE,IAAE,IAAE,OAAK,MAAK,GAAG,EAAE,KAAK,GAAC,IAAI,CAAC,OAAO,CAAC,SAAS,EAAC;oBAAC,IAAI,GAAE,IAAE,CAAC;oBAAE,IAAI,KAAK,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAK,CAAA,CAAC,CAAC,EAAE,GAAC,IAAI,CAAC,SAAS,CAAC,EAAE,AAAD;oBAAG,IAAI,IAAE,CAAC;oBAAE,IAAI,KAAK,IAAI,CAAC,SAAS,GAAC;wBAAC,GAAE;wBAAE,GAAE;wBAAE,OAAM;oBAAC,GAAE,EAAE,SAAS,GAAC,IAAI,CAAC,SAAS,EAAC,EAAE,CAAC,CAAC,EAAE,KAAG,IAAI,CAAC,SAAS,CAAC,EAAE,IAAG,CAAA,CAAC,CAAC,EAAE,GAAC,CAAC,CAAA;oBAAG,IAAG,EAAE,CAAC,IAAE,EAAE,CAAC,IAAE,EAAE,KAAK,EAAC,OAAO;oBAAE,EAAE,CAAC,IAAE,EAAE,CAAC,IAAE,IAAI,CAAC,OAAO,CAAC,SAAQ,IAAG,EAAE,CAAC,IAAE,IAAI,CAAC,OAAO,CAAC,WAAS,GAAE,IAAG,EAAE,CAAC,IAAE,IAAI,CAAC,OAAO,CAAC,WAAS,GAAE,IAAG,EAAE,KAAK,IAAE,IAAI,CAAC,OAAO,CAAC,aAAW,GAAE;gBAAE,OAAM,IAAI,CAAC,cAAc;gBAAG,OAAO;YAAC;YAAE,IAAI,IAAE;YAAE,SAAS,EAAE,CAAC,EAAC,CAAC;gBAAE,IAAI,CAAC,OAAO,GAAC,EAAE,EAAC,IAAI,CAAC,KAAK,GAAC,EAAE,EAAC,IAAI,CAAC,OAAO,GAAC,EAAE,EAAC,IAAI,CAAC,GAAG,GAAC,EAAE,EAAC,IAAI,CAAC,iBAAiB,GAAC,CAAC,GAAE,IAAI,CAAC,OAAO,GAAC,GAAE,IAAI,CAAC,EAAE,GAAC,EAAE,EAAE,EAAC,EAAE,EAAE,IAAE,GAAE,IAAI,CAAC,QAAQ,GAAC;oBAAC,MAAK,SAAS,IAAI;oBAAC,YAAW,CAAC;oBAAE,oBAAmB;oBAAG,MAAK;oBAAU,UAAS;wBAAC,KAAI;wBAAE,MAAK;oBAAC;oBAAE,eAAc;oBAAI,MAAK;oBAAI,WAAU;oBAAG,OAAM;oBAAQ,UAAS;oBAAI,UAAS,CAAC;oBAAE,cAAa,CAAC;oBAAE,aAAY;oBAAG,OAAM,CAAC;oBAAE,OAAM,CAAC;oBAAE,OAAM;oBAAS,aAAY,CAAC;oBAAE,QAAO,CAAC;gBAAC,GAAE,IAAI,CAAC,MAAM,CAAC,IAAG,aAAW,IAAI,CAAC,OAAO,CAAC,IAAI,IAAE,WAAS,IAAI,CAAC,OAAO,CAAC,IAAI,IAAG,CAAA,IAAI,CAAC,OAAO,CAAC,UAAU,GAAC,CAAC,CAAA,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,IAAG,CAAA,IAAI,CAAC,OAAO,CAAC,kBAAkB,GAAC,CAAA;gBAAG,IAAI,IAAE,iBAAiB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa;gBAAE,OAAO,KAAG,WAAS,EAAE,OAAO,IAAG,CAAA,IAAI,CAAC,YAAY,GAAC,CAAC,CAAA,GAAG,IAAI,CAAC,SAAS,IAAG,IAAI,CAAC,cAAc,IAAG,IAAI,CAAC,QAAQ,IAAG,IAAI,CAAC,KAAK,IAAG,IAAI,CAAC,OAAO;YAAA;YAAC,EAAE,SAAS,GAAC,IAAI,GAAE,EAAE,WAAW,GAAC,GAAE,EAAE,EAAE,GAAC,GAAE,EAAE,SAAS,CAAC,cAAc,GAAC;gBAAW,IAAI,IAAE,IAAI,CAAC,OAAO;gBAAC,EAAE,EAAE,GAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAE,EAAE,GAAG,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,GAAE,EAAE,OAAO,GAAC,IAAI,CAAC,OAAO,EAAC,EAAE,OAAO,GAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,GAAE,EAAE,GAAG,GAAC,IAAI,CAAC,GAAG,EAAC,EAAE,EAAE,GAAC,IAAI,CAAC,EAAE,EAAC,EAAE,aAAa,GAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,GAAE,EAAE,YAAY,GAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,GAAE,EAAE,GAAG,GAAC,SAAS,CAAC;oBAAE,IAAG,KAAK,MAAI,GAAE,OAAO,CAAC,CAAC,EAAE;oBAAC,IAAI,IAAI,IAAE,GAAE,IAAE,EAAE,MAAM,EAAC,IAAE,GAAE,KAAG,EAAE,IAAG,CAAC,CAAC,EAAE,CAAC,UAAU,KAAG,GAAE,OAAO,CAAC,CAAC,EAAE;oBAAC,OAAM,CAAC;gBAAC;YAAC,GAAE,EAAE,SAAS,CAAC,QAAQ,GAAC;gBAAW,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAC,UAAS,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,GAAC,QAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,GAAC;YAAM,GAAE,EAAE,SAAS,CAAC,KAAK,GAAC;gBAAW,IAAI,IAAE,IAAI,CAAC,OAAO;gBAAC,IAAG,aAAW,EAAE,IAAI,EAAC;oBAAC,IAAI,IAAE,IAAI,CAAC,YAAY,CAAC,EAAE,QAAQ,EAAC,IAAI,CAAC,OAAO,CAAC,aAAa;oBAAI,EAAE,GAAG,IAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;gBAAE;YAAC,GAAE,EAAE,SAAS,CAAC,YAAY,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAE,IAAI,CAAC,OAAO,CAAC,MAAM,EAAC,IAAE,CAAC,GAAE,IAAE,IAAI,CAAC,OAAO,EAAC,IAAE,IAAI,CAAC,YAAY,GAAC,EAAE,CAAC,GAAC,EAAE,CAAC,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAC,IAAE,IAAI,CAAC,YAAY,GAAC,EAAE,CAAC,GAAC,EAAE,CAAC,GAAC,IAAI,CAAC,GAAG,CAAC,GAAG;gBAAC,IAAG,EAAE,CAAC,IAAE,EAAE,CAAC,EAAC,IAAE;oBAAC,GAAE,EAAE,CAAC,GAAC;oBAAE,GAAE,EAAE,CAAC,GAAC;gBAAC;qBAAO,IAAG,EAAE,GAAG,IAAE,EAAE,KAAK,IAAE,EAAE,MAAM,IAAE,EAAE,IAAI,EAAC;oBAAC,IAAI,IAAE,SAAS,aAAa,CAAC;oBAAO,EAAE,KAAK,CAAC,OAAO,GAAC,UAAS,EAAE,KAAK,CAAC,GAAG,GAAC,EAAE,GAAG,EAAC,EAAE,KAAK,CAAC,KAAK,GAAC,EAAE,KAAK,EAAC,EAAE,KAAK,CAAC,MAAM,GAAC,EAAE,MAAM,EAAC,EAAE,KAAK,CAAC,IAAI,GAAC,EAAE,IAAI,EAAC,EAAE,KAAK,CAAC,QAAQ,GAAC,YAAW,EAAE,IAAI,CAAC,WAAW,CAAC;oBAAG,IAAI,IAAE,EAAE,qBAAqB;oBAAG,EAAE,IAAI,CAAC,WAAW,CAAC,IAAG,IAAE,GAAE,IAAE;wBAAC,GAAE,EAAE,IAAI,GAAC,EAAE,CAAC;wBAAC,GAAE,EAAE,GAAG,GAAC,EAAE,CAAC;oBAAA;gBAAC;gBAAC,IAAI,IAAE,IAAI,EAAE,IAAI,EAAC;oBAAC,OAAM,EAAE,KAAK;oBAAC,MAAK,EAAE,IAAI;oBAAC,WAAU,EAAE,SAAS;oBAAC,UAAS,EAAE,QAAQ;oBAAC,UAAS,EAAE,QAAQ;oBAAC,cAAa,EAAE,YAAY;oBAAC,aAAY,EAAE,WAAW;oBAAC,MAAK,EAAE,IAAI;oBAAC,YAAW;oBAAE,UAAS;oBAAE,MAAK,EAAE,IAAI;oBAAC,eAAc;wBAAC,GAAE;wBAAE,GAAE;oBAAC;oBAAE,OAAM,EAAE,KAAK;gBAAA;gBAAG,OAAO,EAAE,QAAQ,IAAG,CAAA,EAAE,EAAE,EAAE,CAAC,EAAE,EAAC,IAAG,EAAE,EAAE,EAAE,CAAC,KAAK,EAAC,EAAE,aAAa,CAAA,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAG,IAAI,CAAC,OAAO,CAAC,WAAS,EAAE,UAAU,GAAC,UAAS,IAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,WAAS,EAAE,UAAU,GAAC,UAAS,IAAG,IAAI,CAAC,UAAU,CAAC,IAAG;YAAC,GAAE,EAAE,SAAS,CAAC,SAAS,GAAC;gBAAW,IAAI,CAAC,GAAG,GAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,qBAAqB;YAAE,GAAE,EAAE,SAAS,CAAC,UAAU,GAAC,SAAS,CAAC;gBAAE,IAAI,GAAE,IAAE,IAAI,EAAC,IAAE,SAAS,CAAC,EAAC,CAAC;oBAAE,IAAE,EAAE,IAAI,GAAC,MAAI,EAAE,EAAE,GAAC,MAAI,EAAE,IAAI,EAAC,EAAE,OAAO,CAAC,GAAE;gBAAE;gBAAE,EAAE,EAAE,CAAC,aAAY,EAAE,WAAW,CAAC,IAAI,CAAC,KAAI,EAAE,EAAE,CAAC,iCAAgC,IAAG,EAAE,EAAE,CAAC,sCAAqC,IAAG,EAAE,EAAE,CAAC,8CAA6C;YAAE,GAAE,EAAE,SAAS,CAAC,UAAU,GAAC,SAAS,CAAC,EAAC,CAAC,EAAC,CAAC;gBAAE,IAAI,IAAE,IAAI,EAAC,IAAE;gBAAE,cAAc,EAAE,iBAAiB,CAAC,EAAE,GAAE,EAAE,iBAAiB,CAAC,EAAE,GAAC,YAAY,CAAA;oBAAW,IAAI,IAAE,EAAE,KAAK,IAAE,EAAE,QAAQ,IAAE,EAAE,WAAW,IAAE;oBAAE,MAAI,KAAI,CAAA,EAAE,OAAO,CAAC,YAAW,IAAG,EAAE,OAAO,CAAC,cAAY,EAAE,UAAU,GAAC,aAAY,IAAG,IAAE,CAAA;gBAAE,CAAA,EAAE,IAAI,CAAC,IAAG;YAAI,GAAE,EAAE,SAAS,CAAC,OAAO,GAAC,SAAS,CAAC;gBAAE,IAAI,IAAE,IAAI,EAAC,IAAE,EAAE,OAAO,EAAC,IAAE;gBAAE,IAAE,EAAE,IAAG,EAAE,SAAS;gBAAG,OAAO,EAAE,GAAE,SAAS,CAAC;oBAAE,EAAE,OAAO,CAAC,MAAM,GAAC,EAAE,kBAAkB,GAAC,EAAE,cAAc,CAAC,KAAG,EAAE,IAAI,CAAC,KAAK,CAAC,aAAY,CAAA,OAAO,IAAI,CAAC,EAAE,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,SAAS,CAAC;wBAAE,IAAG,OAAO,MAAM,CAAC,EAAE,OAAO,EAAE,SAAS,CAAC,SAAS,CAAC;4BAAE,OAAO,EAAE,UAAU,KAAG;wBAAC,KAAG,GAAE;4BAAC,IAAI,IAAE;gCAAC,CAAC,CAAC,EAAE;6BAAC;4BAAC,EAAE,UAAU,GAAC,GAAE,EAAE,YAAY,CAAC;wBAAE;oBAAC,IAAG,EAAE,OAAO,CAAC,MAAM,GAAC,EAAE,kBAAkB,IAAE,EAAE,cAAc,CAAC,EAAC;gBAAE,IAAG,EAAE,OAAO,CAAC,YAAY,IAAG,CAAC;YAAC,GAAE,EAAE,SAAS,CAAC,cAAc,GAAC,SAAS,CAAC;gBAAE,IAAI,GAAE,IAAE,IAAI,EAAC,IAAE,EAAE,OAAO,EAAC,IAAE,EAAE,OAAO,CAAC,aAAa,CAAC,IAAG,IAAE,EAAE,KAAK,IAAE,EAAE,QAAQ,IAAE,EAAE,WAAW,IAAE,GAAE,IAAE;oBAAC,GAAE,EAAE,KAAK;oBAAC,GAAE,EAAE,KAAK;gBAAA,GAAE,IAAE,EAAE,WAAW,CAAC,GAAE;gBAAG,EAAE,UAAU,KAAG,KAAG,EAAE,OAAO,CAAC,gBAAgB,CAAC,EAAE,UAAU,GAAE,EAAE,UAAU,GAAC;gBAAE,IAAI,IAAE,SAAS,CAAC;oBAAE,EAAE,OAAO,CAAC,SAAQ,IAAG,EAAE,OAAO,CAAC,WAAS,EAAE,EAAE,GAAC,UAAS,IAAG,EAAE,IAAI,IAAG,IAAE,KAAG,EAAE,UAAU,CAAC,GAAE,GAAE,EAAE,UAAU,GAAE,EAAE,aAAa,CAAC;gBAAE;gBAAE,IAAG,AAAC,CAAA,IAAE,EAAE,KAAK,CAAC,OAAO,CAAC,EAAC,KAAI,KAAG,EAAE,KAAK,CAAC,MAAM,CAAC,GAAE,IAAG,EAAE,OAAO,CAAC,IAAI,CAAC,IAAG,EAAE,GAAG,CAAC,IAAI,CAAC,EAAE,UAAU,GAAE,WAAS,EAAE,IAAI,EAAC,EAAE;qBAAO;oBAAC,IAAG,CAAE,CAAA,EAAE,GAAE,EAAE,QAAQ,KAAG,EAAE,aAAa,AAAD,GAAG,OAAO,EAAE,OAAO,IAAG,KAAK,EAAE,cAAc,CAAC;oBAAG,EAAE;gBAAE;gBAAC,OAAO;YAAC,GAAE,EAAE,SAAS,CAAC,WAAW,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,GAAE,IAAE,IAAI,CAAC,OAAO;gBAAC,OAAM,gBAAgB,IAAI,CAAC,EAAE,IAAI,IAAE,AAAC,CAAA,IAAE,IAAI,CAAC,KAAK,CAAC,EAAE,AAAD,IAAI,CAAA,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAE,IAAG,CAAA,IAAG,WAAS,EAAE,IAAI,GAAC,IAAI,CAAC,YAAY,CAAC,GAAE,KAAI,CAAA,QAAQ,IAAI,CAAC,qCAAoC,CAAC,CAAA,IAAG,IAAE,IAAI,CAAC,YAAY,CAAC,GAAE;YAAE,GAAE,EAAE,SAAS,CAAC,aAAa,GAAC,SAAS,CAAC;gBAAE,IAAI,IAAE,IAAI,CAAC,OAAO,EAAC,IAAE,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,IAAG,IAAE,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAG,IAAE,IAAI,CAAC,OAAO,CAAC,MAAM;gBAAC,IAAG,SAAS,CAAC;oBAAE,OAAO,MAAM,EAAE,OAAO,IAAE,MAAI,EAAE,QAAQ,GAAC,MAAI,EAAE,OAAO;gBAAA,EAAE,IAAG;oBAAC,IAAG,CAAC,GAAE,OAAO,QAAQ,KAAK,CAAC,mCAAiC,IAAG,KAAK,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC;oBAAG,IAAG,EAAE,WAAW,EAAC;wBAAC,IAAI,IAAE,EAAE,EAAE,CAAC,qBAAqB;wBAAG,EAAE,QAAQ,GAAC;4BAAC,GAAE,EAAE,CAAC,GAAC,EAAE,IAAI;4BAAC,GAAE,EAAE,CAAC,GAAC,EAAE,GAAG;wBAAA;oBAAC;oBAAC,EAAE,UAAU,GAAC;oBAAE,IAAI,IAAE,EAAE,OAAO,CAAC,IAAI,GAAC,GAAE,IAAE;wBAAC,GAAE,EAAE,KAAK;wBAAC,GAAE,EAAE,KAAK;oBAAA;oBAAE,EAAE,KAAK,IAAG,CAAA,EAAE,CAAC,GAAC,EAAE,QAAQ,CAAC,CAAC,AAAD,GAAG,EAAE,KAAK,IAAG,CAAA,EAAE,CAAC,GAAC,EAAE,QAAQ,CAAC,CAAC,AAAD;oBAAG,IAAI,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,IAAE,EAAE,GAAE,EAAE,QAAQ,GAAE,IAAG,CAAA,IAAE,GAAE,IAAE,EAAE,QAAQ,EAAC,IAAE,EAAE,CAAC,GAAC,EAAE,CAAC,EAAC,IAAE,EAAE,CAAC,GAAC,EAAE,CAAC,EAAC,EAAE,KAAK,KAAK,CAAC,GAAE,GAAE,GAAG,IAAE,EAAE,IAAG,IAAE,IAAE,GAAE,IAAE;wBAAC,UAAS;wBAAE,UAAS;oBAAC;oBAAE,IAAG,aAAW,EAAE,OAAO,CAAC,KAAK,GAAE,CAAA,IAAE,KAAK,GAAG,CAAC,GAAE,IAAG,IAAE,EAAE,QAAQ,EAAC,IAAE,GAAE,IAAE;wBAAC,GAAE;wBAAE,GAAE;oBAAC,GAAE,IAAE,EAAE,IAAE,IAAG,EAAE,CAAC,GAAC,EAAE,CAAC,GAAC,IAAE,KAAK,GAAG,CAAC,IAAG,EAAE,CAAC,GAAC,EAAE,CAAC,GAAC,IAAE,KAAK,GAAG,CAAC,IAAG,IAAE,CAAA,IAAI,CAAA,IAAE,SAAS,CAAC,EAAC,CAAC,EAAC,CAAC;wBAAE,OAAM;4BAAC,GAAE,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,EAAC,EAAE,CAAC,GAAC,IAAG,EAAE,CAAC,GAAC;4BAAG,GAAE,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,EAAC,EAAE,CAAC,GAAC,IAAG,EAAE,CAAC,GAAC;wBAAE;oBAAC,EAAE,GAAE,EAAE,QAAQ,EAAC,IAAG,IAAE,EAAE,GAAE,EAAE,QAAQ,CAAA,GAAG,EAAE,MAAM,EAAE;wBAAA,IAAG,IAAE,GAAE;4BAAC,IAAI,IAAE,EAAE,CAAC,GAAC,EAAE,CAAC,EAAC,IAAE,EAAE,CAAC,GAAC,EAAE,CAAC;4BAAC,EAAE,QAAQ,CAAC,CAAC,IAAE,GAAE,EAAE,QAAQ,CAAC,CAAC,IAAE,GAAE,EAAE,EAAE,CAAC,KAAK,CAAC,GAAG,GAAC,EAAE,QAAQ,CAAC,CAAC,GAAE,CAAA,IAAI,CAAC,GAAG,CAAC,GAAG,GAAC,EAAE,CAAC,AAAD,IAAG,MAAK,EAAE,EAAE,CAAC,KAAK,CAAC,IAAI,GAAC,EAAE,QAAQ,CAAC,CAAC,GAAE,CAAA,IAAI,CAAC,GAAG,CAAC,IAAI,GAAC,EAAE,CAAC,AAAD,IAAG,MAAK,IAAE,EAAE,GAAE,EAAE,QAAQ;wBAAC;oBAAA,OAAO,IAAE,GAAE,IAAE;oBAAE,IAAI,IAAE,EAAE,CAAC,GAAC,EAAE,QAAQ,CAAC,CAAC,EAAC,IAAE,EAAE,CAAC,GAAC,EAAE,QAAQ,CAAC,CAAC;oBAAC,EAAE,aAAa,GAAC;wBAAC,GAAE;wBAAE,GAAE;oBAAC,GAAE,EAAE,QAAQ,IAAG,CAAA,EAAE,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,GAAC,eAAa,IAAE,QAAM,IAAE,KAAI;oBAAG,IAAI,IAAE;wBAAC,YAAW,EAAE,UAAU;wBAAC,UAAS;wBAAE,OAAM;wBAAE,UAAS,EAAE,KAAK,IAAE,EAAE,QAAQ,IAAE,EAAE,WAAW,IAAE;wBAAE,UAAS;wBAAE,OAAM;4BAAC,QAAO;4BAAE,QAAO;wBAAC;wBAAE,QAAO;4BAAC,GAAE,IAAE;4BAAE,GAAE,CAAC,IAAE;wBAAC;wBAAE,KAAI;wBAAE,UAAS;wBAAE,OAAM,EAAE,KAAK;wBAAC,OAAM,EAAE,KAAK;oBAAA;oBAAG,CAAA,IAAE,EAAE,gBAAgB,CAAC,EAAC,EAAG,KAAK,GAAC;wBAAC,QAAO,EAAE,MAAI;wBAAG,QAAO,MAAI;oBAAC,GAAE,EAAE,OAAO,CAAC,QAAO,IAAG,IAAI,CAAC,OAAO,CAAC,UAAQ,EAAE,EAAE,GAAC,SAAQ;gBAAE,OAAM,IAAI,CAAC,YAAY,CAAC;YAAE,GAAE,EAAE,SAAS,CAAC,YAAY,GAAC,SAAS,CAAC;gBAAE,IAAI,IAAE,IAAI,EAAC,IAAE,EAAE,OAAO,EAAC,IAAE,EAAE,OAAO,CAAC,aAAa,CAAC,IAAG,IAAE,EAAE,OAAO,CAAC,GAAG,CAAC,IAAG,IAAE,EAAE,OAAO,CAAC,gBAAgB,CAAC,EAAE,UAAU;gBAAE,KAAI,CAAA,EAAE,QAAQ,IAAE,EAAE,IAAI,CAAC;oBAAW,cAAY,EAAE,IAAI,IAAG,CAAA,EAAE,OAAO,CAAC,WAAU,IAAG,EAAE,OAAO,CAAC,aAAW,EAAE,EAAE,GAAC,YAAW,IAAG,EAAE,OAAO,CAAC,OAAO,CAAC,aAAW,EAAE,EAAE,GAAC,YAAW,IAAG,EAAE,OAAO,EAAC;gBAAE,IAAG,cAAc,EAAE,iBAAiB,CAAC,EAAE,UAAU,CAAC,GAAE,EAAE,cAAc,IAAG,EAAE,OAAO,CAAC,OAAM,IAAG,EAAE,OAAO,CAAC,SAAO,EAAE,EAAE,GAAC,QAAO,IAAG,EAAE,GAAG,CAAC,OAAO,CAAC,EAAE,UAAU,KAAG,KAAG,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,OAAO,CAAC,EAAE,UAAU,GAAE,IAAG,EAAE,OAAO,CAAC,OAAO,CAAC,MAAI,KAAG,EAAE,OAAO,CAAC,MAAM,CAAC,EAAE,OAAO,CAAC,OAAO,CAAC,IAAG,IAAG,gBAAgB,IAAI,CAAC,EAAE,IAAI,IAAE,EAAE,KAAK,CAAC,IAAI,CAAC,KAAG,EAAE,OAAO,CAAC,OAAO,CAAC,MAAI,KAAG,EAAE,OAAO,CAAC,MAAM,CAAC,EAAE,OAAO,CAAC,OAAO,CAAC,IAAG,IAAG,EAAE,OAAO,CAAC,cAAc,IAAG,gBAAgB,IAAI,CAAC,EAAE,IAAI,KAAI,CAAA,EAAE,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,GAAC,EAAE,UAAU,AAAD,CAAC;YAAE,GAAE,EAAE,SAAS,CAAC,WAAW,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,MAAI,KAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAG,IAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,MAAI,KAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAG,IAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAI,KAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAG,IAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,UAAU,KAAG,KAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,UAAU,GAAE,IAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,EAAE,UAAU,GAAE,IAAI,CAAC,OAAO,CAAC,cAAc;YAAE,GAAE,EAAE,SAAS,CAAC,OAAO,GAAC;gBAAW,IAAI,IAAI,KAAK,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAC,UAAS,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC;oBAAE,EAAE,OAAO;gBAAE,IAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,MAAI,cAAc,IAAI,CAAC,iBAAiB,CAAC,EAAE;gBAAE,IAAI,CAAC,OAAO,CAAC,aAAY,IAAI,CAAC,OAAO,GAAE,IAAI,CAAC,OAAO,CAAC,cAAc,IAAG,IAAI,CAAC,GAAG;YAAE;YAAE,IAAI,IAAE;YAAE,SAAS,EAAE,CAAC;gBAAE,IAAI,IAAE,IAAI;gBAAC,EAAE,GAAG,GAAC,CAAC,GAAE,EAAE,KAAK,GAAC,GAAE,EAAE,WAAW,GAAC,EAAE,EAAC,EAAE,MAAM,GAAC,KAAI,EAAE,MAAM,CAAC,IAAG,EAAE,kBAAkB;gBAAG,IAAI,IAAE;oBAAW,IAAI;oBAAE,EAAE,WAAW,CAAC,OAAO,CAAC,SAAS,CAAC;wBAAE,EAAE,OAAO,CAAC,SAAS,CAAC;4BAAE,IAAE,EAAE,EAAE,CAAC,qBAAqB,IAAG,EAAE,QAAQ,GAAC;gCAAC,GAAE,EAAE,MAAM,CAAC,CAAC,GAAC,EAAE,IAAI;gCAAC,GAAE,EAAE,MAAM,CAAC,CAAC,GAAC,EAAE,GAAG;4BAAA;wBAAC;oBAAE;gBAAE;gBAAE,EAAE,QAAO,UAAS;oBAAW,EAAE;gBAAE;gBAAG,IAAI,IAAE;oBAAW,EAAE,MAAM,GAAC;gBAAG;gBAAE,OAAO,EAAE,QAAO,UAAS;oBAAW,EAAE;gBAAE,IAAG,EAAE,WAAW;YAAA;YAAC,EAAE,SAAS,GAAC,IAAI,GAAE,EAAE,WAAW,GAAC,GAAE,EAAE,SAAS,CAAC,kBAAkB,GAAC;gBAAW,IAAI,IAAE,IAAI;gBAAC,EAAE,WAAW,CAAC,MAAM,GAAC,EAAE,MAAM,CAAC,IAAI,CAAC,IAAG,EAAE,WAAW,CAAC,EAAE,GAAC,EAAE,EAAE,CAAC,IAAI,CAAC,IAAG,EAAE,WAAW,CAAC,GAAG,GAAC,EAAE,GAAG,CAAC,IAAI,CAAC,IAAG,EAAE,WAAW,CAAC,OAAO,GAAC,EAAE,OAAO,CAAC,IAAI,CAAC,IAAG,EAAE,WAAW,CAAC,GAAG,GAAC,SAAS,CAAC;oBAAE,IAAI;oBAAE,OAAO,EAAE,WAAW,CAAC,KAAK,CAAC,SAAS,CAAC;wBAAE,OAAM,CAAE,CAAA,IAAE,EAAE,GAAG,CAAC,EAAC;oBAAE,IAAG;gBAAC;YAAC,GAAE,EAAE,SAAS,CAAC,MAAM,GAAC,SAAS,CAAC;gBAAE,OAAO,IAAI,CAAC,gBAAgB,CAAC;YAAE,GAAE,EAAE,SAAS,CAAC,gBAAgB,GAAC,SAAS,CAAC;gBAAE,IAAI,IAAE,IAAI,EAAE,IAAI,EAAC;gBAAG,OAAO,IAAI,CAAC,cAAc,CAAC,IAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAG;YAAC,GAAE,EAAE,SAAS,CAAC,cAAc,GAAC,SAAS,CAAC;gBAAE,IAAI,GAAE,IAAE,IAAI,EAAC,IAAE,SAAS,CAAC,EAAC,CAAC;oBAAE,IAAE,EAAE,IAAI,GAAC,MAAI,EAAE,EAAE,GAAC,MAAI,EAAE,IAAI,EAAC,EAAE,OAAO,CAAC,GAAE;gBAAE;gBAAE,EAAE,EAAE,CAAC,aAAY,EAAE,WAAW,CAAC,IAAI,CAAC,KAAI,EAAE,EAAE,CAAC,iCAAgC,IAAG,EAAE,EAAE,CAAC,sCAAqC,IAAG,EAAE,EAAE,CAAC,8CAA6C;YAAE,GAAE,EAAE,SAAS,CAAC,YAAY,GAAC;gBAAW,IAAI,CAAC,MAAM,IAAG,CAAA,IAAI,CAAC,OAAO,CAAC,UAAS,QAAQ,OAAO,CAAC,UAAS,QAAO,IAAI,CAAC,MAAM,GAAC,CAAC,CAAA;YAAE,GAAE,EAAE,SAAS,CAAC,cAAc,GAAC,SAAS,CAAC;gBAAE,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,IAAE,CAAC,MAAI,KAAI,CAAA,IAAI,CAAC,SAAS,CAAC,UAAS,QAAQ,SAAS,CAAC,UAAS,QAAO,IAAI,CAAC,MAAM,GAAC,CAAC,CAAA;YAAE,GAAE,EAAE,SAAS,CAAC,aAAa,GAAC,SAAS,CAAC;gBAAE,IAAI;gBAAE,OAAO,IAAE,KAAK,MAAK,CAAA,IAAE,KAAK,MAAI,EAAE,UAAU,GAAC,EAAE,SAAS,GAAC,EAAE,UAAU,AAAD,KAAK,CAAA,IAAE,IAAI,CAAC,MAAM,IAAE,CAAA,IAAG,IAAE,IAAI,CAAC,KAAK,EAAC,KAAK,MAAI,IAAI,CAAC,GAAG,CAAC,EAAE,IAAG,CAAA,IAAI,CAAC,GAAG,CAAC,EAAE,GAAC,IAAI,CAAC,KAAK,EAAC,IAAI,CAAC,KAAK,IAAE,CAAA,GAAG,IAAI,CAAC,MAAM,GAAC,GAAE,IAAI,CAAC,GAAG,CAAC,EAAE;YAAA,GAAE,EAAE,SAAS,CAAC,gBAAgB,GAAC,SAAS,CAAC;gBAAE,IAAI,IAAE,CAAC;gBAAE,IAAI,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,IAAG,IAAI,CAAC,GAAG,CAAC,EAAE,KAAG,GAAE;oBAAC,EAAE,EAAE,GAAC,GAAE,EAAE,UAAU,GAAC,IAAI,CAAC,GAAG,CAAC,EAAE,EAAC,OAAO,IAAI,CAAC,GAAG,CAAC,EAAE;oBAAC;gBAAK;gBAAC,OAAO;YAAC,GAAE,EAAE,SAAS,CAAC,MAAM,GAAC,SAAS,CAAC;gBAAE,OAAO,IAAI,CAAC,KAAK,CAAC,QAAO,IAAG,CAAC;YAAC,GAAE,EAAE,SAAS,CAAC,KAAK,GAAC,SAAS,CAAC;gBAAE,OAAO,IAAI,CAAC,KAAK,CAAC,OAAM,IAAG,CAAC;YAAC,GAAE,EAAE,SAAS,CAAC,QAAQ,GAAC,SAAS,CAAC;gBAAE,OAAO,IAAI,CAAC,KAAK,CAAC,OAAM,IAAG,CAAC;YAAC,GAAE,EAAE,SAAS,CAAC,KAAK,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAI,GAAE,IAAE,IAAI,EAAC,IAAE,cAAY,EAAE,MAAM,CAAC,GAAG,WAAW,KAAG,EAAE,KAAK,CAAC;gBAAG,IAAE,EAAE;gBAAG,OAAO,EAAE,GAAE,SAAS,CAAC;oBAAE,IAAE,EAAE,aAAa,CAAC,IAAG,EAAE,EAAE,WAAW,EAAC,CAAA,SAAS,CAAC,EAAC,CAAC,EAAC,CAAC;wBAAE,EAAE,GAAG,CAAC,OAAO,CAAC,MAAI,KAAI,CAAA,CAAC,CAAC,EAAE,CAAC,IAAG,EAAE,OAAO,GAAC,CAAC,CAAA;oBAAE,CAAA,EAAE,IAAI,CAAC,MAAK,GAAE,KAAI,EAAE,OAAO,IAAE,EAAE,gBAAgB,CAAC;gBAAE,IAAG,CAAC;YAAC,GAAE,EAAE,SAAS,CAAC,OAAO,GAAC;gBAAW,IAAI,CAAC,cAAc,CAAC,CAAC,IAAG,IAAI,CAAC,GAAG,GAAC,CAAC,GAAE,IAAI,CAAC,KAAK,GAAC,GAAE,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,SAAS,CAAC;oBAAE,EAAE,OAAO;gBAAE,IAAG,IAAI,CAAC,GAAG;YAAE,GAAE,EAAE,SAAS,CAAC,WAAW,GAAC,SAAS,CAAC,EAAC,CAAC;gBAAE,IAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,KAAG,GAAE,OAAM,CAAC;gBAAE,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAG;YAAE;YAAE,IAAI,IAAE,IAAI;YAAE,EAAE,OAAO,GAAC;gBAAC,QAAO,SAAS,CAAC;oBAAE,OAAO,EAAE,MAAM,CAAC;gBAAE;gBAAE,SAAQ;YAAC;QAAC;KAAE,EAAE,OAAO;AAAA","sources":["node_modules/@parcel/runtime-browser-hmr/lib/runtime-ff702b7428eb86be.js","src/main.ts","node_modules/excalibur/build/dist/excalibur.min.js","node_modules/excalibur/build/dist/webpack:/ex/webpack/universalModuleDefinition","node_modules/excalibur/build/dist/webpack:/ex/Director/Loader.css","node_modules/excalibur/build/dist/webpack:/ex/Util/Toaster.css","node_modules/excalibur/build/dist/node_modules/css-loader/dist/runtime/api.js","node_modules/excalibur/build/dist/node_modules/css-loader/dist/runtime/sourceMaps.js","node_modules/excalibur/build/dist/webpack:/ex/webpack/bootstrap","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/compat get default export","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/define property getters","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/hasOwnProperty shorthand","node_modules/excalibur/build/dist/webpack:/ex/webpack/runtime/make namespace object","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerScope.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/rotation-type.ts","node_modules/excalibur/build/dist/webpack:/ex/Polyfill.ts","node_modules/excalibur/build/dist/webpack:/ex/Flags.ts","node_modules/excalibur/build/dist/webpack:/ex/Id.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Future.ts","node_modules/excalibur/build/dist/webpack:/ex/EventEmitter.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/Random.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/util.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/vector.ts","node_modules/excalibur/build/dist/webpack:/ex/Color.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Log.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Side.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/matrix.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/BoundingBox.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Util.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/affine-matrix.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/RentalPool.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/transform-stack.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/state-stack.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Resource.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Watch.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Graphic.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Sprite.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Filtering.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Wrapping.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/texture-loader.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/ImageSource.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/SpriteFont.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/TiledSprite.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/SpriteSheet.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-text.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-font.png","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/render-source.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/render-target.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-util.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/shader.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-buffer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-layout.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsDiagnostics.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-vertex.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-vertex.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-pass-painter.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-vertex.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/quad-index-buffer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.frag.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.vert.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.frag.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.vert.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.frag.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.vert.glsl","node_modules/excalibur/build/dist/webpack:/ex/Util/Pool.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/draw-call.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/material.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/material-renderer/material-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/coord-plane.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Animation.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/vector-view.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/watch-vector.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/transform.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Component.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Observable.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/TransformComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsGroup.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Raster.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/FontCommon.ts","node_modules/excalibur/build/dist/webpack:/ex/Events.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/DrawUtil.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/FontTextInstance.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/FontCache.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Font.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Text.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Entity.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/MotionComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Integrator.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/Particles.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/particle-renderer/particle-renderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/particle-renderer/particle-vertex.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/particle-renderer/particle-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer-v2/image-renderer-v2.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer-v2/image-renderer-v2.frag.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer-v2/image-renderer-v2.vert.glsl","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContextWebGL.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","node_modules/excalibur/build/dist/webpack:/ex/Screen.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/AudioContext.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/WebAudio.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Canvas.ts","node_modules/excalibur/build/dist/webpack:/ex/Interfaces/AudioImplementation.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/StateMachine.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/WebAudioInstance.ts","node_modules/excalibur/build/dist/webpack:/ex/Events/MediaEvents.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Sound.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Sound/Sound.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/DefaultLoader.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Loader.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Loader.logo.png","node_modules/excalibur/build/dist/webpack:/ex/Util/Detector.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/CollisionType.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/SolverStrategy.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/ContactBias.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroupManager.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroup.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/Pair.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/projection.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTree.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/ray.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTreeCollisionProcessor.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/Collider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/SpatialPartitionStrategy.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/PhysicsConfig.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CompositeCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/line-segment.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/ClosestLineJumpTable.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CircleCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/CollisionContact.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/SeparatingAxis.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/CollisionJumpTable.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/EdgeCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Debug.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/PolygonCollider.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Colliders/Shape.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/ColliderComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/BodyComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Rectangle.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Circle.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/EasingFunctions.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionQueue.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Repeat.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RepeatForever.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/lerp.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/MoveBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/MoveTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RotateTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/RotateBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/CallMethod.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/EaseTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/EaseBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Blink.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Fade.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Delay.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Die.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Follow.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Meet.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/Flash.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/bezier-curve.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/CurveTo.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/CurveBy.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionContext.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionsComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Actor.ts","node_modules/excalibur/build/dist/webpack:/ex/ScreenElement.ts","node_modules/excalibur/build/dist/webpack:/ex/Timer.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/ParallaxComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/DebugGraphicsComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerEventsToObjectDispatcher.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap/TileMap.ts","node_modules/excalibur/build/dist/webpack:/ex/Camera.ts","node_modules/excalibur/build/dist/webpack:/ex/Trigger.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Priority.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/System.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/EntityManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Query.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/TagQuery.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/QueryManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/SystemManager.ts","node_modules/excalibur/build/dist/webpack:/ex/EntityComponentSystem/World.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/MotionSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/ArcadeSolver.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/ContactConstraintPoint.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Solver/RealisticSolver.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/CollisionSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/TransformInterpolation.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/GraphicsSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Debug/DebugSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/SparseHashGrid.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/ActionsSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntityComponent.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntitySystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/OffscreenSystem.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/SparseHashGridCollisionProcessor.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/PhysicsWorld.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/Gamepad.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/Keyboard.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/InputMapper.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/IFrame.ts","node_modules/excalibur/build/dist/webpack:/ex/Math/global-coordinates.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerEvent.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/WheelEvent.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerAbstraction.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/WheelDeltaMode.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/NativePointerButton.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerButton.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerType.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/PointerEventReceiver.ts","node_modules/excalibur/build/dist/webpack:/ex/Input/InputHost.ts","node_modules/excalibur/build/dist/webpack:/ex/Scene.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessMode.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ScreenShader.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessPostProcessor.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/color-blind-fragment.glsl","node_modules/excalibur/build/dist/webpack:/ex/Debug/DebugFlags.ts","node_modules/excalibur/build/dist/webpack:/ex/Debug/DebugConfig.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Browser.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContext.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Fps.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Clock.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Toaster.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Director.ts","node_modules/excalibur/build/dist/webpack:/ex/Context.ts","node_modules/excalibur/build/dist/webpack:/ex/GarbageCollector.ts","node_modules/excalibur/build/dist/webpack:/ex/Engine.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/EmitterType.ts","node_modules/excalibur/build/dist/webpack:/ex/Label.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/ParticleEmitter.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Assert.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/GpuParticleRenderer.ts","node_modules/excalibur/build/dist/webpack:/ex/Particles/GpuParticleEmitter.ts","node_modules/excalibur/build/dist/webpack:/ex/TileMap/IsometricMap.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ActionSequence.ts","node_modules/excalibur/build/dist/webpack:/ex/Actions/Action/ParallelActions.ts","node_modules/excalibur/build/dist/webpack:/ex/Collision/Detection/QuadTree.ts","node_modules/excalibur/build/dist/webpack:/ex/Interfaces/LifecycleEvents.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Gif.ts","node_modules/excalibur/build/dist/webpack:/ex/Resources/Font.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Coroutine.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Transition.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/FadeInOut.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/CrossFade.ts","node_modules/excalibur/build/dist/webpack:/ex/Director/Slide.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Line.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/Polygon.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/NineSlice.ts","node_modules/excalibur/build/dist/webpack:/ex/Graphics/TiledAnimation.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Decorators.ts","node_modules/excalibur/build/dist/webpack:/ex/Util/Semaphore.ts","node_modules/excalibur/build/dist/webpack:/ex/index.ts","src/resources.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/excalibur-tiled.min.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/webpack/universalModuleDefinition","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/index.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/deflate.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/inflate.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/utils/common.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/utils/strings.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/adler32.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/constants.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/crc32.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/deflate.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/gzheader.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/inffast.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/inflate.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/inftrees.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/messages.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/trees.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/pako/lib/zlib/zstream.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/external umd {\"commonjs\":\"excalibur\",\"commonjs2\":\"excalibur\",\"amd\":\"excalibur\",\"root\":\"ex\"}","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/external umd {\"commonjs\":\"jsdom\",\"commonjs2\":\"jsdom\",\"amd\":\"jsdom\",\"umd\":\"jsdom\",\"root\":\"jsdom\"}","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/webpack/bootstrap","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/webpack/runtime/define property getters","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/webpack/runtime/hasOwnProperty shorthand","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/webpack/runtime/make namespace object","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/zod/lib/index.mjs","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/parser/tiled-parser.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/zstddec/dist/zstddec.modern.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/decoder.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/excalibur-properties.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/file-loader.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/filter-util.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/gid-util.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/loader-cache.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/properties.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/path-util.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/objects.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/template.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/tileset.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/tileset-resource.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/template-resource.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/tiled-data-component.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/tiled-layer-component.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/iso-tile-layer.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/tile-layer.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/object-layer.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/compare-versions/lib/esm/utils.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/compare-versions/lib/esm/compare.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/node_modules/compare-versions/lib/esm/compareVersions.js","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/image-layer.ts","node_modules/@excaliburjs/plugin-tiled/build/umd/webpack:/ex.Plugin.Tiled/src/resource/tiled-resource.ts","node_modules/buffer/index.js","node_modules/base64-js/index.js","node_modules/ieee754/index.js","node_modules/@parcel/node-resolver-core/lib/_empty.js","node_modules/@parcel/runtime-js/lib/runtime-c46e6b3f39aa4cd0.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","node_modules/@parcel/runtime-js/lib/runtime-2ddbc3d09e3545cf.js","node_modules/@parcel/runtime-js/lib/runtime-a23fb5b0c98afee6.js","node_modules/@parcel/runtime-js/lib/runtime-ac3946a6ffd5d3cb.js","node_modules/@parcel/runtime-js/lib/runtime-1edfd2eec4893187.js","node_modules/@parcel/runtime-js/lib/runtime-89e91ff9481463dd.js","src/player.ts","src/config.ts","node_modules/@parcel/transformer-js/src/esmodule-helpers.js","src/chest.ts","src/gamestatus.ts","src/dialogmanager.ts","src/daniel.ts","src/vio.ts","src/customtext.ts","node_modules/nipplejs/dist/nipplejs.js"],"sourcesContent":["var HMR_HOST = null;var HMR_PORT = null;var HMR_SECURE = false;var HMR_ENV_HASH = \"d6ea1d42532a7575\";var HMR_USE_SSE = false;module.bundle.HMR_BUNDLE_ID = \"7dd44675b7a05eb9\";\"use strict\";\n\n/* global HMR_HOST, HMR_PORT, HMR_ENV_HASH, HMR_SECURE, HMR_USE_SSE, chrome, browser, __parcel__import__, __parcel__importScripts__, ServiceWorkerGlobalScope */\n/*::\nimport type {\n  HMRAsset,\n  HMRMessage,\n} from '@parcel/reporter-dev-server/src/HMRServer.js';\ninterface ParcelRequire {\n  (string): mixed;\n  cache: {|[string]: ParcelModule|};\n  hotData: {|[string]: mixed|};\n  Module: any;\n  parent: ?ParcelRequire;\n  isParcelRequire: true;\n  modules: {|[string]: [Function, {|[string]: string|}]|};\n  HMR_BUNDLE_ID: string;\n  root: ParcelRequire;\n}\ninterface ParcelModule {\n  hot: {|\n    data: mixed,\n    accept(cb: (Function) => void): void,\n    dispose(cb: (mixed) => void): void,\n    // accept(deps: Array<string> | string, cb: (Function) => void): void,\n    // decline(): void,\n    _acceptCallbacks: Array<(Function) => void>,\n    _disposeCallbacks: Array<(mixed) => void>,\n  |};\n}\ninterface ExtensionContext {\n  runtime: {|\n    reload(): void,\n    getURL(url: string): string;\n    getManifest(): {manifest_version: number, ...};\n  |};\n}\ndeclare var module: {bundle: ParcelRequire, ...};\ndeclare var HMR_HOST: string;\ndeclare var HMR_PORT: string;\ndeclare var HMR_ENV_HASH: string;\ndeclare var HMR_SECURE: boolean;\ndeclare var HMR_USE_SSE: boolean;\ndeclare var chrome: ExtensionContext;\ndeclare var browser: ExtensionContext;\ndeclare var __parcel__import__: (string) => Promise<void>;\ndeclare var __parcel__importScripts__: (string) => Promise<void>;\ndeclare var globalThis: typeof self;\ndeclare var ServiceWorkerGlobalScope: Object;\n*/\nvar OVERLAY_ID = '__parcel__error__overlay__';\nvar OldModule = module.bundle.Module;\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData[moduleName],\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n  module.bundle.hotData[moduleName] = undefined;\n}\nmodule.bundle.Module = Module;\nmodule.bundle.hotData = {};\nvar checkedAssets /*: {|[string]: boolean|} */, disposedAssets /*: {|[string]: boolean|} */, assetsToDispose /*: Array<[ParcelRequire, string]> */, assetsToAccept /*: Array<[ParcelRequire, string]> */;\nfunction getHostname() {\n  return HMR_HOST || (location.protocol.indexOf('http') === 0 ? location.hostname : 'localhost');\n}\nfunction getPort() {\n  return HMR_PORT || location.port;\n}\n\n// eslint-disable-next-line no-redeclare\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = getHostname();\n  var port = getPort();\n  var protocol = HMR_SECURE || location.protocol == 'https:' && !['localhost', '127.0.0.1', '0.0.0.0'].includes(hostname) ? 'wss' : 'ws';\n  var ws;\n  if (HMR_USE_SSE) {\n    ws = new EventSource('/__parcel_hmr');\n  } else {\n    try {\n      ws = new WebSocket(protocol + '://' + hostname + (port ? ':' + port : '') + '/');\n    } catch (err) {\n      if (err.message) {\n        console.error(err.message);\n      }\n      ws = {};\n    }\n  }\n\n  // Web extension context\n  var extCtx = typeof browser === 'undefined' ? typeof chrome === 'undefined' ? null : chrome : browser;\n\n  // Safari doesn't support sourceURL in error stacks.\n  // eval may also be disabled via CSP, so do a quick check.\n  var supportsSourceURL = false;\n  try {\n    (0, eval)('throw new Error(\"test\"); //# sourceURL=test.js');\n  } catch (err) {\n    supportsSourceURL = err.stack.includes('test.js');\n  }\n\n  // $FlowFixMe\n  ws.onmessage = async function (event /*: {data: string, ...} */) {\n    checkedAssets = {} /*: {|[string]: boolean|} */;\n    disposedAssets = {} /*: {|[string]: boolean|} */;\n    assetsToAccept = [];\n    assetsToDispose = [];\n    var data /*: HMRMessage */ = JSON.parse(event.data);\n    if (data.type === 'reload') {\n      fullReload();\n    } else if (data.type === 'update') {\n      // Remove error overlay if there is one\n      if (typeof document !== 'undefined') {\n        removeErrorOverlay();\n      }\n      let assets = data.assets.filter(asset => asset.envHash === HMR_ENV_HASH);\n\n      // Handle HMR Update\n      let handled = assets.every(asset => {\n        return asset.type === 'css' || asset.type === 'js' && hmrAcceptCheck(module.bundle.root, asset.id, asset.depsByBundle);\n      });\n      if (handled) {\n        console.clear();\n\n        // Dispatch custom event so other runtimes (e.g React Refresh) are aware.\n        if (typeof window !== 'undefined' && typeof CustomEvent !== 'undefined') {\n          window.dispatchEvent(new CustomEvent('parcelhmraccept'));\n        }\n        await hmrApplyUpdates(assets);\n        hmrDisposeQueue();\n\n        // Run accept callbacks. This will also re-execute other disposed assets in topological order.\n        let processedAssets = {};\n        for (let i = 0; i < assetsToAccept.length; i++) {\n          let id = assetsToAccept[i][1];\n          if (!processedAssets[id]) {\n            hmrAccept(assetsToAccept[i][0], id);\n            processedAssets[id] = true;\n          }\n        }\n      } else fullReload();\n    }\n    if (data.type === 'error') {\n      // Log parcel errors to console\n      for (let ansiDiagnostic of data.diagnostics.ansi) {\n        let stack = ansiDiagnostic.codeframe ? ansiDiagnostic.codeframe : ansiDiagnostic.stack;\n        console.error(' [parcel]: ' + ansiDiagnostic.message + '\\n' + stack + '\\n\\n' + ansiDiagnostic.hints.join('\\n'));\n      }\n      if (typeof document !== 'undefined') {\n        // Render the fancy html overlay\n        removeErrorOverlay();\n        var overlay = createErrorOverlay(data.diagnostics.html);\n        // $FlowFixMe\n        document.body.appendChild(overlay);\n      }\n    }\n  };\n  if (ws instanceof WebSocket) {\n    ws.onerror = function (e) {\n      if (e.message) {\n        console.error(e.message);\n      }\n    };\n    ws.onclose = function () {\n      console.warn('[parcel]  Connection to the HMR server was lost');\n    };\n  }\n}\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n    console.log('[parcel]  Error resolved');\n  }\n}\nfunction createErrorOverlay(diagnostics) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n  let errorHTML = '<div style=\"background: black; opacity: 0.85; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; font-family: Menlo, Consolas, monospace; z-index: 9999;\">';\n  for (let diagnostic of diagnostics) {\n    let stack = diagnostic.frames.length ? diagnostic.frames.reduce((p, frame) => {\n      return `${p}\n<a href=\"/__parcel_launch_editor?file=${encodeURIComponent(frame.location)}\" style=\"text-decoration: underline; color: #888\" onclick=\"fetch(this.href); return false\">${frame.location}</a>\n${frame.code}`;\n    }, '') : diagnostic.stack;\n    errorHTML += `\n      <div>\n        <div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">\n           ${diagnostic.message}\n        </div>\n        <pre>${stack}</pre>\n        <div>\n          ${diagnostic.hints.map(hint => '<div> ' + hint + '</div>').join('')}\n        </div>\n        ${diagnostic.documentation ? `<div> <a style=\"color: violet\" href=\"${diagnostic.documentation}\" target=\"_blank\">Learn more</a></div>` : ''}\n      </div>\n    `;\n  }\n  errorHTML += '</div>';\n  overlay.innerHTML = errorHTML;\n  return overlay;\n}\nfunction fullReload() {\n  if ('reload' in location) {\n    location.reload();\n  } else if (extCtx && extCtx.runtime && extCtx.runtime.reload) {\n    extCtx.runtime.reload();\n  }\n}\nfunction getParents(bundle, id) /*: Array<[ParcelRequire, string]> */{\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n  var parents = [];\n  var k, d, dep;\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || Array.isArray(dep) && dep[dep.length - 1] === id) {\n        parents.push([bundle, k]);\n      }\n    }\n  }\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n  return parents;\n}\nfunction updateLink(link) {\n  var href = link.getAttribute('href');\n  if (!href) {\n    return;\n  }\n  var newLink = link.cloneNode();\n  newLink.onload = function () {\n    if (link.parentNode !== null) {\n      // $FlowFixMe\n      link.parentNode.removeChild(link);\n    }\n  };\n  newLink.setAttribute('href',\n  // $FlowFixMe\n  href.split('?')[0] + '?' + Date.now());\n  // $FlowFixMe\n  link.parentNode.insertBefore(newLink, link.nextSibling);\n}\nvar cssTimeout = null;\nfunction reloadCSS() {\n  if (cssTimeout) {\n    return;\n  }\n  cssTimeout = setTimeout(function () {\n    var links = document.querySelectorAll('link[rel=\"stylesheet\"]');\n    for (var i = 0; i < links.length; i++) {\n      // $FlowFixMe[incompatible-type]\n      var href /*: string */ = links[i].getAttribute('href');\n      var hostname = getHostname();\n      var servedFromHMRServer = hostname === 'localhost' ? new RegExp('^(https?:\\\\/\\\\/(0.0.0.0|127.0.0.1)|localhost):' + getPort()).test(href) : href.indexOf(hostname + ':' + getPort());\n      var absolute = /^https?:\\/\\//i.test(href) && href.indexOf(location.origin) !== 0 && !servedFromHMRServer;\n      if (!absolute) {\n        updateLink(links[i]);\n      }\n    }\n    cssTimeout = null;\n  }, 50);\n}\nfunction hmrDownload(asset) {\n  if (asset.type === 'js') {\n    if (typeof document !== 'undefined') {\n      let script = document.createElement('script');\n      script.src = asset.url + '?t=' + Date.now();\n      if (asset.outputFormat === 'esmodule') {\n        script.type = 'module';\n      }\n      return new Promise((resolve, reject) => {\n        var _document$head;\n        script.onload = () => resolve(script);\n        script.onerror = reject;\n        (_document$head = document.head) === null || _document$head === void 0 || _document$head.appendChild(script);\n      });\n    } else if (typeof importScripts === 'function') {\n      // Worker scripts\n      if (asset.outputFormat === 'esmodule') {\n        return __parcel__import__(asset.url + '?t=' + Date.now());\n      } else {\n        return new Promise((resolve, reject) => {\n          try {\n            __parcel__importScripts__(asset.url + '?t=' + Date.now());\n            resolve();\n          } catch (err) {\n            reject(err);\n          }\n        });\n      }\n    }\n  }\n}\nasync function hmrApplyUpdates(assets) {\n  global.parcelHotUpdate = Object.create(null);\n  let scriptsToRemove;\n  try {\n    // If sourceURL comments aren't supported in eval, we need to load\n    // the update from the dev server over HTTP so that stack traces\n    // are correct in errors/logs. This is much slower than eval, so\n    // we only do it if needed (currently just Safari).\n    // https://bugs.webkit.org/show_bug.cgi?id=137297\n    // This path is also taken if a CSP disallows eval.\n    if (!supportsSourceURL) {\n      let promises = assets.map(asset => {\n        var _hmrDownload;\n        return (_hmrDownload = hmrDownload(asset)) === null || _hmrDownload === void 0 ? void 0 : _hmrDownload.catch(err => {\n          // Web extension fix\n          if (extCtx && extCtx.runtime && extCtx.runtime.getManifest().manifest_version == 3 && typeof ServiceWorkerGlobalScope != 'undefined' && global instanceof ServiceWorkerGlobalScope) {\n            extCtx.runtime.reload();\n            return;\n          }\n          throw err;\n        });\n      });\n      scriptsToRemove = await Promise.all(promises);\n    }\n    assets.forEach(function (asset) {\n      hmrApply(module.bundle.root, asset);\n    });\n  } finally {\n    delete global.parcelHotUpdate;\n    if (scriptsToRemove) {\n      scriptsToRemove.forEach(script => {\n        if (script) {\n          var _document$head2;\n          (_document$head2 = document.head) === null || _document$head2 === void 0 || _document$head2.removeChild(script);\n        }\n      });\n    }\n  }\n}\nfunction hmrApply(bundle /*: ParcelRequire */, asset /*:  HMRAsset */) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (asset.type === 'css') {\n    reloadCSS();\n  } else if (asset.type === 'js') {\n    let deps = asset.depsByBundle[bundle.HMR_BUNDLE_ID];\n    if (deps) {\n      if (modules[asset.id]) {\n        // Remove dependencies that are removed and will become orphaned.\n        // This is necessary so that if the asset is added back again, the cache is gone, and we prevent a full page reload.\n        let oldDeps = modules[asset.id][1];\n        for (let dep in oldDeps) {\n          if (!deps[dep] || deps[dep] !== oldDeps[dep]) {\n            let id = oldDeps[dep];\n            let parents = getParents(module.bundle.root, id);\n            if (parents.length === 1) {\n              hmrDelete(module.bundle.root, id);\n            }\n          }\n        }\n      }\n      if (supportsSourceURL) {\n        // Global eval. We would use `new Function` here but browser\n        // support for source maps is better with eval.\n        (0, eval)(asset.output);\n      }\n\n      // $FlowFixMe\n      let fn = global.parcelHotUpdate[asset.id];\n      modules[asset.id] = [fn, deps];\n    }\n\n    // Always traverse to the parent bundle, even if we already replaced the asset in this bundle.\n    // This is required in case modules are duplicated. We need to ensure all instances have the updated code.\n    if (bundle.parent) {\n      hmrApply(bundle.parent, asset);\n    }\n  }\n}\nfunction hmrDelete(bundle, id) {\n  let modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (modules[id]) {\n    // Collect dependencies that will become orphaned when this module is deleted.\n    let deps = modules[id][1];\n    let orphans = [];\n    for (let dep in deps) {\n      let parents = getParents(module.bundle.root, deps[dep]);\n      if (parents.length === 1) {\n        orphans.push(deps[dep]);\n      }\n    }\n\n    // Delete the module. This must be done before deleting dependencies in case of circular dependencies.\n    delete modules[id];\n    delete bundle.cache[id];\n\n    // Now delete the orphans.\n    orphans.forEach(id => {\n      hmrDelete(module.bundle.root, id);\n    });\n  } else if (bundle.parent) {\n    hmrDelete(bundle.parent, id);\n  }\n}\nfunction hmrAcceptCheck(bundle /*: ParcelRequire */, id /*: string */, depsByBundle /*: ?{ [string]: { [string]: string } }*/) {\n  if (hmrAcceptCheckOne(bundle, id, depsByBundle)) {\n    return true;\n  }\n\n  // Traverse parents breadth first. All possible ancestries must accept the HMR update, or we'll reload.\n  let parents = getParents(module.bundle.root, id);\n  let accepted = false;\n  while (parents.length > 0) {\n    let v = parents.shift();\n    let a = hmrAcceptCheckOne(v[0], v[1], null);\n    if (a) {\n      // If this parent accepts, stop traversing upward, but still consider siblings.\n      accepted = true;\n    } else {\n      // Otherwise, queue the parents in the next level upward.\n      let p = getParents(module.bundle.root, v[1]);\n      if (p.length === 0) {\n        // If there are no parents, then we've reached an entry without accepting. Reload.\n        accepted = false;\n        break;\n      }\n      parents.push(...p);\n    }\n  }\n  return accepted;\n}\nfunction hmrAcceptCheckOne(bundle /*: ParcelRequire */, id /*: string */, depsByBundle /*: ?{ [string]: { [string]: string } }*/) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (depsByBundle && !depsByBundle[bundle.HMR_BUNDLE_ID]) {\n    // If we reached the root bundle without finding where the asset should go,\n    // there's nothing to do. Mark as \"accepted\" so we don't reload the page.\n    if (!bundle.parent) {\n      return true;\n    }\n    return hmrAcceptCheck(bundle.parent, id, depsByBundle);\n  }\n  if (checkedAssets[id]) {\n    return true;\n  }\n  checkedAssets[id] = true;\n  var cached = bundle.cache[id];\n  assetsToDispose.push([bundle, id]);\n  if (!cached || cached.hot && cached.hot._acceptCallbacks.length) {\n    assetsToAccept.push([bundle, id]);\n    return true;\n  }\n}\nfunction hmrDisposeQueue() {\n  // Dispose all old assets.\n  for (let i = 0; i < assetsToDispose.length; i++) {\n    let id = assetsToDispose[i][1];\n    if (!disposedAssets[id]) {\n      hmrDispose(assetsToDispose[i][0], id);\n      disposedAssets[id] = true;\n    }\n  }\n  assetsToDispose = [];\n}\nfunction hmrDispose(bundle /*: ParcelRequire */, id /*: string */) {\n  var cached = bundle.cache[id];\n  bundle.hotData[id] = {};\n  if (cached && cached.hot) {\n    cached.hot.data = bundle.hotData[id];\n  }\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData[id]);\n    });\n  }\n  delete bundle.cache[id];\n}\nfunction hmrAccept(bundle /*: ParcelRequire */, id /*: string */) {\n  // Execute the module.\n  bundle(id);\n\n  // Run the accept callbacks in the new version of the module.\n  var cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    let assetsToAlsoAccept = [];\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      let additionalAssets = cb(function () {\n        return getParents(module.bundle.root, id);\n      });\n      if (Array.isArray(additionalAssets) && additionalAssets.length) {\n        assetsToAlsoAccept.push(...additionalAssets);\n      }\n    });\n    if (assetsToAlsoAccept.length) {\n      let handled = assetsToAlsoAccept.every(function (a) {\n        return hmrAcceptCheck(a[0], a[1]);\n      });\n      if (!handled) {\n        return fullReload();\n      }\n      hmrDisposeQueue();\n    }\n  }\n}","import * as ex from 'excalibur';\nimport nipplejs from \"nipplejs\";\nimport { Resources, loader } from './resources';\nimport { CustomText } from './customtext';\nimport { DialogManager } from './dialogmanager';\nimport { GameStatus } from './gamestatus';\n\n// Use a square virtual resolution so the camera aspect ratio is 1:1\nconst VIRTUAL_SIZE = 320;\n\nconst devicePR = Math.max(1, Math.floor(window.devicePixelRatio || 1));\n\nconst game = new ex.Engine({\n    width: VIRTUAL_SIZE,\n    height: VIRTUAL_SIZE,\n    canvasElementId: 'game',\n    pixelArt: true,\n    // Use an integer pixelRatio based on device to keep scaling crisp\n    pixelRatio: devicePR,\n    // Fit screen but we'll adjust the canvas CSS to keep it square and centered\n    displayMode: ex.DisplayMode.FitScreen,\n    // let Excalibur handle HiDPI scaling\n    suppressHiDPIScaling: false\n});\n\nconst gametext = new CustomText(new ex.Vector(20, VIRTUAL_SIZE - 25), VIRTUAL_SIZE, VIRTUAL_SIZE);\n\nDialogManager.init(gametext);\ngame.start(loader).then(() => {\n    // Add Tiled map and UI\n    Resources.TiledMap.addToScene(game.currentScene);\n    game.currentScene.add(gametext);\n\n    // Joystick handling: only create on touch devices when no physical gamepad is connected\n    let joystickInstance: any = null;\n\n    function hasPhysicalGamepad() {\n        const gps = navigator.getGamepads ? navigator.getGamepads() : [];\n        for (const gp of gps as any) {\n            if (gp && gp.connected) return true;\n        }\n        return false;\n    }\n\n    function isTouchDevice() {\n        return ('ontouchstart' in window) || (navigator.maxTouchPoints && navigator.maxTouchPoints > 0);\n    }\n\n    function createJoystickIfNeeded() {\n        const zone = document.getElementById('zone');\n        const btnB = document.getElementById('btn-b');\n\n        const shouldShow = isTouchDevice() && !hasPhysicalGamepad();\n\n        // If we shouldn't show controls, destroy existing joystick and hide UI\n        if (!shouldShow) {\n            destroyJoystick();\n            if (zone) zone.style.display = 'none';\n            if (btnB) btnB.style.display = 'none';\n            return;\n        }\n\n        // Ensure we have the zone element\n        if (!zone) return;\n\n        // If joystick already exists, make sure UI is visible and return\n        if (joystickInstance) {\n            zone.style.display = 'block';\n            if (btnB) btnB.style.display = 'flex';\n            return;\n        }\n\n        // Make the zone visible first so nipplejs can measure dimensions correctly\n        zone.style.display = 'block';\n        if (btnB) btnB.style.display = 'flex';\n\n        // Center the static joystick inside the visible zone using pixel coordinates\n        const zrect = zone.getBoundingClientRect();\n        const posLeft = Math.floor(zrect.width / 2);\n        const posTop = Math.floor(zrect.height / 2);\n        if ((window as any).DEBUG_JOYSTICK) console.debug('zone rect before create', zrect, { posLeft, posTop });\n\n        // Create joystick with pixel-based static position centered in zone\n        joystickInstance = nipplejs.create({\n            zone: zone,\n            mode: 'static',\n            position: { left: `${posLeft}px`, top: `${posTop}px` },\n            color: 'cyan'\n        });\n\n        GameStatus.joystick = joystickInstance;\n        if ((window as any).DEBUG_JOYSTICK) console.debug('joystick created', joystickInstance);\n        // Update shared joystick vector for players to read\n        joystickInstance.on('move', (_evt: any, data: any) => {\n            if (!data.vector) return;\n            const x = data.vector.x;\n            const y = data.vector.y;\n            GameStatus.joystickVector = ex.vec(x, -y);//.normalize();\n\n        });\n        joystickInstance.on('end', () => {\n            GameStatus.joystickVector = ex.vec(0, 0);\n        });\n    }\n\n    function destroyJoystick() {\n        if (joystickInstance) {\n            try { joystickInstance.destroy(); } catch (e) { /* ignore */ }\n            joystickInstance = null;\n            GameStatus.joystick = null as any;\n        }\n        const zone = document.getElementById('zone');\n        const btnB = document.getElementById('btn-b');\n        if (zone) zone.style.display = 'none';\n        if (btnB) btnB.style.display = 'none';\n    }\n\n    // Initial setup\n    createJoystickIfNeeded();\n\n    // Recreate/destroy on gamepad connect/disconnect\n    window.addEventListener('gamepadconnected', () => {\n        destroyJoystick();\n    });\n    window.addEventListener('gamepaddisconnected', () => {\n        createJoystickIfNeeded();\n    });\n\n    // Canvas sizing: keep the game canvas square and centered using the smaller viewport dimension\n    function updateCanvasSquare() {\n        const canvas = document.getElementById('game') as HTMLCanvasElement | null;\n        if (!canvas) return;\n        // Use the smaller dimension; for landscape this will be the height (as requested)\n        let size = Math.min(window.innerWidth, window.innerHeight);\n        // make slightly smaller to avoid touching OS UI\n        size = Math.floor(size * 0.95);\n        canvas.style.width = size + 'px';\n        canvas.style.height = size + 'px';\n\n        // Position the dialog exactly inside the canvas lower third\n        const dialog = document.getElementById('dialog');\n        const dialogInner = document.querySelector('#dialog .dialog-inner') as HTMLElement | null;\n        if (dialog && dialogInner) {\n            const rect = canvas.getBoundingClientRect();\n            const dialogHeight = Math.floor(rect.height / 3);\n            dialog.style.left = rect.left + 'px';\n            dialog.style.top = (rect.top + rect.height - dialogHeight) + 'px';\n            dialog.style.width = rect.width + 'px';\n            dialog.style.height = dialogHeight + 'px';\n\n            // ensure the dialog-inner fills the parent (no horizontal padding/margin)\n            dialogInner.style.width = '100%';\n            dialogInner.style.height = '100%';\n            dialogInner.style.maxWidth = rect.width + 'px';\n        }\n\n        // B button remains fixed (CSS). Ensure it stays on-screen and outside the canvas if possible\n        const btnB = document.getElementById('btn-b');\n        if (btnB) {\n            const rect = canvas.getBoundingClientRect();\n            const btnRect = btnB.getBoundingClientRect();\n            const gapRight = window.innerWidth - rect.right; // space to right of canvas\n            const desiredGap = 16; // desired distance from viewport edge\n            if (gapRight < btnRect.width + desiredGap) {\n                // not enough space, move button left by extra amount so it remains visible\n                const extra = (btnRect.width + desiredGap) - gapRight;\n                btnB.style.right = (desiredGap + extra) + 'px';\n            } else {\n                btnB.style.right = desiredGap + 'px';\n            }\n        }\n    }\n    updateCanvasSquare();\n    window.addEventListener('resize', () => {\n        updateCanvasSquare();\n        // Recreate joystick on resize so nipplejs recalibrates to new zone size\n        if (isTouchDevice()) {\n            destroyJoystick();\n            setTimeout(() => createJoystickIfNeeded(), 100);\n        } else {\n            createJoystickIfNeeded();\n        }\n    });\n    window.addEventListener('orientationchange', () => {\n        // allow the browser to settle, then resize and re-create joystick for correct calibration\n        setTimeout(() => {\n            updateCanvasSquare();\n            if (isTouchDevice()) {\n                destroyJoystick();\n                setTimeout(() => createJoystickIfNeeded(), 150);\n            } else {\n                createJoystickIfNeeded();\n            }\n        }, 300);\n    });\n});",null,"(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(self, () => {\nreturn ","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* Buttons styles start */\r\n\r\nbutton#excalibur-play {\r\n  display: inline-block;\r\n  position: relative;\r\n  z-index: 999;\r\n  border-radius: 6px;\r\n  border: none;\r\n  /*border: 3px solid;\r\n    border-color: white;\r\n    box-shadow: 0 0 10px #ccc;*/\r\n  padding: 1rem 1.5rem 1rem 4rem;\r\n  margin: 0;\r\n  text-decoration: none;\r\n  background: #00b233;\r\n  color: #ffffff;\r\n  font-family: sans-serif;\r\n  font-size: 2rem;\r\n  white-space: nowrap;\r\n  line-height: 1;\r\n  cursor: pointer;\r\n  text-align: center;\r\n  transition:\r\n    background 250ms ease-in-out,\r\n    transform 150ms ease;\r\n  -webkit-appearance: none;\r\n  -moz-appearance: none;\r\n\r\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r\n  animation: excalibur-button-fadein 200ms;\r\n}\r\n\r\n/*\r\nbutton#excalibur-play {\r\n  display: none;\r\n}*/\r\n\r\nbutton#excalibur-play:after {\r\n  position: absolute;\r\n  content: '';\r\n  border: 8px solid;\r\n  border-color: transparent transparent transparent white;\r\n  left: 35px;\r\n  top: 24px;\r\n  width: 0;\r\n  height: 0;\r\n}\r\n\r\nbutton#excalibur-play:before {\r\n  position: absolute;\r\n  content: '';\r\n  border: 3px solid;\r\n  left: 19px;\r\n  top: 14px;\r\n  border-radius: 20px;\r\n  width: 30px;\r\n  height: 30px;\r\n}\r\n\r\nbutton#excalibur-play:hover,\r\nbutton#excalibur-play:focus {\r\n  background: #00982c;\r\n}\r\n\r\nbutton#excalibur-play:focus {\r\n  outline: 1px solid #fff;\r\n  outline-offset: -4px;\r\n}\r\n\r\nbutton#excalibur-play:active {\r\n  transform: scale(0.99);\r\n}\r\n\r\n@keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Firefox < 16 */\r\n@-moz-keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Safari, Chrome and Opera > 12.1 */\r\n@-webkit-keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Internet Explorer */\r\n@-ms-keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Opera < 12.1 */\r\n@-o-keyframes excalibur-button-fadein {\r\n  from {\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./Director/Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB;;wBAEsB;EACtB,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition:\\r\\n    background 250ms ease-in-out,\\r\\n    transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `#ex-toast-container {\r\n  position: absolute;\r\n  height: 0;\r\n  min-width: 50%;\r\n  left: 50%;\r\n  top: 0;\r\n}\r\n\r\n.ex-toast-message {\r\n  left: -50%;\r\n  position: relative;\r\n  display: flex;\r\n  justify-content: space-between;\r\n\r\n  padding: 10px;\r\n  margin-top: 5px;\r\n  font-size: 18px;\r\n  font-family: sans-serif;\r\n  border-radius: 6px;\r\n  border: 3px solid #b7b779;\r\n  background-color: rgb(253, 253, 192);\r\n}\r\n\r\n.ex-toast-message button {\r\n  align-self: flex-start;\r\n}\r\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./Util/Toaster.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;EAE9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;AAEA;EACE,sBAAsB;AACxB\",\"sourcesContent\":[\"#ex-toast-container {\\r\\n  position: absolute;\\r\\n  height: 0;\\r\\n  min-width: 50%;\\r\\n  left: 50%;\\r\\n  top: 0;\\r\\n}\\r\\n\\r\\n.ex-toast-message {\\r\\n  left: -50%;\\r\\n  position: relative;\\r\\n  display: flex;\\r\\n  justify-content: space-between;\\r\\n\\r\\n  padding: 10px;\\r\\n  margin-top: 5px;\\r\\n  font-size: 18px;\\r\\n  font-family: sans-serif;\\r\\n  border-radius: 6px;\\r\\n  border: 3px solid #b7b779;\\r\\n  background-color: rgb(253, 253, 192);\\r\\n}\\r\\n\\r\\n.ex-toast-message button {\\r\\n  align-self: flex-start;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Determines the scope of handling mouse/touch events.\n */\n\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n","/**\r\n * An enum that describes the strategies that rotation actions can use\r\n */\r\nexport enum RotationType {\r\n  /**\r\n   * Rotation via `ShortestPath` will use the smallest angle\r\n   * between the starting and ending points. This strategy is the default behavior.\r\n   */\r\n  ShortestPath = 'shortest-path',\r\n  /**\r\n   * Rotation via `LongestPath` will use the largest angle\r\n   * between the starting and ending points.\r\n   */\r\n  LongestPath = 'longest-path',\r\n  /**\r\n   * Rotation via `Clockwise` will travel in a clockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  Clockwise = 'clockwise',\r\n  /**\r\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  CounterClockwise = 'counter-clockwise'\r\n}\r\n","/**\r\n * Polyfill adding function\r\n */\r\nexport function polyfill() {\r\n  /* istanbul ignore next */\r\n  if (typeof window === 'undefined') {\r\n    window = <any>{\r\n      audioContext: function () {\r\n        return;\r\n      }\r\n    };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\r\n    (<any>window).requestAnimationFrame =\r\n      (<any>window).webkitRequestAnimationFrame ||\r\n      (<any>window).mozRequestAnimationFrame ||\r\n      function (callback: Function) {\r\n        window.setInterval(callback, 1000 / 60);\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\r\n    (<any>window).cancelAnimationFrame =\r\n      (<any>window).webkitCancelAnimationFrame ||\r\n      (<any>window).mozCancelAnimationFrame ||\r\n      function () {\r\n        return;\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\r\n    if ((<any>window).webkitAudioContext) {\r\n      const ctx = (<any>window).webkitAudioContext;\r\n      const replaceMe = ctx.prototype.decodeAudioData;\r\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\r\n        return new Promise((resolve, reject) => {\r\n          replaceMe.call(this, arrayBuffer, resolve, reject);\r\n        });\r\n      };\r\n    }\r\n\r\n    (<any>window).AudioContext =\r\n      (<any>window).AudioContext ||\r\n      (<any>window).webkitAudioContext ||\r\n      (<any>window).mozAudioContext ||\r\n      (<any>window).msAudioContext ||\r\n      (<any>window).oAudioContext;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\r\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(window as any).requestIdleCallback) {\r\n    // Adapted from https://developer.chrome.com/blog/using-requestidlecallback#checking_for_requestidlecallback\r\n    (window as any).requestIdleCallback =\r\n      window.requestIdleCallback ||\r\n      function (cb: (args: any) => any) {\r\n        const start = Date.now();\r\n        return setTimeout(function () {\r\n          cb({\r\n            didTimeout: false,\r\n            timeRemaining: function () {\r\n              return Math.max(0, 50 - (Date.now() - start));\r\n            }\r\n          });\r\n        }, 1);\r\n      };\r\n\r\n    (window as any).cancelIdleCallback =\r\n      window.cancelIdleCallback ||\r\n      function (id: any) {\r\n        clearTimeout(id);\r\n      };\r\n  }\r\n}\r\n","/**\r\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before {@apilink Engine} construction**\r\n * after which they are frozen and are read-only.\r\n *\r\n * Flags are used to enable experimental or preview features in Excalibur.\r\n */\r\nexport class Flags {\r\n  private static _FROZEN = false;\r\n  private static _FLAGS: Record<string, boolean> = {};\r\n\r\n  /**\r\n   * Force excalibur to load the Canvas 2D graphics context fallback\r\n   * @warning not all features of excalibur are supported in the Canvas 2D fallback\r\n   */\r\n  public static useCanvasGraphicsContext() {\r\n    Flags.enable('use-canvas-context');\r\n  }\r\n\r\n  /**\r\n   * Force excalibur to use the less optimized image renderer\r\n   */\r\n  public static useLegacyImageRenderer() {\r\n    Flags.enable('use-legacy-image-renderer');\r\n  }\r\n\r\n  /**\r\n   * Freeze all flag modifications making them readonly\r\n   */\r\n  public static freeze() {\r\n    Flags._FROZEN = true;\r\n  }\r\n\r\n  /**\r\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\r\n   *\r\n   * Calling this in your game is UNSUPPORTED\r\n   * @internal\r\n   */\r\n  public static _reset() {\r\n    Flags._FROZEN = false;\r\n    Flags._FLAGS = {};\r\n  }\r\n  /**\r\n   * Enable a specific feature flag by name. **Note: can only be set before {@apilink Engine} constructor time**\r\n   * @param flagName\r\n   */\r\n  public static enable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be enabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = true;\r\n  }\r\n\r\n  /**\r\n   * Disable a specific feature flag by name. **Note: can only be set before {@apilink Engine} constructor time**\r\n   * @param flagName\r\n   */\r\n  public static disable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be disabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = false;\r\n  }\r\n\r\n  /**\r\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\r\n   * @param flagName\r\n   */\r\n  public static isEnabled(flagName: string): boolean {\r\n    return !!Flags._FLAGS[flagName];\r\n  }\r\n\r\n  /**\r\n   * Show a list of currently known flags\r\n   */\r\n  public static show(): string[] {\r\n    return Object.keys(Flags._FLAGS);\r\n  }\r\n}\r\n","export type Id<T extends string> = {\r\n  type: T;\r\n  value: number;\r\n};\r\n\r\n/**\r\n * Create a branded ID type from a number\r\n */\r\nexport function createId<T extends string>(type: T, value: number): Id<T> {\r\n  return { type, value };\r\n}\r\n","/**\r\n * Future is a wrapper around a native browser Promise to allow resolving/rejecting at any time\r\n */\r\nexport class Future<T> {\r\n  // Code from StephenCleary https://gist.github.com/StephenCleary/ba50b2da419c03b9cba1d20cb4654d5e\r\n  private _resolver: (value: T) => void;\r\n  private _rejecter: (error: Error) => void;\r\n  private _isCompleted: boolean = false;\r\n\r\n  constructor() {\r\n    this.promise = new Promise((resolve, reject) => {\r\n      this._resolver = resolve;\r\n      this._rejecter = reject;\r\n    });\r\n  }\r\n\r\n  public readonly promise: Promise<T>;\r\n\r\n  public get isCompleted(): boolean {\r\n    return this._isCompleted;\r\n  }\r\n\r\n  public resolve(value: T): void {\r\n    if (this._isCompleted) {\r\n      return;\r\n    }\r\n    this._isCompleted = true;\r\n    this._resolver(value);\r\n  }\r\n\r\n  public reject(error: Error): void {\r\n    if (this._isCompleted) {\r\n      return;\r\n    }\r\n    this._isCompleted = true;\r\n    this._rejecter(error);\r\n  }\r\n}\r\n","export type EventMap = Record<string, any>;\r\nexport type EventKey<T extends EventMap> = string & keyof T;\r\nexport type Handler<EventType> = (event: EventType) => void;\r\n\r\n/**\r\n * Interface that represents a handle to a subscription that can be closed\r\n */\r\nexport interface Subscription {\r\n  /**\r\n   * Removes the associated event handler, synonymous with events.off(...);\r\n   */\r\n  close(): void;\r\n}\r\n\r\n/**\r\n * Excalibur's typed event emitter, this allows events to be sent with any string to Type mapping\r\n */\r\nexport class EventEmitter<TEventMap extends EventMap = any> {\r\n  private _paused = false;\r\n  private _empty = true;\r\n  private _listeners: Record<string, Handler<any>[]> = {};\r\n  private _listenersOnce: Record<string, Handler<any>[]> = {};\r\n  private _pipes: EventEmitter<any>[] = [];\r\n\r\n  /**\r\n   * Removes all listeners and pipes\r\n   */\r\n  clear() {\r\n    this._listeners = {};\r\n    this._listenersOnce = {};\r\n    this._pipes.length = 0;\r\n    this._empty = true;\r\n  }\r\n\r\n  on<TEventName extends EventKey<TEventMap>>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): Subscription;\r\n  on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  on<TEventName extends EventKey<TEventMap> | string>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): Subscription {\r\n    this._empty = false;\r\n    this._listeners[eventName] = this._listeners[eventName] ?? [];\r\n    this._listeners[eventName].push(handler);\r\n    return {\r\n      close: () => this.off(eventName, handler)\r\n    };\r\n  }\r\n\r\n  once<TEventName extends EventKey<TEventMap>>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): Subscription;\r\n  once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  once<TEventName extends EventKey<TEventMap> | string>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): Subscription {\r\n    this._empty = false;\r\n    this._listenersOnce[eventName] = this._listenersOnce[eventName] ?? [];\r\n    this._listenersOnce[eventName].push(handler);\r\n    return {\r\n      close: () => this.off(eventName, handler)\r\n    };\r\n  }\r\n\r\n  off<TEventName extends EventKey<TEventMap>>(eventName: TEventName, handler: Handler<TEventMap[TEventName]>): void;\r\n  off(eventName: string, handler: Handler<unknown>): void;\r\n  off(eventName: string): void;\r\n  off<TEventName extends EventKey<TEventMap> | string>(eventName: TEventName, handler?: Handler<TEventMap[TEventName]>): void {\r\n    if (handler) {\r\n      const newListeners = this._listeners[eventName]?.filter((h) => h !== handler);\r\n      this._listeners[eventName] = newListeners;\r\n\r\n      const newOnceListeners = this._listenersOnce[eventName]?.filter((h) => h !== handler);\r\n      this._listenersOnce[eventName] = newOnceListeners;\r\n    } else {\r\n      delete this._listeners[eventName];\r\n    }\r\n  }\r\n\r\n  emit<TEventName extends EventKey<TEventMap>>(eventName: TEventName, event: TEventMap[TEventName]): void;\r\n  emit(eventName: string, event?: any): void;\r\n  emit<TEventName extends EventKey<TEventMap> | string>(eventName: TEventName, event?: TEventMap[TEventName]): void {\r\n    if (this._empty) {\r\n      return;\r\n    }\r\n    if (this._paused) {\r\n      return;\r\n    }\r\n    const listeners = this._listeners[eventName];\r\n    if (listeners) {\r\n      for (let i = 0; i < listeners.length; i++) {\r\n        listeners[i](event);\r\n      }\r\n    }\r\n    const onces = this._listenersOnce[eventName];\r\n    this._listenersOnce[eventName] = [];\r\n    if (onces) {\r\n      for (let i = 0; i < onces.length; i++) {\r\n        onces[i](event);\r\n      }\r\n    }\r\n    for (let i = 0; i < this._pipes.length; i++) {\r\n      this._pipes[i].emit(eventName, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Replay events from this emitter to another\r\n   * @param emitter\r\n   */\r\n  pipe(emitter: EventEmitter<any>): Subscription {\r\n    if (this === emitter) {\r\n      throw Error('Cannot pipe to self');\r\n    }\r\n    this._empty = false;\r\n    this._pipes.push(emitter);\r\n    return {\r\n      close: () => {\r\n        const i = this._pipes.indexOf(emitter);\r\n        if (i > -1) {\r\n          this._pipes.splice(i, 1);\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Remove any piped emitters\r\n   * @param emitter\r\n   */\r\n  unpipe(emitter: EventEmitter<any>): void {\r\n    const i = this._pipes.indexOf(emitter);\r\n    if (i > -1) {\r\n      this._pipes.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Paused event emitters do not emit events\r\n   */\r\n  pause(): void {\r\n    this._paused = true;\r\n  }\r\n\r\n  /**\r\n   * Unpaused event emitter do emit events\r\n   */\r\n  unpause(): void {\r\n    this._paused = false;\r\n  }\r\n}\r\n","/**\r\n * @module\r\n * Pseudo-Random Utility\r\n *\r\n * A pseudo-random utility to add seeded random support for help in\r\n * generating things like terrain or reproducible randomness. Uses the\r\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\r\n */\r\n\r\n/**\r\n * 32-bit mask\r\n */\r\nconst BITMASK32: number = 0xffffffff;\r\n\r\n/**\r\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\r\n * of numbers each time it is called.\r\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\r\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\r\n *\r\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\r\n */\r\nexport class Random {\r\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\r\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\r\n  private _upperMask: number = 0x80000000; // 34 high bits\r\n\r\n  // Word size, 64 bits\r\n  private _w: number = 32;\r\n\r\n  // Degree of recurrence\r\n  private _n: number = 624;\r\n\r\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\r\n  private _m: number = 397;\r\n  // coefficients of teh rational normal form twist matrix\r\n  private _a: number = 0x9908b0df;\r\n\r\n  // tempering bit shifts and masks\r\n  private _u: number = 11;\r\n  private _s: number = 7;\r\n  private _b: number = 0x9d2c5680;\r\n  private _t: number = 15;\r\n  private _c: number = 0xefc60000;\r\n  private _l: number = 18;\r\n  private _f: number = 1812433253;\r\n\r\n  private _mt: number[];\r\n\r\n  private _index: number;\r\n\r\n  /**\r\n   * If no seed is specified, the Date.now() is used\r\n   */\r\n  constructor(public seed?: number) {\r\n    this._mt = new Array<number>(this._n);\r\n    // need to mask to support higher bit machines\r\n    this._mt[0] = (seed || Date.now()) >>> 0;\r\n\r\n    for (let i = 1; i < this._n; i++) {\r\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\r\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\r\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\r\n    }\r\n    this._index = this._n;\r\n  }\r\n\r\n  /**\r\n   * Apply the twist\r\n   */\r\n  private _twist(): void {\r\n    const mag01 = [0x0, this._a];\r\n    let y = 0,\r\n      i = 0;\r\n    for (; i < this._n - this._m; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    for (; i < this._n - 1; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\r\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n\r\n    this._index = 0;\r\n  }\r\n\r\n  /**\r\n   * Return next 32 bit integer number in sequence\r\n   */\r\n  public nextInt(): number {\r\n    if (this._index >= this._n) {\r\n      this._twist();\r\n    }\r\n\r\n    let y = this._mt[this._index++];\r\n\r\n    y ^= y >>> this._u;\r\n    y ^= (y << this._s) & this._b;\r\n    y ^= (y << this._t) & this._c;\r\n    y ^= y >>> this._l;\r\n\r\n    return y >>> 0;\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point number between [0, 1)\r\n   */\r\n  public next(): number {\r\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point in range [min, max) min is included, max is not included\r\n   */\r\n  public floating(min: number, max: number): number {\r\n    return (max - min) * this.next() + min;\r\n  }\r\n\r\n  /**\r\n   * Return a random integer in range [min, max] min is included, max is included.\r\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\r\n   */\r\n  public integer(min: number, max: number): number {\r\n    return Math.floor((max - min + 1) * this.next() + min);\r\n  }\r\n\r\n  /**\r\n   * Returns true or false randomly with 50/50 odds by default.\r\n   * By default the likelihood of returning a true is .5 (50%).\r\n   * @param likelihood takes values between [0, 1]\r\n   */\r\n  public bool(likelihood: number = 0.5): boolean {\r\n    return this.next() <= likelihood;\r\n  }\r\n\r\n  /**\r\n   * Returns one element from an array at random\r\n   */\r\n  public pickOne<T>(array: Array<T>): T {\r\n    return array[this.integer(0, array.length - 1)];\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original\r\n   * @param array Original array to pick from\r\n   * @param numPicks can be any positive number\r\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\r\n   * just that it is possible)\r\n   */\r\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\r\n    if (allowDuplicates) {\r\n      return this._pickSetWithDuplicates(array, numPicks);\r\n    } else {\r\n      return this._pickSetWithoutDuplicates(array, numPicks);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new array randomly picking elements in the original (not reused)\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks must be less than or equal to the number of elements in the array.\r\n   */\r\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    if (numPicks > array.length || numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\r\n    }\r\n    if (numPicks === array.length) {\r\n      return array;\r\n    }\r\n\r\n    const result: Array<T> = new Array<T>(numPicks);\r\n    let currentPick = 0;\r\n    const tempArray = array.slice(0);\r\n    while (currentPick < numPicks) {\r\n      const index = this.integer(0, tempArray.length - 1);\r\n      result[currentPick++] = tempArray[index];\r\n      tempArray.splice(index, 1);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original allowing duplicates\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks can be any positive number\r\n   */\r\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\r\n    if (numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\r\n    }\r\n    const result = new Array<T>(numPicks);\r\n    for (let i = 0; i < numPicks; i++) {\r\n      result[i] = this.pickOne(array);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\r\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\n   */\r\n  public shuffle<T>(array: Array<T>): Array<T> {\r\n    const tempArray = array.slice(0);\r\n    let swap: T;\r\n    for (let i = 0; i < tempArray.length - 2; i++) {\r\n      const randomIndex = this.integer(i, tempArray.length - 1);\r\n      swap = tempArray[i];\r\n      tempArray[i] = tempArray[randomIndex];\r\n      tempArray[randomIndex] = swap;\r\n    }\r\n\r\n    return tempArray;\r\n  }\r\n\r\n  /**\r\n   * Generate a list of random integer numbers\r\n   * @param length the length of the final array\r\n   * @param min the minimum integer number to generate inclusive\r\n   * @param max the maximum integer number to generate inclusive\r\n   */\r\n  public range(length: number, min: number, max: number): Array<number> {\r\n    const result: Array<number> = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n      result[i] = this.integer(min, max);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d4 dice roll\r\n   */\r\n  public d4() {\r\n    return this.integer(1, 4);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d6 dice roll\r\n   */\r\n  public d6() {\r\n    return this.integer(1, 6);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d8 dice roll\r\n   */\r\n  public d8() {\r\n    return this.integer(1, 8);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d10 dice roll\r\n   */\r\n  public d10() {\r\n    return this.integer(1, 10);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d12 dice roll\r\n   */\r\n  public d12() {\r\n    return this.integer(1, 12);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d20 dice roll\r\n   */\r\n  public d20() {\r\n    return this.integer(1, 20);\r\n  }\r\n}\r\n","import { Random } from './Random';\r\n\r\n/**\r\n * Two PI constant\r\n */\r\nexport const TwoPI: number = Math.PI * 2;\r\n\r\n/**\r\n * Returns the fractional part of a number\r\n * @param x\r\n */\r\nexport function frac(x: number): number {\r\n  if (x >= 0) {\r\n    return x - Math.floor(x);\r\n  } else {\r\n    return x - Math.ceil(x);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the sign of a number, if 0 returns 0\r\n */\r\nexport function sign(val: number): number {\r\n  if (val === 0) {\r\n    return 0;\r\n  }\r\n  return val < 0 ? -1 : 1;\r\n}\r\n\r\n/**\r\n * Clamps a value between a min and max inclusive\r\n */\r\nexport function clamp(val: number, min: number, max: number) {\r\n  return Math.min(Math.max(min, val), max);\r\n}\r\n\r\n/**\r\n * Approximately equals\r\n */\r\nexport function approximatelyEqual(val1: number, val2: number, tolerance: number) {\r\n  // https://dev.to/alldanielscott/how-to-compare-numbers-correctly-in-javascript-1l4i\r\n  return Math.abs(val1 - val2) < tolerance;\r\n}\r\n\r\n/**\r\n * Convert an angle to be the equivalent in the range [0, 2PI)\r\n */\r\nexport function canonicalizeAngle(angle: number): number {\r\n  let tmpAngle = angle;\r\n  if (angle >= TwoPI) {\r\n    while (tmpAngle >= TwoPI) {\r\n      tmpAngle -= TwoPI;\r\n    }\r\n  }\r\n\r\n  if (angle < 0) {\r\n    while (tmpAngle < 0) {\r\n      tmpAngle += TwoPI;\r\n    }\r\n  }\r\n  return tmpAngle;\r\n}\r\n\r\n/**\r\n * Convert radians to degrees\r\n */\r\nexport function toDegrees(radians: number): number {\r\n  return (180 / Math.PI) * radians;\r\n}\r\n\r\n/**\r\n * Convert degrees to radians\r\n */\r\nexport function toRadians(degrees: number): number {\r\n  return (degrees / 180) * Math.PI;\r\n}\r\n\r\n/**\r\n * Generate a range of numbers\r\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\r\n * @param from inclusive\r\n * @param to inclusive\r\n */\r\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\r\n\r\n/**\r\n * Find a random floating point number in range\r\n */\r\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\r\n}\r\n\r\n/**\r\n * Find a random integer in a range\r\n */\r\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\r\n}\r\n","import { Clonable } from '../Interfaces/Clonable';\r\nimport { RotationType } from './rotation-type';\r\nimport { canonicalizeAngle, clamp, TwoPI } from './util';\r\n\r\n/**\r\n * A 2D vector on a plane.\r\n */\r\n\r\nexport class Vector implements Clonable<Vector> {\r\n  /**\r\n   * Get or set the vector equals epsilon, by default 0.001 meaning vectors within that tolerance on x or y will be considered equal.\r\n   */\r\n  public static EQUALS_EPSILON = 0.001;\r\n  /**\r\n   * A (0, 0) vector\r\n   */\r\n  public static get Zero() {\r\n    return new Vector(0, 0);\r\n  }\r\n\r\n  /**\r\n   * A (1, 1) vector\r\n   */\r\n  public static get One() {\r\n    return new Vector(1, 1);\r\n  }\r\n\r\n  /**\r\n   * A (0.5, 0.5) vector\r\n   */\r\n  public static get Half() {\r\n    return new Vector(0.5, 0.5);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing up (0, -1)\r\n   */\r\n  public static get Up() {\r\n    return new Vector(0, -1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing down (0, 1)\r\n   */\r\n  public static get Down() {\r\n    return new Vector(0, 1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing left (-1, 0)\r\n   */\r\n  public static get Left() {\r\n    return new Vector(-1, 0);\r\n  }\r\n  /**\r\n   * A unit vector pointing right (1, 0)\r\n   */\r\n  public static get Right() {\r\n    return new Vector(1, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\r\n   * @param angle The angle to generate the vector\r\n   */\r\n  public static fromAngle(angle: number) {\r\n    return new Vector(Math.cos(angle), Math.sin(angle));\r\n  }\r\n\r\n  /**\r\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\r\n   */\r\n  public static isValid(vec: Vector) {\r\n    if (vec === null || vec === undefined) {\r\n      return false;\r\n    }\r\n    if (isNaN(vec.x) || isNaN(vec.y)) {\r\n      return false;\r\n    }\r\n\r\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Calculates distance between two Vectors\r\n   * @param vec1\r\n   * @param vec2\r\n   */\r\n  public static distance(vec1: Vector, vec2: Vector) {\r\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\r\n  }\r\n\r\n  public static min(vec1: Vector, vec2: Vector) {\r\n    return new Vector(Math.min(vec1.x, vec2.x), Math.min(vec1.y, vec2.y));\r\n  }\r\n\r\n  public static max(vec1: Vector, vec2: Vector) {\r\n    return new Vector(Math.max(vec1.x, vec2.x), Math.max(vec1.y, vec2.y));\r\n  }\r\n\r\n  /**\r\n   * @param x  X component of the Vector\r\n   * @param y  Y component of the Vector\r\n   */\r\n  constructor(x: number, y: number) {\r\n    this._x = x;\r\n    this._y = y;\r\n  }\r\n\r\n  protected _x = 0;\r\n  /**\r\n   * Get the x component of the vector\r\n   */\r\n  public get x(): number {\r\n    return this._x;\r\n  }\r\n\r\n  /**\r\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set x(val: number) {\r\n    this._x = val;\r\n  }\r\n\r\n  protected _y = 0;\r\n  /**\r\n   * Get the y component of the vector\r\n   */\r\n  public get y(): number {\r\n    return this._y;\r\n  }\r\n\r\n  /**\r\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set y(val: number) {\r\n    this._y = val;\r\n  }\r\n\r\n  /**\r\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  setTo(x: number, y: number) {\r\n    (this.x as number) = x;\r\n    (this.y as number) = y;\r\n  }\r\n\r\n  /**\r\n   * Compares this point against another and tests for equality\r\n   * @param vector The other point to compare to\r\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\r\n   */\r\n  public equals(vector: Vector, tolerance: number = Vector.EQUALS_EPSILON): boolean {\r\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\r\n  }\r\n\r\n  /**\r\n   * The distance to another vector. If no other Vector is specified, this will return the {@apilink magnitude}.\r\n   * @param v  The other vector. Leave blank to use origin vector.\r\n   */\r\n  public distance(v?: Vector): number {\r\n    if (!v) {\r\n      return Math.sqrt(this.x * this.x + this.y * this.y);\r\n    }\r\n    const deltaX = this.x - v.x;\r\n    const deltaY = this.y - v.y;\r\n    return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n  }\r\n\r\n  public squareDistance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    const deltaX = this.x - v.x;\r\n    const deltaY = this.y - v.y;\r\n    return deltaX * deltaX + deltaY * deltaY;\r\n  }\r\n\r\n  /**\r\n   * Clamps the current vector's magnitude mutating it\r\n   * @param magnitude\r\n   */\r\n  public clampMagnitude(magnitude: number): Vector {\r\n    const size = this.magnitude;\r\n    const newSize = clamp(size, 0, magnitude);\r\n    this.magnitude = newSize;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * The size (magnitude) of the Vector\r\n   * @deprecated Will be removed in v1, use Vector.magnitude\r\n   */\r\n  public get size(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   * @deprecated Will be removed in v1, use Vector.magnitude\r\n   */\r\n  public set size(newLength: number) {\r\n    const v = this.normalize().scale(newLength);\r\n    this.setTo(v.x, v.y);\r\n  }\r\n\r\n  /**\r\n   * The magnitude (length) of the Vector\r\n   */\r\n  public get magnitude(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  public set magnitude(newMagnitude: number) {\r\n    this.normalize().scale(newMagnitude, this);\r\n  }\r\n\r\n  /**\r\n   * Normalizes a non-zero vector to have a magnitude of 1. Zero vectors return a new zero vector.\r\n   */\r\n  public normalize(): Vector {\r\n    const distance = this.distance();\r\n    if (distance === 0) {\r\n      return Vector.Zero;\r\n    }\r\n\r\n    return new Vector(this.x / distance, this.y / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the average (midpoint) between the current point and the specified\r\n   */\r\n  public average(vec: Vector): Vector {\r\n    return this.add(vec).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Scales a vector's by a factor of size\r\n   * @param size  The factor to scale the magnitude by\r\n   * @param dest  Optionally provide a destination vector for the result\r\n   */\r\n  public scale(scale: Vector, dest?: Vector): Vector;\r\n  public scale(size: number, dest?: Vector): Vector;\r\n  public scale(sizeOrScale: number | Vector, dest?: Vector): Vector {\r\n    const result = dest || new Vector(0, 0);\r\n    if (sizeOrScale instanceof Vector) {\r\n      result.x = this.x * sizeOrScale.x;\r\n      result.y = this.y * sizeOrScale.y;\r\n    } else {\r\n      result.x = this.x * sizeOrScale;\r\n      result.y = this.y * sizeOrScale;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to another\r\n   * @param v The vector to add\r\n   * @param dest Optionally copy the result into a provided vector\r\n   */\r\n  public add(v: Vector, dest?: Vector): Vector {\r\n    if (dest) {\r\n      dest.x = this.x + v.x;\r\n      dest.y = this.y + v.y;\r\n      return dest;\r\n    }\r\n    return new Vector(this.x + v.x, this.y + v.y);\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\r\n   * @param v The vector to subtract\r\n   */\r\n  public sub(v: Vector, dest?: Vector): Vector {\r\n    const result = dest || new Vector(0, 0);\r\n    const x = this.x - v.x;\r\n    const y = this.y - v.y;\r\n    result.x = x;\r\n    result.y = y;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to this one modifying the original\r\n   * @param v The vector to add\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public addEqual(v: Vector): Vector {\r\n    this.setTo(this.x + v.x, this.y + v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from this one modifying the original\r\n   * @param v The vector to subtract\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public subEqual(v: Vector): Vector {\r\n    this.setTo(this.x - v.x, this.y - v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales this vector by a factor of size and modifies the original\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public scaleEqual(size: number): Vector {\r\n    this.setTo(this.x * size, this.y * size);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Performs a dot product with another vector\r\n   * @param v  The vector to dot\r\n   */\r\n  public dot(v: Vector): number {\r\n    return this.x * v.x + this.y * v.y;\r\n  }\r\n\r\n  /**\r\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\r\n   * @param v  The scalar to cross\r\n   */\r\n  public cross(v: number): Vector;\r\n  /**\r\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\r\n   * @param v  The vector to cross\r\n   */\r\n  public cross(v: Vector): number;\r\n  public cross(v: any): any {\r\n    if (v instanceof Vector) {\r\n      return this.x * v.y - this.y * v.x;\r\n    } else if (typeof v === 'number') {\r\n      return new Vector(v * this.y, -v * this.x);\r\n    }\r\n  }\r\n\r\n  static cross(num: number, vec: Vector): Vector {\r\n    return new Vector(-num * vec.y, num * vec.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the perpendicular vector to this one\r\n   */\r\n  public perpendicular(): Vector {\r\n    return new Vector(this.y, -this.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the normal vector to this one, same as the perpendicular of length 1\r\n   */\r\n  public normal(): Vector {\r\n    return this.perpendicular().normalize();\r\n  }\r\n\r\n  /**\r\n   * Negate the current vector\r\n   */\r\n  public negate(): Vector {\r\n    return this.scale(-1);\r\n  }\r\n\r\n  /**\r\n   * Returns the angle of this vector, in range [0, 2*PI)\r\n   */\r\n  public toAngle(): number {\r\n    return canonicalizeAngle(Math.atan2(this.y, this.x));\r\n  }\r\n\r\n  /**\r\n   * Returns the difference in radians between the angle of this vector and given angle,\r\n   * using the given rotation type.\r\n   * @param angle in radians to which the vector has to be rotated, using {@apilink rotate}\r\n   * @param rotationType what {@apilink RotationType} to use for the rotation\r\n   * @returns the angle by which the vector needs to be rotated to match the given angle\r\n   */\r\n  public angleBetween(angle: number, rotationType: RotationType): number {\r\n    const startAngleRadians = this.toAngle();\r\n    const endAngleRadians = canonicalizeAngle(angle);\r\n    let rotationClockwise = 0;\r\n    let rotationAntiClockwise = 0;\r\n    if (endAngleRadians > startAngleRadians) {\r\n      rotationClockwise = endAngleRadians - startAngleRadians;\r\n    } else {\r\n      rotationClockwise = (TwoPI - startAngleRadians + endAngleRadians) % TwoPI;\r\n    }\r\n    rotationAntiClockwise = (rotationClockwise - TwoPI) % TwoPI;\r\n    switch (rotationType) {\r\n      case RotationType.ShortestPath:\r\n        if (Math.abs(rotationClockwise) < Math.abs(rotationAntiClockwise)) {\r\n          return rotationClockwise;\r\n        } else {\r\n          return rotationAntiClockwise;\r\n        }\r\n      case RotationType.LongestPath:\r\n        if (Math.abs(rotationClockwise) > Math.abs(rotationAntiClockwise)) {\r\n          return rotationClockwise;\r\n        } else {\r\n          return rotationAntiClockwise;\r\n        }\r\n      case RotationType.Clockwise:\r\n        return rotationClockwise;\r\n      case RotationType.CounterClockwise:\r\n        return rotationAntiClockwise;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rotates the current vector around a point by a certain angle in radians.\r\n   * Positive angle means rotation clockwise.\r\n   */\r\n  public rotate(angle: number, anchor?: Vector, dest?: Vector): Vector {\r\n    const result = dest || new Vector(0, 0);\r\n    if (!anchor) {\r\n      anchor = new Vector(0, 0);\r\n    }\r\n    const sinAngle = Math.sin(angle);\r\n    const cosAngle = Math.cos(angle);\r\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\r\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\r\n    result.x = x;\r\n    result.y = y;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates new vector that has the same values as the previous.\r\n   */\r\n  public clone(dest?: Vector): Vector {\r\n    const v = dest ?? new Vector(0, 0);\r\n    v.x = this.x;\r\n    v.y = this.y;\r\n    return v;\r\n  }\r\n\r\n  /**\r\n   * Returns a string representation of the vector.\r\n   */\r\n  public toString(fixed?: number): string {\r\n    if (fixed) {\r\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\r\n    }\r\n    return `(${this.x}, ${this.y})`;\r\n  }\r\n}\r\n\r\n/**\r\n * Shorthand for creating new Vectors - returns a new Vector instance with the\r\n * provided X and Y components.\r\n * @param x  X component of the Vector\r\n * @param y  Y component of the Vector\r\n */\r\nexport function vec(x: number, y: number): Vector {\r\n  return new Vector(x, y);\r\n}\r\n","/**\r\n * Provides standard colors (e.g. {@apilink Color.Black})\r\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\r\n * useful color operations like {@apilink Color.lighten}, {@apilink Color.darken}, and more.\r\n */\r\nexport class Color {\r\n  /**\r\n   * Red channel\r\n   */\r\n  public r: number;\r\n  /**\r\n   * Green channel\r\n   */\r\n  public g: number;\r\n  /**\r\n   * Blue channel\r\n   */\r\n  public b: number;\r\n  /**\r\n   * Alpha channel (between 0 and 1)\r\n   */\r\n  public a: number;\r\n\r\n  /**\r\n   * Hue\r\n   */\r\n  public h: number;\r\n  /**\r\n   * Saturation\r\n   */\r\n  public s: number;\r\n  /**\r\n   * Lightness\r\n   */\r\n  public l: number;\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  constructor(r: number, g: number, b: number, a?: number) {\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a != null ? a : 1;\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\r\n    return new Color(r, g, b, a);\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a rgb string\r\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\r\n   */\r\n  public static fromRGBString(string: string): Color {\r\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\r\n    let match = null;\r\n    if ((match = string.match(rgbaRegEx))) {\r\n      const r = parseInt(match[1], 10);\r\n      const g = parseInt(match[2], 10);\r\n      const b = parseInt(match[3], 10);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseFloat(match[4]);\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid rgb/a string: ' + string);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a hex string\r\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\r\n   */\r\n  public static fromHex(hex: string): Color {\r\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\r\n    let match = null;\r\n    if ((match = hex.match(hexRegEx))) {\r\n      const r = parseInt(match[1], 16);\r\n      const g = parseInt(match[2], 16);\r\n      const b = parseInt(match[3], 16);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseInt(match[4], 16) / 255;\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid hex string: ' + hex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from hsla values\r\n   * @param h  Hue is represented [0-1]\r\n   * @param s  Saturation is represented [0-1]\r\n   * @param l  Luminance is represented [0-1]\r\n   * @param a  Alpha is represented [0-1]\r\n   */\r\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\r\n    const temp = new HSLColor(h, s, l, a);\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Lightens the current color by a specified amount\r\n   * @param factor  The amount to lighten by [0-1]\r\n   */\r\n  public lighten(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l += (1 - temp.l) * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Darkens the current color by a specified amount\r\n   * @param factor  The amount to darken by [0-1]\r\n   */\r\n  public darken(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l -= temp.l * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Saturates the current color by a specified amount\r\n   * @param factor  The amount to saturate by [0-1]\r\n   */\r\n  public saturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s += temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Desaturates the current color by a specified amount\r\n   * @param factor  The amount to desaturate by [0-1]\r\n   */\r\n  public desaturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s -= temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   * @param color  The other color\r\n   */\r\n  public multiply(color: Color): Color {\r\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\r\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\r\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\r\n    const newA = color.a * this.a;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  /**\r\n   * Screens a color by another, results in a lighter color\r\n   * @param color  The other color\r\n   */\r\n  public screen(color: Color): Color {\r\n    const color1 = color.invert();\r\n    const color2 = color.invert();\r\n    return color1.multiply(color2).invert();\r\n  }\r\n\r\n  /**\r\n   * Inverts the current color\r\n   */\r\n  public invert(): Color {\r\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\r\n  }\r\n\r\n  /**\r\n   * Averages the current color with another\r\n   * @param color  The other color\r\n   */\r\n  public average(color: Color): Color {\r\n    const newR = (color.r + this.r) / 2;\r\n    const newG = (color.g + this.g) / 2;\r\n    const newB = (color.b + this.b) / 2;\r\n    const newA = (color.a + this.a) / 2;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  public equal(color: Color): boolean {\r\n    return this.toString() === color.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   * @param format Color representation, accepts: rgb, hsl, or hex\r\n   */\r\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\r\n    switch (format) {\r\n      case 'rgb':\r\n        return this.toRGBA();\r\n      case 'hsl':\r\n        return this.toHSLA();\r\n      case 'hex':\r\n        return this.toHex();\r\n      default:\r\n        throw new Error('Invalid Color format');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns Hex Value of a color component\r\n   * @param c color component\r\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\r\n   */\r\n  private _componentToHex(c: number) {\r\n    // Handle negative and fractional numbers\r\n    const hex = Math.max(Math.round(c), 0).toString(16);\r\n    return hex.length === 1 ? '0' + hex : hex;\r\n  }\r\n\r\n  /**\r\n   * Return Hex representation of a color.\r\n   */\r\n  public toHex() {\r\n    let hexRepresentation = '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\r\n    if (this.a !== 1) {\r\n      hexRepresentation += this._componentToHex(this.a * 255);\r\n    }\r\n    return hexRepresentation;\r\n  }\r\n\r\n  /**\r\n   * Return RGBA representation of a color.\r\n   */\r\n  public toRGBA() {\r\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\r\n    if (this.a !== undefined || this.a !== null) {\r\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\r\n    }\r\n    return 'rgb(' + result + ')';\r\n  }\r\n\r\n  /**\r\n   * Return HSLA representation of a color.\r\n   */\r\n  public toHSLA() {\r\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   */\r\n  public fillStyle() {\r\n    return this.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of the current color.\r\n   */\r\n  public clone(dest?: Color): Color {\r\n    const result = dest || new Color(this.r, this.g, this.b, this.a);\r\n    result.r = this.r;\r\n    result.g = this.g;\r\n    result.b = this.b;\r\n    result.a = this.a;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Black (#000000)\r\n   */\r\n  public static get Black(): Color {\r\n    return Color.fromHex('#000000');\r\n  }\r\n\r\n  /**\r\n   * White (#FFFFFF)\r\n   */\r\n  public static get White(): Color {\r\n    return Color.fromHex('#FFFFFF');\r\n  }\r\n\r\n  /**\r\n   * Gray (#808080)\r\n   */\r\n  public static get Gray(): Color {\r\n    return Color.fromHex('#808080');\r\n  }\r\n\r\n  /**\r\n   * Light gray (#D3D3D3)\r\n   */\r\n  public static get LightGray(): Color {\r\n    return Color.fromHex('#D3D3D3');\r\n  }\r\n\r\n  /**\r\n   * Dark gray (#A9A9A9)\r\n   */\r\n  public static get DarkGray(): Color {\r\n    return Color.fromHex('#A9A9A9');\r\n  }\r\n\r\n  /**\r\n   * Yellow (#FFFF00)\r\n   */\r\n  public static get Yellow(): Color {\r\n    return Color.fromHex('#FFFF00');\r\n  }\r\n\r\n  /**\r\n   * Orange (#FFA500)\r\n   */\r\n  public static get Orange(): Color {\r\n    return Color.fromHex('#FFA500');\r\n  }\r\n\r\n  /**\r\n   * Red (#FF0000)\r\n   */\r\n  public static get Red(): Color {\r\n    return Color.fromHex('#FF0000');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   */\r\n  public static get Vermilion(): Color {\r\n    return Color.fromHex('#FF5B31');\r\n  }\r\n\r\n  /**\r\n   * Rose (#FF007F)\r\n   */\r\n  public static get Rose(): Color {\r\n    return Color.fromHex('#FF007F');\r\n  }\r\n\r\n  /**\r\n   * Pink (#FFC0CB)\r\n   */\r\n  public static get Pink(): Color {\r\n    return Color.fromHex('#FFC0CB');\r\n  }\r\n\r\n  /**\r\n   * Magenta (#FF00FF)\r\n   */\r\n  public static get Magenta(): Color {\r\n    return Color.fromHex('#FF00FF');\r\n  }\r\n\r\n  /**\r\n   * Violet (#7F00FF)\r\n   */\r\n  public static get Violet(): Color {\r\n    return Color.fromHex('#7F00FF');\r\n  }\r\n\r\n  /**\r\n   * Purple (#800080)\r\n   */\r\n  public static get Purple(): Color {\r\n    return Color.fromHex('#800080');\r\n  }\r\n\r\n  /**\r\n   * Blue (#0000FF)\r\n   */\r\n  public static get Blue(): Color {\r\n    return Color.fromHex('#0000FF');\r\n  }\r\n\r\n  /**\r\n   * Azure (#007FFF)\r\n   */\r\n  public static get Azure(): Color {\r\n    return Color.fromHex('#007FFF');\r\n  }\r\n\r\n  /**\r\n   * Cyan (#00FFFF)\r\n   */\r\n  public static get Cyan(): Color {\r\n    return Color.fromHex('#00FFFF');\r\n  }\r\n\r\n  /**\r\n   * Viridian (#59978F)\r\n   */\r\n  public static get Viridian(): Color {\r\n    return Color.fromHex('#59978F');\r\n  }\r\n\r\n  /**\r\n   * Teal (#008080)\r\n   */\r\n  public static get Teal(): Color {\r\n    return Color.fromHex('#008080');\r\n  }\r\n\r\n  /**\r\n   * Green (#00FF00)\r\n   */\r\n  public static get Green(): Color {\r\n    return Color.fromHex('#00FF00');\r\n  }\r\n\r\n  /**\r\n   * Chartreuse (#7FFF00)\r\n   */\r\n  public static get Chartreuse(): Color {\r\n    return Color.fromHex('#7FFF00');\r\n  }\r\n\r\n  /**\r\n   * Transparent (#FFFFFF00)\r\n   */\r\n  public static get Transparent(): Color {\r\n    return Color.fromHex('#FFFFFF00');\r\n  }\r\n\r\n  /**\r\n   * ExcaliburBlue (#176BAA)\r\n   */\r\n  public static get ExcaliburBlue(): Color {\r\n    return Color.fromHex('#176BAA');\r\n  }\r\n\r\n  /**\r\n   * Brown (#964B00)\r\n   */\r\n  public static get Brown(): Color {\r\n    return Color.fromHex('#964B00');\r\n  }\r\n}\r\n\r\n/**\r\n * Internal HSL Color representation\r\n *\r\n * http://en.wikipedia.org/wiki/HSL_and_HSV\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n */\r\nclass HSLColor {\r\n  constructor(\r\n    public h: number,\r\n    public s: number,\r\n    public l: number,\r\n    public a: number\r\n  ) {}\r\n\r\n  public static hue2rgb(p: number, q: number, t: number): number {\r\n    if (t < 0) {\r\n      t += 1;\r\n    }\r\n    if (t > 1) {\r\n      t -= 1;\r\n    }\r\n    if (t < 1 / 6) {\r\n      return p + (q - p) * 6 * t;\r\n    }\r\n    if (t < 1 / 2) {\r\n      return q;\r\n    }\r\n    if (t < 2 / 3) {\r\n      return p + (q - p) * (2 / 3 - t) * 6;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    const max = Math.max(r, g, b),\r\n      min = Math.min(r, g, b);\r\n    let h, s;\r\n    const l = (max + min) / 2;\r\n\r\n    if (max === min) {\r\n      h = s = 0; // achromatic\r\n    } else {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n      }\r\n      h /= 6;\r\n    }\r\n\r\n    return new HSLColor(h, s, l, a);\r\n  }\r\n\r\n  public toRGBA(): Color {\r\n    let r: number, g: number, b: number;\r\n\r\n    if (this.s === 0) {\r\n      r = g = b = this.l; // achromatic\r\n    } else {\r\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\r\n      const p = 2 * this.l - q;\r\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\r\n      g = HSLColor.hue2rgb(p, q, this.h);\r\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\r\n    }\r\n\r\n    return new Color(r * 255, g * 255, b * 255, this.a);\r\n  }\r\n\r\n  public toString(): string {\r\n    const h = this.h.toFixed(0),\r\n      s = this.s.toFixed(0),\r\n      l = this.l.toFixed(0),\r\n      a = this.a.toFixed(0);\r\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\r\n  }\r\n}\r\n","/* eslint-disable no-console */\r\n\r\nimport { Engine } from '../Engine';\r\nimport { vec } from '../Math/vector';\r\nimport { Color } from '../Color';\r\n\r\n/**\r\n * Logging level that Excalibur will tag\r\n */\r\nexport enum LogLevel {\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error,\r\n  Fatal\r\n}\r\n\r\n/**\r\n * Static singleton that represents the logging facility for Excalibur.\r\n * Excalibur comes built-in with a {@apilink ConsoleAppender} and {@apilink ScreenAppender}.\r\n * Derive from {@apilink Appender} to create your own logging appenders.\r\n */\r\nexport class Logger {\r\n  private static _INSTANCE: Logger = null;\r\n  private _appenders: Appender[] = [];\r\n\r\n  constructor() {\r\n    if (Logger._INSTANCE) {\r\n      throw new Error('Logger is a singleton');\r\n    }\r\n    Logger._INSTANCE = this;\r\n    // Default console appender\r\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the default logging level. Excalibur will only log\r\n   * messages if equal to or above this level. Default: {@apilink LogLevel.Info}\r\n   */\r\n  public defaultLevel: LogLevel = LogLevel.Info;\r\n\r\n  /**\r\n   * Gets the current static instance of Logger\r\n   */\r\n  public static getInstance(): Logger {\r\n    if (Logger._INSTANCE == null) {\r\n      Logger._INSTANCE = new Logger();\r\n    }\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Adds a new {@apilink Appender} to the list of appenders to write to\r\n   */\r\n  public addAppender(appender: Appender): void {\r\n    this._appenders.push(appender);\r\n  }\r\n\r\n  /**\r\n   * Clears all appenders from the logger\r\n   */\r\n  public clearAppenders(): void {\r\n    this._appenders.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at a given LogLevel\r\n   * @param level  The LogLevel`to log the message at\r\n   * @param args   An array of arguments to write to an appender\r\n   */\r\n  private _log(level: LogLevel, args: any[]): void {\r\n    if (level == null) {\r\n      level = this.defaultLevel;\r\n    }\r\n\r\n    const len = this._appenders.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (level >= this.defaultLevel) {\r\n        this._appenders[i].log(level, args);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _logOnceSet = new Set<any>();\r\n  private _logOnce(level: LogLevel, args: any[]): void {\r\n    const serialized = level + args.join('+');\r\n    if (this._logOnceSet.has(serialized)) {\r\n      return;\r\n    } else {\r\n      this._logOnceSet.add(serialized);\r\n      this._log(level, args);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Debug} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debug(...args: any[]): void {\r\n    this._log(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Fatal} level, if it sees the same args again it wont log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debugOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Info} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public info(...args: any[]): void {\r\n    this._log(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Info} level, if it sees the same args again it wont log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public infoOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Warn} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warn(...args: any[]): void {\r\n    this._log(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Warn} level, if it sees the same args again it won't log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warnOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Error} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public error(...args: any[]): void {\r\n    this._log(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Error} level, if it sees the same args again it won't log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public errorOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the {@apilink LogLevel.Fatal} level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatal(...args: any[]): void {\r\n    this._log(LogLevel.Fatal, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message once at the {@apilink LogLevel.Fatal} level, if it sees the same args again it won't log\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatalOnce(...args: any[]): void {\r\n    this._logOnce(LogLevel.Fatal, args);\r\n  }\r\n}\r\n\r\n/**\r\n * Contract for any log appender (such as console/screen)\r\n */\r\nexport interface Appender {\r\n  /**\r\n   * Logs a message at the given {@apilink LogLevel}\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  log(level: LogLevel, args: any[]): void;\r\n}\r\n\r\n/**\r\n * Console appender for browsers (i.e. `console.log`)\r\n */\r\nexport class ConsoleAppender implements Appender {\r\n  /**\r\n   * Logs a message at the given {@apilink LogLevel}\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    // Check for console support\r\n    if (!console && !console.log && console.warn && console.error) {\r\n      // todo maybe do something better than nothing\r\n      return;\r\n    }\r\n\r\n    // Create a new console args array\r\n    const consoleArgs: any[] = [];\r\n    consoleArgs.unshift.apply(consoleArgs, args);\r\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\r\n\r\n    if (level < LogLevel.Warn) {\r\n      // Call .log for Debug/Info\r\n      if (console.log.apply) {\r\n        // this is required on some older browsers that don't support apply on console.log :(\r\n        console.log.apply(console, consoleArgs);\r\n      } else {\r\n        console.log(consoleArgs.join(' '));\r\n      }\r\n    } else if (level < LogLevel.Error) {\r\n      // Call .warn for Warn\r\n      if (console.warn.apply) {\r\n        console.warn.apply(console, consoleArgs);\r\n      } else {\r\n        console.warn(consoleArgs.join(' '));\r\n      }\r\n    } else {\r\n      // Call .error for Error/Fatal\r\n      if (console.error.apply) {\r\n        console.error.apply(console, consoleArgs);\r\n      } else {\r\n        console.error(consoleArgs.join(' '));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport interface ScreenAppenderOptions {\r\n  engine: Engine;\r\n  /**\r\n   * Optionally set the width of the overlay canvas\r\n   */\r\n  width?: number;\r\n  /**\r\n   * Optionally set the height of the overlay canvas\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Adjust the text offset from the left side of the screen\r\n   */\r\n  xPos?: number;\r\n  /**\r\n   * Provide a text color\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the CSS zindex of the overlay canvas\r\n   */\r\n  zIndex?: number;\r\n}\r\n\r\n/**\r\n * On-screen (canvas) appender\r\n */\r\nexport class ScreenAppender implements Appender {\r\n  private _messages: string[] = [];\r\n  public canvas: HTMLCanvasElement;\r\n  private _ctx: CanvasRenderingContext2D;\r\n  private _pos = 10;\r\n  private _color = Color.Black;\r\n  private _options: ScreenAppenderOptions;\r\n  constructor(options: ScreenAppenderOptions) {\r\n    this._options = options;\r\n    this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    this._ctx = this.canvas.getContext('2d')!;\r\n    this.canvas.style.position = 'absolute';\r\n    this.canvas.style.zIndex = options.zIndex?.toString() ?? '99';\r\n    document.body.appendChild(this.canvas);\r\n    this._positionScreenAppenderCanvas();\r\n    options.engine.screen.events.on('resize', () => {\r\n      this._positionScreenAppenderCanvas();\r\n    });\r\n  }\r\n\r\n  private _positionScreenAppenderCanvas() {\r\n    const options = this._options;\r\n    this.canvas.width = options.width ?? options.engine.screen.resolution.width;\r\n    this.canvas.height = options.height ?? options.engine.screen.resolution.height;\r\n    this.canvas.style.position = 'absolute';\r\n    const pagePos = options.engine.screen.screenToPageCoordinates(vec(0, 0));\r\n    this.canvas.style.left = pagePos.x + 'px';\r\n    this.canvas.style.top = pagePos.y + 'px';\r\n    this._pos = options.xPos ?? this._pos;\r\n    this._color = options.color ?? this._color;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at the given {@apilink LogLevel}\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    const message = args.join(',');\r\n\r\n    this._ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\r\n\r\n    let pos = 10;\r\n\r\n    this._messages = this._messages.slice(0, 1000);\r\n    for (let i = 0; i < this._messages.length; i++) {\r\n      this._ctx.fillStyle = this._color.toRGBA();\r\n      this._ctx.fillText(this._messages[i], this._pos, pos);\r\n      pos += 10;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * An enum that describes the sides of an axis aligned box for collision\r\n */\r\nexport enum Side {\r\n  None = 'None',\r\n  Top = 'Top',\r\n  Bottom = 'Bottom',\r\n  Left = 'Left',\r\n  Right = 'Right'\r\n}\r\n\r\nexport module Side {\r\n  /**\r\n   * Returns the opposite side from the current\r\n   */\r\n  export function getOpposite(side: Side): Side {\r\n    if (side === Side.Top) {\r\n      return Side.Bottom;\r\n    }\r\n    if (side === Side.Bottom) {\r\n      return Side.Top;\r\n    }\r\n    if (side === Side.Left) {\r\n      return Side.Right;\r\n    }\r\n    if (side === Side.Right) {\r\n      return Side.Left;\r\n    }\r\n\r\n    return Side.None;\r\n  }\r\n\r\n  /**\r\n   * Given a vector, return the Side most in that direction\r\n   */\r\n  export function fromDirection(direction: Vector): Side {\r\n    if (Math.abs(direction.x) >= Math.abs(direction.y)) {\r\n      if (direction.x <= 0) {\r\n        return Side.Left;\r\n      }\r\n\r\n      return Side.Right;\r\n    }\r\n\r\n    if (direction.y <= 0) {\r\n      return Side.Top;\r\n    }\r\n\r\n    return Side.Bottom;\r\n  }\r\n}\r\n","import { sign } from './util';\r\nimport { Vector, vec } from './vector';\r\nimport { canonicalizeAngle } from './util';\r\n\r\nexport enum MatrixLocations {\r\n  X = 12,\r\n  Y = 13\r\n}\r\n\r\n/**\r\n * Excalibur Matrix helper for 4x4 matrices\r\n *\r\n * Useful for webgl 4x4 matrices\r\n */\r\nexport class Matrix {\r\n  /**\r\n   *  4x4 matrix in column major order\r\n   *\r\n   * |         |         |          |          |\r\n   * | ------- | ------- | -------- | -------- |\r\n   * | data[0] | data[4] | data[8]  | data[12] |\r\n   * | data[1] | data[5] | data[9]  | data[13] |\r\n   * | data[2] | data[6] | data[10] | data[14] |\r\n   * | data[3] | data[7] | data[11] | data[15] |\r\n   *\r\n   */\r\n  public data: Float32Array = new Float32Array(16);\r\n\r\n  /**\r\n   * Creates an orthographic (flat non-perspective) projection\r\n   * https://en.wikipedia.org/wiki/Orthographic_projection\r\n   * @param left\r\n   * @param right\r\n   * @param bottom\r\n   * @param top\r\n   * @param near\r\n   * @param far\r\n   */\r\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = 2 / (right - left);\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 2 / (top - bottom);\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = -2 / (far - near);\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = -(right + left) / (right - left);\r\n    mat.data[13] = -(top + bottom) / (top - bottom);\r\n    mat.data[14] = -(far + near) / (far - near);\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a new Matrix with the same data as the current 4x4\r\n   */\r\n  public clone(dest?: Matrix): Matrix {\r\n    const mat = dest || new Matrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = this.data[2];\r\n    mat.data[3] = this.data[3];\r\n\r\n    mat.data[4] = this.data[4];\r\n    mat.data[5] = this.data[5];\r\n    mat.data[6] = this.data[6];\r\n    mat.data[7] = this.data[7];\r\n\r\n    mat.data[8] = this.data[8];\r\n    mat.data[9] = this.data[9];\r\n    mat.data[10] = this.data[10];\r\n    mat.data[11] = this.data[11];\r\n\r\n    mat.data[12] = this.data[12];\r\n    mat.data[13] = this.data[13];\r\n    mat.data[14] = this.data[14];\r\n    mat.data[15] = this.data[15];\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Converts the current matrix into a DOMMatrix\r\n   *\r\n   * This is useful when working with the browser Canvas context\r\n   * @returns {DOMMatrix} DOMMatrix\r\n   */\r\n  public toDOMMatrix(): DOMMatrix {\r\n    return new DOMMatrix([...this.data]);\r\n  }\r\n\r\n  public static fromFloat32Array(data: Float32Array) {\r\n    const matrix = new Matrix();\r\n    matrix.data = data;\r\n    return matrix;\r\n  }\r\n\r\n  /**\r\n   * Creates a new identity matrix (a matrix that when applied does nothing)\r\n   */\r\n  public static identity(): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 1;\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = 0;\r\n    mat.data[13] = 0;\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Resets the current matrix to the identity matrix, mutating it\r\n   * @returns {Matrix} Current matrix as identity\r\n   */\r\n  public reset(): Matrix {\r\n    const mat = this;\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 1;\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = 0;\r\n    mat.data[13] = 0;\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new translation matrix at the specified 3d point\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public static translation(x: number, y: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[12] = x;\r\n    mat.data[13] = y;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new scaling matrix with the specified scaling factor\r\n   * @param sx\r\n   * @param sy\r\n   */\r\n  public static scale(sx: number, sy: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[0] = sx;\r\n    mat.data[5] = sy;\r\n    mat.data[10] = 1;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new rotation matrix with the specified angle in radians\r\n   * @param angle\r\n   */\r\n  public static rotation(angle: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[0] = Math.cos(angle);\r\n    mat.data[4] = -Math.sin(angle);\r\n    mat.data[1] = Math.sin(angle);\r\n    mat.data[5] = Math.cos(angle);\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Multiply the current matrix by a vector producing a new vector\r\n   * @param vector\r\n   * @param dest\r\n   */\r\n  multiply(vector: Vector, dest?: Vector): Vector;\r\n  /**\r\n   * Multiply the current matrix by another matrix producing a new matrix\r\n   * @param matrix\r\n   * @param dest\r\n   */\r\n  multiply(matrix: Matrix, dest?: Matrix): Matrix;\r\n  multiply(vectorOrMatrix: Vector | Matrix, dest?: Vector | Matrix): Vector | Matrix {\r\n    if (vectorOrMatrix instanceof Vector) {\r\n      const result = (dest as Vector) || new Vector(0, 0);\r\n      const vector = vectorOrMatrix;\r\n      // these shenanigans are to allow dest and vector to be the same instance\r\n      const resultX = vector.x * this.data[0] + vector.y * this.data[4] + this.data[12];\r\n      const resultY = vector.x * this.data[1] + vector.y * this.data[5] + this.data[13];\r\n\r\n      result.x = resultX;\r\n      result.y = resultY;\r\n      return result;\r\n    } else {\r\n      const result = (dest as Matrix) || new Matrix();\r\n      const other = vectorOrMatrix;\r\n      const a11 = this.data[0];\r\n      const a21 = this.data[1];\r\n      const a31 = this.data[2];\r\n      const a41 = this.data[3];\r\n\r\n      const a12 = this.data[4];\r\n      const a22 = this.data[5];\r\n      const a32 = this.data[6];\r\n      const a42 = this.data[7];\r\n\r\n      const a13 = this.data[8];\r\n      const a23 = this.data[9];\r\n      const a33 = this.data[10];\r\n      const a43 = this.data[11];\r\n\r\n      const a14 = this.data[12];\r\n      const a24 = this.data[13];\r\n      const a34 = this.data[14];\r\n      const a44 = this.data[15];\r\n\r\n      const b11 = other.data[0];\r\n      const b21 = other.data[1];\r\n      const b31 = other.data[2];\r\n      const b41 = other.data[3];\r\n\r\n      const b12 = other.data[4];\r\n      const b22 = other.data[5];\r\n      const b32 = other.data[6];\r\n      const b42 = other.data[7];\r\n\r\n      const b13 = other.data[8];\r\n      const b23 = other.data[9];\r\n      const b33 = other.data[10];\r\n      const b43 = other.data[11];\r\n\r\n      const b14 = other.data[12];\r\n      const b24 = other.data[13];\r\n      const b34 = other.data[14];\r\n      const b44 = other.data[15];\r\n\r\n      result.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n      result.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n      result.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n      result.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n\r\n      result.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n      result.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n      result.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n      result.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n\r\n      result.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n      result.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n      result.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n      result.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n\r\n      result.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n      result.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n      result.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n      result.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n      const s = this.getScale();\r\n      result._scaleSignX = sign(s.x) * sign(result._scaleSignX);\r\n      result._scaleSignY = sign(s.y) * sign(result._scaleSignY);\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies translation to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const a13 = this.data[8];\r\n    const a23 = this.data[9];\r\n    const a33 = this.data[10];\r\n    const a43 = this.data[11];\r\n\r\n    const a14 = this.data[12];\r\n    const a24 = this.data[13];\r\n    const a34 = this.data[14];\r\n    const a44 = this.data[15];\r\n\r\n    // Doesn't change z\r\n    const z = 0;\r\n    const w = 1;\r\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\r\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\r\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\r\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\r\n\r\n    return this;\r\n  }\r\n\r\n  public setPosition(x: number, y: number) {\r\n    this.data[12] = x;\r\n    this.data[13] = y;\r\n  }\r\n\r\n  public getPosition(): Vector {\r\n    return vec(this.data[12], this.data[13]);\r\n  }\r\n\r\n  /**\r\n   * Applies rotation to the current matrix mutating it\r\n   * @param angle in Radians\r\n   */\r\n  rotate(angle: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * a11 + sine * a12;\r\n    this.data[1] = cosine * a21 + sine * a22;\r\n    this.data[2] = cosine * a31 + sine * a32;\r\n    this.data[3] = cosine * a41 + sine * a42;\r\n\r\n    this.data[4] = cosine * a12 - sine * a11;\r\n    this.data[5] = cosine * a22 - sine * a21;\r\n    this.data[6] = cosine * a32 - sine * a31;\r\n    this.data[7] = cosine * a42 - sine * a41;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies scaling to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    this.data[0] = a11 * x;\r\n    this.data[1] = a21 * x;\r\n    this.data[2] = a31 * x;\r\n    this.data[3] = a41 * x;\r\n\r\n    this.data[4] = a12 * y;\r\n    this.data[5] = a22 * y;\r\n    this.data[6] = a32 * y;\r\n    this.data[7] = a42 * y;\r\n\r\n    return this;\r\n  }\r\n\r\n  public setRotation(angle: number) {\r\n    const currentScale = this.getScale();\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * currentScale.x;\r\n    this.data[1] = sine * currentScale.y;\r\n    this.data[4] = -sine * currentScale.x;\r\n    this.data[5] = cosine * currentScale.y;\r\n  }\r\n\r\n  public getRotation(): number {\r\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\r\n    return canonicalizeAngle(angle);\r\n  }\r\n\r\n  public getScaleX(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const xscale = vec(this.data[0], this.data[4]).magnitude;\r\n    return this._scaleSignX * xscale;\r\n  }\r\n\r\n  public getScaleY(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const yscale = vec(this.data[1], this.data[5]).magnitude;\r\n    return this._scaleSignY * yscale;\r\n  }\r\n\r\n  /**\r\n   * Get the scale of the matrix\r\n   */\r\n  public getScale(): Vector {\r\n    return vec(this.getScaleX(), this.getScaleY());\r\n  }\r\n\r\n  private _scaleX = 1;\r\n  private _scaleSignX = 1;\r\n  public setScaleX(val: number) {\r\n    if (this._scaleX === val) {\r\n      return;\r\n    }\r\n\r\n    this._scaleSignX = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\r\n    this.data[0] = xscale.x * val;\r\n    this.data[4] = xscale.y * val;\r\n    this._scaleX = val;\r\n  }\r\n\r\n  private _scaleY = 1;\r\n  private _scaleSignY = 1;\r\n  public setScaleY(val: number) {\r\n    if (this._scaleY === val) {\r\n      return;\r\n    }\r\n    this._scaleSignY = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\r\n    this.data[1] = yscale.x * val;\r\n    this.data[5] = yscale.y * val;\r\n    this._scaleY = val;\r\n  }\r\n\r\n  public setScale(scale: Vector) {\r\n    this.setScaleX(scale.x);\r\n    this.setScaleY(scale.y);\r\n  }\r\n\r\n  /**\r\n   * Determinant of the upper left 2x2 matrix\r\n   */\r\n  public getBasisDeterminant() {\r\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\r\n  }\r\n\r\n  /**\r\n   * Return the affine inverse, optionally store it in a target matrix.\r\n   *\r\n   * It's recommended you call .reset() the target unless you know what you're doing\r\n   * @param target\r\n   */\r\n  public getAffineInverse(target?: Matrix): Matrix {\r\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\r\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\r\n    // Since we are actually only doing 2D transformations we can use this hack\r\n    // We don't actually use the 3rd or 4th dimension\r\n\r\n    const det = this.getBasisDeterminant();\r\n    const inverseDet = 1 / det; // todo zero check\r\n    const a = this.data[0];\r\n    const b = this.data[4];\r\n    const c = this.data[1];\r\n    const d = this.data[5];\r\n\r\n    const m = target || Matrix.identity();\r\n    // inverts rotation and scale\r\n    m.data[0] = d * inverseDet;\r\n    m.data[1] = -c * inverseDet;\r\n    m.data[4] = -b * inverseDet;\r\n    m.data[5] = a * inverseDet;\r\n\r\n    const tx = this.data[12];\r\n    const ty = this.data[13];\r\n    // invert translation\r\n    // transform translation into the matrix basis created by rot/scale\r\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\r\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\r\n\r\n    return m;\r\n  }\r\n\r\n  public isIdentity(): boolean {\r\n    return (\r\n      this.data[0] === 1 &&\r\n      this.data[1] === 0 &&\r\n      this.data[2] === 0 &&\r\n      this.data[3] === 0 &&\r\n      this.data[4] === 0 &&\r\n      this.data[5] === 1 &&\r\n      this.data[6] === 0 &&\r\n      this.data[7] === 0 &&\r\n      this.data[8] === 0 &&\r\n      this.data[9] === 0 &&\r\n      this.data[10] === 1 &&\r\n      this.data[11] === 0 &&\r\n      this.data[12] === 0 &&\r\n      this.data[13] === 0 &&\r\n      this.data[14] === 0 &&\r\n      this.data[15] === 1\r\n    );\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\r\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\r\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\r\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\r\n`;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Ray } from '../Math/ray';\r\nimport { Color } from '../Color';\r\nimport { Side } from './Side';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { AffineMatrix } from '../Math/affine-matrix';\r\n\r\nexport interface BoundingBoxOptions {\r\n  left: number;\r\n  right: number;\r\n  top: number;\r\n  bottom: number;\r\n}\r\n\r\n/**\r\n * Axis Aligned collision primitive for Excalibur.\r\n */\r\nexport class BoundingBox {\r\n  public top: number;\r\n  public right: number;\r\n  public bottom: number;\r\n  public left: number;\r\n\r\n  /**\r\n   * Constructor allows passing of either an object with all coordinate components,\r\n   * or the coordinate components passed separately.\r\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\r\n   * containing the four coordinate components.\r\n   * @param top     y coordinate of the top edge\r\n   * @param right   x coordinate of the right edge\r\n   * @param bottom  y coordinate of the bottom edge\r\n   */\r\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\r\n    if (typeof leftOrOptions === 'object') {\r\n      this.left = leftOrOptions.left;\r\n      this.top = leftOrOptions.top;\r\n      this.right = leftOrOptions.right;\r\n      this.bottom = leftOrOptions.bottom;\r\n    } else if (typeof leftOrOptions === 'number') {\r\n      this.left = leftOrOptions;\r\n      this.top = top;\r\n      this.right = right;\r\n      this.bottom = bottom;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new instance of {@apilink BoundingBox} that is a copy of the current instance\r\n   */\r\n  public clone(dest?: BoundingBox): BoundingBox {\r\n    const result = dest || new BoundingBox(0, 0, 0, 0);\r\n    result.left = this.left;\r\n    result.right = this.right;\r\n    result.top = this.top;\r\n    result.bottom = this.bottom;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Resets the bounds to a zero width/height box\r\n   */\r\n  public reset(): void {\r\n    this.left = 0;\r\n    this.top = 0;\r\n    this.bottom = 0;\r\n    this.right = 0;\r\n  }\r\n\r\n  /**\r\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\r\n   * @param intersection Intersection vector between 2 bounding boxes\r\n   */\r\n  public static getSideFromIntersection(intersection: Vector): Side {\r\n    if (!intersection) {\r\n      return Side.None;\r\n    }\r\n    if (intersection) {\r\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\r\n        if (intersection.x < 0) {\r\n          return Side.Right;\r\n        }\r\n        return Side.Left;\r\n      } else {\r\n        if (intersection.y < 0) {\r\n          return Side.Bottom;\r\n        }\r\n        return Side.Top;\r\n      }\r\n    }\r\n    return Side.None;\r\n  }\r\n\r\n  public static fromPoints(points: Vector[]): BoundingBox {\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n    for (let i = 0; i < points.length; i++) {\r\n      if (points[i].x < minX) {\r\n        minX = points[i].x;\r\n      }\r\n      if (points[i].x > maxX) {\r\n        maxX = points[i].x;\r\n      }\r\n      if (points[i].y < minY) {\r\n        minY = points[i].y;\r\n      }\r\n      if (points[i].y > maxY) {\r\n        maxY = points[i].y;\r\n      }\r\n    }\r\n    return new BoundingBox(minX, minY, maxX, maxY);\r\n  }\r\n\r\n  /**\r\n   * Creates a bounding box from a width and height\r\n   * @param width\r\n   * @param height\r\n   * @param anchor Default Vector.Half\r\n   * @param pos Default Vector.Zero\r\n   */\r\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\r\n    return new BoundingBox(\r\n      -width * anchor.x + pos.x,\r\n      -height * anchor.y + pos.y,\r\n      width - width * anchor.x + pos.x,\r\n      height - height * anchor.y + pos.y\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns the calculated width of the bounding box\r\n   */\r\n  public get width() {\r\n    return this.right - this.left;\r\n  }\r\n\r\n  /**\r\n   * Returns the calculated height of the bounding box\r\n   */\r\n  public get height() {\r\n    return this.bottom - this.top;\r\n  }\r\n\r\n  /**\r\n   * Return whether the bounding box has zero dimensions in height,width or both\r\n   */\r\n  public hasZeroDimensions() {\r\n    return this.width === 0 || this.height === 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the center of the bounding box\r\n   */\r\n  public get center(): Vector {\r\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\r\n  }\r\n\r\n  public get topLeft(): Vector {\r\n    return new Vector(this.left, this.top);\r\n  }\r\n\r\n  public get bottomRight(): Vector {\r\n    return new Vector(this.right, this.bottom);\r\n  }\r\n\r\n  public get topRight(): Vector {\r\n    return new Vector(this.right, this.top);\r\n  }\r\n\r\n  public get bottomLeft(): Vector {\r\n    return new Vector(this.left, this.bottom);\r\n  }\r\n\r\n  public translate(pos: Vector): BoundingBox {\r\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\r\n  }\r\n\r\n  /**\r\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\r\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\r\n   */\r\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\r\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\r\n    return BoundingBox.fromPoints(points);\r\n  }\r\n\r\n  /**\r\n   * Scale a bounding box by a scale factor, optionally provide a point\r\n   * @param scale\r\n   * @param point\r\n   */\r\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\r\n    const shifted = this.translate(point);\r\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\r\n  }\r\n\r\n  /**\r\n   * Transform the axis aligned bounding box by a {@apilink Matrix}, producing a new axis aligned bounding box\r\n   * @param matrix\r\n   */\r\n  public transform(matrix: AffineMatrix) {\r\n    // inlined these calculations to not use vectors would speed it up slightly\r\n    // const matFirstColumn = vec(matrix.data[0], matrix.data[1]);\r\n    // const xa = matFirstColumn.scale(this.left);\r\n    const xa1 = matrix.data[0] * this.left;\r\n    const xa2 = matrix.data[1] * this.left;\r\n\r\n    // const xb = matFirstColumn.scale(this.right);\r\n    const xb1 = matrix.data[0] * this.right;\r\n    const xb2 = matrix.data[1] * this.right;\r\n\r\n    // const matSecondColumn = vec(matrix.data[2], matrix.data[3]);\r\n    // const ya = matSecondColumn.scale(this.top);\r\n    const ya1 = matrix.data[2] * this.top;\r\n    const ya2 = matrix.data[3] * this.top;\r\n\r\n    // const yb = matSecondColumn.scale(this.bottom);\r\n    const yb1 = matrix.data[2] * this.bottom;\r\n    const yb2 = matrix.data[3] * this.bottom;\r\n\r\n    const matrixPos = matrix.getPosition();\r\n    // const topLeft = Vector.min(xa, xb).add(Vector.min(ya, yb)).add(matrixPos);\r\n    // const bottomRight = Vector.max(xa, xb).add(Vector.max(ya, yb)).add(matrixPos);\r\n    const left = Math.min(xa1, xb1) + Math.min(ya1, yb1) + matrixPos.x;\r\n    const top = Math.min(xa2, xb2) + Math.min(ya2, yb2) + matrixPos.y;\r\n    const right = Math.max(xa1, xb1) + Math.max(ya1, yb1) + matrixPos.x;\r\n    const bottom = Math.max(xa2, xb2) + Math.max(ya2, yb2) + matrixPos.y;\r\n\r\n    return new BoundingBox({\r\n      left, //: topLeft.x,\r\n      top, //: topLeft.y,\r\n      right, //: bottomRight.x,\r\n      bottom //: bottomRight.y\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the perimeter of the bounding box\r\n   */\r\n  public getPerimeter(): number {\r\n    const wx = this.width;\r\n    const wy = this.height;\r\n    return 2 * (wx + wy);\r\n  }\r\n\r\n  // Cache bounding box point returns\r\n  private _points: Vector[] = [];\r\n  private _left?: number;\r\n  private _right?: number;\r\n  private _top?: number;\r\n  private _bottom?: number;\r\n\r\n  /**\r\n   * Returns the world space points that make up the corners of the bounding box as a polygon\r\n   */\r\n  public getPoints(): Vector[] {\r\n    if (this._left !== this.left || this._right !== this.right || this._top !== this.top || this._bottom !== this.bottom) {\r\n      this._points.length = 0;\r\n      this._points.push(new Vector(this.left, this.top));\r\n      this._points.push(new Vector(this.right, this.top));\r\n      this._points.push(new Vector(this.right, this.bottom));\r\n      this._points.push(new Vector(this.left, this.bottom));\r\n      this._left = this.left;\r\n      this._right = this.right;\r\n      this._top = this.top;\r\n      this._bottom = this.bottom;\r\n    }\r\n    return this._points;\r\n  }\r\n\r\n  /**\r\n   * Determines whether a ray intersects with a bounding box\r\n   */\r\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\r\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\r\n    let tMin = -Infinity;\r\n    let tMax = +Infinity;\r\n\r\n    const xInv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\r\n    const yInv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\r\n\r\n    const tx1 = (this.left - ray.pos.x) * xInv;\r\n    const tx2 = (this.right - ray.pos.x) * xInv;\r\n    tMin = Math.min(tx1, tx2);\r\n    tMax = Math.max(tx1, tx2);\r\n\r\n    const ty1 = (this.top - ray.pos.y) * yInv;\r\n    const ty2 = (this.bottom - ray.pos.y) * yInv;\r\n    tMin = Math.max(tMin, Math.min(ty1, ty2));\r\n    tMax = Math.min(tMax, Math.max(ty1, ty2));\r\n\r\n    return tMax >= Math.max(0, tMin) && tMin < farClipDistance;\r\n  }\r\n\r\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\r\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\r\n    let tMin = -Infinity;\r\n    let tMax = +Infinity;\r\n\r\n    const xInv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\r\n    const yInv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\r\n\r\n    const tx1 = (this.left - ray.pos.x) * xInv;\r\n    const tx2 = (this.right - ray.pos.x) * xInv;\r\n    tMin = Math.min(tx1, tx2);\r\n    tMax = Math.max(tx1, tx2);\r\n\r\n    const ty1 = (this.top - ray.pos.y) * yInv;\r\n    const ty2 = (this.bottom - ray.pos.y) * yInv;\r\n    tMin = Math.max(tMin, Math.min(ty1, ty2));\r\n    tMax = Math.min(tMax, Math.max(ty1, ty2));\r\n\r\n    if (tMax >= Math.max(0, tMin) && tMin < farClipDistance) {\r\n      return tMin;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a point is contained within the bounding box\r\n   * @param p  The point to test\r\n   */\r\n  public contains(p: Vector): boolean;\r\n\r\n  /**\r\n   * Tests whether another bounding box is totally contained in this one\r\n   * @param bb  The bounding box to test\r\n   */\r\n  public contains(bb: BoundingBox): boolean;\r\n  public contains(val: any): boolean {\r\n    if (val instanceof Vector) {\r\n      return this.left <= val.x && this.top <= val.y && val.y <= this.bottom && val.x <= this.right;\r\n    } else if (val instanceof BoundingBox) {\r\n      return this.left <= val.left && this.top <= val.top && val.bottom <= this.bottom && val.right <= this.right;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Combines this bounding box and another together returning a new bounding box\r\n   * @param other  The bounding box to combine\r\n   */\r\n  public combine(other: BoundingBox, dest?: BoundingBox): BoundingBox {\r\n    const compositeBB = dest || new BoundingBox(0, 0, 0, 0);\r\n    const left = Math.min(this.left, other.left);\r\n    const top = Math.min(this.top, other.top);\r\n    const right = Math.max(this.right, other.right);\r\n    const bottom = Math.max(this.bottom, other.bottom);\r\n    compositeBB.left = left;\r\n    compositeBB.top = top;\r\n    compositeBB.right = right;\r\n    compositeBB.bottom = bottom;\r\n    return compositeBB;\r\n  }\r\n\r\n  public get dimensions(): Vector {\r\n    return new Vector(this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the bounding boxes overlap.\r\n   * @param other\r\n   * @param epsilon Optionally specify a small epsilon (default 0) as amount of overlap to ignore as overlap.\r\n   * This epsilon is useful in stable collision simulations.\r\n   */\r\n  public overlaps(other: BoundingBox, epsilon?: number): boolean {\r\n    const e = epsilon || 0;\r\n    if (other.hasZeroDimensions()) {\r\n      return this.contains(other);\r\n    }\r\n    if (this.hasZeroDimensions()) {\r\n      return other.contains(this);\r\n    }\r\n    const totalBoundingBox = this.combine(other);\r\n    return totalBoundingBox.width + e < other.width + this.width && totalBoundingBox.height + e < other.height + this.height;\r\n  }\r\n\r\n  /**\r\n   * Test wether this bounding box intersects with another returning\r\n   * the intersection vector that can be used to resolve the collision. If there\r\n   * is no intersection null is returned.\r\n   * @param other  Other {@apilink BoundingBox} to test intersection with\r\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\r\n   */\r\n  public intersect(other: BoundingBox): Vector {\r\n    const totalBoundingBox = this.combine(other);\r\n\r\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\r\n    if (\r\n      totalBoundingBox.width < other.width + this.width &&\r\n      totalBoundingBox.height < other.height + this.height &&\r\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\r\n      !totalBoundingBox.dimensions.equals(this.dimensions)\r\n    ) {\r\n      // collision\r\n      let overlapX = 0;\r\n      // right edge is between the other's left and right edge\r\n      /**\r\n       *     +-this-+\r\n       *     |      |\r\n       *     |    +-other-+\r\n       *     +----|-+     |\r\n       *          |       |\r\n       *          +-------+\r\n       *         <---\r\n       *          ^ overlap\r\n       */\r\n      if (this.right >= other.left && this.right <= other.right) {\r\n        overlapX = other.left - this.right;\r\n        // right edge is past the other's right edge\r\n        /**\r\n         *     +-other-+\r\n         *     |       |\r\n         *     |    +-this-+\r\n         *     +----|--+   |\r\n         *          |      |\r\n         *          +------+\r\n         *          --->\r\n         *          ^ overlap\r\n         */\r\n      } else {\r\n        overlapX = other.right - this.left;\r\n      }\r\n\r\n      let overlapY = 0;\r\n      // top edge is between the other's top and bottom edge\r\n      /**\r\n       *     +-other-+\r\n       *     |       |\r\n       *     |    +-this-+   | <- overlap\r\n       *     +----|--+   |   |\r\n       *          |      |  \\ /\r\n       *          +------+   '\r\n       */\r\n      if (this.top <= other.bottom && this.top >= other.top) {\r\n        overlapY = other.bottom - this.top;\r\n        // top edge is above the other top edge\r\n        /**\r\n         *     +-this-+         .\r\n         *     |      |        / \\\r\n         *     |    +-other-+   | <- overlap\r\n         *     +----|-+     |   |\r\n         *          |       |\r\n         *          +-------+\r\n         */\r\n      } else {\r\n        overlapY = other.top - this.bottom;\r\n      }\r\n\r\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\r\n        return new Vector(overlapX, 0);\r\n      } else {\r\n        return new Vector(0, overlapY);\r\n      }\r\n      // Case of total containment of one bounding box by another\r\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\r\n      let overlapX = 0;\r\n      // this is wider than the other\r\n      if (this.width - other.width >= 0) {\r\n        // This right edge is closest to the others right edge\r\n        if (this.right - other.right <= other.left - this.left) {\r\n          overlapX = other.left - this.right;\r\n          // This left edge is closest to the others left edge\r\n        } else {\r\n          overlapX = other.right - this.left;\r\n        }\r\n        // other is wider than this\r\n      } else {\r\n        // This right edge is closest to the others right edge\r\n        if (other.right - this.right <= this.left - other.left) {\r\n          overlapX = this.left - other.right;\r\n          // This left edge is closest to the others left edge\r\n        } else {\r\n          overlapX = this.right - other.left;\r\n        }\r\n      }\r\n\r\n      let overlapY = 0;\r\n      // this is taller than other\r\n      if (this.height - other.height >= 0) {\r\n        // The bottom edge is closest to the others bottom edge\r\n        if (this.bottom - other.bottom <= other.top - this.top) {\r\n          overlapY = other.top - this.bottom;\r\n        } else {\r\n          overlapY = other.bottom - this.top;\r\n        }\r\n        // other is taller than this\r\n      } else {\r\n        // The bottom edge is closest to the others bottom edge\r\n        if (other.bottom - this.bottom <= this.top - other.top) {\r\n          overlapY = this.top - other.bottom;\r\n        } else {\r\n          overlapY = this.bottom - other.top;\r\n        }\r\n      }\r\n\r\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\r\n        return new Vector(overlapX, 0);\r\n      } else {\r\n        return new Vector(0, overlapY);\r\n      }\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\r\n   * @param bb The other actor to test\r\n   */\r\n  public intersectWithSide(bb: BoundingBox): Side {\r\n    const intersect = this.intersect(bb);\r\n    return BoundingBox.getSideFromIntersection(intersect);\r\n  }\r\n\r\n  /**\r\n   * Draw a debug bounding box\r\n   * @param ex\r\n   * @param color\r\n   */\r\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\r\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { Clock } from './Clock';\r\nimport { Future } from './Future';\r\n\r\n/**\r\n * Find the screen position of an HTML element\r\n */\r\nexport function getPosition(el: HTMLElement): Vector {\r\n  // do we need the scroll too? technically the offset method before did that\r\n  if (el && el.getBoundingClientRect) {\r\n    const rect = el.getBoundingClientRect();\r\n    return vec(rect.x + window.scrollX, rect.y + window.scrollY);\r\n  }\r\n  return Vector.Zero;\r\n}\r\n\r\n/**\r\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\r\n  if (array.indexOf(item) === -1) {\r\n    array.push(item);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Remove an item from an list\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\r\n  let index = -1;\r\n  if ((index = array.indexOf(item)) > -1) {\r\n    array.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * See if an array contains something\r\n */\r\nexport function contains(array: Array<any>, obj: any): boolean {\r\n  for (let i = 0; i < array.length; i++) {\r\n    if (array[i] === obj) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Used for exhaustive checks at compile time\r\n */\r\nexport function fail(message: never): never {\r\n  throw new Error(message);\r\n}\r\n\r\n/**\r\n * Create a promise that resolves after a certain number of milliseconds\r\n *\r\n * It is strongly recommended you pass the excalibur clock so delays are bound to the\r\n * excalibur clock which would be unaffected by stop/pause.\r\n * @param milliseconds\r\n * @param clock\r\n */\r\nexport function delay(milliseconds: number, clock?: Clock): Promise<void> {\r\n  const future = new Future<void>();\r\n  const schedule = clock?.schedule.bind(clock) ?? setTimeout;\r\n  schedule(() => {\r\n    future.resolve();\r\n  }, milliseconds);\r\n  return future.promise;\r\n}\r\n\r\n/**\r\n * Remove keys from object literals\r\n * @param object\r\n * @param keys\r\n */\r\nexport function omit<TObject extends Object, Keys extends keyof TObject>(object: TObject, keys: Keys[]) {\r\n  const newObj: Omit<TObject, Keys> = {} as any;\r\n  for (const key in object) {\r\n    if (!keys.includes(key as any)) {\r\n      (newObj as any)[key] = object[key];\r\n    }\r\n  }\r\n  return newObj;\r\n}\r\n\r\n/**\r\n * Simple object check.\r\n * @param item\r\n */\r\nexport function isObject(item: any): item is object {\r\n  return item && typeof item === 'object' && !Array.isArray(item);\r\n}\r\n\r\n/**\r\n * Deep merge two objects.\r\n * @param target\r\n * @param sources\r\n */\r\nexport function mergeDeep<T extends object>(target: T, ...sources: T[]) {\r\n  if (!sources.length) {\r\n    return target;\r\n  }\r\n  const source = sources.shift();\r\n\r\n  if (isObject(target) && isObject(source)) {\r\n    for (const key in source) {\r\n      if (isObject(source[key])) {\r\n        if (!target[key]) {\r\n          Object.assign(target, { [key]: {} });\r\n        }\r\n        mergeDeep(target[key] as any, source[key]);\r\n      } else {\r\n        Object.assign(target, { [key]: source[key] });\r\n      }\r\n    }\r\n  }\r\n\r\n  return mergeDeep(target, ...sources);\r\n}\r\n","import { Matrix } from './matrix';\r\nimport { canonicalizeAngle, sign } from './util';\r\nimport { vec, Vector } from './vector';\r\n\r\nexport class AffineMatrix {\r\n  /**\r\n   * |         |         |          |\r\n   * | ------- | ------- | -------- |\r\n   * | data[0] | data[2] | data[4]  |\r\n   * | data[1] | data[3] | data[5]  |\r\n   * |   0     |    0    |    1     |\r\n   */\r\n  public data = new Float64Array(6);\r\n\r\n  /**\r\n   * Converts the current matrix into a DOMMatrix\r\n   *\r\n   * This is useful when working with the browser Canvas context\r\n   * @returns {DOMMatrix} DOMMatrix\r\n   */\r\n  public toDOMMatrix(): DOMMatrix {\r\n    return new DOMMatrix([...this.data]);\r\n  }\r\n\r\n  public static identity(): AffineMatrix {\r\n    const mat = new AffineMatrix();\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 1;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 0;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new translation matrix at the specified 3d point\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public static translation(x: number, y: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[4] = x;\r\n    mat.data[5] = y;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new scaling matrix with the specified scaling factor\r\n   * @param sx\r\n   * @param sy\r\n   */\r\n  public static scale(sx: number, sy: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[0] = sx;\r\n    mat.data[3] = sy;\r\n    mat._scale[0] = sx;\r\n    mat._scale[1] = sy;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new rotation matrix with the specified angle in radians\r\n   * @param angle\r\n   */\r\n  public static rotation(angle: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[0] = Math.cos(angle);\r\n    mat.data[1] = Math.sin(angle);\r\n    mat.data[2] = -Math.sin(angle);\r\n    mat.data[3] = Math.cos(angle);\r\n    return mat;\r\n  }\r\n\r\n  public setPosition(x: number, y: number) {\r\n    this.data[4] = x;\r\n    this.data[5] = y;\r\n  }\r\n\r\n  public getPosition(): Vector {\r\n    return vec(this.data[4], this.data[5]);\r\n  }\r\n\r\n  /**\r\n   * Applies rotation to the current matrix mutating it\r\n   * @param angle in Radians\r\n   */\r\n  rotate(angle: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * a11 + sine * a12;\r\n    this.data[1] = cosine * a21 + sine * a22;\r\n\r\n    this.data[2] = cosine * a12 - sine * a11;\r\n    this.data[3] = cosine * a22 - sine * a21;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies translation to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    // const a31 = 0;\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n    // const a32 = 0;\r\n\r\n    const a13 = this.data[4];\r\n    const a23 = this.data[5];\r\n    // const a33 = 1;\r\n\r\n    // Doesn't change z\r\n    this.data[4] = a11 * x + a12 * y + a13;\r\n    this.data[5] = a21 * x + a22 * y + a23;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies scaling to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n\r\n    this.data[0] = a11 * x;\r\n    this.data[1] = a21 * x;\r\n\r\n    this.data[2] = a12 * y;\r\n    this.data[3] = a22 * y;\r\n\r\n    this._scale[0] = x;\r\n    this._scale[1] = y;\r\n    this._scaleSignX = sign(x);\r\n    this._scaleSignY = sign(y);\r\n    return this;\r\n  }\r\n\r\n  public determinant() {\r\n    return this.data[0] * this.data[3] - this.data[1] * this.data[2];\r\n  }\r\n\r\n  /**\r\n   * Return the affine inverse, optionally store it in a target matrix.\r\n   *\r\n   * It's recommended you call .reset() the target unless you know what you're doing\r\n   * @param target\r\n   */\r\n  public inverse(target?: AffineMatrix): AffineMatrix {\r\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\r\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\r\n    // Since we are actually only doing 2D transformations we can use this hack\r\n    // We don't actually use the 3rd or 4th dimension\r\n\r\n    const det = this.determinant();\r\n    let inverseDet = det; // default to a zero matrix if we have a singular matrix\r\n    if (det !== 0) {\r\n      inverseDet = 1 / det;\r\n    }\r\n    const a = this.data[0];\r\n    const b = this.data[2];\r\n    const c = this.data[1];\r\n    const d = this.data[3];\r\n\r\n    const m = target || AffineMatrix.identity();\r\n    // inverts rotation and scale\r\n    m.data[0] = d * inverseDet;\r\n    m.data[1] = -c * inverseDet;\r\n    m.data[2] = -b * inverseDet;\r\n    m.data[3] = a * inverseDet;\r\n\r\n    const tx = this.data[4];\r\n    const ty = this.data[5];\r\n    // invert translation\r\n    // transform translation into the matrix basis created by rot/scale\r\n    m.data[4] = -(tx * m.data[0] + ty * m.data[2]);\r\n    m.data[5] = -(tx * m.data[1] + ty * m.data[3]);\r\n\r\n    return m;\r\n  }\r\n\r\n  /**\r\n   * Multiply the current matrix by a vector producing a new vector\r\n   * @param vector\r\n   * @param dest\r\n   */\r\n  multiply(vector: Vector, dest?: Vector): Vector;\r\n  /**\r\n   * Multiply the current matrix by another matrix producing a new matrix\r\n   * @param matrix\r\n   * @param dest\r\n   */\r\n  multiply(matrix: AffineMatrix, dest?: AffineMatrix): AffineMatrix;\r\n  multiply(vectorOrMatrix: Vector | AffineMatrix, dest?: Vector | AffineMatrix): Vector | AffineMatrix {\r\n    if (vectorOrMatrix instanceof Vector) {\r\n      const result = (dest as Vector) || new Vector(0, 0);\r\n      const vector = vectorOrMatrix;\r\n      // these shenanigans are to allow dest and vector to be the same instance\r\n      const resultX = vector.x * this.data[0] + vector.y * this.data[2] + this.data[4];\r\n      const resultY = vector.x * this.data[1] + vector.y * this.data[3] + this.data[5];\r\n\r\n      result.x = resultX;\r\n      result.y = resultY;\r\n      return result;\r\n    } else {\r\n      const result = (dest as AffineMatrix) || new AffineMatrix();\r\n      const other = vectorOrMatrix;\r\n      const a11 = this.data[0];\r\n      const a21 = this.data[1];\r\n      //  const a31 = 0;\r\n\r\n      const a12 = this.data[2];\r\n      const a22 = this.data[3];\r\n      //  const a32 = 0;\r\n\r\n      const a13 = this.data[4];\r\n      const a23 = this.data[5];\r\n      //  const a33 = 1;\r\n\r\n      const b11 = other.data[0];\r\n      const b21 = other.data[1];\r\n      //  const b31 = 0;\r\n\r\n      const b12 = other.data[2];\r\n      const b22 = other.data[3];\r\n      //  const b32 = 0;\r\n\r\n      const b13 = other.data[4];\r\n      const b23 = other.data[5];\r\n      //  const b33 = 1;\r\n\r\n      result.data[0] = a11 * b11 + a12 * b21; // + a13 * b31; // zero\r\n      result.data[1] = a21 * b11 + a22 * b21; // + a23 * b31; // zero\r\n\r\n      result.data[2] = a11 * b12 + a12 * b22; // + a13 * b32; // zero\r\n      result.data[3] = a21 * b12 + a22 * b22; // + a23 * b32; // zero\r\n\r\n      result.data[4] = a11 * b13 + a12 * b23 + a13; // * b33; // one\r\n      result.data[5] = a21 * b13 + a22 * b23 + a23; // * b33; // one\r\n\r\n      const signX = this._scaleSignX;\r\n      const signY = this._scaleSignY;\r\n      result._scaleSignX = signX * sign(result._scaleSignX);\r\n      result._scaleSignY = signY * sign(result._scaleSignY);\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Packed array of length 8, that contains 4 vertices, with 2 components each\r\n   * So: [x0, y0, x1, y1, x2, y2, x3, y3]\r\n   * @param quad\r\n   */\r\n  multiplyQuadInPlace(quad: number[]) {\r\n    const resultTopLeftX = quad[0] * this.data[0] + quad[1] * this.data[2] + this.data[4];\r\n    const resultTopLeftY = quad[0] * this.data[1] + quad[1] * this.data[3] + this.data[5];\r\n    quad[0] = resultTopLeftX;\r\n    quad[1] = resultTopLeftY;\r\n\r\n    const resultTopRightX = quad[2] * this.data[0] + quad[3] * this.data[2] + this.data[4];\r\n    const resultTopRightY = quad[2] * this.data[1] + quad[3] * this.data[3] + this.data[5];\r\n    quad[2] = resultTopRightX;\r\n    quad[3] = resultTopRightY;\r\n\r\n    const resultBottomLeftX = quad[4] * this.data[0] + quad[5] * this.data[2] + this.data[4];\r\n    const resultBottomLeftY = quad[4] * this.data[1] + quad[5] * this.data[3] + this.data[5];\r\n    quad[4] = resultBottomLeftX;\r\n    quad[5] = resultBottomLeftY;\r\n\r\n    const resultBottomRightX = quad[6] * this.data[0] + quad[7] * this.data[2] + this.data[4];\r\n    const resultBottomRightY = quad[6] * this.data[1] + quad[7] * this.data[3] + this.data[5];\r\n    quad[6] = resultBottomRightX;\r\n    quad[7] = resultBottomRightY;\r\n  }\r\n\r\n  to4x4() {\r\n    const mat = new Matrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = this.data[2];\r\n    mat.data[5] = this.data[3];\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = this.data[4];\r\n    mat.data[13] = this.data[5];\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  public setRotation(angle: number) {\r\n    const currentScale = this.getScale();\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * currentScale.x;\r\n    this.data[1] = sine * currentScale.y;\r\n    this.data[2] = -sine * currentScale.x;\r\n    this.data[3] = cosine * currentScale.y;\r\n  }\r\n\r\n  public getRotation(): number {\r\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\r\n    return canonicalizeAngle(angle);\r\n  }\r\n\r\n  public getScaleX(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const xScaleSq = this.data[0] * this.data[0] + this.data[2] * this.data[2];\r\n    if (xScaleSq === 1.0) {\r\n      // usually there isn't scale so we can avoid a sqrt\r\n      return this._scaleSignX;\r\n    }\r\n    return this._scaleSignX * Math.sqrt(xScaleSq);\r\n  }\r\n\r\n  public getScaleY(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const yScaleSq = this.data[1] * this.data[1] + this.data[3] * this.data[3];\r\n    if (yScaleSq === 1.0) {\r\n      // usually there isn't scale so we can avoid a sqrt\r\n      return this._scaleSignY;\r\n    }\r\n    return this._scaleSignY * Math.sqrt(yScaleSq);\r\n  }\r\n\r\n  /**\r\n   * Get the scale of the matrix\r\n   */\r\n  public getScale(): Vector {\r\n    return vec(this.getScaleX(), this.getScaleY());\r\n  }\r\n\r\n  private _scale = new Float64Array([1, 1]);\r\n  private _scaleSignX = 1;\r\n  public setScaleX(val: number) {\r\n    if (val === this._scale[0]) {\r\n      return;\r\n    }\r\n    this._scaleSignX = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[2] * this._scaleSignX).normalize();\r\n    this.data[0] = xscale.x * val;\r\n    this.data[2] = xscale.y * val;\r\n    this._scale[0] = val;\r\n  }\r\n\r\n  private _scaleSignY = 1;\r\n  public setScaleY(val: number) {\r\n    if (val === this._scale[1]) {\r\n      return;\r\n    }\r\n    this._scaleSignY = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[3] * this._scaleSignY).normalize();\r\n    this.data[1] = yscale.x * val;\r\n    this.data[3] = yscale.y * val;\r\n    this._scale[1] = val;\r\n  }\r\n\r\n  public setScale(scale: Vector) {\r\n    this.setScaleX(scale.x);\r\n    this.setScaleY(scale.y);\r\n  }\r\n\r\n  public isIdentity(): boolean {\r\n    return this.data[0] === 1 && this.data[1] === 0 && this.data[2] === 0 && this.data[3] === 1 && this.data[4] === 0 && this.data[5] === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the current matrix to the identity matrix, mutating it\r\n   * @returns {AffineMatrix} Current matrix as identity\r\n   */\r\n  public reset(): AffineMatrix {\r\n    const mat = this;\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 1;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 0;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a new Matrix with the same data as the current {@apilink AffineMatrix}\r\n   */\r\n  public clone(dest?: AffineMatrix): AffineMatrix {\r\n    const mat = dest || new AffineMatrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = this.data[2];\r\n    mat.data[3] = this.data[3];\r\n    mat.data[4] = this.data[4];\r\n    mat.data[5] = this.data[5];\r\n    mat._scaleSignX = this._scaleSignX;\r\n    mat._scaleSignY = this._scaleSignY;\r\n    return mat;\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\n[${this.data[0]} ${this.data[2]} ${this.data[4]}]\r\n[${this.data[1]} ${this.data[3]} ${this.data[5]}]\r\n[0 0 1]\r\n`;\r\n  }\r\n}\r\n","export class RentalPool<T> {\r\n  private _pool: T[] = [];\r\n  private _size: number = 0;\r\n  constructor(\r\n    public builder: () => T,\r\n    public cleaner: (used: T) => T,\r\n    preAllocate: number = 1\r\n  ) {\r\n    this.grow(preAllocate);\r\n  }\r\n\r\n  /**\r\n   * Grow the pool size by an amount\r\n   * @param amount\r\n   */\r\n  grow(amount: number): void {\r\n    if (amount > 0) {\r\n      this._size += amount;\r\n      for (let i = 0; i < amount; i++) {\r\n        this._pool.push(this.builder());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rent an object from the pool, optionally clean it. If not cleaned previous state may be set.\r\n   *\r\n   * The pool will automatically double if depleted\r\n   * @param clean\r\n   */\r\n  rent(clean: boolean = false): T {\r\n    if (this._pool.length === 0) {\r\n      this.grow(this._size);\r\n    }\r\n\r\n    return clean ? this.cleaner(this._pool.pop()) : this._pool.pop();\r\n  }\r\n\r\n  /**\r\n   * Return an object to the pool\r\n   * @param object\r\n   */\r\n  return(object: T): void {\r\n    this._pool.push(object);\r\n  }\r\n}\r\n","import { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { RentalPool } from '../../Util/RentalPool';\r\n\r\nexport class TransformStack {\r\n  private _pool = new RentalPool(\r\n    () => AffineMatrix.identity(),\r\n    (mat) => mat.reset(),\r\n    100\r\n  );\r\n  private _transforms: AffineMatrix[] = [];\r\n\r\n  private _currentTransform: AffineMatrix = this._pool.rent(true);\r\n\r\n  public save(): void {\r\n    this._transforms.push(this._currentTransform);\r\n    this._currentTransform = this._currentTransform.clone(this._pool.rent());\r\n  }\r\n\r\n  public restore(): void {\r\n    this._pool.return(this._currentTransform);\r\n    this._currentTransform = this._transforms.pop()!;\r\n  }\r\n\r\n  public translate(x: number, y: number): AffineMatrix {\r\n    return this._currentTransform.translate(x, y);\r\n  }\r\n\r\n  public rotate(angle: number): AffineMatrix {\r\n    return this._currentTransform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): AffineMatrix {\r\n    return this._currentTransform.scale(x, y);\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentTransform.reset();\r\n  }\r\n\r\n  public set current(matrix: AffineMatrix) {\r\n    this._currentTransform = matrix;\r\n  }\r\n\r\n  public get current(): AffineMatrix {\r\n    return this._currentTransform;\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { RentalPool } from '../../Util/RentalPool';\r\nimport { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\nimport { Material } from './material';\r\n\r\nexport class ContextState implements ExcaliburGraphicsContextState {\r\n  opacity: number = 1;\r\n  z: number = 0;\r\n  tint: Color | null | undefined = Color.White;\r\n  material: Material | null | undefined = null;\r\n}\r\n\r\nexport class StateStack {\r\n  private _pool = new RentalPool<ContextState>(\r\n    () => new ContextState(),\r\n    (s) => {\r\n      s.opacity = 1;\r\n      s.z = 0;\r\n      s.tint = Color.White;\r\n      s.material = null;\r\n      return s;\r\n    },\r\n    100\r\n  );\r\n  public current: ExcaliburGraphicsContextState = this._pool.rent(true);\r\n  private _states: ExcaliburGraphicsContextState[] = [];\r\n\r\n  private _cloneState(dest: ContextState) {\r\n    dest.opacity = this.current.opacity;\r\n    dest.z = this.current.z;\r\n    dest.tint = this.current.tint?.clone();\r\n    dest.material = this.current.material; // TODO is this going to cause problems when cloning\r\n    return dest;\r\n  }\r\n\r\n  public save(): void {\r\n    this._states.push(this.current);\r\n    this.current = this._cloneState(this._pool.rent());\r\n  }\r\n\r\n  public restore(): void {\r\n    this._pool.return(this.current);\r\n    this.current = this._states.pop()!;\r\n  }\r\n}\r\n","import { Loadable } from '../Interfaces/Loadable';\r\nimport { Logger } from '../Util/Log';\r\nimport { EventEmitter } from '../EventEmitter';\r\n\r\nexport type ResourceEvents = {\r\n  complete: any;\r\n  load: ProgressEvent<XMLHttpRequestEventTarget>;\r\n  loadstart: ProgressEvent<XMLHttpRequestEventTarget>;\r\n  progress: ProgressEvent<XMLHttpRequestEventTarget>;\r\n  error: ProgressEvent<XMLHttpRequestEventTarget>;\r\n};\r\n\r\nexport const ResourceEvents = {\r\n  Complete: 'complete',\r\n  Load: 'load',\r\n  LoadStart: 'loadstart',\r\n  Progress: 'progress',\r\n  Error: 'error'\r\n};\r\n\r\n/**\r\n * The {@apilink Resource} type allows games built in Excalibur to load generic resources.\r\n * For any type of remote resource it is recommended to use {@apilink Resource} for preloading.\r\n */\r\nexport class Resource<T> implements Loadable<T> {\r\n  public data: T = null;\r\n  public logger: Logger = Logger.getInstance();\r\n  public events = new EventEmitter();\r\n\r\n  /**\r\n   * @param path          Path to the remote resource\r\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\r\n   * @param bustCache     Whether or not to cache-bust requests\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\r\n    public bustCache: boolean = false\r\n  ) {}\r\n\r\n  /**\r\n   * Returns true if the Resource is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return this.data !== null;\r\n  }\r\n\r\n  private _cacheBust(uri: string): string {\r\n    const query: RegExp = /\\?\\w*=\\w*/;\r\n    if (query.test(uri)) {\r\n      uri += '&__=' + Date.now();\r\n    } else {\r\n      uri += '?__=' + Date.now();\r\n    }\r\n    return uri;\r\n  }\r\n  /**\r\n   * Begin loading the resource and returns a promise to be resolved on completion\r\n   */\r\n  public load(): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      // Exit early if we already have data\r\n      if (this.data !== null) {\r\n        this.logger.debug('Already have data for resource', this.path);\r\n        this.events.emit('complete', this.data as any);\r\n        resolve(this.data);\r\n        return;\r\n      }\r\n\r\n      const request = new XMLHttpRequest();\r\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\r\n      request.responseType = this.responseType;\r\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\r\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\r\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\r\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\r\n      request.addEventListener('load', () => {\r\n        // XHR on file:// success status is 0, such as with PhantomJS\r\n        if (request.status !== 0 && request.status !== 200) {\r\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\r\n          this.events.emit('error', request.response);\r\n          reject(new Error(request.statusText));\r\n          return;\r\n        }\r\n\r\n        if (request.response instanceof Blob && request.response.type === 'text/html') {\r\n          const errorText = `Expected blob (usually image) data from the server when loading ${this.path}, but got HTML content instead!\r\n\r\nCheck your server configuration, for example Vite serves static files from the /public folder`;\r\n          this.events.emit('error', request.response);\r\n          reject(new Error(errorText));\r\n          return;\r\n        }\r\n\r\n        this.data = request.response;\r\n        this.events.emit('complete', this.data as any);\r\n        this.logger.debug('Completed loading resource', this.path);\r\n        resolve(this.data);\r\n      });\r\n      request.send();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * Watch an object with a proxy, only fires if property value is different\r\n */\r\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        if ((obj as any)[prop] !== value) {\r\n          (obj as any)[prop] = value;\r\n          // Avoid watching private junk\r\n          if (typeof prop === 'string') {\r\n            if (prop[0] !== '_') {\r\n              change(obj);\r\n            }\r\n          }\r\n        }\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n\r\nconst createHandler = <T>(path: string[] = [], change: (type: T) => any, typeType: T) => ({\r\n  get: (target: T, key: string): any => {\r\n    if (key === '__isProxy') {\r\n      return true;\r\n    }\r\n    if (typeof (target as any)[key] === 'object' && (target as any)[key] != null) {\r\n      return new Proxy((target as any)[key], createHandler<any>([...path, key as string], change, typeType));\r\n    }\r\n    return (target as any)[key];\r\n  },\r\n  set: (target: T, key: string, value: any) => {\r\n    if (typeof key === 'string') {\r\n      if (key[0] !== '_') {\r\n        change(typeType);\r\n      }\r\n    }\r\n    (target as any)[key] = value;\r\n    return true;\r\n  }\r\n});\r\n\r\n/**\r\n *\r\n */\r\nexport function watchDeep<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, createHandler<T>([], change, type));\r\n  }\r\n  return type;\r\n}\r\n\r\n/**\r\n * Watch an object with a proxy, fires change on any property value change\r\n */\r\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        (obj as any)[prop] = value;\r\n        // Avoid watching private junk\r\n        if (typeof prop === 'string') {\r\n          if (prop[0] !== '_') {\r\n            change(obj);\r\n          }\r\n        }\r\n\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { watch } from '../Util/Watch';\r\nimport { AffineMatrix } from '../Math/affine-matrix';\r\n\r\nexport interface GraphicOptions {\r\n  /**\r\n   * The width of the graphic\r\n   */\r\n  width?: number;\r\n  /**\r\n   * The height of the graphic\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Should the graphic be flipped horizontally\r\n   */\r\n  flipHorizontal?: boolean;\r\n  /**\r\n   * Should the graphic be flipped vertically\r\n   */\r\n  flipVertical?: boolean;\r\n  /**\r\n   * The rotation of the graphic\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * The scale of the graphic\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * The opacity of the graphic between (0 -1)\r\n   */\r\n  opacity?: number;\r\n  /**\r\n   * The tint of the graphic, this color will be multiplied by the original pixel colors\r\n   */\r\n  tint?: Color;\r\n  /**\r\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image in pixels\r\n   */\r\n  origin?: Vector;\r\n}\r\n\r\n/**\r\n * A Graphic is the base Excalibur primitive for something that can be drawn to the {@apilink ExcaliburGraphicsContext}.\r\n * {@apilink Sprite}, {@apilink Animation}, {@apilink GraphicsGroup}, {@apilink Canvas}, {@apilink Rectangle}, {@apilink Circle}, and {@apilink Polygon} all derive from the\r\n * {@apilink Graphic} abstract class.\r\n *\r\n * Implementors of a Graphic must override the abstract {@apilink Graphic._drawImage} method to render an image to the graphics context. Graphic\r\n * handles all the position, rotation, and scale transformations in {@apilink Graphic._preDraw} and {@apilink Graphic._postDraw}\r\n */\r\nexport abstract class Graphic {\r\n  private static _ID: number = 0;\r\n  readonly id = Graphic._ID++;\r\n\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public tint?: Color;\r\n\r\n  private _transformStale = true;\r\n  public isStale() {\r\n    return this._transformStale;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets wether to show debug information about the graphic\r\n   */\r\n  public showDebug: boolean = false;\r\n\r\n  private _flipHorizontal = false;\r\n  /**\r\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\r\n   */\r\n  public get flipHorizontal(): boolean {\r\n    return this._flipHorizontal;\r\n  }\r\n\r\n  public set flipHorizontal(value: boolean) {\r\n    this._flipHorizontal = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _flipVertical = false;\r\n  /**\r\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\r\n   */\r\n  public get flipVertical(): boolean {\r\n    return this._flipVertical;\r\n  }\r\n\r\n  public set flipVertical(value: boolean) {\r\n    this._flipVertical = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _rotation = 0;\r\n  /**\r\n   * Gets or sets the rotation of the graphic\r\n   */\r\n  public get rotation(): number {\r\n    return this._rotation;\r\n  }\r\n\r\n  public set rotation(value: number) {\r\n    this._rotation = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  private _scale = Vector.One;\r\n  /**\r\n   * Gets or sets the scale of the graphic, this affects the width and\r\n   */\r\n  public get scale() {\r\n    return this._scale;\r\n  }\r\n\r\n  public set scale(value: Vector) {\r\n    this._scale = watch(value, () => {\r\n      this._transformStale = true;\r\n    });\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _origin?: Vector;\r\n  /**\r\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\r\n   */\r\n  public get origin(): Vector | undefined {\r\n    return this._origin;\r\n  }\r\n\r\n  public set origin(value: Vector | undefined) {\r\n    if (value) {\r\n      this._origin = watch(value, () => {\r\n        this._transformStale = true;\r\n      });\r\n    }\r\n    this._transformStale = true;\r\n  }\r\n\r\n  constructor(options?: GraphicOptions) {\r\n    if (options) {\r\n      this.origin = options.origin ?? this.origin;\r\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\r\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\r\n      this.rotation = options.rotation ?? this.rotation;\r\n      this.opacity = options.opacity ?? this.opacity;\r\n      this.scale = options.scale ?? this.scale;\r\n      this.tint = options.tint ?? this.tint;\r\n      if (options.width) {\r\n        this._width = options.width;\r\n      }\r\n\r\n      if (options.height) {\r\n        this._height = options.height;\r\n      }\r\n    }\r\n  }\r\n\r\n  public cloneGraphicOptions(): GraphicOptions {\r\n    return {\r\n      width: this.width / this.scale.x,\r\n      height: this.height / this.scale.y,\r\n      origin: this.origin ? this.origin.clone() : undefined,\r\n      flipHorizontal: this.flipHorizontal,\r\n      flipVertical: this.flipVertical,\r\n      rotation: this.rotation,\r\n      opacity: this.opacity,\r\n      scale: this.scale ? this.scale.clone() : undefined,\r\n      tint: this.tint ? this.tint.clone() : undefined\r\n    };\r\n  }\r\n\r\n  private _width: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the width of the graphic (always positive)\r\n   */\r\n  public get width() {\r\n    return Math.abs(this._width * this.scale.x);\r\n  }\r\n\r\n  private _height: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the height of the graphic (always positive)\r\n   */\r\n  public get height() {\r\n    return Math.abs(this._height * this.scale.y);\r\n  }\r\n\r\n  public set width(value: number) {\r\n    this._width = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  public set height(value: number) {\r\n    this._height = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  /**\r\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * Draw the whole graphic to the context including transform\r\n   * @param ex The excalibur graphics context\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    this._preDraw(ex, x, y);\r\n    this._drawImage(ex, 0, 0);\r\n    this._postDraw(ex);\r\n  }\r\n\r\n  /**\r\n   * Meant to be overridden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\r\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by {@apilink Graphic._preDraw}\r\n   * and {@apilink Graphic._postDraw}\r\n   * @param ex The excalibur graphics context\r\n   * @param x\r\n   * @param y\r\n   */\r\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\r\n\r\n  /**\r\n   * Apply affine transformations to the graphics context to manipulate the graphic before {@apilink Graphic._drawImage}\r\n   * @param ex\r\n   * @param x\r\n   * @param y\r\n   */\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    ex.save();\r\n    ex.translate(x, y);\r\n    if (this._transformStale) {\r\n      this.transform.reset();\r\n      this.transform.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\r\n      this._rotate(this.transform);\r\n      this._flip(this.transform);\r\n      this._transformStale = false;\r\n    }\r\n    ex.multiply(this.transform);\r\n    // it is important to multiply alphas so graphics respect the current context\r\n    ex.opacity = ex.opacity * this.opacity;\r\n    if (this.tint) {\r\n      ex.tint = this.tint;\r\n    }\r\n  }\r\n\r\n  protected _rotate(ex: ExcaliburGraphicsContext | AffineMatrix) {\r\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\r\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\r\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\r\n    ex.translate(origin.x, origin.y);\r\n    ex.rotate(this.rotation);\r\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\r\n    ex.scale(scaleDirX, scaleDirY);\r\n    ex.translate(-origin.x, -origin.y);\r\n  }\r\n\r\n  protected _flip(ex: ExcaliburGraphicsContext | AffineMatrix) {\r\n    if (this.flipHorizontal) {\r\n      ex.translate(this.width / this.scale.x, 0);\r\n      ex.scale(-1, 1);\r\n    }\r\n\r\n    if (this.flipVertical) {\r\n      ex.translate(0, this.height / this.scale.y);\r\n      ex.scale(1, -1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply any additional work after {@apilink Graphic._drawImage} and restore the context state.\r\n   * @param ex\r\n   */\r\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\r\n    if (this.showDebug) {\r\n      ex.debug.drawRect(0, 0, this.width, this.height);\r\n    }\r\n    ex.restore();\r\n  }\r\n\r\n  /**\r\n   * Returns a new instance of the graphic that has the same properties\r\n   */\r\n  abstract clone(): Graphic;\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ImageSource } from './ImageSource';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport type SourceView = { x: number; y: number; width: number; height: number };\r\nexport type DestinationSize = { width: number; height: number };\r\n\r\nexport interface SpriteOptions {\r\n  /**\r\n   * Image to create a sprite from\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * By default the source is the entire dimension of the {@apilink ImageSource}\r\n   */\r\n  sourceView?: { x: number; y: number; width: number; height: number };\r\n  /**\r\n   * By default the size of the final sprite is the size of the {@apilink ImageSource}\r\n   */\r\n  destSize?: { width: number; height: number };\r\n}\r\n\r\nexport class Sprite extends Graphic {\r\n  private _logger = Logger.getInstance();\r\n  public image: ImageSource;\r\n  public sourceView: SourceView;\r\n  public destSize: DestinationSize;\r\n  private _dirty = true;\r\n\r\n  public static from(image: ImageSource, options?: Omit<GraphicOptions & SpriteOptions, 'image'>): Sprite {\r\n    return new Sprite({\r\n      image,\r\n      ...options\r\n    });\r\n  }\r\n\r\n  constructor(options: GraphicOptions & SpriteOptions) {\r\n    super(options);\r\n    this.image = options.image;\r\n    const { width, height } = options;\r\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\r\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\r\n    this._updateSpriteDimensions();\r\n    // Fire when loaded\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    this.image.ready.then(() => {\r\n      this._updateSpriteDimensions();\r\n    });\r\n  }\r\n\r\n  public override get width(): number {\r\n    return Math.abs(this.destSize.width * this.scale.x);\r\n  }\r\n\r\n  public override get height(): number {\r\n    return Math.abs(this.destSize.height * this.scale.y);\r\n  }\r\n\r\n  public override set width(newWidth: number) {\r\n    newWidth /= Math.abs(this.scale.x);\r\n    this.destSize.width = newWidth;\r\n    super.width = Math.ceil(this.destSize.width);\r\n  }\r\n\r\n  public override set height(newHeight: number) {\r\n    newHeight /= Math.abs(this.scale.y);\r\n    this.destSize.height = newHeight;\r\n    super.height = Math.ceil(this.destSize.height);\r\n  }\r\n\r\n  private _updateSpriteDimensions() {\r\n    const { width: nativeWidth, height: nativeHeight } = this.image;\r\n    // This code uses || to avoid 0's\r\n    // If the source is not specified, use the native dimension\r\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\r\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\r\n\r\n    // If the destination is not specified, use the source if specified, then native\r\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\r\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\r\n\r\n    this.width = Math.ceil(this.destSize.width) * this.scale.x;\r\n    this.height = Math.ceil(this.destSize.height) * this.scale.y;\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded() && this._dirty) {\r\n      this._dirty = false;\r\n      this._updateSpriteDimensions();\r\n    }\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      ex.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x,\r\n        this.sourceView.y,\r\n        this.sourceView.width,\r\n        this.sourceView.height,\r\n        x,\r\n        y,\r\n        this.destSize.width,\r\n        this.destSize.height\r\n      );\r\n    } else {\r\n      this._logger.warnOnce(\r\n        `ImageSource ${this.image.path}` +\r\n          ` is not yet loaded and won't be drawn. Please call .load() or include in a Loader.\\n\\n` +\r\n          `Read https://excaliburjs.com/docs/imagesource for more information.`\r\n      );\r\n    }\r\n  }\r\n\r\n  public clone(): Sprite {\r\n    return new Sprite({\r\n      image: this.image,\r\n      sourceView: { ...this.sourceView },\r\n      destSize: { ...this.destSize },\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n}\r\n","/**\r\n * Describes the different image filtering modes\r\n */\r\nexport enum ImageFiltering {\r\n  /**\r\n   * Pixel is useful when you do not want smoothing aka antialiasing applied to your graphics.\r\n   *\r\n   * Useful for Pixel art aesthetics.\r\n   */\r\n  Pixel = 'Pixel',\r\n\r\n  /**\r\n   * Blended is useful when you have high resolution artwork and would like it blended and smoothed\r\n   */\r\n  Blended = 'Blended'\r\n}\r\n\r\n/**\r\n * Parse the image filtering attribute value, if it doesn't match returns null\r\n */\r\nexport function parseImageFiltering(val: string): ImageFiltering | undefined {\r\n  switch (val) {\r\n    case ImageFiltering.Pixel:\r\n      return ImageFiltering.Pixel;\r\n    case ImageFiltering.Blended:\r\n      return ImageFiltering.Blended;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n","/**\r\n * Describes the different image wrapping modes\r\n */\r\nexport enum ImageWrapping {\r\n  Clamp = 'Clamp',\r\n\r\n  Repeat = 'Repeat',\r\n\r\n  Mirror = 'Mirror'\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function parseImageWrapping(val: string): ImageWrapping {\r\n  switch (val) {\r\n    case ImageWrapping.Clamp:\r\n      return ImageWrapping.Clamp;\r\n    case ImageWrapping.Repeat:\r\n      return ImageWrapping.Repeat;\r\n    case ImageWrapping.Mirror:\r\n      return ImageWrapping.Mirror;\r\n    default:\r\n      return ImageWrapping.Clamp;\r\n  }\r\n}\r\n","import { GarbageCollector } from '../../GarbageCollector';\r\nimport { Logger } from '../../Util/Log';\r\nimport { ImageFiltering } from '../Filtering';\r\nimport { ImageSourceOptions, ImageWrapConfiguration } from '../ImageSource';\r\nimport { ImageWrapping } from '../Wrapping';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\n\r\n/**\r\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\r\n */\r\nexport class TextureLoader {\r\n  private static _LOGGER = Logger.getInstance();\r\n\r\n  constructor(\r\n    gl: WebGL2RenderingContext,\r\n    private _garbageCollector?: {\r\n      garbageCollector: GarbageCollector;\r\n      collectionInterval: number;\r\n    }\r\n  ) {\r\n    this._gl = gl;\r\n    TextureLoader._MAX_TEXTURE_SIZE = gl.getParameter(gl.MAX_TEXTURE_SIZE);\r\n    if (this._garbageCollector) {\r\n      TextureLoader._LOGGER.debug('WebGL Texture collection interval:', this._garbageCollector.collectionInterval);\r\n      this._garbageCollector.garbageCollector?.registerCollector('texture', this._garbageCollector.collectionInterval, this._collect);\r\n    }\r\n  }\r\n\r\n  public dispose() {\r\n    for (const [image] of this._textureMap) {\r\n      this.delete(image);\r\n    }\r\n    this._textureMap.clear();\r\n    this._gl = null as any;\r\n  }\r\n\r\n  /**\r\n   * Sets the default filtering for the Excalibur texture loader, default {@apilink ImageFiltering.Blended}\r\n   */\r\n  public static filtering: ImageFiltering = ImageFiltering.Blended;\r\n  public static wrapping: ImageWrapConfiguration = { x: ImageWrapping.Clamp, y: ImageWrapping.Clamp };\r\n\r\n  private _gl: WebGL2RenderingContext;\r\n\r\n  private _textureMap = new Map<HTMLImageSource, WebGLTexture>();\r\n\r\n  private static _MAX_TEXTURE_SIZE: number = 4096;\r\n\r\n  /**\r\n   * Get the WebGL Texture from a source image\r\n   * @param image\r\n   */\r\n  public get(image: HTMLImageSource): WebGLTexture {\r\n    return this._textureMap.get(image)!;\r\n  }\r\n\r\n  /**\r\n   * Returns whether a source image has been loaded as a texture\r\n   * @param image\r\n   */\r\n  public has(image: HTMLImageSource): boolean {\r\n    return this._textureMap.has(image)!;\r\n  }\r\n\r\n  /**\r\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\r\n   * @param image Source graphic\r\n   * @param options {ImageSourceOptions} Optionally configure the ImageFiltering and ImageWrapping mode to apply to the loaded texture\r\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\r\n   */\r\n  public load(image: HTMLImageSource, options?: ImageSourceOptions, forceUpdate = false): WebGLTexture | null {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = this._gl;\r\n    if (!gl) {\r\n      return null;\r\n    }\r\n\r\n    const { filtering, wrapping } = { ...options };\r\n\r\n    let tex: WebGLTexture | null = null;\r\n    // If reuse the texture if it's from the same source\r\n    if (this.has(image)) {\r\n      tex = this.get(image);\r\n    }\r\n\r\n    // Update existing webgl texture and return early\r\n    if (tex) {\r\n      if (forceUpdate) {\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n      }\r\n      this._garbageCollector?.garbageCollector.touch(image);\r\n      return tex;\r\n    }\r\n\r\n    // No texture exists create a new one\r\n    tex = gl.createTexture();\r\n\r\n    // TODO implement texture gc with weakmap and timer\r\n    TextureLoader.checkImageSizeSupportedAndLog(image);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n\r\n    let wrappingConfig: ImageWrapConfiguration | undefined;\r\n    if (wrapping) {\r\n      if (typeof wrapping === 'string') {\r\n        wrappingConfig = {\r\n          x: wrapping,\r\n          y: wrapping\r\n        };\r\n      } else {\r\n        wrappingConfig = {\r\n          x: wrapping.x,\r\n          y: wrapping.y\r\n        };\r\n      }\r\n    }\r\n    const { x: xWrap, y: yWrap } = wrappingConfig ?? TextureLoader.wrapping;\r\n    switch (xWrap) {\r\n      case ImageWrapping.Clamp:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        break;\r\n      case ImageWrapping.Repeat:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\r\n        break;\r\n      case ImageWrapping.Mirror:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.MIRRORED_REPEAT);\r\n        break;\r\n      default:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    }\r\n    switch (yWrap) {\r\n      case ImageWrapping.Clamp:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        break;\r\n      case ImageWrapping.Repeat:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\r\n        break;\r\n      case ImageWrapping.Mirror:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.MIRRORED_REPEAT);\r\n        break;\r\n      default:\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    }\r\n\r\n    // NEAREST for pixel art, LINEAR for hi-res\r\n    const filterMode = filtering ?? TextureLoader.filtering;\r\n\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\r\n\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n\r\n    this._textureMap.set(image, tex!);\r\n    this._garbageCollector?.garbageCollector.addCollectableResource('texture', image);\r\n    return tex;\r\n  }\r\n\r\n  public delete(image: HTMLImageSource): void {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = this._gl;\r\n    if (!gl) {\r\n      return;\r\n    }\r\n\r\n    if (this.has(image)) {\r\n      const texture = this.get(image);\r\n      if (texture) {\r\n        this._textureMap.delete(image);\r\n        gl.deleteTexture(texture);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Takes an image and returns if it meets size criteria for hardware\r\n   * @param image\r\n   * @returns if the image will be supported at runtime\r\n   */\r\n  public static checkImageSizeSupportedAndLog(image: HTMLImageSource) {\r\n    const originalSrc = image.dataset.originalSrc ?? 'internal canvas bitmap';\r\n    if (image.width > TextureLoader._MAX_TEXTURE_SIZE || image.height > TextureLoader._MAX_TEXTURE_SIZE) {\r\n      TextureLoader._LOGGER.error(\r\n        `The image [${originalSrc}] provided to Excalibur is too large for the device's maximum texture size of ` +\r\n          `(${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image ` +\r\n          `for excalibur to render properly.\\n\\nImages will likely render as black rectangles.\\n\\n` +\r\n          `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`\r\n      );\r\n      return false;\r\n    } else if (image.width > 4096 || image.height > 4096) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits\r\n      TextureLoader._LOGGER.warn(\r\n        `The image [${originalSrc}] provided to excalibur is too large may not work on all mobile devices, ` +\r\n          `it is recommended you resize images to a maximum (4096x4096).\\n\\n` +\r\n          `Images will likely render as black rectangles on some mobile platforms.\\n\\n` +\r\n          `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`\r\n      );\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Looks for textures that haven't been drawn in a while\r\n   */\r\n  private _collect = (image: HTMLImageSource) => {\r\n    if (this._gl) {\r\n      const name = image.dataset.originalSrc ?? image.constructor.name;\r\n      TextureLoader._LOGGER.debug(`WebGL Texture for ${name} collected`);\r\n      this.delete(image);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Sprite, SpriteOptions } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { Logger } from '../Util/Log';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { Future } from '../Util/Future';\r\nimport { TextureLoader } from '../Graphics/Context/texture-loader';\r\nimport { ImageWrapping } from './Wrapping';\r\nimport { GraphicOptions } from './Graphic';\r\n\r\nexport interface ImageSourceOptions {\r\n  filtering?: ImageFiltering;\r\n  wrapping?: ImageWrapConfiguration | ImageWrapping;\r\n  bustCache?: boolean;\r\n}\r\n\r\nexport interface ImageWrapConfiguration {\r\n  x: ImageWrapping;\r\n  y: ImageWrapping;\r\n}\r\n\r\nexport const ImageSourceAttributeConstants = {\r\n  Filtering: 'filtering',\r\n  WrappingX: 'wrapping-x',\r\n  WrappingY: 'wrapping-y'\r\n} as const;\r\n\r\nexport class ImageSource implements Loadable<HTMLImageElement> {\r\n  private _logger = Logger.getInstance();\r\n  private _resource: Resource<Blob>;\r\n  public filtering?: ImageFiltering;\r\n  public wrapping?: ImageWrapConfiguration;\r\n\r\n  /**\r\n   * The original size of the source image in pixels\r\n   */\r\n  public get width() {\r\n    return this.image.naturalWidth;\r\n  }\r\n\r\n  /**\r\n   * The original height of the source image in pixels\r\n   */\r\n  public get height() {\r\n    return this.image.naturalHeight;\r\n  }\r\n\r\n  private _src?: string;\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    if (!this._src) {\r\n      // this boosts speed of access\r\n      this._src = this.data.src;\r\n    }\r\n    return !!this._src;\r\n  }\r\n\r\n  /**\r\n   * Access to the underlying html image element\r\n   */\r\n  public data: HTMLImageElement = new Image();\r\n  public get image(): HTMLImageElement {\r\n    return this.data;\r\n  }\r\n\r\n  private _readyFuture = new Future<HTMLImageElement>();\r\n  /**\r\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\r\n   */\r\n  public ready: Promise<HTMLImageElement> = this._readyFuture.promise;\r\n\r\n  public readonly path: string;\r\n\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param pathOrBase64 {string} Path to the image resource relative from the HTML document hosting the game, or absolute\r\n   * @param options\r\n   */\r\n  constructor(pathOrBase64: string, options?: ImageSourceOptions);\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param pathOrBase64 {string} Path to the image resource relative from the HTML document hosting the game, or absolute\r\n   * @param bustCache {boolean} Should excalibur add a cache busting querystring?\r\n   * @param filtering {ImageFiltering} Optionally override the image filtering set by {@apilink EngineOptions.antialiasing}\r\n   */\r\n  constructor(pathOrBase64: string, bustCache: boolean, filtering?: ImageFiltering);\r\n  constructor(pathOrBase64: string, bustCacheOrOptions: boolean | ImageSourceOptions | undefined, filtering?: ImageFiltering) {\r\n    this.path = pathOrBase64;\r\n    let bustCache: boolean | undefined = false;\r\n    let wrapping: ImageWrapConfiguration | ImageWrapping | undefined;\r\n    if (typeof bustCacheOrOptions === 'boolean') {\r\n      bustCache = bustCacheOrOptions;\r\n    } else {\r\n      ({ filtering, wrapping, bustCache } = { ...bustCacheOrOptions });\r\n    }\r\n    this._resource = new Resource(pathOrBase64, 'blob', bustCache);\r\n    this.filtering = filtering ?? this.filtering;\r\n    if (typeof wrapping === 'string') {\r\n      this.wrapping = {\r\n        x: wrapping,\r\n        y: wrapping\r\n      };\r\n    } else {\r\n      this.wrapping = wrapping ?? this.wrapping;\r\n    }\r\n    if (pathOrBase64.endsWith('.gif')) {\r\n      this._logger.warn(\r\n        `Use the ex.Gif type to load gifs, you may have mixed results with ${pathOrBase64} in ex.ImageSource. Fully supported: svg, jpg, bmp, and png`\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an ImageSource from and HTML <image> tag element\r\n   * @param image\r\n   */\r\n  static fromHtmlImageElement(image: HTMLImageElement, options?: ImageSourceOptions) {\r\n    const imageSource = new ImageSource('');\r\n    imageSource._src = 'image-element';\r\n    imageSource.data = image;\r\n    imageSource.data.setAttribute('data-original-src', 'image-element');\r\n\r\n    if (options?.filtering) {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, options?.filtering);\r\n    } else {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, ImageFiltering.Blended);\r\n    }\r\n\r\n    if (options?.wrapping) {\r\n      let wrapping: ImageWrapConfiguration;\r\n      if (typeof options.wrapping === 'string') {\r\n        wrapping = {\r\n          x: options.wrapping,\r\n          y: options.wrapping\r\n        };\r\n      } else {\r\n        wrapping = {\r\n          x: options.wrapping.x,\r\n          y: options.wrapping.y\r\n        };\r\n      }\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, wrapping.x);\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, wrapping.y);\r\n    } else {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, ImageWrapping.Clamp);\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, ImageWrapping.Clamp);\r\n    }\r\n\r\n    TextureLoader.checkImageSizeSupportedAndLog(image);\r\n    imageSource._readyFuture.resolve(image);\r\n    return imageSource;\r\n  }\r\n\r\n  static fromHtmlCanvasElement(image: HTMLCanvasElement, options?: ImageSourceOptions): ImageSource {\r\n    const imageSource = new ImageSource('');\r\n    imageSource._src = 'canvas-element-blob';\r\n    imageSource.data.setAttribute('data-original-src', 'canvas-element-blob');\r\n\r\n    if (options?.filtering) {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, options?.filtering);\r\n    } else {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.Filtering, ImageFiltering.Blended);\r\n    }\r\n\r\n    if (options?.wrapping) {\r\n      let wrapping: ImageWrapConfiguration;\r\n      if (typeof options.wrapping === 'string') {\r\n        wrapping = {\r\n          x: options.wrapping,\r\n          y: options.wrapping\r\n        };\r\n      } else {\r\n        wrapping = {\r\n          x: options.wrapping.x,\r\n          y: options.wrapping.y\r\n        };\r\n      }\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, wrapping.x);\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, wrapping.y);\r\n    } else {\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingX, ImageWrapping.Clamp);\r\n      imageSource.data.setAttribute(ImageSourceAttributeConstants.WrappingY, ImageWrapping.Clamp);\r\n    }\r\n\r\n    TextureLoader.checkImageSizeSupportedAndLog(image);\r\n\r\n    image.toBlob((blob) => {\r\n      // TODO throw? if blob null?\r\n      const url = URL.createObjectURL(blob!);\r\n      imageSource.image.onload = () => {\r\n        // no longer need to read the blob so it's revoked\r\n        URL.revokeObjectURL(url);\r\n        imageSource.data = imageSource.image;\r\n        imageSource._readyFuture.resolve(imageSource.image);\r\n      };\r\n      imageSource.image.src = url;\r\n    });\r\n\r\n    return imageSource;\r\n  }\r\n\r\n  static fromSvgString(svgSource: string, options?: ImageSourceOptions) {\r\n    const blob = new Blob([svgSource], { type: 'image/svg+xml' });\r\n    const url = URL.createObjectURL(blob);\r\n    return new ImageSource(url, options);\r\n  }\r\n\r\n  /**\r\n   * Should excalibur add a cache busting querystring? By default false.\r\n   * Must be set before loading\r\n   */\r\n  public get bustCache() {\r\n    return this._resource.bustCache;\r\n  }\r\n\r\n  public set bustCache(val: boolean) {\r\n    this._resource.bustCache = val;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the image and returns a promise that resolves when the image is loaded\r\n   */\r\n  async load(): Promise<HTMLImageElement> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      // Use Image.onload over Image.decode()\r\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=1055828#c7\r\n      // Otherwise chrome will throw still Image.decode() failures for large textures\r\n      const loadedFuture = new Future<void>();\r\n      image.onload = () => loadedFuture.resolve();\r\n      image.src = url;\r\n      image.setAttribute('data-original-src', this.path);\r\n\r\n      await loadedFuture.promise;\r\n\r\n      // Set results\r\n      // We defer loading the texture into webgl until the first draw that way we avoid a singleton\r\n      // and for the multi-engine case the texture needs to be created in EACH webgl context to work\r\n      // See image-renderer.ts draw()\r\n      this.data = image;\r\n\r\n      // emit warning if potentially too big\r\n      TextureLoader.checkImageSizeSupportedAndLog(this.data);\r\n    } catch (error: any) {\r\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\r\n    }\r\n    // Do a bad thing to pass the filtering as an attribute\r\n    this.data.setAttribute(ImageSourceAttributeConstants.Filtering, this.filtering as any); // TODO fix type\r\n    this.data.setAttribute(ImageSourceAttributeConstants.WrappingX, this.wrapping?.x ?? ImageWrapping.Clamp);\r\n    this.data.setAttribute(ImageSourceAttributeConstants.WrappingY, this.wrapping?.y ?? ImageWrapping.Clamp);\r\n\r\n    // todo emit complete\r\n    this._readyFuture.resolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Build a sprite from this ImageSource\r\n   */\r\n  public toSprite(options?: Omit<GraphicOptions & SpriteOptions, 'image'>): Sprite {\r\n    return Sprite.from(this, options);\r\n  }\r\n\r\n  /**\r\n   * Unload images from memory\r\n   */\r\n  unload(): void {\r\n    this.data = new Image();\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { FontRenderer } from './FontCommon';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Sprite } from './Sprite';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\n\r\nexport interface SpriteFontOptions {\r\n  /**\r\n   * Alphabet string in spritesheet order (default is row column order)\r\n   * example: 'abcdefghijklmnopqrstuvwxyz'\r\n   */\r\n  alphabet: string;\r\n  /**\r\n   * {@apilink SpriteSheet} to source character sprites from\r\n   */\r\n  spriteSheet: SpriteSheet;\r\n  /**\r\n   * Optionally ignore case in the supplied text;\r\n   */\r\n  caseInsensitive?: boolean;\r\n  /**\r\n   * Optionally override the text line height, useful for multiline text. If unset will use default.\r\n   */\r\n  lineHeight?: number | undefined;\r\n  /**\r\n   * Optionally adjust the spacing between character sprites\r\n   */\r\n  spacing?: number;\r\n  /**\r\n   * Optionally specify a \"shadow\"\r\n   */\r\n  shadow?: { offset: Vector };\r\n}\r\n\r\nexport class SpriteFont extends Graphic implements FontRenderer {\r\n  private _text: string = '';\r\n  public alphabet: string = '';\r\n  public spriteSheet: SpriteSheet;\r\n\r\n  public shadow?: { offset: Vector } = undefined;\r\n  public caseInsensitive = false;\r\n  public spacing: number = 0;\r\n  public lineHeight: number | undefined = undefined;\r\n\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(options: SpriteFontOptions & GraphicOptions) {\r\n    super(options);\r\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow, lineHeight } = options;\r\n    this.alphabet = alphabet;\r\n    this.spriteSheet = spriteSheet;\r\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\r\n    this.spacing = spacing ?? this.spacing;\r\n    this.shadow = shadow ?? this.shadow;\r\n    this.lineHeight = lineHeight ?? this.lineHeight;\r\n  }\r\n\r\n  private _getCharacterSprites(text: string): Sprite[] {\r\n    const results: Sprite[] = [];\r\n    // handle case insensitive\r\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\r\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\r\n\r\n    // for each letter in text\r\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\r\n      // find the sprite index in alphabet , if there is an error pick the first\r\n      const letter = textToRender[letterIndex];\r\n      let spriteIndex = alphabet.indexOf(letter);\r\n      if (spriteIndex === -1) {\r\n        spriteIndex = 0;\r\n        this._logger.warnOnce(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'.`);\r\n        this._logger.warnOnce('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\r\n      }\r\n\r\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\r\n      if (letterSprite) {\r\n        results.push(letterSprite);\r\n      } else {\r\n        this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\r\n        this._logger.warnOnce('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\r\n      }\r\n    }\r\n    return results;\r\n  }\r\n\r\n  public measureText(text: string, maxWidth?: number): BoundingBox {\r\n    const lines = this._getLinesFromText(text, maxWidth);\r\n    const maxWidthLine = lines.reduce((a, b) => {\r\n      return a.length > b.length ? a : b;\r\n    });\r\n    const sprites = this._getCharacterSprites(maxWidthLine);\r\n    let width = 0;\r\n    let height = 0;\r\n    for (const sprite of sprites) {\r\n      width += sprite.width + this.spacing;\r\n      height = Math.max(height, sprite.height);\r\n    }\r\n    return BoundingBox.fromDimension(width * this.scale.x, height * lines.length * this.scale.y, Vector.Zero);\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number, maxWidth?: number): void {\r\n    let xCursor = 0;\r\n    let yCursor = 0;\r\n    let height = 0;\r\n    const lines = this._getLinesFromText(this._text, maxWidth);\r\n    for (const line of lines) {\r\n      for (const sprite of this._getCharacterSprites(line)) {\r\n        // draw it in the right spot and increase the cursor by sprite width\r\n        sprite.draw(ex, x + xCursor, y + yCursor);\r\n        xCursor += sprite.width + this.spacing;\r\n        height = Math.max(height, sprite.height);\r\n      }\r\n      xCursor = 0;\r\n      yCursor += this.lineHeight ?? height;\r\n    }\r\n  }\r\n\r\n  render(ex: ExcaliburGraphicsContext, text: string, _color: any, x: number, y: number, maxWidth?: number) {\r\n    // SpriteFont doesn't support _color, yet...\r\n    this._text = text;\r\n    const bounds = this.measureText(text, maxWidth);\r\n    this.width = bounds.width;\r\n    this.height = bounds.height;\r\n    if (this.shadow) {\r\n      ex.save();\r\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\r\n      this._preDraw(ex, x, y);\r\n      this._drawImage(ex, 0, 0, maxWidth);\r\n      this._postDraw(ex);\r\n      ex.restore();\r\n    }\r\n\r\n    this._preDraw(ex, x, y);\r\n    this._drawImage(ex, 0, 0, maxWidth);\r\n    this._postDraw(ex);\r\n  }\r\n\r\n  clone(): SpriteFont {\r\n    return new SpriteFont({\r\n      alphabet: this.alphabet,\r\n      spriteSheet: this.spriteSheet,\r\n      spacing: this.spacing\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Return array of lines split based on the \\n character, and the maxWidth? constraint\r\n   * @param text\r\n   * @param maxWidth\r\n   */\r\n  private _cachedText?: string;\r\n  private _cachedLines?: string[];\r\n  private _cachedRenderWidth?: number;\r\n  private _getLinesFromText(text: string, maxWidth?: number) {\r\n    if (this._cachedText === text && this._cachedRenderWidth === maxWidth && this._cachedLines?.length) {\r\n      return this._cachedLines;\r\n    }\r\n\r\n    const lines = text.split('\\n');\r\n\r\n    if (maxWidth == null) {\r\n      return lines;\r\n    }\r\n\r\n    // If the current line goes past the maxWidth, append a new line without modifying the underlying text.\r\n    for (let i = 0; i < lines.length; i++) {\r\n      let line = lines[i];\r\n      let newLine = '';\r\n      // Note: we subtract the spacing to counter the initial padding on the left side.\r\n      if (this.measureText(line).width > maxWidth) {\r\n        while (this.measureText(line).width > maxWidth) {\r\n          newLine = line[line.length - 1] + newLine;\r\n          line = line.slice(0, -1); // Remove last character from line\r\n        }\r\n\r\n        // Update the array with our new values\r\n        lines[i] = line;\r\n        lines[i + 1] = newLine;\r\n      }\r\n    }\r\n\r\n    this._cachedText = text;\r\n    this._cachedLines = lines;\r\n    this._cachedRenderWidth = maxWidth;\r\n\r\n    return lines;\r\n  }\r\n}\r\n","import { Future } from '../Util/Future';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { GraphicOptions } from './Graphic';\r\nimport { ImageSource, ImageWrapConfiguration } from './ImageSource';\r\nimport { SourceView, Sprite } from './Sprite';\r\nimport { ImageWrapping } from './Wrapping';\r\n\r\nexport interface TiledSpriteOptions {\r\n  image: ImageSource;\r\n  /**\r\n   * Source view into the {@link ImageSource image}\r\n   */\r\n  sourceView?: SourceView;\r\n  /**\r\n   * Optionally override {@link ImageFiltering filtering}\r\n   */\r\n  filtering?: ImageFiltering;\r\n  /**\r\n   * Optionally override {@link ImageWrapping wrapping} , default wrapping is Repeat for TiledSprite\r\n   */\r\n  wrapping?: ImageWrapConfiguration | ImageWrapping;\r\n  /**\r\n   * Total width in pixels for the tiling to take place over\r\n   */\r\n  width: number;\r\n  /**\r\n   * Total height in pixels for the tiling to take place over\r\n   */\r\n  height: number;\r\n}\r\n\r\nexport class TiledSprite extends Sprite {\r\n  private _ready = new Future<void>();\r\n  public ready = this._ready.promise;\r\n  private _options: TiledSpriteOptions & GraphicOptions;\r\n  constructor(options: TiledSpriteOptions & GraphicOptions) {\r\n    super({\r\n      image: options.image,\r\n      sourceView: options.sourceView,\r\n      destSize: { width: options.width, height: options.height },\r\n      flipHorizontal: options.flipHorizontal,\r\n      flipVertical: options.flipVertical,\r\n      rotation: options.rotation,\r\n      scale: options.scale,\r\n      opacity: options.opacity,\r\n      tint: options.tint,\r\n      origin: options.origin\r\n    });\r\n    this._options = options;\r\n\r\n    if (this.image.isLoaded()) {\r\n      this._applyTiling();\r\n    } else {\r\n      this.image.ready.then(() => this._applyTiling());\r\n    }\r\n  }\r\n\r\n  public static fromSprite(sprite: Sprite, options?: Partial<Omit<TiledSpriteOptions & GraphicOptions, 'image'>>): TiledSprite {\r\n    return new TiledSprite({\r\n      sourceView: { ...sprite.sourceView },\r\n      width: sprite.width,\r\n      height: sprite.height,\r\n      ...options,\r\n      image: sprite.image\r\n    });\r\n  }\r\n\r\n  private _applyTiling() {\r\n    const { width, height, filtering, wrapping } = { ...this._options };\r\n    const spriteCanvas = document.createElement('canvas')!;\r\n    spriteCanvas.width = this.sourceView.width;\r\n    spriteCanvas.height = this.sourceView.height;\r\n    const spriteCtx = spriteCanvas.getContext('2d')!;\r\n    // prettier-ignore\r\n    spriteCtx.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x, this.sourceView.y,\r\n        this.sourceView.width, this.sourceView.height,\r\n        0, 0,\r\n        this.sourceView.width, this.sourceView.height);\r\n\r\n    // prettier-ignore\r\n    const tiledImageSource = ImageSource.fromHtmlCanvasElement(spriteCanvas, {\r\n        wrapping: wrapping ?? ImageWrapping.Repeat,\r\n        filtering\r\n      });\r\n    if (width) {\r\n      this.destSize.width = width;\r\n      this.sourceView.width = width;\r\n    }\r\n    if (height) {\r\n      this.destSize.height = height;\r\n      this.sourceView.height = height;\r\n    }\r\n    this.sourceView.x = 0;\r\n    this.sourceView.y = 0;\r\n    this.image = tiledImageSource;\r\n    // this._ready.resolve();\r\n    this.image.ready.then(() => this._ready.resolve());\r\n  }\r\n}\r\n","import { ImageSource } from './ImageSource';\r\nimport { SourceView, Sprite } from './Sprite';\r\nimport { GraphicOptions } from './Graphic';\r\nimport { TiledSprite, TiledSpriteOptions } from './TiledSprite';\r\n\r\n/**\r\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\r\n * and have space between them.\r\n */\r\nexport interface SpriteSheetSpacingDimensions {\r\n  /**\r\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\r\n   * Default is (0, 0)\r\n   */\r\n  originOffset?: { x?: number; y?: number };\r\n\r\n  /**\r\n   * The margin between sprites.\r\n   * Default is (0, 0)\r\n   */\r\n  margin?: { x?: number; y?: number };\r\n}\r\n\r\n/**\r\n * Sprite sheet options for slicing up images\r\n */\r\nexport interface SpriteSheetGridOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * Grid definition for the sprite sheet\r\n   */\r\n  grid: {\r\n    /**\r\n     * Number of rows in the sprite sheet\r\n     */\r\n    rows: number;\r\n    /**\r\n     * Number of columns in the sprite sheet\r\n     */\r\n    columns: number;\r\n    /**\r\n     * Width of each individual sprite\r\n     */\r\n    spriteWidth: number;\r\n    /**\r\n     * Height of each individual sprite\r\n     */\r\n    spriteHeight: number;\r\n  };\r\n  /**\r\n   * Optionally specify any spacing information between sprites\r\n   */\r\n  spacing?: SpriteSheetSpacingDimensions;\r\n}\r\n\r\nexport interface SpriteSheetSparseOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * List of source view rectangles to create a sprite sheet from\r\n   */\r\n  sourceViews: SourceView[];\r\n}\r\n\r\nexport interface SpriteSheetOptions {\r\n  /**\r\n   * Source sprites for the sprite sheet\r\n   */\r\n  sprites: Sprite[];\r\n  /**\r\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\r\n   */\r\n  rows?: number;\r\n  /**\r\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\r\n   */\r\n  columns?: number;\r\n}\r\n\r\nexport interface GetSpriteOptions extends GraphicOptions {}\r\n\r\n/**\r\n * Represents a collection of sprites from a source image with some organization in a grid\r\n */\r\nexport class SpriteSheet {\r\n  public readonly sprites: Sprite[] = [];\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  /**\r\n   * Build a new sprite sheet from a list of sprites\r\n   *\r\n   * Use {@apilink SpriteSheet.fromImageSource} to create a SpriteSheet from an {@apilink ImageSource} organized in a grid\r\n   * @param options\r\n   */\r\n  constructor(options: SpriteSheetOptions) {\r\n    const { sprites, rows, columns } = options;\r\n    this.sprites = sprites;\r\n    this.rows = rows ?? 1;\r\n    this.columns = columns ?? this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y integer coordinates in the SpriteSheet, for example `getSprite(0, 0)` is the {@apilink Sprite} in the top-left\r\n   * and `getSprite(1, 0)` is the sprite one to the right.\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public getSprite(x: number, y: number, options?: GetSpriteOptions): Sprite {\r\n    if (x >= this.columns || x < 0) {\r\n      throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1} columns`);\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1} rows`);\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    const sprite = this.sprites[spriteIndex];\r\n    if (sprite) {\r\n      if (options) {\r\n        const spriteWithOptions = sprite.clone();\r\n        spriteWithOptions.flipHorizontal = options.flipHorizontal ?? spriteWithOptions.flipHorizontal;\r\n        spriteWithOptions.flipVertical = options.flipVertical ?? spriteWithOptions.flipVertical;\r\n        spriteWithOptions.width = options.width ?? spriteWithOptions.width;\r\n        spriteWithOptions.height = options.height ?? spriteWithOptions.height;\r\n        spriteWithOptions.rotation = options.rotation ?? spriteWithOptions.rotation;\r\n        spriteWithOptions.scale = options.scale ?? spriteWithOptions.scale;\r\n        spriteWithOptions.opacity = options.opacity ?? spriteWithOptions.opacity;\r\n        spriteWithOptions.tint = options.tint ?? spriteWithOptions.tint;\r\n        spriteWithOptions.origin = options.origin ?? spriteWithOptions.origin;\r\n        return spriteWithOptions;\r\n      }\r\n      return sprite;\r\n    }\r\n    throw Error(`Invalid sprite coordinates (${x}, ${y})`);\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y integer coordinates in the SpriteSheet and configures tiling to repeat by default,\r\n   * for example `getTiledSprite(0, 0)` is the {@apilink TiledSprite} in the top-left\r\n   * and `getTiledSprite(1, 0)` is the sprite one to the right.\r\n   *\r\n   * Example:\r\n   *\r\n   * ```typescript\r\n   * spriteSheet.getTiledSprite(1, 0, {\r\n   * width: game.screen.width,\r\n   * height: 200,\r\n   * wrapping: {\r\n   * x: ex.ImageWrapping.Repeat,\r\n   * y: ex.ImageWrapping.Clamp\r\n   * }\r\n   * });\r\n   * ```\r\n   * @param x\r\n   * @param y\r\n   * @param options\r\n   */\r\n  public getTiledSprite(x: number, y: number, options?: Partial<Omit<TiledSpriteOptions & GraphicOptions, 'image'>>): TiledSprite {\r\n    if (x >= this.columns || x < 0) {\r\n      throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1} columns`);\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      throw Error(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1} rows`);\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    const sprite = this.sprites[spriteIndex];\r\n    if (sprite) {\r\n      return TiledSprite.fromSprite(sprite, options);\r\n    }\r\n    throw Error(`Invalid sprite coordinates (${x}, ${y})`);\r\n  }\r\n\r\n  /**\r\n   * Create a sprite sheet from a sparse set of {@apilink SourceView} rectangles\r\n   * @param options\r\n   */\r\n  public static fromImageSourceWithSourceViews(options: SpriteSheetSparseOptions): SpriteSheet {\r\n    const sprites: Sprite[] = options.sourceViews.map((sourceView) => {\r\n      return new Sprite({\r\n        image: options.image,\r\n        sourceView\r\n      });\r\n    });\r\n    return new SpriteSheet({ sprites });\r\n  }\r\n\r\n  /**\r\n   * Create a SpriteSheet from an {@apilink ImageSource} organized in a grid\r\n   *\r\n   * Example:\r\n   * ```\r\n   * const spriteSheet = SpriteSheet.fromImageSource({\r\n   *   image: imageSource,\r\n   *   grid: {\r\n   *     rows: 5,\r\n   *     columns: 2,\r\n   *     spriteWidth: 32, // pixels\r\n   *     spriteHeight: 32 // pixels\r\n   *   },\r\n   *   // Optionally specify spacing\r\n   *   spacing: {\r\n   *     // pixels from the top left to start the sprite parsing\r\n   *     originOffset: {\r\n   *       x: 5,\r\n   *       y: 5\r\n   *     },\r\n   *     // pixels between each sprite while parsing\r\n   *     margin: {\r\n   *       x: 1,\r\n   *       y: 1\r\n   *     }\r\n   *   }\r\n   * })\r\n   * ```\r\n   * @param options\r\n   */\r\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\r\n    const sprites: Sprite[] = [];\r\n    options.spacing = options.spacing ?? {};\r\n    const {\r\n      image,\r\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\r\n      spacing: { originOffset, margin }\r\n    } = options;\r\n    const offsetDefaults = { x: 0, y: 0, ...originOffset };\r\n    const marginDefaults = { x: 0, y: 0, ...margin };\r\n    for (let x = 0; x < cols; x++) {\r\n      for (let y = 0; y < rows; y++) {\r\n        sprites[x + y * cols] = new Sprite({\r\n          image: image,\r\n          sourceView: {\r\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\r\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\r\n            width: spriteWidth,\r\n            height: spriteHeight\r\n          },\r\n          destSize: { height: spriteHeight, width: spriteWidth }\r\n        });\r\n      }\r\n    }\r\n    return new SpriteSheet({\r\n      sprites: sprites,\r\n      rows: rows,\r\n      columns: cols\r\n    });\r\n  }\r\n\r\n  public clone(): SpriteSheet {\r\n    return new SpriteSheet({\r\n      sprites: this.sprites.map((sprite) => sprite.clone()),\r\n      rows: this.rows,\r\n      columns: this.columns\r\n    });\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from '../Context/ExcaliburGraphicsContext';\r\nimport { ImageSource } from '../ImageSource';\r\nimport { SpriteFont } from '../SpriteFont';\r\nimport { SpriteSheet } from '../SpriteSheet';\r\nimport { Vector } from '../../Math/vector';\r\nimport debugFont from './debug-font.png';\r\n\r\n/**\r\n * Internal debug text helper\r\n */\r\nexport class DebugText {\r\n  constructor() {\r\n    // We fire and forget, we don't care if it's loaded or not\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    this.load();\r\n  }\r\n\r\n  /**\r\n   * base64 font\r\n   */\r\n  public readonly fontSheet = debugFont;\r\n  public size: number = 16;\r\n  private _imageSource!: ImageSource;\r\n  private _spriteSheet!: SpriteSheet;\r\n  private _spriteFont!: SpriteFont;\r\n  public load() {\r\n    this._imageSource = new ImageSource(this.fontSheet);\r\n    return this._imageSource.load().then(() => {\r\n      this._spriteSheet = SpriteSheet.fromImageSource({\r\n        image: this._imageSource,\r\n        grid: {\r\n          rows: 4,\r\n          columns: 16,\r\n          spriteWidth: 16,\r\n          spriteHeight: 16\r\n        }\r\n      });\r\n      this._spriteFont = new SpriteFont({\r\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+# ',\r\n        caseInsensitive: true,\r\n        spriteSheet: this._spriteSheet,\r\n        spacing: -6\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Writes debug text using the built in sprint font\r\n   * @param ctx\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\r\n    if (this._imageSource.isLoaded()) {\r\n      this._spriteFont.render(ctx, text, null, pos.x, pos.y);\r\n    }\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","export class RenderSource {\r\n  constructor(\r\n    private _gl: WebGLRenderingContext,\r\n    private _texture: WebGLTexture\r\n  ) {}\r\n\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._texture);\r\n  }\r\n\r\n  public disable() {\r\n    const gl = this._gl;\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n}\r\n","import { RenderSource } from './render-source';\r\n\r\ndeclare global {\r\n  interface WebGL2RenderingContext {\r\n    /**\r\n     * Experimental only in chrome\r\n     */\r\n    drawingBufferFormat?: number;\r\n  }\r\n}\r\n\r\nexport interface RenderTargetOptions {\r\n  gl: WebGL2RenderingContext;\r\n  width: number;\r\n  height: number;\r\n  transparency: boolean;\r\n  /**\r\n   * Optionally enable render buffer multisample anti-aliasing\r\n   *\r\n   * By default false\r\n   */\r\n  antialias?: boolean;\r\n  /**\r\n   * Optionally specify number of anti-aliasing samples to use\r\n   *\r\n   * By default the max for the platform is used if antialias is on.\r\n   */\r\n  samples?: number;\r\n}\r\n\r\nexport class RenderTarget {\r\n  width: number;\r\n  height: number;\r\n  transparency: boolean;\r\n  antialias: boolean = false;\r\n  samples: number = 1;\r\n  private _gl: WebGL2RenderingContext;\r\n  public readonly bufferFormat: number;\r\n  constructor(options: RenderTargetOptions) {\r\n    this._gl = options.gl;\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.transparency = options.transparency;\r\n    this.antialias = options.antialias ?? this.antialias;\r\n    this.samples = options.samples ?? this._gl.getParameter(this._gl.MAX_SAMPLES);\r\n\r\n    const gl = this._gl;\r\n    // Determine current context format for blitting later needs to match\r\n    if (gl.drawingBufferFormat) {\r\n      this.bufferFormat = gl.drawingBufferFormat;\r\n    } else {\r\n      // Documented in webgl spec\r\n      // https://registry.khronos.org/webgl/specs/latest/1.0/\r\n      if (this.transparency) {\r\n        this.bufferFormat = gl.RGBA8;\r\n      } else {\r\n        this.bufferFormat = gl.RGB8;\r\n      }\r\n    }\r\n\r\n    this._setupRenderBuffer();\r\n    this._setupFramebuffer();\r\n  }\r\n\r\n  setResolution(width: number, height: number) {\r\n    const gl = this._gl;\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    // update backing texture size\r\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n\r\n    // update render buffer size\r\n    if (this._renderBuffer) {\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, this._renderBuffer);\r\n      gl.renderbufferStorageMultisample(\r\n        gl.RENDERBUFFER,\r\n        Math.min(this.samples, gl.getParameter(gl.MAX_SAMPLES)),\r\n        this.bufferFormat,\r\n        this.width,\r\n        this.height\r\n      );\r\n    }\r\n  }\r\n\r\n  private _renderBuffer!: WebGLRenderbuffer;\r\n  public get renderBuffer() {\r\n    return this._renderBuffer;\r\n  }\r\n  private _renderFrameBuffer!: WebGLFramebuffer;\r\n  public get renderFrameBuffer() {\r\n    return this._renderFrameBuffer;\r\n  }\r\n\r\n  private _frameBuffer!: WebGLFramebuffer;\r\n  public get frameBuffer() {\r\n    return this._frameBuffer;\r\n  }\r\n  private _frameTexture!: WebGLTexture;\r\n  public get frameTexture() {\r\n    return this._frameTexture;\r\n  }\r\n\r\n  private _setupRenderBuffer() {\r\n    if (this.antialias) {\r\n      const gl = this._gl;\r\n      // Render buffers can be used as an input to a shader\r\n      this._renderBuffer = gl.createRenderbuffer()!;\r\n      this._renderFrameBuffer = gl.createFramebuffer()!;\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, this._renderBuffer);\r\n      gl.renderbufferStorageMultisample(\r\n        gl.RENDERBUFFER,\r\n        Math.min(this.samples, gl.getParameter(gl.MAX_SAMPLES)),\r\n        this.bufferFormat,\r\n        this.width,\r\n        this.height\r\n      );\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._renderFrameBuffer);\r\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.RENDERBUFFER, this._renderBuffer);\r\n    }\r\n  }\r\n\r\n  private _setupFramebuffer() {\r\n    // Allocates frame buffer\r\n    const gl = this._gl;\r\n    this._frameTexture = gl.createTexture()!;\r\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n\r\n    // set the filtering so we don't need mips\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n    // attach the texture as the first color attachment\r\n    const attachmentPoint = gl.COLOR_ATTACHMENT0;\r\n\r\n    // After this bind all draw calls will draw to this framebuffer texture\r\n    this._frameBuffer = gl.createFramebuffer()!;\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentPoint, gl.TEXTURE_2D, this._frameTexture, 0);\r\n\r\n    // Reset after initialized\r\n    this.disable();\r\n  }\r\n\r\n  public toRenderSource() {\r\n    if (this.renderBuffer) {\r\n      this.blitRenderBufferToFrameBuffer();\r\n    }\r\n    const source = new RenderSource(this._gl, this._frameTexture);\r\n    return source;\r\n  }\r\n\r\n  public blitToScreen() {\r\n    const gl = this._gl;\r\n    // set to size of canvas's drawingBuffer\r\n    if (this._renderBuffer) {\r\n      gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.renderFrameBuffer);\r\n      gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\r\n      gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\r\n      gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\r\n    } else {\r\n      gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.frameBuffer);\r\n      gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\r\n      gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\r\n      gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\r\n    }\r\n  }\r\n\r\n  public blitRenderBufferToFrameBuffer() {\r\n    if (this._renderBuffer) {\r\n      const gl = this._gl;\r\n      gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.renderFrameBuffer);\r\n      gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, this.frameBuffer);\r\n      gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 1.0, 1.0]);\r\n      gl.blitFramebuffer(0, 0, this.width, this.height, 0, 0, this.width, this.height, gl.COLOR_BUFFER_BIT, gl.LINEAR);\r\n    }\r\n  }\r\n\r\n  public copyToTexture(texture: WebGLTexture) {\r\n    const gl = this._gl;\r\n    if (this._renderBuffer) {\r\n      this.blitRenderBufferToFrameBuffer();\r\n    }\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 0, 0, this.width, this.height, 0);\r\n  }\r\n\r\n  /**\r\n   * When called, all drawing gets redirected to this render target\r\n   */\r\n  public use() {\r\n    const gl = this._gl;\r\n    if (this.antialias) {\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._renderFrameBuffer);\r\n    } else {\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    }\r\n\r\n    // very important to set the viewport to the size of the framebuffer texture\r\n    gl.viewport(0, 0, this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * When called, all drawing is sent back to the canvas\r\n   */\r\n  public disable() {\r\n    const gl = this._gl;\r\n    // passing null switches rendering back to the canvas\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n}\r\n","/**\r\n * Return the size of the GlType in bytes\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getGlTypeSizeBytes(gl: WebGLRenderingContext, type: number): number {\r\n  switch (type) {\r\n    case gl.INT:\r\n    case gl.UNSIGNED_INT:\r\n    case gl.FLOAT:\r\n      return 4;\r\n    case gl.SHORT:\r\n      return 2;\r\n    case gl.UNSIGNED_SHORT:\r\n      return 2;\r\n    case gl.BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_BYTE:\r\n      return 1;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if an attribute is present in vertex source\r\n */\r\nexport function isAttributeInSource(source: string, variable: string) {\r\n  const attributeRegexTemplate = `(?<type>[a-z0-9]+)\\\\s+${variable};`;\r\n  const regex = new RegExp(attributeRegexTemplate, 'g');\r\n  const matches = regex.exec(source);\r\n  return matches?.length! > 0;\r\n}\r\n\r\n/**\r\n * Attempt to discern the glType of an attribute from vertex source\r\n * @param gl\r\n * @param source\r\n * @param variable\r\n */\r\nexport function getGLTypeFromSource(gl: WebGLRenderingContext, source: string, variable: string) {\r\n  const attributeRegexTemplate = `(?<type>[a-z0-9]+)\\\\s+${variable};`;\r\n  const regex = new RegExp(attributeRegexTemplate, 'g');\r\n  const matches = regex.exec(source);\r\n  const type = matches?.groups?.type;\r\n\r\n  switch (type) {\r\n    case 'float':\r\n    case 'vec2':\r\n    case 'vec3':\r\n    case 'vec4':\r\n      return gl.FLOAT;\r\n    case 'int':\r\n    case 'ivec2':\r\n    case 'ivec3':\r\n    case 'ivec4':\r\n      return gl.INT;\r\n    case 'uint':\r\n    case 'uvec2':\r\n    case 'uvec3':\r\n    case 'uvec4':\r\n      return gl.UNSIGNED_INT;\r\n    case 'bool':\r\n    case 'bvec2':\r\n    case 'bvec3':\r\n    case 'bvec4':\r\n      return gl.BOOL;\r\n    case 'short':\r\n      return gl.SHORT;\r\n    case 'ushort':\r\n      return gl.UNSIGNED_SHORT;\r\n    case 'ubyte':\r\n      return gl.UNSIGNED_BYTE;\r\n    case 'byte':\r\n      return gl.BYTE;\r\n    default:\r\n      return gl.FLOAT;\r\n  }\r\n}\r\n\r\n/**\r\n * Based on the type return the number of attribute components\r\n *\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getAttributeComponentSize(gl: WebGLRenderingContext, type: number): number {\r\n  switch (type) {\r\n    case gl.LOW_FLOAT:\r\n    case gl.HIGH_FLOAT:\r\n    case gl.FLOAT:\r\n      return 1;\r\n    case gl.FLOAT_VEC2:\r\n      return 2;\r\n    case gl.FLOAT_VEC3:\r\n      return 3;\r\n    case gl.FLOAT_VEC4:\r\n      return 4;\r\n    case gl.BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_SHORT:\r\n    case gl.SHORT:\r\n      return 1;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n\r\n/**\r\n * Based on the attribute return the corresponding supported attrib pointer type\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getAttributePointerType(gl: WebGLRenderingContext, type: number) {\r\n  switch (type) {\r\n    case gl.LOW_FLOAT:\r\n    case gl.HIGH_FLOAT:\r\n    case gl.FLOAT:\r\n    case gl.FLOAT_VEC2:\r\n    case gl.FLOAT_VEC3:\r\n    case gl.FLOAT_VEC4:\r\n      return gl.FLOAT;\r\n    case gl.BYTE:\r\n      return gl.BYTE;\r\n    case gl.UNSIGNED_BYTE:\r\n      return gl.UNSIGNED_BYTE;\r\n    case gl.SHORT:\r\n      return gl.SHORT;\r\n    case gl.UNSIGNED_SHORT:\r\n      return gl.UNSIGNED_SHORT;\r\n    default:\r\n      return gl.FLOAT;\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function getMaxShaderComplexity(gl: WebGL2RenderingContext, numIfs: number): number {\r\n  const assembleTestShader = (numIfs: number) => {\r\n    const testShader = `#version 300 es\r\n    precision mediump float;\r\n    out vec4 fragColor;\r\n    void main() {\r\n      float index = 1.01;\r\n      %%complexity%%\r\n    }`;\r\n    let testComplexity = '';\r\n    for (let i = 0; i < numIfs; i++) {\r\n      if (i === 0) {\r\n        testComplexity += `if (index <= ${i}.5) {\\n`;\r\n      } else {\r\n        testComplexity += `   else if (index <= ${i}.5) {\\n`;\r\n      }\r\n\r\n      testComplexity += `      fragColor = vec4(1.0);\\n`;\r\n      testComplexity += `   }\\n`;\r\n    }\r\n    return testShader.replace('%%complexity%%', testComplexity);\r\n  };\r\n\r\n  let canCompile = false;\r\n  do {\r\n    const test = assembleTestShader(numIfs);\r\n\r\n    const shader = gl.createShader(gl.FRAGMENT_SHADER)!;\r\n    gl.shaderSource(shader, test);\r\n    gl.compileShader(shader);\r\n\r\n    canCompile = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!canCompile) {\r\n      numIfs = (numIfs / 2) | 0;\r\n    }\r\n  } while (!canCompile);\r\n  return numIfs;\r\n}\r\n","import { AffineMatrix, Color, Logger, Vector } from '../..';\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { getAttributeComponentSize, getAttributePointerType } from './webgl-util';\r\n\r\n/**\r\n * List of the possible glsl uniform types\r\n */\r\nexport type UniformTypeNames =\r\n  | 'uniform1f'\r\n  | 'uniform1i'\r\n  | 'uniform2f'\r\n  | 'uniform2i'\r\n  | 'uniform3f'\r\n  | 'uniform3i'\r\n  | 'uniform4f'\r\n  | 'uniform4i'\r\n  | 'uniform1fv'\r\n  | 'uniform1iv'\r\n  | 'uniform2fv'\r\n  | 'uniform2iv'\r\n  | 'uniform3fv'\r\n  | 'uniform3iv'\r\n  | 'uniform4fv'\r\n  | 'uniform4iv'\r\n  | 'uniformMatrix2fv'\r\n  | 'uniformMatrix3fv'\r\n  | 'uniformMatrix4fv';\r\n\r\ntype RemoveFirstFromTuple<T extends any[]> = T['length'] extends 0\r\n  ? []\r\n  : ((...b: T) => void) extends (a: any, ...b: infer I) => void\r\n    ? I\r\n    : [];\r\n\r\ntype UniformParameters<TUniformType extends UniformTypeNames> = RemoveFirstFromTuple<Parameters<WebGLRenderingContext[TUniformType]>>;\r\n\r\nexport interface UniformDefinition {\r\n  name: string;\r\n  glType: number;\r\n  location: WebGLUniformLocation;\r\n}\r\n\r\nexport interface VertexAttributeDefinition {\r\n  /**\r\n   * string name of the attribute in the shader program, commonly `a_nameofmyvariable`\r\n   */\r\n  name: string;\r\n  /**\r\n   * Number of components for a given attribute\r\n   * Must be 1, 2, 3, or 4\r\n   *\r\n   * For example a vec4 attribute would be `4` floats, so 4\r\n   */\r\n  size: number;\r\n  /**\r\n   * Supported types in webgl 1\r\n   * * gl.BYTE\r\n   * * gl.SHORT\r\n   * * gl.UNSIGNED_BYTE\r\n   * * gl.UNSIGNED_SHORT\r\n   * * gl.FLOAT\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n   */\r\n  glType: number;\r\n  /**\r\n   * Is the attribute normalized between (0-1)\r\n   */\r\n  normalized: boolean;\r\n  /**\r\n   * Location index in the shader program\r\n   */\r\n  location: number;\r\n}\r\n\r\nexport interface ShaderOptions {\r\n  /**\r\n   * WebGL2RenderingContext this layout will be attached to, these cannot be reused across webgl contexts.\r\n   */\r\n  gl: WebGL2RenderingContext;\r\n  /**\r\n   * Vertex shader source code in glsl #version 300 es\r\n   */\r\n  vertexSource: string;\r\n  /**\r\n   * Fragment shader source code in glsl #version 300 es\r\n   */\r\n  fragmentSource: string;\r\n\r\n  onPreLink?: (program: WebGLProgram) => void;\r\n  onPostCompile?: (shader: Shader) => void;\r\n}\r\n\r\nexport class Shader {\r\n  private static _ACTIVE_SHADER_INSTANCE: Shader | null = null;\r\n  private _logger = Logger.getInstance();\r\n  private _gl: WebGL2RenderingContext;\r\n  public program!: WebGLProgram;\r\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\r\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\r\n  private _compiled = false;\r\n  public readonly vertexSource: string;\r\n  public readonly fragmentSource: string;\r\n  private _onPreLink?: (program: WebGLProgram) => void;\r\n  private _onPostCompile?: (shader: Shader) => void;\r\n\r\n  public get compiled() {\r\n    return this._compiled;\r\n  }\r\n\r\n  /**\r\n   * Create a shader program in excalibur\r\n   * @param options specify shader vertex and fragment source\r\n   */\r\n  constructor(options: ShaderOptions) {\r\n    const { gl, vertexSource, fragmentSource, onPreLink, onPostCompile } = options;\r\n    this._gl = gl;\r\n    this.vertexSource = vertexSource;\r\n    this.fragmentSource = fragmentSource;\r\n    this._onPreLink = onPreLink;\r\n    this._onPostCompile = onPostCompile;\r\n  }\r\n\r\n  dispose() {\r\n    const gl = this._gl;\r\n    gl.deleteProgram(this.program);\r\n    this._gl = null as any;\r\n  }\r\n\r\n  /**\r\n   * Binds the shader program\r\n   */\r\n  use() {\r\n    const gl = this._gl;\r\n    gl.useProgram(this.program);\r\n    Shader._ACTIVE_SHADER_INSTANCE = this;\r\n  }\r\n\r\n  isCurrentlyBound() {\r\n    return Shader._ACTIVE_SHADER_INSTANCE === this;\r\n  }\r\n\r\n  /**\r\n   * Compile the current shader against a webgl context\r\n   */\r\n  compile(): WebGLProgram {\r\n    const gl = this._gl;\r\n    const vertexShader = this._compileShader(gl, this.vertexSource, gl.VERTEX_SHADER);\r\n    const fragmentShader = this._compileShader(gl, this.fragmentSource, gl.FRAGMENT_SHADER);\r\n    this.program = this._createProgram(gl, vertexShader, fragmentShader);\r\n\r\n    const attributes = this.getAttributes();\r\n    for (const attribute of attributes) {\r\n      this.attributes[attribute.name] = attribute;\r\n    }\r\n    const uniforms = this.getUniforms();\r\n    for (const uniform of uniforms) {\r\n      this.uniforms[uniform.name] = uniform;\r\n    }\r\n\r\n    this._compiled = true;\r\n    if (this._onPostCompile) {\r\n      this._onPostCompile(this);\r\n    }\r\n    return this.program;\r\n  }\r\n\r\n  getUniforms(): UniformDefinition[] {\r\n    const gl = this._gl;\r\n    const uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\r\n    const uniforms: UniformDefinition[] = [];\r\n    for (let i = 0; i < uniformCount; i++) {\r\n      const uniform = gl.getActiveUniform(this.program, i)!;\r\n      const uniformLocation = gl.getUniformLocation(this.program, uniform.name)!;\r\n      uniforms.push({\r\n        name: uniform.name,\r\n        glType: uniform.type,\r\n        location: uniformLocation\r\n      });\r\n    }\r\n    return uniforms;\r\n  }\r\n\r\n  getAttributes(): VertexAttributeDefinition[] {\r\n    const gl = this._gl;\r\n    const attributeCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\r\n    const attributes: VertexAttributeDefinition[] = [];\r\n    for (let i = 0; i < attributeCount; i++) {\r\n      const attribute = gl.getActiveAttrib(this.program, i)!;\r\n      const attributeLocation = gl.getAttribLocation(this.program, attribute.name);\r\n      attributes.push({\r\n        name: attribute.name,\r\n        glType: getAttributePointerType(gl, attribute.type),\r\n        size: getAttributeComponentSize(gl, attribute.type),\r\n        location: attributeLocation,\r\n        normalized: false\r\n      });\r\n    }\r\n    return attributes;\r\n  }\r\n\r\n  /**\r\n   * Set a texture in a gpu texture slot\r\n   * @param slotNumber\r\n   * @param texture\r\n   */\r\n  setTexture(slotNumber: number, texture: WebGLTexture) {\r\n    const gl = this._gl;\r\n    gl.activeTexture(gl.TEXTURE0 + slotNumber);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n  }\r\n\r\n  /**\r\n   * Set an integer uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformInt(name: string, value: number) {\r\n    this.setUniform('uniform1i', name, ~~value);\r\n  }\r\n\r\n  /**\r\n   * Set an integer uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformInt(name: string, value: number): boolean {\r\n    return this.trySetUniform('uniform1i', name, ~~value);\r\n  }\r\n\r\n  /**\r\n   * Set an integer array uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformIntArray(name: string, value: number[]) {\r\n    this.setUniform('uniform1iv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set an integer array uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformIntArray(name: string, value: number[]): boolean {\r\n    return this.trySetUniform('uniform1iv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a boolean uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformBoolean(name: string, value: boolean) {\r\n    this.setUniform('uniform1i', name, value ? 1 : 0);\r\n  }\r\n\r\n  /**\r\n   * Set a boolean uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformBoolean(name: string, value: boolean): boolean {\r\n    return this.trySetUniform('uniform1i', name, value ? 1 : 0);\r\n  }\r\n\r\n  /**\r\n   * Set a float uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloat(name: string, value: number) {\r\n    this.setUniform('uniform1f', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a float uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformFloat(name: string, value: number): boolean {\r\n    return this.trySetUniform('uniform1f', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a float array uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatArray(name: string, value: number[]) {\r\n    this.setUniform('uniform1fv', name, value);\r\n  }\r\n  /**\r\n   * Set a float array uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformFloatArray(name: string, value: number[]): boolean {\r\n    return this.trySetUniform('uniform1fv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a {@apilink Vector} uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatVector(name: string, value: Vector) {\r\n    this.setUniform('uniform2f', name, value.x, value.y);\r\n  }\r\n\r\n  /**\r\n   * Set a {@apilink Vector} uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformFloatVector(name: string, value: Vector): boolean {\r\n    return this.trySetUniform('uniform2f', name, value.x, value.y);\r\n  }\r\n\r\n  /**\r\n   * Set a {@apilink Color} uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatColor(name: string, value: Color) {\r\n    this.setUniform('uniform4f', name, value.r / 255, value.g / 255, value.b / 255, value.a);\r\n  }\r\n\r\n  /**\r\n   * Set a {@apilink Color} uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformFloatColor(name: string, value: Color): boolean {\r\n    return this.trySetUniform('uniform4f', name, value.r / 255, value.g / 255, value.b / 255, value.a);\r\n  }\r\n\r\n  /**\r\n   * Set an {@apilink Matrix} uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformMatrix(name: string, value: Matrix) {\r\n    this.setUniform('uniformMatrix4fv', name, false, value.data);\r\n  }\r\n\r\n  setUniformAffineMatrix(name: string, value: AffineMatrix) {\r\n    this.setUniform('uniformMatrix4fv', name, false, [\r\n      value.data[0],\r\n      value.data[1],\r\n      0,\r\n      0,\r\n\r\n      value.data[2],\r\n      value.data[3],\r\n      0,\r\n      0,\r\n\r\n      0,\r\n      0,\r\n      1,\r\n      0,\r\n\r\n      value.data[4],\r\n      value.data[5],\r\n      0,\r\n      1\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Set an {@apilink Matrix} uniform for the current shader, WILL NOT THROW on error.\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   * @param name\r\n   * @param value\r\n   */\r\n  trySetUniformMatrix(name: string, value: Matrix): boolean {\r\n    return this.trySetUniform('uniformMatrix4fv', name, false, value.data);\r\n  }\r\n\r\n  /**\r\n   * Set any available uniform type in webgl\r\n   *\r\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\r\n   */\r\n  setUniform<TUniformType extends UniformTypeNames>(uniformType: TUniformType, name: string, ...value: UniformParameters<TUniformType>) {\r\n    if (!this._compiled) {\r\n      throw Error(`Must compile shader before setting a uniform ${uniformType}:${name}`);\r\n    }\r\n    if (!this.isCurrentlyBound()) {\r\n      throw Error(\r\n        'Currently accessed shader instance is not the current active shader in WebGL,' +\r\n          ' must call `shader.use()` before setting uniforms'\r\n      );\r\n    }\r\n    const gl = this._gl;\r\n    const location = gl.getUniformLocation(this.program, name);\r\n    if (location) {\r\n      const args = [location, ...value];\r\n      (this._gl as any)[uniformType].apply(this._gl, args);\r\n    } else {\r\n      throw Error(\r\n        `Uniform ${uniformType}:${name} doesn\\'t exist or is not used in the shader source code,` +\r\n          ' unused uniforms are optimized away by most browsers'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set any available uniform type in webgl. Will try to set the uniform, will return false if the uniform didn't exist,\r\n   * true if it was set.\r\n   *\r\n   * WILL NOT THROW on error\r\n   *\r\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\r\n   *\r\n   */\r\n  trySetUniform<TUniformType extends UniformTypeNames>(\r\n    uniformType: TUniformType,\r\n    name: string,\r\n    ...value: UniformParameters<TUniformType>\r\n  ): boolean {\r\n    if (!this._compiled) {\r\n      this._logger.warn(`Must compile shader before setting a uniform ${uniformType}:${name}`);\r\n      return false;\r\n    }\r\n    if (!this.isCurrentlyBound()) {\r\n      this._logger.warn(\r\n        'Currently accessed shader instance is not the current active shader in WebGL,' +\r\n          ' must call `shader.use()` before setting uniforms'\r\n      );\r\n      return false;\r\n    }\r\n    const gl = this._gl;\r\n    const location = gl.getUniformLocation(this.program, name);\r\n    if (location) {\r\n      const args = [location, ...value];\r\n      (this._gl as any)[uniformType].apply(this._gl, args);\r\n    } else {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n    const program = gl.createProgram();\r\n    if (program === null) {\r\n      throw Error('Could not create graphics shader program');\r\n    }\r\n\r\n    // attach the shaders.\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    if (this._onPreLink) {\r\n      this._onPreLink(program);\r\n    }\r\n\r\n    // link the program.\r\n    gl.linkProgram(program);\r\n\r\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\r\n    }\r\n\r\n    return program;\r\n  }\r\n\r\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\r\n    const typeName = gl.VERTEX_SHADER === type ? 'vertex' : 'fragment';\r\n    const shader = gl.createShader(type);\r\n    if (shader === null) {\r\n      throw Error(`Could not build shader: [${source}]`);\r\n    }\r\n\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n\r\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n      const errorInfo = gl.getShaderInfoLog(shader);\r\n      throw Error(`Could not compile ${typeName} shader:\\n\\n${errorInfo}${this._processSourceForError(source, errorInfo!)}`);\r\n    }\r\n    return shader;\r\n  }\r\n\r\n  private _processSourceForError(source: string, errorInfo: string) {\r\n    if (!source) {\r\n      return errorInfo;\r\n    }\r\n    const lines = source.split('\\n');\r\n    const errorLineStart = errorInfo.search(/\\d:\\d/);\r\n    const errorLineEnd = errorInfo.indexOf(' ', errorLineStart);\r\n    const [_, error2] = errorInfo\r\n      .slice(errorLineStart, errorLineEnd)\r\n      .split(':')\r\n      .map((v) => Number(v));\r\n    for (let i = 0; i < lines.length; i++) {\r\n      lines[i] = `${i + 1}: ${lines[i]}${error2 === i + 1 ? ' <----- ERROR!' : ''}`;\r\n    }\r\n\r\n    return '\\n\\nSource:\\n' + lines.join('\\n');\r\n  }\r\n}\r\n","export interface VertexBufferOptions {\r\n  /**\r\n   * WebGL2RenderingContext this layout will be attached to, these cannot be reused across contexts.\r\n   */\r\n  gl: WebGL2RenderingContext;\r\n  /**\r\n   * Size in number of floats, so [4.2, 4.0, 2.1] is size = 3\r\n   *\r\n   * Ignored if data is passed directly\r\n   */\r\n  size?: number;\r\n  /**\r\n   * If the vertices never change switching 'static' can be more efficient on the gpu\r\n   *\r\n   * Default is 'dynamic'\r\n   */\r\n  type?: 'static' | 'dynamic';\r\n\r\n  /**\r\n   * Optionally pass pre-seeded data, size parameter is ignored\r\n   */\r\n  data?: Float32Array;\r\n}\r\n\r\n/**\r\n * Helper around vertex buffer to simplify creating and uploading geometry\r\n *\r\n * Under the hood uses Float32Array\r\n */\r\nexport class VertexBuffer {\r\n  private _gl: WebGL2RenderingContext;\r\n\r\n  /**\r\n   * Access to the webgl buffer handle\r\n   */\r\n  public readonly buffer: WebGLBuffer;\r\n  /**\r\n   * Access to the raw data of the vertex buffer\r\n   */\r\n  public readonly bufferData: Float32Array;\r\n\r\n  /**\r\n   * If the vertices never change switching 'static' can be more efficient on the gpu\r\n   *\r\n   * Default is 'dynamic'\r\n   */\r\n  public type: 'static' | 'dynamic' = 'dynamic';\r\n\r\n  constructor(options: VertexBufferOptions) {\r\n    const { gl, size, type, data } = options;\r\n    this._gl = gl;\r\n    this.buffer = this._gl.createBuffer()!;\r\n    if (!data && !size) {\r\n      throw Error('Must either provide data or a size to the VertexBuffer');\r\n    }\r\n\r\n    if (!data) {\r\n      this.bufferData = new Float32Array(size!);\r\n    } else {\r\n      this.bufferData = data;\r\n    }\r\n    this.type = type ?? this.type;\r\n    // Allocate buffer\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\r\n  }\r\n\r\n  /**\r\n   * Bind this vertex buffer\r\n   */\r\n  bind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n  }\r\n\r\n  unbind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n  }\r\n\r\n  /**\r\n   * Upload vertex buffer geometry to the GPU\r\n   */\r\n  upload(count?: number) {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n    if (count) {\r\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.bufferData, 0, count);\r\n    } else {\r\n      // TODO always use bufferSubData? need to perf test it\r\n      gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    const gl = this._gl;\r\n    gl.deleteBuffer(this.buffer);\r\n    this._gl = null as any;\r\n  }\r\n}\r\n","import { Logger } from '../..';\r\nimport { Shader, VertexAttributeDefinition } from './shader';\r\nimport { VertexBuffer } from './vertex-buffer';\r\nimport { getGLTypeFromSource, getGlTypeSizeBytes, isAttributeInSource } from './webgl-util';\r\n\r\nexport interface VertexLayoutOptions {\r\n  /**\r\n   * WebGL2RenderingContext this layout will be attached to, these cannot be reused across contexts.\r\n   */\r\n  gl: WebGL2RenderingContext;\r\n  /**\r\n   * Shader that this layout will be for, if null you must set a shader before using it.\r\n   */\r\n  shader?: Shader;\r\n  /**\r\n   * Vertex buffer to use for vertex data\r\n   */\r\n  vertexBuffer: VertexBuffer;\r\n  /**\r\n   * Starting index for the attribute pointer\r\n   */\r\n  attributePointerStartIndex?: number;\r\n  /**\r\n   * Specify the attributes that will exist in the vertex buffer\r\n   *\r\n   * **Important** must specify them in the order that they will be in the vertex buffer!!\r\n   */\r\n  attributes: [name: string, numberOfComponents: number, type?: 'int' | 'matrix' | 'float'][];\r\n  /**\r\n   * Optionally suppress any warnings out of vertex layouts\r\n   *\r\n   * **BEWARE** this may cause you to have issues go unnoticed\r\n   */\r\n  suppressWarnings?: boolean;\r\n}\r\n\r\n/**\r\n * Helper around creating vertex attributes in a given {@apilink VertexBuffer}, this is useful for describing\r\n * the memory layout for your vertices inside a particular buffer\r\n *\r\n * Note: This helper assumes interleaved attributes in one {@apilink VertexBuffer}, not many.\r\n *\r\n * Working with `gl.vertexAttribPointer` can be tricky, and this attempts to double check you\r\n */\r\nexport class VertexLayout {\r\n  private _gl: WebGL2RenderingContext;\r\n  private _logger = Logger.getInstance();\r\n  private _suppressWarnings = false;\r\n  private _shader: Shader;\r\n  private _layout: VertexAttributeDefinition[] = [];\r\n  private _attributes: [name: string, numberOfComponents: number, type?: 'int' | 'matrix' | 'float'][] = [];\r\n  private _vertexBuffer: VertexBuffer;\r\n  private _vao!: WebGLVertexArrayObject;\r\n\r\n  public get vertexBuffer() {\r\n    return this._vertexBuffer;\r\n  }\r\n\r\n  public get attributes(): readonly [name: string, numberOfComponents: number, type?: 'int' | 'matrix' | 'float'][] {\r\n    return this._attributes;\r\n  }\r\n\r\n  constructor(options: VertexLayoutOptions) {\r\n    const { gl, shader, vertexBuffer, attributes, suppressWarnings } = options;\r\n    this._gl = gl;\r\n    this._vertexBuffer = vertexBuffer;\r\n    this._attributes = attributes;\r\n    this._shader = shader!;\r\n    this._suppressWarnings = suppressWarnings!;\r\n    if (shader) {\r\n      this.initialize();\r\n    }\r\n  }\r\n\r\n  private _vertexTotalSizeBytes = 0;\r\n  /**\r\n   * Total number of bytes that the vertex will take up\r\n   */\r\n  public get totalVertexSizeBytes(): number {\r\n    return this._vertexTotalSizeBytes;\r\n  }\r\n\r\n  public set shader(shader: Shader) {\r\n    if (shader && this._shader !== shader) {\r\n      this._shader = shader;\r\n      this.initialize();\r\n    }\r\n  }\r\n\r\n  public get shader() {\r\n    return this._shader;\r\n  }\r\n\r\n  private _initialized = false;\r\n\r\n  /**\r\n   * Layouts need shader locations and must be bound to a shader\r\n   */\r\n  initialize() {\r\n    if (this._initialized) {\r\n      return;\r\n    }\r\n    if (!this._shader) {\r\n      return;\r\n    }\r\n\r\n    if (!this._shader.compiled) {\r\n      throw Error('Shader not compiled, shader must be compiled before defining a vertex layout');\r\n    }\r\n    this._vertexTotalSizeBytes = 0;\r\n    this._layout.length = 0;\r\n    const shaderAttributes = this._shader.attributes;\r\n    for (const attribute of this._attributes) {\r\n      const attrib = shaderAttributes[attribute[0]];\r\n      if (!attrib) {\r\n        if (!isAttributeInSource(this._shader.vertexSource, attribute[0])) {\r\n          throw Error(\r\n            `The attribute named: ${attribute[0]} size ${attribute[1]}` +\r\n              ` not found in the shader source code:\\n ${this._shader.vertexSource}`\r\n          );\r\n        }\r\n\r\n        if (!this._suppressWarnings) {\r\n          this._logger.warn(\r\n            `The attribute named: ${attribute[0]} size ${attribute[1]}` +\r\n              ` not found in the compiled shader. This is possibly a bug:\\n` +\r\n              ` 1. Not a bug, but should remove unused code - attribute \"${attribute[0]}\" is unused in` +\r\n              ` vertex/fragment and has been automatically removed by glsl compiler.\\n` +\r\n              ` 2. Definitely a bug, attribute \"${attribute[0]}\" in layout has been mistyped or is missing` +\r\n              ` in shader, check vertex/fragment source.`\r\n          );\r\n        }\r\n\r\n        const glType = getGLTypeFromSource(this._gl, this._shader.vertexSource, attribute[0]);\r\n\r\n        // Unused attribute placeholder\r\n        this._layout.push({\r\n          name: attribute[0],\r\n          glType,\r\n          size: attribute[1],\r\n          location: -1,\r\n          normalized: false\r\n        });\r\n      }\r\n      if (attrib) {\r\n        if (attrib.size !== attribute[1]) {\r\n          throw Error(\r\n            `VertexLayout size definition for attribute: [${attribute[0]}, ${attribute[1]}],` +\r\n              ` doesn\\'t match shader source size ${attrib.size}:\\n ${this._shader.vertexSource}`\r\n          );\r\n        }\r\n        this._layout.push(attrib);\r\n      }\r\n    }\r\n\r\n    // calc size\r\n    let componentsPerVertex = 0;\r\n    for (const vertAttribute of this._layout) {\r\n      const typeSize = getGlTypeSizeBytes(this._gl, vertAttribute.glType);\r\n      this._vertexTotalSizeBytes += typeSize * vertAttribute.size;\r\n      componentsPerVertex += vertAttribute.size;\r\n    }\r\n\r\n    if (this._vertexBuffer.bufferData.length % componentsPerVertex !== 0) {\r\n      this._logger.warn(\r\n        `The vertex component size (${componentsPerVertex})  does NOT divide evenly into the specified vertex buffer` +\r\n          ` (${this._vertexBuffer.bufferData.length})`\r\n      );\r\n    }\r\n\r\n    // create VAO\r\n    const gl = this._gl;\r\n    this._vao = gl.createVertexArray()!;\r\n    gl.bindVertexArray(this._vao);\r\n    this._vertexBuffer.bind();\r\n\r\n    let offset = 0;\r\n    for (const vert of this._layout) {\r\n      // skip unused attributes\r\n      if (vert.location !== -1) {\r\n        if (vert.glType === gl.INT) {\r\n          gl.vertexAttribIPointer(vert.location, vert.size, vert.glType, this.totalVertexSizeBytes, offset);\r\n        } else {\r\n          gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\r\n        }\r\n        gl.enableVertexAttribArray(vert.location);\r\n      }\r\n      offset += getGlTypeSizeBytes(gl, vert.glType) * vert.size;\r\n    }\r\n    gl.bindVertexArray(null);\r\n    this._vertexBuffer.unbind();\r\n\r\n    this._initialized = true;\r\n  }\r\n\r\n  /**\r\n   * Bind this layout with it's associated vertex buffer\r\n   * @param uploadBuffer Optionally indicate you wish to upload the buffer to the GPU associated with this layout\r\n   */\r\n  use(uploadBuffer = false, count?: number) {\r\n    if (!this._shader) {\r\n      throw Error('No shader is associated with this vertex layout, a shader must be set');\r\n    }\r\n\r\n    const gl = this._gl;\r\n    if (!this._shader.isCurrentlyBound()) {\r\n      throw Error('Shader associated with this vertex layout is not active! Call shader.use() before layout.use()');\r\n    }\r\n    this._vertexBuffer.bind();\r\n    if (uploadBuffer) {\r\n      this._vertexBuffer.upload(count);\r\n    }\r\n    gl.bindVertexArray(this._vao);\r\n  }\r\n}\r\n","export class GraphicsDiagnostics {\n  public static DrawCallCount: number = 0;\n  public static DrawnImagesCount: number = 0;\n  public static clear(): void {\n    GraphicsDiagnostics.DrawCallCount = 0;\n    GraphicsDiagnostics.DrawnImagesCount = 0;\n  }\n}\n","import { vec, Vector } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport lineVertexSource from './line-vertex.glsl';\r\nimport lineFragmentSource from './line-fragment.glsl';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader, VertexBuffer, VertexLayout } from '../..';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\n\r\nexport interface LineOptions {\r\n  color?: Color;\r\n  width?: number;\r\n}\r\n\r\nexport class LineRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.line';\r\n  public priority: number = 0;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGL2RenderingContext;\r\n  private _shader!: Shader;\r\n  private _maxLines: number = 10922;\r\n  private _vertexBuffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _vertexIndex = 0;\r\n  private _lineCount = 0;\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: lineVertexSource,\r\n      fragmentSource: lineFragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    this._vertexBuffer = new VertexBuffer({\r\n      gl,\r\n      size: 6 * 2 * this._maxLines,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      vertexBuffer: this._vertexBuffer,\r\n      shader: this._shader,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_color', 4]\r\n      ]\r\n    });\r\n  }\r\n\r\n  public dispose() {\r\n    this._vertexBuffer.dispose();\r\n    this._shader.dispose();\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _startScratch = vec(0, 0);\r\n  private _endScratch = vec(0, 0);\r\n  draw(start: Vector, end: Vector, color: Color): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._lineCount++;\r\n\r\n    const transform = this._context.getTransform();\r\n    const finalStart = transform.multiply(start, this._startScratch);\r\n    const finalEnd = transform.multiply(end, this._endScratch);\r\n\r\n    const vertexBuffer = this._vertexBuffer.bufferData;\r\n    // Start\r\n    vertexBuffer[this._vertexIndex++] = finalStart.x;\r\n    vertexBuffer[this._vertexIndex++] = finalStart.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n\r\n    // End\r\n    vertexBuffer[this._vertexIndex++] = finalEnd.x;\r\n    vertexBuffer[this._vertexIndex++] = finalEnd.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._lineCount >= this._maxLines) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._lineCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._lineCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use(true);\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    gl.drawArrays(gl.LINES, 0, this._lineCount * 2); // 2 verts per line\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._lineCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // reset\r\n    this._vertexIndex = 0;\r\n    this._lineCount = 0;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\nin vec4 a_color;\\r\\n\\r\\nout lowp vec4 v_color;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Passthrough the color\\r\\n   v_color = a_color;\\r\\n}\";","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// Color\\r\\nin lowp vec4 v_color;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  fragColor = v_color;\\r\\n}\";","import pointVertexSource from './point-vertex.glsl';\r\nimport pointFragmentSource from './point-fragment.glsl';\r\nimport { Vector } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\n\r\nexport class PointRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.point';\r\n  public priority: number = 0;\r\n  private _shader!: Shader;\r\n  private _maxPoints: number = 10922;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _gl!: WebGLRenderingContext;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _pointCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: pointVertexSource,\r\n      fragmentSource: pointFragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 7 * this._maxPoints,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_color', 4],\r\n        ['a_size', 1]\r\n      ]\r\n    });\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._shader.dispose();\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  draw(point: Vector, color: Color, size: number): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._pointCount++;\r\n\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const finalPoint = transform.multiply(point);\r\n\r\n    if (snapToPixel) {\r\n      finalPoint.x = ~~(finalPoint.x + pixelSnapEpsilon);\r\n      finalPoint.y = ~~(finalPoint.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    const vertexBuffer = this._buffer.bufferData;\r\n    vertexBuffer[this._vertexIndex++] = finalPoint.x;\r\n    vertexBuffer[this._vertexIndex++] = finalPoint.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a * opacity;\r\n    vertexBuffer[this._vertexIndex++] = size * Math.max(transform.getScaleX(), transform.getScaleY());\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._pointCount >= this._maxPoints) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._pointCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._pointCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use(true);\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    gl.drawArrays(gl.POINTS, 0, this._pointCount);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._pointCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    this._pointCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\nin vec4 a_color;\\r\\nin float a_size;\\r\\nout lowp vec4 v_color;\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n  gl_PointSize = a_size * 2.0;\\r\\n  v_color = a_color;\\r\\n}\";","export default \"#version 300 es\\r\\n\\r\\nprecision mediump float;\\r\\nin lowp vec4 v_color;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\r\\n  r = dot(cxy, cxy);\\r\\n\\r\\n  delta = fwidth(r);\\r\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\r\\n  // \\\"premultiply\\\" the color by alpha\\r\\n  vec4 color = v_color;\\r\\n  color.a = color.a * alpha;\\r\\n  color.rgb = color.rgb * color.a;\\r\\n  fragColor = color;\\r\\n}\";","import screenVertex from './screen-vertex.glsl';\r\nimport screenFragment from './screen-fragment.glsl';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { PostProcessor } from '../../PostProcessor/PostProcessor';\r\n\r\n/**\r\n * This is responsible for painting the entire screen during the render passes\r\n */\r\nexport class ScreenPassPainter {\r\n  private _gl: WebGLRenderingContext;\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  constructor(gl: WebGL2RenderingContext) {\r\n    this._gl = gl;\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: screenVertex,\r\n      fragmentSource: screenFragment\r\n    });\r\n    this._shader.compile();\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      type: 'static',\r\n      // clip space quad + uv since we don't need a camera\r\n      data: new Float32Array([\r\n        -1, -1, 0, 0, -1, 1, 0, 1, 1, -1, 1, 0,\r\n\r\n        1, -1, 1, 0, -1, 1, 0, 1, 1, 1, 1, 1\r\n      ])\r\n    });\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_texcoord', 2]\r\n      ]\r\n    });\r\n    this._buffer.upload();\r\n  }\r\n\r\n  renderWithPostProcessor(postprocessor: PostProcessor): void {\r\n    const gl = this._gl;\r\n    const shader = postprocessor.getShader();\r\n    shader.use();\r\n    postprocessor.getLayout().use();\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    shader.trySetUniformInt('u_image', 0);\r\n    if (postprocessor.onDraw) {\r\n      postprocessor.onDraw();\r\n    }\r\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n  }\r\n\r\n  renderToScreen(): void {\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use();\r\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\nin vec2 a_texcoord;\\r\\nout vec2 v_texcoord;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n  // Pass the texcoord to the fragment shader.\\r\\n  v_texcoord = a_texcoord;\\r\\n}\";","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// Passed in from the vertex shader.\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// The texture.\\r\\nuniform sampler2D u_texture;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n   fragColor = texture(u_texture, v_texcoord);\\r\\n}\";","import { Logger } from '../..';\r\n\r\n/**\r\n * Helper that defines and index buffer for quad geometry\r\n *\r\n * Index buffers allow you to save space in vertex buffers when you share vertices in geometry\r\n * it is almost always worth it in terms of performance to use an index buffer.\r\n */\r\nexport class QuadIndexBuffer {\r\n  private _gl: WebGL2RenderingContext;\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Access to the webgl buffer handle\r\n   */\r\n  public buffer: WebGLBuffer;\r\n  /**\r\n   * Access to the raw data of the index buffer\r\n   */\r\n  public bufferData: Uint16Array | Uint32Array;\r\n  /**\r\n   * Depending on the browser this is either gl.UNSIGNED_SHORT or gl.UNSIGNED_INT\r\n   */\r\n  public bufferGlType!: number;\r\n\r\n  /**\r\n   * @param gl WebGL2RenderingContext this layout will be attached to, these cannot be reused across contexts.\r\n   * @param numberOfQuads Specify the max number of quads you want to draw\r\n   * @param useUint16 Optionally force a uint16 buffer\r\n   */\r\n  constructor(gl: WebGL2RenderingContext, numberOfQuads: number, useUint16?: boolean) {\r\n    this._gl = gl;\r\n    this.buffer = gl.createBuffer()!;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n\r\n    const totalVertices = numberOfQuads * 6;\r\n\r\n    if (!useUint16) {\r\n      this.bufferData = new Uint32Array(totalVertices);\r\n    } else {\r\n      // fall back to using gl.UNSIGNED_SHORT or tell the user they are out of luck\r\n      const maxUint16 = 65_535;\r\n      const maxUint16Index = Math.floor((maxUint16 - 1) / 4); // max quads\r\n\r\n      this.bufferGlType = gl.UNSIGNED_SHORT;\r\n      this.bufferData = new Uint16Array(totalVertices);\r\n      // TODO Should we error if this happens?? maybe not might crash mid game\r\n      if (numberOfQuads > maxUint16Index) {\r\n        this._logger.warn(\r\n          `Total quads exceeds hardware index buffer limit (uint16), max(${maxUint16Index}) requested quads(${numberOfQuads})`\r\n        );\r\n      }\r\n    }\r\n\r\n    let currentQuad = 0;\r\n    for (let i = 0; i < totalVertices; i += 6) {\r\n      // first triangle\r\n      this.bufferData[i + 0] = currentQuad + 0;\r\n      this.bufferData[i + 1] = currentQuad + 1;\r\n      this.bufferData[i + 2] = currentQuad + 2;\r\n      // second triangle\r\n      this.bufferData[i + 3] = currentQuad + 2;\r\n      this.bufferData[i + 4] = currentQuad + 1;\r\n      this.bufferData[i + 5] = currentQuad + 3;\r\n      currentQuad += 4;\r\n    }\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\r\n  }\r\n\r\n  public get size() {\r\n    return this.bufferData.length;\r\n  }\r\n\r\n  /**\r\n   * Upload data to the GPU\r\n   */\r\n  public upload() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\r\n  }\r\n\r\n  /**\r\n   * Bind this index buffer\r\n   */\r\n  public bind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n  }\r\n\r\n  public dispose() {\r\n    const gl = this._gl;\r\n    gl.deleteBuffer(this.buffer);\r\n    this._gl = null as any;\r\n  }\r\n}\r\n","import { Color } from '../../../Color';\r\nimport { sign } from '../../../Math/util';\r\nimport { parseImageFiltering } from '../../Filtering';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ImageSourceAttributeConstants } from '../../ImageSource';\r\nimport { parseImageWrapping } from '../../Wrapping';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { getMaxShaderComplexity } from '../webgl-util';\r\nimport frag from './image-renderer.frag.glsl';\r\nimport vert from './image-renderer.vert.glsl';\r\n\r\nexport interface ImageRendererOptions {\r\n  pixelArtSampler: boolean;\r\n  uvPadding: number;\r\n}\r\n\r\nexport class ImageRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.image';\r\n  public priority: number = 0;\r\n\r\n  public readonly pixelArtSampler: boolean;\r\n  public readonly uvPadding: number;\r\n\r\n  private _maxImages: number = 10922; // max(uint16) / 6 verts\r\n  private _maxTextures: number = 0;\r\n\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGLRenderingContext;\r\n  private _shader!: Shader;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _quads!: QuadIndexBuffer;\r\n\r\n  // Per flush vars\r\n  private _imageCount: number = 0;\r\n  private _textures: WebGLTexture[] = [];\r\n  private _textureIndex = 0;\r\n  private _textureToIndex = new Map<WebGLTexture, number>();\r\n  private _images = new Set<HTMLImageSource>();\r\n  private _vertexIndex: number = 0;\r\n\r\n  constructor(options: ImageRendererOptions) {\r\n    this.pixelArtSampler = options.pixelArtSampler;\r\n    this.uvPadding = options.uvPadding;\r\n  }\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // Transform shader source\r\n    // FIXME: PIXEL 6 complains `ERROR: Expression too complex.` if we use it's reported max texture units, 125 seems to work for now...\r\n    const maxTexture = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n    const maxComplexity = getMaxShaderComplexity(gl, maxTexture);\r\n    this._maxTextures = Math.min(maxTexture, maxComplexity);\r\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\r\n    // Compile shader\r\n    this._shader = new Shader({\r\n      gl,\r\n      fragmentSource: transformedFrag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    this._shader.setUniformIntArray(\r\n      'u_textures',\r\n      [...Array(this._maxTextures)].map((_, i) => i)\r\n    );\r\n\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 12 * 4 * this._maxImages, // 12 components * 4 verts\r\n      type: 'dynamic'\r\n    });\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_opacity', 1],\r\n        ['a_res', 2],\r\n        ['a_texcoord', 2],\r\n        ['a_textureIndex', 1],\r\n        ['a_tint', 4]\r\n      ]\r\n    });\r\n\r\n    // Setup index buffer\r\n    this._quads = new QuadIndexBuffer(gl, this._maxImages, true);\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._quads.dispose();\r\n    this._shader.dispose();\r\n    this._textures.length = 0;\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;\\n`;\r\n      texturePickerBuilder += `      color = texture(u_textures[${i}], uv);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  private _addImageAsTexture(image: HTMLImageSource) {\r\n    if (this._images.has(image)) {\r\n      return;\r\n    }\r\n    const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = image.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._context.textureLoader.load(\r\n      image,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    )!;\r\n    // remove force attribute after upload\r\n    image.removeAttribute('forceUpload');\r\n    if (this._textures.indexOf(texture) === -1) {\r\n      this._textures.push(texture);\r\n      this._textureToIndex.set(texture, this._textureIndex++);\r\n      this._images.add(image);\r\n    }\r\n  }\r\n\r\n  private _bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    for (let i = 0; i < this._maxTextures; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\r\n    }\r\n  }\r\n\r\n  private _getTextureIdForImage(image: HTMLImageSource) {\r\n    if (image) {\r\n      const maybeTexture = this._context.textureLoader.get(image);\r\n      return this._textureToIndex.get(maybeTexture) ?? -1; //this._textures.indexOf(maybeTexture);\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._imageCount >= this._maxImages) {\r\n      return true;\r\n    }\r\n    if (this._textures.length >= this._maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _imageToWidth = new Map<HTMLImageSource, number>();\r\n  private _getImageWidth(image: HTMLImageSource) {\r\n    let maybeWidth = this._imageToWidth.get(image);\r\n    if (maybeWidth === undefined) {\r\n      maybeWidth = image.width;\r\n      this._imageToWidth.set(image, maybeWidth);\r\n    }\r\n    return maybeWidth;\r\n  }\r\n\r\n  private _imageToHeight = new Map<HTMLImageSource, number>();\r\n  private _getImageHeight(image: HTMLImageSource) {\r\n    let maybeHeight = this._imageToHeight.get(image);\r\n    if (maybeHeight === undefined) {\r\n      maybeHeight = image.height;\r\n      this._imageToHeight.set(image, maybeHeight);\r\n    }\r\n    return maybeHeight;\r\n  }\r\n\r\n  private _view = [0, 0, 0, 0];\r\n  private _dest = [0, 0];\r\n  private _quad = [0, 0, 0, 0, 0, 0, 0, 0];\r\n  private _defaultTint = Color.White;\r\n  draw(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._imageCount++;\r\n    // This creates and uploads the texture if not already done\r\n    this._addImageAsTexture(image);\r\n    const maybeImageWidth = this._getImageWidth(image);\r\n    const maybeImageHeight = this._getImageHeight(image);\r\n\r\n    let width = maybeImageWidth || swidth || 0;\r\n    let height = maybeImageHeight || sheight || 0;\r\n    this._view[0] = 0;\r\n    this._view[1] = 0;\r\n    this._view[2] = swidth ?? maybeImageWidth ?? 0;\r\n    this._view[3] = sheight ?? maybeImageHeight ?? 0;\r\n    this._dest[0] = sx ?? 1;\r\n    this._dest[1] = sy ?? 1;\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      this._view[0] = sx ?? 1;\r\n      this._view[1] = sy ?? 1;\r\n      this._view[2] = swidth ?? maybeImageWidth ?? 0;\r\n      this._view[3] = sheight ?? maybeImageHeight ?? 0;\r\n      this._dest[0] = dx;\r\n      this._dest[1] = dy;\r\n      width = dwidth;\r\n      height = dheight;\r\n    }\r\n\r\n    sx = this._view[0];\r\n    sy = this._view[1];\r\n    const sw = this._view[2];\r\n    const sh = this._view[3];\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    // top left\r\n    this._quad[0] = this._dest[0];\r\n    this._quad[1] = this._dest[1];\r\n\r\n    // top right\r\n    this._quad[2] = this._dest[0] + width;\r\n    this._quad[3] = this._dest[1];\r\n\r\n    // bottom left\r\n    this._quad[4] = this._dest[0];\r\n    this._quad[5] = this._dest[1] + height;\r\n\r\n    // bottom right\r\n    this._quad[6] = this._dest[0] + width;\r\n    this._quad[7] = this._dest[1] + height;\r\n\r\n    transform.multiplyQuadInPlace(this._quad);\r\n\r\n    if (snapToPixel) {\r\n      this._quad[0] = ~~(this._quad[0] + sign(this._quad[0]) * pixelSnapEpsilon);\r\n      this._quad[1] = ~~(this._quad[1] + sign(this._quad[1]) * pixelSnapEpsilon);\r\n\r\n      this._quad[2] = ~~(this._quad[2] + sign(this._quad[2]) * pixelSnapEpsilon);\r\n      this._quad[3] = ~~(this._quad[3] + sign(this._quad[3]) * pixelSnapEpsilon);\r\n\r\n      this._quad[4] = ~~(this._quad[4] + sign(this._quad[4]) * pixelSnapEpsilon);\r\n      this._quad[5] = ~~(this._quad[5] + sign(this._quad[5]) * pixelSnapEpsilon);\r\n\r\n      this._quad[6] = ~~(this._quad[6] + sign(this._quad[6]) * pixelSnapEpsilon);\r\n      this._quad[7] = ~~(this._quad[7] + sign(this._quad[7]) * pixelSnapEpsilon);\r\n    }\r\n\r\n    const tint = this._context.tint || this._defaultTint;\r\n\r\n    const textureId = this._getTextureIdForImage(image);\r\n    const imageWidth = maybeImageWidth || width;\r\n    const imageHeight = maybeImageHeight || height;\r\n\r\n    const uvx0 = (sx + this.uvPadding) / imageWidth;\r\n    const uvy0 = (sy + this.uvPadding) / imageHeight;\r\n    const uvx1 = (sx + sw - this.uvPadding) / imageWidth;\r\n    const uvy1 = (sy + sh - this.uvPadding) / imageHeight;\r\n\r\n    const txWidth = maybeImageWidth;\r\n    const txHeight = maybeImageHeight;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = this._quad[0];\r\n    vertexBuffer[this._vertexIndex++] = this._quad[1];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = this._quad[4];\r\n    vertexBuffer[this._vertexIndex++] = this._quad[5];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = this._quad[2];\r\n    vertexBuffer[this._vertexIndex++] = this._quad[3];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = this._quad[6];\r\n    vertexBuffer[this._vertexIndex++] = this._quad[7];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._imageCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._imageCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true, 4 * 12 * this._imageCount); // 4 verts * 12 components\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Turn on pixel art aa sampler\r\n    this._shader.setUniformBoolean('u_pixelart', this.pixelArtSampler);\r\n\r\n    // Bind textures to\r\n    this._bindTextures(gl);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._imageCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._imageCount = 0;\r\n    this._vertexIndex = 0;\r\n    this._textures.length = 0;\r\n    this._textureIndex = 0;\r\n    this._textureToIndex.clear();\r\n    this._images.clear();\r\n    this._imageToWidth.clear();\r\n    this._imageToHeight.clear();\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// Texture index\\r\\nin lowp float v_textureIndex;\\r\\n\\r\\n// Textures in the current draw\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\nuniform bool u_pixelart;\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nin vec4 v_tint;\\r\\n\\r\\nin vec2 v_res;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\n// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\\r\\nvec2 uv_iq(in vec2 uv, in vec2 texture_size) {\\r\\n  vec2 pixel = uv * texture_size;\\r\\n  \\r\\n  vec2 seam=floor(pixel+.5);\\r\\n  vec2 dudv=fwidth(pixel);\\r\\n  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\\r\\n  \\r\\n  return pixel/texture_size;\\r\\n}\\r\\n\\r\\nvoid main(){\\r\\n  // In order to support the most efficient sprite batching, we have multiple\\r\\n  // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n  // that do not apply to a particular sprite.\\r\\n  \\r\\n  vec4 color=vec4(1.,0,0,1.);\\r\\n  \\r\\n  // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n  %%texture_picker%%\\r\\n  \\r\\n  color.rgb=color.rgb*v_opacity;\\r\\n  color.a=color.a*v_opacity;\\r\\n  fragColor=color*v_tint;\\r\\n}\";","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// Opacity\\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_texcoord;\\r\\nout vec2 v_texcoord;\\r\\n\\r\\n// Texture res\\r\\nin vec2 a_res;\\r\\nout vec2 v_res;\\r\\n\\r\\n// Texture number\\r\\nin lowp float a_textureIndex;\\r\\nout lowp float v_textureIndex;\\r\\n\\r\\nin vec4 a_tint;\\r\\nout vec4 v_tint;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main(){\\r\\n  // Set the vertex position using the ortho transform matrix\\r\\n  gl_Position=u_matrix*vec4(a_position,0.,1.);\\r\\n  \\r\\n  // Pass through the Opacity to the fragment shader\\r\\n  v_opacity=a_opacity;\\r\\n  // Pass through the UV coord to the fragment shader\\r\\n  v_texcoord=a_texcoord;\\r\\n\\r\\n  v_res = a_res;\\r\\n\\r\\n  // Pass through the texture number to the fragment shader\\r\\n  v_textureIndex=a_textureIndex;\\r\\n  // Pass through the tint\\r\\n  v_tint=a_tint;\\r\\n}\";","import { Color } from '../../../Color';\r\nimport { vec, Vector } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nimport frag from './rectangle-renderer.frag.glsl';\r\nimport vert from './rectangle-renderer.vert.glsl';\r\n\r\nexport class RectangleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.rectangle';\r\n  public priority: number = 0;\r\n\r\n  private _maxRectangles: number = 10922; // max(uint16) / 6 verts\r\n\r\n  private _shader!: Shader;\r\n  private _gl!: WebGLRenderingContext;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _quads!: QuadIndexBuffer;\r\n  private _rectangleCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r\n    this._shader = new Shader({\r\n      gl,\r\n      fragmentSource: frag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 16 * 4 * this._maxRectangles,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_size', 2],\r\n        ['a_opacity', 1],\r\n        ['a_color', 4],\r\n        ['a_strokeColor', 4],\r\n        ['a_strokeThickness', 1]\r\n      ]\r\n    });\r\n    this._quads = new QuadIndexBuffer(gl, this._maxRectangles, true);\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._quads.dispose();\r\n    this._shader.dispose();\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._rectangleCount >= this._maxRectangles) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  draw(...args: any[]): void {\r\n    if (args[0] instanceof Vector && args[1] instanceof Vector) {\r\n      this.drawLine.apply(this, args as any);\r\n    } else {\r\n      this.drawRectangle.apply(this, args as any);\r\n    }\r\n  }\r\n\r\n  private _transparent = Color.Transparent;\r\n  private _scratch1 = vec(0, 0);\r\n  private _scratch2 = vec(0, 0);\r\n  private _scratch3 = vec(0, 0);\r\n  private _scratch4 = vec(0, 0);\r\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number = 1) {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._rectangleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const dir = end.sub(start);\r\n    const length = dir.magnitude;\r\n    const normal = dir.normalize().perpendicular();\r\n    const halfThick = thickness / 2;\r\n\r\n    /**\r\n     *    +---------------------^----------------------+\r\n     *    |                     | (normal)             |\r\n     *   (startX, startY)------------------>(endX, endY)\r\n     *    |                                            |\r\n     *    + -------------------------------------------+\r\n     */\r\n    const startTop = transform.multiply(normal.scale(halfThick, this._scratch1).add(start, this._scratch1), this._scratch1);\r\n    const startBottom = transform.multiply(normal.scale(-halfThick, this._scratch2).add(start, this._scratch2), this._scratch2);\r\n    const endTop = transform.multiply(normal.scale(halfThick, this._scratch3).add(end, this._scratch3), this._scratch3);\r\n    const endBottom = transform.multiply(normal.scale(-halfThick, this._scratch4).add(end, this._scratch4), this._scratch4);\r\n\r\n    if (snapToPixel) {\r\n      startTop.x = ~~(startTop.x + pixelSnapEpsilon);\r\n      startTop.y = ~~(startTop.y + pixelSnapEpsilon);\r\n\r\n      endTop.x = ~~(endTop.x + pixelSnapEpsilon);\r\n      endTop.y = ~~(endTop.y + pixelSnapEpsilon);\r\n\r\n      startBottom.x = ~~(startBottom.x + pixelSnapEpsilon);\r\n      startBottom.y = ~~(startBottom.y + pixelSnapEpsilon);\r\n\r\n      endBottom.x = ~~(endBottom.x + pixelSnapEpsilon);\r\n      endBottom.y = ~~(endBottom.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO uv could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    const stroke = this._transparent;\r\n    const strokeThickness = 0;\r\n    const width = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = startTop.x;\r\n    vertexBuffer[this._vertexIndex++] = startTop.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = startBottom.x;\r\n    vertexBuffer[this._vertexIndex++] = startBottom.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = endTop.x;\r\n    vertexBuffer[this._vertexIndex++] = endTop.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = endBottom.x;\r\n    vertexBuffer[this._vertexIndex++] = endBottom.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n  }\r\n\r\n  drawRectangle(\r\n    pos: Vector,\r\n    width: number,\r\n    height: number,\r\n    color: Color,\r\n    stroke: Color = Color.Transparent,\r\n    strokeThickness: number = 0\r\n  ): void {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._rectangleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const topLeft = transform.multiply(pos.add(vec(0, 0)));\r\n    const topRight = transform.multiply(pos.add(vec(width, 0)));\r\n    const bottomRight = transform.multiply(pos.add(vec(width, height)));\r\n    const bottomLeft = transform.multiply(pos.add(vec(0, height)));\r\n\r\n    if (snapToPixel) {\r\n      topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\r\n      topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\r\n\r\n      topRight.x = ~~(topRight.x + pixelSnapEpsilon);\r\n      topRight.y = ~~(topRight.y + pixelSnapEpsilon);\r\n\r\n      bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\r\n      bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\r\n\r\n      bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\r\n      bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO uv could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._rectangleCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._rectangleCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._rectangleCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._rectangleCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._rectangleCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\n\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_uv;\\r\\n\\r\\nin vec2 v_size; // in pixels\\r\\n\\r\\n// Color coord to blend with image\\r\\nin lowp vec4 v_color;\\r\\n\\r\\n// Stroke color if used\\r\\nin lowp vec4 v_strokeColor;\\r\\n\\r\\n// Stroke thickness if used\\r\\nin lowp float v_strokeThickness; // in pixels\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\\r\\n    vec2 uv = v_uv;\\r\\n    vec2 fragCoord = uv * v_size;\\r\\n    float maxX = v_size.x - v_strokeThickness;\\r\\n    float minX = v_strokeThickness;\\r\\n    float maxY = v_size.y - v_strokeThickness;\\r\\n    float minY = v_strokeThickness;\\r\\n\\r\\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\\r\\n        fragCoord.y < maxY && fragCoord.y > minY) {\\r\\n      fragColor = v_color;\\r\\n    } else {\\r\\n      fragColor = v_strokeColor;\\r\\n    }\\r\\n    fragColor.a *= v_opacity;\\r\\n    fragColor.rgb *= fragColor.a;\\r\\n\\r\\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\\r\\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\\r\\n\\r\\n    // float fHalfBorderDist      = 0.0;\\r\\n    // float fHalfBorderThickness = 0.0;\\r\\n\\r\\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \\r\\n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\\r\\n    // {\\r\\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\\r\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\r\\n    // }\\r\\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \\r\\n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\\r\\n    // {\\r\\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\\r\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\r\\n    // }\\r\\n    // else\\r\\n    // {\\r\\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\\r\\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\\r\\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\\r\\n        \\r\\n    //     float ellipse_ab    = v_radius-v_strokeThickness;\\r\\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\\r\\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \\r\\n            \\r\\n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\\r\\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\\r\\n    // }\\r\\n\\r\\n    // vec4 v4FromColor = v_strokeColor;\\r\\n    // v4FromColor.rgb *= v4FromColor.a;\\r\\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\\r\\n    // if (fHalfBorderDist < 0.0) {\\r\\n    //     v4ToColor = v_color;\\r\\n    //     v4ToColor.rgb *= v4ToColor.a;\\r\\n    // }\\r\\n\\r\\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\\r\\n\\r\\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\\r\\n    // gl_FragColor = finalColor;\\r\\n}\";","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_uv;\\r\\nout vec2 v_uv;\\r\\n\\r\\nin vec2 a_size;\\r\\nout vec2 v_size;\\r\\n\\r\\n// Opacity \\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\nin vec4 a_color;\\r\\nout vec4 v_color;\\r\\n\\r\\nin vec4 a_strokeColor;\\r\\nout vec4 v_strokeColor;\\r\\n\\r\\nin float a_strokeThickness;\\r\\nout float v_strokeThickness;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through UV coords\\r\\n   v_uv = a_uv;\\r\\n   // Pass through size\\r\\n   v_size = a_size;\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n   // Pass through the stroke color to the fragment shader\\r\\n   v_strokeColor = a_strokeColor;\\r\\n   // Pass through the stroke thickenss to the fragment shader\\r\\n   v_strokeThickness = a_strokeThickness;\\r\\n}\";","import { Color } from '../../../Color';\r\nimport { vec, Vector } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nimport frag from './circle-renderer.frag.glsl';\r\nimport vert from './circle-renderer.vert.glsl';\r\n\r\nexport class CircleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.circle';\r\n  public priority: number = 0;\r\n\r\n  private _maxCircles: number = 10922; // max(uint16) / 6 verts\r\n\r\n  private _shader!: Shader;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGLRenderingContext;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  private _quads!: QuadIndexBuffer;\r\n\r\n  private _circleCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      gl,\r\n      fragmentSource: frag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 14 * 4 * this._maxCircles,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_opacity', 1],\r\n        ['a_color', 4],\r\n        ['a_strokeColor', 4],\r\n        ['a_strokeThickness', 1]\r\n      ]\r\n    });\r\n\r\n    this._quads = new QuadIndexBuffer(gl, this._maxCircles, true);\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._quads.dispose();\r\n    this._shader.dispose();\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._circleCount >= this._maxCircles) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  draw(pos: Vector, radius: number, color: Color, stroke: Color = Color.Transparent, strokeThickness: number = 0): void {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._circleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const topLeft = transform.multiply(pos.add(vec(-radius, -radius)));\r\n    const topRight = transform.multiply(pos.add(vec(radius, -radius)));\r\n    const bottomRight = transform.multiply(pos.add(vec(radius, radius)));\r\n    const bottomLeft = transform.multiply(pos.add(vec(-radius, radius)));\r\n\r\n    if (snapToPixel) {\r\n      topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\r\n      topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\r\n\r\n      topRight.x = ~~(topRight.x + pixelSnapEpsilon);\r\n      topRight.y = ~~(topRight.y + pixelSnapEpsilon);\r\n\r\n      bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\r\n      bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\r\n\r\n      bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\r\n      bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO UV could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._circleCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._circleCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._circleCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._circleCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._circleCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision highp float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_uv;\\r\\n\\r\\n// Color coord to blend with image\\r\\nin lowp vec4 v_color;\\r\\n\\r\\n// Stroke color if used\\r\\nin lowp vec4 v_strokeColor;\\r\\n\\r\\n// Stroke thickness if used\\r\\nin lowp float v_strokeThickness;\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  // make (0, 0) the center the uv \\r\\n  vec2 uv = v_uv * 2.0 - 1.0;\\r\\n\\r\\n  vec4 color = v_color;\\r\\n  vec4 strokeColor = v_strokeColor;\\r\\n\\r\\n  // circle border is at radius 1.0 \\r\\n  // dist is > 0 when inside the circle \\r\\n  float d = length(uv);\\r\\n  float dist = 1.0 - length(uv);\\r\\n\\r\\n  // Fade based on fwidth\\r\\n  float fade = fwidth(dot(uv, uv));\\r\\n\\r\\n  // if dist is greater than 0 step to 1;\\r\\n  // when we cross this 0 threshold add a smooth fade\\r\\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\\r\\n\\r\\n  // if dist is greater than the stroke thickness step to 1\\r\\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\\r\\n\\r\\n  strokeColor.a *= fill * stroke;\\r\\n  strokeColor.rgb *= strokeColor.a;\\r\\n\\r\\n  color.a *= fill * (1.0 - stroke);\\r\\n  color.rgb *= color.a;\\r\\n\\r\\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\\r\\n  finalColor.rgb = finalColor.rgb * v_opacity;\\r\\n  finalColor.a = finalColor.a * v_opacity;\\r\\n  fragColor = finalColor;\\r\\n}\";","export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_uv;\\r\\nout vec2 v_uv;\\r\\n\\r\\n// Opacity \\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\nin vec4 a_color;\\r\\nout vec4 v_color;\\r\\n\\r\\nin vec4 a_strokeColor;\\r\\nout vec4 v_strokeColor;\\r\\n\\r\\nin float a_strokeThickness;\\r\\nout float v_strokeThickness;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through UV coords\\r\\n   v_uv = a_uv;\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n   // Pass through the stroke color to the fragment shader\\r\\n   v_strokeColor = a_strokeColor;\\r\\n   // Pass through the stroke thickenss to the fragment shader\\r\\n   v_strokeThickness = a_strokeThickness;\\r\\n}\";","import { Logger } from '../Util/Log';\r\nexport class Pool<Type> {\r\n  public totalAllocations = 0;\r\n  public index = 0;\r\n  public objects: Type[] = [];\r\n  public disableWarnings = false;\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(\r\n    public builder: () => Type,\r\n    public recycler?: (instance: Type) => Type,\r\n    public maxObjects: number = 100\r\n  ) {}\r\n\r\n  dispose() {\r\n    this.objects.length = 0;\r\n  }\r\n\r\n  preallocate() {\r\n    for (let i = 0; i < this.maxObjects; i++) {\r\n      this.objects[i] = this.builder();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use many instances out of the in the context and return all to the pool.\r\n   *\r\n   * By returning values out of the context they will be un-hooked from the pool and are free to be passed to consumers\r\n   * @param context\r\n   */\r\n  using(context: (pool: Pool<Type>) => Type[] | void) {\r\n    const result = context(this);\r\n    if (result) {\r\n      return this.done(...result);\r\n    }\r\n    return this.done();\r\n  }\r\n\r\n  /**\r\n   * Use a single instance out of th pool and immediately return it to the pool\r\n   * @param context\r\n   */\r\n  borrow(context: (object: Type) => void) {\r\n    const object = this.get();\r\n    context(object);\r\n    this.index--;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\r\n   */\r\n  get(): Type {\r\n    if (this.index === this.maxObjects) {\r\n      if (!this.disableWarnings) {\r\n        this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\r\n      }\r\n      this.maxObjects = this.maxObjects * 2;\r\n    }\r\n\r\n    if (this.objects[this.index]) {\r\n      // Pool has an available object already constructed\r\n      if (this.recycler) {\r\n        return this.recycler(this.objects[this.index++]);\r\n      }\r\n      return this.objects[this.index++];\r\n    } else {\r\n      // New allocation\r\n      this.totalAllocations++;\r\n      const object = (this.objects[this.index++] = this.builder());\r\n      return object;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\r\n   *\r\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\r\n   * to be passed to consumers\r\n   * @param objects A list of object to separate from the pool\r\n   */\r\n  done(...objects: Type[]): Type[];\r\n  done(): void;\r\n  done(...objects: Type[]): Type[] | void {\r\n    // All objects in pool now considered \"free\"\r\n    this.index = 0;\r\n    for (const object of objects) {\r\n      const poolIndex = this.objects.indexOf(object);\r\n      // Build a new object to take the pool place\r\n      this.objects[poolIndex] = (this as any).builder();\r\n      this.totalAllocations++;\r\n    }\r\n    return objects;\r\n  }\r\n}\r\n","import { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\n\r\nexport class DrawCall {\r\n  public z: number = 0;\r\n  public priority: number = 0;\r\n  public renderer: string = '';\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public state: ExcaliburGraphicsContextState = {\r\n    z: 0,\r\n    opacity: 1,\r\n    tint: Color.White,\r\n    material: null\r\n  };\r\n  public args: any[] = new Array(10);\r\n}\r\n","import { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from './ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL } from './ExcaliburGraphicsContextWebGL';\r\nimport { Shader } from './shader';\r\nimport { Logger } from '../../Util/Log';\r\nimport { ImageSource, ImageSourceAttributeConstants } from '../ImageSource';\r\nimport { ImageFiltering, parseImageFiltering } from '../Filtering';\r\nimport { parseImageWrapping } from '../Wrapping';\r\n\r\nexport interface MaterialOptions {\r\n  /**\r\n   * Name the material for debugging\r\n   */\r\n  name?: string;\r\n\r\n  /**\r\n   * Excalibur graphics context to create the material (only WebGL is supported at the moment)\r\n   */\r\n  graphicsContext?: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Optionally specify a vertex shader\r\n   *\r\n   * If none supplied the default will be used\r\n   *\r\n   * ```\r\n   *  #version 300 es\r\n   *  // vertex position in local space\r\n   *  in vec2 a_position;\r\n   *  in vec2 a_uv;\r\n   *  out vec2 v_uv;\r\n   *  // orthographic projection matrix\r\n   *  uniform mat4 u_matrix;\r\n   *  // world space transform matrix\r\n   *  uniform mat4 u_transform;\r\n   *  void main() {\r\n   *    // Set the vertex position using the ortho & transform matrix\r\n   *    gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);\r\n   *    // Pass through the UV coord to the fragment shader\r\n   *    v_uv = a_uv;\r\n   *  }\r\n   * ```\r\n   */\r\n  vertexSource?: string;\r\n\r\n  /**\r\n   * Add custom fragment shader\r\n   *\r\n   * *Note: Excalibur image alpha's are pre-multiplied\r\n   *\r\n   * Pre-built varyings:\r\n   *\r\n   * * `in vec2 v_uv` - UV coordinate\r\n   * * `in vec2 v_screenuv` - UV coordinate\r\n   *\r\n   * Pre-built uniforms:\r\n   *\r\n   * * `uniform sampler2D u_graphic` - The current graphic displayed by the GraphicsComponent\r\n   * * `uniform vec2 u_resolution` - The current resolution of the screen\r\n   * * `uniform vec2 u_size;` - The current size of the graphic\r\n   * * `uniform vec4 u_color` - The current color of the material\r\n   * * `uniform float u_opacity` - The current opacity of the graphics context\r\n   *\r\n   */\r\n  fragmentSource: string;\r\n\r\n  /**\r\n   * Add custom color, by default ex.Color.Transparent\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Add additional images to the material, you are limited by the GPU's maximum texture slots\r\n   *\r\n   * Specify a dictionary of uniform sampler names to ImageSource\r\n   */\r\n  images?: Record<string, ImageSource>;\r\n}\r\n\r\nconst defaultVertexSource = `#version 300 es\r\nin vec2 a_position;\r\n\r\nin vec2 a_uv;\r\nout vec2 v_uv;\r\n\r\nin vec2 a_screenuv;\r\nout vec2 v_screenuv;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_transform;\r\n\r\nvoid main() {\r\n  // Set the vertex position using the ortho & transform matrix\r\n  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);\r\n\r\n  // Pass through the UV coord to the fragment shader\r\n  v_uv = a_uv;\r\n  v_screenuv = a_screenuv;\r\n}\r\n`;\r\n\r\nexport interface MaterialImageOptions {\r\n  filtering?: ImageFiltering;\r\n}\r\n\r\nexport class Material {\r\n  private _logger = Logger.getInstance();\r\n  private _name: string;\r\n  private _shader!: Shader;\r\n  private _color: Color = Color.Transparent;\r\n  private _initialized = false;\r\n  private _fragmentSource: string;\r\n  private _vertexSource: string;\r\n\r\n  private _images = new Map<string, ImageSource>();\r\n  private _textures = new Map<ImageSource, WebGLTexture>();\r\n  private _maxTextureSlots!: number;\r\n  private _graphicsContext!: ExcaliburGraphicsContextWebGL;\r\n\r\n  constructor(options: MaterialOptions) {\r\n    const { color, name, vertexSource, fragmentSource, graphicsContext, images } = options;\r\n    this._name = name ?? 'anonymous material';\r\n    this._vertexSource = vertexSource ?? defaultVertexSource;\r\n    this._fragmentSource = fragmentSource;\r\n    this._color = color ?? this._color;\r\n    if (!graphicsContext) {\r\n      throw Error(`Material ${name} must be provided an excalibur webgl graphics context`);\r\n    }\r\n    if (graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      this._graphicsContext = graphicsContext;\r\n      this._initialize(graphicsContext);\r\n    } else {\r\n      this._logger.warn(`Material ${name} was created in 2D Canvas mode, currently only WebGL is supported`);\r\n    }\r\n\r\n    if (images) {\r\n      for (const key in images) {\r\n        this.addImageSource(key, images[key]);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _initialize(graphicsContextWebGL: ExcaliburGraphicsContextWebGL) {\r\n    if (this._initialized) {\r\n      return;\r\n    }\r\n    const gl = graphicsContextWebGL.__gl;\r\n    // max texture slots - 2 for the graphic texture and screen texture\r\n    this._maxTextureSlots = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS) - 2;\r\n    this._shader = graphicsContextWebGL.createShader({\r\n      vertexSource: this._vertexSource,\r\n      fragmentSource: this._fragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._initialized = true;\r\n  }\r\n\r\n  get color(): Color {\r\n    return this._color;\r\n  }\r\n\r\n  set color(c: Color) {\r\n    this._color = c;\r\n  }\r\n\r\n  get name() {\r\n    return this._name ?? 'anonymous material';\r\n  }\r\n\r\n  get isUsingScreenTexture() {\r\n    return this._fragmentSource.includes('u_screen_texture');\r\n  }\r\n\r\n  update(callback: (shader: Shader) => any) {\r\n    if (this._shader) {\r\n      this._shader.use();\r\n      callback(this._shader);\r\n    }\r\n  }\r\n\r\n  getShader(): Shader | null {\r\n    return this._shader;\r\n  }\r\n\r\n  addImageSource(textureUniformName: string, image: ImageSource) {\r\n    if (this._images.size < this._maxTextureSlots) {\r\n      this._images.set(textureUniformName, image);\r\n    } else {\r\n      this._logger.warn(\r\n        `Max number texture slots ${this._maxTextureSlots} have been reached for material \"${this.name}\", ` +\r\n          `no more textures will be uploaded due to hardware constraints.`\r\n      );\r\n    }\r\n  }\r\n\r\n  removeImageSource(textureName: string) {\r\n    const image = this._images.get(textureName);\r\n    this._graphicsContext.textureLoader.delete(image!.image);\r\n    this._images.delete(textureName);\r\n  }\r\n\r\n  private _loadImageSource(image: ImageSource) {\r\n    const imageElement = image.image;\r\n    const maybeFiltering = imageElement.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(imageElement.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(imageElement.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = imageElement.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._graphicsContext.textureLoader.load(\r\n      imageElement,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    );\r\n    // remove force attribute after upload\r\n    imageElement.removeAttribute('forceUpload');\r\n    if (!this._textures.has(image)) {\r\n      this._textures.set(image, texture!);\r\n    }\r\n\r\n    return texture;\r\n  }\r\n\r\n  uploadAndBind(gl: WebGL2RenderingContext, startingTextureSlot: number = 2) {\r\n    let textureSlot = startingTextureSlot;\r\n    for (const [textureName, image] of this._images.entries()) {\r\n      if (!image.isLoaded()) {\r\n        this._logger.warnOnce(\r\n          `Image named ${textureName} in material ${this.name} not loaded, nothing will be uploaded to the shader.` +\r\n            ` Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`\r\n        );\r\n        continue;\r\n      } // skip unloaded images, maybe warn\r\n      const texture = this._loadImageSource(image);\r\n\r\n      gl.activeTexture(gl.TEXTURE0 + textureSlot);\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      this._shader.trySetUniformInt(textureName, textureSlot);\r\n\r\n      textureSlot++;\r\n    }\r\n  }\r\n\r\n  use() {\r\n    if (this._initialized) {\r\n      // bind the shader\r\n      this._shader.use();\r\n      // Apply standard uniforms\r\n      this._shader.trySetUniformFloatColor('u_color', this._color);\r\n    } else {\r\n      throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`);\r\n    }\r\n  }\r\n}\r\n","import { vec } from '../../../Math/vector';\r\nimport { parseImageFiltering } from '../../Filtering';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ImageSourceAttributeConstants } from '../../ImageSource';\r\nimport { parseImageWrapping } from '../../Wrapping';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nexport class MaterialRenderer implements RendererPlugin {\r\n  public readonly type: string = 'ex.material';\r\n  public priority: number = 0;\r\n  // private _maxTextures = 8;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGL2RenderingContext;\r\n  private _textures: WebGLTexture[] = [];\r\n  private _quads: any;\r\n  private _buffer!: VertexBuffer;\r\n  private _layout!: VertexLayout;\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      size: 6 * 4, // 6 components * 4 verts\r\n      type: 'dynamic'\r\n    });\r\n\r\n    // Setup a vertex layout/buffer to the material\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_screenuv', 2]\r\n      ],\r\n      suppressWarnings: true\r\n    });\r\n\r\n    // Setup index buffer\r\n    this._quads = new QuadIndexBuffer(gl, 1, true);\r\n  }\r\n\r\n  public dispose() {\r\n    this._buffer.dispose();\r\n    this._quads.dispose();\r\n    this._textures.length = 0;\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  draw(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    const gl = this._gl;\r\n\r\n    // Extract context info\r\n    const material = this._context.material;\r\n    if (!material) {\r\n      return;\r\n    }\r\n\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n\r\n    // material shader\r\n    const shader = material.getShader()!;\r\n\r\n    // construct geometry, or hold on to it in the material?\r\n    // geometry primitive for drawing rectangles?\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n    let vertexIndex = 0;\r\n\r\n    let width = image?.width || swidth || 0;\r\n    let height = image?.height || sheight || 0;\r\n    let view = [0, 0, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\r\n    let dest = [sx ?? 1, sy ?? 1];\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      view = [sx ?? 1, sy ?? 1, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\r\n      dest = [dx, dy];\r\n      width = dwidth;\r\n      height = dheight;\r\n    }\r\n\r\n    sx = view[0];\r\n    sy = view[1];\r\n    const sw = view[2];\r\n    const sh = view[3];\r\n\r\n    const topLeft = vec(dest[0], dest[1]);\r\n    const topRight = vec(dest[0] + width, dest[1]);\r\n    const bottomLeft = vec(dest[0], dest[1] + height);\r\n    const bottomRight = vec(dest[0] + width, dest[1] + height);\r\n\r\n    const imageWidth = image.width || width;\r\n    const imageHeight = image.height || height;\r\n\r\n    const uvx0 = sx / imageWidth;\r\n    const uvy0 = sy / imageHeight;\r\n    const uvx1 = (sx + sw - 0.01) / imageWidth;\r\n    const uvy1 = (sy + sh - 0.01) / imageHeight;\r\n\r\n    const topLeftScreen = transform.getPosition();\r\n    const bottomRightScreen = topLeftScreen.add(bottomRight);\r\n    const screenUVX0 = topLeftScreen.x / this._context.width;\r\n    const screenUVY0 = topLeftScreen.y / this._context.height;\r\n    const screenUVX1 = bottomRightScreen.x / this._context.width;\r\n    const screenUVY1 = bottomRightScreen.y / this._context.height;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[vertexIndex++] = topLeft.x;\r\n    vertexBuffer[vertexIndex++] = topLeft.y;\r\n    vertexBuffer[vertexIndex++] = uvx0;\r\n    vertexBuffer[vertexIndex++] = uvy0;\r\n    vertexBuffer[vertexIndex++] = screenUVX0;\r\n    vertexBuffer[vertexIndex++] = screenUVY0;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[vertexIndex++] = uvx0;\r\n    vertexBuffer[vertexIndex++] = uvy1;\r\n    vertexBuffer[vertexIndex++] = screenUVX0;\r\n    vertexBuffer[vertexIndex++] = screenUVY1;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[vertexIndex++] = topRight.x;\r\n    vertexBuffer[vertexIndex++] = topRight.y;\r\n    vertexBuffer[vertexIndex++] = uvx1;\r\n    vertexBuffer[vertexIndex++] = uvy0;\r\n    vertexBuffer[vertexIndex++] = screenUVX1;\r\n    vertexBuffer[vertexIndex++] = screenUVY0;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[vertexIndex++] = uvx1;\r\n    vertexBuffer[vertexIndex++] = uvy1;\r\n    vertexBuffer[vertexIndex++] = screenUVX1;\r\n    vertexBuffer[vertexIndex++] = screenUVY1;\r\n\r\n    // This creates and uploads the texture if not already done\r\n    const texture = this._addImageAsTexture(image);\r\n\r\n    // apply material\r\n    material.use();\r\n\r\n    this._layout.shader = shader!;\r\n    // apply layout and geometry\r\n    this._layout.use(true);\r\n\r\n    // apply time in ms since the page (performance.now())\r\n    shader.trySetUniformFloat('u_time_ms', performance.now());\r\n\r\n    // apply opacity\r\n    shader.trySetUniformFloat('u_opacity', opacity);\r\n\r\n    // apply resolution\r\n    shader.trySetUniformFloatVector('u_resolution', vec(this._context.width, this._context.height));\r\n\r\n    // apply graphic resolution\r\n    shader.trySetUniformFloatVector('u_graphic_resolution', vec(imageWidth, imageHeight));\r\n\r\n    // apply size\r\n    shader.trySetUniformFloatVector('u_size', vec(sw, sh));\r\n\r\n    // apply orthographic projection\r\n    shader.trySetUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // apply geometry transform\r\n    shader.trySetUniformMatrix('u_transform', transform.to4x4());\r\n\r\n    // bind graphic image texture 'uniform sampler2D u_graphic;'\r\n    gl.activeTexture(gl.TEXTURE0 + 0);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    shader.trySetUniformInt('u_graphic', 0);\r\n\r\n    // bind the screen texture\r\n    gl.activeTexture(gl.TEXTURE0 + 1);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._context.materialScreenTexture);\r\n    shader.trySetUniformInt('u_screen_texture', 1);\r\n\r\n    // bind any additional textures in the material\r\n    material.uploadAndBind(gl);\r\n\r\n    // bind quad index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw a single quad\r\n    gl.drawElements(gl.TRIANGLES, 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount++;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n  }\r\n\r\n  private _addImageAsTexture(image: HTMLImageSource) {\r\n    const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = image.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._context.textureLoader.load(\r\n      image,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    )!;\r\n    // remove force attribute after upload\r\n    image.removeAttribute('forceUpload');\r\n    if (this._textures.indexOf(texture) === -1) {\r\n      this._textures.push(texture);\r\n    }\r\n\r\n    return texture;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return false;\r\n  }\r\n  flush(): void {\r\n    // flush does not do anything, material renderer renders immediately per draw\r\n  }\r\n}\r\n","/**\r\n * Enum representing the coordinate plane for the position 2D vector in the {@apilink TransformComponent}\r\n */\r\nexport enum CoordPlane {\r\n  /**\r\n   * The world coordinate plane (default) represents world space, any entities drawn with world\r\n   * space move when the camera moves.\r\n   */\r\n  World = 'world',\r\n  /**\r\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\r\n   * to screen coordinates ignoring the camera.\r\n   */\r\n  Screen = 'screen'\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { GetSpriteOptions, SpriteSheet } from './SpriteSheet';\r\nimport { Logger } from '../Util/Log';\r\nimport { clamp } from '../Math/util';\r\nimport { EventEmitter } from '../EventEmitter';\r\n\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsed The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\r\n   */\r\n  tick(elapsed: number, idempotencyToken?: number): void;\r\n}\r\n\r\nexport enum AnimationDirection {\r\n  /**\r\n   * Animation is playing forwards\r\n   */\r\n  Forward = 'forward',\r\n  /**\r\n   * Animation is playing backwards\r\n   */\r\n  Backward = 'backward'\r\n}\r\n\r\nexport enum AnimationStrategy {\r\n  /**\r\n   * Animation ends without displaying anything\r\n   */\r\n  End = 'end',\r\n  /**\r\n   * Animation loops to the first frame after the last frame\r\n   */\r\n  Loop = 'loop',\r\n  /**\r\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\r\n   */\r\n  PingPong = 'pingpong',\r\n  /**\r\n   * Animation ends stopping on the last frame\r\n   */\r\n  Freeze = 'freeze'\r\n}\r\n\r\n/**\r\n * Frame of animation\r\n */\r\nexport interface Frame {\r\n  /**\r\n   * Optionally specify a graphic to show, no graphic shows an empty frame\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Optionally specify the number of ms the frame should be visible, overrides the animation duration (default 100 ms)\r\n   */\r\n  duration?: number;\r\n}\r\n\r\nexport interface FrameEvent extends Frame {\r\n  frameIndex: number;\r\n}\r\n\r\n/**\r\n * Animation options for building an animation via constructor.\r\n */\r\nexport interface AnimationOptions {\r\n  /**\r\n   * List of frames in the order you wish to play them\r\n   */\r\n  frames: Frame[];\r\n  /**\r\n   * Optionally set a positive speed multiplier on the animation.\r\n   *\r\n   * By default 1, meaning 1x speed. If set to 2, it will play the animation twice as fast.\r\n   */\r\n  speed?: number;\r\n  /**\r\n   * Optionally reverse the direction of play\r\n   */\r\n  reverse?: boolean;\r\n  /**\r\n   * Optionally specify a default frame duration in ms (Default is 100)\r\n   */\r\n  frameDuration?: number;\r\n  /**\r\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\r\n   */\r\n  totalDuration?: number;\r\n  /**\r\n   * Optionally specify the {@apilink AnimationStrategy} for the Animation\r\n   */\r\n  strategy?: AnimationStrategy;\r\n}\r\n\r\nexport type AnimationEvents = {\r\n  frame: FrameEvent;\r\n  loop: Animation;\r\n  end: Animation;\r\n};\r\n\r\nexport const AnimationEvents = {\r\n  Frame: 'frame',\r\n  Loop: 'loop',\r\n  End: 'end'\r\n};\r\n\r\nexport interface FromSpriteSheetOptions {\r\n  /**\r\n   * {@apilink SpriteSheet} to source the animation frames from\r\n   */\r\n  spriteSheet: SpriteSheet;\r\n  /**\r\n   * The list of (x, y) positions of sprites in the {@apilink SpriteSheet} of each frame, for example (0, 0)\r\n   * is the the top left sprite, (0, 1) is the sprite directly below that, and so on.\r\n   *\r\n   * You may optionally specify a duration for the frame in milliseconds as well, this will override\r\n   * the default duration.\r\n   */\r\n  frameCoordinates: { x: number; y: number; duration?: number; options?: GetSpriteOptions }[];\r\n  /**\r\n   * Optionally specify a default duration for frames in milliseconds\r\n   * @deprecated use `durationPerFrame`\r\n   */\r\n  durationPerFrameMs?: number;\r\n  /**\r\n   * Optionally specify a default duration for frames in milliseconds\r\n   */\r\n  durationPerFrame?: number;\r\n  /**\r\n   * Optionally set a positive speed multiplier on the animation.\r\n   *\r\n   * By default 1, meaning 1x speed. If set to 2, it will play the animation twice as fast.\r\n   */\r\n  speed?: number;\r\n  /**\r\n   * Optionally specify the animation strategy for this animation, by default animations loop {@apilink AnimationStrategy.Loop}\r\n   */\r\n  strategy?: AnimationStrategy;\r\n  /**\r\n   * Optionally specify the animation should be reversed\r\n   */\r\n  reverse?: boolean;\r\n}\r\n\r\n/**\r\n * Create an Animation given a list of {@apilink Frame | `frames`} in {@apilink AnimationOptions}\r\n *\r\n * To create an Animation from a {@apilink SpriteSheet}, use {@apilink Animation.fromSpriteSheet}\r\n */\r\nexport class Animation extends Graphic implements HasTick {\r\n  private static _LOGGER = Logger.getInstance();\r\n  public events = new EventEmitter<AnimationEvents>();\r\n  public frames: Frame[] = [];\r\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\r\n  public frameDuration: number = 100;\r\n\r\n  private _idempotencyToken = -1;\r\n\r\n  private _firstTick = true;\r\n  private _currentFrame = 0;\r\n  private _timeLeftInFrame = 0;\r\n  private _pingPongDirection = 1;\r\n  private _done = false;\r\n  private _playing = true;\r\n  private _speed = 1;\r\n\r\n  constructor(options: GraphicOptions & AnimationOptions) {\r\n    super(options);\r\n    this.frames = options.frames;\r\n    this.speed = options.speed ?? this.speed;\r\n    this.strategy = options.strategy ?? this.strategy;\r\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\r\n    if (options.reverse) {\r\n      this.reverse();\r\n    }\r\n    this.goToFrame(0);\r\n  }\r\n\r\n  public clone(): Animation {\r\n    return new Animation({\r\n      frames: this.frames.map((f) => ({ ...f })),\r\n      frameDuration: this.frameDuration,\r\n      speed: this.speed,\r\n      reverse: this._reversed,\r\n      strategy: this.strategy,\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  public override get width(): number {\r\n    const maybeFrame = this.currentFrame;\r\n    if (maybeFrame && maybeFrame.graphic) {\r\n      return Math.abs(maybeFrame.graphic.width * this.scale.x);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  public override get height(): number {\r\n    const maybeFrame = this.currentFrame;\r\n    if (maybeFrame && maybeFrame.graphic) {\r\n      return Math.abs(maybeFrame.graphic.height * this.scale.y);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Create an Animation from a {@apilink SpriteSheet}, a list of indices into the sprite sheet, a duration per frame\r\n   * and optional {@apilink AnimationStrategy}\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\r\n   * ```\r\n   * @param spriteSheet ex.SpriteSheet\r\n   * @param spriteSheetIndex 0 based index from left to right, top down (row major order) of the ex.SpriteSheet\r\n   * @param durationPerFrame duration per frame in milliseconds\r\n   * @param strategy Optional strategy, default AnimationStrategy.Loop\r\n   */\r\n  public static fromSpriteSheet(\r\n    spriteSheet: SpriteSheet,\r\n    spriteSheetIndex: number[],\r\n    durationPerFrame: number,\r\n    strategy: AnimationStrategy = AnimationStrategy.Loop\r\n  ): Animation {\r\n    const maxIndex = spriteSheet.sprites.length - 1;\r\n    const invalidIndices = spriteSheetIndex.filter((index) => index < 0 || index > maxIndex);\r\n    if (invalidIndices.length) {\r\n      Animation._LOGGER.warn(\r\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\r\n      );\r\n    }\r\n    return new Animation({\r\n      frames: spriteSheet.sprites\r\n        .filter((_, index) => spriteSheetIndex.indexOf(index) > -1)\r\n        .map((f) => ({\r\n          graphic: f,\r\n          duration: durationPerFrame\r\n        })),\r\n      strategy: strategy\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create an {@apilink Animation} from a {@apilink SpriteSheet} given a list of coordinates\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheetCoordinates({\r\n   *  spriteSheet,\r\n   *  frameCoordinates: [\r\n   *    {x: 0, y: 5, duration: 100, options { flipHorizontal: true }},\r\n   *    {x: 1, y: 5, duration: 200},\r\n   *    {x: 2, y: 5},\r\n   *    {x: 3, y: 5}\r\n   *  ],\r\n   *  strategy: AnimationStrategy.PingPong\r\n   * });\r\n   * ```\r\n   * @param options\r\n   * @returns Animation\r\n   */\r\n  public static fromSpriteSheetCoordinates(options: FromSpriteSheetOptions): Animation {\r\n    const { spriteSheet, frameCoordinates, durationPerFrame, durationPerFrameMs, speed, strategy, reverse } = options;\r\n    const defaultDuration = durationPerFrame ?? durationPerFrameMs ?? 100;\r\n    const frames: Frame[] = [];\r\n    for (const coord of frameCoordinates) {\r\n      const { x, y, duration, options } = coord;\r\n      const sprite = spriteSheet.getSprite(x, y, options);\r\n      if (sprite) {\r\n        frames.push({\r\n          graphic: sprite,\r\n          duration: duration ?? defaultDuration\r\n        });\r\n      } else {\r\n        Animation._LOGGER.warn(\r\n          `Skipping frame! SpriteSheet does not have coordinate (${x}, ${y}), please check your SpriteSheet to confirm that sprite exists`\r\n        );\r\n      }\r\n    }\r\n\r\n    return new Animation({\r\n      frames,\r\n      strategy,\r\n      speed,\r\n      reverse\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Current animation speed\r\n   *\r\n   * 1 meaning normal 1x speed.\r\n   * 2 meaning 2x speed and so on.\r\n   */\r\n  public get speed(): number {\r\n    return this._speed;\r\n  }\r\n\r\n  /**\r\n   * Current animation speed\r\n   *\r\n   * 1 meaning normal 1x speed.\r\n   * 2 meaning 2x speed and so on.\r\n   */\r\n  public set speed(val: number) {\r\n    this._speed = clamp(Math.abs(val), 0, Infinity);\r\n  }\r\n\r\n  /**\r\n   * Returns the current Frame of the animation\r\n   *\r\n   * Use {@apilink Animation.currentFrameIndex} to get the frame number and\r\n   * {@apilink Animation.goToFrame} to set the current frame index\r\n   */\r\n  public get currentFrame(): Frame | null {\r\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\r\n      return this.frames[this._currentFrame];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the current frame index of the animation\r\n   *\r\n   * Use {@apilink Animation.currentFrame} to grab the current {@apilink Frame} object\r\n   */\r\n  public get currentFrameIndex(): number {\r\n    return this._currentFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns the amount of time in milliseconds left in the current frame\r\n   */\r\n  public get currentFrameTimeLeft(): number {\r\n    return this._timeLeftInFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is playing\r\n   */\r\n  public get isPlaying(): boolean {\r\n    return this._playing;\r\n  }\r\n\r\n  private _reversed = false;\r\n\r\n  public get isReversed() {\r\n    return this._reversed;\r\n  }\r\n\r\n  /**\r\n   * Reverses the play direction of the Animation, this preserves the current frame\r\n   */\r\n  public reverse(): void {\r\n    // Don't mutate with the original frame list, create a copy\r\n    this.frames = this.frames.slice().reverse();\r\n    this._reversed = !this._reversed;\r\n  }\r\n\r\n  /**\r\n   * Returns the current play direction of the animation\r\n   */\r\n  public get direction(): AnimationDirection {\r\n    // Keep logically consistent with ping-pong direction\r\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\r\n    const reversed = this._reversed && this._pingPongDirection === 1 ? true : false;\r\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\r\n  }\r\n\r\n  /**\r\n   * Plays or resumes the animation from the current frame\r\n   */\r\n  public play(): void {\r\n    this._playing = true;\r\n  }\r\n\r\n  /**\r\n   * Pauses the animation on the current frame\r\n   */\r\n  public pause(): void {\r\n    this._playing = false;\r\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\r\n  }\r\n\r\n  /**\r\n   * Reset the animation back to the beginning, including if the animation were done\r\n   */\r\n  public reset(): void {\r\n    this._done = false;\r\n    this._firstTick = true;\r\n    this._currentFrame = 0;\r\n    this._timeLeftInFrame = this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame) {\r\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation can end\r\n   */\r\n  public get canFinish(): boolean {\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.End:\r\n      case AnimationStrategy.Freeze: {\r\n        return true;\r\n      }\r\n      default: {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is done, for looping type animations\r\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\r\n   *\r\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\r\n   */\r\n  public get done(): boolean {\r\n    return this._done;\r\n  }\r\n\r\n  /**\r\n   * Jump the animation immediately to a specific frame if it exists\r\n   *\r\n   * Optionally specify an override for the duration of the frame, useful for\r\n   * keeping multiple animations in sync with one another.\r\n   * @param frameNumber\r\n   * @param duration\r\n   */\r\n  public goToFrame(frameNumber: number, duration?: number) {\r\n    this._currentFrame = frameNumber;\r\n    this._timeLeftInFrame = duration ?? this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame && !this._done) {\r\n      this._timeLeftInFrame = duration ?? (maybeFrame?.duration || this.frameDuration);\r\n      this.events.emit('frame', { ...maybeFrame, frameIndex: this.currentFrameIndex });\r\n    }\r\n  }\r\n\r\n  private _nextFrame(): number {\r\n    const currentFrame = this._currentFrame;\r\n    if (this._done) {\r\n      return currentFrame;\r\n    }\r\n    let next = -1;\r\n\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.Loop: {\r\n        next = (currentFrame + 1) % this.frames.length;\r\n        if (next === 0) {\r\n          this.events.emit('loop', this);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.End: {\r\n        next = currentFrame + 1;\r\n        if (next >= this.frames.length) {\r\n          this._done = true;\r\n          this._currentFrame = this.frames.length;\r\n          this.events.emit('end', this);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.Freeze: {\r\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\r\n        if (next >= this.frames.length - 1) {\r\n          this._done = true;\r\n          this.events.emit('end', this);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.PingPong: {\r\n        if (currentFrame + this._pingPongDirection >= this.frames.length) {\r\n          this._pingPongDirection = -1;\r\n          this.events.emit('loop', this);\r\n        }\r\n\r\n        if (currentFrame + this._pingPongDirection < 0) {\r\n          this._pingPongDirection = 1;\r\n          this.events.emit('loop', this);\r\n        }\r\n\r\n        next = currentFrame + (this._pingPongDirection % this.frames.length);\r\n        break;\r\n      }\r\n    }\r\n    return next;\r\n  }\r\n\r\n  /**\r\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\r\n   * @param elapsed Milliseconds elapsed\r\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\r\n   */\r\n  public tick(elapsed: number, idempotencyToken: number = 0): void {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    if (!this._playing) {\r\n      return;\r\n    }\r\n\r\n    // if it's the first frame emit frame event\r\n    if (this._firstTick) {\r\n      this._firstTick = false;\r\n      this.events.emit('frame', { ...this.currentFrame, frameIndex: this.currentFrameIndex });\r\n    }\r\n\r\n    this._timeLeftInFrame -= elapsed * this._speed;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.goToFrame(this._nextFrame());\r\n    }\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.currentFrame && this.currentFrame.graphic) {\r\n      this.currentFrame.graphic.draw(ctx, x, y);\r\n    }\r\n  }\r\n}\r\n","import { Vector } from './vector';\n\nexport interface VectorViewOptions {\n  getX: () => number;\n  getY: () => number;\n  setX: (x: number) => void;\n  setY: (y: number) => void;\n}\nexport class VectorView extends Vector {\n  private _getX: () => number;\n  private _getY: () => number;\n  private _setX: (x: number) => void;\n  private _setY: (y: number) => void;\n  constructor(options: VectorViewOptions) {\n    super(0, 0);\n    this._getX = options.getX;\n    this._getY = options.getY;\n    this._setX = options.setX;\n    this._setY = options.setY;\n  }\n  public get x() {\n    return (this._x = this._getX());\n  }\n\n  public set x(val) {\n    this._setX(val);\n    this._x = val;\n  }\n\n  public get y() {\n    return (this._y = this._getY());\n  }\n  public set y(val) {\n    this._setY(val);\n    this._y = val;\n  }\n}\n","import { Vector } from './vector';\r\n\r\n/**\r\n * Wraps a vector and watches for changes in the x/y, modifies the original vector.\r\n */\r\nexport class WatchVector extends Vector {\r\n  constructor(\r\n    public original: Vector,\r\n    public change: (x: number, y: number) => any\r\n  ) {\r\n    super(original.x, original.y);\r\n  }\r\n  public get x() {\r\n    return (this._x = this.original.x);\r\n  }\r\n\r\n  public set x(newX: number) {\r\n    if (newX !== this._x) {\r\n      this.change(newX, this._y);\r\n      this._x = this.original.x = newX;\r\n    }\r\n  }\r\n\r\n  public get y() {\r\n    return (this._y = this.original.y);\r\n  }\r\n\r\n  public set y(newY: number) {\r\n    if (newY !== this._y) {\r\n      this.change(this._x, newY);\r\n      this._y = this.original.y = newY;\r\n    }\r\n  }\r\n\r\n  override setTo(x: number, y: number): void {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n}\r\n","import { AffineMatrix } from './affine-matrix';\r\nimport { canonicalizeAngle, sign } from './util';\r\nimport { vec, Vector } from './vector';\r\nimport { VectorView } from './vector-view';\r\nimport { WatchVector } from './watch-vector';\r\n\r\nexport class Transform {\r\n  private _parent: Transform | null = null;\r\n  get parent() {\r\n    return this._parent;\r\n  }\r\n  set parent(transform: Transform | null) {\r\n    if (this._parent) {\r\n      const index = this._parent._children.indexOf(this);\r\n      if (index > -1) {\r\n        this._parent._children.splice(index, 1);\r\n      }\r\n    }\r\n    this._parent = transform;\r\n    if (this._parent) {\r\n      this._parent._children.push(this);\r\n    }\r\n    this.flagDirty();\r\n  }\r\n  get children(): readonly Transform[] {\r\n    return this._children;\r\n  }\r\n  private _children: Transform[] = [];\r\n\r\n  private _pos: Vector = new WatchVector(vec(0, 0), () => {\r\n    this.flagDirty();\r\n  });\r\n  set pos(v: Vector) {\r\n    this._pos.x = v.x;\r\n    this._pos.y = v.y;\r\n  }\r\n  get pos() {\r\n    return this._pos;\r\n  }\r\n\r\n  set globalPos(v: Vector) {\r\n    let localPos = v.clone();\r\n    if (this.parent) {\r\n      localPos = this.parent.inverse.multiply(v);\r\n    }\r\n    if (!localPos.equals(this._pos)) {\r\n      this._pos = localPos;\r\n      this.flagDirty();\r\n    }\r\n  }\r\n  private _globalPos = new VectorView({\r\n    getX: () => this.matrix.data[4],\r\n    getY: () => this.matrix.data[5],\r\n    setX: (x) => {\r\n      if (this.parent) {\r\n        const { x: newX } = this.parent.inverse.multiply(vec(x, this.pos.y));\r\n        this.pos.x = newX;\r\n      } else {\r\n        this.pos.x = x;\r\n      }\r\n      if (x !== this.matrix.data[4]) {\r\n        this.flagDirty();\r\n      }\r\n    },\r\n    setY: (y) => {\r\n      if (this.parent) {\r\n        const { y: newY } = this.parent.inverse.multiply(vec(this.pos.x, y));\r\n        this.pos.y = newY;\r\n      } else {\r\n        this.pos.y = y;\r\n      }\r\n      if (y !== this.matrix.data[5]) {\r\n        this.flagDirty();\r\n      }\r\n    }\r\n  });\r\n  get globalPos() {\r\n    return this._globalPos;\r\n  }\r\n\r\n  private _rotation: number = 0;\r\n  set rotation(rotation: number) {\r\n    const canonRotation = canonicalizeAngle(rotation);\r\n    if (canonRotation !== this._rotation) {\r\n      this.flagDirty();\r\n    }\r\n    this._rotation = canonRotation;\r\n  }\r\n  get rotation() {\r\n    return this._rotation;\r\n  }\r\n\r\n  set globalRotation(rotation: number) {\r\n    let inverseRotation = 0;\r\n    if (this.parent) {\r\n      inverseRotation = this.parent.globalRotation;\r\n    }\r\n    const canonRotation = canonicalizeAngle(rotation + inverseRotation);\r\n    if (canonRotation !== this._rotation) {\r\n      this.flagDirty();\r\n    }\r\n    this._rotation = canonRotation;\r\n  }\r\n\r\n  get globalRotation() {\r\n    if (this.parent) {\r\n      return this.matrix.getRotation();\r\n    }\r\n    return this.rotation;\r\n  }\r\n\r\n  private _scale: Vector = new WatchVector(vec(1, 1), () => {\r\n    this.flagDirty();\r\n  });\r\n  set scale(v: Vector) {\r\n    this._scale.x = v.x;\r\n    this._scale.y = v.y;\r\n  }\r\n  get scale() {\r\n    return this._scale;\r\n  }\r\n\r\n  set globalScale(v: Vector) {\r\n    let inverseScale = vec(1, 1);\r\n    if (this.parent) {\r\n      inverseScale = this.parent.globalScale;\r\n    }\r\n    this.scale = v.scale(vec(1 / inverseScale.x, 1 / inverseScale.y));\r\n  }\r\n\r\n  private _globalScale = new VectorView({\r\n    getX: () => (this.parent ? this.matrix.getScaleX() : this.scale.x),\r\n    getY: () => (this.parent ? this.matrix.getScaleY() : this.scale.y),\r\n    setX: (x) => {\r\n      if (this.parent) {\r\n        const globalScaleX = this.parent.globalScale.x;\r\n        this.scale.x = x / globalScaleX;\r\n      } else {\r\n        this.scale.x = x;\r\n      }\r\n    },\r\n    setY: (y) => {\r\n      if (this.parent) {\r\n        const globalScaleY = this.parent.globalScale.y;\r\n        this.scale.y = y / globalScaleY;\r\n      } else {\r\n        this.scale.y = y;\r\n      }\r\n    }\r\n  });\r\n  get globalScale() {\r\n    return this._globalScale;\r\n  }\r\n\r\n  private _z: number = 0;\r\n\r\n  set z(z: number) {\r\n    this._z = z;\r\n    this.flagDirty();\r\n  }\r\n\r\n  get z() {\r\n    return this._z;\r\n  }\r\n\r\n  set globalZ(z: number) {\r\n    if (this.parent) {\r\n      this.z = z - this.parent.globalZ;\r\n    } else {\r\n      this.z = z;\r\n    }\r\n  }\r\n\r\n  get globalZ() {\r\n    if (this.parent) {\r\n      return this.z + this.parent.globalZ;\r\n    }\r\n    return this.z;\r\n  }\r\n\r\n  private _isDirty = false;\r\n  private _isInverseDirty = false;\r\n  private _matrix = AffineMatrix.identity();\r\n  private _inverse = AffineMatrix.identity();\r\n\r\n  /**\r\n   * Calculates and returns the matrix representation of this transform\r\n   *\r\n   * Avoid mutating the matrix to update the transform, it is not the source of truth.\r\n   * Update the transform pos, rotation, scale.\r\n   */\r\n  public get matrix(): AffineMatrix {\r\n    if (this._isDirty) {\r\n      if (this.parent === null) {\r\n        this._calculateMatrix().clone(this._matrix);\r\n      } else {\r\n        this.parent.matrix.multiply(this._calculateMatrix()).clone(this._matrix);\r\n      }\r\n      this._isDirty = false;\r\n    }\r\n    return this._matrix;\r\n  }\r\n\r\n  /**\r\n   * Calculates and returns the inverse matrix representation of this transform\r\n   */\r\n  public get inverse(): AffineMatrix {\r\n    if (this._isInverseDirty) {\r\n      this.matrix.inverse(this._inverse);\r\n      this._isInverseDirty = false;\r\n    }\r\n    return this._inverse;\r\n  }\r\n\r\n  private _scratch = AffineMatrix.identity();\r\n  private _calculateMatrix(): AffineMatrix {\r\n    this._scratch.data[0] = Math.cos(this._rotation);\r\n    this._scratch.data[1] = Math.sin(this._rotation);\r\n    this._scratch.data[2] = -Math.sin(this._rotation);\r\n    this._scratch.data[3] = Math.cos(this.rotation);\r\n    this._scratch.data[4] = this._pos.x;\r\n    this._scratch.data[5] = this._pos.y;\r\n    this._scratch.scale(this._scale.x, this._scale.y);\r\n    return this._scratch;\r\n  }\r\n\r\n  public flagDirty() {\r\n    this._isDirty = true;\r\n    this._isInverseDirty = true;\r\n    for (let i = 0; i < this._children.length; i++) {\r\n      this._children[i].flagDirty();\r\n    }\r\n  }\r\n\r\n  public apply(point: Vector): Vector {\r\n    return this.matrix.multiply(point);\r\n  }\r\n\r\n  public applyInverse(point: Vector): Vector {\r\n    return this.inverse.multiply(point);\r\n  }\r\n\r\n  public setTransform(pos: Vector, rotation: number, scale: Vector) {\r\n    this._pos.x = pos.x;\r\n    this._pos.y = pos.y;\r\n    this._rotation = canonicalizeAngle(rotation);\r\n    this._scale.x = scale.x;\r\n    this._scale.y = scale.y;\r\n    this.flagDirty();\r\n  }\r\n\r\n  /**\r\n   * Returns true if the transform has a negative x scale or y scale, but not both\r\n   */\r\n  public isMirrored(): boolean {\r\n    const signBitX = sign(this.scale.x) >>> 31;\r\n    const signBitY = sign(this.scale.y) >>> 31;\r\n    const mirrored = signBitX ^ signBitY;\r\n    return !!mirrored;\r\n  }\r\n\r\n  /**\r\n   * Clones the current transform\r\n   * **Warning does not clone the parent**\r\n   * @param dest\r\n   */\r\n  public clone(dest?: Transform): Transform {\r\n    const target = dest ?? new Transform();\r\n    this._pos.clone(target._pos);\r\n    target._z = this._z;\r\n    target._rotation = this._rotation;\r\n    this._scale.clone(target._scale);\r\n    target.flagDirty();\r\n    return target;\r\n  }\r\n\r\n  /**\r\n   * Clones but keeps the same parent reference\r\n   */\r\n  public cloneWithParent(dest?: Transform): Transform {\r\n    const target = dest ?? new Transform();\r\n    this._pos.clone(target._pos);\r\n    target._z = this._z;\r\n    target._rotation = this._rotation;\r\n    this._scale.clone(target._scale);\r\n    target.parent = this.parent;\r\n    target.flagDirty();\r\n    return target;\r\n  }\r\n\r\n  public toString(): string {\r\n    return this.matrix.toString();\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\n\r\n/**\r\n * Component Constructor Types\r\n */\r\nexport declare type ComponentCtor<TComponent extends Component = Component> = new (...args: any[]) => TComponent;\r\n\r\n/**\r\n *\r\n */\r\nexport function isComponentCtor(value: any): value is ComponentCtor<Component> {\r\n  return !!value && !!value.prototype && !!value.prototype.constructor;\r\n}\r\n\r\n/**\r\n * Type guard to check if a component implements clone\r\n * @param x\r\n */\r\nfunction hasClone(x: any): x is { clone(): any } {\r\n  return !!x?.clone;\r\n}\r\n\r\n/**\r\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity possesses\r\n *\r\n * Implementations of Component must have a zero-arg constructor to support dependencies\r\n *\r\n * ```typescript\r\n * class MyComponent extends ex.Component {\r\n *   // zero arg support required if you want to use component dependencies\r\n *   constructor(public optionalPos?: ex.Vector) {}\r\n * }\r\n * ```\r\n */\r\nexport abstract class Component {\r\n  // TODO maybe generate a unique id?\r\n\r\n  /**\r\n   * Optionally list any component types this component depends on\r\n   * If the owner entity does not have these components, new components will be added to the entity\r\n   *\r\n   * Only components with zero-arg constructors are supported as automatic component dependencies\r\n   */\r\n  readonly dependencies?: ComponentCtor[];\r\n\r\n  /**\r\n   * Current owning {@apilink Entity}, if any, of this component. Null if not added to any {@apilink Entity}\r\n   */\r\n  owner?: Entity = undefined;\r\n\r\n  /**\r\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\r\n   */\r\n  clone(): Component {\r\n    const newComponent = new (this.constructor as any)();\r\n    for (const prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        const val = this[prop];\r\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\r\n          newComponent[prop] = val.clone();\r\n        } else {\r\n          newComponent[prop] = val;\r\n        }\r\n      }\r\n    }\r\n    return newComponent;\r\n  }\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onAdd?(owner: Entity): void;\r\n\r\n  /**\r\n   * Optional callback called when a component is removed from an entity\r\n   */\r\n  onRemove?(previousOwner: Entity): void;\r\n}\r\n","/**\n * Defines a generic message that can contain any data\n * @template T is the typescript Type of the data\n */\nexport interface Message<T> {\n  type: string;\n  data: T;\n}\n\n/**\n * Defines an interface for an observer to receive a message via a notify() method\n */\nexport interface Observer<T> {\n  notify(message: T): void;\n}\n\n/**\n * Defines an interface for something that might be an observer if a notify() is present\n */\nexport type MaybeObserver<T> = Partial<Observer<T>>;\n\n/**\n * Simple Observable implementation\n * @template T is the typescript Type that defines the data being observed\n */\nexport class Observable<T> {\n  public observers: Observer<T>[] = [];\n  public subscriptions: ((val: T) => any)[] = [];\n\n  /**\n   * Register an observer to listen to this observable\n   * @param observer\n   */\n  register(observer: Observer<T>) {\n    this.observers.push(observer);\n  }\n\n  /**\n   * Register a callback to listen to this observable\n   * @param func\n   */\n  subscribe(func: (val: T) => any) {\n    this.subscriptions.push(func);\n  }\n\n  /**\n   * Remove an observer from the observable\n   * @param observer\n   */\n  unregister(observer: Observer<T>) {\n    const i = this.observers.indexOf(observer);\n    if (i !== -1) {\n      this.observers.splice(i, 1);\n    }\n  }\n\n  /**\n   * Remove a callback that is listening to this observable\n   * @param func\n   */\n  unsubscribe(func: (val: T) => any) {\n    const i = this.subscriptions.indexOf(func);\n    if (i !== -1) {\n      this.subscriptions.splice(i, 1);\n    }\n  }\n\n  /**\n   * Broadcasts a message to all observers and callbacks\n   * @param message\n   */\n  notifyAll(message: T) {\n    const observersLength = this.observers.length;\n    for (let i = 0; i < observersLength; i++) {\n      this.observers[i].notify(message);\n    }\n    const subscriptionsLength = this.subscriptions.length;\n    for (let i = 0; i < subscriptionsLength; i++) {\n      this.subscriptions[i](message);\n    }\n  }\n\n  /**\n   * Removes all observers and callbacks\n   */\n  clear() {\n    this.observers.length = 0;\n    this.subscriptions.length = 0;\n  }\n}\n","import { Vector } from '../../Math/vector';\r\nimport { CoordPlane } from '../../Math/coord-plane';\r\nimport { Transform } from '../../Math/transform';\r\nimport { Component } from '../Component';\r\nimport { Entity } from '../Entity';\r\nimport { Observable } from '../../Util/Observable';\r\nimport { Logger } from '../../Util/Log';\r\n\r\nexport class TransformComponent extends Component {\r\n  private _logger = Logger.getInstance();\r\n  private _parentComponent: TransformComponent | null = null;\r\n  private _transform = new Transform();\r\n  public get() {\r\n    return this._transform;\r\n  }\r\n\r\n  private _addChildTransform = (child: Entity) => {\r\n    const childTxComponent = child.get(TransformComponent);\r\n    if (childTxComponent) {\r\n      childTxComponent._transform.parent = this._transform;\r\n      childTxComponent._parentComponent = this;\r\n    }\r\n  };\r\n  onAdd(owner: Entity): void {\r\n    for (const child of owner.children) {\r\n      this._addChildTransform(child);\r\n    }\r\n    owner.childrenAdded$.subscribe((child) => this._addChildTransform(child));\r\n    owner.childrenRemoved$.subscribe((child) => {\r\n      const childTxComponent = child.get(TransformComponent);\r\n      if (childTxComponent) {\r\n        childTxComponent._transform.parent = null;\r\n        childTxComponent._parentComponent = null;\r\n      }\r\n    });\r\n  }\r\n  onRemove(_previousOwner: Entity): void {\r\n    this._transform.parent = null;\r\n    this._parentComponent = null;\r\n  }\r\n\r\n  /**\r\n   * Observable that emits when the z index changes on this component\r\n   */\r\n  public zIndexChanged$ = new Observable<number>();\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  public get z(): number {\r\n    return this._transform.z;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    const oldz = this._transform.z;\r\n    this._transform.z = val;\r\n    if (oldz !== val) {\r\n      this.zIndexChanged$.notifyAll(val);\r\n    }\r\n  }\r\n\r\n  public get globalZ() {\r\n    return this._transform.globalZ;\r\n  }\r\n\r\n  public set globalZ(z: number) {\r\n    this._transform.globalZ = z;\r\n  }\r\n\r\n  private _coordPlane = CoordPlane.World;\r\n  /**\r\n   * The {@apilink CoordPlane | `coordinate plane`} for this transform for the entity.\r\n   */\r\n  public get coordPlane() {\r\n    if (this._parentComponent) {\r\n      return this._parentComponent.coordPlane;\r\n    }\r\n    return this._coordPlane;\r\n  }\r\n\r\n  public set coordPlane(value: CoordPlane) {\r\n    if (!this._parentComponent) {\r\n      this._coordPlane = value;\r\n    } else {\r\n      this._logger.warn(\r\n        `Cannot set coordinate plane on child entity ${this.owner?.name}, children inherit their coordinate plane from their parents.`\r\n      );\r\n    }\r\n  }\r\n\r\n  get pos() {\r\n    return this._transform.pos;\r\n  }\r\n  set pos(v: Vector) {\r\n    this._transform.pos = v;\r\n  }\r\n\r\n  get globalPos() {\r\n    return this._transform.globalPos;\r\n  }\r\n  set globalPos(v: Vector) {\r\n    this._transform.globalPos = v;\r\n  }\r\n\r\n  get rotation() {\r\n    return this._transform.rotation;\r\n  }\r\n  set rotation(rotation) {\r\n    this._transform.rotation = rotation;\r\n  }\r\n\r\n  get globalRotation() {\r\n    return this._transform.globalRotation;\r\n  }\r\n  set globalRotation(rotation) {\r\n    this._transform.globalRotation = rotation;\r\n  }\r\n\r\n  get scale() {\r\n    return this._transform.scale;\r\n  }\r\n  set scale(v: Vector) {\r\n    this._transform.scale = v;\r\n  }\r\n\r\n  get globalScale() {\r\n    return this._transform.globalScale;\r\n  }\r\n  set globalScale(v: Vector) {\r\n    this._transform.globalScale = v;\r\n  }\r\n\r\n  applyInverse(v: Vector) {\r\n    return this._transform.applyInverse(v);\r\n  }\r\n\r\n  apply(v: Vector) {\r\n    return this._transform.apply(v);\r\n  }\r\n\r\n  clone(): TransformComponent {\r\n    const component = new TransformComponent();\r\n    component._transform = this._transform.clone();\r\n    return component;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Animation, HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport interface GraphicsGroupingOptions {\r\n  members: (GraphicsGrouping | Graphic)[];\r\n  /**\r\n   * Default true, GraphicsGroup will use the anchor to position all the graphics based on their combined bounds\r\n   *\r\n   * Setting to false will ignore anchoring from parent components and position the top left of all graphics at the actor's position,\r\n   * positioning graphics in the group is done with the `offset` property.\r\n   */\r\n  useAnchor?: boolean;\r\n}\r\n\r\nexport interface GraphicsGrouping {\r\n  offset: Vector;\r\n  graphic: Graphic;\r\n  /**\r\n   * Optionally disable this graphics bounds as part of group calculation, default true\r\n   * if unspecified\r\n   *\r\n   * You may want disable this if you're using text because their bounds will affect\r\n   * the centering of the whole group.\r\n   *\r\n   * **WARNING** having inaccurate bounds can cause offscreen culling issues.\r\n   */\r\n  useBounds?: boolean;\r\n}\r\n\r\nexport class GraphicsGroup extends Graphic implements HasTick {\r\n  private _logger = Logger.getInstance();\r\n  public useAnchor: boolean = true;\r\n  public members: (GraphicsGrouping | Graphic)[] = [];\r\n\r\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\r\n    super(options);\r\n    this.members = options.members;\r\n    this.useAnchor = options.useAnchor ?? this.useAnchor;\r\n    this._updateDimensions();\r\n  }\r\n\r\n  public clone(): GraphicsGroup {\r\n    return new GraphicsGroup({\r\n      members: [...this.members],\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  private _updateDimensions(): BoundingBox {\r\n    const bb = this.localBounds;\r\n    this.width = bb.width;\r\n    this.height = bb.height;\r\n    return bb;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    const bb = new BoundingBox();\r\n    for (const member of this.members) {\r\n      if (member instanceof Graphic) {\r\n        member.localBounds.combine(bb, bb);\r\n      } else {\r\n        const { graphic, offset: pos, useBounds } = member;\r\n        const shouldUseBounds = useBounds === undefined ? true : useBounds;\r\n        if (graphic) {\r\n          if (shouldUseBounds) {\r\n            graphic.localBounds.translate(pos).combine(bb, bb);\r\n          }\r\n        } else {\r\n          this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(member)}.`);\r\n        }\r\n      }\r\n    }\r\n    return bb;\r\n  }\r\n\r\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\r\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\r\n  }\r\n\r\n  public tick(elapsed: number, idempotencyToken?: number) {\r\n    for (const member of this.members) {\r\n      let graphic: Graphic;\r\n      if (member instanceof Graphic) {\r\n        graphic = member;\r\n      } else {\r\n        graphic = member.graphic;\r\n      }\r\n      if (this._isAnimationOrGroup(graphic)) {\r\n        graphic.tick(elapsed, idempotencyToken);\r\n      }\r\n    }\r\n  }\r\n\r\n  public reset() {\r\n    for (const member of this.members) {\r\n      let graphic: Graphic;\r\n      if (member instanceof Graphic) {\r\n        graphic = member;\r\n      } else {\r\n        graphic = member.graphic;\r\n      }\r\n      if (this._isAnimationOrGroup(graphic)) {\r\n        graphic.reset();\r\n      }\r\n    }\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    this._updateDimensions();\r\n    super._preDraw(ex, this.useAnchor ? x : 0, this.useAnchor ? y : 0);\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    const pos = Vector.Zero;\r\n    for (const member of this.members) {\r\n      let graphic: Graphic;\r\n      if (member instanceof Graphic) {\r\n        graphic = member;\r\n      } else {\r\n        graphic = member.graphic;\r\n        member.offset.clone(pos);\r\n      }\r\n      if (!graphic) {\r\n        continue;\r\n      }\r\n      ex.save();\r\n      ex.translate(x, y);\r\n      graphic.draw(ex, pos.x, pos.y);\r\n      if (this.showDebug) {\r\n        /* istanbul ignore next */\r\n        ex.debug.drawRect(0, 0, this.width, this.height);\r\n      }\r\n      ex.restore();\r\n    }\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { watch } from '../Util/Watch';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { omit } from '../Util/Util';\r\n\r\nexport interface RasterOptions extends GraphicOptions {\r\n  /**\r\n   * Optionally specify a quality number, which is how much to scale the internal Raster. Default is 1.\r\n   *\r\n   * For example if the quality is set to 2, it doubles the internal raster bitmap in memory.\r\n   *\r\n   * Adjusting this value can be useful if you are working with small rasters.\r\n   */\r\n  quality?: number;\r\n  /**\r\n   * Optionally specify \"smoothing\" if you want antialiasing to apply to the raster's bitmap context, by default `false`\r\n   */\r\n  smoothing?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the color of the raster's bitmap context, by default {@apilink Color.Black}\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally specify the stroke color of the raster's bitmap context, by default undefined\r\n   */\r\n  strokeColor?: Color;\r\n\r\n  /**\r\n   * Optionally specify the line width of the raster's bitmap, by default 1 pixel\r\n   */\r\n  lineWidth?: number;\r\n\r\n  /**\r\n   * Optionally specify the line dash of the raster's bitmap, by default `[]` which means none\r\n   */\r\n  lineDash?: number[];\r\n\r\n  /**\r\n   * Optionally specify the line end style, default is \"butt\".\r\n   */\r\n  lineCap?: 'butt' | 'round' | 'square';\r\n\r\n  /**\r\n   * Optionally specify the padding to apply to the bitmap\r\n   */\r\n  padding?: number;\r\n\r\n  /**\r\n   * Optionally specify what image filtering mode should be used, {@apilink ImageFiltering.Pixel} for pixel art,\r\n   * {@apilink ImageFiltering.Blended} for hi-res art\r\n   *\r\n   * By default unset, rasters defer to the engine antialiasing setting\r\n   */\r\n  filtering?: ImageFiltering;\r\n}\r\n\r\n/**\r\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\r\n * {@apilink ExcaliburGraphicsContext}. This is useful for generating custom images using the 2D canvas api.\r\n *\r\n * Implementors must implement the {@apilink Raster.execute} method to rasterize their drawing.\r\n */\r\nexport abstract class Raster extends Graphic {\r\n  public filtering?: ImageFiltering;\r\n  public lineCap: 'butt' | 'round' | 'square' = 'butt';\r\n  public quality: number = 1;\r\n\r\n  public _bitmap: HTMLCanvasElement;\r\n  protected _ctx: CanvasRenderingContext2D;\r\n  private _dirty: boolean = true;\r\n\r\n  constructor(options?: RasterOptions) {\r\n    super(omit({ ...options }, ['width', 'height'])); // rasters do some special sauce with width/height\r\n    if (options) {\r\n      this.quality = options.quality ?? this.quality;\r\n      this.color = options.color ?? Color.Black;\r\n      this.strokeColor = options?.strokeColor;\r\n      this.smoothing = options.smoothing ?? this.smoothing;\r\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\r\n      this.lineDash = options.lineDash ?? this.lineDash;\r\n      this.lineCap = options.lineCap ?? this.lineCap;\r\n      this.padding = options.padding ?? this.padding;\r\n      this.filtering = options.filtering ?? this.filtering;\r\n    }\r\n    this._bitmap = document.createElement('canvas');\r\n    // get the default canvas width/height as a fallback\r\n    const bitmapWidth = options?.width ?? this._bitmap.width;\r\n    const bitmapHeight = options?.height ?? this._bitmap.height;\r\n    this.width = bitmapWidth;\r\n    this.height = bitmapHeight;\r\n    const maybeCtx = this._bitmap.getContext('2d');\r\n    if (!maybeCtx) {\r\n      /* istanbul ignore next */\r\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\r\n    } else {\r\n      this._ctx = maybeCtx;\r\n    }\r\n  }\r\n\r\n  public cloneRasterOptions(): RasterOptions {\r\n    return {\r\n      color: this.color ? this.color.clone() : undefined,\r\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : undefined,\r\n      smoothing: this.smoothing,\r\n      lineWidth: this.lineWidth,\r\n      lineDash: this.lineDash,\r\n      lineCap: this.lineCap,\r\n      quality: this.quality,\r\n      padding: this.padding\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\r\n   */\r\n  public get dirty() {\r\n    return this._dirty;\r\n  }\r\n\r\n  /**\r\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\r\n   * This should be called any time the graphics state changes such that it affects the outputted drawing\r\n   */\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n\r\n  private _originalWidth?: number;\r\n  /**\r\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   *\r\n   * Any `padding`s or `quality` set will be factored into the width\r\n   */\r\n  public get width() {\r\n    return Math.abs(this._getTotalWidth() * this.scale.x);\r\n  }\r\n  public set width(value: number) {\r\n    value /= Math.abs(this.scale.x);\r\n    this._bitmap.width = value;\r\n    this._originalWidth = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _originalHeight?: number;\r\n  /**\r\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   *\r\n   * Any `padding` or `quality` set will be factored into the height\r\n   */\r\n  public get height() {\r\n    return Math.abs(this._getTotalHeight() * this.scale.y);\r\n  }\r\n\r\n  public set height(value: number) {\r\n    value /= Math.abs(this.scale.y);\r\n    this._bitmap.height = value;\r\n    this._originalHeight = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _getTotalWidth() {\r\n    return ((this._originalWidth ?? this._bitmap.width) + this.padding * 2) * 1;\r\n  }\r\n\r\n  private _getTotalHeight() {\r\n    return ((this._originalHeight ?? this._bitmap.height) + this.padding * 2) * 1;\r\n  }\r\n\r\n  /**\r\n   * Returns the local bounds of the Raster including the padding\r\n   */\r\n  public get localBounds() {\r\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\r\n  }\r\n\r\n  private _smoothing: boolean = false;\r\n  /**\r\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get smoothing() {\r\n    return this._smoothing;\r\n  }\r\n  public set smoothing(value: boolean) {\r\n    this._smoothing = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\r\n  /**\r\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get color() {\r\n    return this._color;\r\n  }\r\n  public set color(value) {\r\n    this.flagDirty();\r\n    this._color = watch(value, () => this.flagDirty());\r\n  }\r\n\r\n  private _strokeColor: Color | undefined;\r\n  /**\r\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get strokeColor() {\r\n    return this._strokeColor;\r\n  }\r\n  public set strokeColor(value: Color | undefined) {\r\n    this.flagDirty();\r\n    if (value) {\r\n      this._strokeColor = watch(value, () => this.flagDirty());\r\n    }\r\n  }\r\n\r\n  private _lineWidth: number = 1;\r\n  /**\r\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get lineWidth() {\r\n    return this._lineWidth;\r\n  }\r\n  public set lineWidth(value) {\r\n    this._lineWidth = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _lineDash: number[] = [];\r\n  public get lineDash() {\r\n    return this._lineDash;\r\n  }\r\n\r\n  public set lineDash(value) {\r\n    this._lineDash = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _padding: number = 0;\r\n  public get padding() {\r\n    return this._padding;\r\n  }\r\n\r\n  public set padding(value: number) {\r\n    this._padding = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  /**\r\n   * Rasterize the graphic to a bitmap making it usable as in excalibur. Rasterize is called automatically if\r\n   * the graphic is {@apilink Raster.dirty} on the next {@apilink Graphic.draw} call\r\n   */\r\n  public rasterize(): void {\r\n    this._dirty = false;\r\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\r\n    this._ctx.save();\r\n    this._applyRasterProperties(this._ctx);\r\n    this.execute(this._ctx);\r\n    this._ctx.restore();\r\n  }\r\n\r\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\r\n    this._bitmap.width = this._getTotalWidth() * this.quality;\r\n    this._bitmap.height = this._getTotalHeight() * this.quality;\r\n    // Do a bad thing to pass the filtering as an attribute\r\n    this._bitmap.setAttribute('filtering', this.filtering as any);\r\n    this._bitmap.setAttribute('forceUpload', 'true');\r\n    ctx.scale(this.quality, this.quality);\r\n    ctx.translate(this.padding, this.padding);\r\n    ctx.imageSmoothingEnabled = this.smoothing;\r\n    ctx.lineWidth = this.lineWidth;\r\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\r\n    ctx.lineCap = this.lineCap;\r\n    ctx.strokeStyle = this.strokeColor?.toString() ?? '';\r\n    ctx.fillStyle = this.color?.toString();\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this._dirty) {\r\n      this.rasterize();\r\n    }\r\n    ex.scale(1 / this.quality, 1 / this.quality);\r\n    ex.drawImage(this._bitmap, x, y);\r\n  }\r\n\r\n  /**\r\n   * Executes drawing implementation of the graphic, this is where the specific drawing code for the graphic\r\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the {@apilink ExcaliburGraphicsContext} via `draw(...)`\r\n   * @param ctx Canvas to draw the graphic to\r\n   */\r\n  abstract execute(ctx: CanvasRenderingContext2D): void;\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\n\r\n/**\r\n * Enum representing the different font size units\r\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\r\n */\r\nexport enum FontUnit {\r\n  /**\r\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\r\n   */\r\n  Em = 'em',\r\n  /**\r\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\r\n   */\r\n  Rem = 'rem',\r\n  /**\r\n   * Pixel is a unit of length in screen pixels\r\n   */\r\n  Px = 'px',\r\n  /**\r\n   * Point is a physical unit length (1/72 of an inch)\r\n   */\r\n  Pt = 'pt',\r\n  /**\r\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\r\n   */\r\n  Percent = '%'\r\n}\r\n\r\n/**\r\n * Enum representing the different horizontal text alignments\r\n */\r\nexport enum TextAlign {\r\n  /**\r\n   * The text is left-aligned.\r\n   */\r\n  Left = 'left',\r\n  /**\r\n   * The text is right-aligned.\r\n   */\r\n  Right = 'right',\r\n  /**\r\n   * The text is centered.\r\n   */\r\n  Center = 'center',\r\n  /**\r\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\r\n   * right-aligned for right-to-left locales).\r\n   */\r\n  Start = 'start',\r\n  /**\r\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\r\n   * left-aligned for right-to-left locales).\r\n   */\r\n  End = 'end'\r\n}\r\n\r\n/**\r\n * Enum representing the different baseline text alignments\r\n */\r\nexport enum BaseAlign {\r\n  /**\r\n   * The text baseline is the top of the em square.\r\n   */\r\n  Top = 'top',\r\n  /**\r\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\r\n   * alphabetic.\r\n   */\r\n  Hanging = 'hanging',\r\n  /**\r\n   * The text baseline is the middle of the em square.\r\n   */\r\n  Middle = 'middle',\r\n  /**\r\n   * The text baseline is the normal alphabetic baseline.\r\n   */\r\n  Alphabetic = 'alphabetic',\r\n  /**\r\n   * The text baseline is the ideographic baseline; this is the bottom of\r\n   * the body of the characters, if the main body of characters protrudes\r\n   * beneath the alphabetic baseline.  Currently unsupported; this will\r\n   * act like alphabetic.\r\n   */\r\n  Ideographic = 'ideographic',\r\n  /**\r\n   * The text baseline is the bottom of the bounding box.  This differs\r\n   * from the ideographic baseline in that the ideographic baseline\r\n   * doesn't consider descenders.\r\n   */\r\n  Bottom = 'bottom'\r\n}\r\n\r\n/**\r\n * Enum representing the different possible font styles\r\n */\r\nexport enum FontStyle {\r\n  Normal = 'normal',\r\n  Italic = 'italic',\r\n  Oblique = 'oblique'\r\n}\r\n\r\n/**\r\n * Enum representing the text direction, useful for other languages, or writing text in reverse\r\n */\r\nexport enum Direction {\r\n  LeftToRight = 'ltr',\r\n  RightToLeft = 'rtl'\r\n}\r\n\r\n/**\r\n * Font rendering option\r\n */\r\nexport interface FontOptions {\r\n  /**\r\n   * Optionally the size of the font in the specified {@apilink FontUnit} by default 10.\r\n   */\r\n  size?: number;\r\n  /**\r\n   * Optionally specify unit to measure fonts in, by default Pixels\r\n   */\r\n  unit?: FontUnit;\r\n  /**\r\n   * Optionally specify the font family, by default 'sans-serif'\r\n   */\r\n  family?: string;\r\n  /**\r\n   * Optionally specify the font style, by default Normal\r\n   */\r\n  style?: FontStyle;\r\n  /**\r\n   * Optionally set whether the font is bold, by default false\r\n   */\r\n  bold?: boolean;\r\n  /**\r\n   * Optionally specify the text align, by default Left\r\n   */\r\n  textAlign?: TextAlign;\r\n  /**\r\n   * Optionally specify the text base align, by default Alphabetic\r\n   */\r\n  baseAlign?: BaseAlign;\r\n  /**\r\n   * Optionally specify the text direction, by default LeftToRight\r\n   */\r\n  direction?: Direction;\r\n  /**\r\n   * Optionally override the text line height in pixels, useful for multiline text. If unset will use default.\r\n   */\r\n  lineHeight?: number | undefined;\r\n  /**\r\n   * Optionally specify the quality of the text bitmap, it is a multiplier on the size size, by default 2.\r\n   * Higher quality text has a higher memory impact\r\n   */\r\n  quality?: number;\r\n  /**\r\n   * Optionally specify a text shadow, by default none is specified\r\n   */\r\n  shadow?: {\r\n    blur?: number;\r\n    offset?: Vector;\r\n    color?: Color;\r\n  };\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface FontRenderer {\r\n  measureText(text: string): BoundingBox;\r\n  render(ex: ExcaliburGraphicsContext, text: string, color: Color, x: number, y: number): void;\r\n}\r\n","import { Scene } from './Scene';\r\nimport { Vector } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { Trigger } from './Trigger';\r\nimport { FrameStats } from './Debug';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Side } from './Collision/Side';\r\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\r\nimport { Collider } from './Collision/Colliders/Collider';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate, SceneActivationContext, OnAdd, OnRemove } from './Interfaces/LifecycleEvents';\r\nimport { ExcaliburGraphicsContext } from './Graphics';\r\nimport { Axes, Buttons, Gamepad } from './Input/Gamepad';\r\nimport { Action } from './Actions/Action';\r\n\r\nexport enum EventTypes {\r\n  Kill = 'kill',\r\n  PreKill = 'prekill',\r\n  PostKill = 'postkill',\r\n\r\n  PreDraw = 'predraw',\r\n  PostDraw = 'postdraw',\r\n\r\n  PreDebugDraw = 'predebugdraw',\r\n  PostDebugDraw = 'postdebugdraw',\r\n\r\n  PreUpdate = 'preupdate',\r\n  PostUpdate = 'postupdate',\r\n\r\n  PreFrame = 'preframe',\r\n  PostFrame = 'postframe',\r\n\r\n  PreCollision = 'precollision',\r\n  CollisionStart = 'collisionstart',\r\n  CollisionEnd = 'collisionend',\r\n  PostCollision = 'postcollision',\r\n\r\n  Initialize = 'initialize',\r\n  Activate = 'activate',\r\n  Deactivate = 'deactivate',\r\n\r\n  ExitViewport = 'exitviewport',\r\n  EnterViewport = 'enterviewport',\r\n\r\n  ExitTrigger = 'exit',\r\n  EnterTrigger = 'enter',\r\n\r\n  Connect = 'connect',\r\n  Disconnect = 'disconnect',\r\n  Button = 'button',\r\n  Axis = 'axis',\r\n\r\n  Visible = 'visible',\r\n  Hidden = 'hidden',\r\n  Start = 'start',\r\n  Stop = 'stop',\r\n\r\n  PointerUp = 'pointerup',\r\n  PointerDown = 'pointerdown',\r\n  PointerMove = 'pointermove',\r\n  PointerEnter = 'pointerenter',\r\n  PointerLeave = 'pointerleave',\r\n  PointerCancel = 'pointercancel',\r\n  PointerWheel = 'pointerwheel',\r\n\r\n  Up = 'up',\r\n  Down = 'down',\r\n  Move = 'move',\r\n  Enter = 'enter',\r\n  Leave = 'leave',\r\n  Cancel = 'cancel',\r\n  Wheel = 'wheel',\r\n\r\n  Press = 'press',\r\n  Release = 'release',\r\n  Hold = 'hold',\r\n\r\n  PointerDragStart = 'pointerdragstart',\r\n  PointerDragEnd = 'pointerdragend',\r\n  PointerDragEnter = 'pointerdragenter',\r\n  PointerDragLeave = 'pointerdragleave',\r\n  PointerDragMove = 'pointerdragmove',\r\n\r\n  ActionStart = 'actionstart',\r\n  ActionComplete = 'actioncomplete',\r\n\r\n  Add = 'add',\r\n  Remove = 'remove'\r\n}\r\n\r\n/* istanbul ignore next */\r\n/* compiler only: these are internal to lib */\r\nexport type kill = 'kill';\r\nexport type prekill = 'prekill';\r\nexport type postkill = 'postkill';\r\n\r\nexport type predraw = 'predraw';\r\nexport type postdraw = 'postdraw';\r\n\r\nexport type predebugdraw = 'predebugdraw';\r\nexport type postdebugdraw = 'postdebugdraw';\r\n\r\nexport type preupdate = 'preupdate';\r\nexport type postupdate = 'postupdate';\r\n\r\nexport type preframe = 'preframe';\r\nexport type postframe = 'postframe';\r\n\r\nexport type precollision = 'precollision';\r\nexport type collisionstart = 'collisionstart';\r\nexport type collisionend = 'collisionend';\r\nexport type postcollision = 'postcollision';\r\n\r\nexport type initialize = 'initialize';\r\nexport type activate = 'activate';\r\nexport type deactivate = 'deactivate';\r\n\r\nexport type exitviewport = 'exitviewport';\r\nexport type enterviewport = 'enterviewport';\r\n\r\nexport type exittrigger = 'exit';\r\nexport type entertrigger = 'enter';\r\n\r\nexport type connect = 'connect';\r\nexport type disconnect = 'disconnect';\r\nexport type button = 'button';\r\nexport type axis = 'axis';\r\n\r\nexport type subscribe = 'subscribe';\r\nexport type unsubscribe = 'unsubscribe';\r\n\r\nexport type visible = 'visible';\r\nexport type hidden = 'hidden';\r\nexport type start = 'start';\r\nexport type stop = 'stop';\r\n\r\nexport type pointerup = 'pointerup';\r\nexport type pointerdown = 'pointerdown';\r\nexport type pointermove = 'pointermove';\r\nexport type pointerenter = 'pointerenter';\r\nexport type pointerleave = 'pointerleave';\r\nexport type pointercancel = 'pointercancel';\r\nexport type pointerwheel = 'pointerwheel';\r\n\r\nexport type up = 'up';\r\nexport type down = 'down';\r\nexport type move = 'move';\r\nexport type enter = 'enter';\r\nexport type leave = 'leave';\r\nexport type cancel = 'cancel';\r\nexport type wheel = 'wheel';\r\n\r\nexport type press = 'press';\r\nexport type release = 'release';\r\nexport type hold = 'hold';\r\n\r\nexport type pointerdragstart = 'pointerdragstart';\r\nexport type pointerdragend = 'pointerdragend';\r\nexport type pointerdragenter = 'pointerdragenter';\r\nexport type pointerdragleave = 'pointerdragleave';\r\nexport type pointerdragmove = 'pointerdragmove';\r\n\r\nexport type add = 'add';\r\nexport type remove = 'remove';\r\n\r\n/**\r\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\r\n * some events are unique to a type, others are not.\r\n *\r\n */\r\nexport class GameEvent<T, U = T> {\r\n  /**\r\n   * Target object for this event.\r\n   */\r\n  public target: T;\r\n\r\n  /**\r\n   * Other target object for this event\r\n   */\r\n  public other: U | null = null;\r\n\r\n  /**\r\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\r\n   * to all actors that apply.\r\n   */\r\n  public get bubbles(): boolean {\r\n    return this._bubbles;\r\n  }\r\n\r\n  public set bubbles(value: boolean) {\r\n    this._bubbles = value;\r\n  }\r\n\r\n  private _bubbles: boolean = true;\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation() {\r\n    this.bubbles = false;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\r\n */\r\nexport class KillEvent extends GameEvent<Entity> {\r\n  constructor(public self: Entity) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'prekill' event is emitted directly before an actor is killed.\r\n */\r\nexport class PreKillEvent extends GameEvent<Actor> {\r\n  constructor(public self: Actor) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postkill' event is emitted directly after the actor is killed.\r\n */\r\nexport class PostKillEvent extends GameEvent<Actor> {\r\n  constructor(public self: Actor) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'start' event is emitted on engine when has started and is ready for interaction.\r\n */\r\nexport class GameStartEvent extends GameEvent<Engine> {\r\n  constructor(public self: Engine) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\r\n */\r\nexport class GameStopEvent extends GameEvent<Engine> {\r\n  constructor(public self: Engine) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\r\n * transform so that all drawing takes place with the actor as the origin.\r\n *\r\n */\r\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public elapsed: number,\r\n    public self: Entity | Scene | Engine | TileMap\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\r\n * transform so that all drawing takes place with the actor as the origin.\r\n *\r\n */\r\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public elapsed: number,\r\n    public self: Entity | Scene | Engine | TileMap\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'pretransformdraw' event is emitted on actors/entities before any graphics transforms have taken place.\r\n * Useful if you need to completely customize the draw or modify the transform before drawing in the draw step (for example needing\r\n * latest camera positions)\r\n *\r\n */\r\nexport class PreTransformDrawEvent extends GameEvent<Entity> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public elapsed: number,\r\n    public self: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'posttransformdraw' event is emitted on actors/entities after all graphics have been draw and transforms reset.\r\n * Useful if you need to completely custom the draw after everything is done.\r\n *\r\n */\r\nexport class PostTransformDrawEvent extends GameEvent<Entity> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public elapsed: number,\r\n    public self: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\r\n */\r\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public self: Entity | Actor | Scene | Engine\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\r\n */\r\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\r\n  constructor(\r\n    public ctx: ExcaliburGraphicsContext,\r\n    public self: Entity | Actor | Scene | Engine\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\r\n */\r\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public elapsed: number,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\r\n */\r\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public elapsed: number,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'preframe' event is emitted on the engine, before the frame begins.\r\n */\r\nexport class PreFrameEvent extends GameEvent<Engine> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public prevStats: FrameStats\r\n  ) {\r\n    super();\r\n    this.target = engine;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postframe' event is emitted on the engine, after a frame ends.\r\n */\r\nexport class PostFrameEvent extends GameEvent<Engine> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public stats: FrameStats\r\n  ) {\r\n    super();\r\n    this.target = engine;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received when a gamepad is connected to Excalibur. {@apilink Gamepads} receives this event.\r\n */\r\nexport class GamepadConnectEvent extends GameEvent<Gamepad> {\r\n  constructor(\r\n    public index: number,\r\n    public gamepad: Gamepad\r\n  ) {\r\n    super();\r\n    this.target = gamepad;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received when a gamepad is disconnected from Excalibur. {@apilink Gamepads} receives this event.\r\n */\r\nexport class GamepadDisconnectEvent extends GameEvent<Gamepad> {\r\n  constructor(\r\n    public index: number,\r\n    public gamepad: Gamepad\r\n  ) {\r\n    super();\r\n    this.target = gamepad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad button event. See {@apilink Gamepads} for information on responding to controller input. {@apilink Gamepad} instances receive this event;\r\n */\r\nexport class GamepadButtonEvent extends GameEvent<Gamepad> {\r\n  /**\r\n   * @param button  The Gamepad button\r\n   * @param value   A numeric value between 0 and 1\r\n   */\r\n  constructor(\r\n    public button: Buttons,\r\n    public value: number,\r\n    public self: Gamepad\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad axis event. See {@apilink Gamepads} for information on responding to controller input. {@apilink Gamepad} instances receive this event;\r\n */\r\nexport class GamepadAxisEvent extends GameEvent<Gamepad> {\r\n  /**\r\n   * @param axis  The Gamepad axis\r\n   * @param value A numeric value between -1 and 1\r\n   */\r\n  constructor(\r\n    public axis: Axes,\r\n    public value: number,\r\n    public self: Gamepad\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received by the {@apilink Engine} when the browser window is visible on a screen.\r\n */\r\nexport class VisibleEvent extends GameEvent<Engine> {\r\n  constructor(public self: Engine) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received by the {@apilink Engine} when the browser window is hidden from all screens.\r\n */\r\nexport class HiddenEvent extends GameEvent<Engine> {\r\n  constructor(public self: Engine) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor | `actor`} when a collision will occur this frame if it resolves\r\n */\r\nexport class PreCollisionEvent<T extends Collider = Collider> extends GameEvent<T> {\r\n  /**\r\n   * @param self          The actor the event was thrown on\r\n   * @param other         The actor that will collided with the current actor\r\n   * @param side          The side that will be collided with the current actor\r\n   * @param intersection  Intersection vector\r\n   */\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public intersection: Vector,\r\n    public contact: CollisionContact\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor | `actor`} when a collision has been resolved (body reacted) this frame\r\n */\r\nexport class PostCollisionEvent<T extends Collider = Collider> extends GameEvent<T> {\r\n  /**\r\n   * @param self          The actor the event was thrown on\r\n   * @param other         The actor that did collide with the current actor\r\n   * @param side          The side that did collide with the current actor\r\n   * @param intersection  Intersection vector\r\n   */\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public intersection: Vector,\r\n    public contact: CollisionContact\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\nexport class ContactStartEvent<T extends Collider = Collider> {\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public contact: CollisionContact\r\n  ) {}\r\n}\r\n\r\nexport class ContactEndEvent<T extends Collider = Collider> {\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public lastContact: CollisionContact\r\n  ) {}\r\n}\r\n\r\nexport class CollisionPreSolveEvent<T extends Collider = Collider> {\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public intersection: Vector,\r\n    public contact: CollisionContact\r\n  ) {}\r\n}\r\n\r\nexport class CollisionPostSolveEvent<T extends Collider = Collider> {\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public intersection: Vector,\r\n    public contact: CollisionContact\r\n  ) {}\r\n}\r\n\r\n/**\r\n * Event thrown the first time an {@apilink Actor | `actor`} collides with another, after an actor is in contact normal collision events are fired.\r\n */\r\nexport class CollisionStartEvent<T extends Collider = Collider> extends GameEvent<T> {\r\n  /**\r\n   *\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param contact\r\n   */\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public contact: CollisionContact\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown when the {@apilink Actor | `actor`} is no longer colliding with another\r\n */\r\nexport class CollisionEndEvent<T extends Collider = Collider> extends GameEvent<T> {\r\n  /**\r\n   *\r\n   */\r\n  constructor(\r\n    public self: T,\r\n    public other: T,\r\n    public side: Side,\r\n    public lastContact: CollisionContact\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor}, {@apilink Scene}, and {@apilink Engine} only once before the first update call\r\n */\r\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\r\n  /**\r\n   * @param engine  The reference to the current engine\r\n   */\r\n  constructor(\r\n    public engine: Engine,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on a {@apilink Scene} on activation\r\n */\r\nexport class ActivateEvent<TData = undefined> extends GameEvent<Scene> {\r\n  /**\r\n   * @param context  The context for the scene activation\r\n   */\r\n  constructor(\r\n    public context: SceneActivationContext<TData>,\r\n    public self: Scene\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on a {@apilink Scene} on deactivation\r\n */\r\nexport class DeactivateEvent extends GameEvent<Scene> {\r\n  /**\r\n   * @param context  The context for the scene deactivation\r\n   */\r\n  constructor(\r\n    public context: SceneActivationContext<never>,\r\n    public self: Scene\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor} when the graphics bounds completely leaves the screen.\r\n */\r\nexport class ExitViewPortEvent extends GameEvent<Entity> {\r\n  constructor(public self: Entity) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor} when any part of the graphics bounds are on screen.\r\n */\r\nexport class EnterViewPortEvent extends GameEvent<Entity> {\r\n  constructor(public self: Entity) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\nexport class EnterTriggerEvent extends GameEvent<Trigger> {\r\n  constructor(\r\n    public self: Trigger,\r\n    public entity: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\nexport class ExitTriggerEvent extends GameEvent<Trigger> {\r\n  constructor(\r\n    public self: Trigger,\r\n    public entity: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor} when an action starts.\r\n */\r\nexport class ActionStartEvent extends GameEvent<Entity> {\r\n  constructor(\r\n    public action: Action,\r\n    public self: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an {@apilink Actor} when an action completes.\r\n */\r\nexport class ActionCompleteEvent extends GameEvent<Entity> {\r\n  constructor(\r\n    public action: Action,\r\n    public self: Entity\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] when an Actor added to scene.\r\n */\r\nexport class AddEvent<T extends OnAdd> extends GameEvent<T> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] when an Actor removed from scene.\r\n */\r\nexport class RemoveEvent<T extends OnRemove> extends GameEvent<T> {\r\n  constructor(\r\n    public engine: Engine,\r\n    public self: T\r\n  ) {\r\n    super();\r\n    this.target = self;\r\n  }\r\n}\r\n","import { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\n\r\n/**\r\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\r\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\r\n */\r\nexport type LineCapStyle = 'butt' | 'round' | 'square';\r\n\r\n/* istanbul ignore next */\r\n/**\r\n * Draw a line on canvas context\r\n * @param ctx The canvas context\r\n * @param color The color of the line\r\n * @param x1 The start x coordinate\r\n * @param y1 The start y coordinate\r\n * @param x2 The ending x coordinate\r\n * @param y2 The ending y coordinate\r\n * @param thickness The line thickness\r\n * @param cap The {@apilink LineCapStyle} (butt, round, or square)\r\n */\r\nexport function line(\r\n  ctx: CanvasRenderingContext2D,\r\n  color: Color = Color.Red,\r\n  x1: number,\r\n  y1: number,\r\n  x2: number,\r\n  y2: number,\r\n  thickness: number = 1,\r\n  cap: LineCapStyle = 'butt'\r\n) {\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.lineWidth = thickness;\r\n  ctx.lineCap = cap;\r\n  ctx.strokeStyle = color.toString();\r\n  ctx.moveTo(x1, y1);\r\n  ctx.lineTo(x2, y2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n\r\n/* istanbul ignore next */\r\n/**\r\n * Draw the vector as a point onto the canvas.\r\n */\r\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = color.toString();\r\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Draw the vector as a line onto the canvas starting a origin point.\r\n */\r\n/* istanbul ignore next */\r\n/**\r\n *\r\n */\r\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\r\n  const c = color ? color.toString() : 'blue';\r\n  const v = vector.scale(scale);\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = c;\r\n  ctx.moveTo(origin.x, origin.y);\r\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Represents border radius values\r\n */\r\nexport interface BorderRadius {\r\n  /**\r\n   * Top-left\r\n   */\r\n  tl: number;\r\n  /**\r\n   * Top-right\r\n   */\r\n  tr: number;\r\n  /**\r\n   * Bottom-right\r\n   */\r\n  br: number;\r\n  /**\r\n   * Bottom-left\r\n   */\r\n  bl: number;\r\n}\r\n\r\n/**\r\n * Draw a round rectangle on a canvas context\r\n * @param ctx The canvas context\r\n * @param x The top-left x coordinate\r\n * @param y The top-left y coordinate\r\n * @param width The width of the rectangle\r\n * @param height The height of the rectangle\r\n * @param radius The border radius of the rectangle\r\n * @param stroke The {@apilink Color} to stroke rectangle with\r\n * @param fill The {@apilink Color} to fill rectangle with\r\n */\r\nexport function roundRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number,\r\n  radius: number | BorderRadius = 5,\r\n  stroke: Color | null = Color.White,\r\n  fill: Color | null = null\r\n) {\r\n  let br: BorderRadius;\r\n\r\n  if (typeof radius === 'number') {\r\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\r\n  } else {\r\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\r\n\r\n    for (const prop in defaultRadius) {\r\n      if (defaultRadius.hasOwnProperty(prop)) {\r\n        const side = <keyof BorderRadius>prop;\r\n        br[side] = radius[side] || defaultRadius[side];\r\n      }\r\n    }\r\n  }\r\n\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + br.tl, y);\r\n  ctx.lineTo(x + width - br.tr, y);\r\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\r\n  ctx.lineTo(x + width, y + height - br.br);\r\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\r\n  ctx.lineTo(x + br.bl, y + height);\r\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\r\n  ctx.lineTo(x, y + br.tl);\r\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\r\n  ctx.closePath();\r\n\r\n  if (fill) {\r\n    ctx.fillStyle = fill.toString();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (stroke) {\r\n    ctx.strokeStyle = stroke.toString();\r\n    ctx.stroke();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function circle(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  radius: number,\r\n  stroke: Color = Color.White,\r\n  fill: Color = null\r\n) {\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n\r\n  if (fill) {\r\n    ctx.fillStyle = fill.toString();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (stroke) {\r\n    ctx.strokeStyle = stroke.toString();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { line } from '../Util/DrawUtil';\r\nimport { ExcaliburGraphicsContextWebGL } from './Context/ExcaliburGraphicsContextWebGL';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Font } from './Font';\r\n\r\nexport class FontTextInstance {\r\n  public canvas: HTMLCanvasElement;\r\n  public ctx: CanvasRenderingContext2D;\r\n  private _textFragments: { x: number; y: number; canvas: HTMLCanvasElement }[] = [];\r\n  public dimensions: BoundingBox;\r\n  public disposed: boolean = false;\r\n  private _lastHashCode: string;\r\n\r\n  constructor(\r\n    public readonly font: Font,\r\n    public readonly text: string,\r\n    public readonly color: Color,\r\n    public readonly maxWidth?: number\r\n  ) {\r\n    this.canvas = document.createElement('canvas');\r\n    const ctx = this.canvas.getContext('2d');\r\n    if (!ctx) {\r\n      throw new Error('Unable to create FontTextInstance, internal canvas failed to create');\r\n    }\r\n    this.ctx = ctx;\r\n    this.dimensions = this.measureText(text);\r\n    this._setDimension(this.dimensions, this.ctx);\r\n    this._lastHashCode = this.getHashCode();\r\n  }\r\n\r\n  measureText(text: string, maxWidth?: number): BoundingBox {\r\n    if (this.disposed) {\r\n      throw Error('Accessing disposed text instance! ' + this.text);\r\n    }\r\n    let lines = null;\r\n    if (maxWidth != null) {\r\n      lines = this._getLinesFromText(text, maxWidth);\r\n    } else {\r\n      lines = text.split('\\n');\r\n    }\r\n\r\n    const maxWidthLine = lines.reduce((a, b) => {\r\n      return a.length > b.length ? a : b;\r\n    });\r\n\r\n    this._applyFont(this.ctx); // font must be applied to the context to measure it\r\n    const metrics = this.ctx.measureText(maxWidthLine);\r\n    let textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\r\n\r\n    // TODO line height makes the text bounds wonky\r\n    const lineAdjustedHeight = textHeight * lines.length;\r\n    textHeight = lineAdjustedHeight;\r\n    const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\r\n    const x = 0;\r\n    const y = 0;\r\n    const measurement = new BoundingBox({\r\n      left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.font.padding,\r\n      top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.font.padding,\r\n      bottom: y + bottomBounds + this.font.padding,\r\n      right: x + Math.abs(metrics.actualBoundingBoxRight) + this.font.padding\r\n    });\r\n\r\n    return measurement;\r\n  }\r\n\r\n  private _setDimension(textBounds: BoundingBox, bitmap: CanvasRenderingContext2D) {\r\n    let lineHeightRatio = 1;\r\n    if (this.font.lineHeight) {\r\n      lineHeightRatio = this.font.lineHeight / this.font.size;\r\n    }\r\n    // Changing the width and height clears the context properties\r\n    // We double the bitmap width to account for all possible alignment\r\n    // We scale by \"quality\" so we render text without jaggies\r\n    bitmap.canvas.width = (textBounds.width + this.font.padding * 2) * 2 * this.font.quality;\r\n    bitmap.canvas.height = (textBounds.height + this.font.padding * 2) * 2 * this.font.quality * lineHeightRatio;\r\n  }\r\n\r\n  public static getHashCode(font: Font, text: string, color?: Color) {\r\n    const hash =\r\n      text +\r\n      '__hashcode__' +\r\n      font.fontString +\r\n      font.showDebug +\r\n      font.textAlign +\r\n      font.baseAlign +\r\n      font.direction +\r\n      font.lineHeight +\r\n      JSON.stringify(font.shadow) +\r\n      (font.padding.toString() +\r\n        font.smoothing.toString() +\r\n        font.lineWidth.toString() +\r\n        font.lineDash.toString() +\r\n        font.strokeColor?.toString() +\r\n        (color ? color.toString() : font.color.toString()));\r\n    return hash;\r\n  }\r\n\r\n  getHashCode(includeColor: boolean = true) {\r\n    return FontTextInstance.getHashCode(this.font, this.text, includeColor ? this.color : undefined);\r\n  }\r\n\r\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\r\n    ctx.translate(this.font.padding, this.font.padding);\r\n    ctx.imageSmoothingEnabled = this.font.smoothing;\r\n    ctx.lineWidth = this.font.lineWidth;\r\n    ctx.setLineDash(this.font.lineDash ?? ctx.getLineDash());\r\n    ctx.strokeStyle = this.font.strokeColor?.toString() ?? '';\r\n    ctx.fillStyle = this.color.toString();\r\n  }\r\n\r\n  private _applyFont(ctx: CanvasRenderingContext2D) {\r\n    ctx.resetTransform();\r\n    ctx.translate(this.font.padding + ctx.canvas.width / 2, this.font.padding + ctx.canvas.height / 2);\r\n    ctx.scale(this.font.quality, this.font.quality);\r\n    ctx.textAlign = this.font.textAlign;\r\n    ctx.textBaseline = this.font.baseAlign;\r\n    ctx.font = this.font.fontString;\r\n    ctx.direction = this.font.direction;\r\n\r\n    if (this.font.shadow) {\r\n      if (this.font.shadow.color) {\r\n        ctx.shadowColor = this.font.shadow.color.toString();\r\n      }\r\n      if (this.font.shadow.blur) {\r\n        ctx.shadowBlur = this.font.shadow.blur;\r\n      }\r\n      if (this.font.shadow.offset) {\r\n        ctx.shadowOffsetX = this.font.shadow.offset.x;\r\n        ctx.shadowOffsetY = this.font.shadow.offset.y;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _drawText(ctx: CanvasRenderingContext2D, lines: string[], lineHeight: number): void {\r\n    this._applyRasterProperties(ctx);\r\n    this._applyFont(ctx);\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const line = lines[i];\r\n      if (this.color) {\r\n        ctx.fillText(line, 0, i * lineHeight);\r\n      }\r\n\r\n      if (this.font.strokeColor) {\r\n        ctx.strokeText(line, 0, i * lineHeight);\r\n      }\r\n    }\r\n\r\n    if (this.font.showDebug) {\r\n      // Horizontal line\r\n      /* istanbul ignore next */\r\n      line(ctx, Color.Green, -ctx.canvas.width / 2, 0, ctx.canvas.width / 2, 0, 2);\r\n      // Vertical line\r\n      /* istanbul ignore next */\r\n      line(ctx, Color.Red, 0, -ctx.canvas.height / 2, 0, ctx.canvas.height / 2, 2);\r\n    }\r\n  }\r\n\r\n  private _splitTextBitmap(bitmap: CanvasRenderingContext2D) {\r\n    const textImages: { x: number; y: number; canvas: HTMLCanvasElement }[] = [];\r\n    let currentX = 0;\r\n    let currentY = 0;\r\n    // 4k is the max for mobile devices\r\n    const width = Math.min(4096, bitmap.canvas.width);\r\n    const height = Math.min(4096, bitmap.canvas.height);\r\n\r\n    // Splits the original bitmap into 4k max chunks\r\n    while (currentX < bitmap.canvas.width) {\r\n      while (currentY < bitmap.canvas.height) {\r\n        // create new bitmap\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n          throw new Error('Unable to split internal FontTextInstance bitmap, failed to create internal canvas');\r\n        }\r\n\r\n        // draw current slice to new bitmap in < 4k chunks\r\n        ctx.drawImage(bitmap.canvas, currentX, currentY, width, height, 0, 0, width, height);\r\n\r\n        textImages.push({ x: currentX, y: currentY, canvas });\r\n        currentY += height;\r\n      }\r\n      currentX += width;\r\n      currentY = 0;\r\n    }\r\n    return textImages;\r\n  }\r\n\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n  private _dirty = true;\r\n  private _ex?: ExcaliburGraphicsContext;\r\n  public render(ex: ExcaliburGraphicsContext, x: number, y: number, maxWidth?: number) {\r\n    if (this.disposed) {\r\n      throw Error('Accessing disposed text instance! ' + this.text);\r\n    }\r\n    this._ex = ex;\r\n    const hashCode = this.getHashCode();\r\n    if (this._lastHashCode !== hashCode) {\r\n      this._dirty = true;\r\n    }\r\n\r\n    // Calculate image chunks\r\n    if (this._dirty) {\r\n      this.dimensions = this.measureText(this.text, maxWidth);\r\n      this._setDimension(this.dimensions, this.ctx);\r\n      const lines = this._getLinesFromText(this.text, maxWidth);\r\n      const lineHeight = this.font.lineHeight ?? this.dimensions.height / lines.length;\r\n\r\n      // draws the text to the main bitmap\r\n      this._drawText(this.ctx, lines, lineHeight);\r\n\r\n      // clear any out old fragments\r\n      if (ex instanceof ExcaliburGraphicsContextWebGL) {\r\n        for (const frag of this._textFragments) {\r\n          ex.textureLoader.delete(frag.canvas);\r\n        }\r\n      }\r\n\r\n      // splits to < 4k fragments for large text\r\n      this._textFragments = this._splitTextBitmap(this.ctx);\r\n\r\n      if (ex instanceof ExcaliburGraphicsContextWebGL) {\r\n        for (const frag of this._textFragments) {\r\n          ex.textureLoader.load(frag.canvas, { filtering: this.font.filtering }, true);\r\n        }\r\n      }\r\n      this._lastHashCode = hashCode;\r\n      this._dirty = false;\r\n    }\r\n\r\n    // draws the bitmap fragments to excalibur graphics context\r\n    for (const frag of this._textFragments) {\r\n      ex.drawImage(\r\n        frag.canvas,\r\n        0,\r\n        0,\r\n        frag.canvas.width,\r\n        frag.canvas.height,\r\n        frag.x / this.font.quality + x - this.ctx.canvas.width / this.font.quality / 2,\r\n        frag.y / this.font.quality + y - this.ctx.canvas.height / this.font.quality / 2,\r\n        frag.canvas.width / this.font.quality,\r\n        frag.canvas.height / this.font.quality\r\n      );\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    this.disposed = true;\r\n    this.dimensions = undefined as any;\r\n    this.canvas = undefined as any;\r\n    this.ctx = undefined as any;\r\n    if (this._ex instanceof ExcaliburGraphicsContextWebGL) {\r\n      for (const frag of this._textFragments) {\r\n        this._ex.textureLoader.delete(frag.canvas);\r\n      }\r\n    }\r\n    this._textFragments.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Return array of lines split based on the \\n character, and the maxWidth? constraint\r\n   * @param text\r\n   * @param maxWidth\r\n   */\r\n  private _cachedText?: string;\r\n  private _cachedLines?: string[];\r\n  private _cachedRenderWidth?: number;\r\n  private _getLinesFromText(text: string, maxWidth?: number): string[] {\r\n    if (this._cachedText === text && this._cachedRenderWidth === maxWidth && this._cachedLines?.length) {\r\n      return this._cachedLines;\r\n    }\r\n\r\n    const lines = text.split('\\n');\r\n\r\n    if (maxWidth == null) {\r\n      return lines;\r\n    }\r\n\r\n    // If the current line goes past the maxWidth, append a new line without modifying the underlying text.\r\n    for (let i = 0; i < lines.length; i++) {\r\n      let line = lines[i];\r\n      let newLine = '';\r\n      if (this.measureText(line).width > maxWidth) {\r\n        while (this.measureText(line).width > maxWidth) {\r\n          newLine = line[line.length - 1] + newLine;\r\n          line = line.slice(0, -1); // Remove last character from line\r\n        }\r\n\r\n        // Update the array with our new values\r\n        lines[i] = line;\r\n        lines[i + 1] = newLine;\r\n      }\r\n    }\r\n\r\n    this._cachedText = text;\r\n    this._cachedLines = lines;\r\n    this._cachedRenderWidth = maxWidth;\r\n\r\n    return lines;\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Logger } from '../Util/Log';\r\nimport { Font } from './Font';\r\nimport { FontTextInstance } from './FontTextInstance';\r\n\r\nexport class FontCache {\r\n  public static FONT_TIMEOUT = 500;\r\n  private static _LOGGER = Logger.getInstance();\r\n  private static _TEXT_USAGE = new Map<FontTextInstance, number>();\r\n  private static _TEXT_CACHE = new Map<string, FontTextInstance>();\r\n  private static _MEASURE_CACHE = new Map<string, BoundingBox>();\r\n\r\n  static measureText(text: string, font: Font, maxWidth?: number): BoundingBox {\r\n    const hash = FontTextInstance.getHashCode(font, text);\r\n    if (FontCache._MEASURE_CACHE.has(hash)) {\r\n      return FontCache._MEASURE_CACHE.get(hash)!;\r\n    }\r\n    FontCache._LOGGER.debug('Font text measurement cache miss');\r\n    const measurement = font.measureTextWithoutCache(text, maxWidth);\r\n    FontCache._MEASURE_CACHE.set(hash, measurement);\r\n    return measurement;\r\n  }\r\n\r\n  static getTextInstance(text: string, font: Font, color: Color): FontTextInstance {\r\n    const hash = FontTextInstance.getHashCode(font, text, color);\r\n    let textInstance = FontCache._TEXT_CACHE.get(hash);\r\n    if (!textInstance) {\r\n      textInstance = new FontTextInstance(font, text, color);\r\n      FontCache._TEXT_CACHE.set(hash, textInstance);\r\n      FontCache._LOGGER.debug('Font text instance cache miss');\r\n    }\r\n\r\n    // Cache the bitmap for certain amount of time\r\n    FontCache._TEXT_USAGE.set(textInstance, performance.now());\r\n\r\n    return textInstance;\r\n  }\r\n\r\n  static checkAndClearCache() {\r\n    const deferred: FontTextInstance[] = [];\r\n    const currentHashCodes = new Set<string>();\r\n    for (const [textInstance, time] of FontCache._TEXT_USAGE.entries()) {\r\n      // if bitmap hasn't been used in 100 ms clear it\r\n      if (time + FontCache.FONT_TIMEOUT < performance.now()) {\r\n        FontCache._LOGGER.debug(`Text cache entry timed out ${textInstance.text}`);\r\n        deferred.push(textInstance);\r\n        textInstance.dispose();\r\n      } else {\r\n        const hash = textInstance.getHashCode(false);\r\n        currentHashCodes.add(hash);\r\n      }\r\n    }\r\n    // Deferred removal of text instances\r\n    deferred.forEach((t) => {\r\n      FontCache._TEXT_USAGE.delete(t);\r\n    });\r\n\r\n    // Regenerate text instance cache\r\n    this._TEXT_CACHE.clear();\r\n    for (const [textInstance] of this._TEXT_USAGE.entries()) {\r\n      this._TEXT_CACHE.set(textInstance.getHashCode(), textInstance);\r\n    }\r\n\r\n    // Regenerated measurement cache\r\n    const newTextMeasurementCache = new Map<string, BoundingBox>();\r\n    for (const current of currentHashCodes) {\r\n      if (FontCache._MEASURE_CACHE.has(current)) {\r\n        newTextMeasurementCache.set(current, FontCache._MEASURE_CACHE.get(current)!);\r\n      }\r\n    }\r\n    this._MEASURE_CACHE.clear();\r\n    this._MEASURE_CACHE = newTextMeasurementCache;\r\n  }\r\n\r\n  public static get cacheSize() {\r\n    return FontCache._TEXT_USAGE.size;\r\n  }\r\n\r\n  /**\r\n   * Force clear all cached text bitmaps\r\n   */\r\n  public static clearCache() {\r\n    for (const [textInstance] of FontCache._TEXT_USAGE.entries()) {\r\n      textInstance.dispose();\r\n    }\r\n    FontCache._TEXT_USAGE.clear();\r\n    FontCache._TEXT_CACHE.clear();\r\n    FontCache._MEASURE_CACHE.clear();\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Color } from '../Color';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { RasterOptions } from './Raster';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { FontTextInstance } from './FontTextInstance';\r\nimport { FontCache } from './FontCache';\r\n/**\r\n * Represents a system or web font in Excalibur\r\n *\r\n * If no options specified, the system sans-serif 10 pixel is used\r\n *\r\n * If loading a custom web font be sure to have the font loaded before you use it https://erikonarheim.com/posts/dont-test-fonts/\r\n */\r\nexport class Font extends Graphic implements FontRenderer {\r\n  /**\r\n   * Set the font filtering mode, by default set to {@apilink ImageFiltering.Blended} regardless of the engine default smoothing\r\n   *\r\n   * If you have a pixel style font that may be a reason to switch this to {@apilink ImageFiltering.Pixel}\r\n   */\r\n  public filtering: ImageFiltering = ImageFiltering.Blended;\r\n  constructor(options: FontOptions & GraphicOptions & RasterOptions = {}) {\r\n    super(options); // <- Graphics properties\r\n\r\n    // Raster properties\r\n    this.smoothing = options?.smoothing ?? this.smoothing;\r\n    this.padding = options?.padding ?? this.padding;\r\n    this.color = options?.color ?? this.color;\r\n    this.strokeColor = options?.strokeColor ?? this.strokeColor;\r\n    this.lineDash = options?.lineDash ?? this.lineDash;\r\n    this.lineWidth = options?.lineWidth ?? this.lineWidth;\r\n    this.filtering = options?.filtering ?? this.filtering;\r\n\r\n    // Font specific properties\r\n    this.family = options?.family ?? this.family;\r\n    this.style = options?.style ?? this.style;\r\n    this.bold = options?.bold ?? this.bold;\r\n    this.size = options?.size ?? this.size;\r\n    this.unit = options?.unit ?? this.unit;\r\n    this.textAlign = options?.textAlign ?? this.textAlign;\r\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\r\n    this.direction = options?.direction ?? this.direction;\r\n    this.lineHeight = options?.lineHeight ?? this.lineHeight;\r\n    this.quality = options?.quality ?? this.quality;\r\n    if (options?.shadow) {\r\n      this.shadow = {};\r\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\r\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\r\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\r\n    }\r\n  }\r\n\r\n  public clone() {\r\n    return new Font({\r\n      ...this.cloneGraphicOptions(),\r\n      size: this.size,\r\n      unit: this.unit,\r\n      family: this.family,\r\n      style: this.style,\r\n      bold: this.bold,\r\n      textAlign: this.textAlign,\r\n      baseAlign: this.baseAlign,\r\n      direction: this.direction,\r\n      shadow: this.shadow\r\n        ? {\r\n            blur: this.shadow.blur,\r\n            offset: this.shadow.offset,\r\n            color: this.shadow.color\r\n          }\r\n        : undefined\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Font quality determines the size of the underlying raster text, higher quality means less jagged edges.\r\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\r\n   *\r\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\r\n   *\r\n   * (Default 2)\r\n   */\r\n  public quality = 2;\r\n\r\n  // Raster properties for fonts\r\n  public padding = 2;\r\n  public smoothing = false;\r\n  public lineWidth = 1;\r\n  public lineDash: number[] = [];\r\n  public color: Color = Color.Black;\r\n  public strokeColor?: Color;\r\n\r\n  public family: string = 'sans-serif';\r\n  public style: FontStyle = FontStyle.Normal;\r\n  public bold: boolean = false;\r\n  public unit: FontUnit = FontUnit.Px;\r\n  public textAlign: TextAlign = TextAlign.Left;\r\n  public baseAlign: BaseAlign = BaseAlign.Top;\r\n  public direction: Direction = Direction.LeftToRight;\r\n  /**\r\n   * Font line height in pixels, default line height if unset\r\n   */\r\n  public lineHeight: number | undefined = undefined;\r\n  public size: number = 10;\r\n  public shadow?: { blur?: number; offset?: Vector; color?: Color };\r\n\r\n  public get fontString() {\r\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\r\n  }\r\n\r\n  private _textBounds: BoundingBox = new BoundingBox();\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this._textBounds;\r\n  }\r\n\r\n  protected _drawImage(_ex: ExcaliburGraphicsContext, _x: number, _y: number) {\r\n    // TODO weird vestigial drawimage\r\n  }\r\n\r\n  protected _rotate(ex: ExcaliburGraphicsContext) {\r\n    // TODO this needs to change depending on the bounding box...\r\n    const origin = this.origin ?? this._textBounds.center;\r\n    ex.translate(origin.x, origin.y);\r\n    ex.rotate(this.rotation);\r\n    ex.translate(-origin.x, -origin.y);\r\n  }\r\n\r\n  protected _flip(ex: ExcaliburGraphicsContext) {\r\n    if (this.flipHorizontal) {\r\n      ex.translate(this._textBounds.width / this.scale.x, 0);\r\n      ex.scale(-1, 1);\r\n    }\r\n\r\n    if (this.flipVertical) {\r\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\r\n      ex.scale(1, -1);\r\n    }\r\n  }\r\n\r\n  private _textMeasurement = new FontTextInstance(this, '', Color.Black);\r\n\r\n  public measureTextWithoutCache(text: string, maxWidth?: number) {\r\n    return this._textMeasurement.measureText(text, maxWidth);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox that is the total size of the text including multiple lines\r\n   *\r\n   * Does not include any padding or adjustment\r\n   * @param text\r\n   * @returns BoundingBox\r\n   */\r\n  public measureText(text: string, maxWidth?: number): BoundingBox {\r\n    return FontCache.measureText(text, this, maxWidth);\r\n  }\r\n\r\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\r\n    ex.restore();\r\n  }\r\n\r\n  public render(ex: ExcaliburGraphicsContext, text: string, colorOverride: Color, x: number, y: number, maxWidth?: number) {\r\n    const textInstance = FontCache.getTextInstance(text, this, colorOverride);\r\n\r\n    // Apply affine transformations\r\n    this._textBounds = textInstance.dimensions;\r\n    this._preDraw(ex, x, y);\r\n\r\n    textInstance.render(ex, x, y, maxWidth);\r\n\r\n    this._postDraw(ex);\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { SpriteFont } from './SpriteFont';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Color } from '../Color';\r\nimport { Font } from './Font';\r\n\r\nexport interface TextOptions {\r\n  /**\r\n   * Text to draw\r\n   */\r\n  text: string;\r\n\r\n  /**\r\n   * Optionally override the font color, currently unsupported by SpriteFont\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally specify a font, if none specified a default font is used (System sans-serif 10 pixel)\r\n   */\r\n  font?: Font | SpriteFont;\r\n\r\n  /**\r\n   * Optionally specify a maximum width in pixels for our text, and wrap to the next line if needed.\r\n   */\r\n  maxWidth?: number;\r\n}\r\n\r\n/**\r\n * Represent Text graphics in excalibur\r\n *\r\n * Useful for in game labels, ui, or overlays\r\n */\r\nexport class Text extends Graphic {\r\n  public color?: Color;\r\n  public maxWidth?: number;\r\n  constructor(options: TextOptions & GraphicOptions) {\r\n    super(options);\r\n    // This order is important font, color, then text\r\n    this.font = options.font ?? new Font();\r\n    this.color = options.color ?? this.color;\r\n    this.text = options.text;\r\n    this.maxWidth = options.maxWidth;\r\n  }\r\n\r\n  public clone(): Text {\r\n    return new Text({\r\n      text: this.text.slice(),\r\n      color: this.color?.clone() ?? Color.Black,\r\n      font: this.font.clone(),\r\n      maxWidth: this.maxWidth\r\n    });\r\n  }\r\n\r\n  private _text: string = '';\r\n  public get text() {\r\n    return this._text;\r\n  }\r\n\r\n  public set text(value: string) {\r\n    this._text = value;\r\n    this._calculateDimension();\r\n  }\r\n\r\n  private _font!: Font | SpriteFont;\r\n  public get font(): Font | SpriteFont {\r\n    return this._font;\r\n  }\r\n  public set font(font: Font | SpriteFont) {\r\n    this._font = font;\r\n  }\r\n\r\n  private _textWidth: number = 0;\r\n\r\n  public get width() {\r\n    if (this._textWidth === 0) {\r\n      this._calculateDimension();\r\n    }\r\n    return this._textWidth * this.scale.x;\r\n  }\r\n\r\n  private _textHeight: number = 0;\r\n  public get height() {\r\n    if (this._textHeight === 0) {\r\n      this._calculateDimension();\r\n    }\r\n    return this._textHeight * this.scale.y;\r\n  }\r\n\r\n  private _calculateDimension() {\r\n    const { width, height } = this.font.measureText(this._text, this.maxWidth);\r\n    this._textWidth = width;\r\n    this._textHeight = height;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this.font.measureText(this._text, this.maxWidth).scale(this.scale);\r\n  }\r\n\r\n  protected override _rotate(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected override _flip(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected override _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.isStale() || this.font.isStale()) {\r\n      this.font.flipHorizontal = this.flipHorizontal;\r\n      this.font.flipVertical = this.flipVertical;\r\n      this.font.rotation = this.rotation;\r\n      this.font.origin = this.origin;\r\n      this.font.opacity = this.opacity;\r\n    }\r\n    this.font.tint = this.tint;\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  protected override _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    let color = Color.Black;\r\n    if (this.font instanceof Font) {\r\n      color = this.color ?? this.font.color;\r\n    }\r\n\r\n    const { width, height } = this.font.measureText(this._text, this.maxWidth);\r\n    this._textWidth = width;\r\n    this._textHeight = height;\r\n\r\n    this.font.render(ex, this._text, color, x, y, this.maxWidth);\r\n\r\n    if (this.font.showDebug) {\r\n      ex.debug.drawRect(x - width, y - height, width * 2, height * 2);\r\n      if (this.maxWidth != null) {\r\n        ex.debug.drawRect(x, y, this.maxWidth, this.height, {\r\n          color: Color.Yellow\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { Graphic } from './Graphic';\r\nimport { HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Material } from './Context/material';\r\nimport { Logger } from '../Util/Log';\r\nimport { WatchVector } from '../Math/watch-vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { GraphicsGroup } from '../Graphics/GraphicsGroup';\r\nimport { Color } from '../Color';\r\nimport { Raster } from './Raster';\r\nimport { Text } from './Text';\r\n\r\n/**\r\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\r\n * @param graphic\r\n */\r\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\r\n  return !!(graphic as unknown as HasTick).tick;\r\n}\r\nexport interface GraphicsShowOptions {\r\n  offset?: Vector;\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsComponentOptions {\r\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPreTransformDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPostTransformDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Name of current graphic to use\r\n   */\r\n  current?: string;\r\n\r\n  /**\r\n   * Optionally set the color of the graphics component\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally set a material to use on the graphic\r\n   */\r\n  material?: Material;\r\n\r\n  /**\r\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\r\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\r\n   */\r\n  copyGraphics?: boolean;\r\n\r\n  /**\r\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\r\n   */\r\n  visible?: boolean;\r\n\r\n  /**\r\n   * Optional opacity\r\n   */\r\n  opacity?: number;\r\n\r\n  /**\r\n   * List of graphics and optionally the options per graphic\r\n   */\r\n  graphics?: { [graphicName: string]: Graphic | { graphic: Graphic; options?: GraphicsShowOptions | undefined } };\r\n\r\n  /**\r\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\r\n   */\r\n  offset?: Vector;\r\n\r\n  /**\r\n   * Optional anchor\r\n   */\r\n  anchor?: Vector;\r\n}\r\n\r\n/**\r\n * Component to manage drawings, using with the position component\r\n */\r\nexport class GraphicsComponent extends Component {\r\n  private _logger = Logger.getInstance();\r\n\r\n  private _current: string = 'default';\r\n  private _graphics: Record<string, Graphic> = {};\r\n  private _options: Record<string, GraphicsShowOptions | undefined> = {};\r\n\r\n  public material: Material | null = null;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, but before graphics component graphics have been drawn\r\n   */\r\n  public onPreDraw?: (ctx: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\r\n   */\r\n  public onPostDraw?: (ctx: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Draws before the entity transform has been applied before any any graphics component drawing\r\n   */\r\n  public onPreTransformDraw?: (ctx: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, and after all graphics component drawing\r\n   */\r\n  public onPostTransformDraw?: (ctx: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  private _color?: Color;\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   * @deprecated use isVisible\r\n   */\r\n  public get visible(): boolean {\r\n    return this.isVisible;\r\n  }\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   * @deprecated use isVisible\r\n   */\r\n  public set visible(val: boolean) {\r\n    this.isVisible = val;\r\n  }\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   */\r\n  public isVisible: boolean = true;\r\n\r\n  /**\r\n   * Optionally force the graphic onscreen, default false. Not recommend to use for perf reasons, only if you known what you're doing.\r\n   */\r\n  public forceOnScreen: boolean = false;\r\n\r\n  /**\r\n   * Sets or gets wither all drawings should have an opacity applied\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  private _offset: Vector = new WatchVector(Vector.Zero, () => this.recalculateBounds());\r\n\r\n  /**\r\n   * Offset to apply to graphics by default\r\n   */\r\n  public get offset(): Vector {\r\n    return this._offset;\r\n  }\r\n  public set offset(value: Vector) {\r\n    this._offset = new WatchVector(value, () => this.recalculateBounds());\r\n    this.recalculateBounds();\r\n  }\r\n\r\n  private _anchor: Vector = new WatchVector(Vector.Half, () => this.recalculateBounds());\r\n\r\n  /**\r\n   * Anchor to apply to graphics by default\r\n   */\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n  public set anchor(value: Vector) {\r\n    this._anchor = new WatchVector(value, () => this.recalculateBounds());\r\n    this.recalculateBounds();\r\n  }\r\n\r\n  /**\r\n   * Sets the color of the actor's current graphic\r\n   */\r\n  public get color(): Color | undefined {\r\n    return this._color;\r\n  }\r\n  public set color(v: Color | undefined) {\r\n    if (v) {\r\n      this._color = v.clone();\r\n      const currentGraphic = this.graphics.current;\r\n      if (currentGraphic instanceof Raster || currentGraphic instanceof Text) {\r\n        currentGraphic.color = this._color;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Flip all graphics horizontally along the y-axis\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  /**\r\n   * Flip all graphics vertically along the x-axis\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * If set to true graphics added to the component will be copied. This can effect performance, but is useful if you don't want\r\n   * changes to a graphic to effect all the places it is used.\r\n   */\r\n  public copyGraphics: boolean = false;\r\n\r\n  constructor(options?: GraphicsComponentOptions) {\r\n    super();\r\n    // Defaults\r\n    options = {\r\n      visible: this.isVisible,\r\n      graphics: {},\r\n      ...options\r\n    };\r\n\r\n    const {\r\n      current,\r\n      anchor,\r\n      color,\r\n      opacity,\r\n      visible,\r\n      graphics,\r\n      offset,\r\n      copyGraphics,\r\n      onPreDraw,\r\n      onPostDraw,\r\n      onPreTransformDraw,\r\n      onPostTransformDraw\r\n    } = options;\r\n\r\n    for (const [key, graphicOrOptions] of Object.entries(graphics as GraphicsComponentOptions)) {\r\n      if (graphicOrOptions instanceof Graphic) {\r\n        this._graphics[key] = graphicOrOptions;\r\n      } else {\r\n        this._graphics[key] = graphicOrOptions.graphic;\r\n        this._options[key] = graphicOrOptions.options;\r\n      }\r\n    }\r\n\r\n    this.offset = offset ?? this.offset;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.anchor = anchor ?? this.anchor;\r\n    this.color = color ?? this.color;\r\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\r\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\r\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\r\n    this.onPreDraw = onPreTransformDraw ?? this.onPreTransformDraw;\r\n    this.onPostTransformDraw = onPostTransformDraw ?? this.onPostTransformDraw;\r\n    this.isVisible = !!visible;\r\n    this._current = current ?? this._current;\r\n    if (current && this._graphics[current]) {\r\n      this.use(current);\r\n    }\r\n  }\r\n\r\n  public getGraphic(name: string): Graphic | undefined {\r\n    return this._graphics[name];\r\n  }\r\n  public getOptions(name: string): GraphicsShowOptions | undefined {\r\n    return this._options[name];\r\n  }\r\n\r\n  /**\r\n   * Get registered graphics names\r\n   */\r\n  public getNames(): string[] {\r\n    return Object.keys(this._graphics);\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed graphic\r\n   */\r\n  public get current(): Graphic | undefined {\r\n    return this._graphics[this._current];\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed graphic offsets\r\n   */\r\n  public get currentOptions(): GraphicsShowOptions | undefined {\r\n    return this._options[this._current];\r\n  }\r\n\r\n  /**\r\n   * Returns all graphics associated with this component\r\n   */\r\n  public get graphics(): { [graphicName: string]: Graphic } {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Returns all graphics options associated with this component\r\n   */\r\n  public get options(): { [graphicName: string]: GraphicsShowOptions | undefined } {\r\n    return this._options;\r\n  }\r\n\r\n  /**\r\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\r\n   * @param graphic\r\n   */\r\n  public add(graphic: Graphic, options?: GraphicsShowOptions): Graphic;\r\n  public add(name: string, graphic: Graphic, options?: GraphicsShowOptions): Graphic;\r\n  public add(nameOrGraphic: string | Graphic, graphicOrOptions?: Graphic | GraphicsShowOptions, options?: GraphicsShowOptions): Graphic {\r\n    let name = 'default';\r\n    let graphicToSet: Graphic | null = null;\r\n    let optionsToSet: GraphicsShowOptions | undefined = undefined;\r\n    if (typeof nameOrGraphic === 'string' && graphicOrOptions instanceof Graphic) {\r\n      name = nameOrGraphic;\r\n      graphicToSet = graphicOrOptions;\r\n      optionsToSet = options;\r\n    }\r\n    if (nameOrGraphic instanceof Graphic && !(graphicOrOptions instanceof Graphic)) {\r\n      graphicToSet = nameOrGraphic;\r\n      optionsToSet = graphicOrOptions;\r\n    }\r\n\r\n    if (!graphicToSet) {\r\n      throw new Error('Need to provide a graphic or valid graphic string');\r\n    }\r\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\r\n    this._options[name] = this.copyGraphics ? { ...optionsToSet } : optionsToSet;\r\n    if (name === 'default') {\r\n      this.use('default');\r\n    }\r\n    return graphicToSet;\r\n  }\r\n\r\n  /**\r\n   * Removes a registered graphic, if the removed graphic is the current it will switch to the default\r\n   * @param name\r\n   */\r\n  public remove(name: string) {\r\n    delete this._graphics[name];\r\n    delete this._options[name];\r\n    if (this._current === name) {\r\n      this._current = 'default';\r\n      this.recalculateBounds();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use a graphic only, will set the default graphic. Returns the new {@apilink Graphic}\r\n   *\r\n   * Optionally override the stored options\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    if (nameOrGraphic instanceof Graphic) {\r\n      let graphic = nameOrGraphic as Graphic;\r\n      if (this.copyGraphics) {\r\n        graphic = nameOrGraphic.clone();\r\n      }\r\n      this._current = 'default';\r\n      this._graphics[this._current] = graphic;\r\n      this._options[this._current] = options;\r\n    } else {\r\n      this._current = nameOrGraphic;\r\n      this._options[this._current] = options;\r\n      if (!(this._current in this._graphics)) {\r\n        this._logger.warn(\r\n          `Graphic ${this._current} is not registered with the graphics component owned by ${this.owner?.name}. Nothing will be drawn.`\r\n        );\r\n      }\r\n    }\r\n    this.recalculateBounds();\r\n    return this.current as T;\r\n  }\r\n\r\n  /**\r\n   * Hide currently shown graphic\r\n   */\r\n  public hide(): void {\r\n    this._current = 'ex.none';\r\n  }\r\n\r\n  private _localBounds?: BoundingBox;\r\n  public set localBounds(bounds: BoundingBox) {\r\n    this._localBounds = bounds;\r\n  }\r\n\r\n  public recalculateBounds() {\r\n    let bb = new BoundingBox();\r\n    const graphic = this._graphics[this._current];\r\n    const options = this._options[this._current];\r\n\r\n    if (!graphic) {\r\n      this._localBounds = bb;\r\n      return;\r\n    }\r\n\r\n    let anchor = this.anchor;\r\n    let offset = this.offset;\r\n    if (options?.anchor) {\r\n      anchor = options.anchor;\r\n    }\r\n    if (options?.offset) {\r\n      offset = options.offset;\r\n    }\r\n    const bounds = graphic.localBounds;\r\n    const offsetX = -bounds.width * anchor.x + offset.x;\r\n    const offsetY = -bounds.height * anchor.y + offset.y;\r\n    if (graphic instanceof GraphicsGroup && !graphic.useAnchor) {\r\n      bb = graphic?.localBounds.combine(bb);\r\n    } else {\r\n      bb = graphic?.localBounds.translate(vec(offsetX, offsetY)).combine(bb);\r\n    }\r\n    this._localBounds = bb;\r\n  }\r\n\r\n  /**\r\n   * Get local bounds of graphics component\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    if (!this._localBounds || this._localBounds.hasZeroDimensions()) {\r\n      this.recalculateBounds();\r\n    }\r\n    return this._localBounds as BoundingBox; // recalc guarantees type\r\n  }\r\n\r\n  /**\r\n   * Get world bounds of graphics component\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    let bounds = this.localBounds;\r\n    if (this.owner) {\r\n      const tx = this.owner.get(TransformComponent);\r\n      if (tx) {\r\n        bounds = bounds.transform(tx.get().matrix);\r\n      }\r\n    }\r\n    return bounds;\r\n  }\r\n\r\n  /**\r\n   * Update underlying graphics if necessary, called internally\r\n   * @param elapsed\r\n   * @internal\r\n   */\r\n  public update(elapsed: number, idempotencyToken: number = 0) {\r\n    const graphic = this.current;\r\n    if (graphic && hasGraphicsTick(graphic)) {\r\n      graphic.tick(elapsed, idempotencyToken);\r\n    }\r\n  }\r\n\r\n  public clone(): GraphicsComponent {\r\n    const graphics = new GraphicsComponent();\r\n    graphics._graphics = { ...this._graphics };\r\n    graphics._options = { ...this._options };\r\n    graphics.offset = this.offset.clone();\r\n    if (this.color) {\r\n      graphics.color = this.color.clone();\r\n    }\r\n    graphics.opacity = this.opacity;\r\n    graphics.anchor = this.anchor.clone();\r\n    graphics.copyGraphics = this.copyGraphics;\r\n    graphics.onPreDraw = this.onPreDraw;\r\n    graphics.onPostDraw = this.onPostDraw;\r\n    graphics.isVisible = this.isVisible;\r\n\r\n    return graphics;\r\n  }\r\n}\r\n","import { Component, ComponentCtor, isComponentCtor } from './Component';\r\n\r\nimport { Observable, Message } from '../Util/Observable';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate, OnAdd, OnRemove } from '../Interfaces/LifecycleEvents';\r\nimport { Engine } from '../Engine';\r\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent, AddEvent, RemoveEvent } from '../Events';\r\nimport { KillEvent } from '../Events';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\nimport { Scene } from '../Scene';\r\nimport { removeItemFromArray } from '../Util/Util';\r\nimport { MaybeKnownComponent } from './Types';\r\nimport { Logger } from '../Util/Log';\r\n\r\n/**\r\n * Interface holding an entity component pair\r\n */\r\nexport interface EntityComponent {\r\n  component: Component;\r\n  entity: Entity;\r\n}\r\n\r\n/**\r\n * AddedComponent message\r\n */\r\nexport class AddedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Added' = 'Component Added';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is f an Added Component\r\n */\r\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\r\n  return !!x && x.type === 'Component Added';\r\n}\r\n\r\n/**\r\n * RemovedComponent message\r\n */\r\nexport class RemovedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Removed' = 'Component Removed';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is for a Removed Component\r\n */\r\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\r\n  return !!x && x.type === 'Component Removed';\r\n}\r\n\r\n/**\r\n * Built in events supported by all entities\r\n */\r\nexport type EntityEvents = {\r\n  initialize: InitializeEvent;\r\n  //@ts-ignore\r\n  add: AddEvent;\r\n  //@ts-ignore\r\n  remove: RemoveEvent;\r\n  preupdate: PreUpdateEvent;\r\n  postupdate: PostUpdateEvent;\r\n  kill: KillEvent;\r\n};\r\n\r\nexport const EntityEvents = {\r\n  Add: 'add',\r\n  Remove: 'remove',\r\n  Initialize: 'initialize',\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate',\r\n  Kill: 'kill'\r\n} as const;\r\n\r\nexport interface EntityOptions<TComponents extends Component> {\r\n  name?: string;\r\n  components?: TComponents[];\r\n  silenceWarnings?: boolean;\r\n}\r\n\r\n/**\r\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\r\n *\r\n * Entities can be strongly typed with the components they contain\r\n *\r\n * ```typescript\r\n * const entity = new Entity<ComponentA | ComponentB>();\r\n * entity.components.a; // Type ComponentA\r\n * entity.components.b; // Type ComponentB\r\n * ```\r\n */\r\nexport class Entity<TKnownComponents extends Component = any> implements OnInitialize, OnPreUpdate, OnPostUpdate, OnAdd, OnRemove {\r\n  private static _ID = 0;\r\n  /**\r\n   * The unique identifier for the entity\r\n   */\r\n  public id: number = Entity._ID++;\r\n\r\n  public name = `Entity#${this.id}`;\r\n\r\n  /**\r\n   * Listen to or emit events for an entity\r\n   */\r\n  public events = new EventEmitter<EntityEvents>();\r\n  private _tags = new Set<string>();\r\n  public componentAdded$ = new Observable<Component>();\r\n  public componentRemoved$ = new Observable<Component>();\r\n  public tagAdded$ = new Observable<string>();\r\n  public tagRemoved$ = new Observable<string>();\r\n  /**\r\n   * Current components on the entity\r\n   *\r\n   * **Do not modify**\r\n   *\r\n   * Use addComponent/removeComponent otherwise the ECS will not be notified of changes.\r\n   */\r\n  public readonly components = new Map<Function, Component>();\r\n  public componentValues: Component[] = [];\r\n  private _componentsToRemove: ComponentCtor[] = [];\r\n\r\n  constructor(options: EntityOptions<TKnownComponents>);\r\n  constructor(components?: TKnownComponents[], name?: string);\r\n  constructor(componentsOrOptions?: TKnownComponents[] | EntityOptions<TKnownComponents>, name?: string) {\r\n    let componentsToAdd!: TKnownComponents[];\r\n    let nameToAdd: string | undefined;\r\n    let silence = false;\r\n    if (Array.isArray(componentsOrOptions)) {\r\n      componentsToAdd = componentsOrOptions;\r\n      nameToAdd = name;\r\n    } else if (componentsOrOptions && typeof componentsOrOptions === 'object') {\r\n      const { components, name, silenceWarnings } = componentsOrOptions;\r\n      componentsToAdd = components ?? [];\r\n      nameToAdd = name;\r\n      silence = !!silenceWarnings;\r\n    }\r\n    if (nameToAdd) {\r\n      this.name = nameToAdd;\r\n    }\r\n    if (componentsToAdd) {\r\n      for (const component of componentsToAdd) {\r\n        this.addComponent(component);\r\n      }\r\n    }\r\n\r\n    if (process.env.NODE_ENV === 'development') {\r\n      if (!silence) {\r\n        setTimeout(() => {\r\n          if (!this.scene && !this.isInitialized) {\r\n            Logger.getInstance().warn(`Entity \"${this.name || this.id}\" was not added to a scene.`);\r\n          }\r\n        }, 5000);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The current scene that the entity is in, if any\r\n   */\r\n  public scene: Scene | null = null;\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   * @deprecated use isActive\r\n   */\r\n  public get active(): boolean {\r\n    return this.isActive;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   * @deprecated use isActive\r\n   */\r\n  public set active(val: boolean) {\r\n    this.isActive = val;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   */\r\n  public isActive: boolean = true;\r\n\r\n  /**\r\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\r\n   * If parented it will be removed from the parent when killed.\r\n   */\r\n  public kill() {\r\n    if (this.isActive) {\r\n      this.isActive = false;\r\n      this.unparent();\r\n    }\r\n    this.emit('kill', new KillEvent(this));\r\n  }\r\n\r\n  public isKilled() {\r\n    return !this.isActive;\r\n  }\r\n\r\n  /**\r\n   * Specifically get the tags on the entity from {@apilink TagsComponent}\r\n   */\r\n  public get tags(): Set<string> {\r\n    return this._tags;\r\n  }\r\n\r\n  /**\r\n   * Check if a tag exists on the entity\r\n   * @param tag name to check for\r\n   */\r\n  public hasTag(tag: string): boolean {\r\n    return this._tags.has(tag);\r\n  }\r\n\r\n  /**\r\n   * Adds a tag to an entity\r\n   * @param tag\r\n   */\r\n  public addTag(tag: string): Entity<TKnownComponents> {\r\n    this._tags.add(tag);\r\n    this.tagAdded$.notifyAll(tag);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes a tag on the entity\r\n   *\r\n   * Removals are deferred until the end of update\r\n   * @param tag\r\n   */\r\n  public removeTag(tag: string): Entity<TKnownComponents> {\r\n    this._tags.delete(tag);\r\n    this.tagRemoved$.notifyAll(tag);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * The types of the components on the Entity\r\n   */\r\n  public get types(): ComponentCtor[] {\r\n    return Array.from(this.components.keys()) as ComponentCtor[];\r\n  }\r\n\r\n  /**\r\n   * Returns all component instances on entity\r\n   */\r\n  public getComponents(): Component[] {\r\n    return Array.from(this.components.values());\r\n  }\r\n\r\n  /**\r\n   * Verifies that an entity has all the required types\r\n   * @param requiredTypes\r\n   */\r\n  hasAll<TComponent extends Component>(requiredTypes: ComponentCtor<TComponent>[]): boolean {\r\n    for (let i = 0; i < requiredTypes.length; i++) {\r\n      if (!this.components.has(requiredTypes[i])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Verifies that an entity has all the required tags\r\n   * @param requiredTags\r\n   */\r\n  hasAllTags(requiredTags: string[]): boolean {\r\n    for (let i = 0; i < requiredTags.length; i++) {\r\n      if (!this.tags.has(requiredTags[i])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get<TComponent extends Component>(type: ComponentCtor<TComponent>): MaybeKnownComponent<TComponent, TKnownComponents> {\r\n    return this.components.get(type) as MaybeKnownComponent<TComponent, TKnownComponents>;\r\n  }\r\n\r\n  private _parent: Entity | null = null;\r\n  public get parent(): Entity | null {\r\n    return this._parent;\r\n  }\r\n\r\n  public childrenAdded$ = new Observable<Entity>();\r\n  public childrenRemoved$ = new Observable<Entity>();\r\n\r\n  private _children: Entity[] = [];\r\n  /**\r\n   * Get the direct children of this entity\r\n   */\r\n  public get children(): readonly Entity[] {\r\n    return this._children;\r\n  }\r\n\r\n  /**\r\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\r\n   */\r\n  public unparent() {\r\n    if (this._parent) {\r\n      this._parent.removeChild(this);\r\n      this._parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be a child of this entity\r\n   * @param entity\r\n   */\r\n  public addChild(entity: Entity): Entity {\r\n    if (entity.parent === null) {\r\n      if (this.getAncestors().includes(entity)) {\r\n        throw new Error('Cycle detected, cannot add entity');\r\n      }\r\n      this._children.push(entity);\r\n      entity._parent = this;\r\n      this.childrenAdded$.notifyAll(entity);\r\n    } else {\r\n      throw new Error('Entity already has a parent, cannot add without unparenting');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from children if it exists\r\n   * @param entity\r\n   */\r\n  public removeChild(entity: Entity): Entity {\r\n    if (entity.parent === this) {\r\n      removeItemFromArray(entity, this._children);\r\n      entity._parent = null;\r\n      this.childrenRemoved$.notifyAll(entity);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes all children from this entity\r\n   */\r\n  public removeAllChildren(): Entity {\r\n    // Avoid modifying the array issue by walking backwards\r\n    for (let i = this.children.length - 1; i >= 0; i--) {\r\n      this.removeChild(this.children[i]);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\r\n   */\r\n  public getAncestors(): Entity[] {\r\n    const result: Entity[] = [this];\r\n    let current = this.parent;\r\n    while (current) {\r\n      result.push(current);\r\n      current = current.parent;\r\n    }\r\n    return result.reverse();\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\r\n   */\r\n  public getDescendants(): Entity[] {\r\n    let result: Entity[] = [this];\r\n    let queue: Entity[] = [this];\r\n    while (queue.length > 0) {\r\n      const curr = queue.pop();\r\n      if (curr) {\r\n        queue = queue.concat(curr.children);\r\n        result = result.concat(curr.children);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates a deep copy of the entity and a copy of all its components\r\n   */\r\n  public clone(): Entity {\r\n    const newEntity = new Entity();\r\n    for (const c of this.types) {\r\n      const componentInstance = this.get(c);\r\n      if (componentInstance) {\r\n        newEntity.addComponent(componentInstance.clone());\r\n      }\r\n    }\r\n    for (const child of this.children) {\r\n      newEntity.addChild(child.clone());\r\n    }\r\n    return newEntity;\r\n  }\r\n\r\n  /**\r\n   * Adds a copy of all the components from another template entity as a \"prefab\"\r\n   * @param templateEntity Entity to use as a template\r\n   * @param force Force component replacement if it already exists on the target entity\r\n   */\r\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\r\n    for (const c of templateEntity.getComponents()) {\r\n      this.addComponent(c.clone(), force);\r\n    }\r\n    for (const child of templateEntity.children) {\r\n      this.addChild(child.clone().addTemplate(child));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  private _getClassHierarchyRoot(componentType: ComponentCtor): ComponentCtor {\r\n    let current = componentType;\r\n    let parent = Object.getPrototypeOf(current.prototype)?.constructor;\r\n\r\n    while (parent && parent !== Object && parent !== Component) {\r\n      current = parent;\r\n      parent = Object.getPrototypeOf(current.prototype)?.constructor;\r\n    }\r\n    return current;\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the entity\r\n   * @param component Component or Entity to add copy of components from\r\n   * @param force Optionally overwrite any existing components of the same type\r\n   */\r\n  public addComponent<TComponent extends Component>(component: TComponent, force: boolean = false): Entity<TKnownComponents | TComponent> {\r\n    // if component already exists, skip if not forced\r\n    if (this.has(component.constructor as ComponentCtor)) {\r\n      if (force) {\r\n        // Remove existing component type if exists when forced\r\n        this.removeComponent(component.constructor as ComponentCtor, true);\r\n      } else {\r\n        // early exit component exits\r\n        return this as Entity<TKnownComponents | TComponent>;\r\n      }\r\n    }\r\n\r\n    // TODO circular dependencies will be a problem\r\n    if (component.dependencies && component.dependencies.length) {\r\n      for (const ctor of component.dependencies) {\r\n        this.addComponent(new ctor());\r\n      }\r\n    }\r\n\r\n    component.owner = this;\r\n    const rootComponent = this._getClassHierarchyRoot(component.constructor as ComponentCtor);\r\n    this.components.set(rootComponent, component);\r\n    this.components.set(component.constructor, component);\r\n    this.componentValues.push(component);\r\n    if (component.onAdd) {\r\n      component.onAdd(this);\r\n    }\r\n\r\n    this.componentAdded$.notifyAll(component);\r\n    return this as Entity<TKnownComponents | TComponent>;\r\n  }\r\n\r\n  /**\r\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\r\n   *\r\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\r\n   * @param typeOrInstance\r\n   * @param force\r\n   */\r\n  public removeComponent<TComponent extends Component>(\r\n    typeOrInstance: ComponentCtor<TComponent> | TComponent,\r\n    force = false\r\n  ): Entity<Exclude<TKnownComponents, TComponent>> {\r\n    let type: ComponentCtor<TComponent>;\r\n    if (isComponentCtor(typeOrInstance)) {\r\n      type = typeOrInstance;\r\n    } else {\r\n      type = typeOrInstance.constructor as ComponentCtor<TComponent>;\r\n    }\r\n\r\n    if (force) {\r\n      const componentToRemove = this.components.get(type);\r\n      if (componentToRemove) {\r\n        this.componentRemoved$.notifyAll(componentToRemove);\r\n        componentToRemove.owner = undefined;\r\n        if (componentToRemove.onRemove) {\r\n          componentToRemove.onRemove(this);\r\n        }\r\n        const componentIndex = this.componentValues.indexOf(componentToRemove);\r\n        if (componentIndex > -1) {\r\n          this.componentValues.splice(componentIndex, 1);\r\n        }\r\n      }\r\n\r\n      const rootComponent = this._getClassHierarchyRoot(type);\r\n      this.components.delete(rootComponent);\r\n      this.components.delete(type); // remove after the notify to preserve typing\r\n    } else {\r\n      this._componentsToRemove.push(type);\r\n    }\r\n\r\n    return this as any;\r\n  }\r\n\r\n  public clearComponents() {\r\n    const components = this.types;\r\n    for (const c of components) {\r\n      this.removeComponent(c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @hidden\r\n   * @internal\r\n   */\r\n  public processComponentRemoval() {\r\n    for (const type of this._componentsToRemove) {\r\n      this.removeComponent(type, true);\r\n    }\r\n    this._componentsToRemove.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Check if a component type exists\r\n   * @param type\r\n   */\r\n  public has<TComponent extends Component>(type: ComponentCtor<TComponent>): boolean {\r\n    return this.components.has(type);\r\n  }\r\n\r\n  private _isInitialized = false;\r\n  private _isAdded = false;\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public get isAdded(): boolean {\r\n    return this._isAdded;\r\n  }\r\n\r\n  /**\r\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      this.events.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds this Actor, meant to be called by the Scene when Actor is added.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   * @internal\r\n   */\r\n  public _add(engine: Engine) {\r\n    if (!this.isAdded && this.isActive) {\r\n      this.onAdd(engine);\r\n      this.events.emit('add', new AddEvent(engine, this));\r\n      this._isAdded = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes Actor, meant to be called by the Scene when Actor is added.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   * @internal\r\n   */\r\n  public _remove(engine: Engine) {\r\n    if (this.isAdded && !this.isActive) {\r\n      this.onRemove(engine);\r\n      this.events.emit('remove', new RemoveEvent(engine, this));\r\n      this._isAdded = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n    this.onPreUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n    this.onPostUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * `onAdd` is called when Actor is added to scene. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('add', (evt) => {...})`\r\n   */\r\n  public onAdd(engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * `onRemove` is called when Actor is added to scene. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('remove', (evt) => {...})`\r\n   */\r\n  public onRemove(engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an entity is updated.\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an entity is updated.\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Entity update lifecycle, called internally\r\n   * @internal\r\n   * @param engine\r\n   * @param elapsed\r\n   */\r\n  public update(engine: Engine, elapsed: number): void {\r\n    this._initialize(engine);\r\n    this._add(engine);\r\n    this._preupdate(engine, elapsed);\r\n    for (const child of this.children) {\r\n      child.update(engine, elapsed);\r\n    }\r\n    this._postupdate(engine, elapsed);\r\n    this._remove(engine);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<EntityEvents>>(eventName: TEventName, event: EntityEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<EntityEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<EntityEvents>>(eventName: TEventName, handler: Handler<EntityEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<EntityEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<EntityEvents>>(eventName: TEventName, handler: Handler<EntityEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<EntityEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<EntityEvents>>(eventName: TEventName, handler: Handler<EntityEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<EntityEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    if (handler) {\r\n      this.events.off(eventName, handler);\r\n    } else {\r\n      this.events.off(eventName);\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Component } from '../Component';\r\n\r\nexport interface Motion {\r\n  /**\r\n   * The velocity of an entity in pixels per second\r\n   */\r\n  vel: Vector;\r\n\r\n  /**\r\n   * The acceleration of entity in pixels per second^2\r\n   */\r\n  acc: Vector;\r\n\r\n  /**\r\n   * The scale rate of change in scale units per second\r\n   */\r\n  scaleFactor: Vector;\r\n\r\n  /**\r\n   * The angular velocity which is how quickly the entity is rotating in radians per second\r\n   */\r\n  angularVelocity: number;\r\n\r\n  /**\r\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\r\n   */\r\n  torque: number;\r\n\r\n  /**\r\n   * Inertia can be thought of as the resistance to motion\r\n   */\r\n  inertia: number;\r\n}\r\n\r\nexport class MotionComponent extends Component {\r\n  /**\r\n   * The velocity of an entity in pixels per second\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The acceleration of entity in pixels per second^2\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The scale rate of change in scale units per second\r\n   */\r\n  public scaleFactor: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The angular velocity which is how quickly the entity is rotating in radians per second\r\n   */\r\n  public angularVelocity = 0;\r\n\r\n  /**\r\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\r\n   */\r\n  public torque: number = 0;\r\n\r\n  /**\r\n   * Inertia can be thought of as the resistance to motion\r\n   */\r\n  public inertia: number = 1;\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\n\nexport class EulerIntegrator {\n  // Scratch vectors to avoid allocation\n  private static _POS = new Vector(0, 0);\n  private static _SCALE = new Vector(1, 1);\n\n  private static _ACC = new Vector(0, 0);\n  private static _VEL = new Vector(0, 0);\n  private static _VEL_ACC = new Vector(0, 0);\n  private static _SCALE_FACTOR = new Vector(0, 0);\n\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsed: number): void {\n    const seconds = elapsed / 1000;\n    // This code looks a little wild, but it's to avoid creating any new Vector instances\n    // integration is done in a tight loop so this is key to avoid GC'ing\n    motion.vel.addEqual(totalAcc.scale(seconds, EulerIntegrator._ACC));\n    transform.pos\n      .add(motion.vel.scale(seconds, EulerIntegrator._VEL), EulerIntegrator._POS)\n      .addEqual(totalAcc.scale(0.5 * seconds * seconds, EulerIntegrator._VEL_ACC));\n\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n    const rotation = transform.rotation + motion.angularVelocity * seconds;\n\n    transform.scale.add(motion.scaleFactor.scale(seconds, this._SCALE_FACTOR), EulerIntegrator._SCALE);\n    const tx = transform.get();\n    tx.setTransform(EulerIntegrator._POS, rotation, EulerIntegrator._SCALE);\n  }\n}\n","import { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Random } from '../Math/Random';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { clamp } from '../Math/util';\r\nimport { Graphic } from '../Graphics';\r\nimport { EmitterType } from './EmitterType';\r\nimport { MotionComponent } from '../EntityComponentSystem';\r\nimport { EulerIntegrator } from '../Collision/Integrator';\r\nimport type { ParticleEmitter } from './ParticleEmitter';\r\n\r\n/**\r\n/**\r\n * CPU Particle is used in a {@apilink ParticleEmitter}\r\n */\r\nexport class Particle extends Entity {\r\n  public static DefaultConfig: ParticleConfig = {\r\n    beginColor: Color.White,\r\n    endColor: Color.White,\r\n    life: 300,\r\n    fade: false,\r\n    size: 5,\r\n    graphic: undefined,\r\n    startSize: undefined,\r\n    endSize: undefined\r\n  };\r\n\r\n  public focus?: Vector;\r\n  public focusAccel?: number;\r\n  public beginColor: Color = Color.White;\r\n  public endColor: Color = Color.White;\r\n\r\n  // Life is counted in ms\r\n  public life: number = 300;\r\n  public fade: boolean = false;\r\n\r\n  // Color transitions\r\n  private _rRate: number = 1;\r\n  private _gRate: number = 1;\r\n  private _bRate: number = 1;\r\n  private _aRate: number = 0;\r\n  private _currentColor: Color = Color.White;\r\n\r\n  public size: number = 5;\r\n  public graphic?: Graphic;\r\n\r\n  public startSize?: number;\r\n  public endSize?: number;\r\n  public sizeRate: number = 0;\r\n\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n\r\n  public transform: TransformComponent;\r\n  public motion: MotionComponent;\r\n  public graphics: GraphicsComponent;\r\n  public particleTransform = ParticleTransform.Global;\r\n\r\n  public name = `Particle#${this.id}`;\r\n\r\n  constructor(options: ParticleConfig) {\r\n    super({ silenceWarnings: true });\r\n    this.addComponent((this.transform = new TransformComponent()));\r\n    this.addComponent((this.motion = new MotionComponent()));\r\n    this.addComponent((this.graphics = new GraphicsComponent()));\r\n    this.configure(options);\r\n  }\r\n\r\n  private _emitter?: ParticleEmitter;\r\n  registerEmitter(emitter: ParticleEmitter) {\r\n    this._emitter = emitter;\r\n    if (this.particleTransform === ParticleTransform.Global) {\r\n      const globalPos = this._emitter.transform.globalPos;\r\n      this.transform.pos = this.transform.pos.add(globalPos);\r\n      this.motion.vel = this.motion.vel.rotate(this._emitter.transform.globalRotation);\r\n    }\r\n  }\r\n\r\n  configure(options: ParticleConfig) {\r\n    this.particleTransform = options.transform ?? this.particleTransform;\r\n    this.life = options.life ?? this.life;\r\n    this.fade = options.fade ?? this.fade;\r\n    this.size = options.size ?? this.size;\r\n    this.endColor = options.endColor ?? this.endColor.clone();\r\n    this.beginColor = options.beginColor ?? this.beginColor.clone();\r\n    this._currentColor = this.beginColor.clone();\r\n\r\n    this.graphic = options.graphic;\r\n    this.graphics.opacity = options.opacity ?? this.graphics.opacity;\r\n    this.transform.pos = options.pos ?? this.transform.pos;\r\n    this.transform.rotation = options.rotation ?? 0;\r\n    this.transform.scale = vec(1, 1);\r\n\r\n    this.motion.vel = options.vel ?? this.motion.vel;\r\n    this.motion.angularVelocity = options.angularVelocity ?? 0;\r\n    this.motion.acc = options.acc ?? this.motion.acc;\r\n\r\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\r\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\r\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\r\n    this._aRate = this.graphics.opacity / this.life;\r\n\r\n    this.startSize = options.startSize ?? 0;\r\n    this.endSize = options.endSize ?? 0;\r\n\r\n    if (this.endSize > 0 && this.startSize > 0) {\r\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\r\n      this.size = this.startSize;\r\n    }\r\n    if (this.graphic) {\r\n      this.graphics.use(this.graphic);\r\n      this.graphics.onPostDraw = undefined;\r\n    } else {\r\n      this.graphics.localBounds = BoundingBox.fromDimension(this.size, this.size, Vector.Half);\r\n      this.graphics.onPostDraw = (ctx) => {\r\n        ctx.save();\r\n        ctx.debug.drawPoint(vec(0, 0), { color: this._currentColor, size: this.size });\r\n        ctx.restore();\r\n      };\r\n    }\r\n  }\r\n\r\n  public override kill() {\r\n    if (this._emitter?.isActive) {\r\n      this._emitter.removeParticle(this);\r\n    } else {\r\n      super.kill();\r\n    }\r\n  }\r\n\r\n  public update(engine: Engine, elapsed: number) {\r\n    this.life = this.life - elapsed;\r\n\r\n    if (this.life < 0) {\r\n      this.kill();\r\n    }\r\n\r\n    if (this.fade) {\r\n      this.graphics.opacity = clamp(this._aRate * this.life, 0.0001, 1);\r\n    }\r\n\r\n    if (this.startSize && this.endSize && this.startSize > 0 && this.endSize > 0) {\r\n      this.size = clamp(\r\n        this.sizeRate * elapsed + this.size,\r\n        Math.min(this.startSize, this.endSize),\r\n        Math.max(this.startSize, this.endSize)\r\n      );\r\n    }\r\n\r\n    this._currentColor.r = clamp(this._currentColor.r + this._rRate * elapsed, 0, 255);\r\n    this._currentColor.g = clamp(this._currentColor.g + this._gRate * elapsed, 0, 255);\r\n    this._currentColor.b = clamp(this._currentColor.b + this._bRate * elapsed, 0, 255);\r\n    this._currentColor.a = this.graphics.opacity;\r\n\r\n    let accel = this.motion.acc;\r\n    if (this.focus) {\r\n      accel = this.focus\r\n        .sub(this.transform.pos)\r\n        .normalize()\r\n        .scale(this.focusAccel || 0)\r\n        .scale(elapsed / 1000);\r\n    }\r\n    // Update transform and motion based on Euler linear algebra\r\n    EulerIntegrator.integrate(this.transform, this.motion, accel, elapsed);\r\n  }\r\n}\r\n\r\nexport interface ParticleConfig {\r\n  /**\r\n   * Optionally set the emitted particle transform style, {@apilink ParticleTransform.Global} is the default and emits particles as if\r\n   * they were world space objects, useful for most effects.\r\n   *\r\n   * If set to {@apilink ParticleTransform.Local} particles are children of the emitter and move relative to the emitter\r\n   * as they would in a parent/child actor relationship.\r\n   */\r\n  transform?: ParticleTransform;\r\n  /**\r\n   * Starting position of the particle\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Starting velocity of the particle\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Starting acceleration of the particle\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Starting angular velocity of the particle\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Starting rotation of the particle\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Size of the particle in pixels\r\n   */\r\n  size?: number;\r\n  /**\r\n   * Optionally set a graphic\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Totally life of the particle in milliseconds\r\n   */\r\n  life?: number;\r\n  /**\r\n   * Starting opacity of the particle\r\n   */\r\n  opacity?: number;\r\n  /**\r\n   * Should the particle fade out to fully transparent over their life\r\n   */\r\n  fade?: boolean;\r\n\r\n  /**\r\n   * Ending color of the particle over its life\r\n   */\r\n  endColor?: Color;\r\n  /**\r\n   * Beginning color of the particle over its life\r\n   */\r\n  beginColor?: Color;\r\n\r\n  /**\r\n   * Set the start size when you want to change particle size over their life\r\n   */\r\n  startSize?: number;\r\n  /**\r\n   * Set the end size when you want to change particle size over their life\r\n   */\r\n  endSize?: number;\r\n\r\n  /**\r\n   * Smallest possible starting size of the particle\r\n   */\r\n  minSize?: number;\r\n  /**\r\n   * Largest possible starting size of the particle\r\n   */\r\n  maxSize?: number;\r\n  /**\r\n   * Minimum magnitude of the particle starting speed\r\n   */\r\n  minSpeed?: number;\r\n  /**\r\n   * Maximum magnitude of the particle starting speed\r\n   */\r\n  maxSpeed?: number;\r\n  /**\r\n   * Minimum angle to use for the particles starting rotation\r\n   */\r\n  minAngle?: number;\r\n  /**\r\n   * Maximum angle to use for the particles starting rotation\r\n   */\r\n  maxAngle?: number;\r\n\r\n  /**\r\n   * Gets or sets the optional focus where all particles should accelerate towards\r\n   *\r\n   * If the particle transform is global the focus is in world space, otherwise it is relative to the emitter\r\n   */\r\n  focus?: Vector;\r\n  /**\r\n   * Gets or sets the optional acceleration for focusing particles if a focus has been specified\r\n   */\r\n  focusAccel?: number;\r\n\r\n  /**\r\n   * Indicates whether particles should start with a random rotation\r\n   */\r\n  randomRotation?: boolean;\r\n}\r\n\r\nexport enum ParticleTransform {\r\n  /**\r\n   * {@apilink ParticleTransform.Global} is the default and emits particles as if\r\n   * they were world space objects, useful for most effects.\r\n   */\r\n  Global = 'global',\r\n  /**\r\n   * {@apilink ParticleTransform.Local} particles are children of the emitter and move relative to the emitter\r\n   * as they would in a parent/child actor relationship.\r\n   */\r\n  Local = 'local'\r\n}\r\n\r\nexport interface ParticleEmitterArgs {\r\n  particle?: ParticleConfig;\r\n  x?: number;\r\n  y?: number;\r\n  z?: number;\r\n  pos?: Vector;\r\n  width?: number;\r\n  height?: number;\r\n  /**\r\n   * Is emitting currently\r\n   */\r\n  isEmitting?: boolean;\r\n  /**\r\n   * Particles per second\r\n   */\r\n  emitRate?: number;\r\n  focus?: Vector;\r\n  focusAccel?: number;\r\n  /**\r\n   * Emitter shape\r\n   */\r\n  emitterType?: EmitterType;\r\n  /**\r\n   * Radius of the emitter if the emitter type is EmitterType.Circle\r\n   */\r\n  radius?: number;\r\n  random?: Random;\r\n}\r\n","import { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport particleVertexSource from './particle-vertex.glsl';\r\nimport particleFragmentSource from './particle-fragment.glsl';\r\nimport { GpuParticleRenderer } from '../../../Particles/GpuParticleRenderer';\r\nimport { vec } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ImageSourceAttributeConstants } from '../../ImageSource';\r\nimport { parseImageWrapping } from '../../Wrapping';\r\nimport { parseImageFiltering } from '../../Filtering';\r\nimport { ParticleTransform } from '../../../Particles/Particles';\r\n\r\nexport class ParticleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.particle' as const;\r\n  public priority: number = 0;\r\n  private _gl!: WebGL2RenderingContext;\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _shader!: Shader;\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: particleVertexSource,\r\n      fragmentSource: particleFragmentSource,\r\n      onPreLink: (program) => {\r\n        gl.transformFeedbackVaryings(\r\n          program,\r\n          ['finalPosition', 'finalVelocity', 'finalRotation', 'finalAngularVelocity', 'finalLifeMs'],\r\n          gl.INTERLEAVED_ATTRIBS\r\n        );\r\n      }\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n  }\r\n\r\n  private _getTexture(image: HTMLImageSource) {\r\n    const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = image.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._context.textureLoader.load(\r\n      image,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    )!;\r\n    // remove force attribute after upload\r\n    image.removeAttribute('forceUpload');\r\n    return texture;\r\n  }\r\n\r\n  draw(renderer: GpuParticleRenderer, elapsed: number): void {\r\n    const gl = this._gl;\r\n\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n    const transform =\r\n      renderer.particle.transform === ParticleTransform.Local\r\n        ? this._context.getTransform()\r\n        : this._context.getTransform().multiply(renderer.emitter.transform.get().inverse);\r\n    this._shader.setUniformAffineMatrix('u_transform', transform);\r\n    this._shader.setUniformBoolean('fade', renderer.particle.fade ? true : false);\r\n    this._shader.setUniformBoolean('useTexture', renderer.particle.graphic ? true : false);\r\n    this._shader.setUniformFloat('maxLifeMs', renderer.particle.life ?? 2000);\r\n    this._shader.setUniformFloat('deltaMs', elapsed);\r\n    this._shader.setUniformFloatVector('gravity', renderer.particle.acc ?? vec(0, 0));\r\n    this._shader.setUniformFloatColor('beginColor', renderer.particle.beginColor ?? Color.Transparent);\r\n    this._shader.setUniformFloatColor('endColor', renderer.particle.endColor ?? Color.Transparent);\r\n\r\n    let startSize = renderer.particle.startSize ?? 0;\r\n    let endSize = renderer.particle.endSize ?? 0;\r\n    const size = renderer.particle.size ?? 0;\r\n    if (size > 0) {\r\n      startSize = size;\r\n      endSize = size;\r\n    }\r\n\r\n    this._shader.setUniformFloat('startSize', startSize ?? 10);\r\n    this._shader.setUniformFloat('endSize', endSize ?? 10);\r\n    this._shader.setUniformFloat('startOpacity', renderer.particle.opacity ?? 1);\r\n\r\n    if (renderer.particle.focus) {\r\n      this._shader.setUniformFloatVector('focus', renderer.particle.focus);\r\n      this._shader.setUniformFloat('focusAccel', renderer.particle.focusAccel ?? 0);\r\n    }\r\n\r\n    // Particle Graphic (only Sprites right now)\r\n    if (renderer.particle.graphic) {\r\n      const graphic = renderer.particle.graphic;\r\n\r\n      const texture = this._getTexture(graphic.image.image);\r\n\r\n      gl.activeTexture(gl.TEXTURE0);\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      this._shader.setUniformInt('graphic', 0);\r\n    }\r\n\r\n    // Collision Mask\r\n    // gl.activeTexture(gl.TEXTURE0 + 1);\r\n    // gl.bindTexture(gl.TEXTURE_2D, obstacleTex);\r\n    // gl.uniform1i(u_obstacle, 1);\r\n\r\n    renderer.draw(gl);\r\n  }\r\n  hasPendingDraws(): boolean {\r\n    return false;\r\n  }\r\n  flush(): void {\r\n    // pass\r\n  }\r\n  dispose(): void {\r\n    // pass\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\nuniform float deltaMs;\\r\\nuniform float maxLifeMs;\\r\\nuniform vec2 gravity;\\r\\nuniform vec2 focus;\\r\\nuniform float focusAccel;\\r\\nuniform mat4 u_matrix;\\r\\nuniform mat4 u_transform;\\r\\nuniform float startSize;\\r\\nuniform float endSize;\\r\\n// uniform sampler2D obstacle;\\r\\n\\r\\nlayout(location=0)in vec2 position;\\r\\nlayout(location=1)in vec2 velocity;\\r\\nlayout(location=2)in float rotation;\\r\\nlayout(location=3)in float angularVelocity;\\r\\nlayout(location=4)in float lifeMs;\\r\\n\\r\\n// TODO z index to handle buffer wrapping?\\r\\n\\r\\n// DO NOT RE-ORDER\\r\\nout vec2 finalPosition;\\r\\nout vec2 finalVelocity;\\r\\nout float finalRotation;\\r\\nout float finalAngularVelocity;\\r\\nout float finalLifeMs;\\r\\nvoid main(){\\r\\n  // Evolve particle\\r\\n  float seconds = deltaMs / 1000.;\\r\\n  // euler integration\\r\\n  // Weird artifact of re-using the same buffer layout for update/draw\\r\\n  // we need differently named variables\\r\\n  vec2 finalGravity = gravity + normalize(focus - position) * focusAccel;\\r\\n  finalVelocity = velocity + finalGravity * seconds;\\r\\n  finalPosition = position + velocity * seconds + finalGravity * .5 * seconds * seconds;\\r\\n  finalRotation = rotation + angularVelocity * seconds;\\r\\n  finalAngularVelocity = angularVelocity;\\r\\n  finalLifeMs = clamp(lifeMs - deltaMs, 0., maxLifeMs);\\r\\n\\r\\n  // Collision mask sampling\\r\\n  // vec2 samplePoint = finalPosition / vec2(width, height);\\r\\n  // vec4 collides = texture(obstacle, samplePoint);\\r\\n  // if (distance(collides,vec4(0.)) > .01) {\\r\\n  //   // non opaque means we collide! recalc final pos/vel\\r\\n  //   vec2 newVelocity = velocity * -.1;// lose energy\\r\\n  //   finalVelocity = newVelocity + gravity * seconds;\\r\\n  //   finalPosition = position + newVelocity * seconds + gravity * .5 * seconds * seconds;\\r\\n  // }\\r\\n\\r\\n  float lifePercent = finalLifeMs / maxLifeMs;\\r\\n  vec2 transformedPos = (u_matrix * u_transform * vec4(finalPosition,0.,1.)).xy;\\r\\n  float scale = sqrt(u_transform[0][0] * u_transform[0][0] + u_transform[1][1] * u_transform[1][1]);\\r\\n  gl_Position = vec4(transformedPos, 1.0 - lifePercent, 1.); // use life percent to sort z\\r\\n  gl_PointSize = mix(startSize, endSize, 1.0 - lifePercent) * scale;\\r\\n}\";","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\nuniform sampler2D graphic;\\r\\nuniform bool useTexture;\\r\\nuniform float maxLifeMs;\\r\\n\\r\\nuniform vec4 beginColor;\\r\\nuniform vec4 endColor;\\r\\nuniform bool fade;\\r\\nuniform float startOpacity;\\r\\n\\r\\nin float finalRotation;\\r\\nin float finalLifeMs;\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main(){\\r\\n\\r\\n  float lifePct = finalLifeMs / maxLifeMs;\\r\\n\\r\\n  if (useTexture) {\\r\\n    /** Draw texture */\\r\\n    if (lifePct <= 0.) discard;\\r\\n    float mid = .5;\\r\\n    float cosine = cos(finalRotation);\\r\\n    float sine = sin(finalRotation);\\r\\n    vec2 rotated = vec2(cosine * (gl_PointCoord.x - mid) + sine * (gl_PointCoord.y - mid) + mid,\\r\\n                        cosine * (gl_PointCoord.y - mid) - sine * (gl_PointCoord.x - mid) + mid);\\r\\n    vec4 color = texture(graphic, rotated);\\r\\n    fragColor = color * (fade ? lifePct : 1.0);\\r\\n  } else {\\r\\n    /** Draw circle */\\r\\n    if (lifePct <= 0.) discard;\\r\\n    vec2 uv = gl_PointCoord.xy * 2.0 - 1.0;\\r\\n    float dist = 1.0 - length(uv);\\r\\n    float edge = fwidth(dot(uv, uv));\\r\\n    float circle = smoothstep(-edge/2.0, edge/2.0, dist);\\r\\n    vec3 color = mix(beginColor.rgb, endColor.rgb, 1.0 - lifePct);\\r\\n    fragColor.rgb = color;\\r\\n    fragColor.a = startOpacity * circle * (fade ? lifePct : 1.0);// * mix(beginColor.a, endColor.a, 1.0 - lifePct);\\r\\n    fragColor.rgb *= fragColor.a;\\r\\n  }\\r\\n}\";","// import { Color } from '../../../Color';\r\n// import { parseImageFiltering } from '../../Filtering';\r\nimport { Color } from '../../../Color';\r\nimport { parseImageFiltering } from '../../Filtering';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ImageSourceAttributeConstants } from '../../ImageSource';\r\nimport { parseImageWrapping } from '../../Wrapping';\r\n// import { ImageSourceAttributeConstants } from '../../ImageSource';\r\n// import { parseImageWrapping } from '../../Wrapping';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { getMaxShaderComplexity } from '../webgl-util';\r\nimport frag from './image-renderer-v2.frag.glsl';\r\nimport vert from './image-renderer-v2.vert.glsl';\r\n\r\nexport interface ImageRendererOptions {\r\n  pixelArtSampler: boolean;\r\n  uvPadding: number;\r\n}\r\n\r\nexport class ImageRendererV2 implements RendererPlugin {\r\n  public readonly type = 'ex.image-v2';\r\n  public priority: number = 0;\r\n\r\n  public readonly pixelArtSampler: boolean;\r\n  public readonly uvPadding: number;\r\n\r\n  // TODO this could be bigger probably\r\n  private _maxImages: number = 20_000; // max(uint16) / 6 verts\r\n  private _maxTextures: number = 0;\r\n  private _components = 2 + 2 + 2 + 2 + 1 + 2 + 2 + 1 + 2 + 2 + 4;\r\n\r\n  private _context!: ExcaliburGraphicsContextWebGL;\r\n  private _gl!: WebGL2RenderingContext;\r\n  private _shader!: Shader;\r\n  private _transformData!: VertexBuffer;\r\n\r\n  // Per flush vars\r\n  private _imageCount: number = 0;\r\n  private _textures: WebGLTexture[] = [];\r\n  private _textureIndex = 0;\r\n  private _textureToIndex = new Map<WebGLTexture, number>();\r\n  private _images = new Set<HTMLImageSource>();\r\n  private _vertexIndex: number = 0;\r\n  private _quadMesh!: Float32Array;\r\n  private _meshBuffer!: WebGLBuffer;\r\n  private _vao!: WebGLVertexArrayObject;\r\n\r\n  constructor(options: ImageRendererOptions) {\r\n    this.pixelArtSampler = options.pixelArtSampler;\r\n    this.uvPadding = options.uvPadding;\r\n  }\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // Transform shader source\r\n    const maxTexture = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n    const maxComplexity = getMaxShaderComplexity(gl, maxTexture);\r\n    this._maxTextures = Math.min(maxTexture, maxComplexity);\r\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\r\n    // Compile shader\r\n    this._shader = new Shader({\r\n      gl,\r\n      fragmentSource: transformedFrag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    this._shader.setUniformIntArray(\r\n      'u_textures',\r\n      [...Array(this._maxTextures)].map((_, i) => i)\r\n    );\r\n\r\n    this._vao = gl.createVertexArray()!;\r\n    gl.bindVertexArray(this._vao);\r\n    this._quadMesh = new Float32Array([\r\n      // pos       uv\r\n      0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0,\r\n\r\n      1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1\r\n    ]);\r\n    this._meshBuffer = gl.createBuffer()!;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._meshBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this._quadMesh, gl.STATIC_DRAW);\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 16, 0);\r\n    gl.enableVertexAttribArray(0);\r\n    gl.vertexAttribPointer(1, 2, gl.FLOAT, false, 16, 8);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n    // Setup memory layout\r\n    const components = this._components;\r\n    this._transformData = new VertexBuffer({\r\n      gl,\r\n      size: components * this._maxImages, // components * images\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._transformData.bind();\r\n\r\n    // attributes\r\n    let offset = 0;\r\n    let start = 2;\r\n    const bytesPerFloat = 4;\r\n    const totalSize = components * 4;\r\n\r\n    // a_offset vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(2);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_mat_column1 vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(3);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_mat_column2 vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(4);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_mat_column3 vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(5);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_opacity float - 1\r\n    gl.vertexAttribPointer(start++, 1, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(6);\r\n    offset += 1 * bytesPerFloat;\r\n\r\n    // a_res vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(7);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_size vec2 - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(8);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_texture_index - 1\r\n    gl.vertexAttribPointer(start++, 1, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(9);\r\n    offset += 1 * bytesPerFloat;\r\n\r\n    // a_uv_min - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(10);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_uv_max - 2\r\n    gl.vertexAttribPointer(start++, 2, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(11);\r\n    offset += 2 * bytesPerFloat;\r\n\r\n    // a_tint - 4\r\n    gl.vertexAttribPointer(start++, 4, gl.FLOAT, false, totalSize, offset);\r\n    gl.enableVertexAttribArray(12);\r\n    offset += 4 * bytesPerFloat;\r\n\r\n    gl.vertexAttribDivisor(2, 1);\r\n    gl.vertexAttribDivisor(3, 1);\r\n    gl.vertexAttribDivisor(4, 1);\r\n    gl.vertexAttribDivisor(5, 1);\r\n    gl.vertexAttribDivisor(6, 1);\r\n    gl.vertexAttribDivisor(7, 1);\r\n    gl.vertexAttribDivisor(8, 1);\r\n    gl.vertexAttribDivisor(9, 1);\r\n    gl.vertexAttribDivisor(10, 1);\r\n    gl.vertexAttribDivisor(11, 1);\r\n    gl.vertexAttribDivisor(12, 1);\r\n\r\n    gl.bindVertexArray(null);\r\n  }\r\n\r\n  private _bindData(gl: WebGL2RenderingContext) {\r\n    // Setup memory layout\r\n    const components = this._components;\r\n    this._transformData.bind();\r\n    this._transformData.upload(components * this._imageCount);\r\n\r\n    gl.bindVertexArray(this._vao);\r\n  }\r\n\r\n  public dispose() {\r\n    this._transformData.dispose();\r\n    this._shader.dispose();\r\n    this._textures.length = 0;\r\n    this._context = null as any;\r\n    this._gl = null as any;\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_texture_index <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_texture_index <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      color = texture(u_textures[${i}], uv);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  private _addImageAsTexture(image: HTMLImageSource) {\r\n    if (this._images.has(image)) {\r\n      return;\r\n    }\r\n    const maybeFiltering = image.getAttribute(ImageSourceAttributeConstants.Filtering);\r\n    const filtering = maybeFiltering ? parseImageFiltering(maybeFiltering) : undefined;\r\n    const wrapX = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingX) as any);\r\n    const wrapY = parseImageWrapping(image.getAttribute(ImageSourceAttributeConstants.WrappingY) as any);\r\n\r\n    const force = image.getAttribute('forceUpload') === 'true' ? true : false;\r\n    const texture = this._context.textureLoader.load(\r\n      image,\r\n      {\r\n        filtering,\r\n        wrapping: { x: wrapX, y: wrapY }\r\n      },\r\n      force\r\n    )!;\r\n    // remove force attribute after upload\r\n    image.removeAttribute('forceUpload');\r\n    if (this._textures.indexOf(texture) === -1) {\r\n      this._textures.push(texture);\r\n      this._textureToIndex.set(texture, this._textureIndex++);\r\n      this._images.add(image);\r\n    }\r\n  }\r\n\r\n  private _bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    const max = Math.min(this._textureIndex, this._maxTextures);\r\n    for (let i = 0; i < max; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\r\n    }\r\n  }\r\n\r\n  private _getTextureIdForImage(image: HTMLImageSource) {\r\n    if (image) {\r\n      const maybeTexture = this._context.textureLoader.get(image);\r\n      return this._textureToIndex.get(maybeTexture) ?? -1; //this._textures.indexOf(maybeTexture);\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._imageCount >= this._maxImages) {\r\n      return true;\r\n    }\r\n    if (this._textures.length >= this._maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _imageToWidth = new Map<HTMLImageSource, number>();\r\n  private _getImageWidth(image: HTMLImageSource) {\r\n    let maybeWidth = this._imageToWidth.get(image);\r\n    if (maybeWidth === undefined) {\r\n      maybeWidth = image.width;\r\n      this._imageToWidth.set(image, maybeWidth);\r\n    }\r\n    return maybeWidth;\r\n  }\r\n\r\n  private _imageToHeight = new Map<HTMLImageSource, number>();\r\n  private _getImageHeight(image: HTMLImageSource) {\r\n    let maybeHeight = this._imageToHeight.get(image);\r\n    if (maybeHeight === undefined) {\r\n      maybeHeight = image.height;\r\n      this._imageToHeight.set(image, maybeHeight);\r\n    }\r\n    return maybeHeight;\r\n  }\r\n\r\n  private _view = [0, 0, 0, 0];\r\n  private _dest = [0, 0];\r\n  private _defaultTint = Color.White;\r\n  draw(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._imageCount++;\r\n    // This creates and uploads the texture if not already done\r\n    this._addImageAsTexture(image);\r\n    const maybeImageWidth = this._getImageWidth(image);\r\n    const maybeImageHeight = this._getImageHeight(image);\r\n\r\n    let width = maybeImageWidth || swidth || 0;\r\n    let height = maybeImageHeight || sheight || 0;\r\n    this._view[0] = 0;\r\n    this._view[1] = 0;\r\n    this._view[2] = swidth ?? maybeImageWidth ?? 0;\r\n    this._view[3] = sheight ?? maybeImageHeight ?? 0;\r\n    this._dest[0] = sx ?? 1;\r\n    this._dest[1] = sy ?? 1;\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      this._view[0] = sx ?? 1;\r\n      this._view[1] = sy ?? 1;\r\n      this._view[2] = swidth ?? maybeImageWidth ?? 0;\r\n      this._view[3] = sheight ?? maybeImageHeight ?? 0;\r\n      this._dest[0] = dx;\r\n      this._dest[1] = dy;\r\n      width = dwidth;\r\n      height = dheight;\r\n    }\r\n\r\n    sx = this._view[0];\r\n    sy = this._view[1];\r\n    const sw = this._view[2];\r\n    const sh = this._view[3];\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n    if (snapToPixel) {\r\n      this._dest[0] = ~~(this._dest[0] + pixelSnapEpsilon);\r\n      this._dest[1] = ~~(this._dest[1] + pixelSnapEpsilon);\r\n    }\r\n\r\n    const tint = this._context.tint || this._defaultTint;\r\n\r\n    const textureId = this._getTextureIdForImage(image);\r\n    const imageWidth = maybeImageWidth || width;\r\n    const imageHeight = maybeImageHeight || height;\r\n\r\n    const uvx0 = (sx + this.uvPadding) / imageWidth;\r\n    const uvy0 = (sy + this.uvPadding) / imageHeight;\r\n    const uvx1 = (sx + sw - this.uvPadding) / imageWidth;\r\n    const uvy1 = (sy + sh - this.uvPadding) / imageHeight;\r\n\r\n    const txWidth = maybeImageWidth;\r\n    const txHeight = maybeImageHeight;\r\n\r\n    // update data\r\n    const vertexBuffer = this._transformData.bufferData;\r\n    vertexBuffer[this._vertexIndex++] = this._dest[0];\r\n    vertexBuffer[this._vertexIndex++] = this._dest[1];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[0];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[1];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[2];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[3];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[4];\r\n    vertexBuffer[this._vertexIndex++] = transform.data[5];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = txWidth;\r\n    vertexBuffer[this._vertexIndex++] = txHeight;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._imageCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._imageCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._bindData(gl);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Turn on pixel art aa sampler\r\n    this._shader.setUniformBoolean('u_pixelart', this.pixelArtSampler);\r\n\r\n    // Bind textures to\r\n    this._bindTextures(gl);\r\n\r\n    // Draw all the quads\r\n    gl.drawArraysInstanced(gl.TRIANGLES, 0, 6, this._imageCount);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    gl.bindVertexArray(null);\r\n    // Reset\r\n    this._imageCount = 0;\r\n    this._vertexIndex = 0;\r\n    this._textures.length = 0;\r\n    this._textureIndex = 0;\r\n    this._textureToIndex.clear();\r\n    this._images.clear();\r\n    this._imageToWidth.clear();\r\n    this._imageToHeight.clear();\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// Textures in the current draw\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\nuniform bool u_pixelart;\\r\\n\\r\\nin float v_texture_index;\\r\\n\\r\\nin float v_opacity;\\r\\n\\r\\nin vec4 v_tint;\\r\\n\\r\\n// texture resolution\\r\\nin vec2 v_res;\\r\\n\\r\\nin vec2 v_size;\\r\\n\\r\\nin vec2 v_uv_min;\\r\\nin vec2 v_uv_max;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\n// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\\r\\nvec2 uv_iq(in vec2 uv, in vec2 texture_size) {\\r\\n  vec2 pixel = uv * texture_size;\\r\\n\\r\\n  vec2 seam=floor(pixel+.5);\\r\\n  vec2 dudv=fwidth(pixel);\\r\\n  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\\r\\n\\r\\n  return pixel/texture_size;\\r\\n}\\r\\n\\r\\nfloat lerp(float from, float to, float rel){\\r\\n  return ((1. - rel) * from) + (rel * to);\\r\\n}\\r\\n\\r\\nfloat invLerp(float from, float to, float value){\\r\\n  return (value - from) / (to - from);\\r\\n}\\r\\n\\r\\nfloat remap(float origFrom, float origTo, float targetFrom, float targetTo, float value){\\r\\n  float rel = invLerp(origFrom, origTo, value);\\r\\n  return lerp(targetFrom, targetTo, rel);\\r\\n}\\r\\n\\r\\nvoid main(){\\r\\n  // In order to support the most efficient sprite batching, we have multiple\\r\\n  // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n  // that do not apply to a particular sprite.\\r\\n\\r\\n  vec4 color=vec4(1.,0,0,1.);\\r\\n  vec2 remapped_uv = v_texcoord;\\r\\n  remapped_uv.x = remap(0.,1., v_uv_min.x, v_uv_max.x, v_texcoord.x);\\r\\n  remapped_uv.y = remap(0.,1., v_uv_min.y, v_uv_max.y, v_texcoord.y);\\r\\n  vec2 uv = u_pixelart ? uv_iq(remapped_uv, v_size) : remapped_uv;\\r\\n\\r\\n  // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n  %%texture_picker%%\\r\\n\\r\\n  color.rgb = color.rgb * v_opacity;\\r\\n  color.a = color.a * v_opacity;\\r\\n  fragColor = color * v_tint;\\r\\n}\";","export default \"#version 300 es\\r\\nlayout(location=0) in vec2 pos;\\r\\nlayout(location=1) in vec2 a_texcoord;\\r\\nout vec2 v_texcoord;\\r\\n\\r\\nlayout(location=2) in vec2 a_offset;\\r\\nlayout(location=3) in vec2 a_mat_column1;\\r\\nlayout(location=4) in vec2 a_mat_column2;\\r\\nlayout(location=5) in vec2 a_mat_column3;\\r\\n\\r\\nlayout(location=6) in float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\n// Texture resolution (could be bigger than a_size)\\r\\nlayout(location=7) in vec2 a_res;\\r\\nout vec2 v_res;\\r\\n\\r\\n// Final size of graphic\\r\\nlayout(location=8) in vec2 a_size;\\r\\nout vec2 v_size;\\r\\n\\r\\nlayout(location=9) in lowp float a_texture_index;\\r\\nout lowp float v_texture_index;\\r\\n\\r\\nlayout(location=10) in vec2 a_uv_min;\\r\\nout vec2 v_uv_min;\\r\\n\\r\\nlayout(location=11) in vec2 a_uv_max;\\r\\nout vec2 v_uv_max;\\r\\n\\r\\nlayout(location=12) in vec4 a_tint;\\r\\nout vec4 v_tint;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main(){\\r\\n  mat4 world_mat = mat4(\\r\\n    a_mat_column1.x, a_mat_column1.y, 0., 0.,\\r\\n    a_mat_column2.x, a_mat_column2.y, 0., 0.,\\r\\n    0.             , 0.             , 1., 0.,\\r\\n    a_mat_column3.x, a_mat_column3.y, 0., 1.\\r\\n  );\\r\\n\\r\\n  vec2 newPos = vec2(pos.x * a_res.x, pos.y * a_res.y);\\r\\n  gl_Position = u_matrix * world_mat * vec4(newPos + a_offset, 0., 1.);\\r\\n\\r\\n  v_opacity = a_opacity;\\r\\n  v_texcoord = a_texcoord;\\r\\n  v_uv_min = a_uv_min;\\r\\n  v_uv_max = a_uv_max;\\r\\n  v_res = a_res;\\r\\n  v_size = a_size;\\r\\n  v_texture_index = a_texture_index;\\r\\n  v_tint = a_tint;\\r\\n}\";","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  RectGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\n\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { TransformStack } from './transform-stack';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { Logger } from '../../Util/Log';\r\nimport { DebugText } from './debug-text';\r\nimport { Resolution } from '../../Screen';\r\nimport { RenderTarget } from './render-target';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { TextureLoader } from './texture-loader';\r\nimport { RendererPlugin } from './renderer';\r\n\r\n// renderers\r\nimport { LineRenderer } from './line-renderer/line-renderer';\r\nimport { PointRenderer } from './point-renderer/point-renderer';\r\nimport { ScreenPassPainter } from './screen-pass-painter/screen-pass-painter';\r\nimport { ImageRenderer } from './image-renderer/image-renderer';\r\nimport { RectangleRenderer } from './rectangle-renderer/rectangle-renderer';\r\nimport { CircleRenderer } from './circle-renderer/circle-renderer';\r\nimport { Pool } from '../../Util/Pool';\r\nimport { DrawCall } from './draw-call';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Material, MaterialOptions } from './material';\r\nimport { MaterialRenderer } from './material-renderer/material-renderer';\r\nimport { Shader, ShaderOptions } from './shader';\r\nimport { GarbageCollector } from '../../GarbageCollector';\r\nimport { ParticleRenderer } from './particle-renderer/particle-renderer';\r\nimport { ImageRendererV2 } from './image-renderer-v2/image-renderer-v2';\r\nimport { Flags } from '../../Flags';\r\n\r\nexport const pixelSnapEpsilon = 0.0001;\r\n\r\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\r\n\r\n  /**\r\n   * Draw a debugging rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\r\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging line to the context\r\n   * @param start\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions?: LineGraphicsOptions): void {\r\n    this._webglCtx.draw<LineRenderer>('ex.line', start, end, lineOptions?.color ?? Color.Black);\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging point to the context\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._webglCtx.draw<PointRenderer>('ex.point', point, pointOptions.color, pointOptions.size);\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._webglCtx, text, pos);\r\n  }\r\n}\r\n\r\nexport interface WebGLGraphicsContextInfo {\r\n  transform: TransformStack;\r\n  state: StateStack;\r\n  ortho: Matrix;\r\n  context: ExcaliburGraphicsContextWebGL;\r\n}\r\n\r\nexport interface ExcaliburGraphicsContextWebGLOptions extends ExcaliburGraphicsContextOptions {\r\n  context?: WebGL2RenderingContext;\r\n  garbageCollector?: { garbageCollector: GarbageCollector; collectionInterval: number };\r\n  handleContextLost?: (e: Event) => void;\r\n  handleContextRestored?: (e: Event) => void;\r\n}\r\n\r\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\r\n  private _logger = Logger.getInstance();\r\n  private _renderers: Map<string, RendererPlugin> = new Map<string, RendererPlugin>();\r\n  private _lazyRenderersFactory: Map<string, () => RendererPlugin> = new Map<string, () => RendererPlugin>();\r\n  public imageRenderer: 'ex.image' | 'ex.image-v2' = Flags.isEnabled('use-legacy-image-renderer') ? 'ex.image' : 'ex.image-v2';\r\n  private _isDrawLifecycle = false;\r\n  public useDrawSorting = true;\r\n\r\n  private _drawCallPool = new Pool<DrawCall>(() => new DrawCall(), undefined, 4000);\r\n\r\n  private _drawCallIndex = 0;\r\n  private _drawCalls: DrawCall[] = new Array(4000).fill(null);\r\n\r\n  // Main render target\r\n  private _renderTarget!: RenderTarget;\r\n\r\n  // Quad boundary MSAA\r\n  private _msaaTarget!: RenderTarget;\r\n\r\n  // Postprocessing is a tuple with 2 render targets, these are flip-flopped during the postprocessing process\r\n  private _postProcessTargets: RenderTarget[] = [];\r\n\r\n  private _screenRenderer!: ScreenPassPainter;\r\n\r\n  private _postprocessors: PostProcessor[] = [];\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __gl: WebGL2RenderingContext;\r\n\r\n  private _transform = new TransformStack();\r\n  private _state = new StateStack();\r\n  private _ortho!: Matrix;\r\n\r\n  /**\r\n   * Snaps the drawing x/y coordinate to the nearest whole pixel\r\n   */\r\n  public snapToPixel: boolean = false;\r\n\r\n  /**\r\n   * Native context smoothing\r\n   */\r\n  public readonly smoothing: boolean = false;\r\n\r\n  /**\r\n   * Whether the pixel art sampler is enabled for smooth sub pixel anti-aliasing\r\n   */\r\n  public readonly pixelArtSampler: boolean = false;\r\n\r\n  /**\r\n   * UV padding in pixels to use in internal image rendering to prevent texture bleed\r\n   *\r\n   */\r\n  public uvPadding = 0.01;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  public textureLoader: TextureLoader;\r\n\r\n  public materialScreenTexture!: WebGLTexture | null;\r\n\r\n  public get z(): number {\r\n    return this._state.current.z;\r\n  }\r\n\r\n  public set z(value: number) {\r\n    this._state.current.z = value;\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get tint(): Color | undefined | null {\r\n    return this._state.current.tint;\r\n  }\r\n\r\n  public set tint(color: Color | undefined | null) {\r\n    this._state.current.tint = color;\r\n  }\r\n\r\n  public get width() {\r\n    return this.__gl.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__gl.canvas.height;\r\n  }\r\n\r\n  public get ortho(): Matrix {\r\n    return this._ortho;\r\n  }\r\n\r\n  /**\r\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\r\n   * @param dim\r\n   */\r\n  public checkIfResolutionSupported(dim: Resolution): boolean {\r\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\r\n    let supported = true;\r\n    if (dim.width > 4096 || dim.height > 4096) {\r\n      supported = false;\r\n    }\r\n    return supported;\r\n  }\r\n\r\n  public readonly multiSampleAntialiasing: boolean = true;\r\n  public readonly samples?: number;\r\n  public readonly transparency: boolean = true;\r\n  private _isContextLost = false;\r\n\r\n  constructor(options: ExcaliburGraphicsContextWebGLOptions) {\r\n    const {\r\n      canvasElement,\r\n      context,\r\n      enableTransparency,\r\n      antialiasing,\r\n      uvPadding,\r\n      multiSampleAntialiasing,\r\n      pixelArtSampler,\r\n      powerPreference,\r\n      snapToPixel,\r\n      backgroundColor,\r\n      useDrawSorting,\r\n      garbageCollector,\r\n      handleContextLost,\r\n      handleContextRestored\r\n    } = options;\r\n    this.__gl =\r\n      context ??\r\n      (canvasElement.getContext('webgl2', {\r\n        antialias: antialiasing ?? this.smoothing,\r\n        premultipliedAlpha: false,\r\n        alpha: enableTransparency ?? this.transparency,\r\n        depth: false,\r\n        powerPreference: powerPreference ?? 'high-performance'\r\n      }) as WebGL2RenderingContext);\r\n    if (!this.__gl) {\r\n      throw Error('Failed to retrieve webgl context from browser');\r\n    }\r\n\r\n    if (handleContextLost) {\r\n      this.__gl.canvas.addEventListener('webglcontextlost', handleContextLost, false);\r\n    }\r\n\r\n    if (handleContextRestored) {\r\n      this.__gl.canvas.addEventListener('webglcontextrestored', handleContextRestored, false);\r\n    }\r\n\r\n    this.__gl.canvas.addEventListener('webglcontextlost', () => {\r\n      this._isContextLost = true;\r\n    });\r\n\r\n    this.__gl.canvas.addEventListener('webglcontextrestored', () => {\r\n      this._isContextLost = false;\r\n    });\r\n\r\n    this.textureLoader = new TextureLoader(this.__gl, garbageCollector);\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = antialiasing ?? this.smoothing;\r\n    this.transparency = enableTransparency ?? this.transparency;\r\n    this.pixelArtSampler = pixelArtSampler ?? this.pixelArtSampler;\r\n    this.uvPadding = uvPadding ?? this.uvPadding;\r\n    this.multiSampleAntialiasing = typeof multiSampleAntialiasing === 'boolean' ? multiSampleAntialiasing : this.multiSampleAntialiasing;\r\n    this.samples = typeof multiSampleAntialiasing === 'object' ? multiSampleAntialiasing.samples : undefined;\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.useDrawSorting = useDrawSorting ?? this.useDrawSorting;\r\n    this._drawCallPool.disableWarnings = true;\r\n    this._drawCallPool.preallocate();\r\n    this._init();\r\n  }\r\n\r\n  private _disposed = false;\r\n  public dispose() {\r\n    if (!this._disposed) {\r\n      this._disposed = true;\r\n      this.textureLoader.dispose();\r\n      for (const renderer of this._renderers.values()) {\r\n        renderer.dispose();\r\n      }\r\n      this._renderers.clear();\r\n      this._drawCallPool.dispose();\r\n      this._drawCalls.length = 0;\r\n      this.__gl = null as any;\r\n    }\r\n  }\r\n\r\n  private _init() {\r\n    const gl = this.__gl;\r\n    // Setup viewport and view matrix\r\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    // Clear background\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    // Enable alpha blending\r\n    // https://www.realtimerendering.com/blog/gpus-prefer-premultiplication/\r\n    gl.enable(gl.BLEND);\r\n    gl.blendEquation(gl.FUNC_ADD);\r\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\r\n    gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.depthMask(false);\r\n    // Setup builtin renderers\r\n    this.register(\r\n      new ImageRenderer({\r\n        uvPadding: this.uvPadding,\r\n        pixelArtSampler: this.pixelArtSampler\r\n      })\r\n    );\r\n    this.register(new MaterialRenderer());\r\n    this.register(new RectangleRenderer());\r\n    this.register(new CircleRenderer());\r\n    this.register(new PointRenderer());\r\n    this.register(new LineRenderer());\r\n    this.lazyRegister<ParticleRenderer>('ex.particle', () => new ParticleRenderer());\r\n    this.register(\r\n      new ImageRendererV2({\r\n        uvPadding: this.uvPadding,\r\n        pixelArtSampler: this.pixelArtSampler\r\n      })\r\n    );\r\n\r\n    this.materialScreenTexture = gl.createTexture();\r\n    if (!this.materialScreenTexture) {\r\n      throw new Error('Could not create screen texture!');\r\n    }\r\n    gl.bindTexture(gl.TEXTURE_2D, this.materialScreenTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n    this._screenRenderer = new ScreenPassPainter(gl);\r\n\r\n    this._renderTarget = new RenderTarget({\r\n      gl,\r\n      transparency: this.transparency,\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height\r\n    });\r\n\r\n    this._postProcessTargets = [\r\n      new RenderTarget({\r\n        gl,\r\n        transparency: this.transparency,\r\n        width: gl.canvas.width,\r\n        height: gl.canvas.height\r\n      }),\r\n      new RenderTarget({\r\n        gl,\r\n        transparency: this.transparency,\r\n        width: gl.canvas.width,\r\n        height: gl.canvas.height\r\n      })\r\n    ];\r\n\r\n    this._msaaTarget = new RenderTarget({\r\n      gl,\r\n      transparency: this.transparency,\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height,\r\n      antialias: this.multiSampleAntialiasing,\r\n      samples: this.samples\r\n    });\r\n  }\r\n\r\n  public register<T extends RendererPlugin>(renderer: T) {\r\n    this._renderers.set(renderer.type, renderer);\r\n    renderer.initialize(this.__gl, this);\r\n  }\r\n\r\n  public lazyRegister<TRenderer extends RendererPlugin>(type: TRenderer['type'], renderer: () => TRenderer) {\r\n    this._lazyRenderersFactory.set(type, renderer);\r\n  }\r\n\r\n  public get(rendererName: string): RendererPlugin | undefined {\r\n    let maybeRenderer = this._renderers.get(rendererName);\r\n    if (!maybeRenderer) {\r\n      const lazyFactory = this._lazyRenderersFactory.get(rendererName);\r\n      if (lazyFactory) {\r\n        this._logger.debug('lazy init renderer:', rendererName);\r\n        maybeRenderer = lazyFactory();\r\n        this.register(maybeRenderer);\r\n      }\r\n    }\r\n    return maybeRenderer;\r\n  }\r\n\r\n  private _currentRenderer: RendererPlugin | undefined;\r\n\r\n  private _isCurrentRenderer(renderer: RendererPlugin): boolean {\r\n    if (!this._currentRenderer || this._currentRenderer === renderer) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public beginDrawLifecycle() {\r\n    this._isDrawLifecycle = true;\r\n  }\r\n\r\n  public endDrawLifecycle() {\r\n    this._isDrawLifecycle = false;\r\n  }\r\n\r\n  public draw<TRenderer extends RendererPlugin>(rendererName: TRenderer['type'], ...args: Parameters<TRenderer['draw']>) {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      if (args.length > 9) {\r\n        throw new Error('Only 10 or less renderer arguments are supported!;');\r\n      }\r\n    }\r\n    if (!this._isDrawLifecycle) {\r\n      this._logger.warnOnce(\r\n        `Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\\n` +\r\n          `If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`\r\n      );\r\n    }\r\n    if (this._isContextLost) {\r\n      this._logger.errorOnce(`Unable to draw ${rendererName}, the webgl context is lost`);\r\n      return;\r\n    }\r\n\r\n    const renderer = this.get(rendererName);\r\n    if (renderer) {\r\n      if (this.useDrawSorting) {\r\n        const drawCall = this._drawCallPool.get();\r\n        drawCall.z = this._state.current.z;\r\n        drawCall.priority = renderer.priority;\r\n        drawCall.renderer = rendererName;\r\n        this.getTransform().clone(drawCall.transform);\r\n        drawCall.state.z = this._state.current.z;\r\n        drawCall.state.opacity = this._state.current.opacity;\r\n        drawCall.state.tint = this._state.current.tint;\r\n        drawCall.state.material = this._state.current.material;\r\n        drawCall.args[0] = args[0];\r\n        drawCall.args[1] = args[1];\r\n        drawCall.args[2] = args[2];\r\n        drawCall.args[3] = args[3];\r\n        drawCall.args[4] = args[4];\r\n        drawCall.args[5] = args[5];\r\n        drawCall.args[6] = args[6];\r\n        drawCall.args[7] = args[7];\r\n        drawCall.args[8] = args[8];\r\n        drawCall.args[9] = args[9];\r\n        this._drawCalls[this._drawCallIndex++] = drawCall;\r\n      } else {\r\n        // Set the current renderer if not defined\r\n        if (!this._currentRenderer) {\r\n          this._currentRenderer = renderer;\r\n        }\r\n\r\n        if (!this._isCurrentRenderer(renderer)) {\r\n          // switching graphics means we must flush the previous\r\n          this._currentRenderer.flush();\r\n        }\r\n\r\n        // If we are still using the same renderer we can add to the current batch\r\n        renderer.draw(args[0], args[1], args[2], args[3], args[4], args[5], args[6], args[7], args[8], args[9]);\r\n\r\n        this._currentRenderer = renderer;\r\n      }\r\n    } else {\r\n      throw Error(`No renderer with name ${rendererName} has been registered`);\r\n    }\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this._transform.reset();\r\n  }\r\n\r\n  public updateViewport(resolution: Resolution): void {\r\n    const gl = this.__gl;\r\n    this._ortho = this._ortho = Matrix.ortho(0, resolution.width, resolution.height, 0, 400, -400);\r\n\r\n    this._renderTarget.setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._msaaTarget.setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._postProcessTargets[0].setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._postProcessTargets[1].setResolution(gl.canvas.width, gl.canvas.height);\r\n  }\r\n\r\n  private _imageToWidth = new Map<HTMLImageSource, number>();\r\n  private _getImageWidth(image: HTMLImageSource) {\r\n    let maybeWidth = this._imageToWidth.get(image);\r\n    if (maybeWidth === undefined) {\r\n      maybeWidth = image.width;\r\n      this._imageToWidth.set(image, maybeWidth);\r\n    }\r\n    return maybeWidth;\r\n  }\r\n\r\n  private _imageToHeight = new Map<HTMLImageSource, number>();\r\n  private _getImageHeight(image: HTMLImageSource) {\r\n    let maybeHeight = this._imageToHeight.get(image);\r\n    if (maybeHeight === undefined) {\r\n      maybeHeight = image.height;\r\n      this._imageToHeight.set(image, maybeHeight);\r\n    }\r\n    return maybeHeight;\r\n  }\r\n\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (this._getImageWidth(image) === 0 || this._getImageHeight(image) === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    if (!image) {\r\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\r\n      // tslint:disable-next-line: no-console\r\n      if (console.trace) {\r\n        // tslint:disable-next-line: no-console\r\n        console.trace();\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this._state.current.material) {\r\n      this.draw<MaterialRenderer>('ex.material', image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n    } else {\r\n      if (this.imageRenderer === 'ex.image') {\r\n        this.draw<ImageRenderer>(this.imageRenderer, image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n      } else {\r\n        this.draw<ImageRendererV2>(this.imageRenderer, image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n      }\r\n    }\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.draw<RectangleRenderer>('ex.rectangle', start, end, color, thickness);\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number) {\r\n    this.draw<RectangleRenderer>('ex.rectangle', pos, width, height, color, stroke, strokeThickness);\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\r\n    this.draw<CircleRenderer>('ex.circle', pos, radius, color, stroke, thickness);\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\r\n\r\n  public save(): void {\r\n    this._transform.save();\r\n    this._state.save();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._transform.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  public translate(x: number, y: number): void {\r\n    this._transform.translate(this.snapToPixel ? ~~(x + pixelSnapEpsilon) : x, this.snapToPixel ? ~~(y + pixelSnapEpsilon) : y);\r\n  }\r\n\r\n  public rotate(angle: number): void {\r\n    this._transform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): void {\r\n    this._transform.scale(x, y);\r\n  }\r\n\r\n  public transform(matrix: AffineMatrix) {\r\n    this._transform.current = matrix;\r\n  }\r\n\r\n  public getTransform(): AffineMatrix {\r\n    return this._transform.current;\r\n  }\r\n\r\n  public multiply(m: AffineMatrix) {\r\n    this._transform.current.multiply(m, this._transform.current);\r\n  }\r\n\r\n  public addPostProcessor(postprocessor: PostProcessor) {\r\n    this._postprocessors.push(postprocessor);\r\n    postprocessor.initialize(this.__gl);\r\n  }\r\n\r\n  public removePostProcessor(postprocessor: PostProcessor) {\r\n    const index = this._postprocessors.indexOf(postprocessor);\r\n    if (index !== -1) {\r\n      this._postprocessors.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public clearPostProcessors() {\r\n    this._postprocessors.length = 0;\r\n  }\r\n\r\n  private _totalPostProcessorTime = 0;\r\n  public updatePostProcessors(elapsed: number) {\r\n    for (const postprocessor of this._postprocessors) {\r\n      const shader = postprocessor.getShader();\r\n      shader.use();\r\n      const uniforms = shader.getUniforms();\r\n      this._totalPostProcessorTime += elapsed;\r\n\r\n      if (uniforms.find((u) => u.name === 'u_time_ms')) {\r\n        shader.setUniformFloat('u_time_ms', this._totalPostProcessorTime);\r\n      }\r\n      if (uniforms.find((u) => u.name === 'u_elapsed_ms')) {\r\n        shader.setUniformFloat('u_elapsed_ms', elapsed);\r\n      }\r\n      if (uniforms.find((u) => u.name === 'u_resolution')) {\r\n        shader.setUniformFloatVector('u_resolution', vec(this.width, this.height));\r\n      }\r\n\r\n      if (postprocessor.onUpdate) {\r\n        postprocessor.onUpdate(elapsed);\r\n      }\r\n    }\r\n  }\r\n\r\n  public set material(material: Material | null | undefined) {\r\n    this._state.current.material = material;\r\n  }\r\n\r\n  public get material(): Material | null | undefined {\r\n    return this._state.current.material;\r\n  }\r\n\r\n  /**\r\n   * Creates and initializes the material which compiles the internal shader\r\n   * @param options\r\n   * @returns Material\r\n   */\r\n  public createMaterial(options: Omit<MaterialOptions, 'graphicsContext'>): Material {\r\n    const material = new Material({ ...options, graphicsContext: this });\r\n    return material;\r\n  }\r\n\r\n  public createShader(options: Omit<ShaderOptions, 'gl'>): Shader {\r\n    const gl = this.__gl;\r\n    const { vertexSource, fragmentSource } = options;\r\n    const shader = new Shader({\r\n      gl,\r\n      vertexSource,\r\n      fragmentSource\r\n    });\r\n    shader.compile();\r\n    return shader;\r\n  }\r\n\r\n  clear() {\r\n    const gl = this.__gl;\r\n    const currentTarget = this.multiSampleAntialiasing ? this._msaaTarget : this._renderTarget;\r\n    currentTarget.use();\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    // Clear the context with the newly set color. This is\r\n    // the function call that actually does the drawing.\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n  }\r\n\r\n  /**\r\n   * Flushes all batched rendering to the screen\r\n   */\r\n  flush() {\r\n    if (this._isContextLost) {\r\n      this._logger.errorOnce(`Unable to flush the webgl context is lost`);\r\n      return;\r\n    }\r\n\r\n    // render target captures all draws and redirects to the render target\r\n    let currentTarget = this.multiSampleAntialiasing ? this._msaaTarget : this._renderTarget;\r\n    currentTarget.use();\r\n\r\n    if (this.useDrawSorting) {\r\n      // null out unused draw calls\r\n      for (let i = this._drawCallIndex; i < this._drawCalls.length; i++) {\r\n        this._drawCalls[i] = null as any;\r\n      }\r\n      // sort draw calls\r\n      // Find the original order of the first instance of the draw call\r\n      const originalSort = new Map<string, number>();\r\n      for (const [name] of this._renderers) {\r\n        let firstIndex = 0;\r\n        for (firstIndex = 0; firstIndex < this._drawCallIndex; firstIndex++) {\r\n          if (this._drawCalls[firstIndex].renderer === name) {\r\n            break;\r\n          }\r\n        }\r\n        originalSort.set(name, firstIndex);\r\n      }\r\n\r\n      this._drawCalls.sort((a, b) => {\r\n        if (a === null || b === null) {\r\n          return 0;\r\n        }\r\n        const zIndex = a.z - b.z;\r\n        const originalSortOrder = originalSort.get(a.renderer)! - originalSort.get(b.renderer)!;\r\n        const priority = a.priority - b.priority;\r\n        if (zIndex === 0) {\r\n          // sort by z first\r\n          if (priority === 0) {\r\n            // sort by priority\r\n            return originalSortOrder; // use the original order to inform draw call packing to maximally preserve painter order\r\n          }\r\n          return priority;\r\n        }\r\n        return zIndex;\r\n      });\r\n\r\n      const oldTransform = this._transform.current;\r\n      const oldState = this._state.current;\r\n\r\n      if (this._drawCalls.length && this._drawCallIndex) {\r\n        let currentRendererName = this._drawCalls[0].renderer;\r\n        let currentRenderer = this.get(currentRendererName);\r\n        for (let i = 0; i < this._drawCallIndex; i++) {\r\n          // hydrate the state for renderers\r\n          this._transform.current = this._drawCalls[i].transform;\r\n          this._state.current = this._drawCalls[i].state;\r\n\r\n          if (this._drawCalls[i].renderer !== currentRendererName) {\r\n            // switching graphics renderer means we must flush the previous\r\n            currentRenderer!.flush();\r\n            currentRendererName = this._drawCalls[i].renderer;\r\n            currentRenderer = this.get(currentRendererName);\r\n          }\r\n\r\n          // ! hack to grab screen texture before materials run because they might want it\r\n          if (currentRenderer instanceof MaterialRenderer && this.material?.isUsingScreenTexture) {\r\n            currentTarget.copyToTexture(this.materialScreenTexture!);\r\n            currentTarget.use();\r\n          }\r\n          // If we are still using the same renderer we can add to the current batch\r\n          currentRenderer!.draw(...this._drawCalls[i].args);\r\n        }\r\n        if (currentRenderer!.hasPendingDraws()) {\r\n          currentRenderer!.flush();\r\n        }\r\n      }\r\n\r\n      // reset state\r\n      this._transform.current = oldTransform;\r\n      this._state.current = oldState;\r\n\r\n      // reclaim draw calls\r\n      this._drawCallPool.done();\r\n      this._drawCallIndex = 0;\r\n      this._imageToHeight.clear();\r\n      this._imageToWidth.clear();\r\n    } else {\r\n      // This is the final flush at the moment to draw any leftover pending draw\r\n      for (const renderer of this._renderers.values()) {\r\n        if (renderer.hasPendingDraws()) {\r\n          renderer.flush();\r\n        }\r\n      }\r\n    }\r\n\r\n    currentTarget.disable();\r\n\r\n    // post process step\r\n    if (this._postprocessors.length > 0) {\r\n      currentTarget.toRenderSource().use();\r\n    }\r\n\r\n    // flip flop render targets for post processing\r\n    for (let i = 0; i < this._postprocessors.length; i++) {\r\n      currentTarget = this._postProcessTargets[i % 2];\r\n      this._postProcessTargets[i % 2].use();\r\n      this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]);\r\n      this._postProcessTargets[i % 2].toRenderSource().use();\r\n    }\r\n\r\n    // Final blit to the screen\r\n    currentTarget.blitToScreen();\r\n  }\r\n}\r\n","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\nimport { Resolution } from '../../Screen';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Material, MaterialOptions } from './material';\r\n\r\nconst pixelSnapEpsilon = 0.0001;\r\n\r\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\r\n  /**\r\n   * Draw a debug rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.strokeStyle = 'red';\r\n    this._ex.__ctx.strokeRect(\r\n      this._ex.snapToPixel ? ~~(x + pixelSnapEpsilon) : x,\r\n      this._ex.snapToPixel ? ~~(y + pixelSnapEpsilon) : y,\r\n      this._ex.snapToPixel ? ~~(width + pixelSnapEpsilon) : width,\r\n      this._ex.snapToPixel ? ~~(height + pixelSnapEpsilon) : height\r\n    );\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.strokeStyle = lineOptions.color?.toString() ?? '';\r\n    this._ex.__ctx.moveTo(\r\n      this._ex.snapToPixel ? ~~(start.x + pixelSnapEpsilon) : start.x,\r\n      this._ex.snapToPixel ? ~~(start.y + pixelSnapEpsilon) : start.y\r\n    );\r\n    this._ex.__ctx.lineTo(\r\n      this._ex.snapToPixel ? ~~(end.x + pixelSnapEpsilon) : end.x,\r\n      this._ex.snapToPixel ? ~~(end.y + pixelSnapEpsilon) : end.y\r\n    );\r\n    this._ex.__ctx.lineWidth = 2;\r\n    this._ex.__ctx.stroke();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\r\n    this._ex.__ctx.arc(\r\n      this._ex.snapToPixel ? ~~(point.x + pixelSnapEpsilon) : point.x,\r\n      this._ex.snapToPixel ? ~~(point.y + pixelSnapEpsilon) : point.y,\r\n      pointOptions.size,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this._ex.__ctx.fill();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._ex, text, pos);\r\n  }\r\n}\r\n\r\nexport interface ExcaliburGraphicsContext2DOptions extends ExcaliburGraphicsContextOptions {\r\n  context?: CanvasRenderingContext2D;\r\n}\r\n\r\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx!: CanvasRenderingContext2D;\r\n  public get width() {\r\n    return this.__ctx.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__ctx.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Unused in Canvas implementation\r\n   */\r\n  public readonly useDrawSorting: boolean = false;\r\n\r\n  /**\r\n   * Unused in Canvas implementation\r\n   */\r\n  public z: number = 0;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  private _state = new StateStack();\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get tint(): Color | null | undefined {\r\n    return this._state.current.tint;\r\n  }\r\n\r\n  public set tint(color: Color | null | undefined) {\r\n    this._state.current.tint = color;\r\n  }\r\n\r\n  public snapToPixel: boolean = false;\r\n\r\n  public get smoothing(): boolean {\r\n    return this.__ctx.imageSmoothingEnabled;\r\n  }\r\n\r\n  public set smoothing(value: boolean) {\r\n    this.__ctx.imageSmoothingEnabled = value;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContext2DOptions) {\r\n    const { canvasElement, context, enableTransparency, snapToPixel, antialiasing: smoothing, backgroundColor } = options;\r\n    this.__ctx =\r\n      context ??\r\n      (canvasElement.getContext('2d', {\r\n        alpha: enableTransparency ?? true\r\n      }) as CanvasRenderingContext2D);\r\n    if (!this.__ctx) {\r\n      throw new Error('Cannot build new ExcaliburGraphicsContext2D for some reason!');\r\n    }\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this.__ctx.resetTransform();\r\n  }\r\n\r\n  public updateViewport(_resolution: Resolution): void {\r\n    // pass\r\n  }\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    this.__ctx.globalAlpha = this.opacity;\r\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\r\n      .filter((a) => a !== undefined)\r\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\r\n    this.__ctx.drawImage.apply(this.__ctx, args as any);\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n    GraphicsDiagnostics.DrawnImagesCount = 1;\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.strokeStyle = color.toString();\r\n    this.__ctx.moveTo(\r\n      this.snapToPixel ? ~~(start.x + pixelSnapEpsilon) : start.x,\r\n      this.snapToPixel ? ~~(start.y + pixelSnapEpsilon) : start.y\r\n    );\r\n    this.__ctx.lineTo(this.snapToPixel ? ~~(end.x + pixelSnapEpsilon) : end.x, this.snapToPixel ? ~~(end.y + pixelSnapEpsilon) : end.y);\r\n    this.__ctx.lineWidth = thickness;\r\n    this.__ctx.stroke();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.fillRect(\r\n      this.snapToPixel ? ~~(pos.x + pixelSnapEpsilon) : pos.x,\r\n      this.snapToPixel ? ~~(pos.y + pixelSnapEpsilon) : pos.y,\r\n      this.snapToPixel ? ~~(width + pixelSnapEpsilon) : width,\r\n      this.snapToPixel ? ~~(height + pixelSnapEpsilon) : height\r\n    );\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    if (stroke) {\r\n      this.__ctx.strokeStyle = stroke.toString();\r\n    }\r\n    if (thickness) {\r\n      this.__ctx.lineWidth = thickness;\r\n    }\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.arc(\r\n      this.snapToPixel ? ~~(pos.x + pixelSnapEpsilon) : pos.x,\r\n      this.snapToPixel ? ~~(pos.y + pixelSnapEpsilon) : pos.y,\r\n      radius,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this.__ctx.fill();\r\n    if (stroke) {\r\n      this.__ctx.stroke();\r\n    }\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void {\r\n    this.__ctx.save();\r\n    this._state.save();\r\n  }\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void {\r\n    this.__ctx.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void {\r\n    this.__ctx.translate(this.snapToPixel ? ~~(x + pixelSnapEpsilon) : x, this.snapToPixel ? ~~(y + pixelSnapEpsilon) : y);\r\n  }\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void {\r\n    this.__ctx.rotate(angle);\r\n  }\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void {\r\n    this.__ctx.scale(x, y);\r\n  }\r\n\r\n  public getTransform(): AffineMatrix {\r\n    throw new Error('Not implemented');\r\n  }\r\n\r\n  public multiply(_m: AffineMatrix): void {\r\n    this.__ctx.setTransform(this.__ctx.getTransform().multiply(_m.toDOMMatrix()));\r\n  }\r\n\r\n  public addPostProcessor(_postprocessor: PostProcessor) {\r\n    // pass\r\n  }\r\n\r\n  public removePostProcessor(_postprocessor: PostProcessor) {\r\n    // pass\r\n  }\r\n\r\n  public clearPostProcessors() {\r\n    // pass\r\n  }\r\n\r\n  public updatePostProcessors(elapsed: number) {\r\n    // pass\r\n  }\r\n\r\n  public beginDrawLifecycle() {\r\n    // pass\r\n  }\r\n\r\n  public endDrawLifecycle() {\r\n    // pass\r\n  }\r\n\r\n  public set material(material: Material | undefined | null) {\r\n    this._state.current.material = material;\r\n  }\r\n\r\n  public get material(): Material | undefined | null {\r\n    return this._state.current.material;\r\n  }\r\n\r\n  public createMaterial(options: Omit<MaterialOptions, 'graphicsContext'>): Material {\r\n    // pass\r\n    return null as any;\r\n  }\r\n\r\n  clear(): void {\r\n    // Clear frame\r\n    this.__ctx.clearRect(0, 0, this.width, this.height);\r\n    this.__ctx.fillStyle = this.backgroundColor.toString();\r\n    this.__ctx.fillRect(0, 0, this.width, this.height);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void {\r\n    // pass\r\n  }\r\n\r\n  dispose(): void {\r\n    this.__ctx = undefined as any;\r\n  }\r\n}\r\n","import { vec, Vector } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { Camera } from './Camera';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { BoundingBox } from './Collision/Index';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { getPosition } from './Util/Util';\r\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\r\nimport { ExcaliburGraphicsContext2DCanvas } from './Graphics/Context/ExcaliburGraphicsContext2DCanvas';\r\nimport { EventEmitter } from './EventEmitter';\r\n\r\n/**\r\n * Enum representing the different display modes available to Excalibur.\r\n */\r\nexport enum DisplayMode {\r\n  /**\r\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\r\n   */\r\n  Fixed = 'Fixed',\r\n\r\n  /**\r\n   * Fit the aspect ratio given by the game resolution within the container at all times will fill any gaps with canvas.\r\n   * The displayed area outside the aspect ratio is not guaranteed to be on the screen, only the {@apilink Screen.contentArea}\r\n   * is guaranteed to be on screen.\r\n   */\r\n  FitContainerAndFill = 'FitContainerAndFill',\r\n\r\n  /**\r\n   * Fit the aspect ratio given by the game resolution the screen at all times will fill the screen.\r\n   * This displayed area outside the aspect ratio is not guaranteed to be on the screen, only the {@apilink Screen.contentArea}\r\n   * is guaranteed to be on screen.\r\n   */\r\n  FitScreenAndFill = 'FitScreenAndFill',\r\n\r\n  /**\r\n   * Fit the viewport to the parent element maintaining aspect ratio given by the game resolution, but zooms in to avoid the black bars\r\n   * (letterbox) that would otherwise be present in {@apilink FitContainer}.\r\n   *\r\n   * **warning** This will clip some drawable area from the user because of the zoom,\r\n   * use {@apilink Screen.contentArea} to know the safe to draw area.\r\n   */\r\n  FitContainerAndZoom = 'FitContainerAndZoom',\r\n\r\n  /**\r\n   * Fit the viewport to the device screen maintaining aspect ratio given by the game resolution, but zooms in to avoid the black bars\r\n   * (letterbox) that would otherwise be present in {@apilink FitScreen}.\r\n   *\r\n   * **warning** This will clip some drawable area from the user because of the zoom,\r\n   * use {@apilink Screen.contentArea} to know the safe to draw area.\r\n   */\r\n  FitScreenAndZoom = 'FitScreenAndZoom',\r\n\r\n  /**\r\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\r\n   * This is not the same as {@apilink Screen.goFullScreen} but behaves in a similar way maintaining aspect ratio.\r\n   *\r\n   * You may want to center your game here is an example\r\n   * ```html\r\n   * <!-- html -->\r\n   * <body>\r\n   * <main>\r\n   *   <canvas id=\"game\"></canvas>\r\n   * </main>\r\n   * </body>\r\n   * ```\r\n   *\r\n   * ```css\r\n   * // css\r\n   * main {\r\n   *   display: flex;\r\n   *   align-items: center;\r\n   *   justify-content: center;\r\n   *   height: 100%;\r\n   *   width: 100%;\r\n   * }\r\n   * ```\r\n   */\r\n  FitScreen = 'FitScreen',\r\n\r\n  /**\r\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\r\n   * change dynamically as the window is resized. This is not the same as {@apilink Screen.goFullScreen}\r\n   */\r\n  FillScreen = 'FillScreen',\r\n\r\n  /**\r\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\r\n   */\r\n  FitContainer = 'FitContainer',\r\n\r\n  /**\r\n   * Use the parent DOM container's css width/height for the game resolution dynamically\r\n   */\r\n  FillContainer = 'FillContainer'\r\n}\r\n\r\n/**\r\n * Convenience class for quick resolutions\r\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\r\n */\r\nexport class Resolution {\r\n  /* istanbul ignore next */\r\n  public static get SVGA(): Resolution {\r\n    return { width: 800, height: 600 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Standard(): Resolution {\r\n    return { width: 1920, height: 1080 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Atari2600(): Resolution {\r\n    return { width: 160, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoy(): Resolution {\r\n    return { width: 160, height: 144 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoyAdvance(): Resolution {\r\n    return { width: 240, height: 160 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NintendoDS(): Resolution {\r\n    return { width: 256, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NES(): Resolution {\r\n    return { width: 256, height: 224 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get SNES(): Resolution {\r\n    return { width: 256, height: 244 };\r\n  }\r\n}\r\n\r\nexport type ViewportUnit = 'pixel' | 'percent';\r\n\r\nexport interface Resolution {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ViewportDimension {\r\n  widthUnit?: ViewportUnit;\r\n  heightUnit?: ViewportUnit;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ScreenOptions {\r\n  /**\r\n   * Canvas element to build a screen on\r\n   */\r\n  canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Graphics context for the screen\r\n   */\r\n  context: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Browser abstraction\r\n   */\r\n  browser: BrowserEvents;\r\n  /**\r\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\r\n   */\r\n  antialiasing?: boolean;\r\n\r\n  /**\r\n   * Optionally set the image rendering CSS hint on the canvas element, default is auto\r\n   */\r\n  canvasImageRendering?: 'auto' | 'pixelated';\r\n  /**\r\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\r\n   */\r\n  pixelRatio?: number;\r\n  /**\r\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\r\n   * resolution will be the same as the viewport. Resolution will be overridden by {@apilink DisplayMode.FillContainer} and\r\n   * {@apilink DisplayMode.FillScreen}.\r\n   */\r\n  resolution?: Resolution;\r\n  /**\r\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\r\n   */\r\n  viewport: ViewportDimension;\r\n  /**\r\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\r\n   */\r\n  displayMode?: DisplayMode;\r\n}\r\n\r\n/**\r\n * Fires when the screen resizes, useful if you have logic that needs to be aware of resolution/viewport constraints\r\n */\r\nexport interface ScreenResizeEvent {\r\n  /**\r\n   * Current viewport in css pixels of the screen\r\n   */\r\n  viewport: ViewportDimension;\r\n  /**\r\n   * Current resolution in world pixels of the screen\r\n   */\r\n  resolution: Resolution;\r\n}\r\n\r\n/**\r\n * Fires when the pixel ratio changes, useful to know if you've moved to a hidpi screen or back\r\n */\r\nexport interface PixelRatioChangeEvent {\r\n  /**\r\n   * Current pixel ratio of the screen\r\n   */\r\n  pixelRatio: number;\r\n}\r\n\r\n/**\r\n * Fires when the browser fullscreen api is successfully engaged or disengaged\r\n */\r\nexport interface FullScreenChangeEvent {\r\n  /**\r\n   * Current fullscreen state\r\n   */\r\n  fullscreen: boolean;\r\n}\r\n\r\n/**\r\n * Built in events supported by all entities\r\n */\r\nexport type ScreenEvents = {\r\n  /**\r\n   * Fires when the screen resizes, useful if you have logic that needs to be aware of resolution/viewport constraints\r\n   */\r\n  resize: ScreenResizeEvent;\r\n  /**\r\n   * Fires when the pixel ratio changes, useful to know if you've moved to a hidpi screen or back\r\n   */\r\n  pixelratio: PixelRatioChangeEvent;\r\n  /**\r\n   * Fires when the browser fullscreen api is successfully engaged or disengaged\r\n   */\r\n  fullscreen: FullScreenChangeEvent;\r\n};\r\n\r\nexport const ScreenEvents = {\r\n  ScreenResize: 'resize',\r\n  PixelRatioChange: 'pixelratio',\r\n  FullScreenChange: 'fullscreen'\r\n} as const;\r\n\r\n/**\r\n * The Screen handles all aspects of interacting with the screen for Excalibur.\r\n */\r\nexport class Screen {\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n  /**\r\n   * Listen to screen events {@apilink ScreenEvents}\r\n   */\r\n  public events = new EventEmitter<ScreenEvents>();\r\n  private _canvas: HTMLCanvasElement;\r\n  private _antialiasing: boolean = true;\r\n  private _canvasImageRendering: 'auto' | 'pixelated' = 'auto';\r\n  private _contentResolution: Resolution;\r\n  private _browser: BrowserEvents;\r\n  private _camera: Camera;\r\n  private _resolution: Resolution;\r\n  private _resolutionStack: Resolution[] = [];\r\n  private _viewport: ViewportDimension;\r\n  private _viewportStack: ViewportDimension[] = [];\r\n  private _pixelRatioOverride: number | null = null;\r\n  private _displayMode: DisplayMode;\r\n  private _isFullscreen = false;\r\n  private _mediaQueryList: MediaQueryList;\r\n  private _isDisposed = false;\r\n  private _logger = Logger.getInstance();\r\n  private _resizeObserver: ResizeObserver;\r\n\r\n  constructor(options: ScreenOptions) {\r\n    this.viewport = options.viewport;\r\n    this.resolution = options.resolution ?? { ...this.viewport };\r\n    this._contentResolution = this.resolution;\r\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    this._canvas = options.canvas;\r\n    this.graphicsContext = options.context;\r\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\r\n    this._canvasImageRendering = options.canvasImageRendering ?? this._canvasImageRendering;\r\n    this._browser = options.browser;\r\n    this._pixelRatioOverride = options.pixelRatio;\r\n\r\n    this._applyDisplayMode();\r\n\r\n    this._listenForPixelRatio();\r\n\r\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    this.applyResolutionAndViewport();\r\n  }\r\n\r\n  private _listenForPixelRatio() {\r\n    if (this._mediaQueryList && !this._mediaQueryList.addEventListener) {\r\n      // Safari <=13.1 workaround, remove any existing handlers\r\n      this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\r\n    }\r\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\r\n\r\n    // Safari <=13.1 workaround\r\n    if (this._mediaQueryList.addEventListener) {\r\n      this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler, { once: true });\r\n    } else {\r\n      this._mediaQueryList.addListener(this._pixelRatioChangeHandler);\r\n    }\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (!this._isDisposed) {\r\n      // Clean up handlers\r\n      this._isDisposed = true;\r\n      this.events.clear();\r\n      this._browser.window.off('resize', this._resizeHandler);\r\n      this._browser.window.clear();\r\n      if (this._resizeObserver) {\r\n        this._resizeObserver.disconnect();\r\n      }\r\n      this.parent.removeEventListener('resize', this._resizeHandler);\r\n      // Safari <=13.1 workaround\r\n      if (this._mediaQueryList.removeEventListener) {\r\n        this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\r\n      } else {\r\n        this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\r\n      }\r\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n      this._canvas = null;\r\n    }\r\n  }\r\n\r\n  private _fullscreenChangeHandler = () => {\r\n    if (this._isDisposed) {\r\n      return;\r\n    }\r\n    this._isFullscreen = !this._isFullscreen;\r\n    this._logger.debug('Fullscreen Change', this._isFullscreen);\r\n    this.events.emit('fullscreen', {\r\n      fullscreen: this.isFullScreen\r\n    } satisfies FullScreenChangeEvent);\r\n  };\r\n\r\n  private _pixelRatioChangeHandler = () => {\r\n    if (this._isDisposed) {\r\n      return;\r\n    }\r\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\r\n    this._listenForPixelRatio();\r\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\r\n    this.applyResolutionAndViewport();\r\n\r\n    this.events.emit('pixelratio', {\r\n      pixelRatio: this.pixelRatio\r\n    } satisfies PixelRatioChangeEvent);\r\n  };\r\n\r\n  private _resizeHandler = () => {\r\n    if (this._isDisposed) {\r\n      return;\r\n    }\r\n    const parent = this.parent;\r\n    this._logger.debug('View port resized');\r\n    this._setResolutionAndViewportByDisplayMode(parent);\r\n    this.applyResolutionAndViewport();\r\n\r\n    // Emit resize event\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  };\r\n\r\n  private _calculateDevicePixelRatio() {\r\n    if (window.devicePixelRatio < 1) {\r\n      return 1;\r\n    }\r\n\r\n    const devicePixelRatio = window.devicePixelRatio || 1;\r\n\r\n    return devicePixelRatio;\r\n  }\r\n\r\n  // Asking the window.devicePixelRatio is expensive we do it once\r\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\r\n\r\n  /**\r\n   * Returns the computed pixel ratio, first using any override, then the device pixel ratio\r\n   */\r\n  public get pixelRatio(): number {\r\n    if (this._pixelRatioOverride) {\r\n      return this._pixelRatioOverride;\r\n    }\r\n\r\n    return this._devicePixelRatio;\r\n  }\r\n\r\n  /**\r\n   * This calculates the ratio between excalibur pixels and the HTML pixels.\r\n   *\r\n   * This is useful for scaling HTML UI so that it matches your game.\r\n   */\r\n  public get worldToPagePixelRatio(): number {\r\n    if (this._canvas) {\r\n      const pageOrigin = this.worldToPageCoordinates(Vector.Zero);\r\n      const pageDistance = this.worldToPageCoordinates(vec(1, 0)).sub(pageOrigin);\r\n      const pixelConversion = pageDistance.x;\r\n      return pixelConversion;\r\n    } else {\r\n      return 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the pixel ratio override\r\n   *\r\n   * You will need to call applyResolutionAndViewport() affect change on the screen\r\n   */\r\n  public get pixelRatioOverride(): number | undefined {\r\n    return this._pixelRatioOverride;\r\n  }\r\n\r\n  public set pixelRatioOverride(value: number | undefined) {\r\n    this._pixelRatioOverride = value;\r\n  }\r\n\r\n  public get isHiDpi() {\r\n    return this.pixelRatio !== 1;\r\n  }\r\n\r\n  public get displayMode(): DisplayMode {\r\n    return this._displayMode;\r\n  }\r\n\r\n  public get canvas(): HTMLCanvasElement {\r\n    return this._canvas;\r\n  }\r\n\r\n  public get parent(): HTMLElement | Window {\r\n    switch (this.displayMode) {\r\n      case DisplayMode.FillContainer:\r\n      case DisplayMode.FitContainer:\r\n      case DisplayMode.FitContainerAndFill:\r\n      case DisplayMode.FitContainerAndZoom:\r\n        return this.canvas.parentElement || document.body;\r\n      default:\r\n        return window;\r\n    }\r\n  }\r\n\r\n  public get resolution(): Resolution {\r\n    return this._resolution;\r\n  }\r\n\r\n  public set resolution(resolution: Resolution) {\r\n    this._resolution = resolution;\r\n  }\r\n\r\n  /**\r\n   * Returns screen dimensions in pixels or percentage\r\n   */\r\n  public get viewport(): ViewportDimension {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n    return this._resolution;\r\n  }\r\n\r\n  public set viewport(viewport: ViewportDimension) {\r\n    this._viewport = viewport;\r\n  }\r\n\r\n  public get aspectRatio() {\r\n    return this._resolution.width / this._resolution.height;\r\n  }\r\n\r\n  public get scaledWidth() {\r\n    return this._resolution.width * this.pixelRatio;\r\n  }\r\n\r\n  public get scaledHeight() {\r\n    return this._resolution.height * this.pixelRatio;\r\n  }\r\n\r\n  public setCurrentCamera(camera: Camera) {\r\n    this._camera = camera;\r\n  }\r\n\r\n  public pushResolutionAndViewport() {\r\n    this._resolutionStack.push(this.resolution);\r\n    this._viewportStack.push(this.viewport);\r\n\r\n    this.resolution = { ...this.resolution };\r\n    this.viewport = { ...this.viewport };\r\n  }\r\n\r\n  public peekViewport(): ViewportDimension {\r\n    return this._viewportStack[this._viewportStack.length - 1];\r\n  }\r\n\r\n  public peekResolution(): Resolution {\r\n    return this._resolutionStack[this._resolutionStack.length - 1];\r\n  }\r\n\r\n  public popResolutionAndViewport() {\r\n    if (this._resolutionStack.length && this._viewportStack.length) {\r\n      this.resolution = this._resolutionStack.pop();\r\n      this.viewport = this._viewportStack.pop();\r\n    }\r\n  }\r\n\r\n  public applyResolutionAndViewport() {\r\n    if (this.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      const scaledResolutionSupported = this.graphicsContext.checkIfResolutionSupported({\r\n        width: this.scaledWidth,\r\n        height: this.scaledHeight\r\n      });\r\n      if (!scaledResolutionSupported) {\r\n        this._logger.warnOnce(\r\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio})` +\r\n            ' are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\r\n            ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\r\n            ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).'\r\n        );\r\n\r\n        // Attempt to recover if the user hasn't configured a specific ratio for up scaling\r\n        if (!this.pixelRatioOverride) {\r\n          let currentPixelRatio = Math.max(1, this.pixelRatio - 0.5);\r\n          let newResolutionSupported = false;\r\n          while (currentPixelRatio > 1 && !newResolutionSupported) {\r\n            currentPixelRatio = Math.max(1, currentPixelRatio - 0.5);\r\n            const width = this._resolution.width * currentPixelRatio;\r\n            const height = this._resolution.height * currentPixelRatio;\r\n            newResolutionSupported = this.graphicsContext.checkIfResolutionSupported({ width, height });\r\n          }\r\n          this.pixelRatioOverride = currentPixelRatio;\r\n          this._logger.warnOnce(\r\n            'Scaled resolution too big attempted recovery!' +\r\n              ` Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit.` +\r\n              ' Setting `ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.` ' +\r\n              ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).'\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    this._canvas.width = this.scaledWidth;\r\n    this._canvas.height = this.scaledHeight;\r\n\r\n    if (this._canvasImageRendering === 'auto') {\r\n      this._canvas.style.imageRendering = 'auto';\r\n    } else {\r\n      this._canvas.style.imageRendering = 'pixelated';\r\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\r\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\r\n      if (this._canvas.style.imageRendering === '') {\r\n        this._canvas.style.imageRendering = 'crisp-edges';\r\n      }\r\n    }\r\n\r\n    const widthUnit = this.viewport.widthUnit === 'percent' ? '%' : 'px';\r\n    const heightUnit = this.viewport.heightUnit === 'percent' ? '%' : 'px';\r\n\r\n    this._canvas.style.width = this.viewport.width + widthUnit;\r\n    this._canvas.style.height = this.viewport.height + heightUnit;\r\n\r\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\r\n    this.graphicsContext.updateViewport(this.resolution);\r\n    this.graphicsContext.resetTransform();\r\n    this.graphicsContext.smoothing = this._antialiasing;\r\n    if (this.graphicsContext instanceof ExcaliburGraphicsContext2DCanvas) {\r\n      this.graphicsContext.scale(this.pixelRatio, this.pixelRatio);\r\n    }\r\n    // Add the excalibur world pixel to page pixel\r\n    document.documentElement.style.setProperty('--ex-pixel-ratio', this.worldToPagePixelRatio.toString());\r\n  }\r\n\r\n  /**\r\n   * Get or set screen antialiasing,\r\n   *\r\n   * If true smoothing is applied\r\n   */\r\n  public get antialiasing() {\r\n    return this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Get or set screen antialiasing\r\n   */\r\n  public set antialiasing(isSmooth: boolean) {\r\n    this._antialiasing = isSmooth;\r\n    this.graphicsContext.smoothing = this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\r\n   * @deprecated use isFullscreen()\r\n   */\r\n  public get isFullScreen() {\r\n    return this._isFullscreen;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\r\n   */\r\n  public get isFullscreen() {\r\n    return this._isFullscreen;\r\n  }\r\n\r\n  /**\r\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   *\r\n   * Optionally specify a target element id to go fullscreen, by default the game canvas is used\r\n   * @param elementId\r\n   * @deprecated use enterFullscreen(...)\r\n   */\r\n  public goFullScreen(elementId?: string): Promise<void> {\r\n    return this.enterFullscreen(elementId);\r\n  }\r\n\r\n  /**\r\n   * Requests to enter fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   *\r\n   * Optionally specify a target element id to go fullscreen, by default the game canvas is used\r\n   * @param elementId\r\n   */\r\n  public enterFullscreen(elementId?: string): Promise<void> {\r\n    if (elementId) {\r\n      const maybeElement = document.getElementById(elementId);\r\n      if (maybeElement) {\r\n        if (!maybeElement.getAttribute('ex-fullscreen-listener')) {\r\n          maybeElement.setAttribute('ex-fullscreen-listener', 'true');\r\n          maybeElement.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n        }\r\n        const fullscreenPromise = maybeElement.requestFullscreen();\r\n        return fullscreenPromise;\r\n      }\r\n    }\r\n    return this._canvas.requestFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Requests to exit fullscreen using the browser fullscreen api\r\n   * @deprecated use exitFullscreen()\r\n   */\r\n  public exitFullScreen(): Promise<void> {\r\n    return this.exitFullscreen();\r\n  }\r\n\r\n  public exitFullscreen(): Promise<void> {\r\n    return document.exitFullscreen();\r\n  }\r\n\r\n  private _viewportToPixels(viewport: ViewportDimension) {\r\n    return {\r\n      width: viewport.widthUnit === 'percent' ? this.canvas.offsetWidth : viewport.width,\r\n      height: viewport.heightUnit === 'percent' ? this.canvas.offsetHeight : viewport.height\r\n    } satisfies ViewportDimension;\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\r\n   * Excalibur screen space.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY). When using *AndFill suffixed display modes screen space\r\n   * (0, 0) is the top left of the safe content area bounding box not the viewport.\r\n   * @param point\r\n   */\r\n  public pageToScreenCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    if (!this._isFullscreen) {\r\n      newX -= getPosition(this._canvas).x;\r\n      newY -= getPosition(this._canvas).y;\r\n    }\r\n\r\n    const viewport = this._viewportToPixels(this.viewport);\r\n\r\n    // if fullscreen api on it centers with black bars\r\n    // we need to adjust the screen to world coordinates in this case\r\n    if (this._isFullscreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = ((newY - screenMarginY) / screenHeight) * viewport.height;\r\n        newX = (newX / window.innerWidth) * viewport.width;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = ((newX - screenMarginX) / screenWidth) * viewport.width;\r\n        newY = (newY / window.innerHeight) * viewport.height;\r\n      }\r\n    }\r\n\r\n    newX = (newX / viewport.width) * this.resolution.width;\r\n    newY = (newY / viewport.height) * this.resolution.height;\r\n\r\n    // offset by content area\r\n    newX = newX - this.contentArea.left;\r\n    newY = newY - this.contentArea.top;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\r\n   * this is where html elements might live if you want to position them relative to Excalibur.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public screenToPageCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    // no need to offset by content area, drawing is already offset by this\r\n\r\n    const viewport = this._viewportToPixels(this.viewport);\r\n\r\n    newX = (newX / this.resolution.width) * viewport.width;\r\n    newY = (newY / this.resolution.height) * viewport.height;\r\n\r\n    if (this._isFullscreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = (newY / viewport.height) * screenHeight + screenMarginY;\r\n        newX = (newX / viewport.width) * window.innerWidth;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = (newX / viewport.width) * screenWidth + screenMarginX;\r\n        newY = (newY / viewport.height) * window.innerHeight;\r\n      }\r\n    }\r\n\r\n    if (!this._isFullscreen) {\r\n      newX += getPosition(this._canvas).x;\r\n      newY += getPosition(this._canvas).y;\r\n    }\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\r\n   *\r\n   * World space is where {@apilink Entity | `entities`} in Excalibur live by default {@apilink CoordPlane.World}\r\n   * and extends infinitely out relative from the {@apilink Camera}.\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    // offset by content area\r\n    point = point.add(vec(this.contentArea.left, this.contentArea.top));\r\n\r\n    // the only difference between screen & world is the camera transform\r\n    if (this._camera) {\r\n      return this._camera.inverse.multiply(point);\r\n    }\r\n    return point.sub(vec(this.resolution.width / 2, this.resolution.height / 2));\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\r\n   *\r\n   * Screen space is where {@apilink ScreenElement | `screen elements`} and {@apilink Entity | `entities`} with {@apilink CoordPlane.Screen} live.\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    if (this._camera) {\r\n      return this._camera.transform.multiply(point);\r\n    }\r\n    return point.add(vec(this.resolution.width / 2, this.resolution.height / 2));\r\n  }\r\n\r\n  public pageToWorldCoordinates(point: Vector): Vector {\r\n    const screen = this.pageToScreenCoordinates(point);\r\n    return this.screenToWorldCoordinates(screen);\r\n  }\r\n\r\n  public worldToPageCoordinates(point: Vector): Vector {\r\n    const screen = this.worldToScreenCoordinates(point);\r\n    return this.screenToPageCoordinates(screen);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   *\r\n   * World bounds are in world coordinates, useful for culling objects offscreen that are in world space\r\n   */\r\n  public getWorldBounds(): BoundingBox {\r\n    const bounds = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Half)\r\n      .scale(vec(1 / this._camera.zoom, 1 / this._camera.zoom))\r\n      .rotate(this._camera.rotation)\r\n      .translate(this._camera.drawPos);\r\n    return bounds;\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen and the bottom right corner of the screen.\r\n   *\r\n   * Screen bounds are in screen coordinates, useful for culling objects offscreen that are in screen space\r\n   */\r\n  public getScreenBounds(): BoundingBox {\r\n    const bounds = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero, Vector.Zero);\r\n    return bounds;\r\n  }\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.canvas.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.canvas.width / 2;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.canvas.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    if (this._camera) {\r\n      return this.resolution.width / this._camera.zoom;\r\n    }\r\n    return this.resolution.width;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get width(): number {\r\n    if (this._camera) {\r\n      return this.resolution.width / this._camera.zoom;\r\n    }\r\n    return this.resolution.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.drawWidth / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    if (this._camera) {\r\n      return this.resolution.height / this._camera.zoom;\r\n    }\r\n    return this.resolution.height;\r\n  }\r\n\r\n  public get height(): number {\r\n    if (this._camera) {\r\n      return this.resolution.height / this._camera.zoom;\r\n    }\r\n    return this.resolution.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.drawHeight / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns screen center coordinates including zoom and device pixel ratio.\r\n   */\r\n  public get center(): Vector {\r\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\r\n  }\r\n\r\n  /**\r\n   * Returns the content area in screen space where it is safe to place content\r\n   */\r\n  public get contentArea(): BoundingBox {\r\n    return this._contentArea;\r\n  }\r\n\r\n  /**\r\n   * Returns the unsafe area in screen space, this is the full screen and some space may not be onscreen.\r\n   */\r\n  public get unsafeArea(): BoundingBox {\r\n    return this._unsafeArea;\r\n  }\r\n\r\n  private _contentArea: BoundingBox = new BoundingBox();\r\n  private _unsafeArea: BoundingBox = new BoundingBox();\r\n\r\n  private _computeFit() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (window.innerWidth / aspect < window.innerHeight) {\r\n      adjustedWidth = window.innerWidth;\r\n      adjustedHeight = window.innerWidth / aspect;\r\n    } else {\r\n      adjustedWidth = window.innerHeight * aspect;\r\n      adjustedHeight = window.innerHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n    this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n    this._unsafeArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitScreenAndFill() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const vw = window.innerWidth;\r\n    const vh = window.innerHeight;\r\n    this._computeFitAndFill(vw, vh);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitContainerAndFill() {\r\n    this.canvas.style.width = '100%';\r\n    this.canvas.style.height = '100%';\r\n\r\n    this._computeFitAndFill(this.canvas.offsetWidth, this.canvas.offsetHeight, {\r\n      width: 100,\r\n      widthUnit: 'percent',\r\n      height: 100,\r\n      heightUnit: 'percent'\r\n    });\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitAndFill(vw: number, vh: number, viewport?: ViewportDimension) {\r\n    this.viewport = viewport ?? {\r\n      width: vw,\r\n      height: vh\r\n    };\r\n    // if the current screen aspectRatio is less than the original aspectRatio\r\n    if (vw / vh <= this._contentResolution.width / this._contentResolution.height) {\r\n      // compute new resolution to match the original aspect ratio\r\n      this.resolution = {\r\n        width: (vw * this._contentResolution.width) / vw,\r\n        height: (((vw * this._contentResolution.width) / vw) * vh) / vw\r\n      };\r\n      const clip = (this.resolution.height - this._contentResolution.height) / 2;\r\n      this._contentArea = new BoundingBox({\r\n        top: clip,\r\n        left: 0,\r\n        right: this._contentResolution.width,\r\n        bottom: this.resolution.height - clip\r\n      });\r\n      this._unsafeArea = new BoundingBox({\r\n        top: -clip,\r\n        left: 0,\r\n        right: this._contentResolution.width,\r\n        bottom: this.resolution.height + clip\r\n      });\r\n    } else {\r\n      this.resolution = {\r\n        width: (((vh * this._contentResolution.height) / vh) * vw) / vh,\r\n        height: (vh * this._contentResolution.height) / vh\r\n      };\r\n      const clip = (this.resolution.width - this._contentResolution.width) / 2;\r\n      this._contentArea = new BoundingBox({\r\n        top: 0,\r\n        left: clip,\r\n        right: this.resolution.width - clip,\r\n        bottom: this._contentResolution.height\r\n      });\r\n      this._unsafeArea = new BoundingBox({\r\n        top: 0,\r\n        left: -clip,\r\n        right: this.resolution.width + clip,\r\n        bottom: this._contentResolution.height\r\n      });\r\n    }\r\n  }\r\n\r\n  private _computeFitScreenAndZoom() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    this.canvas.style.position = 'absolute';\r\n\r\n    const vw = window.innerWidth;\r\n    const vh = window.innerHeight;\r\n\r\n    this._computeFitAndZoom(vw, vh);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitContainerAndZoom() {\r\n    this.canvas.style.width = '100%';\r\n    this.canvas.style.height = '100%';\r\n    this.canvas.style.position = 'relative';\r\n    const parent = this.canvas.parentElement;\r\n    parent.style.overflow = 'hidden';\r\n    const { offsetWidth: vw, offsetHeight: vh } = this.canvas;\r\n\r\n    this._computeFitAndZoom(vw, vh);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _computeFitAndZoom(vw: number, vh: number) {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (vw / aspect < vh) {\r\n      adjustedWidth = vw;\r\n      adjustedHeight = vw / aspect;\r\n    } else {\r\n      adjustedWidth = vh * aspect;\r\n      adjustedHeight = vh;\r\n    }\r\n\r\n    const scaleX = vw / adjustedWidth;\r\n    const scaleY = vh / adjustedHeight;\r\n\r\n    const maxScaleFactor = Math.max(scaleX, scaleY);\r\n\r\n    const zoomedWidth = adjustedWidth * maxScaleFactor;\r\n    const zoomedHeight = adjustedHeight * maxScaleFactor;\r\n\r\n    // Center zoomed dimension if bigger than the screen\r\n    if (zoomedWidth > vw) {\r\n      this.canvas.style.left = -(zoomedWidth - vw) / 2 + 'px';\r\n    } else {\r\n      this.canvas.style.left = '';\r\n    }\r\n\r\n    if (zoomedHeight > vh) {\r\n      this.canvas.style.top = -(zoomedHeight - vh) / 2 + 'px';\r\n    } else {\r\n      this.canvas.style.top = '';\r\n    }\r\n\r\n    this.viewport = {\r\n      width: zoomedWidth,\r\n      height: zoomedHeight\r\n    };\r\n\r\n    const bounds = BoundingBox.fromDimension(this.viewport.width, this.viewport.height, Vector.Zero);\r\n    // return safe area\r\n    if (this.viewport.width > vw) {\r\n      const clip = ((this.viewport.width - vw) / this.viewport.width) * this.resolution.width;\r\n      bounds.top = 0;\r\n      bounds.left = clip / 2;\r\n      bounds.right = this.resolution.width - clip / 2;\r\n      bounds.bottom = this.resolution.height;\r\n    }\r\n\r\n    if (this.viewport.height > vh) {\r\n      const clip = ((this.viewport.height - vh) / this.viewport.height) * this.resolution.height;\r\n      bounds.top = clip / 2;\r\n      bounds.left = 0;\r\n      bounds.bottom = this.resolution.height - clip / 2;\r\n      bounds.right = this.resolution.width;\r\n    }\r\n    this._contentArea = bounds;\r\n  }\r\n\r\n  private _computeFitContainer() {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    let widthUnit: ViewportUnit = 'pixel';\r\n    let heightUnit: ViewportUnit = 'pixel';\r\n    const parent = this.canvas.parentElement;\r\n    if (parent.clientWidth / aspect < parent.clientHeight) {\r\n      this.canvas.style.width = '100%';\r\n      adjustedWidth = 100;\r\n      widthUnit = 'percent';\r\n      adjustedHeight = this.canvas.offsetWidth / aspect;\r\n    } else {\r\n      this.canvas.style.height = '100%';\r\n      adjustedHeight = 100;\r\n      heightUnit = 'percent';\r\n      adjustedWidth = this.canvas.offsetHeight * aspect;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      widthUnit,\r\n      height: adjustedHeight,\r\n      heightUnit\r\n    };\r\n    this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n    this.events.emit('resize', {\r\n      resolution: this.resolution,\r\n      viewport: this.viewport\r\n    } satisfies ScreenResizeEvent);\r\n  }\r\n\r\n  private _applyDisplayMode() {\r\n    this._setResolutionAndViewportByDisplayMode(this.parent);\r\n\r\n    // watch resizing\r\n    if (this.parent instanceof Window) {\r\n      this._browser.window.on('resize', this._resizeHandler);\r\n    } else {\r\n      this._resizeObserver = new ResizeObserver(() => {\r\n        this._resizeHandler();\r\n      });\r\n      this._resizeObserver.observe(this.parent);\r\n    }\r\n    this.parent.addEventListener('resize', this._resizeHandler);\r\n  }\r\n\r\n  /**\r\n   * Sets the resolution and viewport based on the selected display mode.\r\n   */\r\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\r\n    if (this.displayMode === DisplayMode.FillContainer) {\r\n      this.canvas.style.width = '100%';\r\n      this.canvas.style.height = '100%';\r\n      this.viewport = {\r\n        width: 100,\r\n        widthUnit: 'percent',\r\n        height: 100,\r\n        heightUnit: 'percent'\r\n      };\r\n      this.resolution = {\r\n        width: this.canvas.offsetWidth,\r\n        height: this.canvas.offsetHeight\r\n      };\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FillScreen) {\r\n      document.body.style.margin = '0px';\r\n      document.body.style.overflow = 'hidden';\r\n      this.resolution = {\r\n        width: (<Window>parent).innerWidth,\r\n        height: (<Window>parent).innerHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n\r\n    if (this.displayMode === DisplayMode.FitScreen) {\r\n      this._computeFit();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainer) {\r\n      this._computeFitContainer();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreenAndFill) {\r\n      this._computeFitScreenAndFill();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainerAndFill) {\r\n      this._computeFitContainerAndFill();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreenAndZoom) {\r\n      this._computeFitScreenAndZoom();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainerAndZoom) {\r\n      this._computeFitContainerAndZoom();\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Internal class used to build instances of AudioContext\r\n */\r\n/* istanbul ignore next */\r\nexport class AudioContextFactory {\r\n  private static _INSTANCE?: AudioContext;\r\n\r\n  public static create(): AudioContext {\r\n    if (!this._INSTANCE) {\r\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\r\n        this._INSTANCE = new AudioContext();\r\n      }\r\n    }\r\n\r\n    return this._INSTANCE!;\r\n  }\r\n}\r\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\nimport { Logger } from './Log';\n\nexport interface LegacyWebAudioSource {\n  playbackState: string;\n  PLAYING_STATE: 'playing';\n  FINISHED_STATE: 'finished';\n}\n\n/**\n * Patch for detecting legacy web audio in browsers\n * @internal\n * @param source\n */\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\n  return !!source.playbackState;\n}\n\nexport class WebAudio {\n  private static _UNLOCKED: boolean = false;\n\n  /**\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\n   * right after a user interaction event.\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n   */\n  static unlock(): Promise<boolean> {\n    const promise = new Promise<boolean>((resolve, reject) => {\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\n        return resolve(true);\n      }\n      const unlockTimeoutTimer = setTimeout(() => {\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n        resolve(false);\n      }, 200);\n\n      const audioContext = AudioContextFactory.create();\n      audioContext.resume().then(\n        () => {\n          // create empty buffer and play it\n          const buffer = audioContext.createBuffer(1, 1, 22050);\n          const source = audioContext.createBufferSource();\n          let ended = false;\n\n          source.buffer = buffer;\n          source.connect(audioContext.destination);\n          source.onended = () => (ended = true);\n\n          source.start(0);\n\n          // by checking the play state after some time, we know if we're really unlocked\n          setTimeout(() => {\n            if (isLegacyWebAudioSource(source)) {\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n                WebAudio._UNLOCKED = true;\n              }\n            } else {\n              if (audioContext.currentTime > 0 || ended) {\n                WebAudio._UNLOCKED = true;\n              }\n            }\n          }, 0);\n\n          clearTimeout(unlockTimeoutTimer);\n          resolve(true);\n        },\n        () => {\n          reject();\n        }\n      );\n    });\n\n    return promise;\n  }\n\n  static isUnlocked() {\n    return this._UNLOCKED;\n  }\n}\n","import { GraphicOptions } from './Graphic';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CanvasOptions {\r\n  draw?: (ctx: CanvasRenderingContext2D) => void;\r\n  cache?: boolean;\r\n}\r\n\r\n/**\r\n * A canvas {@apilink Graphic} to provide an adapter between the 2D Canvas API and the {@apilink ExcaliburGraphicsContext}.\r\n *\r\n * The {@apilink Canvas} works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\r\n * to the {@apilink ExcaliburGraphicsContext} implementation as a rendered image.\r\n *\r\n * **Low performance API**\r\n */\r\nexport class Canvas extends Raster {\r\n  /**\r\n   * Return the 2D graphics context of this canvas\r\n   */\r\n  public get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions = {}) {\r\n    super(_options);\r\n  }\r\n\r\n  public clone(): Canvas {\r\n    return new Canvas({\r\n      ...this._options,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this._options?.draw) {\r\n      this._options?.draw(ctx);\r\n    }\r\n    if (!this._options.cache) {\r\n      this.flagDirty();\r\n    }\r\n  }\r\n}\r\n","import { Audio } from './Audio';\r\n\r\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\r\n\r\nexport interface ExResponseTypesLookup {\r\n  [name: string]: ExResponseType;\r\n}\r\n\r\nexport class ExResponse {\r\n  public static type: ExResponseTypesLookup = {\r\n    any: '',\r\n    blob: 'blob',\r\n    json: 'json',\r\n    text: 'text',\r\n    document: 'document',\r\n    arraybuffer: 'arraybuffer'\r\n  };\r\n}\r\n\r\n/**\r\n * Represents an audio implementation like {@apilink WebAudioInstance}\r\n */\r\nexport interface AudioImplementation {\r\n  /**\r\n   * XHR response type\r\n   */\r\n  responseType: ExResponseType;\r\n\r\n  /**\r\n   * Processes raw data and transforms into sound data\r\n   */\r\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\r\n\r\n  /**\r\n   * Factory method that returns an instance of a played audio track\r\n   */\r\n  createInstance(data: string | AudioBuffer): Audio;\r\n}\r\n","export interface State<TData> {\r\n  name?: string;\r\n  transitions: string[];\r\n  onEnter?: (context: { from: string; eventData?: any; data: TData }) => boolean | void;\r\n  onState?: () => any;\r\n  onExit?: (context: { to: string; data: TData }) => boolean | void;\r\n  onUpdate?: (data: TData, elapsed: number) => any;\r\n}\r\n\r\nexport interface StateMachineDescription<TData = any> {\r\n  start: string;\r\n  states: { [name: string]: State<TData> };\r\n}\r\n\r\nexport type PossibleStates<TMachine> = TMachine extends StateMachineDescription ? Extract<keyof TMachine['states'], string> : never;\r\n\r\nexport interface StateMachineState<TData> {\r\n  data: TData;\r\n  currentState: string;\r\n}\r\n\r\nexport class StateMachine<TPossibleStates extends string, TData> {\r\n  public startState: State<TData>;\r\n  private _currentState: State<TData>;\r\n  public get currentState(): State<TData> {\r\n    return this._currentState;\r\n  }\r\n  public set currentState(state: State<TData>) {\r\n    this._currentState = state;\r\n  }\r\n  public states = new Map<string, State<TData>>();\r\n  public data: TData;\r\n\r\n  static create<TMachine extends StateMachineDescription<TData>, TData>(\r\n    machineDescription: TMachine,\r\n    data?: TData\r\n  ): StateMachine<PossibleStates<TMachine>, TData> {\r\n    const machine = new StateMachine<PossibleStates<TMachine>, TData>();\r\n    machine.data = data;\r\n    for (const stateName in machineDescription.states) {\r\n      machine.states.set(stateName as PossibleStates<TMachine>, {\r\n        name: stateName,\r\n        ...machineDescription.states[stateName]\r\n      });\r\n    }\r\n\r\n    // validate transitions are states\r\n    for (const state of machine.states.values()) {\r\n      for (const transitionState of state.transitions) {\r\n        if (transitionState === '*') {\r\n          continue;\r\n        }\r\n        if (!machine.states.has(transitionState)) {\r\n          throw Error(\r\n            `Invalid state machine, state [${state.name}] has a transition to another state that doesn't exist [${transitionState}]`\r\n          );\r\n        }\r\n      }\r\n    }\r\n    machine.currentState = machine.startState = machine.states.get(machineDescription.start);\r\n    return machine;\r\n  }\r\n\r\n  in(state: TPossibleStates): boolean {\r\n    return this.currentState.name === state;\r\n  }\r\n\r\n  go(stateName: TPossibleStates, eventData?: any): boolean {\r\n    if (this.currentState.transitions.includes(stateName) || this.currentState.transitions.includes('*')) {\r\n      const potentialNewState = this.states.get(stateName);\r\n      if (this.currentState.onExit) {\r\n        const canExit = this.currentState?.onExit({ to: potentialNewState.name, data: this.data });\r\n        if (canExit === false) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      if (potentialNewState?.onEnter) {\r\n        const canEnter = potentialNewState?.onEnter({ from: this.currentState.name, eventData, data: this.data });\r\n        if (canEnter === false) {\r\n          return false;\r\n        }\r\n      }\r\n      this.currentState = potentialNewState;\r\n      if (this.currentState?.onState) {\r\n        this.currentState.onState();\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  update(elapsed: number) {\r\n    if (this.currentState.onUpdate) {\r\n      this.currentState.onUpdate(this.data, elapsed);\r\n    }\r\n  }\r\n\r\n  save(saveKey: string) {\r\n    localStorage.setItem(\r\n      saveKey,\r\n      JSON.stringify({\r\n        currentState: this.currentState.name,\r\n        data: this.data\r\n      })\r\n    );\r\n  }\r\n\r\n  restore(saveKey: string) {\r\n    const state: StateMachineState<TData> = JSON.parse(localStorage.getItem(saveKey));\r\n    this.currentState = this.states.get(state.currentState);\r\n    this.data = state.data;\r\n  }\r\n}\r\n","import { StateMachine } from '../../Util/StateMachine';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { clamp } from '../../Math/util';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { Future } from '../../Util/Future';\r\n\r\ninterface SoundState {\r\n  startedAt: number;\r\n  pausedAt: number;\r\n}\r\n\r\n/**\r\n * Internal class representing a Web Audio AudioBufferSourceNode instance\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\r\n */\r\nexport class WebAudioInstance implements Audio {\r\n  private _instance!: AudioBufferSourceNode;\r\n  private _audioContext: AudioContext = AudioContextFactory.create();\r\n  private _volumeNode = this._audioContext.createGain();\r\n\r\n  private _playingFuture = new Future<boolean>();\r\n  private _stateMachine = StateMachine.create(\r\n    {\r\n      start: 'STOPPED',\r\n      states: {\r\n        PLAYING: {\r\n          onEnter: ({ data }) => {\r\n            // Buffer nodes are single use\r\n            this._createNewBufferSource();\r\n            this._handleEnd();\r\n            if (this.loop) {\r\n              // when looping don't set a duration\r\n              this._instance.start(0, data.pausedAt * this._playbackRate);\r\n            } else {\r\n              this._instance.start(0, data.pausedAt * this._playbackRate, this.duration);\r\n            }\r\n            data.startedAt = this._audioContext.currentTime - data.pausedAt;\r\n            data.pausedAt = 0;\r\n          },\r\n          onState: () => this._playStarted(),\r\n          onExit: ({ to }) => {\r\n            // If you've exited early only resolve if explicitly STOPPED\r\n            if (to === 'STOPPED') {\r\n              this._playingFuture.resolve(true);\r\n            }\r\n            // Whenever you're not playing... you stop!\r\n            this._instance.onended = null; // disconnect the wired on-end handler\r\n            this._instance.disconnect();\r\n            this._instance.stop(0);\r\n            this._instance = null as any;\r\n          },\r\n          transitions: ['STOPPED', 'PAUSED', 'SEEK']\r\n        },\r\n        SEEK: {\r\n          onEnter: ({ eventData: position, data }: { eventData?: number; data: SoundState }) => {\r\n            data.pausedAt = (position ?? 0) / this._playbackRate;\r\n            data.startedAt = 0;\r\n          },\r\n          transitions: ['*']\r\n        },\r\n        STOPPED: {\r\n          onEnter: ({ data }) => {\r\n            data.pausedAt = 0;\r\n            data.startedAt = 0;\r\n            this._playingFuture.resolve(true);\r\n          },\r\n          transitions: ['PLAYING', 'PAUSED', 'SEEK']\r\n        },\r\n        PAUSED: {\r\n          onEnter: ({ data }) => {\r\n            // Playback rate will be a scale factor of how fast/slow the audio is being played\r\n            // default is 1.0\r\n            // we need to invert it to get the time scale\r\n            data.pausedAt = this._audioContext.currentTime - data.startedAt;\r\n          },\r\n          transitions: ['PLAYING', 'STOPPED', 'SEEK']\r\n        }\r\n      }\r\n    },\r\n    {\r\n      startedAt: 0,\r\n      pausedAt: 0\r\n    } satisfies SoundState\r\n  );\r\n\r\n  private _createNewBufferSource() {\r\n    this._instance = this._audioContext.createBufferSource();\r\n    this._instance.buffer = this._src;\r\n    this._instance.loop = this.loop;\r\n    this._instance.playbackRate.value = this._playbackRate;\r\n    this._instance.connect(this._volumeNode);\r\n    this._volumeNode.connect(this._audioContext.destination);\r\n  }\r\n\r\n  private _handleEnd() {\r\n    if (!this.loop) {\r\n      this._instance.onended = () => {\r\n        this._playingFuture.resolve(true);\r\n      };\r\n    }\r\n  }\r\n\r\n  private _volume = 1;\r\n  private _loop = false;\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  private _playStarted: () => any = () => {};\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    if (this._instance) {\r\n      this._instance.loop = value;\r\n      if (!this.loop) {\r\n        this._instance.onended = () => {\r\n          this._playingFuture.resolve(true);\r\n        };\r\n      }\r\n    }\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    value = clamp(value, 0, 1.0);\r\n\r\n    this._volume = value;\r\n\r\n    if (this._stateMachine.in('PLAYING') && this._volumeNode.gain.setTargetAtTime) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\r\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\r\n      // This exponential ramp provides a more pleasant transition in gain\r\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\r\n    } else {\r\n      this._volumeNode.gain.value = value;\r\n    }\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  private _duration: number | undefined;\r\n  /**\r\n   * Returns the set duration to play, otherwise returns the total duration if unset\r\n   */\r\n  public get duration() {\r\n    return this._duration ?? this.getTotalPlaybackDuration();\r\n  }\r\n\r\n  /**\r\n   * Set the duration that this audio should play.\r\n   *\r\n   * Note: if you seek to a specific point the duration will start from that point, for example\r\n   *\r\n   * If you have a 10 second clip, seek to 5 seconds, then set the duration to 2, it will play the clip from 5-7 seconds.\r\n   */\r\n  public set duration(duration: number) {\r\n    this._duration = duration;\r\n  }\r\n\r\n  constructor(private _src: AudioBuffer) {\r\n    this._createNewBufferSource();\r\n  }\r\n\r\n  public isPlaying() {\r\n    return this._stateMachine.in('PLAYING');\r\n  }\r\n\r\n  public isPaused() {\r\n    return this._stateMachine.in('PAUSED') || this._stateMachine.in('SEEK');\r\n  }\r\n\r\n  public isStopped() {\r\n    return this._stateMachine.in('STOPPED');\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  public play(playStarted: () => any = () => {}) {\r\n    this._playStarted = playStarted;\r\n    this._stateMachine.go('PLAYING');\r\n    return this._playingFuture.promise;\r\n  }\r\n\r\n  public pause() {\r\n    this._stateMachine.go('PAUSED');\r\n  }\r\n\r\n  public stop() {\r\n    this._stateMachine.go('STOPPED');\r\n  }\r\n\r\n  public seek(position: number) {\r\n    this._stateMachine.go('PAUSED');\r\n    this._stateMachine.go('SEEK', position);\r\n  }\r\n\r\n  public getTotalPlaybackDuration() {\r\n    return this._src.duration;\r\n  }\r\n\r\n  public getPlaybackPosition() {\r\n    const { pausedAt, startedAt } = this._stateMachine.data;\r\n    if (pausedAt) {\r\n      return pausedAt * this._playbackRate;\r\n    }\r\n    if (startedAt) {\r\n      return (this._audioContext.currentTime - startedAt) * this._playbackRate;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  private _playbackRate = 1.0;\r\n  public set playbackRate(playbackRate: number) {\r\n    this._instance.playbackRate.value = this._playbackRate = playbackRate;\r\n  }\r\n\r\n  public get playbackRate() {\r\n    return this._instance.playbackRate.value;\r\n  }\r\n}\r\n","import { GameEvent } from '../Events';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Actor } from '../Actor';\r\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\r\n\r\nexport class MediaEvent extends GameEvent<Sound> {\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public set bubbles(_value: boolean) {\r\n    // stubbed\r\n  }\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public get bubbles(): boolean {\r\n    return false;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected get _path(): Actor[] {\r\n    return null;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected set _path(_val: Actor[]) {\r\n    // stubbed\r\n  }\r\n\r\n  constructor(\r\n    public target: Sound,\r\n    protected _name: string = 'MediaEvent'\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public action(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Propagate event further through event path\r\n   */\r\n  public propagate(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n\r\n  public layPath(_actor: Actor): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n}\r\n\r\nexport class NativeSoundEvent extends MediaEvent {\r\n  constructor(\r\n    target: Sound,\r\n    public track?: WebAudioInstance\r\n  ) {\r\n    super(target, 'NativeSoundEvent');\r\n  }\r\n}\r\n\r\nexport class NativeSoundProcessedEvent extends MediaEvent {\r\n  public data: string | AudioBuffer;\r\n\r\n  constructor(\r\n    target: Sound,\r\n    private _processedData: string | AudioBuffer\r\n  ) {\r\n    super(target, 'NativeSoundProcessedEvent');\r\n\r\n    this.data = this._processedData;\r\n  }\r\n}\r\n","import { Logger } from './Log';\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nexport function canPlayFile(file: string): boolean {\n  try {\n    const a = new Audio();\n    const filetype = /.*\\.([A-Za-z0-9]+)(?:(?:\\?|\\#).*)*$/;\n    const type = file.match(filetype)[1];\n    if (a.canPlayType('audio/' + type)) {\n      return true;\n    } else {\n      return false;\n    }\n  } catch (e) {\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n    return false;\n  }\n}\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { Engine } from '../../Engine';\r\nimport { Resource } from '../Resource';\r\nimport { WebAudioInstance } from './WebAudioInstance';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\r\nimport { canPlayFile } from '../../Util/Sound';\r\nimport { Loadable } from '../../Interfaces/Index';\r\nimport { Logger } from '../../Util/Log';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../../EventEmitter';\r\n\r\nexport type SoundEvents = {\r\n  volumechange: NativeSoundEvent;\r\n  processed: NativeSoundProcessedEvent;\r\n  pause: NativeSoundEvent;\r\n  stop: NativeSoundEvent;\r\n  playbackend: NativeSoundEvent;\r\n  resume: NativeSoundEvent;\r\n  playbackstart: NativeSoundEvent;\r\n};\r\n\r\nexport const SoundEvents = {\r\n  VolumeChange: 'volumechange',\r\n  Processed: 'processed',\r\n  Pause: 'pause',\r\n  Stop: 'stop',\r\n  PlaybackEnd: 'playbackend',\r\n  Resume: 'resume',\r\n  PlaybackStart: 'playbackstart'\r\n};\r\n\r\n/**\r\n * The {@apilink Sound} object allows games built in Excalibur to load audio\r\n * components, from soundtracks to sound effects. {@apilink Sound} is an {@apilink Loadable}\r\n * which means it can be passed to a {@apilink Loader} to pre-load before a game or level.\r\n */\r\nexport class Sound implements Audio, Loadable<AudioBuffer> {\r\n  public events = new EventEmitter<SoundEvents>();\r\n  public logger: Logger = Logger.getInstance();\r\n  public data!: AudioBuffer;\r\n  private _resource: Resource<ArrayBuffer>;\r\n  /**\r\n   * Indicates whether the clip should loop when complete\r\n   * @param value  Set the looping flag\r\n   */\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.loop = this._loop;\r\n    }\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    this._volume = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.volume = this._volume;\r\n    }\r\n\r\n    this.events.emit('volumechange', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  private _duration: number | undefined;\r\n  /**\r\n   * Get the duration that this audio should play. If unset the total natural playback duration will be used.\r\n   */\r\n  public get duration(): number | undefined {\r\n    return this._duration;\r\n  }\r\n  /**\r\n   * Set the duration that this audio should play. If unset the total natural playback duration will be used.\r\n   *\r\n   * Note: if you seek to a specific point the duration will start from that point, for example\r\n   *\r\n   * If you have a 10 second clip, seek to 5 seconds, then set the duration to 2, it will play the clip from 5-7 seconds.\r\n   */\r\n  public set duration(duration: number | undefined) {\r\n    this._duration = duration;\r\n  }\r\n\r\n  /**\r\n   * Return array of Current AudioInstances playing or being paused\r\n   */\r\n  public get instances(): Audio[] {\r\n    return this._tracks;\r\n  }\r\n\r\n  public get path() {\r\n    return this._resource.path;\r\n  }\r\n\r\n  public set path(val: string) {\r\n    this._resource.path = val;\r\n  }\r\n\r\n  /**\r\n   * Should excalibur add a cache busting querystring? By default false.\r\n   * Must be set before loading\r\n   */\r\n  public get bustCache() {\r\n    return this._resource.bustCache;\r\n  }\r\n\r\n  public set bustCache(val: boolean) {\r\n    this._resource.bustCache = val;\r\n  }\r\n\r\n  private _loop = false;\r\n  private _volume = 1;\r\n  private _isStopped = false;\r\n  // private _isPaused = false;\r\n  private _tracks: Audio[] = [];\r\n  private _engine?: Engine;\r\n  private _wasPlayingOnHidden: boolean = false;\r\n  private _playbackRate = 1.0;\r\n  private _audioContext = AudioContextFactory.create();\r\n\r\n  /**\r\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\r\n   */\r\n  constructor(...paths: string[]) {\r\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\r\n    /**\r\n     * Chrome : MP3, WAV, Ogg\r\n     * Firefox : WAV, Ogg,\r\n     * IE : MP3, WAV coming soon\r\n     * Safari MP3, WAV, Ogg\r\n     */\r\n    for (const path of paths) {\r\n      if (canPlayFile(path)) {\r\n        this.path = path;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!this.path) {\r\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\r\n      this.logger.warn('Attempting to use', paths[0]);\r\n      this.path = paths[0]; // select the first specified\r\n    }\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  public async load(): Promise<AudioBuffer> {\r\n    if (this.data) {\r\n      return this.data;\r\n    }\r\n    const arraybuffer = await this._resource.load();\r\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\r\n    this._duration = this._duration ?? audiobuffer?.duration ?? undefined;\r\n    this.events.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\r\n    return (this.data = audiobuffer);\r\n  }\r\n\r\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\r\n    try {\r\n      return await this._audioContext.decodeAudioData(data.slice(0));\r\n    } catch (e) {\r\n      this.logger.error(\r\n        'Unable to decode ' +\r\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\r\n          'if this is an mp3 try removing id3 tags and album art from the file.'\r\n      );\r\n      return await Promise.reject();\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    if (engine) {\r\n      this._engine = engine;\r\n\r\n      this._engine.on('hidden', () => {\r\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\r\n          this._wasPlayingOnHidden = true;\r\n          this.pause();\r\n        }\r\n      });\r\n\r\n      this._engine.on('visible', () => {\r\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\r\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n          this.play();\r\n          this._wasPlayingOnHidden = false;\r\n        }\r\n      });\r\n\r\n      this._engine.on('start', () => {\r\n        this._isStopped = false;\r\n      });\r\n\r\n      this._engine.on('stop', () => {\r\n        this.stop();\r\n        this._isStopped = true;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns how many instances of the sound are currently playing\r\n   */\r\n  public instanceCount(): number {\r\n    return this._tracks.length;\r\n  }\r\n\r\n  /**\r\n   * Whether or not the sound is playing right now\r\n   */\r\n  public isPlaying(): boolean {\r\n    return this._tracks.some((t) => t.isPlaying());\r\n  }\r\n\r\n  public isPaused(): boolean {\r\n    return this._tracks.some((t) => t.isPaused());\r\n  }\r\n\r\n  public isStopped(): boolean {\r\n    return this._tracks.some((t) => t.isStopped());\r\n  }\r\n\r\n  /**\r\n   * Play the sound, returns a promise that resolves when the sound is done playing\r\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\r\n   */\r\n  public play(volume?: number): Promise<boolean> {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\r\n\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    if (this._isStopped) {\r\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\r\n      return Promise.resolve(false);\r\n    }\r\n\r\n    this.volume = volume || this.volume;\r\n\r\n    if (this.isPaused()) {\r\n      return this._resumePlayback();\r\n    } else {\r\n      return this._startPlayback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop the sound, and do not rewind\r\n   */\r\n  public pause() {\r\n    if (!this.isPlaying()) {\r\n      return;\r\n    }\r\n\r\n    for (const track of this._tracks) {\r\n      track.pause();\r\n    }\r\n\r\n    this.events.emit('pause', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Paused all instances of sound', this.path);\r\n  }\r\n\r\n  /**\r\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\r\n   */\r\n  public stop() {\r\n    for (const track of this._tracks) {\r\n      track.stop();\r\n    }\r\n\r\n    this.events.emit('stop', new NativeSoundEvent(this));\r\n\r\n    this._tracks.length = 0;\r\n    this.logger.debug('Stopped all instances of sound', this.path);\r\n  }\r\n\r\n  public get playbackRate(): number {\r\n    return this._playbackRate;\r\n  }\r\n\r\n  public set playbackRate(playbackRate: number) {\r\n    this._playbackRate = playbackRate;\r\n    this._tracks.forEach((t) => {\r\n      t.playbackRate = this._playbackRate;\r\n    });\r\n  }\r\n\r\n  public seek(position: number, trackId = 0) {\r\n    if (this._tracks.length === 0) {\r\n      this._getTrackInstance(this.data);\r\n    }\r\n\r\n    this._tracks[trackId].seek(position);\r\n  }\r\n\r\n  public getTotalPlaybackDuration() {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warnOnce(\r\n        `Sound from ${this.path} is not loaded, cannot return total playback duration.` +\r\n          `Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`\r\n      );\r\n      return 0;\r\n    }\r\n    return this.data.duration;\r\n  }\r\n\r\n  /**\r\n   * Return the current playback time of the playing track in seconds from the start.\r\n   *\r\n   * Optionally specify the track to query if multiple are playing at once.\r\n   * @param trackId\r\n   */\r\n  public getPlaybackPosition(trackId = 0) {\r\n    if (this._tracks.length) {\r\n      return this._tracks[trackId].getPlaybackPosition();\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Get Id of provided AudioInstance in current trackList\r\n   * @param track {@apilink Audio} which Id is to be given\r\n   */\r\n  public getTrackId(track: Audio): number {\r\n    return this._tracks.indexOf(track);\r\n  }\r\n\r\n  private async _resumePlayback(): Promise<boolean> {\r\n    if (this.isPaused()) {\r\n      const resumed: Promise<boolean>[] = [];\r\n      // ensure we resume *current* tracks (if paused)\r\n      for (const track of this._tracks) {\r\n        resumed.push(\r\n          track.play().then(() => {\r\n            this._tracks.splice(this.getTrackId(track), 1);\r\n            return true;\r\n          })\r\n        );\r\n      }\r\n\r\n      this.events.emit('resume', new NativeSoundEvent(this));\r\n\r\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\r\n      // resolve when resumed tracks are done\r\n      await Promise.all(resumed);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Starts playback, returns a promise that resolves when playback is complete\r\n   */\r\n  private async _startPlayback(): Promise<boolean> {\r\n    const track = this._getTrackInstance(this.data);\r\n\r\n    const complete = await track.play(() => {\r\n      this.events.emit('playbackstart', new NativeSoundEvent(this, track));\r\n      this.logger.debug('Playing new instance for sound', this.path);\r\n    });\r\n\r\n    this.events.emit('playbackend', new NativeSoundEvent(this, track));\r\n\r\n    // cleanup any done tracks\r\n    const trackId = this.getTrackId(track);\r\n    if (trackId !== -1) {\r\n      this._tracks.splice(trackId, 1);\r\n    }\r\n\r\n    return complete;\r\n  }\r\n\r\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\r\n    const newTrack = new WebAudioInstance(data);\r\n\r\n    newTrack.loop = this.loop;\r\n    newTrack.volume = this.volume;\r\n    newTrack.duration = this.duration ?? 0;\r\n    newTrack.playbackRate = this._playbackRate;\r\n\r\n    this._tracks.push(newTrack);\r\n\r\n    return newTrack;\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<SoundEvents>>(eventName: TEventName, event: SoundEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<SoundEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<SoundEvents>>(eventName: TEventName, handler: Handler<SoundEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<SoundEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<SoundEvents>>(eventName: TEventName, handler: Handler<SoundEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<SoundEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<SoundEvents>>(eventName: TEventName, handler: Handler<SoundEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<SoundEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler as any);\r\n  }\r\n}\r\n","import { WebAudio } from '../Util/WebAudio';\r\nimport { Engine } from '../Engine';\r\nimport { Loadable } from '../Interfaces/Loadable';\r\nimport { Canvas } from '../Graphics/Canvas';\r\nimport { ImageFiltering } from '../Graphics/Filtering';\r\nimport { clamp } from '../Math/util';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Future } from '../Util/Future';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\nimport { Color } from '../Color';\r\nimport { delay } from '../Util/Util';\r\n\r\nexport interface DefaultLoaderOptions {\r\n  /**\r\n   * List of loadables\r\n   */\r\n  loadables?: Loadable<any>[];\r\n}\r\n\r\nexport type LoaderEvents = {\r\n  // Add event types here\r\n  beforeload: void;\r\n  afterload: void;\r\n  useraction: void;\r\n  loadresourcestart: Loadable<any>;\r\n  loadresourceend: Loadable<any>;\r\n};\r\n\r\nexport const LoaderEvents = {\r\n  // Add event types here\r\n  BeforeLoad: 'beforeload',\r\n  AfterLoad: 'afterload',\r\n  UserAction: 'useraction',\r\n  LoadResourceStart: 'loadresourcestart',\r\n  LoadResourceEnd: 'loadresourceend'\r\n};\r\n\r\nexport type LoaderConstructor = new (...args: any[]) => DefaultLoader;\r\n/**\r\n * Returns true if the constructor is for an Excalibur Loader\r\n */\r\nexport function isLoaderConstructor(x: any): x is LoaderConstructor {\r\n  return !!x?.prototype && !!x?.prototype?.constructor?.name;\r\n}\r\n\r\nexport class DefaultLoader implements Loadable<Loadable<any>[]> {\r\n  public data!: Loadable<any>[];\r\n  public events = new EventEmitter<LoaderEvents>();\r\n  public canvas: Canvas = new Canvas({\r\n    filtering: ImageFiltering.Blended,\r\n    smoothing: true,\r\n    cache: false,\r\n    draw: this.onDraw.bind(this)\r\n  });\r\n  private _resources: Loadable<any>[] = [];\r\n  public get resources(): readonly Loadable<any>[] {\r\n    return this._resources;\r\n  }\r\n  private _numLoaded: number = 0;\r\n  public engine!: Engine;\r\n\r\n  /**\r\n   * @param options Optionally provide the list of resources you want to load at constructor time\r\n   */\r\n  constructor(options?: DefaultLoaderOptions) {\r\n    if (options && options.loadables?.length) {\r\n      this.addResources(options.loadables);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Called by the engine before loading\r\n   * @param engine\r\n   */\r\n  public onInitialize(engine: Engine) {\r\n    this.engine = engine;\r\n    this.canvas.width = this.engine.screen.resolution.width;\r\n    this.canvas.height = this.engine.screen.resolution.height;\r\n  }\r\n\r\n  /**\r\n   * Return a promise that resolves when the user interacts with the loading screen in some way, usually a click.\r\n   *\r\n   * It's important to implement this in order to unlock the audio context in the browser. Browsers automatically prevent\r\n   * audio from playing until the user performs an action.\r\n   *\r\n   */\r\n  public async onUserAction(): Promise<void> {\r\n    return await Promise.resolve();\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called directly before loading starts\r\n   */\r\n  public async onBeforeLoad() {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called after loading has completed\r\n   */\r\n  public async onAfterLoad() {\r\n    // override me\r\n    await delay(500, this.engine.clock); // avoid a flicker\r\n  }\r\n\r\n  /**\r\n   * Add a resource to the loader to load\r\n   * @param loadable  Resource to add\r\n   */\r\n  public addResource(loadable: Loadable<any>) {\r\n    this._resources.push(loadable);\r\n  }\r\n\r\n  /**\r\n   * Add a list of resources to the loader to load\r\n   * @param loadables  The list of resources to load\r\n   */\r\n  public addResources(loadables: Loadable<any>[]) {\r\n    let i = 0;\r\n    const len = loadables.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this.addResource(loadables[i]);\r\n    }\r\n  }\r\n\r\n  public markResourceComplete(): void {\r\n    this._numLoaded++;\r\n  }\r\n\r\n  /**\r\n   * Returns the progress of the loader as a number between [0, 1] inclusive.\r\n   */\r\n  public get progress(): number {\r\n    const total = this._resources.length;\r\n    return total > 0 ? clamp(this._numLoaded, 0, total) / total : 1;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the loader has completely loaded all resources\r\n   */\r\n  public isLoaded() {\r\n    return this._numLoaded === this._resources.length;\r\n  }\r\n\r\n  private _totalTimeMs = 0;\r\n\r\n  /**\r\n   * Optionally override the onUpdate\r\n   * @param engine\r\n   * @param elapsed\r\n   */\r\n  onUpdate(engine: Engine, elapsed: number): void {\r\n    this._totalTimeMs += elapsed;\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Optionally override the onDraw\r\n   */\r\n  onDraw(ctx: CanvasRenderingContext2D) {\r\n    const seconds = this._totalTimeMs / 1000;\r\n\r\n    ctx.fillStyle = Color.Black.toRGBA();\r\n    ctx.fillRect(0, 0, this.engine.screen.resolution.width, this.engine.screen.resolution.height);\r\n\r\n    ctx.save();\r\n    ctx.translate(this.engine.screen.resolution.width / 2, this.engine.screen.resolution.height / 2);\r\n    const speed = seconds * 10;\r\n    ctx.strokeStyle = 'white';\r\n    ctx.lineWidth = 10;\r\n    ctx.lineCap = 'round';\r\n    ctx.arc(0, 0, 40, speed, speed + (Math.PI * 3) / 2);\r\n    ctx.stroke();\r\n\r\n    ctx.fillStyle = 'white';\r\n    ctx.font = '16px sans-serif';\r\n    const text = (this.progress * 100).toFixed(0) + '%';\r\n    const textbox = ctx.measureText(text);\r\n    const width = Math.abs(textbox.actualBoundingBoxLeft) + Math.abs(textbox.actualBoundingBoxRight);\r\n    const height = Math.abs(textbox.actualBoundingBoxAscent) + Math.abs(textbox.actualBoundingBoxDescent);\r\n    ctx.fillText(text, -width / 2, height / 2); // center\r\n    ctx.restore();\r\n  }\r\n\r\n  private _loadingFuture = new Future<void>();\r\n  public areResourcesLoaded() {\r\n    if (this._resources.length === 0) {\r\n      // special case no resources mean loaded;\r\n      return Promise.resolve();\r\n    }\r\n    return this._loadingFuture.promise;\r\n  }\r\n\r\n  /**\r\n   * Not meant to be overridden\r\n   *\r\n   * Begin loading all of the supplied resources, returning a promise\r\n   * that resolves when loading of all is complete AND the user has interacted with the loading screen\r\n   */\r\n  public async load(): Promise<Loadable<any>[]> {\r\n    await this.onBeforeLoad();\r\n    this.events.emit('beforeload');\r\n    this.canvas.flagDirty();\r\n\r\n    await Promise.all(\r\n      this._resources.map(async (r) => {\r\n        this.events.emit('loadresourcestart', r);\r\n        await r.load().finally(() => {\r\n          // capture progress\r\n          this._numLoaded++;\r\n          this.canvas.flagDirty();\r\n          this.events.emit('loadresourceend', r);\r\n        });\r\n      })\r\n    );\r\n\r\n    // Wire all sound to the engine\r\n    for (const resource of this._resources) {\r\n      if (resource instanceof Sound) {\r\n        resource.wireEngine(this.engine);\r\n      }\r\n    }\r\n\r\n    this._loadingFuture.resolve();\r\n    this.canvas.flagDirty();\r\n    // Unlock browser AudioContext in after user gesture\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\r\n    await this.onUserAction();\r\n    this.events.emit('useraction');\r\n    await WebAudio.unlock();\r\n\r\n    await this.onAfterLoad();\r\n    this.events.emit('afterload');\r\n    return (this.data = this._resources);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<LoaderEvents>>(eventName: TEventName, event: LoaderEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<LoaderEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<LoaderEvents>>(eventName: TEventName, handler: Handler<LoaderEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<LoaderEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<LoaderEvents>>(eventName: TEventName, handler: Handler<LoaderEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<LoaderEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<LoaderEvents>>(eventName: TEventName, handler: Handler<LoaderEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<LoaderEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    (this.events as any).off(eventName, handler);\r\n  }\r\n}\r\n","import { Color } from '../Color';\r\nimport { Loadable } from '../Interfaces/Loadable';\r\nimport * as DrawUtil from '../Util/DrawUtil';\r\n\r\nimport logoImg from './Loader.logo.png';\r\nimport loaderCss from './Loader.css';\r\nimport { Vector } from '../Math/vector';\r\nimport { delay } from '../Util/Util';\r\nimport { EventEmitter } from '../EventEmitter';\r\nimport { DefaultLoader, DefaultLoaderOptions } from './DefaultLoader';\r\nimport { Engine } from '../Engine';\r\nimport { Screen } from '../Screen';\r\nimport { Logger } from '../Util/Log';\r\nimport { Future } from '../Util/Future';\r\n\r\nexport interface LoaderOptions extends DefaultLoaderOptions {\r\n  /**\r\n   * Go fullscreen after loading and clicking play\r\n   */\r\n  fullscreenAfterLoad?: boolean;\r\n  /**\r\n   * Fullscreen container element or id\r\n   */\r\n  fullscreenContainer?: HTMLElement | string;\r\n}\r\n\r\n/**\r\n * Pre-loading assets\r\n *\r\n * The loader provides a mechanism to preload multiple resources at\r\n * one time. The loader must be passed to the engine in order to\r\n * trigger the loading progress bar.\r\n *\r\n * The {@apilink Loader} itself implements {@apilink Loadable} so you can load loaders.\r\n *\r\n * ## Example: Pre-loading resources for a game\r\n *\r\n * ```js\r\n * // create a loader\r\n * var loader = new ex.Loader();\r\n *\r\n * // create a resource dictionary (best practice is to keep a separate file)\r\n * var resources = {\r\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\r\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\r\n * };\r\n *\r\n * // loop through dictionary and add to loader\r\n * for (var loadable in resources) {\r\n *   if (resources.hasOwnProperty(loadable)) {\r\n *     loader.addResource(resources[loadable]);\r\n *   }\r\n * }\r\n *\r\n * // start game\r\n * game.start(loader).then(function () {\r\n *   console.log(\"Game started!\");\r\n * });\r\n * ```\r\n *\r\n * ## Customize the Loader\r\n *\r\n * The loader can be customized to show different, text, logo, background color, and button.\r\n *\r\n * ```typescript\r\n * const loader = new ex.Loader([playerTexture]);\r\n *\r\n * // The loaders button text can simply modified using this\r\n * loader.playButtonText = 'Start the best game ever';\r\n *\r\n * // The logo can be changed by inserting a base64 image string here\r\n *\r\n * loader.logo = 'data:image/png;base64,iVBORw...';\r\n * loader.logoWidth = 15;\r\n * loader.logoHeight = 14;\r\n *\r\n * // The background color can be changed like so by supplying a valid CSS color string\r\n *\r\n * loader.backgroundColor = 'red'\r\n * loader.backgroundColor = '#176BAA'\r\n *\r\n * // To build a completely new button\r\n * loader.startButtonFactory = () => {\r\n *     let myButton = document.createElement('button');\r\n *     myButton.textContent = 'The best button';\r\n *     return myButton;\r\n * };\r\n *\r\n * engine.start(loader).then(() => {});\r\n * ```\r\n */\r\nexport class Loader extends DefaultLoader {\r\n  private _logger = Logger.getInstance();\r\n  private static _DEFAULT_LOADER_OPTIONS: LoaderOptions = {\r\n    loadables: [],\r\n    fullscreenAfterLoad: false,\r\n    fullscreenContainer: undefined\r\n  };\r\n  private _originalOptions: LoaderOptions = { loadables: [] };\r\n  public events = new EventEmitter();\r\n  public screen!: Screen;\r\n  private _playButtonShown: boolean = false;\r\n\r\n  // logo drawing stuff\r\n\r\n  // base64 string encoding of the excalibur logo (logo-white.png)\r\n  public logo = logoImg;\r\n  public logoWidth = 468;\r\n  public logoHeight = 118;\r\n  /**\r\n   * Positions the top left corner of the logo image\r\n   * If not set, the loader automatically positions the logo\r\n   */\r\n  public logoPosition!: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the play button.\r\n   * If not set, the loader automatically positions the play button\r\n   */\r\n  public playButtonPosition!: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the loading bar\r\n   * If not set, the loader automatically positions the loading bar\r\n   */\r\n  public loadingBarPosition!: Vector | null;\r\n\r\n  /**\r\n   * Gets or sets the color of the loading bar, default is {@apilink Color.White}\r\n   */\r\n  public loadingBarColor: Color = Color.White;\r\n\r\n  /**\r\n   * Gets or sets the background color of the loader as a hex string\r\n   */\r\n  public backgroundColor: string = '#176BAA';\r\n\r\n  protected _imageElement!: HTMLImageElement;\r\n  protected _imageLoaded: Future<void> = new Future();\r\n  protected get _image() {\r\n    if (!this._imageElement) {\r\n      this._imageElement = new Image();\r\n      this._imageElement.onload = () => this._imageLoaded.resolve();\r\n      this._imageElement.src = this.logo;\r\n    }\r\n\r\n    return this._imageElement;\r\n  }\r\n\r\n  public suppressPlayButton: boolean = false;\r\n  public get playButtonRootElement(): HTMLElement | null {\r\n    return this._playButtonRootElement;\r\n  }\r\n  public get playButtonElement(): HTMLButtonElement | null {\r\n    return this._playButtonElement;\r\n  }\r\n  protected _playButtonRootElement!: HTMLElement;\r\n  protected _playButtonElement!: HTMLButtonElement;\r\n  protected _styleBlock!: HTMLStyleElement;\r\n  /** Loads the css from Loader.css */\r\n  protected _playButtonStyles: string = loaderCss.toString();\r\n  protected get _playButton() {\r\n    const existingRoot = document.getElementById('excalibur-play-root');\r\n    if (existingRoot) {\r\n      this._playButtonRootElement = existingRoot;\r\n    }\r\n    if (!this._playButtonRootElement) {\r\n      this._playButtonRootElement = document.createElement('div');\r\n      this._playButtonRootElement.id = 'excalibur-play-root';\r\n      this._playButtonRootElement.style.position = 'absolute';\r\n      document.body.appendChild(this._playButtonRootElement);\r\n    }\r\n    if (!this._styleBlock) {\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._playButtonStyles;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n    if (!this._playButtonElement) {\r\n      this._playButtonElement = this.startButtonFactory();\r\n      this._playButtonRootElement.appendChild(this._playButtonElement);\r\n    }\r\n    return this._playButtonElement;\r\n  }\r\n\r\n  /**\r\n   * Get/set play button text\r\n   */\r\n  public playButtonText: string = 'Play game';\r\n\r\n  /**\r\n   * Return a html button element for excalibur to use as a play button\r\n   */\r\n  public startButtonFactory = () => {\r\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\r\n    if (!buttonElement) {\r\n      buttonElement = document.createElement('button');\r\n    }\r\n\r\n    buttonElement.id = 'excalibur-play';\r\n    buttonElement.textContent = this.playButtonText;\r\n    buttonElement.style.display = 'none';\r\n    return buttonElement;\r\n  };\r\n\r\n  /**\r\n   * @param options Optionally provide options to loader\r\n   */\r\n  constructor(options?: LoaderOptions);\r\n  /**\r\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\r\n   */\r\n  constructor(loadables?: Loadable<any>[]);\r\n  constructor(loadablesOrOptions?: Loadable<any>[] | LoaderOptions) {\r\n    const options = Array.isArray(loadablesOrOptions)\r\n      ? {\r\n          loadables: loadablesOrOptions\r\n        }\r\n      : loadablesOrOptions;\r\n    super(options);\r\n    this._originalOptions = { ...Loader._DEFAULT_LOADER_OPTIONS, ...options };\r\n  }\r\n\r\n  public override onInitialize(engine: Engine): void {\r\n    this.engine = engine;\r\n    this.screen = engine.screen;\r\n    this.canvas.width = this.engine.canvas.width;\r\n    this.canvas.height = this.engine.canvas.height;\r\n    this.screen.events.on('resize', () => {\r\n      this.canvas.width = this.engine.canvas.width;\r\n      this.canvas.height = this.engine.canvas.height;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Shows the play button and returns a promise that resolves when clicked\r\n   */\r\n  public async showPlayButton(): Promise<void> {\r\n    if (this.suppressPlayButton) {\r\n      this.hidePlayButton();\r\n      // Delay is to give the logo a chance to show, otherwise don't delay\r\n      await delay(500, this.engine?.clock);\r\n    } else {\r\n      const resizeHandler = () => {\r\n        try {\r\n          this._positionPlayButton();\r\n        } catch {\r\n          // swallow if can't position\r\n        }\r\n      };\r\n      if (this.engine?.browser) {\r\n        this.engine.browser.window.on('resize', resizeHandler);\r\n      }\r\n      this._playButtonShown = true;\r\n      this._playButton.style.display = 'block';\r\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\r\n        if (evt.key === 'Enter') {\r\n          this._playButton.click();\r\n        }\r\n      });\r\n      this._positionPlayButton();\r\n      const playButtonClicked = new Promise<void>((resolve) => {\r\n        const startButtonHandler = (e: Event) => {\r\n          // We want to stop propagation to keep bubbling to the engine pointer handlers\r\n          e.stopPropagation();\r\n          // Hide Button after click\r\n          this.hidePlayButton();\r\n          if (this.engine?.browser) {\r\n            this.engine.browser.window.off('resize', resizeHandler);\r\n          }\r\n\r\n          if (this._originalOptions.fullscreenAfterLoad) {\r\n            try {\r\n              this._logger.info('requesting fullscreen');\r\n              if (this._originalOptions.fullscreenContainer instanceof HTMLElement) {\r\n                this._originalOptions.fullscreenContainer.requestFullscreen();\r\n              } else {\r\n                this.engine.screen.goFullScreen(this._originalOptions.fullscreenContainer);\r\n              }\r\n            } catch (error) {\r\n              this._logger.error('could not go fullscreen', error);\r\n            }\r\n          }\r\n\r\n          resolve();\r\n        };\r\n        this._playButton.addEventListener('click', startButtonHandler);\r\n        this._playButton.addEventListener('touchend', startButtonHandler);\r\n        this._playButton.addEventListener('pointerup', startButtonHandler);\r\n      });\r\n\r\n      return await playButtonClicked;\r\n    }\r\n  }\r\n\r\n  public hidePlayButton() {\r\n    this._playButtonShown = false;\r\n    this._playButton.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Clean up generated elements for the loader\r\n   */\r\n  public dispose() {\r\n    if (this._playButtonRootElement.parentElement) {\r\n      this._playButtonRootElement.removeChild(this._playButtonElement);\r\n      document.body.removeChild(this._playButtonRootElement);\r\n      document.head.removeChild(this._styleBlock);\r\n      this._playButtonRootElement = null as any;\r\n      this._playButtonElement = null as any;\r\n      this._styleBlock = null as any;\r\n    }\r\n  }\r\n\r\n  data!: Loadable<any>[];\r\n\r\n  public override async onUserAction(): Promise<void> {\r\n    // short delay in showing the button for aesthetics\r\n    await delay(200, this.engine?.clock);\r\n    this.canvas.flagDirty();\r\n    // show play button\r\n    await this.showPlayButton();\r\n  }\r\n\r\n  public override async onBeforeLoad(): Promise<void> {\r\n    this.screen.pushResolutionAndViewport();\r\n    this.screen.resolution = { width: this.canvas.width, height: this.canvas.height };\r\n    this.screen.applyResolutionAndViewport();\r\n    const image = this._image;\r\n    await this._imageLoaded.promise;\r\n    await image?.decode(); // decode logo if it exists\r\n  }\r\n\r\n  // eslint-disable-next-line require-await\r\n  public override async onAfterLoad(): Promise<void> {\r\n    this.screen.popResolutionAndViewport();\r\n    this.screen.applyResolutionAndViewport();\r\n    this.dispose();\r\n  }\r\n\r\n  private _positionPlayButton() {\r\n    if (this.engine) {\r\n      const { x: left, y: top, width: screenWidth, height: screenHeight } = this.engine.canvas.getBoundingClientRect();\r\n      if (this._playButtonRootElement) {\r\n        const buttonWidth = this._playButton.clientWidth;\r\n        const buttonHeight = this._playButton.clientHeight;\r\n        if (this.playButtonPosition) {\r\n          this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\r\n          this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\r\n        } else {\r\n          this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\r\n          this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loader draw function. Draws the default Excalibur loading screen.\r\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\r\n   * to customize the drawing, or just override entire method.\r\n   */\r\n  public override onDraw(ctx: CanvasRenderingContext2D) {\r\n    const canvasHeight = this.engine.canvasHeight / this.engine.pixelRatio;\r\n    const canvasWidth = this.engine.canvasWidth / this.engine.pixelRatio;\r\n\r\n    this._positionPlayButton();\r\n\r\n    ctx.fillStyle = this.backgroundColor;\r\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n\r\n    let logoY = canvasHeight / 2;\r\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\r\n    let logoX = canvasWidth / 2 - width / 2;\r\n\r\n    if (this.logoPosition) {\r\n      logoX = this.logoPosition.x;\r\n      logoY = this.logoPosition.y;\r\n    }\r\n\r\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\r\n    const oldAntialias = this.engine.screen.antialiasing;\r\n    this.engine.screen.antialiasing = true;\r\n    if (!this.logoPosition) {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\r\n    } else {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\r\n    }\r\n\r\n    // loading box\r\n    if (!this.suppressPlayButton && this._playButtonShown) {\r\n      this.engine.screen.antialiasing = oldAntialias;\r\n      return;\r\n    }\r\n\r\n    let loadingX = logoX;\r\n    let loadingY = logoY;\r\n    if (this.loadingBarPosition) {\r\n      loadingX = this.loadingBarPosition.x;\r\n      loadingY = this.loadingBarPosition.y;\r\n    }\r\n\r\n    ctx.lineWidth = 2;\r\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\r\n    const progress = width * this.progress;\r\n    const margin = 5;\r\n    const progressWidth = progress - margin * 2;\r\n    const height = 20 - margin * 2;\r\n    DrawUtil.roundRect(\r\n      ctx,\r\n      loadingX + margin,\r\n      loadingY + margin,\r\n      progressWidth > 10 ? progressWidth : 10,\r\n      height,\r\n      5,\r\n      null,\r\n      this.loadingBarColor\r\n    );\r\n    this.engine.screen.antialiasing = oldAntialias;\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","import { Logger } from './Log';\r\n/**\r\n * This is the list of features that will be used to log the supported\r\n * features to the console when Detector.logBrowserFeatures() is called.\r\n */\r\n\r\nconst REPORTED_FEATURES: { [key: string]: string } = {\r\n  webgl: 'WebGL',\r\n  webaudio: 'WebAudio',\r\n  gamepadapi: 'Gamepad API'\r\n};\r\n\r\n/**\r\n * Interface for detected browser features matrix\r\n */\r\nexport interface DetectedFeatures {\r\n  readonly canvas: boolean;\r\n  readonly arraybuffer: boolean;\r\n  readonly dataurl: boolean;\r\n  readonly objecturl: boolean;\r\n  readonly rgba: boolean;\r\n  readonly webaudio: boolean;\r\n  readonly webgl: boolean;\r\n  readonly gamepadapi: boolean;\r\n}\r\n\r\ninterface CriticalTests {\r\n  canvasSupport(): boolean;\r\n  arrayBufferSupport(): boolean;\r\n  dataUrlSupport(): boolean;\r\n  objectUrlSupport(): boolean;\r\n  rgbaSupport(): boolean;\r\n}\r\n\r\ninterface WarningTests {\r\n  webAudioSupport(): boolean;\r\n  webglSupport(): boolean;\r\n}\r\n\r\n/**\r\n * Excalibur internal feature detection helper class\r\n */\r\nexport class Detector {\r\n  private _features: DetectedFeatures = null;\r\n\r\n  public failedTests: string[] = [];\r\n\r\n  public constructor() {\r\n    this._features = this._loadBrowserFeatures();\r\n  }\r\n\r\n  /**\r\n   * Returns a map of currently supported browser features. This method\r\n   * treats the features as a singleton and will only calculate feature\r\n   * support if it has not previously been done.\r\n   */\r\n  public getBrowserFeatures(): DetectedFeatures {\r\n    if (this._features === null) {\r\n      this._features = this._loadBrowserFeatures();\r\n    }\r\n    return this._features;\r\n  }\r\n\r\n  /**\r\n   * Report on non-critical browser support for debugging purposes.\r\n   * Use native browser console colors for visibility.\r\n   */\r\n  public logBrowserFeatures(): void {\r\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\r\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\r\n\r\n    const supported: any = this.getBrowserFeatures();\r\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\r\n      if (supported[feature]) {\r\n        msg += '(%c\\u2713%c)'; // ()\r\n        args.push('font-weight: bold; color: green');\r\n        args.push('font-weight: normal; color: inherit');\r\n      } else {\r\n        msg += '(%c\\u2717%c)'; // ()\r\n        args.push('font-weight: bold; color: red');\r\n        args.push('font-weight: normal; color: inherit');\r\n      }\r\n\r\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\r\n    }\r\n\r\n    args.unshift(msg);\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, args);\r\n  }\r\n\r\n  /**\r\n   * Executes several IIFE's to get a constant reference to supported\r\n   * features within the current execution context.\r\n   */\r\n  private _loadBrowserFeatures(): DetectedFeatures {\r\n    return {\r\n      // IIFE to check canvas support\r\n      canvas: (() => {\r\n        return this._criticalTests.canvasSupport();\r\n      })(),\r\n\r\n      // IIFE to check arraybuffer support\r\n      arraybuffer: (() => {\r\n        return this._criticalTests.arrayBufferSupport();\r\n      })(),\r\n\r\n      // IIFE to check dataurl support\r\n      dataurl: (() => {\r\n        return this._criticalTests.dataUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check objecturl support\r\n      objecturl: (() => {\r\n        return this._criticalTests.objectUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check rgba support\r\n      rgba: (() => {\r\n        return this._criticalTests.rgbaSupport();\r\n      })(),\r\n\r\n      // IIFE to check webaudio support\r\n      webaudio: (() => {\r\n        return this._warningTest.webAudioSupport();\r\n      })(),\r\n\r\n      // IIFE to check webgl support\r\n      webgl: (() => {\r\n        return this._warningTest.webglSupport();\r\n      })(),\r\n\r\n      // IIFE to check gamepadapi support\r\n      gamepadapi: (() => {\r\n        return !!(<any>navigator).getGamepads;\r\n      })()\r\n    };\r\n  }\r\n\r\n  // critical browser features required for ex to run\r\n  private _criticalTests: CriticalTests = {\r\n    // Test canvas/2d context support\r\n    canvasSupport: function () {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('2d'));\r\n    },\r\n\r\n    // Test array buffer support ex uses for downloading binary data\r\n    arrayBufferSupport: function () {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open('GET', '/');\r\n      try {\r\n        xhr.responseType = 'arraybuffer';\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n      return xhr.responseType === 'arraybuffer';\r\n    },\r\n\r\n    // Test data urls ex uses for sprites\r\n    dataUrlSupport: function () {\r\n      const canvas = document.createElement('canvas');\r\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\r\n    },\r\n\r\n    // Test object url support for loading\r\n    objectUrlSupport: function () {\r\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\r\n    },\r\n\r\n    // RGBA support for colors\r\n    rgbaSupport: function () {\r\n      const style = document.createElement('a').style;\r\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\r\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\r\n    }\r\n  };\r\n\r\n  // warnings excalibur performance will be degraded\r\n  private _warningTest: WarningTests = {\r\n    webAudioSupport: function () {\r\n      return !!(\r\n        (<any>window).AudioContext ||\r\n        (<any>window).webkitAudioContext ||\r\n        (<any>window).mozAudioContext ||\r\n        (<any>window).msAudioContext ||\r\n        (<any>window).oAudioContext\r\n      );\r\n    },\r\n    webglSupport: function () {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('webgl'));\r\n    }\r\n  };\r\n\r\n  public test(): boolean {\r\n    // Critical test will for ex not to run\r\n    let failedCritical = false;\r\n    for (const test in this._criticalTests) {\r\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\r\n        this.failedTests.push(test);\r\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\r\n        failedCritical = true;\r\n      }\r\n    }\r\n    if (failedCritical) {\r\n      return false;\r\n    }\r\n\r\n    // Warning tests do not for ex to return false to compatibility\r\n    for (const warning in this._warningTest) {\r\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\r\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/**\n * An enum that describes the types of collisions bodies can participate in\n */\nexport enum CollisionType {\n  /**\n   * Bodies with the `PreventCollision` setting do not participate in any\n   * collisions and do not raise collision events.\n   */\n  PreventCollision = 'PreventCollision',\n  /**\n   * Bodies with the `Passive` setting only raise collision events, but are not\n   * influenced or moved by other bodies and do not influence or move other bodies.\n   * This is useful for use in trigger type behavior.\n   */\n  Passive = 'Passive',\n  /**\n   * Bodies with the `Active` setting raise collision events and participate\n   * in collisions with other bodies and will be push or moved by bodies sharing\n   * the `Active` or `Fixed` setting.\n   */\n  Active = 'Active',\n  /**\n   * Bodies with the `Fixed` setting raise collision events and participate in\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\n   * not be pushed or moved by each other, they will not interact except to throw\n   * collision events.\n   */\n  Fixed = 'Fixed'\n}\n","/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is {@apilink SolverStrategy.Arcade} which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting {@apilink SolverStrategy.Realistic} which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum SolverStrategy {\r\n  Arcade = 'arcade',\r\n  Realistic = 'realistic'\r\n}\r\n","/**\r\n * Tells the Arcade collision solver to prefer certain contacts over others\r\n */\r\nexport enum ContactSolveBias {\r\n  None = 'none',\r\n  VerticalFirst = 'vertical-first',\r\n  HorizontalFirst = 'horizontal-first'\r\n}\r\n\r\n/**\r\n * Contact bias values\r\n */\r\nexport interface ContactBias {\r\n  vertical: number;\r\n  horizontal: number;\r\n}\r\n\r\n/**\r\n * Vertical First contact solve bias Used by the {@apilink ArcadeSolver} to sort contacts\r\n */\r\nexport const VerticalFirst: ContactBias = {\r\n  vertical: 1,\r\n  horizontal: 2\r\n} as const;\r\n\r\n/**\r\n * Horizontal First contact solve bias Used by the {@apilink ArcadeSolver} to sort contacts\r\n */\r\nexport const HorizontalFirst: ContactBias = {\r\n  horizontal: 1,\r\n  vertical: 2\r\n} as const;\r\n\r\n/**\r\n * None value, {@apilink ArcadeSolver} sorts contacts using distance by default\r\n */\r\nexport const None: ContactBias = {\r\n  horizontal: 0,\r\n  vertical: 0\r\n} as const;\r\n","import { CollisionGroup } from './CollisionGroup';\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nexport class CollisionGroupManager {\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\n  private static _STARTING_BIT = 0b1 | 0;\n  private static _MAX_GROUPS = 32;\n  private static _CURRENT_GROUP = 1;\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\n\n  /**\n   * Create a new named collision group up to a max of 32.\n   * @param name Name for the collision group\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n   */\n  public static create(name: string, mask?: number) {\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n    }\n    if (this._GROUPS.get(name)) {\n      const existingGroup = this._GROUPS.get(name);\n      if (existingGroup.mask === mask) {\n        return existingGroup;\n      }\n      throw new Error(`Collision group ${name} already exists with a different mask!`);\n    }\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\n    this._CURRENT_GROUP++;\n    this._GROUPS.set(name, group);\n    return group;\n  }\n\n  /**\n   * Get all collision groups currently tracked by excalibur\n   */\n  public static get groups(): CollisionGroup[] {\n    return Array.from(this._GROUPS.values());\n  }\n\n  /**\n   * Get a collision group by it's name\n   * @param name\n   */\n  public static groupByName(name: string) {\n    return this._GROUPS.get(name);\n  }\n\n  /**\n   * Resets the managers internal group management state\n   */\n  public static reset() {\n    this._GROUPS = new Map<string, CollisionGroup>();\n    this._CURRENT_BIT = this._STARTING_BIT;\n    this._CURRENT_GROUP = 1;\n  }\n}\n","import { CollisionGroupManager } from './CollisionGroupManager';\r\n\r\n/**\r\n * CollisionGroups indicate like members that do not collide with each other. Use {@apilink CollisionGroupManager} to create {@apilink CollisionGroup}s\r\n *\r\n * For example:\r\n *\r\n * Players have collision group \"player\"\r\n *\r\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\r\n *\r\n * Enemies have collision group \"enemy\"\r\n *\r\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\r\n *\r\n * Blocks have collision group \"ground\"\r\n *\r\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\r\n *\r\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\r\n * with players and blocks.\r\n *\r\n * This is done with bitmasking, see the following pseudo-code\r\n *\r\n * PlayerGroup = `0b001`\r\n * PlayerGroupMask = `0b110`\r\n *\r\n * EnemyGroup = `0b010`\r\n * EnemyGroupMask = `0b101`\r\n *\r\n * BlockGroup = `0b100`\r\n * BlockGroupMask = `0b011`\r\n *\r\n * Should Players collide? No because the bitwise mask evaluates to 0\r\n * `(player1.group & player2.mask) === 0`\r\n * `(0b001 & 0b110) === 0`\r\n *\r\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & enemy1.mask) === 1`\r\n * `(0b001 & 0b101) === 1`\r\n *\r\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & blocks1.mask) === 1`\r\n * `(0b001 & 0b011) === 1`\r\n */\r\nexport class CollisionGroup {\r\n  /**\r\n   * The `All` {@apilink CollisionGroup} is a special group that collides with all other groups including itself,\r\n   * it is the default collision group on colliders.\r\n   */\r\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\r\n\r\n  private _name: string;\r\n  private _category: number;\r\n  private _mask: number;\r\n\r\n  /**\r\n   * STOP!!** It is preferred that {@apilink CollisionGroupManager.create} is used to create collision groups\r\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\r\n   * @param name Name of the collision group\r\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\r\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\r\n   */\r\n  constructor(name: string, category: number, mask: number) {\r\n    this._name = name;\r\n    this._category = category;\r\n    this._mask = mask;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the collision group\r\n   */\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /**\r\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\r\n   */\r\n  public get category() {\r\n    return this._category;\r\n  }\r\n\r\n  /**\r\n   * Get the mask for this collision group\r\n   */\r\n  public get mask() {\r\n    return this._mask;\r\n  }\r\n\r\n  /**\r\n   * Evaluates whether 2 collision groups can collide\r\n   *\r\n   * This means the mask has the same bit set the other category and vice versa\r\n   * @param other  CollisionGroup\r\n   */\r\n  public canCollide(other: CollisionGroup): boolean {\r\n    const overlap1 = this.category & other.mask;\r\n    const overlap2 = this.mask & other.category;\r\n    return overlap1 !== 0 && overlap2 !== 0;\r\n  }\r\n\r\n  /**\r\n   * Inverts the collision group. For example, if before the group specified \"players\",\r\n   * inverting would specify all groups except players\r\n   * @returns CollisionGroup\r\n   */\r\n  public invert(): CollisionGroup {\r\n    const group = CollisionGroupManager.create('~(' + this.name + ')', ~this.mask | 0);\r\n    group._category = ~this.category;\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Combine collision groups with each other. The new group includes all of the previous groups.\r\n   * @param collisionGroups\r\n   */\r\n  public static combine(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\r\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    const combinedMask = ~combinedCategory;\r\n\r\n    return CollisionGroupManager.create(combinedName, combinedMask);\r\n  }\r\n\r\n  /**\r\n   * Creates a collision group that collides with the listed groups\r\n   * @param collisionGroups\r\n   */\r\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = `collidesWith(${collisionGroups.map((c) => c.name).join('+')})`;\r\n    const combinedMask = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    return CollisionGroupManager.create(combinedName, combinedMask);\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\ncategory: ${this.category.toString(2).padStart(32, '0')}\r\nmask:     ${(this.mask >>> 0).toString(2).padStart(32, '0')}\r\n    `;\r\n  }\r\n}\r\n","import { CollisionContact } from './CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Id } from '../../Id';\r\nimport { Collider } from '../Colliders/Collider';\r\n\r\n/**\r\n * Models a potential collision between 2 colliders\r\n */\r\nexport class Pair {\r\n  public id: string = null;\r\n  constructor(\r\n    public colliderA: Collider,\r\n    public colliderB: Collider\r\n  ) {\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a it is allowed for 2 colliders in a Pair to collide\r\n   * @param colliderA\r\n   * @param colliderB\r\n   */\r\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\r\n    // Prevent self collision\r\n    if (colliderA.id === colliderB.id) {\r\n      return false;\r\n    }\r\n\r\n    // Colliders with the same owner do not collide (composite colliders)\r\n    if (colliderA.owner && colliderB.owner && colliderA.owner.id === colliderB.owner.id) {\r\n      return false;\r\n    }\r\n\r\n    // if the pair has a member with zero dimension don't collide\r\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\r\n      return false;\r\n    }\r\n\r\n    const bodyA = colliderA?.owner?.get(BodyComponent);\r\n    const bodyB = colliderB?.owner?.get(BodyComponent);\r\n\r\n    // Body's needed for collision in the current state\r\n    // TODO can we collide without a body?\r\n    if (!bodyA || !bodyB) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!bodyA.group.canCollide(bodyB.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!bodyA.isActive || !bodyB.isActive) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not it is possible for the pairs to collide\r\n   */\r\n  public get canCollide(): boolean {\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Runs the collision intersection logic on the members of this pair\r\n   */\r\n  public collide(): CollisionContact[] {\r\n    return this.colliderA.collide(this.colliderB);\r\n  }\r\n\r\n  /**\r\n   * Check if the collider is part of the pair\r\n   * @param collider\r\n   */\r\n  public hasCollider(collider: Collider) {\r\n    return collider === this.colliderA || collider === this.colliderB;\r\n  }\r\n\r\n  /**\r\n   * Calculates the unique pair hash id for this collision pair (owning id)\r\n   */\r\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\r\n    if (idA.value < idB.value) {\r\n      return `#${idA.value}+${idB.value}`;\r\n    } else {\r\n      return `#${idB.value}+${idA.value}`;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * A 1 dimensional projection on an axis, used to test overlaps\r\n */\r\n\r\nexport class Projection {\r\n  constructor(\r\n    public min: number,\r\n    public max: number\r\n  ) {}\r\n  public overlaps(projection: Projection): boolean {\r\n    return this.max > projection.min && projection.max > this.min;\r\n  }\r\n\r\n  public getOverlap(projection: Projection): number {\r\n    if (this.overlaps(projection)) {\r\n      if (this.max > projection.max) {\r\n        return projection.max - this.min;\r\n      } else {\r\n        return this.max - projection.min;\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Id } from '../../Id';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Color, ExcaliburGraphicsContext } from '../..';\r\nimport { DynamicTreeConfig } from '../PhysicsConfig';\r\n\r\n/**\r\n * Dynamic Tree Node used for tracking bounds within the tree\r\n */\r\nexport class TreeNode<T> {\r\n  public left: TreeNode<T>;\r\n  public right: TreeNode<T>;\r\n  public bounds: BoundingBox;\r\n  public height: number;\r\n  public data: T;\r\n  constructor(public parent?: TreeNode<T>) {\r\n    this.parent = parent || null;\r\n    this.data = null;\r\n    this.bounds = new BoundingBox();\r\n    this.left = null;\r\n    this.right = null;\r\n    this.height = 0;\r\n  }\r\n\r\n  public isLeaf(): boolean {\r\n    return !this.left && !this.right;\r\n  }\r\n}\r\n\r\nexport interface ColliderProxy<T> {\r\n  id: Id<'collider'>;\r\n  owner: T;\r\n  bounds: BoundingBox;\r\n}\r\n\r\n/**\r\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\r\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\r\n *\r\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\r\n * Every non-leaf node is a bounding box that contains child bounding boxes.\r\n */\r\nexport class DynamicTree<TProxy extends ColliderProxy<Entity>> {\r\n  public root: TreeNode<TProxy>;\r\n  public nodes: { [key: number]: TreeNode<TProxy> };\r\n  constructor(\r\n    private _config: Required<DynamicTreeConfig>,\r\n    public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)\r\n  ) {\r\n    this.root = null;\r\n    this.nodes = {};\r\n  }\r\n\r\n  /**\r\n   * Inserts a node into the dynamic tree\r\n   */\r\n  private _insert(leaf: TreeNode<TProxy>): void {\r\n    // If there are no nodes in the tree, make this the root leaf\r\n    if (this.root === null) {\r\n      this.root = leaf;\r\n      this.root.parent = null;\r\n      return;\r\n    }\r\n\r\n    // Search the tree for a node that is not a leaf and find the best place to insert\r\n    const leafAABB = leaf.bounds;\r\n    let currentRoot = this.root;\r\n    while (!currentRoot.isLeaf()) {\r\n      const left = currentRoot.left;\r\n      const right = currentRoot.right;\r\n\r\n      const area = currentRoot.bounds.getPerimeter();\r\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\r\n      const combinedArea = combinedAABB.getPerimeter();\r\n\r\n      // Calculate cost heuristic for creating a new parent and leaf\r\n      const cost = 2 * combinedArea;\r\n\r\n      // Minimum cost of pushing the leaf down the tree\r\n      const inheritanceCost = 2 * (combinedArea - area);\r\n\r\n      // Cost of descending\r\n      let leftCost = 0;\r\n      const leftCombined = leafAABB.combine(left.bounds);\r\n      let newArea;\r\n      let oldArea;\r\n      if (left.isLeaf()) {\r\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = left.bounds.getPerimeter();\r\n        newArea = leftCombined.getPerimeter();\r\n        leftCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      let rightCost = 0;\r\n      const rightCombined = leafAABB.combine(right.bounds);\r\n      if (right.isLeaf()) {\r\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = right.bounds.getPerimeter();\r\n        newArea = rightCombined.getPerimeter();\r\n        rightCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      // cost is acceptable\r\n      if (cost < leftCost && cost < rightCost) {\r\n        break;\r\n      }\r\n\r\n      // Descend to the depths\r\n      if (leftCost < rightCost) {\r\n        currentRoot = left;\r\n      } else {\r\n        currentRoot = right;\r\n      }\r\n    }\r\n\r\n    // Create the new parent node and insert into the tree\r\n    const oldParent = currentRoot.parent;\r\n    const newParent = new TreeNode(oldParent);\r\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\r\n    newParent.height = currentRoot.height + 1;\r\n\r\n    if (oldParent !== null) {\r\n      // The sibling node was not the root\r\n      if (oldParent.left === currentRoot) {\r\n        oldParent.left = newParent;\r\n      } else {\r\n        oldParent.right = newParent;\r\n      }\r\n\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n    } else {\r\n      // The sibling node was the root\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n      this.root = newParent;\r\n    }\r\n\r\n    // Walk up the tree fixing heights and AABBs\r\n    let currentNode = leaf.parent;\r\n    while (currentNode) {\r\n      currentNode = this._balance(currentNode);\r\n\r\n      if (!currentNode.left) {\r\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\r\n      }\r\n      if (!currentNode.right) {\r\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\r\n      }\r\n\r\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n\r\n      currentNode = currentNode.parent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a node from the dynamic tree\r\n   */\r\n  private _remove(leaf: TreeNode<TProxy>) {\r\n    if (leaf === this.root) {\r\n      this.root = null;\r\n      return;\r\n    }\r\n\r\n    const parent = leaf.parent;\r\n    const grandParent = parent.parent;\r\n    let sibling: TreeNode<TProxy>;\r\n    if (parent.left === leaf) {\r\n      sibling = parent.right;\r\n    } else {\r\n      sibling = parent.left;\r\n    }\r\n\r\n    if (grandParent) {\r\n      if (grandParent.left === parent) {\r\n        grandParent.left = sibling;\r\n      } else {\r\n        grandParent.right = sibling;\r\n      }\r\n      sibling.parent = grandParent;\r\n\r\n      let currentNode = grandParent;\r\n      while (currentNode) {\r\n        currentNode = this._balance(currentNode);\r\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n\r\n        currentNode = currentNode.parent;\r\n      }\r\n    } else {\r\n      this.root = sibling;\r\n      sibling.parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tracks a body in the dynamic tree\r\n   */\r\n  public trackCollider(collider: TProxy) {\r\n    const node = new TreeNode<TProxy>();\r\n    node.data = collider;\r\n    node.bounds = collider.bounds;\r\n    node.bounds.left -= 2;\r\n    node.bounds.top -= 2;\r\n    node.bounds.right += 2;\r\n    node.bounds.bottom += 2;\r\n    this.nodes[collider.id.value] = node;\r\n    this._insert(node);\r\n  }\r\n\r\n  /**\r\n   * Updates the dynamic tree given the current bounds of each body being tracked\r\n   */\r\n  public updateCollider(collider: TProxy) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return false;\r\n    }\r\n    const b = collider.bounds;\r\n\r\n    // if the body is outside the world no longer update it\r\n    if (!this.worldBounds.contains(b)) {\r\n      Logger.getInstance().warn(\r\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\r\n      );\r\n      this.untrackCollider(collider);\r\n      return false;\r\n    }\r\n\r\n    if (node.bounds.contains(b)) {\r\n      return false;\r\n    }\r\n\r\n    this._remove(node);\r\n    b.left -= this._config.boundsPadding;\r\n    b.top -= this._config.boundsPadding;\r\n    b.right += this._config.boundsPadding;\r\n    b.bottom += this._config.boundsPadding;\r\n\r\n    // THIS IS CAUSING UNNECESSARY CHECKS\r\n    if (collider.owner) {\r\n      const body = collider.owner?.get(BodyComponent);\r\n      if (body) {\r\n        const multdx = ((body.vel.x * 32) / 1000) * this._config.velocityMultiplier;\r\n        const multdy = ((body.vel.y * 32) / 1000) * this._config.velocityMultiplier;\r\n\r\n        if (multdx < 0) {\r\n          b.left += multdx;\r\n        } else {\r\n          b.right += multdx;\r\n        }\r\n\r\n        if (multdy < 0) {\r\n          b.top += multdy;\r\n        } else {\r\n          b.bottom += multdy;\r\n        }\r\n      }\r\n    }\r\n\r\n    node.bounds = b;\r\n    this._insert(node);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Untracks a body from the dynamic tree\r\n   */\r\n  public untrackCollider(collider: TProxy) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return;\r\n    }\r\n    this._remove(node);\r\n    this.nodes[collider.id.value] = null;\r\n    delete this.nodes[collider.id.value];\r\n  }\r\n\r\n  /**\r\n   * Balances the tree about a node\r\n   */\r\n  private _balance(node: TreeNode<TProxy>) {\r\n    if (node === null) {\r\n      throw new Error('Cannot balance at null node');\r\n    }\r\n\r\n    if (node.isLeaf() || node.height < 2) {\r\n      return node;\r\n    }\r\n\r\n    const left = node.left;\r\n    const right = node.right;\r\n\r\n    const a = node;\r\n    const b = left;\r\n    const c = right;\r\n    const d = left.left;\r\n    const e = left.right;\r\n    const f = right.left;\r\n    const g = right.right;\r\n\r\n    const balance = c.height - b.height;\r\n    // Rotate c node up\r\n    if (balance > 1) {\r\n      // Swap the right node with it's parent\r\n      c.left = a;\r\n      c.parent = a.parent;\r\n      a.parent = c;\r\n\r\n      // The original node's old parent should point to the right node\r\n      // this is mega confusing\r\n      if (c.parent) {\r\n        if (c.parent.left === a) {\r\n          c.parent.left = c;\r\n        } else {\r\n          c.parent.right = c;\r\n        }\r\n      } else {\r\n        this.root = c;\r\n      }\r\n\r\n      // Rotate\r\n      if (f.height > g.height) {\r\n        c.right = f;\r\n        a.right = g;\r\n        g.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(g.bounds);\r\n        c.bounds = a.bounds.combine(f.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, g.height);\r\n        c.height = 1 + Math.max(a.height, f.height);\r\n      } else {\r\n        c.right = g;\r\n        a.right = f;\r\n        f.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(f.bounds);\r\n        c.bounds = a.bounds.combine(g.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, f.height);\r\n        c.height = 1 + Math.max(a.height, g.height);\r\n      }\r\n\r\n      return c;\r\n    }\r\n    // Rotate left node up\r\n    if (balance < -1) {\r\n      // swap\r\n      b.left = a;\r\n      b.parent = a.parent;\r\n      a.parent = b;\r\n\r\n      // node's old parent should point to b\r\n      if (b.parent) {\r\n        if (b.parent.left === a) {\r\n          b.parent.left = b;\r\n        } else {\r\n          if (b.parent.right !== a) {\r\n            throw 'Error rotating Dynamic Tree';\r\n          }\r\n          b.parent.right = b;\r\n        }\r\n      } else {\r\n        this.root = b;\r\n      }\r\n\r\n      // rotate\r\n      if (d.height > e.height) {\r\n        b.right = d;\r\n        a.left = e;\r\n        e.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(e.bounds);\r\n        b.bounds = a.bounds.combine(d.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, e.height);\r\n        b.height = 1 + Math.max(a.height, d.height);\r\n      } else {\r\n        b.right = e;\r\n        a.left = d;\r\n        d.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(d.bounds);\r\n        b.bounds = a.bounds.combine(e.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, d.height);\r\n        b.height = 1 + Math.max(a.height, e.height);\r\n      }\r\n      return b;\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\r\n   */\r\n  public getHeight(): number {\r\n    if (this.root === null) {\r\n      return 0;\r\n    }\r\n    return this.root.height;\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\r\n   *\r\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\r\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\r\n   * the tree until all possible colliders have been returned.\r\n   */\r\n  public query(collider: TProxy, callback: (other: TProxy) => boolean): void {\r\n    const bounds = collider.bounds;\r\n    const helper = (currentNode: TreeNode<TProxy>): boolean => {\r\n      if (currentNode && currentNode.bounds.overlaps(bounds)) {\r\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\r\n          if (callback.call(collider, currentNode.data)) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\r\n   * long ray to test the tree specified by `max`.\r\n   *\r\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\r\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\r\n   * the tree until all possible bodies that would intersect with the ray have been returned.\r\n   */\r\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: TProxy) => boolean): void {\r\n    const helper = (currentNode: TreeNode<TProxy>): boolean => {\r\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\r\n        if (currentNode.isLeaf()) {\r\n          if (callback.call(ray, currentNode.data)) {\r\n            // ray hit a leaf! return the body\r\n            return true;\r\n          }\r\n        } else {\r\n          // ray hit but not at a leaf, recurse deeper\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false; // ray missed\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  public getNodes(): TreeNode<TProxy>[] {\r\n    const helper = (currentNode: TreeNode<TProxy>): TreeNode<TProxy>[] => {\r\n      if (currentNode) {\r\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\r\n      } else {\r\n        return [];\r\n      }\r\n    };\r\n    return helper(this.root);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    // draw all the nodes in the Dynamic Tree\r\n    const helper = (currentNode: TreeNode<TProxy>) => {\r\n      if (currentNode) {\r\n        if (currentNode.isLeaf()) {\r\n          currentNode.bounds.draw(ex, Color.Green);\r\n        } else {\r\n          currentNode.bounds.draw(ex, Color.White);\r\n        }\r\n\r\n        if (currentNode.left) {\r\n          helper(currentNode.left);\r\n        }\r\n        if (currentNode.right) {\r\n          helper(currentNode.right);\r\n        }\r\n      }\r\n    };\r\n\r\n    helper(this.root);\r\n  }\r\n}\r\n","import { LineSegment } from './line-segment';\nimport { Vector } from './vector';\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\n\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: LineSegment): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  public intersectPoint(line: LineSegment): Vector {\n    const time = this.intersect(line);\n    if (time < 0) {\n      return null;\n    }\n    return this.getPoint(time);\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n","import { CollisionProcessor } from './CollisionProcessor';\r\nimport { DynamicTree } from './DynamicTree';\r\nimport { Pair } from './Pair';\r\n\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { FrameStats } from '../../Debug';\r\nimport { Logger } from '../../Util/Log';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { CollisionGroup } from '../Group/CollisionGroup';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { RayCastHit } from './RayCastHit';\r\nimport { DeepRequired } from '../../Util/Required';\r\nimport { PhysicsConfig } from '../PhysicsConfig';\r\nimport { RayCastOptions } from './RayCastOptions';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { createId } from '../../Id';\r\n\r\n/**\r\n * Responsible for performing the collision broadphase (locating potential collisions) and\r\n * the narrowphase (actual collision contacts)\r\n */\r\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\r\n  private _dynamicCollisionTree: DynamicTree<Collider>;\r\n  private _pairs = new Set<string>();\r\n\r\n  private _collisionPairCache: Pair[] = [];\r\n  private _colliders: Collider[] = [];\r\n\r\n  constructor(private _config: DeepRequired<PhysicsConfig>) {\r\n    this._dynamicCollisionTree = new DynamicTree<Collider>(_config.dynamicTree);\r\n  }\r\n\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  public query(point: Vector): Collider[];\r\n  public query(bounds: BoundingBox): Collider[];\r\n  public query(pointOrBounds: Vector | BoundingBox): Collider[] {\r\n    const results: Collider[] = [];\r\n    if (pointOrBounds instanceof BoundingBox) {\r\n      this._dynamicCollisionTree.query(\r\n        {\r\n          id: createId('collider', -1),\r\n          owner: null,\r\n          bounds: pointOrBounds\r\n        } as Collider,\r\n        (other) => {\r\n          results.push(other);\r\n          return false;\r\n        }\r\n      );\r\n    } else {\r\n      this._dynamicCollisionTree.query(\r\n        {\r\n          id: createId('collider', -1),\r\n          owner: null,\r\n          bounds: new BoundingBox(pointOrBounds.x, pointOrBounds.y, pointOrBounds.x, pointOrBounds.y)\r\n        } as Collider,\r\n        (other) => {\r\n          results.push(other);\r\n          return false;\r\n        }\r\n      );\r\n    }\r\n    return results;\r\n  }\r\n\r\n  public rayCast(ray: Ray, options?: RayCastOptions): RayCastHit[] {\r\n    const results: RayCastHit[] = [];\r\n    const maxDistance = options?.maxDistance ?? Infinity;\r\n    const collisionGroup = options?.collisionGroup;\r\n    const collisionMask = !collisionGroup ? options?.collisionMask ?? CollisionGroup.All.category : collisionGroup.category;\r\n    const searchAllColliders = options?.searchAllColliders ?? false;\r\n    this._dynamicCollisionTree.rayCastQuery(ray, maxDistance, (collider) => {\r\n      const owner = collider.owner;\r\n      const maybeBody = owner.get(BodyComponent);\r\n\r\n      if (options?.ignoreCollisionGroupAll && maybeBody.group === CollisionGroup.All) {\r\n        return false;\r\n      }\r\n\r\n      const canCollide = (collisionMask & maybeBody.group.category) !== 0;\r\n\r\n      // Early exit if not the right group\r\n      if (maybeBody?.group && !canCollide) {\r\n        return false;\r\n      }\r\n\r\n      const hit = collider.rayCast(ray, maxDistance);\r\n\r\n      if (hit) {\r\n        if (options?.filter) {\r\n          if (options.filter(hit)) {\r\n            results.push(hit);\r\n            if (!searchAllColliders) {\r\n              // returning true exits the search\r\n              return true;\r\n            }\r\n          }\r\n        } else {\r\n          results.push(hit);\r\n          if (!searchAllColliders) {\r\n            // returning true exits the search\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n      return false;\r\n    });\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Tracks a physics body for collisions\r\n   */\r\n  public track(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot track null collider');\r\n      return;\r\n    }\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        c.owner = target.owner;\r\n        this._colliders.push(c);\r\n        this._dynamicCollisionTree.trackCollider(c);\r\n      }\r\n    } else {\r\n      this._colliders.push(target);\r\n      this._dynamicCollisionTree.trackCollider(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Untracks a physics body\r\n   */\r\n  public untrack(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot untrack a null collider');\r\n      return;\r\n    }\r\n\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        const index = this._colliders.indexOf(c);\r\n        if (index !== -1) {\r\n          this._colliders.splice(index, 1);\r\n        }\r\n        this._dynamicCollisionTree.untrackCollider(c);\r\n      }\r\n    } else {\r\n      const index = this._colliders.indexOf(target);\r\n      if (index !== -1) {\r\n        this._colliders.splice(index, 1);\r\n      }\r\n      this._dynamicCollisionTree.untrackCollider(target);\r\n    }\r\n  }\r\n\r\n  private _pairExists(colliderA: Collider, colliderB: Collider) {\r\n    // if the collision pair has been calculated already short circuit\r\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    return this._pairs.has(hash);\r\n  }\r\n\r\n  /**\r\n   * Detects potential collision pairs in a broadphase approach with the dynamic AABB tree strategy\r\n   */\r\n  public broadphase(targets: Collider[], elapsed: number, stats?: FrameStats): Pair[] {\r\n    const seconds = elapsed / 1000;\r\n\r\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\r\n    const potentialColliders = targets.filter((other) => {\r\n      const body = other.owner?.get(BodyComponent);\r\n      return other.owner?.isActive && body.collisionType !== CollisionType.PreventCollision;\r\n    });\r\n\r\n    // clear old list of collision pairs\r\n    this._collisionPairCache = [];\r\n    this._pairs.clear();\r\n\r\n    // check for normal collision pairs\r\n    let collider: Collider;\r\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\r\n      collider = potentialColliders[j];\r\n      // Query the collision tree for potential colliders\r\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\r\n        if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\r\n          const pair = new Pair(collider, other);\r\n          this._pairs.add(pair.id);\r\n          this._collisionPairCache.push(pair);\r\n        }\r\n        // Always return false, to query whole tree. Returning true in the query method stops searching\r\n        return false;\r\n      });\r\n    }\r\n    if (stats) {\r\n      stats.physics.pairs = this._collisionPairCache.length;\r\n    }\r\n\r\n    // Check dynamic tree for fast moving objects\r\n    // Fast moving objects are those moving at least there smallest bound per frame\r\n    if (this._config.continuous.checkForFastBodies) {\r\n      for (const collider of potentialColliders) {\r\n        const body = collider.owner.get(BodyComponent);\r\n        // Skip non-active objects. Does not make sense on other collision types\r\n        if (body.collisionType !== CollisionType.Active) {\r\n          continue;\r\n        }\r\n\r\n        // Maximum travel distance next frame\r\n        const updateDistance =\r\n          body.vel.magnitude * seconds + // velocity term\r\n          body.acc.magnitude * 0.5 * seconds * seconds; // acc term\r\n\r\n        // Find the minimum dimension\r\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\r\n        if (this._config.continuous.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\r\n          if (stats) {\r\n            stats.physics.fastBodies++;\r\n          }\r\n\r\n          // start with the oldPos because the integration for actors has already happened\r\n          // objects resting on a surface may be slightly penetrating in the current position\r\n          const updateVec = body.globalPos.sub(body.oldPos);\r\n          const centerPoint = collider.center;\r\n          const furthestPoint = collider.getFurthestPoint(body.vel);\r\n          const origin: Vector = furthestPoint.sub(updateVec);\r\n\r\n          const ray: Ray = new Ray(origin, body.vel);\r\n\r\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\r\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * this._config.continuous.surfaceEpsilon));\r\n          let minCollider: Collider;\r\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\r\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + this._config.continuous.surfaceEpsilon * 2, (other: Collider) => {\r\n            if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\r\n              const hit = other.rayCast(ray, updateDistance + this._config.continuous.surfaceEpsilon * 10);\r\n              if (hit) {\r\n                const translate = hit.point.sub(origin);\r\n                if (translate.magnitude < minTranslate.magnitude) {\r\n                  minTranslate = translate;\r\n                  minCollider = other;\r\n                }\r\n              }\r\n            }\r\n            return false;\r\n          });\r\n\r\n          if (minCollider && Vector.isValid(minTranslate)) {\r\n            const pair = new Pair(collider, minCollider);\r\n            if (!this._pairs.has(pair.id)) {\r\n              this._pairs.add(pair.id);\r\n              this._collisionPairCache.push(pair);\r\n            }\r\n            // move the fast moving object to the other body\r\n            // need to push into the surface by ex.Physics.surfaceEpsilon\r\n            const shift = centerPoint.sub(furthestPoint);\r\n            body.globalPos = origin\r\n              .add(shift)\r\n              .add(minTranslate)\r\n              .add(ray.dir.scale(10 * this._config.continuous.surfaceEpsilon)); // needed to push the shape slightly into contact\r\n            collider.update(body.transform.get());\r\n\r\n            if (stats) {\r\n              stats.physics.fastBodyCollisions++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // return cache\r\n    return this._collisionPairCache;\r\n  }\r\n\r\n  /**\r\n   * Applies narrow phase on collision pairs to find actual area intersections\r\n   * Adds actual colliding pairs to stats' Frame data\r\n   */\r\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    let contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      contacts = contacts.concat(newContacts);\r\n      if (stats && newContacts.length > 0) {\r\n        for (const c of newContacts) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic tree positions\r\n   */\r\n  public update(targets: Collider[]): number {\r\n    let updated = 0;\r\n    const len = targets.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    this._dynamicCollisionTree.debug(ex);\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Clonable } from '../../Interfaces/Clonable';\r\nimport { Entity } from '../../EntityComponentSystem';\r\nimport { createId, Id } from '../../Id';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\nimport { EventEmitter } from '../../EventEmitter';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\nimport { CompositeCollider } from './CompositeCollider';\r\n\r\n/**\r\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\r\n * for the purposes of colliding 2 objects in excalibur.\r\n */\r\nexport abstract class Collider implements Clonable<Collider> {\r\n  private static _ID = 0;\r\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\r\n  /**\r\n   * Composite collider if any this collider is attached to\r\n   *\r\n   * **WARNING** do not tamper with this property\r\n   */\r\n  public composite: CompositeCollider | null = null;\r\n  public events = new EventEmitter();\r\n\r\n  /**\r\n   * Returns a boolean indicating whether this body collided with\r\n   * or was in stationary contact with\r\n   * the body of the other {@apilink Collider}\r\n   */\r\n  public touching(other: Collider): boolean {\r\n    const contact = this.collide(other);\r\n\r\n    if (contact) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public owner: Entity;\r\n\r\n  /**\r\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\r\n   * on top of the collider.\r\n   */\r\n  offset: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Position of the collision collider in world coordinates\r\n   */\r\n  abstract get worldPos(): Vector;\r\n\r\n  /**\r\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\r\n   */\r\n  abstract get center(): Vector;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\r\n   */\r\n  abstract get bounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\r\n   */\r\n  abstract get localBounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axes of this particular collider\r\n   */\r\n  abstract get axes(): Vector[];\r\n  /**\r\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\r\n   */\r\n  abstract getFurthestPoint(direction: Vector): Vector;\r\n\r\n  abstract getInertia(mass: number): number;\r\n\r\n  // All new CollisionShape need to do the following\r\n  // Create a new collision function in the CollisionJumpTable against all the primitives\r\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\r\n  abstract collide(collider: Collider): CollisionContact[];\r\n\r\n  /**\r\n   * Returns the closest line between the surfaces this collider and another\r\n   * @param collider\r\n   */\r\n  abstract getClosestLineBetween(collider: Collider): LineSegment;\r\n\r\n  /**\r\n   * Return wether the collider contains a point inclusive to it's border\r\n   */\r\n  abstract contains(point: Vector): boolean;\r\n\r\n  /**\r\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\r\n   */\r\n  abstract rayCast(ray: Ray, max?: number): RayCastHit | null;\r\n\r\n  /**\r\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\r\n   */\r\n  abstract project(axis: Vector): Projection;\r\n\r\n  /**\r\n   * Updates collider world space geometry\r\n   */\r\n  abstract update(transform: Transform): void;\r\n\r\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color, options?: { lineWidth: number; pointSize: number }): void;\r\n\r\n  abstract clone(): Collider;\r\n}\r\n","/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is {@apilink SolverStrategy.Arcade} which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting {@apilink SolverStrategy.Realistic} which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum SpatialPartitionStrategy {\r\n  DynamicTree = 'dynamic-tree',\r\n  SparseHashGrid = 'sparse-hash-grid'\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { DeepRequired } from '../Util/Required';\r\nimport { SolverStrategy } from './SolverStrategy';\r\nimport { ContactSolveBias } from './Solver/ContactBias';\r\nimport { SpatialPartitionStrategy } from './Detection/SpatialPartitionStrategy';\r\n\r\nexport interface DynamicTreeConfig {\r\n  /**\r\n   * Pad collider BoundingBox by a constant amount for purposes of potential pairs\r\n   *\r\n   * Default 5 pixels\r\n   */\r\n  boundsPadding?: number;\r\n\r\n  /**\r\n   * Factor to add to the collider BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\r\n   *\r\n   * Default 2\r\n   */\r\n  velocityMultiplier?: number;\r\n}\r\n\r\nexport interface SparseHashGridConfig {\r\n  /**\r\n   * Size of the grid cells, default is 100x100 pixels.\r\n   *\r\n   * A good size means that your average collider in your game would fit inside the cell size by size dimension.\r\n   */\r\n  size: number;\r\n}\r\n\r\nexport interface PhysicsConfig {\r\n  /**\r\n   * Excalibur physics simulation is enabled\r\n   */\r\n  enabled?: boolean;\r\n  /**\r\n   * Configure gravity that applies to all {@apilink CollisionType.Active} bodies.\r\n   *\r\n   * This is acceleration in pixels/sec^2\r\n   *\r\n   * Default vec(0, 0)\r\n   *\r\n   * {@apilink BodyComponent.useGravity} to opt out\r\n   */\r\n  gravity?: Vector;\r\n  /**\r\n   * Configure the type of physics simulation you would like\r\n   *\r\n   * * {@apilink SolverStrategy.Arcade} is suitable for games where you might be doing platforming or top down movement.\r\n   * * {@apilink SolverStrategy.Realistic} is where you need objects to bounce off each other and respond like real world objects.\r\n   *\r\n   * Default is Arcade\r\n   */\r\n  solver?: SolverStrategy;\r\n\r\n  /**\r\n   * Configure physics sub-stepping, this can increase simulation fidelity by doing smaller physics steps\r\n   *\r\n   * Default is 1 step\r\n   */\r\n  substep?: number;\r\n\r\n  /**\r\n   * Configure colliders\r\n   */\r\n  colliders?: {\r\n    /**\r\n     * Treat composite collider's member colliders as either separate colliders for the purposes of onCollisionStart/onCollision\r\n     * or as a single collider together.\r\n     *\r\n     * This property can be overridden on individual {@apilink CompositeColliders}.\r\n     *\r\n     * For composites without gaps or small groups of colliders, you probably want 'together'\r\n     *\r\n     * For composites with deliberate gaps, like a platforming level layout, you probably want 'separate'\r\n     *\r\n     * Default is 'together' if unset\r\n     */\r\n    compositeStrategy?: 'separate' | 'together';\r\n  };\r\n\r\n  /**\r\n   * Configure excalibur continuous collision (WIP)\r\n   */\r\n  continuous?: {\r\n    /**\r\n     * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\r\n     * bodies from tunneling through one another.\r\n     *\r\n     * Default true\r\n     */\r\n    checkForFastBodies?: boolean;\r\n\r\n    /**\r\n     * Disable minimum fast moving body raycast, by default if checkForFastBodies = true Excalibur will only check if the\r\n     * body is moving at least half of its minimum dimension in an update. If disableMinimumSpeedForFastBody is set to true,\r\n     * Excalibur will always perform the fast body raycast regardless of speed.\r\n     *\r\n     * Default false\r\n     */\r\n    disableMinimumSpeedForFastBody?: boolean;\r\n\r\n    /**\r\n     * Surface epsilon is used to help deal with predicting collisions by applying a slop\r\n     *\r\n     * Default 0.1\r\n     */\r\n    surfaceEpsilon?: number;\r\n  };\r\n\r\n  /**\r\n   * Configure body defaults\r\n   */\r\n  bodies?: {\r\n    /**\r\n     * Configure default mass that bodies have\r\n     *\r\n     * Default 10 mass units\r\n     */\r\n    defaultMass?: number;\r\n\r\n    /**\r\n     * Sleep epsilon\r\n     *\r\n     * Default 0.07\r\n     */\r\n    sleepEpsilon?: number;\r\n\r\n    /**\r\n     * Wake Threshold, the amount of \"motion\" need to wake a body from sleep\r\n     *\r\n     * Default 0.07 * 3;\r\n     */\r\n    wakeThreshold?: number;\r\n\r\n    /**\r\n     * Sleep bias\r\n     *\r\n     * Default 0.9\r\n     */\r\n    sleepBias?: number;\r\n\r\n    /**\r\n     * By default bodies do not sleep, this can be turned on to improve perf if you have a lot of bodies.\r\n     *\r\n     * Default false\r\n     */\r\n    canSleepByDefault?: boolean;\r\n  };\r\n\r\n  /**\r\n   * Configure the spatial data structure for locating pairs and raycasts\r\n   */\r\n  spatialPartition?: SpatialPartitionStrategy;\r\n  sparseHashGrid?: SparseHashGridConfig;\r\n  dynamicTree?: DynamicTreeConfig;\r\n\r\n  /**\r\n   * Configure the {@apilink ArcadeSolver}\r\n   */\r\n  arcade?: {\r\n    /**\r\n     * Hints the {@apilink ArcadeSolver} to preferentially solve certain contact directions first.\r\n     *\r\n     * Options:\r\n     * * Solve {@apilink ContactSolveBias.VerticalFirst} which will do vertical contact resolution first (useful for platformers\r\n     * with up/down gravity)\r\n     * * Solve {@apilink ContactSolveBias.HorizontalFirst} which will do horizontal contact resolution first (useful for games with\r\n     * left/right forces)\r\n     * * By default {@apilink ContactSolveBias.None} which sorts by distance\r\n     */\r\n    contactSolveBias?: ContactSolveBias;\r\n  };\r\n\r\n  /**\r\n   * Configure the {@apilink RealisticSolver}\r\n   */\r\n  realistic?: {\r\n    /**\r\n     * Number of position iterations (overlap) to run in the solver\r\n     *\r\n     * Default 3 iterations\r\n     */\r\n    positionIterations?: number;\r\n\r\n    /**\r\n     * Number of velocity iteration (response) to run in the solver\r\n     *\r\n     * Default 8 iterations\r\n     */\r\n    velocityIterations?: number;\r\n\r\n    /**\r\n     * Amount of overlap to tolerate in pixels\r\n     *\r\n     * Default 1 pixel\r\n     */\r\n    slop?: number;\r\n\r\n    /**\r\n     * Amount of positional overlap correction to apply each position iteration of the solver\r\n     * 0 - meaning no correction, 1 - meaning correct all overlap. Generally values 0 < .5 look nice.\r\n     *\r\n     * Default 0.2\r\n     */\r\n    steeringFactor?: number;\r\n\r\n    /**\r\n     * Warm start set to true re-uses impulses from previous frames back in the solver. Re-using impulses helps\r\n     * the solver converge quicker\r\n     *\r\n     * Default true\r\n     */\r\n    warmStart?: boolean;\r\n  };\r\n}\r\n\r\nexport const getDefaultPhysicsConfig: () => DeepRequired<PhysicsConfig> = () => ({\r\n  enabled: true,\r\n  gravity: vec(0, 0).clone(),\r\n  solver: SolverStrategy.Arcade,\r\n  substep: 1,\r\n  colliders: {\r\n    compositeStrategy: 'together'\r\n  },\r\n  continuous: {\r\n    checkForFastBodies: true,\r\n    disableMinimumSpeedForFastBody: false,\r\n    surfaceEpsilon: 0.1\r\n  },\r\n  bodies: {\r\n    canSleepByDefault: false,\r\n    sleepEpsilon: 0.07,\r\n    wakeThreshold: 0.07 * 3,\r\n    sleepBias: 0.9,\r\n    defaultMass: 10\r\n  },\r\n  spatialPartition: SpatialPartitionStrategy.SparseHashGrid,\r\n  sparseHashGrid: {\r\n    size: 100\r\n  },\r\n  dynamicTree: {\r\n    boundsPadding: 5,\r\n    velocityMultiplier: 2\r\n  },\r\n  arcade: {\r\n    contactSolveBias: ContactSolveBias.None\r\n  },\r\n  realistic: {\r\n    positionIterations: 3,\r\n    velocityIterations: 8,\r\n    slop: 1,\r\n    steeringFactor: 0.2,\r\n    warmStart: true\r\n  }\r\n});\r\n","import { Util } from '../..';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector } from '../../Math/vector';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { DynamicTree } from '../Detection/DynamicTree';\r\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\nimport { Collider } from './Collider';\r\nimport { Transform } from '../../Math/transform';\r\nimport { getDefaultPhysicsConfig } from '../PhysicsConfig';\r\n\r\nexport class CompositeCollider extends Collider {\r\n  private _transform: Transform;\r\n  private _collisionProcessor = new DynamicTreeCollisionProcessor({\r\n    ...getDefaultPhysicsConfig()\r\n  });\r\n  private _dynamicAABBTree = new DynamicTree({\r\n    boundsPadding: 5,\r\n    velocityMultiplier: 2\r\n  });\r\n  private _colliders: Collider[] = [];\r\n\r\n  private _compositeStrategy?: 'separate' | 'together';\r\n  /**\r\n   * Treat composite collider's member colliders as either separate colliders for the purposes of onCollisionStart/onCollision\r\n   * or as a single collider together.\r\n   *\r\n   * This property can be overridden on individual {@apilink CompositeColliders}.\r\n   *\r\n   * For composites without gaps or small groups of colliders, you probably want 'together'\r\n   *\r\n   * For composites with deliberate gaps, like a platforming level layout, you probably want 'separate'\r\n   *\r\n   * Default is 'together' if unset\r\n   */\r\n  public set compositeStrategy(value: 'separate' | 'together') {\r\n    this._compositeStrategy = value;\r\n  }\r\n  public get compositeStrategy() {\r\n    return this._compositeStrategy;\r\n  }\r\n\r\n  constructor(colliders: Collider[]) {\r\n    super();\r\n    for (const c of colliders) {\r\n      this.addCollider(c);\r\n    }\r\n  }\r\n\r\n  clearColliders() {\r\n    this._colliders = [];\r\n  }\r\n\r\n  addCollider(collider: Collider) {\r\n    let colliders: Collider[];\r\n    if (collider instanceof CompositeCollider) {\r\n      colliders = collider.getColliders();\r\n      colliders.forEach((c) => c.offset.addEqual(collider.offset));\r\n    } else {\r\n      colliders = [collider];\r\n    }\r\n    // Flatten composites\r\n    for (const c of colliders) {\r\n      c.events.pipe(this.events);\r\n      c.composite = this;\r\n      this._colliders.push(c);\r\n      this._collisionProcessor.track(c);\r\n      this._dynamicAABBTree.trackCollider(c);\r\n    }\r\n  }\r\n\r\n  removeCollider(collider: Collider) {\r\n    collider.events.pipe(this.events);\r\n    collider.composite = null;\r\n    Util.removeItemFromArray(collider, this._colliders);\r\n    this._collisionProcessor.untrack(collider);\r\n    this._dynamicAABBTree.untrackCollider(collider);\r\n  }\r\n\r\n  getColliders(): Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    return (this._transform?.pos ?? Vector.Zero).add(this.offset);\r\n  }\r\n\r\n  get center(): Vector {\r\n    return (this._transform?.pos ?? Vector.Zero).add(this.offset);\r\n  }\r\n\r\n  get bounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce(\r\n      (acc, collider) => acc.combine(collider.bounds),\r\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\r\n    );\r\n\r\n    return results.translate(this.offset);\r\n  }\r\n\r\n  get localBounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\r\n\r\n    return results;\r\n  }\r\n\r\n  get axes(): Vector[] {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    let axes: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      axes = axes.concat(collider.axes);\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  getFurthestPoint(direction: Vector): Vector {\r\n    const colliders = this.getColliders();\r\n    const furthestPoints: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      furthestPoints.push(collider.getFurthestPoint(direction));\r\n    }\r\n    // Pick best point from all colliders\r\n    let bestPoint = furthestPoints[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (const point of furthestPoints) {\r\n      const distance = point.dot(direction);\r\n      if (distance > maxDistance) {\r\n        bestPoint = point;\r\n        maxDistance = distance;\r\n      }\r\n    }\r\n    return bestPoint;\r\n  }\r\n\r\n  getInertia(mass: number): number {\r\n    const colliders = this.getColliders();\r\n    let totalInertia = 0;\r\n    for (const collider of colliders) {\r\n      totalInertia += collider.getInertia(mass);\r\n    }\r\n    return totalInertia;\r\n  }\r\n\r\n  collide(other: Collider): CollisionContact[] {\r\n    let otherColliders = [other];\r\n    if (other instanceof CompositeCollider) {\r\n      otherColliders = other.getColliders();\r\n    }\r\n\r\n    const pairs: Pair[] = [];\r\n    for (const c of otherColliders) {\r\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\r\n        pairs.push(new Pair(c, potentialCollider));\r\n        return false;\r\n      });\r\n    }\r\n\r\n    let contacts: CollisionContact[] = [];\r\n    for (const p of pairs) {\r\n      contacts = contacts.concat(p.collide());\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  getClosestLineBetween(other: Collider): LineSegment {\r\n    const colliders = this.getColliders();\r\n    const lines: LineSegment[] = [];\r\n    if (other instanceof CompositeCollider) {\r\n      const otherColliders = other.getColliders();\r\n      for (const colliderA of colliders) {\r\n        for (const colliderB of otherColliders) {\r\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\r\n          if (maybeLine) {\r\n            lines.push(maybeLine);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const collider of colliders) {\r\n        const maybeLine = other.getClosestLineBetween(collider);\r\n        if (maybeLine) {\r\n          lines.push(maybeLine);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lines.length) {\r\n      let minLength = lines[0].getLength();\r\n      let minLine = lines[0];\r\n      for (const line of lines) {\r\n        const length = line.getLength();\r\n        if (length < minLength) {\r\n          minLength = length;\r\n          minLine = line;\r\n        }\r\n      }\r\n      return minLine;\r\n    }\r\n    return null;\r\n  }\r\n  contains(point: Vector): boolean {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      if (collider.contains(point)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  rayCast(ray: Ray, max?: number): RayCastHit | null {\r\n    const colliders = this.getColliders();\r\n    const hits: RayCastHit[] = [];\r\n    for (const collider of colliders) {\r\n      const hit = collider.rayCast(ray, max);\r\n      if (hit) {\r\n        hits.push(hit);\r\n      }\r\n    }\r\n    if (hits.length) {\r\n      let minHit = hits[0];\r\n      let minDistance = minHit.point.dot(ray.dir);\r\n      for (const hit of hits) {\r\n        const distance = ray.dir.dot(hit.point);\r\n        if (distance < minDistance) {\r\n          minHit = hit;\r\n          minDistance = distance;\r\n        }\r\n      }\r\n      return minHit;\r\n    }\r\n    return null;\r\n  }\r\n  project(axis: Vector): Projection {\r\n    const colliders = this.getColliders();\r\n    const projections: Projection[] = [];\r\n    for (const collider of colliders) {\r\n      const proj = collider.project(axis);\r\n      if (proj) {\r\n        projections.push(proj);\r\n      }\r\n    }\r\n    // Merge all proj's on the same axis\r\n    if (projections.length) {\r\n      const newProjection = new Projection(projections[0].min, projections[0].max);\r\n      for (const proj of projections) {\r\n        newProjection.min = Math.min(proj.min, newProjection.min);\r\n        newProjection.max = Math.max(proj.max, newProjection.max);\r\n      }\r\n      return newProjection;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  update(transform: Transform): void {\r\n    if (transform) {\r\n      const colliders = this.getColliders();\r\n      for (const collider of colliders) {\r\n        collider.owner = this.owner;\r\n        collider.update(transform);\r\n      }\r\n    }\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color, options?: { lineWidth: number; pointSize: number }) {\r\n    const colliders = this.getColliders();\r\n    ex.save();\r\n    ex.translate(this.offset.x, this.offset.y);\r\n    for (const collider of colliders) {\r\n      collider.debug(ex, color, options);\r\n    }\r\n    ex.restore();\r\n  }\r\n\r\n  clone(): Collider {\r\n    const result = new CompositeCollider(this._colliders.map((c) => c.clone()));\r\n    result.offset = this.offset.clone();\r\n    return result;\r\n  }\r\n}\r\n","import { AffineMatrix } from './affine-matrix';\r\nimport { Vector } from './vector';\r\n\r\n/**\r\n * A 2D line segment\r\n */\r\n\r\nexport class LineSegment {\r\n  /**\r\n   * @param begin  The starting point of the line segment\r\n   * @param end  The ending point of the line segment\r\n   */\r\n  constructor(\r\n    public begin: Vector,\r\n    public end: Vector\r\n  ) {}\r\n\r\n  clone(dest?: LineSegment): LineSegment {\r\n    const result = dest || new LineSegment(this.begin.clone(), this.end.clone());\r\n    result.begin = this.begin.clone(result.begin);\r\n    result.end = this.end.clone(result.end);\r\n    return result;\r\n  }\r\n\r\n  transform(matrix: AffineMatrix, dest?: LineSegment): LineSegment {\r\n    const result = dest || new LineSegment(Vector.Zero, Vector.Zero);\r\n    result.begin = matrix.multiply(this.begin, result.begin);\r\n    result.end = matrix.multiply(this.end, result.end);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\r\n   */\r\n  public get slope() {\r\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\r\n  }\r\n\r\n  /**\r\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\r\n   */\r\n  public get intercept() {\r\n    return this.begin.y - this.slope * this.begin.x;\r\n  }\r\n\r\n  private _normal: Vector;\r\n  /**\r\n   * Gets the normal of the line\r\n   */\r\n  public normal(): Vector {\r\n    if (this._normal) {\r\n      return this._normal;\r\n    }\r\n    return (this._normal = this.end.sub(this.begin).normal());\r\n  }\r\n\r\n  private _dir: Vector;\r\n  public dir(): Vector {\r\n    if (this._dir) {\r\n      return this._dir;\r\n    }\r\n    return (this._dir = this.end.sub(this.begin));\r\n  }\r\n\r\n  public getPoints(): Vector[] {\r\n    return [this.begin, this.end];\r\n  }\r\n\r\n  private _slope: Vector;\r\n  /**\r\n   * Returns the slope of the line in the form of a vector of length 1\r\n   */\r\n  public getSlope(): Vector {\r\n    if (this._slope) {\r\n      return this._slope;\r\n    }\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    const distance = begin.distance(end);\r\n    return (this._slope = end.sub(begin).scale(1 / distance));\r\n  }\r\n\r\n  /**\r\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\r\n   */\r\n  public getEdge(): Vector {\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    return end.sub(begin);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Returns the midpoint of the edge\r\n   */\r\n  public get midpoint(): Vector {\r\n    return this.begin.add(this.end).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Flips the direction of the line segment\r\n   */\r\n  public flip(): LineSegment {\r\n    return new LineSegment(this.end, this.begin);\r\n  }\r\n\r\n  /**\r\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\r\n   * @param point\r\n   */\r\n  public below(point: Vector): boolean {\r\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\r\n    return above2 >= 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the clip point\r\n   * @param sideVector Vector that traces the line\r\n   * @param length Length to clip along side\r\n   */\r\n  public clip(sideVector: Vector, length: number, normalize = true): LineSegment {\r\n    let dir = sideVector;\r\n    if (normalize) {\r\n      dir = dir.normalize();\r\n    }\r\n\r\n    const near = dir.dot(this.begin) - length;\r\n    const far = dir.dot(this.end) - length;\r\n\r\n    const results = [];\r\n    if (near <= 0) {\r\n      results.push(this.begin);\r\n    }\r\n    if (far <= 0) {\r\n      results.push(this.end);\r\n    }\r\n\r\n    if (near * far < 0) {\r\n      const clipTime = near / (near - far);\r\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\r\n    }\r\n    if (results.length !== 2) {\r\n      return null;\r\n    }\r\n\r\n    return new LineSegment(results[0], results[1]);\r\n  }\r\n\r\n  /**\r\n   * Find the perpendicular distance from the line to a point\r\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n   * @param point\r\n   */\r\n  public distanceToPoint(point: Vector, signed: boolean = false) {\r\n    const x0 = point.x;\r\n    const y0 = point.y;\r\n\r\n    const l = this.getLength();\r\n\r\n    const dy = this.end.y - this.begin.y;\r\n    const dx = this.end.x - this.begin.x;\r\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\r\n    return signed ? distance : Math.abs(distance);\r\n  }\r\n\r\n  /**\r\n   * Find the perpendicular line from the line to a point\r\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n   * (a - p) - ((a - p) * n)n\r\n   * a is a point on the line\r\n   * p is the arbitrary point above the line\r\n   * n is a unit vector in direction of the line\r\n   * @param point\r\n   */\r\n  public findVectorToPoint(point: Vector): Vector {\r\n    const aMinusP = this.begin.sub(point);\r\n    const n = this.getSlope();\r\n\r\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\r\n  }\r\n\r\n  /**\r\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\r\n   * a new point with the calculated Y value and vice-versa.\r\n   * @param x The known X value of the target point\r\n   * @param y The known Y value of the target point\r\n   * @returns A new point with the other calculated axis value\r\n   */\r\n  public findPoint(x: number = null, y: number = null): Vector {\r\n    const m = this.slope;\r\n    const b = this.intercept;\r\n\r\n    if (x !== null) {\r\n      return new Vector(x, m * x + b);\r\n    } else if (y !== null) {\r\n      return new Vector((y - b) / m, y);\r\n    } else {\r\n      throw new Error('You must provide an X or a Y value');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given point lies on this line. This method is precise by default\r\n   * meaning the point must lie exactly on the line. Adjust threshold to\r\n   * loosen the strictness of the check for floating-point calculations.\r\n   */\r\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\r\n\r\n  /**\r\n   * Whether or not the given point lies on this line. This method is precise by default\r\n   * meaning the point must lie exactly on the line. Adjust threshold to\r\n   * loosen the strictness of the check for floating-point calculations.\r\n   */\r\n  public hasPoint(v: Vector, threshold?: number): boolean;\r\n\r\n  /**\r\n   * @see http://stackoverflow.com/a/11908158/109458\r\n   */\r\n  public hasPoint(): boolean {\r\n    let currPoint: Vector;\r\n    let threshold = 0;\r\n\r\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\r\n      currPoint = new Vector(arguments[0], arguments[1]);\r\n      threshold = arguments[2] || 0;\r\n    } else if (arguments[0] instanceof Vector) {\r\n      currPoint = arguments[0];\r\n      threshold = arguments[1] || 0;\r\n    } else {\r\n      throw 'Could not determine the arguments for Vector.hasPoint';\r\n    }\r\n\r\n    const dxc = currPoint.x - this.begin.x;\r\n    const dyc = currPoint.y - this.begin.y;\r\n\r\n    const dx1 = this.end.x - this.begin.x;\r\n    const dy1 = this.end.y - this.begin.y;\r\n\r\n    const cross = dxc * dy1 - dyc * dx1;\r\n\r\n    // check whether point lines on the line\r\n    if (Math.abs(cross) > threshold) {\r\n      return false;\r\n    }\r\n\r\n    // check whether point lies in-between start and end\r\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\r\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\r\n    } else {\r\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\r\n    }\r\n  }\r\n}\r\n","import { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { clamp } from '../../Math/util';\r\n\r\n/**\r\n * Finds the closest line segment between two given line segments.\r\n */\r\nfunction ClosestLine(line1: LineSegment, line2: LineSegment) {\r\n  // https://math.stackexchange.com/questions/1993953/closest-points-between-2-lines-in-2d\r\n  const EPSILON = 1e-9;\r\n\r\n  const line1Dir = line1.dir();\r\n  const line2Dir = line2.dir();\r\n\r\n  const d1Squared = line1Dir.dot(line1Dir);\r\n  const d2Squared = line2Dir.dot(line2Dir);\r\n\r\n  if (d1Squared < EPSILON && d2Squared < EPSILON) {\r\n    return new LineSegment(line1.begin, line2.begin);\r\n  }\r\n\r\n  if (d1Squared < EPSILON) {\r\n    const t = clamp(line2Dir.dot(line1.begin.sub(line2.begin)) / d2Squared, 0, 1);\r\n    const closestPoint = line2.begin.add(line2Dir.scale(t));\r\n    return new LineSegment(line1.begin, closestPoint);\r\n  }\r\n\r\n  if (d2Squared < EPSILON) {\r\n    const t = clamp(line1Dir.dot(line2.begin.sub(line1.begin)) / d1Squared, 0, 1);\r\n    const closestPoint = line1.begin.add(line1Dir.scale(t));\r\n    return new LineSegment(closestPoint, line2.begin);\r\n  }\r\n\r\n  const r = line1.begin.sub(line2.begin);\r\n  const a = d1Squared;\r\n  const e = d2Squared;\r\n  const f = line2Dir.dot(r);\r\n\r\n  const denom = a * e - Math.pow(line1Dir.dot(line2Dir), 2);\r\n\r\n  let s = 0;\r\n  let t = 0;\r\n\r\n  if (Math.abs(denom) > EPSILON) {\r\n    s = clamp((line1Dir.dot(line2Dir) * f - e * line1Dir.dot(r)) / denom, 0, 1);\r\n  } else {\r\n    // lines are parallel\r\n    s = clamp(line1Dir.dot(r) / a, 0, 1);\r\n  }\r\n\r\n  if (Math.abs(e) > EPSILON) {\r\n    t = clamp((line1Dir.dot(line2Dir) * s + f) / e, 0, 1);\r\n  } else {\r\n    // line2 is a degenerate point\r\n    t = 0;\r\n  }\r\n\r\n  const closestPointOnLine1 = line1.begin.add(line1Dir.scale(s));\r\n  const closestPointOnLine2 = line2.begin.add(line2Dir.scale(t));\r\n\r\n  return new LineSegment(closestPointOnLine1, closestPointOnLine2);\r\n}\r\n\r\nexport const ClosestLineJumpTable = {\r\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\r\n    const aSides = polygonA.getSides();\r\n    const bSides = polygonB.getSides();\r\n\r\n    let minDistance = Number.MAX_VALUE;\r\n    let closestLine: LineSegment | null = null;\r\n\r\n    for (let i = 0; i < aSides.length; i++) {\r\n      for (let j = 0; j < bSides.length; j++) {\r\n        const line = ClosestLine(aSides[i], bSides[j]);\r\n        const distance = line.getLength();\r\n\r\n        if (distance < minDistance) {\r\n          minDistance = distance;\r\n          closestLine = line;\r\n        }\r\n      }\r\n    }\r\n\r\n    return closestLine;\r\n  },\r\n\r\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = edge.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\r\n\r\n    const thisPoint = polygon.rayCast(rayTowardsOther).point.add(rayTowardsOther.dir.scale(0.1));\r\n\r\n    const thisFace = polygon.getClosestFace(thisPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const edgeLine = edge.asLine();\r\n\r\n    return ClosestLine(thisFace.face, edgeLine);\r\n  },\r\n\r\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\r\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = circle.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\r\n\r\n    const thisPoint = polygon.rayCast(rayTowardsOther).point.add(rayTowardsOther.dir.scale(0.1));\r\n\r\n    const thisFace = polygon.getClosestFace(thisPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const p0 = thisFace.face.begin;\r\n    const u = thisFace.face.getEdge();\r\n\r\n    // Time of minimum distance\r\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\r\n\r\n    // If time of minimum is past the edge clamp\r\n    if (t > 1) {\r\n      t = 1;\r\n    } else if (t < 0) {\r\n      t = 0;\r\n    }\r\n\r\n    // Minimum distance\r\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\r\n\r\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\r\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\r\n    return new LineSegment(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\r\n  },\r\n\r\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = circleB.worldPos;\r\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\r\n\r\n    const thisWorldPos = circleA.worldPos;\r\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\r\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\r\n\r\n    const thisPoint = circleA.rayCast(rayTowardsOther);\r\n    const otherPoint = circleB.rayCast(rayTowardsThis);\r\n\r\n    return new LineSegment(thisPoint.point, otherPoint.point);\r\n  },\r\n\r\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\r\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\r\n    const circleWorldPos = circle.worldPos;\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const edgeLine = edge.asLine();\r\n    const edgeStart = edgeLine.begin;\r\n    const edgeVector = edgeLine.getEdge();\r\n    const p0 = edgeStart;\r\n    const u = edgeVector;\r\n\r\n    // Time of minimum distance\r\n    let t = (u.x * (circleWorldPos.x - p0.x) + u.y * (circleWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\r\n\r\n    // If time of minimum is past the edge clamp to edge\r\n    if (t > 1) {\r\n      t = 1;\r\n    } else if (t < 0) {\r\n      t = 0;\r\n    }\r\n\r\n    // Minimum distance\r\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorldPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorldPos.y, 2)) - circle.radius;\r\n\r\n    const circlex = ((p0.x + u.x * t - circleWorldPos.x) * circle.radius) / (circle.radius + d);\r\n    const circley = ((p0.y + u.y * t - circleWorldPos.y) * circle.radius) / (circle.radius + d);\r\n    return new LineSegment(u.scale(t).add(p0), new Vector(circleWorldPos.x + circlex, circleWorldPos.y + circley));\r\n  },\r\n\r\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const edgeLineA = edgeA.asLine();\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const edgeLineB = edgeB.asLine();\r\n\r\n    return ClosestLine(edgeLineA, edgeLineB);\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\n\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { BodyComponent } from '../Index';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\nimport { approximatelyEqual } from '../../Math/util';\r\n\r\nexport interface CircleColliderOptions {\r\n  /**\r\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Required radius of the circle\r\n   */\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * This is a circle collider for the excalibur rigid body physics simulation\r\n */\r\nexport class CircleCollider extends Collider {\r\n  /**\r\n   * Position of the circle relative to the collider, by default (0, 0).\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  private _globalMatrix: AffineMatrix = AffineMatrix.identity();\r\n\r\n  public get worldPos(): Vector {\r\n    return this._globalMatrix.getPosition();\r\n  }\r\n\r\n  private _naturalRadius: number;\r\n\r\n  private _radius: number | undefined;\r\n  /**\r\n   * Get the radius of the circle\r\n   */\r\n  public get radius(): number {\r\n    if (this._radius) {\r\n      return this._radius;\r\n    }\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\r\n    return (this._radius = this._naturalRadius * Math.min(scale.x, scale.y));\r\n  }\r\n\r\n  /**\r\n   * Set the radius of the circle\r\n   */\r\n  public set radius(val: number) {\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\r\n    this._naturalRadius = val / Math.min(scale.x, scale.y);\r\n    this._localBoundsDirty = true;\r\n    this._radius = val;\r\n  }\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: CircleColliderOptions) {\r\n    super();\r\n    this.offset = options.offset || Vector.Zero;\r\n    this.radius = options.radius || 0;\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this shape, not associated with any collider\r\n   */\r\n  public clone(): CircleCollider {\r\n    return new CircleCollider({\r\n      offset: this.offset.clone(),\r\n      radius: this.radius\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this._globalMatrix.getPosition();\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    const pos = this._transform?.pos ?? this.offset;\r\n    const distance = pos.distance(point);\r\n    if (distance <= this.radius) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Casts a ray at the Circle collider and returns the nearest point of collision\r\n   * @param ray\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): RayCastHit | null {\r\n    // https://en.wikipedia.org/wiki/Intersection_(geometry)#A_line_and_a_circle\r\n    const c = this.center;\r\n    const dir = ray.dir;\r\n    const orig = ray.pos;\r\n\r\n    const u = c.sub(orig);\r\n\r\n    const u1 = dir.scale(u.dot(dir));\r\n    const u2 = u.sub(u1);\r\n\r\n    const d = u2.magnitude;\r\n\r\n    if (d > this.radius) {\r\n      return null;\r\n    } else {\r\n      // tangent case\r\n      let toi = 0;\r\n      if (approximatelyEqual(d, this.radius, 0.0001)) {\r\n        toi = -dir.dot(orig.sub(c));\r\n        if (toi > 0 && toi < max) {\r\n          const point = ray.getPoint(toi);\r\n          return {\r\n            point,\r\n            normal: point.sub(c).normalize(),\r\n            collider: this,\r\n            body: this.owner?.get(BodyComponent),\r\n            distance: toi\r\n          } satisfies RayCastHit;\r\n        }\r\n        return null;\r\n      } else {\r\n        // two point\r\n        const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\r\n\r\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\r\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\r\n\r\n        const positiveToi: number[] = [];\r\n        if (toi1 >= 0) {\r\n          positiveToi.push(toi1);\r\n        }\r\n\r\n        if (toi2 >= 0) {\r\n          positiveToi.push(toi2);\r\n        }\r\n\r\n        const minToi = Math.min(...positiveToi);\r\n        if (minToi <= max) {\r\n          const point = ray.getPoint(minToi);\r\n          return {\r\n            point,\r\n            normal: point.sub(c).normalize(),\r\n            collider: this,\r\n            body: this.owner?.get(BodyComponent),\r\n            distance: minToi\r\n          } satisfies RayCastHit;\r\n        }\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getClosestLineBetween(shape: Collider): LineSegment {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    return this.center.add(direction.normalize().scale(this.radius));\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the shape in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const dir = direction.normalize();\r\n    return dir.scale(this.radius);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    return this.localBounds.transform(this._globalMatrix);\r\n  }\r\n\r\n  private _localBoundsDirty = true;\r\n  private _localBounds: BoundingBox;\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    if (this._localBoundsDirty) {\r\n      this._localBounds = new BoundingBox(-this._naturalRadius, -this._naturalRadius, +this._naturalRadius, +this._naturalRadius);\r\n      this._localBoundsDirty = false;\r\n    }\r\n    return this._localBounds;\r\n  }\r\n\r\n  /**\r\n   * Get axis not implemented on circles, since there are infinite axis in a circle\r\n   */\r\n  public get axes(): Vector[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Returns the moment of inertia of a circle given it's mass\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    return (mass * this.radius * this.radius) / 2;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    const globalMat = transform.matrix ?? this._globalMatrix;\r\n    globalMat.clone(this._globalMatrix);\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n    this._radius = undefined;\r\n  }\r\n\r\n  /**\r\n   * Project the circle along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n    const point = this.center;\r\n    const dotProduct = point.dot(axis);\r\n    scalars.push(dotProduct);\r\n    scalars.push(dotProduct + this.radius);\r\n    scalars.push(dotProduct - this.radius);\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color, options?: { lineWidth: number }) {\r\n    const { lineWidth } = { ...{ lineWidth: 1 }, ...options };\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = tx?.globalPos ?? Vector.Zero;\r\n    ex.save();\r\n    ex.translate(pos.x, pos.y);\r\n    ex.rotate(rotation);\r\n    ex.scale(scale.x, scale.y);\r\n    ex.drawCircle(this.offset ?? Vector.Zero, this._naturalRadius, Color.Transparent, color, lineWidth);\r\n    ex.restore();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Pair } from './Pair';\r\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\r\n * Pair prevents collisions from being evaluated more than one time\r\n */\r\nexport class CollisionContact {\r\n  private _canceled = false;\r\n\r\n  /**\r\n   * Currently the ids between colliders\r\n   */\r\n  readonly id: string;\r\n\r\n  /**\r\n   * The first collider in the collision\r\n   */\r\n  colliderA: Collider;\r\n\r\n  /**\r\n   * The second collider in the collision\r\n   */\r\n  colliderB: Collider;\r\n\r\n  /**\r\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\r\n   */\r\n  mtv: Vector;\r\n\r\n  /**\r\n   * World space contact points between colliderA and colliderB\r\n   */\r\n  points: Vector[];\r\n\r\n  /**\r\n   * Local space contact points between colliderA and colliderB\r\n   */\r\n  localPoints: Vector[];\r\n\r\n  /**\r\n   * The collision normal, pointing away from colliderA\r\n   */\r\n  normal: Vector;\r\n\r\n  /**\r\n   * The collision tangent\r\n   */\r\n  tangent: Vector;\r\n\r\n  /**\r\n   * Information about the specifics of the collision contact separation\r\n   */\r\n  info: SeparationInfo;\r\n\r\n  bodyA: BodyComponent | null = null;\r\n  bodyB: BodyComponent | null = null;\r\n\r\n  constructor(\r\n    colliderA: Collider,\r\n    colliderB: Collider,\r\n    mtv: Vector,\r\n    normal: Vector,\r\n    tangent: Vector,\r\n    points: Vector[],\r\n    localPoints: Vector[],\r\n    info: SeparationInfo\r\n  ) {\r\n    this.colliderA = colliderA;\r\n    this.colliderB = colliderB;\r\n    this.mtv = mtv;\r\n    this.normal = normal;\r\n    this.tangent = tangent;\r\n    this.points = points;\r\n    this.localPoints = localPoints;\r\n    this.info = info;\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    if (colliderA.composite || colliderB.composite) {\r\n      // Add on the parent composite pair for start/end contact if 'together\r\n      const colliderAId = colliderA.composite?.compositeStrategy === 'separate' ? colliderA.id : colliderA.composite?.id ?? colliderA.id;\r\n      const colliderBId = colliderB.composite?.compositeStrategy === 'separate' ? colliderB.id : colliderB.composite?.id ?? colliderB.id;\r\n      this.id += '|' + Pair.calculatePairHash(colliderAId, colliderBId);\r\n    }\r\n    if (this.colliderA.owner) {\r\n      this.bodyA = this.colliderA.owner.get(BodyComponent);\r\n    }\r\n    if (this.colliderB.owner) {\r\n      this.bodyB = this.colliderB.owner.get(BodyComponent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Match contact awake state, except if body's are Fixed\r\n   */\r\n  public matchAwake(): void {\r\n    const bodyA = this.bodyA;\r\n    const bodyB = this.bodyB;\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.isSleeping !== bodyB.isSleeping) {\r\n        if (bodyA.isSleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= bodyA.wakeThreshold) {\r\n          bodyA.isSleeping = false;\r\n        }\r\n        if (bodyB.isSleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= bodyB.wakeThreshold) {\r\n          bodyB.isSleeping = false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public isCanceled() {\r\n    return this._canceled;\r\n  }\r\n\r\n  public cancel(): void {\r\n    this._canceled = true;\r\n  }\r\n\r\n  /**\r\n   * Biases the contact so that the given collider is colliderA\r\n   */\r\n  public bias(collider: Collider) {\r\n    if (collider !== this.colliderA && collider !== this.colliderB) {\r\n      throw new Error('Collider must be either colliderA or colliderB from this contact');\r\n    }\r\n\r\n    if (collider === this.colliderA) {\r\n      return this;\r\n    }\r\n\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n\r\n    this.colliderB = colliderA;\r\n    this.colliderA = colliderB;\r\n    this.mtv = this.mtv.negate();\r\n    this.normal = this.normal.negate();\r\n    this.tangent = this.tangent.negate();\r\n\r\n    return this;\r\n  }\r\n}\r\n","import { LineSegment } from '../../Math/line-segment';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Collider } from './Collider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Pool } from '../../Util/Pool';\r\n\r\n/**\r\n * Specific information about a contact and it's separation\r\n */\r\nexport class SeparationInfo {\r\n  /**\r\n   * Collider A\r\n   */\r\n  collider: Collider;\r\n\r\n  /**\r\n   * Signed value (negative means overlap, positive no overlap)\r\n   */\r\n  separation: number;\r\n\r\n  /**\r\n   * Axis of separation from the collider's perspective\r\n   */\r\n  axis: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Local axis of separation from the collider's perspective\r\n   */\r\n  localAxis?: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Side of separation (reference) from the collider's perspective\r\n   */\r\n\r\n  side?: LineSegment = new LineSegment(vec(0, 0), vec(0, 0));\r\n\r\n  /**\r\n   * Local side of separation (reference) from the collider's perspective\r\n   */\r\n  localSide?: LineSegment = new LineSegment(vec(0, 0), vec(0, 0));\r\n\r\n  /**\r\n   * Index of the separation side (reference) from the collider's perspective\r\n   */\r\n  sideId?: number;\r\n\r\n  /**\r\n   * Point on collider B (incident point)\r\n   */\r\n  point: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Local point on collider B (incident point)\r\n   */\r\n  localPoint?: Vector = vec(0, 0);\r\n}\r\n\r\nexport class SeparatingAxis {\r\n  static SeparationPool = new Pool(\r\n    () => new SeparationInfo(),\r\n    (i) => i, // no recycle\r\n    500\r\n  );\r\n  private static _ZERO = vec(0, 0);\r\n  private static _SCRATCH_POINT = vec(0, 0);\r\n  private static _SCRATCH_SUB_POINT = vec(0, 0);\r\n  private static _SCRATCH_NORMAL = vec(0, 0);\r\n  private static _SCRATCH_MATRIX = AffineMatrix.identity();\r\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\r\n    // if polyB has 0 scale we need to hop back to degenerate separation\r\n    if (polyB.transform.matrix.determinant() === 0) {\r\n      return SeparatingAxis.findPolygonPolygonSeparationDegenerate(polyA, polyB);\r\n    }\r\n\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n\r\n    let bestSeparation = -Number.MAX_VALUE;\r\n    let bestSideIndex: number = -1;\r\n    let localPoint: Vector;\r\n    // Work inside polyB reference frame\r\n    // inv polyB converts to local space from polyA world space\r\n    const toPolyBSpace = polyB.transform.inverse.multiply(polyA.transform.matrix, SeparatingAxis._SCRATCH_MATRIX);\r\n    const toPolyBSpaceRotation = toPolyBSpace.getRotation();\r\n\r\n    const normalsA = polyA.normals;\r\n    const pointsA = polyA.points;\r\n    const pointsB = polyB.points;\r\n    for (let pointsAIndex = 0; pointsAIndex < pointsA.length; pointsAIndex++) {\r\n      const normal = normalsA[pointsAIndex].rotate(toPolyBSpaceRotation, SeparatingAxis._ZERO, SeparatingAxis._SCRATCH_NORMAL);\r\n      const point = toPolyBSpace.multiply(pointsA[pointsAIndex], SeparatingAxis._SCRATCH_POINT);\r\n\r\n      // For every point in polyB\r\n      // We want to see how much overlap there is on the axis provided by the normal\r\n      // We want to find the minimum overlap among all points\r\n      let smallestPointDistance = Number.MAX_VALUE;\r\n      let smallestLocalPoint: Vector;\r\n      for (let pointsBIndex = 0; pointsBIndex < pointsB.length; pointsBIndex++) {\r\n        const distance = normal.dot(pointsB[pointsBIndex].sub(point, SeparatingAxis._SCRATCH_SUB_POINT));\r\n        if (distance < smallestPointDistance) {\r\n          smallestPointDistance = distance;\r\n          smallestLocalPoint = pointsB[pointsBIndex];\r\n        }\r\n      }\r\n\r\n      // We take the maximum overlap as the separation between the\r\n      // A negative separation means there were no gaps between the two shapes\r\n      if (smallestPointDistance > bestSeparation) {\r\n        bestSeparation = smallestPointDistance;\r\n        bestSideIndex = pointsAIndex;\r\n        localPoint = smallestLocalPoint;\r\n      }\r\n    }\r\n\r\n    // TODO can we avoid applying world space transforms?\r\n    const bestSide2 = (bestSideIndex + 1) % pointsA.length;\r\n    const separationInfo = SeparatingAxis.SeparationPool.get();\r\n    separationInfo.collider = polyA;\r\n    separationInfo.separation = bestSeparation;\r\n    if (bestSeparation > 0) {\r\n      // early out because if separation is > 0 then no local point\r\n      return separationInfo;\r\n    }\r\n    normalsA[bestSideIndex].clone(separationInfo.localAxis);\r\n    normalsA[bestSideIndex].rotate(polyA.transform.rotation, SeparatingAxis._ZERO, separationInfo.axis);\r\n    polyA.transform.matrix.multiply(pointsA[bestSideIndex], separationInfo.side.begin);\r\n    polyA.transform.matrix.multiply(pointsA[bestSide2], separationInfo.side.end);\r\n    polyB.transform.matrix.multiply(localPoint, separationInfo.point);\r\n    separationInfo.sideId = bestSideIndex;\r\n    localPoint.clone(separationInfo.localPoint);\r\n    pointsA[bestSideIndex].clone(separationInfo.localSide.begin);\r\n    pointsA[bestSide2].clone(separationInfo.localSide.end);\r\n    return separationInfo;\r\n  }\r\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\r\n    const axes = polygon.axes;\r\n    const pc = polygon.center;\r\n    // Special SAT with circles\r\n    const polyDir = pc.sub(circle.worldPos);\r\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\r\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\r\n\r\n    let minOverlap = Number.MAX_VALUE;\r\n    let minAxis = null;\r\n    let minIndex = -1;\r\n    for (let i = 0; i < axes.length; i++) {\r\n      const proj1 = polygon.project(axes[i]);\r\n      const proj2 = circle.project(axes[i]);\r\n      const overlap = proj1.getOverlap(proj2);\r\n      if (overlap <= 0) {\r\n        return null;\r\n      } else {\r\n        if (overlap < minOverlap) {\r\n          minOverlap = overlap;\r\n          minAxis = axes[i];\r\n          minIndex = i;\r\n        }\r\n      }\r\n    }\r\n    if (minIndex < 0) {\r\n      return null;\r\n    }\r\n    return minAxis.normalize().scale(minOverlap);\r\n  }\r\n\r\n  static findPolygonPolygonSeparationDegenerate(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\r\n    let bestSeparation = -Number.MAX_VALUE;\r\n    let bestSide: LineSegment | null = null;\r\n    let bestAxis: Vector | null = null;\r\n    let bestSideIndex: number = -1;\r\n    let bestOtherPoint: Vector | null = null;\r\n    const sides = polyA.getSides();\r\n    const localSides = polyA.getLocalSides();\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const side = sides[i];\r\n      const axis = side.normal();\r\n      const vertB = polyB.getFurthestPoint(axis.negate());\r\n      // Separation on side i's axis\r\n      // We are looking for the largest separation between poly A's sides\r\n      const vertSeparation = side.distanceToPoint(vertB, true);\r\n      if (vertSeparation > bestSeparation) {\r\n        bestSeparation = vertSeparation;\r\n        bestSide = side;\r\n        bestAxis = axis;\r\n        bestSideIndex = i;\r\n        bestOtherPoint = vertB;\r\n      }\r\n    }\r\n\r\n    return {\r\n      collider: polyA,\r\n      separation: bestAxis ? bestSeparation : 99,\r\n      axis: bestAxis as Vector,\r\n      side: bestSide,\r\n      localSide: localSides[bestSideIndex],\r\n      sideId: bestSideIndex,\r\n      point: bestOtherPoint as Vector,\r\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\r\n    };\r\n  }\r\n}\r\n\r\nSeparatingAxis.SeparationPool.disableWarnings = true;\r\n","import { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { TransformComponent } from '../../EntityComponentSystem';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nconst ScratchZero = Vector.Zero; // TODO constant vector\r\nconst ScratchNormal = Vector.Zero; // TODO constant vector\r\nconst ScratchMatrix = AffineMatrix.identity();\r\n\r\nexport const CollisionJumpTable = {\r\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\r\n    const circleAPos = circleA.worldPos;\r\n    const circleBPos = circleB.worldPos;\r\n    const combinedRadius = circleA.radius + circleB.radius;\r\n    const distance = circleAPos.distance(circleBPos);\r\n\r\n    if (distance > combinedRadius) {\r\n      return [];\r\n    }\r\n\r\n    // negative means overlap\r\n    const separation = combinedRadius - distance;\r\n\r\n    // Normal points from A -> B\r\n    const normal = circleBPos.sub(circleAPos).normalize();\r\n    const tangent = normal.perpendicular();\r\n    const mvt = normal.scale(separation);\r\n\r\n    const point = circleA.getFurthestPoint(normal);\r\n    const local = circleA.getFurthestLocalPoint(normal);\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circleA,\r\n      separation,\r\n      axis: normal,\r\n      point: point\r\n    };\r\n\r\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\r\n  },\r\n\r\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\r\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\r\n    if (!minAxis) {\r\n      return [];\r\n    }\r\n\r\n    // make sure that the minAxis is pointing away from circle\r\n    const sameDir = minAxis.dot(polygon.center.sub(circle.center));\r\n    minAxis = sameDir < 0 ? minAxis.negate() : minAxis;\r\n\r\n    const point = circle.getFurthestPoint(minAxis);\r\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const local = xf.applyInverse(point);\r\n    const normal = minAxis.normalize();\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: -minAxis.magnitude,\r\n      axis: normal,\r\n      point: point,\r\n      localPoint: local,\r\n      side: polygon.findSide(normal.negate()),\r\n      localSide: polygon.findLocalSide(normal.negate())\r\n    };\r\n\r\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\r\n  },\r\n\r\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\r\n    // TODO not sure this actually abides by local/world collisions\r\n    // Are edge.begin and edge.end local space or world space? I think they should be local\r\n\r\n    // center of the circle in world pos\r\n    const cc = circle.center;\r\n    // vector in the direction of the edge\r\n    const edgeWorld = edge.asLine();\r\n    const e = edgeWorld.end.sub(edgeWorld.begin);\r\n\r\n    // amount of overlap with the circle's center along the edge direction\r\n    const u = e.dot(edgeWorld.end.sub(cc));\r\n    const v = e.dot(cc.sub(edgeWorld.begin));\r\n    const side = edge.asLine();\r\n    const localSide = edge.asLocalLine();\r\n\r\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\r\n    if (v <= 0) {\r\n      const da = edgeWorld.begin.sub(cc);\r\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\r\n      // save some sqrts\r\n      if (dda > circle.radius * circle.radius) {\r\n        return []; // no collision\r\n      }\r\n\r\n      const normal = da.normalize();\r\n      const separation = circle.radius - Math.sqrt(dda);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.begin,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\r\n      ];\r\n    }\r\n\r\n    // Potential region B collision (circle is on the right side of the edge, after the end)\r\n    if (u <= 0) {\r\n      const db = edgeWorld.end.sub(cc);\r\n      const ddb = db.dot(db);\r\n      if (ddb > circle.radius * circle.radius) {\r\n        return [];\r\n      }\r\n\r\n      const normal = db.normalize();\r\n      const separation = circle.radius - Math.sqrt(ddb);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.end,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\r\n      ];\r\n    }\r\n\r\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\r\n    const den = e.dot(e);\r\n    const pointOnEdge = edgeWorld.begin\r\n      .scale(u)\r\n      .add(edgeWorld.end.scale(v))\r\n      .scale(1 / den);\r\n    const d = cc.sub(pointOnEdge);\r\n\r\n    const dd = d.dot(d);\r\n    if (dd > circle.radius * circle.radius) {\r\n      return []; // no collision\r\n    }\r\n\r\n    let normal = e.perpendicular();\r\n    // flip correct direction\r\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\r\n      normal.x = -normal.x;\r\n      normal.y = -normal.y;\r\n    }\r\n\r\n    normal = normal.normalize();\r\n    const separation = circle.radius - Math.sqrt(dd);\r\n\r\n    const mvt = normal.scale(separation);\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: separation,\r\n      axis: normal,\r\n      point: pointOnEdge,\r\n      side: side,\r\n      localSide: localSide\r\n    };\r\n\r\n    return [\r\n      new CollisionContact(\r\n        circle,\r\n        edge,\r\n        mvt,\r\n        normal.negate(),\r\n        normal.negate().perpendicular(),\r\n        [pointOnEdge],\r\n        [pointOnEdge.sub(edge.worldPos)],\r\n        info\r\n      )\r\n    ];\r\n  },\r\n\r\n  CollideEdgeEdge(): CollisionContact[] {\r\n    // Edge-edge collision doesn't make sense\r\n    return [];\r\n  },\r\n\r\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\r\n    const pc = polygon.center;\r\n    const ec = edge.center;\r\n    const dir = ec.sub(pc).normalize();\r\n\r\n    // build a temporary polygon from the edge to use SAT\r\n    const linePoly = new PolygonCollider({\r\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\r\n      offset: edge.offset\r\n    });\r\n    linePoly.owner = edge.owner;\r\n    const tx = edge.owner?.get(TransformComponent);\r\n    if (tx) {\r\n      linePoly.update(edge.owner.get(TransformComponent).get());\r\n    }\r\n    // Gross hack but poly-poly works well\r\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\r\n    if (contact.length) {\r\n      // Fudge the contact back to edge\r\n      contact[0].colliderB = edge;\r\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\r\n    }\r\n    return contact;\r\n  },\r\n\r\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\r\n\r\n    // If there is no overlap from boxA's perspective we can end early\r\n    if (separationA.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\r\n    // If there is no overlap from boxB's perspective exit now\r\n    if (separationB.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    // Separations are both negative, we want to pick the least negative (minimal movement)\r\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\r\n\r\n    // The incident side is the most opposite from the axes of collision on the other collider\r\n    const other = separation.collider === polyA ? polyB : polyA;\r\n    const main = separation.collider === polyA ? polyA : polyB;\r\n\r\n    const toIncidentFrame = other.transform.inverse.multiply(main.transform.matrix, ScratchMatrix);\r\n    const toIncidentFrameRotation = toIncidentFrame.getRotation();\r\n    const referenceEdgeNormal = main.normals[separation.sideId].rotate(toIncidentFrameRotation, ScratchZero, ScratchNormal);\r\n    let minEdge = Number.MAX_VALUE;\r\n    let incidentEdgeIndex = 0;\r\n    for (let i = 0; i < other.normals.length; i++) {\r\n      const value = referenceEdgeNormal.dot(other.normals[i]);\r\n      if (value < minEdge) {\r\n        minEdge = value;\r\n        incidentEdgeIndex = i;\r\n      }\r\n    }\r\n\r\n    // FIXME temporary to prevent a crash, invalid separation\r\n    if (!separation.localSide || !separation.localAxis || !separation.axis) {\r\n      return [];\r\n    }\r\n\r\n    // Clip incident side by the perpendicular lines at each end of the reference side\r\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\r\n    const referenceSide = separation.localSide.transform(toIncidentFrame);\r\n    const referenceDirection = separation.localAxis.perpendicular().negate().rotate(toIncidentFrameRotation);\r\n\r\n    const incidentSide = new LineSegment(other.points[incidentEdgeIndex], other.points[(incidentEdgeIndex + 1) % other.points.length]);\r\n    const clipRight = incidentSide.clip(referenceDirection.negate(), -referenceDirection.dot(referenceSide.begin), false);\r\n    let clipLeft: LineSegment | null = null;\r\n    if (clipRight) {\r\n      clipLeft = clipRight.clip(referenceDirection, referenceDirection.dot(referenceSide.end), false);\r\n    }\r\n\r\n    if (clipLeft) {\r\n      const localPoints: Vector[] = [];\r\n      const points: Vector[] = [];\r\n      const clipPoints = clipLeft.getPoints();\r\n\r\n      for (let i = 0; i < clipPoints.length; i++) {\r\n        const p = clipPoints[i];\r\n        if (referenceSide.below(p)) {\r\n          localPoints.push(p);\r\n          points.push(other.transform.apply(p));\r\n        }\r\n      }\r\n      let normal = separation.axis;\r\n      let tangent = normal.perpendicular();\r\n      // Point Contact A -> B\r\n      if (polyB.center.sub(polyA.center).dot(normal) < 0) {\r\n        normal = normal.negate();\r\n        tangent = normal.perpendicular();\r\n      }\r\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\r\n    }\r\n    return [];\r\n  },\r\n\r\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\r\n    const shapeA = contact.colliderA;\r\n    const txA = contact.bodyA?.transform ?? new TransformComponent();\r\n    const shapeB = contact.colliderB;\r\n    const txB = contact.bodyB?.transform ?? new TransformComponent();\r\n\r\n    // both are circles\r\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\r\n      const combinedRadius = shapeA.radius + shapeB.radius;\r\n      const distance = txA.pos.distance(txB.pos);\r\n      const separation = combinedRadius - distance;\r\n      return -separation;\r\n    }\r\n\r\n    // both are polygons\r\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\r\n      if (contact.info.localSide) {\r\n        let side: LineSegment;\r\n        let worldPoint: Vector;\r\n        if (contact.info.collider === shapeA) {\r\n          side = new LineSegment(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\r\n          worldPoint = txB.apply(localPoint);\r\n        } else {\r\n          side = new LineSegment(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\r\n          worldPoint = txA.apply(localPoint);\r\n        }\r\n\r\n        return side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v circle\r\n    if (\r\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\r\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\r\n    ) {\r\n      const worldPoint = txA.apply(localPoint);\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v edge\r\n    if (\r\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\r\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\r\n    ) {\r\n      let worldPoint: Vector;\r\n      if (contact.info.collider === shapeA) {\r\n        worldPoint = txB.apply(localPoint);\r\n      } else {\r\n        worldPoint = txA.apply(localPoint);\r\n      }\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // circle v edge\r\n    if (\r\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\r\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\r\n    ) {\r\n      // Local point is always on the edge which is always shapeB\r\n      const worldPoint = txB.apply(localPoint);\r\n\r\n      let circlePoint: Vector;\r\n      if (shapeA instanceof CircleCollider) {\r\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\r\n      }\r\n\r\n      const dist = worldPoint.distance(circlePoint);\r\n\r\n      if (contact.info.side) {\r\n        return dist > 0 ? -dist : 0;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { BodyComponent } from '../Index';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\n\r\nexport interface EdgeColliderOptions {\r\n  /**\r\n   * The beginning of the edge defined in local coordinates to the collider\r\n   */\r\n  begin: Vector;\r\n  /**\r\n   * The ending of the edge defined in local coordinates to the collider\r\n   */\r\n  end: Vector;\r\n  /**\r\n   * Optionally specify an offset\r\n   */\r\n  offset?: Vector;\r\n}\r\n\r\n/**\r\n * Edge is a single line collider to create collisions with a single line.\r\n */\r\nexport class EdgeCollider extends Collider {\r\n  offset: Vector;\r\n  begin: Vector;\r\n  end: Vector;\r\n\r\n  private _transform: Transform;\r\n  private _globalMatrix: AffineMatrix = AffineMatrix.identity();\r\n\r\n  constructor(options: EdgeColliderOptions) {\r\n    super();\r\n    this.begin = options.begin || Vector.Zero;\r\n    this.end = options.end || Vector.Zero;\r\n    this.offset = options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this Edge, not associated with any collider\r\n   */\r\n  public clone(): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: this.begin.clone(),\r\n      end: this.end.clone()\r\n    });\r\n  }\r\n\r\n  public get worldPos(): Vector {\r\n    const tx = this._transform;\r\n    return tx?.globalPos.add(this.offset) ?? this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collision area in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const pos = begin.average(end);\r\n    return pos;\r\n  }\r\n\r\n  private _getTransformedBegin(): Vector {\r\n    return this._globalMatrix.multiply(this.begin);\r\n  }\r\n\r\n  private _getTransformedEnd(): Vector {\r\n    return this._globalMatrix.multiply(this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns the slope of the line in the form of a vector\r\n   */\r\n  public getSlope(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collision area\r\n   */\r\n  public contains(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): RayCastHit | null {\r\n    const numerator = this._getTransformedBegin().sub(ray.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\r\n      return null;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = ray.dir.cross(this.getSlope());\r\n    if (divisor === 0) {\r\n      return null;\r\n    }\r\n\r\n    const t = numerator.cross(this.getSlope()) / divisor;\r\n\r\n    if (t >= 0 && t <= max) {\r\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return {\r\n          distance: t,\r\n          normal: this.asLine().normal(),\r\n          collider: this,\r\n          body: this.owner?.get(BodyComponent),\r\n          point: ray.getPoint(t)\r\n        } satisfies RayCastHit;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the closes line between this and another collider, from this -> collider\r\n   * @param shape\r\n   */\r\n  public getClosestLineBetween(shape: Collider): LineSegment {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(shape: Collider): CollisionContact[] {\r\n    if (shape instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideEdgeEdge();\r\n    } else {\r\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    if (direction.dot(transformedBegin) > 0) {\r\n      return transformedBegin;\r\n    } else {\r\n      return transformedEnd;\r\n    }\r\n  }\r\n\r\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\r\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\r\n    // this causes problems for the collision system so we give them some padding\r\n    return new BoundingBox(\r\n      Math.min(begin.x, end.x) - padding,\r\n      Math.min(begin.y, end.y) - padding,\r\n      Math.max(begin.x, end.x) + padding,\r\n      Math.max(begin.y, end.y) + padding\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in world space\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in local space\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return this._boundsFromBeginEnd(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns this edge represented as a line in world coordinates\r\n   */\r\n  public asLine(): LineSegment {\r\n    return new LineSegment(this._getTransformedBegin(), this._getTransformedEnd());\r\n  }\r\n\r\n  /**\r\n   * Return this edge as a line in local line coordinates (relative to the position)\r\n   */\r\n  public asLocalLine(): LineSegment {\r\n    return new LineSegment(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the edge\r\n   */\r\n  public get axes(): Vector[] {\r\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\r\n    const edgeNormal = e.normal();\r\n\r\n    const axes = [];\r\n    axes.push(edgeNormal);\r\n    axes.push(edgeNormal.negate());\r\n    axes.push(edgeNormal.normal());\r\n    axes.push(edgeNormal.normal().negate());\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an edge\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    const length = this.end.sub(this.begin).distance() / 2;\r\n    return mass * length * length;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    const globalMat = transform.matrix ?? this._globalMatrix;\r\n    globalMat.clone(this._globalMatrix);\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n  }\r\n\r\n  /**\r\n   * Project the edge along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n\r\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      scalars.push(points[i].dot(axis));\r\n    }\r\n\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ex.drawLine(begin, end, color, 2);\r\n    ex.drawCircle(begin, 2, color);\r\n    ex.drawCircle(end, 2, color);\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext, LineGraphicsOptions, PointGraphicsOptions } from './Context/ExcaliburGraphicsContext';\r\nimport { Color } from '../Color';\r\nimport { Ray } from '../Math/ray';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\n\r\nexport class Debug {\r\n  static _drawCalls: ((ctx: ExcaliburGraphicsContext) => void)[] = [];\r\n  static _ctx: ExcaliburGraphicsContext;\r\n  static z: number = Infinity;\r\n  static registerGraphicsContext(ctx: ExcaliburGraphicsContext) {\r\n    Debug._ctx = ctx;\r\n  }\r\n  static draw(debugDrawCall: (ctx: ExcaliburGraphicsContext) => void) {\r\n    this._drawCalls.push(debugDrawCall);\r\n  }\r\n\r\n  static drawPoint(point: Vector, options?: PointGraphicsOptions) {\r\n    Debug.draw((ctx) => {\r\n      ctx.debug.drawPoint(point, options);\r\n    });\r\n  }\r\n\r\n  static drawLine(start: Vector, end: Vector, options?: LineGraphicsOptions) {\r\n    Debug.draw((ctx) => {\r\n      ctx.debug.drawLine(start, end, options);\r\n    });\r\n  }\r\n\r\n  static drawLines(points: Vector[], options?: LineGraphicsOptions) {\r\n    if (points.length > 1) {\r\n      Debug.draw((ctx) => {\r\n        for (let i = 0; i < points.length - 1; i++) {\r\n          ctx.debug.drawLine(points[i], points[i + 1], options);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  static drawText(text: string, pos: Vector) {\r\n    Debug.draw((ctx) => {\r\n      ctx.debug.drawText(text, pos);\r\n    });\r\n  }\r\n\r\n  static drawPolygon(points: Vector[], options?: { color?: Color }) {\r\n    if (points.length > 1) {\r\n      Debug.draw((ctx) => {\r\n        const firstPoint = points[0];\r\n        const polygon = [...points, firstPoint];\r\n        for (let i = 0; i < polygon.length - 1; i++) {\r\n          ctx.debug.drawLine(polygon[i], polygon[i + 1], options);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  static drawCircle(\r\n    center: Vector,\r\n    radius: number,\r\n    options?: {\r\n      color?: Color;\r\n      strokeColor?: Color;\r\n      width?: number;\r\n    }\r\n  ) {\r\n    const { color, strokeColor, width } = {\r\n      color: Color.Black,\r\n      strokeColor: undefined,\r\n      width: undefined,\r\n      ...options\r\n    };\r\n    Debug.draw((ctx) => {\r\n      ctx.drawCircle(center, radius, color, strokeColor, width);\r\n    });\r\n  }\r\n\r\n  static drawBounds(boundingBox: BoundingBox, options?: { color?: Color }): void {\r\n    Debug.draw((ctx) => {\r\n      ctx.debug.drawRect(boundingBox.left, boundingBox.top, boundingBox.width, boundingBox.height, options);\r\n    });\r\n  }\r\n\r\n  static drawRay(ray: Ray, options?: { distance?: number; color?: Color }) {\r\n    const { distance, color } = {\r\n      color: Color.Blue,\r\n      distance: 10,\r\n      ...options\r\n    };\r\n    Debug.draw((ctx) => {\r\n      const start = ray.pos;\r\n      const end = ray.pos.add(ray.dir.scale(distance));\r\n\r\n      ctx.debug.drawLine(start, end, { color });\r\n    });\r\n  }\r\n\r\n  static flush(ctx: ExcaliburGraphicsContext) {\r\n    ctx.save();\r\n    ctx.z = Debug.z;\r\n    for (const drawCall of Debug._drawCalls) {\r\n      drawCall(ctx);\r\n    }\r\n    ctx.restore();\r\n    Debug.clear();\r\n  }\r\n\r\n  static clear() {\r\n    Debug._drawCalls.length = 0;\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Collider } from './Collider';\r\nimport { BodyComponent, Debug, ExcaliburGraphicsContext, Logger, sign } from '../..';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Shape } from './Shape';\r\nimport { Transform } from '../../Math/transform';\r\nimport { RayCastHit } from '../Detection/RayCastHit';\r\n\r\nexport interface PolygonColliderOptions {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   * **Must be at least 3 points**\r\n   */\r\n  points: Vector[];\r\n\r\n  /**\r\n   * Suppresses convexity warning\r\n   */\r\n  suppressConvexWarning?: boolean;\r\n}\r\n\r\n/**\r\n * Polygon collider for detecting collisions\r\n */\r\nexport class PolygonCollider extends Collider {\r\n  private _logger = Logger.getInstance();\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  public offset: Vector;\r\n\r\n  public flagDirty() {\r\n    this._localBoundsDirty = true;\r\n    this._localSidesDirty = true;\r\n    this._transformedPointsDirty = true;\r\n    this._sidesDirty = true;\r\n  }\r\n\r\n  private _points: Vector[];\r\n  private _normals: Vector[];\r\n\r\n  public get normals(): readonly Vector[] {\r\n    return this._normals;\r\n  }\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   * Excalibur stores these in counter-clockwise order\r\n   */\r\n  public set points(points: Vector[]) {\r\n    if (points.length < 3) {\r\n      throw new Error('PolygonCollider cannot be created with less that 3 points');\r\n    }\r\n    this._points = points;\r\n    this._checkAndUpdateWinding(this._points);\r\n    this._calculateNormals();\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _calculateNormals() {\r\n    const normals: Vector[] = [];\r\n    for (let i = 0; i < this._points.length; i++) {\r\n      normals.push(this._points[(i + 1) % this._points.length].sub(this._points[i]).normal());\r\n    }\r\n    this._normals = normals;\r\n  }\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   * Excalibur stores these in counter-clockwise order\r\n   */\r\n  public get points(): Vector[] {\r\n    return this._points;\r\n  }\r\n\r\n  private _transform: Transform = new Transform();\r\n  public get transform() {\r\n    return this._transform;\r\n  }\r\n\r\n  private _transformedPoints: Vector[] = [];\r\n  private _sides: LineSegment[] = [];\r\n  private _localSides: LineSegment[] = [];\r\n\r\n  constructor(options: PolygonColliderOptions) {\r\n    super();\r\n    this.offset = options.offset ?? Vector.Zero;\r\n    this._transform.pos.x += this.offset.x;\r\n    this._transform.pos.y += this.offset.y;\r\n    this.points = options.points;\r\n\r\n    if (!this.isConvex()) {\r\n      if (!options.suppressConvexWarning) {\r\n        this._logger.warn(\r\n          'Excalibur only supports convex polygon colliders and will not behave properly.' +\r\n            'Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles'\r\n        );\r\n      }\r\n    }\r\n\r\n    // calculate initial transformation\r\n    this._calculateTransformation();\r\n  }\r\n\r\n  private _checkAndUpdateWinding(points: Vector[]) {\r\n    const counterClockwise = this._isCounterClockwiseWinding(points);\r\n    if (!counterClockwise) {\r\n      points.reverse();\r\n    }\r\n  }\r\n  public _isCounterClockwiseWinding(points: Vector[]): boolean {\r\n    // https://stackoverflow.com/a/1165943\r\n    let sum = 0;\r\n    for (let i = 0; i < points.length; i++) {\r\n      sum += (points[(i + 1) % points.length].x - points[i].x) * (points[(i + 1) % points.length].y + points[i].y);\r\n    }\r\n    return sum < 0;\r\n  }\r\n\r\n  /**\r\n   * Returns if the polygon collider is convex, Excalibur does not handle non-convex collision shapes.\r\n   * Call {@apilink Polygon.triangulate} to generate a {@apilink CompositeCollider} from this non-convex shape\r\n   */\r\n  public isConvex(): boolean {\r\n    // From SO: https://stackoverflow.com/a/45372025\r\n    if (this.points.length < 3) {\r\n      return false;\r\n    }\r\n    let oldPoint = this.points[this.points.length - 2];\r\n    let newPoint = this.points[this.points.length - 1];\r\n    let direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\r\n    let oldDirection = 0;\r\n    let orientation = 0;\r\n    let angleSum = 0;\r\n    for (const [i, point] of this.points.entries()) {\r\n      oldPoint = newPoint;\r\n      oldDirection = direction;\r\n      newPoint = point;\r\n      direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\r\n      if (oldPoint.equals(newPoint)) {\r\n        return false; // repeat point\r\n      }\r\n      let angle = direction - oldDirection;\r\n      if (angle <= -Math.PI) {\r\n        angle += Math.PI * 2;\r\n      } else if (angle > Math.PI) {\r\n        angle -= Math.PI * 2;\r\n      }\r\n      if (i === 0) {\r\n        if (angle === 0.0) {\r\n          return false;\r\n        }\r\n        orientation = angle > 0 ? 1 : -1;\r\n      } else {\r\n        if (orientation * angle <= 0) {\r\n          return false;\r\n        }\r\n      }\r\n      angleSum += angle;\r\n    }\r\n    return Math.abs(Math.round(angleSum / (Math.PI * 2))) === 1;\r\n  }\r\n\r\n  /**\r\n   * Tessellates the polygon into a triangle fan as a {@apilink CompositeCollider} of triangle polygons\r\n   */\r\n  public tessellate(): CompositeCollider {\r\n    const polygons: Vector[][] = [];\r\n    for (let i = 1; i < this.points.length - 2; i++) {\r\n      polygons.push([this.points[0], this.points[i + 1], this.points[i + 2]]);\r\n    }\r\n    polygons.push([this.points[0], this.points[1], this.points[2]]);\r\n\r\n    return new CompositeCollider(polygons.map((points) => Shape.Polygon(points)));\r\n  }\r\n\r\n  /**\r\n   * Triangulate the polygon collider using the \"Ear Clipping\" algorithm.\r\n   * Returns a new {@apilink CompositeCollider} made up of smaller triangles.\r\n   */\r\n  public triangulate(): CompositeCollider {\r\n    // https://www.youtube.com/watch?v=hTJFcHutls8\r\n    if (this.points.length < 3) {\r\n      throw Error('Invalid polygon');\r\n    }\r\n\r\n    const triangles: [Vector, Vector, Vector][] = [];\r\n    // algorithm likes clockwise\r\n    const vertices = [...this.points].reverse();\r\n    let vertexCount = vertices.length;\r\n\r\n    /**\r\n     * Returns the previous index based on the current vertex\r\n     */\r\n    function getPrevIndex(index: number) {\r\n      return index === 0 ? vertexCount - 1 : index - 1;\r\n    }\r\n\r\n    /**\r\n     * Retrieves the next index based on the current vertex\r\n     */\r\n    function getNextIndex(index: number) {\r\n      return index === vertexCount - 1 ? 0 : index + 1;\r\n    }\r\n\r\n    /**\r\n     * Whether or not the angle at this vertex index is convex\r\n     */\r\n    function isConvex(index: number) {\r\n      const prev = getPrevIndex(index);\r\n      const next = getNextIndex(index);\r\n\r\n      const va = vertices[prev];\r\n      const vb = vertices[index];\r\n      const vc = vertices[next];\r\n\r\n      // Check convexity\r\n      const leftArm = va.sub(vb);\r\n      const rightArm = vc.sub(vb);\r\n      // Positive cross product is convex\r\n      if (leftArm.cross(rightArm) < 0) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    const convexVertices = vertices.map((_, i) => isConvex(i));\r\n\r\n    /**\r\n     * Quick test for point in triangle\r\n     */\r\n    function isPointInTriangle(point: Vector, a: Vector, b: Vector, c: Vector) {\r\n      const ab = b.sub(a);\r\n      const bc = c.sub(b);\r\n      const ca = a.sub(c);\r\n\r\n      const ap = point.sub(a);\r\n      const bp = point.sub(b);\r\n      const cp = point.sub(c);\r\n\r\n      const cross1 = ab.cross(ap);\r\n      const cross2 = bc.cross(bp);\r\n      const cross3 = ca.cross(cp);\r\n\r\n      if (cross1 > 0 || cross2 > 0 || cross3 > 0) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Calculate the area of the triangle\r\n     */\r\n    // function triangleArea(a: Vector, b: Vector, c: Vector) {\r\n    //   return Math.abs(a.x * (b.y - c.y) + b.x * (c.y - a.y) + c.x * (a.y - c.y))/2;\r\n    // }\r\n\r\n    /**\r\n     * Find the next suitable ear tip\r\n     */\r\n    function findEarTip() {\r\n      for (let i = 0; i < vertexCount; i++) {\r\n        if (convexVertices[i]) {\r\n          const prev = getPrevIndex(i);\r\n          const next = getNextIndex(i);\r\n\r\n          const va = vertices[prev];\r\n          const vb = vertices[i];\r\n          const vc = vertices[next];\r\n\r\n          let isEar = true;\r\n          // Check that if any vertices are in the triangle a, b, c\r\n          for (let j = 0; j < vertexCount; j++) {\r\n            // We can skip these verts because they are the triangle we are testing\r\n            if (j === i || j === prev || j === next) {\r\n              continue;\r\n            }\r\n            const point = vertices[j];\r\n            if (isPointInTriangle(point, va, vb, vc)) {\r\n              isEar = false;\r\n              break;\r\n            }\r\n          }\r\n\r\n          // Add ear to polygon list and remove from list\r\n          if (isEar) {\r\n            return i;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Fall back to any convex vertex\r\n      for (let i = 0; i < vertexCount; i++) {\r\n        if (convexVertices[i]) {\r\n          return i;\r\n        }\r\n      }\r\n\r\n      // bail and return the first one?\r\n      return 0;\r\n    }\r\n\r\n    /**\r\n     * Cut the ear and produce a triangle, update internal state\r\n     */\r\n    function cutEarTip(index: number) {\r\n      const prev = getPrevIndex(index);\r\n      const next = getNextIndex(index);\r\n\r\n      const va = vertices[prev];\r\n      const vb = vertices[index];\r\n      const vc = vertices[next];\r\n\r\n      // Clockwise winding\r\n      // if (triangleArea(va, vb, vc) > 0) {\r\n      triangles.push([va, vb, vc]);\r\n      // }\r\n      vertices.splice(index, 1);\r\n      convexVertices.splice(index, 1);\r\n      vertexCount--;\r\n    }\r\n\r\n    // Loop over all the vertices finding ears\r\n    while (vertexCount > 3) {\r\n      const earIndex = findEarTip();\r\n      cutEarTip(earIndex);\r\n\r\n      // reclassify vertices\r\n      for (let i = 0; i < vertexCount; i++) {\r\n        convexVertices[i] = isConvex(i);\r\n      }\r\n    }\r\n\r\n    // Last triangle after the loop\r\n    triangles.push([vertices[0], vertices[1], vertices[2]]);\r\n\r\n    // FIXME: there is a colinear triangle that sneaks in here sometimes\r\n    return new CompositeCollider(triangles.map((points) => Shape.Polygon(points, Vector.Zero, true)));\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this ConvexPolygon, not associated with any collider\r\n   */\r\n  public clone(): PolygonCollider {\r\n    return new PolygonCollider({\r\n      offset: this.offset.clone(),\r\n      points: this.points.map((p) => p.clone())\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\r\n   */\r\n  public get worldPos(): Vector {\r\n    return this._transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.bounds.center;\r\n  }\r\n\r\n  private _transformedPointsDirty = true;\r\n  /**\r\n   * Calculates the underlying transformation from the body relative space to world space\r\n   */\r\n  private _calculateTransformation() {\r\n    const points = this.points;\r\n    const len = points.length;\r\n    this._transformedPoints.length = 0; // clear out old transform\r\n    for (let i = 0; i < len; i++) {\r\n      this._transformedPoints[i] = this._transform.apply(points[i].clone());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\r\n   */\r\n  public getTransformedPoints(): Vector[] {\r\n    if (this._transformedPointsDirty) {\r\n      this._calculateTransformation();\r\n      this._transformedPointsDirty = false;\r\n    }\r\n    return this._transformedPoints;\r\n  }\r\n\r\n  private _sidesDirty = true;\r\n  /**\r\n   * Gets the sides of the polygon in world space\r\n   */\r\n  public getSides(): LineSegment[] {\r\n    if (this._sidesDirty) {\r\n      const lines = [];\r\n      const points = this.getTransformedPoints();\r\n      const len = points.length;\r\n      for (let i = 0; i < len; i++) {\r\n        // This winding is important\r\n        lines.push(new LineSegment(points[i], points[(i + 1) % len]));\r\n      }\r\n      this._sides = lines;\r\n      this._sidesDirty = false;\r\n    }\r\n    return this._sides;\r\n  }\r\n\r\n  private _localSidesDirty = true;\r\n  /**\r\n   * Returns the local coordinate space sides\r\n   */\r\n  public getLocalSides(): LineSegment[] {\r\n    if (this._localSidesDirty) {\r\n      const lines = [];\r\n      const points = this.points;\r\n      const len = points.length;\r\n      for (let i = 0; i < len; i++) {\r\n        // This winding is important\r\n        lines.push(new LineSegment(points[i], points[(i + 1) % len]));\r\n      }\r\n      this._localSides = lines;\r\n      this._localSidesDirty = false;\r\n    }\r\n\r\n    return this._localSides;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the world space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findSide(direction: Vector): LineSegment {\r\n    const sides = this.getSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the local space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findLocalSide(direction: Vector): LineSegment {\r\n    const sides = this.getLocalSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the convex polygon\r\n   */\r\n  public get axes(): Vector[] {\r\n    const axes: Vector[] = [];\r\n    const sides = this.getSides();\r\n    for (let i = 0; i < sides.length; i++) {\r\n      axes.push(sides[i].normal());\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Updates the transform for the collision geometry\r\n   *\r\n   * Collision geometry (points/bounds) will not change until this is called.\r\n   * @param transform\r\n   */\r\n  public update(transform: Transform): void {\r\n    if (transform) {\r\n      // This change means an update must be performed in order for geometry to update\r\n      transform.cloneWithParent(this._transform);\r\n      this._transformedPointsDirty = true;\r\n      this._sidesDirty = true;\r\n      if (this.offset.x !== 0 || this.offset.y !== 0) {\r\n        this._transform.pos.x += this.offset.x;\r\n        this._transform.pos.y += this.offset.y;\r\n      }\r\n\r\n      if (this._transform.isMirrored()) {\r\n        // negative transforms really mess with things in collision local space\r\n        // flatten out the negatives by applying to geometry\r\n        this.points = this.points.map((p) => vec(p.x * sign(this._transform.scale.x), p.y * sign(this._transform.scale.y)));\r\n        this._transform.scale.x = Math.abs(this._transform.scale.x);\r\n        this._transform.scale.y = Math.abs(this._transform.scale.y);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider in world space\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\r\n    // will be fine\r\n    const localPoint = this._transform.applyInverse(point);\r\n    const testRay = new Ray(localPoint, new Vector(1, 0));\r\n\r\n    let intersectCount = 0;\r\n    const sides = this.getLocalSides();\r\n    for (let sideIndex = 0; sideIndex < sides.length; sideIndex++) {\r\n      const side = sides[sideIndex];\r\n      if (testRay.intersect(side) >= 0) {\r\n        intersectCount++;\r\n      }\r\n    }\r\n\r\n    if (intersectCount % 2 === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getClosestLineBetween(collider: Collider): LineSegment {\r\n    if (collider instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\r\n   * return null.\r\n   * @param collider\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const pts = this.getTransformedPoints();\r\n    let furthestPoint = null;\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the collider furthest in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const pts = this.points;\r\n    let furthestPoint = pts[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Finds the closes face to the point using perpendicular distance\r\n   * @param point point to test against polygon\r\n   */\r\n  public getClosestFace(point: Vector): { distance: Vector; face: LineSegment } {\r\n    const sides = this.getSides();\r\n    let min = Number.POSITIVE_INFINITY;\r\n    let faceIndex = -1;\r\n    let distance = -1;\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const dist = sides[i].distanceToPoint(point);\r\n      if (dist < min) {\r\n        min = dist;\r\n        faceIndex = i;\r\n        distance = dist;\r\n      }\r\n    }\r\n\r\n    if (faceIndex !== -1) {\r\n      return {\r\n        distance: sides[faceIndex].normal().scale(distance),\r\n        face: sides[faceIndex]\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    return this.localBounds.transform(this._transform.matrix);\r\n  }\r\n\r\n  private _localBoundsDirty = true;\r\n  private _localBounds: BoundingBox;\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    if (this._localBoundsDirty) {\r\n      this._localBounds = BoundingBox.fromPoints(this.points);\r\n      this._localBoundsDirty = false;\r\n    }\r\n\r\n    return this._localBounds;\r\n  }\r\n\r\n  private _cachedMass: number;\r\n  private _cachedInertia: number;\r\n  /**\r\n   * Get the moment of inertia for an arbitrary polygon\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    if (this._cachedMass === mass && this._cachedInertia) {\r\n      return this._cachedInertia;\r\n    }\r\n    let numerator = 0;\r\n    let denominator = 0;\r\n    const points = this.points;\r\n    for (let i = 0; i < points.length; i++) {\r\n      const iplusone = (i + 1) % points.length;\r\n      const crossTerm = points[iplusone].cross(points[i]);\r\n      numerator += crossTerm * (points[i].dot(points[i]) + points[i].dot(points[iplusone]) + points[iplusone].dot(points[iplusone]));\r\n      denominator += crossTerm;\r\n    }\r\n    this._cachedMass = mass;\r\n    return (this._cachedInertia = (mass / 6) * (numerator / denominator));\r\n  }\r\n\r\n  /**\r\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): RayCastHit | null {\r\n    // find the minimum contact time greater than 0\r\n    // contact times less than 0 are behind the ray and we don't want those\r\n    const sides = this.getSides();\r\n    const len = sides.length;\r\n    let minContactTime = Number.MAX_VALUE;\r\n    let contactSide: LineSegment;\r\n    let contactIndex = -1;\r\n    for (let i = 0; i < len; i++) {\r\n      const contactTime = ray.intersect(sides[i]);\r\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\r\n        minContactTime = contactTime;\r\n        contactSide = sides[i];\r\n        contactIndex = i;\r\n      }\r\n    }\r\n\r\n    // contact was found\r\n    if (contactIndex >= 0) {\r\n      return {\r\n        collider: this,\r\n        distance: minContactTime,\r\n        body: this.owner?.get(BodyComponent),\r\n        point: ray.getPoint(minContactTime),\r\n        normal: contactSide.normal()\r\n      } satisfies RayCastHit;\r\n    }\r\n\r\n    // no contact found\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Project the edges of the polygon along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    let min = Number.MAX_VALUE;\r\n    let max = -Number.MAX_VALUE;\r\n    for (let i = 0; i < len; i++) {\r\n      const scalar = points[i].dot(axis);\r\n      min = Math.min(min, scalar);\r\n      max = Math.max(max, scalar);\r\n    }\r\n\r\n    return new Projection(min, max);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color, options?: { lineWidth: number; pointSize: number }) {\r\n    const points = this.getTransformedPoints();\r\n    Debug.drawPolygon(points, { color });\r\n  }\r\n}\r\n","import { PolygonCollider } from './PolygonCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Logger } from '../..';\r\n\r\n/**\r\n * Excalibur helper for defining colliders quickly\r\n */\r\nexport class Shape {\r\n  /**\r\n   * Creates a box collider, under the hood defines a {@apilink PolygonCollider} collider\r\n   * @param width Width of the box\r\n   * @param height Height of the box\r\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new {@apilink PolygonCollider | `arbitrary polygon`} collider\r\n   *\r\n   * PolygonColliders are useful for creating convex polygon shapes\r\n   * @param points Points specified in counter clockwise\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Polygon(points: Vector[], offset: Vector = Vector.Zero, suppressConvexWarning = false): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: points,\r\n      offset: offset,\r\n      suppressConvexWarning\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new {@apilink CircleCollider | `circle`} collider\r\n   *\r\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\r\n   * @param radius Radius of the circle collider\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\r\n    return new CircleCollider({\r\n      radius: radius,\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new {@apilink EdgeCollider | `edge`} collider\r\n   *\r\n   * Edge colliders are useful for  floors, walls, and other barriers\r\n   * @param begin Beginning of the edge in local coordinates to the collider\r\n   * @param end Ending of the edge in local coordinates to the collider\r\n   */\r\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: begin,\r\n      end: end\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new capsule shaped {@apilink CompositeCollider} using 2 circles and a box\r\n   *\r\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\r\n   * player experience.\r\n   * @param width\r\n   * @param height\r\n   * @param offset Optional offset\r\n   */\r\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\r\n    const logger = Logger.getInstance();\r\n    if (width === height) {\r\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\r\n    }\r\n\r\n    const vertical = height >= width;\r\n\r\n    if (vertical) {\r\n      // height > width, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\r\n        Shape.Box(width, height - width, Vector.Half, offset),\r\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\r\n      ]);\r\n      return capsule;\r\n    } else {\r\n      // width > height, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\r\n        Shape.Box(width - height, height, Vector.Half, offset),\r\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\r\n      ]);\r\n      return capsule;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\r\nimport { Observable } from '../Util/Observable';\r\nimport { BoundingBox } from './BoundingBox';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { CircleCollider } from './Colliders/CircleCollider';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { PolygonCollider } from './Colliders/PolygonCollider';\r\nimport { EdgeCollider } from './Colliders/EdgeCollider';\r\nimport { Shape } from './Colliders/Shape';\r\nimport { EventEmitter } from '../EventEmitter';\r\nimport { Actor } from '../Actor';\r\n\r\nexport class ColliderComponent extends Component {\r\n  public events = new EventEmitter();\r\n  /**\r\n   * Observable that notifies when a collider is added to the body\r\n   */\r\n  public $colliderAdded = new Observable<Collider>();\r\n\r\n  /**\r\n   * Observable that notifies when a collider is removed from the body\r\n   */\r\n  public $colliderRemoved = new Observable<Collider>();\r\n\r\n  constructor(collider?: Collider) {\r\n    super();\r\n    this.set(collider);\r\n  }\r\n\r\n  private _collider: Collider;\r\n  /**\r\n   * Get the current collider geometry\r\n   */\r\n  public get(): Collider | undefined {\r\n    return this._collider;\r\n  }\r\n\r\n  /**\r\n   * Set the collider geometry\r\n   * @param collider\r\n   * @returns the collider you set\r\n   */\r\n  public set<T extends Collider>(collider: T): T {\r\n    this.clear();\r\n    if (collider) {\r\n      this._collider = collider;\r\n      this._collider.owner = this.owner;\r\n      collider.events.pipe(this.events);\r\n      this.$colliderAdded.notifyAll(collider);\r\n      this.update();\r\n    }\r\n    return collider;\r\n  }\r\n\r\n  private _collidersToRemove: Collider[] = [];\r\n  /**\r\n   * Remove collider geometry from collider component\r\n   */\r\n  public clear() {\r\n    if (this._collider) {\r\n      this._collidersToRemove.push(this._collider);\r\n      this._collider = null;\r\n    }\r\n  }\r\n\r\n  public processColliderRemoval() {\r\n    for (const collider of this._collidersToRemove) {\r\n      collider.events.unpipe(this.events);\r\n      this.$colliderRemoved.notifyAll(collider);\r\n      collider.owner = null;\r\n    }\r\n  }\r\n\r\n  public clone(): ColliderComponent {\r\n    const clone = new ColliderComponent(this._collider.clone());\r\n\r\n    return clone;\r\n  }\r\n\r\n  /**\r\n   * Return world space bounds\r\n   */\r\n  public get bounds() {\r\n    return this._collider?.bounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Return local space bounds\r\n   */\r\n  public get localBounds() {\r\n    return this._collider?.localBounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Update the collider's transformed geometry\r\n   */\r\n  public update() {\r\n    const tx = this.owner?.get(TransformComponent);\r\n    if (this._collider) {\r\n      this._collider.owner = this.owner;\r\n      if (tx) {\r\n        this._collider.update(tx.get());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collide component with another\r\n   * @param other\r\n   */\r\n  collide(other: ColliderComponent): CollisionContact[] {\r\n    let colliderA = this._collider;\r\n    let colliderB = other._collider;\r\n    if (!colliderA || !colliderB) {\r\n      return [];\r\n    }\r\n\r\n    // If we have a composite left hand side :(\r\n    // Might bite us, but to avoid updating all the handlers make composite always left side\r\n    let flipped = false;\r\n    if (colliderB instanceof CompositeCollider) {\r\n      colliderA = colliderB;\r\n      colliderB = this._collider;\r\n      flipped = true;\r\n    }\r\n\r\n    if (this._collider) {\r\n      const contacts = colliderA.collide(colliderB);\r\n      if (contacts) {\r\n        if (flipped) {\r\n          contacts.forEach((contact) => {\r\n            contact.mtv = contact.mtv.negate();\r\n            contact.normal = contact.normal.negate();\r\n            contact.tangent = contact.normal.perpendicular();\r\n            contact.colliderA = this._collider;\r\n            contact.colliderB = other._collider;\r\n          });\r\n        }\r\n        return contacts;\r\n      }\r\n      return [];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  onAdd(entity: Entity) {\r\n    if (this._collider) {\r\n      this.update();\r\n    }\r\n    // Wire up the collider events to the owning entity\r\n    this.events.on('precollision', (evt: any) => {\r\n      const precollision = evt as PreCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(precollision.self, precollision.other, precollision.side, precollision.intersection, precollision.contact)\r\n      );\r\n      if (entity instanceof Actor) {\r\n        entity.onPreCollisionResolve(precollision.self, precollision.other, precollision.side, precollision.contact);\r\n      }\r\n    });\r\n    this.events.on('postcollision', (evt: any) => {\r\n      const postcollision = evt as PostCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(\r\n          postcollision.self,\r\n          postcollision.other,\r\n          postcollision.side,\r\n          postcollision.intersection,\r\n          postcollision.contact\r\n        )\r\n      );\r\n      if (entity instanceof Actor) {\r\n        entity.onPostCollisionResolve(postcollision.self, postcollision.other, postcollision.side, postcollision.contact);\r\n      }\r\n    });\r\n    this.events.on('collisionstart', (evt: any) => {\r\n      const start = evt as CollisionStartEvent<Collider>;\r\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.self, start.other, start.side, start.contact));\r\n      if (entity instanceof Actor) {\r\n        entity.onCollisionStart(start.self, start.other, start.side, start.contact);\r\n      }\r\n    });\r\n    this.events.on('collisionend', (evt: any) => {\r\n      const end = evt as CollisionEndEvent<Collider>;\r\n      entity.events.emit('collisionend', new CollisionEndEvent(end.self, end.other, end.side, end.lastContact));\r\n      if (entity instanceof Actor) {\r\n        entity.onCollisionEnd(end.self, end.other, end.side, end.lastContact);\r\n      }\r\n    });\r\n  }\r\n\r\n  onRemove() {\r\n    this.events.clear();\r\n    this.$colliderRemoved.notifyAll(this._collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\r\n   *\r\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\r\n    const collider = Shape.Box(width, height, anchor, center);\r\n    return this.set(collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a {@apilink PolygonCollider | `polygon`} collision geometry based on a list of of points relative\r\n   *  to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\r\n    const poly = Shape.Polygon(points, center);\r\n    return this.set(poly);\r\n  }\r\n\r\n  /**\r\n   * Sets up a {@apilink Circle | `circle collision geometry`} as the only collider with a specified radius in pixels.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\r\n    const collider = Shape.Circle(radius, center);\r\n    return this.set(collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up an {@apilink Edge | `edge collision geometry`} with a start point and an end point relative to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\r\n    const collider = Shape.Edge(begin, end);\r\n    return this.set(collider);\r\n  }\r\n\r\n  /**\r\n   * Setups up a {@apilink CompositeCollider} which can define any arbitrary set of excalibur colliders\r\n   * @param colliders\r\n   */\r\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\r\n    return this.set(new CompositeCollider(colliders));\r\n  }\r\n}\r\n","import { vec, Vector } from '../Math/vector';\r\nimport { CollisionType } from './CollisionType';\r\nimport { Clonable } from '../Interfaces/Clonable';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { CollisionGroup } from './Group/CollisionGroup';\r\nimport { createId, Id } from '../Id';\r\nimport { clamp } from '../Math/util';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { Transform } from '../Math/transform';\r\nimport { EventEmitter } from '../EventEmitter';\r\nimport { getDefaultPhysicsConfig, PhysicsConfig } from './PhysicsConfig';\r\nimport { DeepRequired } from '../Util/Required';\r\nimport { Entity } from '../EntityComponentSystem';\r\n\r\nexport interface BodyComponentOptions {\r\n  type?: CollisionType;\r\n  group?: CollisionGroup;\r\n  useGravity?: boolean;\r\n  config?: Pick<PhysicsConfig, 'bodies'>['bodies'];\r\n}\r\n\r\nexport enum DegreeOfFreedom {\r\n  Rotation = 'rotation',\r\n  X = 'x',\r\n  Y = 'y'\r\n}\r\n\r\n/**\r\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\r\n * of physics simulation.\r\n */\r\nexport class BodyComponent extends Component implements Clonable<BodyComponent> {\r\n  public dependencies = [TransformComponent, MotionComponent];\r\n  public static _ID = 0;\r\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\r\n  public events = new EventEmitter();\r\n\r\n  public oldTransform = new Transform();\r\n\r\n  /**\r\n   * Indicates whether the old transform has been captured at least once for interpolation\r\n   * @internal\r\n   */\r\n  public __oldTransformCaptured: boolean = false;\r\n\r\n  /**\r\n   * Enable or disabled the fixed update interpolation, by default interpolation is on.\r\n   */\r\n  public enableFixedUpdateInterpolate = true;\r\n\r\n  private _bodyConfig: DeepRequired<Pick<PhysicsConfig, 'bodies'>['bodies']>;\r\n  private static _DEFAULT_CONFIG: DeepRequired<Pick<PhysicsConfig, 'bodies'>['bodies']> = {\r\n    ...getDefaultPhysicsConfig().bodies\r\n  };\r\n  public wakeThreshold: number;\r\n\r\n  constructor(options?: BodyComponentOptions) {\r\n    super();\r\n    if (options) {\r\n      this.collisionType = options.type ?? this.collisionType;\r\n      this.group = options.group ?? this.group;\r\n      this.useGravity = options.useGravity ?? this.useGravity;\r\n      this._bodyConfig = {\r\n        ...getDefaultPhysicsConfig().bodies,\r\n        ...options.config\r\n      };\r\n    } else {\r\n      this._bodyConfig = {\r\n        ...getDefaultPhysicsConfig().bodies\r\n      };\r\n    }\r\n    this.updatePhysicsConfig(this._bodyConfig);\r\n    this._mass = BodyComponent._DEFAULT_CONFIG.defaultMass;\r\n  }\r\n\r\n  public get matrix() {\r\n    return this.transform.get().matrix;\r\n  }\r\n\r\n  /**\r\n   * Called by excalibur to update physics config defaults if they change\r\n   * @param config\r\n   */\r\n  public updatePhysicsConfig(config: DeepRequired<Pick<PhysicsConfig, 'bodies'>['bodies']>) {\r\n    this._bodyConfig = {\r\n      ...getDefaultPhysicsConfig().bodies,\r\n      ...config\r\n    };\r\n    this.canSleep = this._bodyConfig.canSleepByDefault;\r\n    this.sleepMotion = this._bodyConfig.sleepEpsilon * 5;\r\n    this.wakeThreshold = this._bodyConfig.wakeThreshold;\r\n  }\r\n  /**\r\n   * Called by excalibur to update defaults\r\n   * @param config\r\n   */\r\n  public static updateDefaultPhysicsConfig(config: DeepRequired<Pick<PhysicsConfig, 'bodies'>['bodies']>) {\r\n    BodyComponent._DEFAULT_CONFIG = config;\r\n  }\r\n\r\n  /**\r\n   * Collision type for the rigidbody physics simulation, by default {@apilink CollisionType.PreventCollision}\r\n   */\r\n  public collisionType: CollisionType = CollisionType.PreventCollision;\r\n\r\n  /**\r\n   * The collision group for the body's colliders, by default body colliders collide with everything\r\n   */\r\n  public group: CollisionGroup = CollisionGroup.All;\r\n\r\n  /**\r\n   * The amount of mass the body has\r\n   */\r\n  private _mass: number;\r\n  public get mass(): number {\r\n    return this._mass;\r\n  }\r\n\r\n  public set mass(newMass: number) {\r\n    this._mass = newMass;\r\n    this._cachedInertia = undefined;\r\n    this._cachedInverseInertia = undefined;\r\n  }\r\n\r\n  /**\r\n   * The inverse mass (1/mass) of the body. If {@apilink CollisionType.Fixed} this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseMass(): number {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\r\n  }\r\n\r\n  /**\r\n   * Amount of \"motion\" the body has before sleeping. If below {@apilink Physics.sleepEpsilon} it goes to \"sleep\"\r\n   */\r\n  public sleepMotion: number;\r\n\r\n  /**\r\n   * Can this body sleep, by default bodies do not sleep\r\n   */\r\n  public canSleep: boolean;\r\n\r\n  private _sleeping = false;\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   * @deprecated use isSleeping\r\n   */\r\n  public get sleeping(): boolean {\r\n    return this.isSleeping;\r\n  }\r\n\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   */\r\n  public get isSleeping(): boolean {\r\n    return this._sleeping;\r\n  }\r\n\r\n  /**\r\n   * Set the sleep state of the body\r\n   * @param sleeping\r\n   * @deprecated use isSleeping\r\n   */\r\n  public setSleeping(sleeping: boolean) {\r\n    this.isSleeping = sleeping;\r\n  }\r\n\r\n  public set isSleeping(sleeping: boolean) {\r\n    this._sleeping = sleeping;\r\n    if (!sleeping) {\r\n      // Give it a kick to keep it from falling asleep immediately\r\n      this.sleepMotion = this._bodyConfig.sleepEpsilon * 5;\r\n    } else {\r\n      this.vel = Vector.Zero;\r\n      this.acc = Vector.Zero;\r\n      this.angularVelocity = 0;\r\n      this.sleepMotion = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update body's {@apilink BodyComponent.sleepMotion} for the purpose of sleeping\r\n   */\r\n  public updateMotion() {\r\n    if (this._sleeping) {\r\n      this.isSleeping = true;\r\n    }\r\n    const currentMotion = this.vel.magnitude * this.vel.magnitude + Math.abs(this.angularVelocity * this.angularVelocity);\r\n    const bias = this._bodyConfig.sleepBias;\r\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\r\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * this._bodyConfig.sleepEpsilon);\r\n    if (this.canSleep && this.sleepMotion < this._bodyConfig.sleepEpsilon) {\r\n      this.isSleeping = true;\r\n    }\r\n  }\r\n\r\n  private _cachedInertia: number;\r\n  /**\r\n   * Get the moment of inertia from the {@apilink ColliderComponent}\r\n   */\r\n  public get inertia() {\r\n    if (this._cachedInertia) {\r\n      return this._cachedInertia;\r\n    }\r\n\r\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\r\n    const collider = this.owner.get(ColliderComponent);\r\n    if (collider) {\r\n      collider.$colliderAdded.subscribe(() => {\r\n        this._cachedInertia = null;\r\n      });\r\n      collider.$colliderRemoved.subscribe(() => {\r\n        this._cachedInertia = null;\r\n      });\r\n      const maybeCollider = collider.get();\r\n      if (maybeCollider) {\r\n        return (this._cachedInertia = maybeCollider.getInertia(this.mass));\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  private _cachedInverseInertia: number;\r\n  /**\r\n   * Get the inverse moment of inertial from the {@apilink ColliderComponent}. If {@apilink CollisionType.Fixed} this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseInertia() {\r\n    if (this._cachedInverseInertia) {\r\n      return this._cachedInverseInertia;\r\n    }\r\n    return (this._cachedInverseInertia = this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia);\r\n  }\r\n\r\n  /**\r\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\r\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\r\n   */\r\n  public bounciness: number = 0.2;\r\n\r\n  /**\r\n   * The coefficient of friction on this actor.\r\n   *\r\n   * The {@apilink SolverStrategy.Arcade} does not support this property.\r\n   *\r\n   */\r\n  public friction: number = 0.99;\r\n\r\n  /**\r\n   * Should use global gravity {@apilink Physics.gravity} in it's physics simulation, default is true\r\n   */\r\n  public useGravity: boolean = true;\r\n\r\n  /**\r\n   * Degrees of freedom to limit\r\n   *\r\n   * Note: this only limits responses in the realistic solver, if velocity/angularVelocity is set the actor will still respond\r\n   */\r\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   * @deprecated use isActive\r\n   */\r\n  public get active() {\r\n    return !!this.owner?.isActive;\r\n  }\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   */\r\n  public get isActive() {\r\n    return !!this.owner?.isActive;\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use globalPos\r\n   */\r\n  public get center() {\r\n    return this.globalPos;\r\n  }\r\n\r\n  public transform: TransformComponent;\r\n  public motion: MotionComponent;\r\n\r\n  override onAdd(owner: Entity<any>): void {\r\n    this.transform = this.owner?.get(TransformComponent);\r\n    this.motion = this.owner?.get(MotionComponent);\r\n  }\r\n\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.pos = val;\r\n  }\r\n\r\n  /**\r\n   * The (x, y) position of the actor this will be in the middle of the actor if the\r\n   * {@apilink Actor.anchor} is set to (0.5, 0.5) which is default.\r\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\r\n   */\r\n  public get globalPos(): Vector {\r\n    return this.transform.globalPos;\r\n  }\r\n\r\n  public set globalPos(val: Vector) {\r\n    this.transform.globalPos = val;\r\n  }\r\n\r\n  private _oldGlobalPos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The position of the actor last frame (x, y) in pixels\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.oldTransform.pos;\r\n  }\r\n\r\n  /**\r\n   * The global position of the actor last frame (x, y) in pixels\r\n   */\r\n  public get oldGlobalPos(): Vector {\r\n    return this._oldGlobalPos;\r\n  }\r\n\r\n  /**\r\n   * The current velocity vector (vx, vy) of the actor in pixels/second\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this.motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * The velocity of the actor last frame (vx, vy) in pixels/second\r\n   */\r\n  public oldVel: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\r\n   * be useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  public set acc(val: Vector) {\r\n    this.motion.acc = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\r\n   */\r\n  public oldAcc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The current torque applied to the actor\r\n   */\r\n  public get torque(): number {\r\n    return this.motion.torque;\r\n  }\r\n\r\n  public set torque(val: number) {\r\n    this.motion.torque = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the rotation of the body from the last frame.\r\n   */\r\n  public get oldRotation(): number {\r\n    return this.oldTransform.rotation;\r\n  }\r\n\r\n  /**\r\n   * The rotation of the body in radians\r\n   */\r\n  public get rotation() {\r\n    return this.transform.globalRotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.transform.globalRotation = val;\r\n  }\r\n\r\n  /**\r\n   * The scale vector of the actor\r\n   */\r\n  public get scale(): Vector {\r\n    return this.transform.globalScale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.transform.globalScale = val;\r\n  }\r\n\r\n  /**\r\n   * The scale of the actor last frame\r\n   */\r\n  public get oldScale(): Vector {\r\n    return this.oldTransform.scale;\r\n  }\r\n\r\n  /**\r\n   * The scale rate of change of the actor in scale/second\r\n   */\r\n  public get scaleFactor(): Vector {\r\n    return this.motion.scaleFactor;\r\n  }\r\n\r\n  public set scaleFactor(scaleFactor: Vector) {\r\n    this.motion.scaleFactor = scaleFactor;\r\n  }\r\n\r\n  /**\r\n   * Get the angular velocity in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Set the angular velocity in radians/second\r\n   */\r\n  public set angularVelocity(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  private _impulseScratch = vec(0, 0);\r\n  private _distanceFromCenterScratch = vec(0, 0);\r\n  /**\r\n   * Apply a specific impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass, this._impulseScratch);\r\n    if (this.limitDegreeOfFreedom.indexOf(DegreeOfFreedom.X) > -1) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.indexOf(DegreeOfFreedom.Y) > -1) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel.addEqual(finalImpulse);\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.globalPos, this._distanceFromCenterScratch);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply only linear impulse to the body\r\n   * @param impulse\r\n   */\r\n  public applyLinearImpulse(impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel = this.vel.add(finalImpulse);\r\n  }\r\n\r\n  /**\r\n   * Apply only angular impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.globalPos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the old versions of pos, vel, acc, and scale.\r\n   */\r\n  public captureOldTransform() {\r\n    // Capture old values before integration step updates them\r\n    this.__oldTransformCaptured = true;\r\n    const tx = this.transform.get();\r\n    tx.clone(this.oldTransform);\r\n    this.oldTransform.parent = tx.parent; // also grab parent\r\n    this.oldVel.setTo(this.vel.x, this.vel.y);\r\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\r\n    this.oldGlobalPos.setTo(this.globalPos.x, this.globalPos.y);\r\n  }\r\n\r\n  public clone(): BodyComponent {\r\n    const component = super.clone() as BodyComponent;\r\n    return component;\r\n  }\r\n}\r\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface RectangleOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/**\r\n * A Rectangle {@apilink Graphic} for drawing rectangles to the {@apilink ExcaliburGraphicsContext}\r\n */\r\nexport class Rectangle extends Raster {\r\n  constructor(options: RasterOptions & RectangleOptions) {\r\n    super(options);\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Rectangle {\r\n    return new Rectangle({\r\n      width: this.width,\r\n      height: this.height,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.color) {\r\n      ctx.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    if (this.strokeColor) {\r\n      ctx.strokeRect(0, 0, this.width, this.height);\r\n    }\r\n  }\r\n}\r\n","import { ImageFiltering } from './Filtering';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CircleOptions {\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * A circle {@apilink Graphic} for drawing circles to the {@apilink ExcaliburGraphicsContext}\r\n *\r\n * Circles default to {@apilink ImageFiltering.Blended}\r\n */\r\nexport class Circle extends Raster {\r\n  private _radius: number = 0;\r\n  public get radius() {\r\n    return this._radius;\r\n  }\r\n  public set radius(value: number) {\r\n    this._radius = value;\r\n    this.width = this._radius * 2;\r\n    this.height = this._radius * 2;\r\n    this.flagDirty();\r\n  }\r\n  constructor(options: RasterOptions & CircleOptions) {\r\n    super(options);\r\n    const lineWidth = options.lineWidth ?? (options.strokeColor ? 1 : 0); // default lineWidth in canvas is 1px\r\n    this.padding = options.padding ?? 2 + lineWidth / 2; // default 2 padding for circles looks nice\r\n    this.radius = options.radius;\r\n    this.filtering = options.filtering ?? ImageFiltering.Blended;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Circle {\r\n    return new Circle({\r\n      radius: this.radius,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.radius > 0) {\r\n      ctx.beginPath();\r\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\r\n\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem/Component';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\n\r\nexport interface PointerComponentOptions {\r\n  useColliderShape?: boolean;\r\n  useGraphicsBounds?: boolean;\r\n  localBounds?: BoundingBox;\r\n}\r\n\r\n/**\r\n * Add this component to optionally configure how the pointer\r\n * system detects pointer events.\r\n *\r\n * By default the collider shape is used and graphics bounds is not.\r\n *\r\n * If both collider shape and graphics bounds are enabled it will fire events if either or\r\n * are intersecting the pointer.\r\n */\r\nexport class PointerComponent extends Component {\r\n  /**\r\n   * Use any existing Collider component geometry for pointer events. This is useful if you want\r\n   * user pointer events only to trigger on the same collision geometry used in the collider component\r\n   * for collision resolution. Default is `true`.\r\n   */\r\n  public useColliderShape = true;\r\n  /**\r\n   * Use any existing Graphics component bounds for pointers. This is useful if you want the axis aligned\r\n   * bounds around the graphic to trigger pointer events. Default is `true`.\r\n   */\r\n  public useGraphicsBounds = true;\r\n\r\n  /**\r\n   * Optionally use other bounds for pointer testing\r\n   */\r\n  public localBounds?: BoundingBox;\r\n\r\n  constructor(options?: PointerComponentOptions) {\r\n    super();\r\n    this.useColliderShape = options?.useColliderShape ?? this.useColliderShape;\r\n    this.useGraphicsBounds = options?.useGraphicsBounds ?? this.useGraphicsBounds;\r\n    this.localBounds = options?.localBounds;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * A definition of an EasingFunction. See {@apilink EasingFunctions}.\r\n */\r\n// tslint:disable-next-line\r\nexport interface EasingFunction<TValueToEase = number> {\r\n  (currentTime: number, startValue: TValueToEase, endValue: TValueToEase, duration: number): TValueToEase;\r\n}\r\n\r\n/**\r\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\r\n * Given a time, the function will return a value from positive startValue to positive endValue.\r\n *\r\n * ```js\r\n * function Linear (t) {\r\n *    return t * t;\r\n * }\r\n *\r\n * // accelerating from zero velocity\r\n * function EaseInQuad (t) {\r\n *    return t * t;\r\n * }\r\n *\r\n * // decelerating to zero velocity\r\n * function EaseOutQuad (t) {\r\n *    return t * (2 - t);\r\n * }\r\n *\r\n * // acceleration until halfway, then deceleration\r\n * function EaseInOutQuad (t) {\r\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\r\n * }\r\n *\r\n * // accelerating from zero velocity\r\n * function EaseInCubic (t) {\r\n *    return t * t * t;\r\n * }\r\n *\r\n * // decelerating to zero velocity\r\n * function EaseOutCubic (t) {\r\n *    return (--t) * t * t + 1;\r\n * }\r\n *\r\n * // acceleration until halfway, then deceleration\r\n * function EaseInOutCubic (t) {\r\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\r\n * }\r\n * ```\r\n */\r\nexport class EasingFunctions {\r\n  public static CreateReversibleEasingFunction(easing: EasingFunction): EasingFunction {\r\n    return (time: number, start: number, end: number, duration: number) => {\r\n      if (end < start) {\r\n        return start - (easing(time, end, start, duration) - end);\r\n      } else {\r\n        return easing(time, start, end, duration);\r\n      }\r\n    };\r\n  }\r\n\r\n  public static CreateVectorEasingFunction(easing: EasingFunction<number>): EasingFunction<Vector> {\r\n    return (time: number, start: Vector, end: Vector, duration: number) => {\r\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\r\n    };\r\n  }\r\n\r\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      return (endValue * currentTime) / duration + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n\r\n      return endValue * currentTime * currentTime + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      return -endValue * currentTime * (currentTime - 2) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration / 2;\r\n\r\n      if (currentTime < 1) {\r\n        return (endValue / 2) * currentTime * currentTime + startValue;\r\n      }\r\n      currentTime--;\r\n\r\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      return endValue * currentTime * currentTime * currentTime + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      currentTime--;\r\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration / 2;\r\n      if (currentTime < 1) {\r\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\r\n      }\r\n      currentTime -= 2;\r\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\r\n    }\r\n  );\r\n}\r\n","import { ActionCompleteEvent, ActionStartEvent } from '../Events';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\n\r\n/**\r\n * Action Queues represent an ordered sequence of actions\r\n *\r\n * Action queues are part of the {@apilink ActionContext | `Action API`} and\r\n * store the list of actions to be executed for an {@apilink Actor}.\r\n *\r\n * Actors implement {@apilink Actor.actions} which can be manipulated by\r\n * advanced users to adjust the actions currently being executed in the\r\n * queue.\r\n */\r\nexport class ActionQueue {\r\n  private _entity: Entity;\r\n  private _actions: Action[] = [];\r\n  private _currentAction: Action | null = null;\r\n  private _completedActions: Action[] = [];\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  /**\r\n   * Add an action to the sequence\r\n   * @param action\r\n   */\r\n  public add(action: Action) {\r\n    this._actions.push(action);\r\n  }\r\n\r\n  /**\r\n   * Remove an action by reference from the sequence\r\n   * @param action\r\n   */\r\n  public remove(action: Action) {\r\n    const index = this._actions.indexOf(action);\r\n    this._actions.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Removes all actions from this sequence\r\n   */\r\n  public clearActions(): void {\r\n    this._actions.length = 0;\r\n    this._completedActions.length = 0;\r\n    if (this._currentAction) {\r\n      this._currentAction.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns The total list of actions in this sequence complete or not\r\n   */\r\n  public getActions(): Action[] {\r\n    return this._actions.concat(this._completedActions);\r\n  }\r\n\r\n  public getIncompleteActions(): Action[] {\r\n    return this._actions;\r\n  }\r\n\r\n  public getCurrentAction(): Action | null {\r\n    return this._currentAction;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns `true` if there are more actions to process in the sequence\r\n   */\r\n  public hasNext(): boolean {\r\n    return this._actions.length > 0;\r\n  }\r\n\r\n  /**\r\n   * @returns `true` if the current sequence of actions is done\r\n   */\r\n  public isComplete(): boolean {\r\n    return this._actions.length === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\r\n   */\r\n  public reset(): void {\r\n    this._actions = this.getActions();\r\n\r\n    const len = this._actions.length;\r\n    for (let i = 0; i < len; i++) {\r\n      this._actions[i].reset();\r\n    }\r\n    this._completedActions = [];\r\n  }\r\n\r\n  /**\r\n   * Update the queue which updates actions and handles completing actions\r\n   * @param elapsed\r\n   */\r\n  public update(elapsed: number) {\r\n    if (this._actions.length > 0) {\r\n      if (this._currentAction !== this._actions[0]) {\r\n        this._currentAction = this._actions[0];\r\n        this._entity.emit('actionstart', new ActionStartEvent(this._currentAction, this._entity));\r\n      }\r\n\r\n      this._currentAction.update(elapsed);\r\n\r\n      if (this._currentAction.isComplete(this._entity)) {\r\n        this._entity.emit('actioncomplete', new ActionCompleteEvent(this._currentAction, this._entity));\r\n        const complete = this._actions.shift();\r\n        if (complete) {\r\n          this._completedActions.push(complete);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem/Entity';\r\n\r\n/**\r\n * Used for implementing actions for the {@apilink ActionContext | `Action API`}.\r\n */\r\nexport interface Action {\r\n  id: number;\r\n  update(elapsed: number): void;\r\n  isComplete(entity: Entity): boolean;\r\n  reset(): void;\r\n  stop(): void;\r\n}\r\n\r\nlet _ACTION_ID = 0;\r\n/**\r\n *\r\n */\r\nexport function nextActionId(): number {\r\n  return _ACTION_ID++;\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\nexport class Repeat implements Action {\r\n  id = nextActionId();\r\n  private _actionQueue: ActionQueue;\r\n  private _repeat: number;\r\n  private _originalRepeat: number;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeat = repeat;\r\n    this._originalRepeat = repeat;\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n    this._repeat--; // current execution is the first repeat\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n      this._repeat--;\r\n    }\r\n    this._actionQueue.update(elapsed);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._repeat = this._originalRepeat;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * RepeatForever Action implementation, it is recommended you use the fluent action\r\n * context API.\r\n *\r\n *\r\n */\r\nexport class RepeatForever implements Action {\r\n  id = nextActionId();\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (this._stopped) {\r\n      return;\r\n    }\r\n\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n    }\r\n\r\n    this._actionQueue.update(elapsed);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n    this._actionQueue.clearActions();\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { RotationType } from './rotation-type';\r\nimport { TwoPI } from './util';\r\nimport { Vector } from './vector';\r\n\r\n/**\r\n * Linear interpolation between `a` and `b`, at `time = 0` the value will be `a` at `time = 1` the value will be `b`\r\n * @param a\r\n * @param b\r\n * @param time\r\n */\r\nexport function lerp(a: number, b: number, time: number): number {\r\n  return (1 - time) * a + b * time;\r\n}\r\n\r\n/**\r\n * Linear interpolation between angles in radians\r\n * @param startAngle\r\n * @param endAngle\r\n * @param rotationType\r\n * @param time\r\n */\r\nexport function lerpAngle(startAngle: number, endAngle: number, rotationType: RotationType, time: number): number {\r\n  const shortestPathIsPositive = (startAngle - endAngle + TwoPI) % TwoPI >= Math.PI;\r\n  const distance1 = Math.abs(endAngle - startAngle);\r\n  const distance2 = TwoPI - distance1;\r\n  let shortDistance = 0;\r\n  let longDistance = 0;\r\n  if (distance1 > distance2) {\r\n    shortDistance = distance2;\r\n    longDistance = distance1;\r\n  } else {\r\n    shortDistance = distance1;\r\n    longDistance = distance2;\r\n  }\r\n  let distance = 0;\r\n  let direction = 1;\r\n\r\n  switch (rotationType) {\r\n    case RotationType.ShortestPath:\r\n      distance = shortDistance;\r\n      direction = shortestPathIsPositive ? 1 : -1;\r\n      break;\r\n    case RotationType.LongestPath:\r\n      distance = longDistance;\r\n      direction = shortestPathIsPositive ? -1 : 1;\r\n      break;\r\n    case RotationType.Clockwise:\r\n      direction = 1;\r\n      distance = shortestPathIsPositive ? shortDistance : longDistance;\r\n      break;\r\n    case RotationType.CounterClockwise:\r\n      direction = -1;\r\n      distance = shortestPathIsPositive ? longDistance : shortDistance;\r\n      break;\r\n  }\r\n\r\n  return startAngle + direction * (distance * time);\r\n}\r\n\r\n/**\r\n * Linear interpolation between `a` and `b`, at `time = 0` the value will be `a` at `time = 1` the value will be `b`\r\n * @param a\r\n * @param b\r\n * @param time\r\n */\r\nexport function lerpVector(a: Vector, b: Vector, time: number): Vector {\r\n  return a.scale(1 - time).add(b.scale(time));\r\n}\r\n\r\n/**\r\n * Inverse of a linear interpolation, given a `value` in between `a` and `b` return how close to `a` or `b` the `value` is.\r\n *\r\n * Example: `a=1`, `b=5`, `value=4` will return `.75`\r\n * @param a\r\n * @param b\r\n * @param value\r\n */\r\nexport function inverseLerp(a: number, b: number, value: number): number {\r\n  return (value - a) / (b - a);\r\n}\r\n\r\n/**\r\n * Inverse of a linear interpolation, given a `value` in between `a` and `b` return how close to `a` or `b` the `value` is.\r\n *\r\n * **Warning** assumes that the `value` vector is co-linear with vector `a` and `b`\r\n *\r\n * Example: `a=1`, `b=5`, `value=4` will return `.75`\r\n * @param a\r\n * @param b\r\n * @param value\r\n */\r\nexport function inverseLerpVector(a: Vector, b: Vector, value: Vector): number {\r\n  const numerator = value.sub(a);\r\n  const denominator = b.sub(a);\r\n  const x = numerator.x / denominator.x;\r\n  const y = numerator.y / denominator.y;\r\n  return Math.min(x, y);\r\n}\r\n\r\n/**\r\n * Remaps a value from a source domain to a destination\r\n * @param minSource\r\n * @param maxSource\r\n * @param minDestination\r\n * @param maxDestination\r\n * @param value\r\n */\r\nexport function remap(minSource: number, maxSource: number, minDestination: number, maxDestination: number, value: number): number {\r\n  const time = inverseLerp(minSource, maxSource, value);\r\n  return lerp(minDestination, maxDestination, time);\r\n}\r\n\r\n/**\r\n * Remaps a value from a source domain to a destination\r\n *\r\n * **Warning** assumes that the `value` vector is co-linear with vector `minSource` and `maxSource`\r\n * @param minSource\r\n * @param maxSource\r\n * @param minDestination\r\n * @param maxDestination\r\n * @param value\r\n */\r\nexport function remapVector(minSource: Vector, maxSource: Vector, minDestination: Vector, maxDestination: Vector, value: Vector): Vector {\r\n  const time = inverseLerpVector(minSource, maxSource, value);\r\n  return lerpVector(minDestination, maxDestination, time);\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { clamp, remap } from '../../Math';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { EasingFunction, EasingFunctions } from '../../Util/EasingFunctions';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport interface MoveByOptions {\r\n  offset: Vector;\r\n  duration: number;\r\n  easing?: EasingFunction;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isMoveByOptions(x: any): x is MoveByOptions {\r\n  return x.offset instanceof Vector && typeof x.duration === 'number';\r\n}\r\n\r\nexport class MoveByWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _start!: Vector;\r\n  private _end!: Vector;\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _offset: Vector;\r\n  private _easing: EasingFunction = EasingFunctions.Linear;\r\n  constructor(\r\n    public entity: Entity,\r\n    options: MoveByOptions\r\n  ) {\r\n    this._offset = options.offset;\r\n    this._easing = options.easing ?? this._easing;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only MoveBy on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._start = this._tx.pos.clone();\r\n      this._end = this._start.add(this._offset);\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const currentPos = this._tx.pos;\r\n    const newPosX = this._easing(t, this._start.x, this._end.x, 1);\r\n    const newPosY = this._easing(t, this._start.y, this._end.y, 1);\r\n    const velX = (newPosX - currentPos.x) / (elapsed / 1000);\r\n    const velY = (newPosY - currentPos.y) / (elapsed / 1000);\r\n    this._motion.vel.x = velX;\r\n    this._motion.vel.y = velY;\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n  public isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class MoveBy implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _entity: Entity;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _distance!: number;\r\n  private _speed: number;\r\n\r\n  private _start!: Vector;\r\n  private _offset!: Vector;\r\n  private _end!: Vector;\r\n  private _dir!: Vector;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\r\n    this._entity = entity;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n    if (speed <= 0) {\r\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\r\n      throw new Error('Speed must be greater than 0 pixels per second');\r\n    }\r\n  }\r\n\r\n  public update(elapsed: number) {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._end = this._start.add(this._offset);\r\n      this._distance = this._offset.magnitude;\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n\r\n    if (this.isComplete(this._entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    } else {\r\n      this._motion.vel = this._dir.scale(this._speed);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { clamp, remap } from '../../Math';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { EasingFunction, EasingFunctions } from '../../Util/EasingFunctions';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport interface MoveToOptions {\r\n  pos: Vector;\r\n  duration: number;\r\n  easing?: EasingFunction;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isMoveToOptions(x: any): x is MoveToOptions {\r\n  return x.pos instanceof Vector && typeof x.duration === 'number';\r\n}\r\n\r\nexport class MoveToWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _end: Vector;\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _start!: Vector;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _easing: EasingFunction = EasingFunctions.Linear;\r\n  constructor(\r\n    public entity: Entity,\r\n    options: MoveToOptions\r\n  ) {\r\n    this._end = options.pos;\r\n    this._easing = options.easing ?? this._easing;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only moveTo on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._start = this._tx.pos.clone();\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const currentPos = this._tx.pos;\r\n    const newPosX = this._easing(t, this._start.x, this._end.x, 1);\r\n    const newPosY = this._easing(t, this._start.y, this._end.y, 1);\r\n    const velX = (newPosX - currentPos.x) / (elapsed / 1000);\r\n    const velY = (newPosY - currentPos.y) / (elapsed / 1000);\r\n    this._motion.vel.x = velX;\r\n    this._motion.vel.y = velY;\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n  public isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class MoveTo implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _start!: Vector;\r\n  private _end: Vector;\r\n  private _dir!: Vector;\r\n  private _speed: number;\r\n  private _distance!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(\r\n    public entity: Entity,\r\n    destX: number,\r\n    destY: number,\r\n    speed: number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = new Vector(destX, destY);\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._distance = this._start.distance(this._end);\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { Action, nextActionId } from '../Action';\r\nimport { RotationType } from '../../Math';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { clamp, TwoPI } from '../../Math/util';\r\nimport { lerpAngle, remap } from '../../Math';\r\n\r\nexport interface RotateToOptions {\r\n  /**\r\n   * Absolute angle to rotate to in radians\r\n   */\r\n  angle: number;\r\n  /**\r\n   * Duration to take in milliseconds\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Optionally provide type of rotation, default is RotationType.ShortestPath\r\n   */\r\n  rotationType?: RotationType;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isRotateToOptions(x: any): x is RotateToOptions {\r\n  return typeof x.angle === 'number' && typeof x.duration === 'number';\r\n}\r\n\r\nexport class RotateToWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _endAngle: number = 0;\r\n  private _startAngle: number = 0;\r\n  private _rotationType: RotationType;\r\n  constructor(\r\n    public entity: Entity,\r\n    options: RotateToOptions\r\n  ) {\r\n    this._endAngle = options.angle;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only RotateTo on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._rotationType = options.rotationType ?? RotationType.ShortestPath;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._startAngle = this._tx.rotation;\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const newAngle = lerpAngle(this._startAngle, this._endAngle, this._rotationType, t);\r\n    const currentAngle = this._tx.rotation;\r\n\r\n    const rx = (newAngle - currentAngle) / (elapsed / 1000);\r\n    this._motion.angularVelocity = rx;\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.rotation = this._endAngle;\r\n      this._motion.angularVelocity = 0;\r\n    }\r\n  }\r\n  public isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class RotateTo implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _start!: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _rotationType: RotationType;\r\n  private _direction!: number;\r\n  private _distance!: number;\r\n  private _shortDistance!: number;\r\n  private _longDistance!: number;\r\n  private _shortestPathIsPositive!: boolean;\r\n  private _currentNonCannonAngle!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angle: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = angle;\r\n    this._speed = speed;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (!this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (elapsed / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTraveled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTraveled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { Action, nextActionId } from '../Action';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { canonicalizeAngle, clamp, TwoPI } from '../../Math/util';\r\nimport { lerpAngle, remap, RotationType } from '../../Math';\r\n\r\nexport interface RotateByOptions {\r\n  /**\r\n   * Angle in radians to offset from the current and rotate\r\n   */\r\n  angleRadiansOffset: number;\r\n  /**\r\n   * Duration to take in milliseconds\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Optionally provide type of rotation, default is RotationType.ShortestPath\r\n   */\r\n  rotationType?: RotationType;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isRotateByOptions(x: any): x is RotateByOptions {\r\n  return typeof x.angleRadiansOffset === 'number' && typeof x.duration === 'number';\r\n}\r\n\r\nexport class RotateByWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _offset: number = 0;\r\n  private _startAngle: number = 0;\r\n  private _rotationType: RotationType;\r\n  private _endAngle: number = 0;\r\n  constructor(\r\n    public entity: Entity,\r\n    options: RotateByOptions\r\n  ) {\r\n    this._offset = options.angleRadiansOffset;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only RotateBy on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._rotationType = options.rotationType ?? RotationType.ShortestPath;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._startAngle = this._tx.rotation;\r\n      this._endAngle = canonicalizeAngle(this._startAngle + this._offset);\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const newAngle = lerpAngle(this._startAngle, this._endAngle, this._rotationType, t);\r\n    const currentAngle = this._tx.rotation;\r\n\r\n    const rx = (newAngle - currentAngle) / (elapsed / 1000);\r\n    this._motion.angularVelocity = rx;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._endAngle;\r\n      this._motion.angularVelocity = 0;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class RotateBy implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _start!: number;\r\n  private _end!: number;\r\n  private _speed: number;\r\n  private _offset: number;\r\n\r\n  private _rotationType: RotationType;\r\n  private _direction!: number;\r\n  private _distance!: number;\r\n  private _shortDistance!: number;\r\n  private _longDistance!: number;\r\n  private _shortestPathIsPositive!: boolean;\r\n  private _currentNonCannonAngle!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = angleRadiansOffset;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      this._end = this._start + this._offset;\r\n\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortDistance >= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (this._shortDistance <= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (elapsed / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTraveled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTraveled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._start = undefined as any;\r\n    this._currentNonCannonAngle = undefined as any;\r\n    this._distance = undefined as any;\r\n  }\r\n}\r\n","import { vec, Vector } from '../../Math/vector';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { clamp, lerpVector, remap } from '../../Math';\r\n\r\nexport interface ScaleToOptions {\r\n  /**\r\n   * Absolute scale to change to\r\n   */\r\n  scale: Vector;\r\n  /**\r\n   * Duration to take in milliseconds\r\n   */\r\n  duration: number;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isScaleToOptions(x: any): x is ScaleToOptions {\r\n  return typeof x.scale === 'object' && typeof x.duration === 'number';\r\n}\r\n\r\nexport class ScaleToWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _endScale: Vector = vec(1, 1);\r\n  private _startScale: Vector = vec(1, 1);\r\n  constructor(\r\n    public entity: Entity,\r\n    options: ScaleToOptions\r\n  ) {\r\n    this._endScale = options.scale;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only ScaleTo on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._startScale = this._tx.scale;\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const newScale = lerpVector(this._startScale, this._endScale, t);\r\n    const currentScale = this._tx.scale;\r\n\r\n    const sx = newScale.sub(currentScale).scale(1 / (elapsed / 1000));\r\n    this._motion.scaleFactor = sx;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.angularVelocity = 0;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor = Vector.Zero;\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class ScaleTo implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _startX!: number;\r\n  private _startY!: number;\r\n  private _endX: number;\r\n  private _endY: number;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  private _distanceX!: number;\r\n  private _distanceY!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._endX = scaleX;\r\n    this._endY = scaleY;\r\n    this._speedX = speedX;\r\n    this._speedY = speedY;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startX = this._tx.scale.x;\r\n      this._startY = this._tx.scale.y;\r\n      this._distanceX = Math.abs(this._endX - this._startX);\r\n      this._distanceY = Math.abs(this._endY - this._startY);\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\r\n      const directionX = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.x = this._speedX * directionX;\r\n    } else {\r\n      this._motion.scaleFactor.x = 0;\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\r\n      const directionY = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.y = this._speedY * directionY;\r\n    } else {\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = vec(this._endX, this._endY);\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.x - this._startX) >= this._distanceX - 0.01 &&\r\n        Math.abs(this._tx.scale.y - this._startY) >= this._distanceY - 0.01)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { vec, Vector } from '../../Math/vector';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { clamp, lerpVector, remap } from '../../Math';\r\n\r\nexport interface ScaleByOptions {\r\n  /**\r\n   * Absolute scale to change to\r\n   */\r\n  scaleOffset: Vector;\r\n  /**\r\n   * Duration to take in milliseconds\r\n   */\r\n  duration: number;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isScaleByOptions(x: any): x is ScaleByOptions {\r\n  return typeof x.scaleOffset === 'object' && typeof x.duration === 'number';\r\n}\r\n\r\nexport class ScaleByWithOptions implements Action {\r\n  id = nextActionId();\r\n  private _durationMs: number;\r\n  private _tx: TransformComponent;\r\n  private _started: boolean = false;\r\n  private _currentMs: number;\r\n  private _stopped: boolean = false;\r\n  private _motion: MotionComponent;\r\n  private _endScale: Vector = vec(1, 1);\r\n  private _scaleOffset: Vector = vec(0, 0);\r\n  private _startScale: Vector = vec(1, 1);\r\n  constructor(\r\n    public entity: Entity,\r\n    options: ScaleByOptions\r\n  ) {\r\n    this._scaleOffset = options.scaleOffset;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only ScaleBy on Entities with TransformComponents.`);\r\n    }\r\n    this._durationMs = options.duration;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._startScale = this._tx.scale;\r\n      this._endScale = this._startScale.add(this._scaleOffset);\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    const newScale = lerpVector(this._startScale, this._endScale, t);\r\n    const currentScale = this._tx.scale;\r\n    const sx = newScale.sub(currentScale).scale(1 / (elapsed / 1000));\r\n    this._motion.scaleFactor = sx;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.angularVelocity = 0;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor = Vector.Zero;\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n\r\nexport class ScaleBy implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _startScale!: Vector;\r\n  private _endScale!: Vector;\r\n  private _offset: Vector;\r\n  private _distanceX!: number;\r\n  private _distanceY!: number;\r\n  private _directionX!: number;\r\n  private _directionY!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\r\n    this._speedX = this._speedY = speed;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startScale = this._tx.scale.clone();\r\n      this._endScale = this._startScale.add(this._offset);\r\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\r\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\r\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\r\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\r\n    }\r\n\r\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\r\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX - 0.01 &&\r\n        Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY - 0.01)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { Action, nextActionId } from '../Action';\r\n\r\nexport class CallMethod implements Action {\r\n  id = nextActionId();\r\n  private _method: () => any;\r\n  private _hasBeenCalled: boolean = false;\r\n  constructor(method: () => any) {\r\n    this._method = method;\r\n  }\r\n\r\n  public update(elapsed: number) {\r\n    this._method();\r\n    this._hasBeenCalled = true;\r\n  }\r\n  public isComplete() {\r\n    return this._hasBeenCalled;\r\n  }\r\n  public reset() {\r\n    this._hasBeenCalled = false;\r\n  }\r\n  public stop() {\r\n    this._hasBeenCalled = true;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\n/**\r\n * @deprecated use moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n */\r\nexport class EaseTo implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  constructor(\r\n    entity: Entity,\r\n    x: number,\r\n    y: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = new Vector(x, y);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += elapsed;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (elapsed / 1000), (newY - this._tx.pos.y) / (elapsed / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentLerpTime >= this._lerpDuration;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n    this._stopped = false;\r\n    this._currentLerpTime = 0;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\n/**\r\n * @deprecated use moveBy({offset: Vector, duration: number, easing: EasingFunction})\r\n */\r\nexport class EaseBy implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _offset: Vector;\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  constructor(\r\n    entity: Entity,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n    this._lerpEnd = this._lerpStart.add(this._offset);\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += elapsed;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (elapsed / 1000), (newY - this._tx.pos.y) / (elapsed / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentLerpTime >= this._lerpDuration;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n    this._stopped = false;\r\n    this._currentLerpTime = 0;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport class Blink implements Action {\r\n  id = nextActionId();\r\n  private _graphics: GraphicsComponent;\r\n  private _timeVisible: number = 0;\r\n  private _timeNotVisible: number = 0;\r\n  private _elapsedTime: number = 0;\r\n  private _totalTime: number = 0;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._timeVisible = timeVisible;\r\n    this._timeNotVisible = timeNotVisible;\r\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._elapsedTime = 0;\r\n      this._totalTime = 0;\r\n    }\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    this._elapsedTime += elapsed;\r\n    this._totalTime += elapsed;\r\n    if (this._graphics.isVisible && this._elapsedTime >= this._timeVisible) {\r\n      this._graphics.isVisible = false;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (!this._graphics.isVisible && this._elapsedTime >= this._timeNotVisible) {\r\n      this._graphics.isVisible = true;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.isVisible = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._totalTime >= this._duration;\r\n  }\r\n\r\n  public stop(): void {\r\n    if (this._graphics) {\r\n      this._graphics.isVisible = true;\r\n    }\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._elapsedTime = 0;\r\n    this._totalTime = 0;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport class Fade implements Action {\r\n  id = nextActionId();\r\n  private _graphics: GraphicsComponent;\r\n\r\n  private _endOpacity: number;\r\n  private _remainingTime: number;\r\n  private _originalTime: number;\r\n  private _multiplier: number = 1;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, endOpacity: number, duration: number) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._endOpacity = endOpacity;\r\n    this._remainingTime = this._originalTime = duration;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._remainingTime = this._originalTime;\r\n\r\n      // determine direction when we start\r\n      if (this._endOpacity < this._graphics.opacity) {\r\n        this._multiplier = -1;\r\n      } else {\r\n        this._multiplier = 1;\r\n      }\r\n    }\r\n\r\n    if (this._remainingTime > 0) {\r\n      this._graphics.opacity += (this._multiplier * (Math.abs(this._graphics.opacity - this._endOpacity) * elapsed)) / this._remainingTime;\r\n    }\r\n\r\n    this._remainingTime -= elapsed;\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.opacity = this._endOpacity;\r\n    }\r\n\r\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._remainingTime <= 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._remainingTime = this._originalTime;\r\n  }\r\n}\r\n","import { Action, nextActionId } from '../Action';\r\n\r\nexport class Delay implements Action {\r\n  id = nextActionId();\r\n  private _elapsedTime: number = 0;\r\n  private _delay: number;\r\n  private _started: boolean = false;\r\n  private _stopped = false;\r\n  constructor(duration: number) {\r\n    this._delay = duration;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n\r\n    this._elapsedTime += elapsed;\r\n  }\r\n\r\n  isComplete(): boolean {\r\n    return this._stopped || this._elapsedTime >= this._delay;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  reset(): void {\r\n    this._elapsedTime = 0;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { ActionsComponent } from '../ActionsComponent';\r\n\r\nexport class Die implements Action {\r\n  id = nextActionId();\r\n  private _entity: Entity;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    this._entity.get(ActionsComponent).clearActions();\r\n    this._entity.kill();\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    return;\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport class Follow implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _followTx: TransformComponent;\r\n  private _followMotion: MotionComponent;\r\n\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _maximumDistance: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._followTx = entityToFollow.get(TransformComponent);\r\n    this._followMotion = entityToFollow.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\r\n    this._speed = 0;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\r\n    if (actorToFollowSpeed !== 0) {\r\n      this._speed = actorToFollowSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    if (this._distanceBetween >= this._maximumDistance) {\r\n      const m = this._dir.scale(this._speed);\r\n      this._motion.vel = vec(m.x, m.y);\r\n    } else {\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    // the actor following should never stop unless specified to do so\r\n    return this._stopped;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport class Meet implements Action {\r\n  id = nextActionId();\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _meetTx: TransformComponent;\r\n  private _meetMotion: MotionComponent;\r\n  public x!: number;\r\n  public y!: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir!: Vector;\r\n  private _speed: number;\r\n  private _distanceBetween!: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedWasSpecified = false;\r\n\r\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\r\n    this._tx = actor.get(TransformComponent);\r\n    this._motion = actor.get(MotionComponent);\r\n    this._meetTx = actorToMeet.get(TransformComponent);\r\n    this._meetMotion = actorToMeet.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._speed = speed || 0;\r\n\r\n    if (speed !== undefined) {\r\n      this._speedWasSpecified = true;\r\n    }\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\r\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\r\n      this._speed = actorToMeetSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._distanceBetween <= 1;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._distanceBetween = Infinity;\r\n  }\r\n}\r\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { Actor } from '../../Actor';\r\nimport { Material } from '../../Graphics/Context/material';\r\nimport { Color } from '../../Color';\r\nimport { Shader } from '../../Graphics/Context/shader';\r\n\r\nexport class Flash implements Action {\r\n  id = nextActionId();\r\n  private _graphics: GraphicsComponent;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  private _entity: Entity;\r\n  private _material: Material | undefined;\r\n  private _total: number = 0;\r\n  private _currentDuration: number = 0;\r\n\r\n  constructor(entity: Entity, color: Color, duration: number = 1000) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._duration = duration;\r\n    this._entity = entity;\r\n    this._material = entity.scene?.engine.graphicsContext.createMaterial({\r\n      name: 'flash-material',\r\n      color,\r\n      fragmentSource: `#version 300 es\r\n    \r\n        precision mediump float;\r\n        uniform float u_blend;\r\n        uniform sampler2D u_graphic;\r\n        uniform vec4 u_color;\r\n    \r\n        in vec2 v_uv; \r\n        out vec4 color;\r\n    \r\n        void main() { \r\n            vec4 textureColor = texture(u_graphic, v_uv); \r\n            color = mix(textureColor, u_color, u_blend * textureColor.a);\r\n            color.rgb = color.rgb * color.a;\r\n        }`\r\n    }) as Material;\r\n    this._total = duration;\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._total = this._duration;\r\n      this._currentDuration = this._duration;\r\n      (this._entity as Actor).graphics.material = this._material as Material;\r\n    }\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    this._currentDuration -= elapsed;\r\n\r\n    if (this._graphics) {\r\n      this._material?.update((shader: Shader) => {\r\n        shader.trySetUniformFloat('u_blend', this._currentDuration / this._total);\r\n      });\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      (this._entity as Actor).graphics.material = null;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentDuration <= 0;\r\n  }\r\n\r\n  public stop(): void {\r\n    if (this._graphics) {\r\n      this._graphics.isVisible = true;\r\n    }\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n","import { lerpVector, remap } from './lerp';\r\nimport { Vector } from './vector';\r\n\r\nexport interface BezierCurveOptions {\r\n  /**\r\n   * [start, control1, control2, end]\r\n   */\r\n  controlPoints: [start: Vector, control1: Vector, control2: Vector, end: Vector];\r\n  /**\r\n   * Quality when sampling uniform points on the curve. Samples = 4 * quality;\r\n   *\r\n   * For bigger 'uniform' curves you may want to increase quality\r\n   *\r\n   * Default 4\r\n   */\r\n  quality?: number;\r\n}\r\n\r\n/**\r\n * BezierCurve that supports cubic Bezier curves.\r\n */\r\nexport class BezierCurve {\r\n  // Thanks Freya! https://www.youtube.com/watch?v=aVwxzDHniEw\r\n  private _distLookup: number[] = [];\r\n  private _controlPoints: [Vector, Vector, Vector, Vector];\r\n  private _arcLength: number;\r\n  readonly quality: number = 4;\r\n  constructor(options: BezierCurveOptions) {\r\n    if (options.controlPoints.length !== 4) {\r\n      throw new Error('Only cubic bezier curves are supported');\r\n    }\r\n    this._controlPoints = [...options.controlPoints];\r\n    this.quality = options.quality ?? this.quality;\r\n\r\n    this._calculateLookup();\r\n  }\r\n\r\n  public get arcLength(): number {\r\n    return this._arcLength;\r\n  }\r\n\r\n  public get controlPoints(): readonly [start: Vector, control1: Vector, control2: Vector, end: Vector] {\r\n    return this._controlPoints;\r\n  }\r\n\r\n  public set controlPoints(points: [start: Vector, control1: Vector, control2: Vector, end: Vector]) {\r\n    this._controlPoints = [...points];\r\n    this._calculateLookup();\r\n  }\r\n\r\n  setControlPoint(index: 0 | 1 | 2 | 3, point: Vector) {\r\n    this._controlPoints[index] = point;\r\n    this._calculateLookup();\r\n  }\r\n\r\n  private _calculateLookup() {\r\n    let totalLength = 0;\r\n    this._distLookup.length = 0;\r\n    let prev = this.controlPoints[0];\r\n    const n = this.controlPoints.length * this.quality;\r\n    for (let i = 0; i < n; i++) {\r\n      const t = i / (n - 1);\r\n      const pt = this.getPoint(t);\r\n      const diff = prev.distance(pt);\r\n      totalLength += diff;\r\n      this._distLookup.push(totalLength);\r\n      prev = pt;\r\n    }\r\n    this._arcLength = totalLength;\r\n  }\r\n\r\n  private _getTimeGivenDistance(distance: number): number {\r\n    const n = this._distLookup.length;\r\n    const arcLength = this.arcLength;\r\n\r\n    if (distance >= 0 && distance < arcLength) {\r\n      for (let i = 0; i < n - 1; i++) {\r\n        if (this._distLookup[i] <= distance && distance < this._distLookup[i + 1]) {\r\n          return remap(this._distLookup[i], this._distLookup[i + 1], i / (n - 1), (i + 1) / (n - 1), distance);\r\n        }\r\n      }\r\n    }\r\n    return distance / arcLength;\r\n  }\r\n\r\n  /**\r\n   * Get the point on the Bezier curve at a certain time\r\n   * @param time Between 0-1\r\n   */\r\n  getPoint(time: number): Vector {\r\n    const points = [...this.controlPoints];\r\n\r\n    for (let r = 1; r < points.length; r++) {\r\n      for (let i = 0; i < points.length - r; i++) {\r\n        points[i] = lerpVector(points[i], points[i + 1], time);\r\n      }\r\n    }\r\n\r\n    return points[0];\r\n  }\r\n\r\n  /**\r\n   * Get the tangent of the Bezier curve at a certain time\r\n   * @param time Between 0-1\r\n   */\r\n  getTangent(time: number): Vector {\r\n    const timeSquared = time * time;\r\n    const p0 = this.controlPoints[0];\r\n    const p1 = this.controlPoints[1];\r\n    const p2 = this.controlPoints[2];\r\n    const p3 = this.controlPoints[3];\r\n\r\n    // Derivative of Bernstein polynomial\r\n    const pPrime = p0\r\n      .scale(-3 * timeSquared + 6 * time - 3)\r\n      .add(p1.scale(9 * timeSquared - 12 * time + 3).add(p2.scale(-9 * timeSquared + 6 * time).add(p3.scale(3 * timeSquared))));\r\n\r\n    return pPrime.normalize();\r\n  }\r\n\r\n  /**\r\n   * Get the tangent of the Bezier curve where the distance is uniformly distributed over time\r\n   * @param time\r\n   */\r\n  getUniformTangent(time: number): Vector {\r\n    const desiredDistance = time * this.arcLength;\r\n    const uniformTime = this._getTimeGivenDistance(desiredDistance);\r\n    return this.getTangent(uniformTime);\r\n  }\r\n\r\n  /**\r\n   * Get the normal of the Bezier curve at a certain time\r\n   * @param time Between 0-1\r\n   */\r\n  getNormal(time: number): Vector {\r\n    return this.getTangent(time).normal();\r\n  }\r\n\r\n  /**\r\n   * Get the normal of the Bezier curve where the distance is uniformly distributed over time\r\n   * @param time\r\n   */\r\n  getUniformNormal(time: number): Vector {\r\n    return this.getUniformTangent(time).normal();\r\n  }\r\n\r\n  /**\r\n   * Points are spaced uniformly across the length of the curve over time\r\n   * @param time\r\n   */\r\n  getUniformPoint(time: number): Vector {\r\n    const desiredDistance = time * this.arcLength;\r\n    const uniformTime = this._getTimeGivenDistance(desiredDistance);\r\n    return this.getPoint(uniformTime);\r\n  }\r\n\r\n  clone(): BezierCurve {\r\n    return new BezierCurve({\r\n      controlPoints: [...this.controlPoints],\r\n      quality: this.quality\r\n    });\r\n  }\r\n}\r\n","import { Entity, TransformComponent } from '../../EntityComponentSystem';\r\nimport { BezierCurve, clamp, remap, vec, Vector } from '../../Math';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport interface CurveToOptions {\r\n  /**\r\n   * Bezier Curve in world coordinates to animate towards\r\n   *\r\n   * The start control point is assumed to be the actor's current position\r\n   */\r\n  controlPoints: [control1: Vector, control2: Vector, end: Vector];\r\n  /**\r\n   * Total duration for the action to run\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Dynamic mode will speed up/slow down depending on the curve\r\n   *\r\n   * Uniform mode will animate at a consistent velocity across the curve\r\n   *\r\n   * Default: 'dynamic'\r\n   */\r\n  mode?: 'dynamic' | 'uniform';\r\n  /**\r\n   * Quality when sampling uniform points on the curve. Samples = 4 * quality;\r\n   *\r\n   * For bigger 'uniform' curves you may want to increase quality\r\n   *\r\n   * Default 4\r\n   */\r\n  quality?: number;\r\n}\r\n\r\nexport class CurveTo implements Action {\r\n  id: number = nextActionId();\r\n\r\n  private _curve: BezierCurve;\r\n  private _durationMs: number;\r\n  private _entity: Entity<any>;\r\n  private _tx: TransformComponent;\r\n  private _currentMs: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _mode: 'dynamic' | 'uniform' = 'dynamic';\r\n  constructor(entity: Entity, options: CurveToOptions) {\r\n    this._entity = entity;\r\n    this._tx = this._entity.get(TransformComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);\r\n    }\r\n    this._curve = new BezierCurve({\r\n      controlPoints: [vec(0, 0), ...options.controlPoints],\r\n      quality: options.quality\r\n    });\r\n    this._durationMs = options.duration;\r\n    this._mode = options.mode ?? this._mode;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._curve.setControlPoint(0, this._tx.globalPos.clone());\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    if (this._mode === 'dynamic') {\r\n      this._tx.pos = this._curve.getPoint(t);\r\n    } else {\r\n      this._tx.pos = this._curve.getUniformPoint(t);\r\n    }\r\n    if (this.isComplete(this._entity)) {\r\n      if (this._mode === 'dynamic') {\r\n        this._tx.pos = this._curve.getPoint(1);\r\n      } else {\r\n        this._tx.pos = this._curve.getUniformPoint(1);\r\n      }\r\n    }\r\n  }\r\n  isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n  reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n  stop(): void {\r\n    this._stopped = true;\r\n    this._currentMs = 0;\r\n  }\r\n}\r\n","import { Entity, TransformComponent } from '../../EntityComponentSystem';\r\nimport { BezierCurve, clamp, remap, vec, Vector } from '../../Math';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\nexport interface CurveByOptions {\r\n  /**\r\n   * Bezier Curve relative to the current actor position to move\r\n   */\r\n  controlPoints: [control1: Vector, control2: Vector, end: Vector];\r\n  /**\r\n   * Total duration for the action to run\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Dynamic mode will speed up/slow down depending on the curve\r\n   *\r\n   * Uniform mode will animate at a consistent velocity across the curve\r\n   *\r\n   * Default: 'dynamic'\r\n   */\r\n  mode?: 'dynamic' | 'uniform';\r\n\r\n  /**\r\n   * Quality when sampling uniform points on the curve. Samples = 4 * quality;\r\n   *\r\n   * For bigger 'uniform' curves you may want to increase quality to make the motion appear smooth\r\n   *\r\n   * Default 4\r\n   */\r\n  quality?: number;\r\n}\r\n\r\nexport class CurveBy implements Action {\r\n  id: number = nextActionId();\r\n\r\n  private _curve: BezierCurve;\r\n  private _durationMs: number;\r\n  private _entity: Entity<any>;\r\n  private _tx: TransformComponent;\r\n  private _currentMs: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _mode: 'dynamic' | 'uniform' = 'dynamic';\r\n  constructor(entity: Entity, options: CurveByOptions) {\r\n    this._entity = entity;\r\n    this._tx = this._entity.get(TransformComponent);\r\n    if (!this._tx) {\r\n      throw new Error(`Entity ${entity.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);\r\n    }\r\n    this._curve = this._curve = new BezierCurve({\r\n      controlPoints: [vec(0, 0), ...options.controlPoints],\r\n      quality: options.quality\r\n    });\r\n    this._durationMs = options.duration;\r\n    this._mode = options.mode ?? this._mode;\r\n    this._currentMs = this._durationMs;\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    if (!this._started) {\r\n      this._curve.setControlPoint(0, this._tx.globalPos);\r\n      this._curve.setControlPoint(1, this._curve.controlPoints[1].add(this._tx.globalPos));\r\n      this._curve.setControlPoint(2, this._curve.controlPoints[2].add(this._tx.globalPos));\r\n      this._curve.setControlPoint(3, this._curve.controlPoints[3].add(this._tx.globalPos));\r\n      this._started = true;\r\n    }\r\n    this._currentMs -= elapsed;\r\n    const t = clamp(remap(0, this._durationMs, 0, 1, this._durationMs - this._currentMs), 0, 1);\r\n    if (this._mode === 'dynamic') {\r\n      this._tx.pos = this._curve.getPoint(t);\r\n    } else {\r\n      this._tx.pos = this._curve.getUniformPoint(t);\r\n    }\r\n    if (this.isComplete(this._entity)) {\r\n      if (this._mode === 'dynamic') {\r\n        this._tx.pos = this._curve.getPoint(1);\r\n      } else {\r\n        this._tx.pos = this._curve.getUniformPoint(1);\r\n      }\r\n    }\r\n  }\r\n  isComplete(entity: Entity): boolean {\r\n    return this._stopped || this._currentMs < 0;\r\n  }\r\n  reset(): void {\r\n    this._currentMs = this._durationMs;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n  stop(): void {\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Repeat } from './Action/Repeat';\r\nimport { RepeatForever } from './Action/RepeatForever';\r\nimport { isMoveByOptions, MoveBy, MoveByOptions, MoveByWithOptions } from './Action/MoveBy';\r\nimport { isMoveToOptions, MoveTo, MoveToOptions, MoveToWithOptions } from './Action/MoveTo';\r\nimport { RotateTo, RotateToOptions, RotateToWithOptions } from './Action/RotateTo';\r\nimport { RotateBy, RotateByOptions, RotateByWithOptions } from './Action/RotateBy';\r\nimport { isScaleToOptions, ScaleTo, ScaleToOptions, ScaleToWithOptions } from './Action/ScaleTo';\r\nimport { isScaleByOptions, ScaleBy, ScaleByOptions, ScaleByWithOptions } from './Action/ScaleBy';\r\nimport { CallMethod } from './Action/CallMethod';\r\nimport { EaseTo } from './Action/EaseTo';\r\nimport { EaseBy } from './Action/EaseBy';\r\nimport { Blink } from './Action/Blink';\r\nimport { Fade } from './Action/Fade';\r\nimport { Delay } from './Action/Delay';\r\nimport { Die } from './Action/Die';\r\nimport { Follow } from './Action/Follow';\r\nimport { Meet } from './Action/Meet';\r\nimport { Vector, RotationType } from '../Math';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\nimport { Color } from '../Color';\r\nimport { Flash } from './Action/Flash';\r\nimport { CurveTo, CurveToOptions } from './Action/CurveTo';\r\nimport { CurveBy, CurveByOptions } from './Action/CurveBy';\r\n\r\n/**\r\n * The fluent Action API allows you to perform \"actions\" on\r\n * {@apilink Actor | `actors`} such as following, moving, rotating, and\r\n * more. You can implement your own actions by implementing\r\n * the {@apilink Action} interface.\r\n */\r\nexport class ActionContext {\r\n  private _entity: Entity;\r\n  private _queue: ActionQueue;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n    this._queue = new ActionQueue(entity);\r\n  }\r\n\r\n  public getQueue(): ActionQueue {\r\n    return this._queue;\r\n  }\r\n\r\n  public update(elapsed: number) {\r\n    this._queue.update(elapsed);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._queue.clearActions();\r\n  }\r\n\r\n  public runAction(action: Action) {\r\n    action.reset();\r\n    this._queue.add(action);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Animates an actor with a specified bezier curve by an offset to the current position, the start point is assumed\r\n   * to be the actors current position\r\n   * @param options\r\n   */\r\n  public curveBy(options: CurveByOptions): ActionContext {\r\n    this._queue.add(new CurveBy(this._entity, options));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Animates an actor with a specified bezier curve to an absolute world space coordinate, the start point is assumed\r\n   * to be the actors current position\r\n   * @param options\r\n   */\r\n  public curveTo(options: CurveToOptions): ActionContext {\r\n    this._queue.add(new CurveTo(this._entity, options));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given {@apilink EasingFunctions} and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunction} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given {@apilink EasingFunctions} and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunction} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeTo(...args: any[]): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      x = args[0].x;\r\n      y = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      x = args[0];\r\n      y = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by a specified vector offset relative to the current position given\r\n   * a duration and a {@apilink EasingFunction}. This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset Vector offset relative to the current position\r\n   * @param duration The duration in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunction} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveBy({offset: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeBy(offset: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor by a specified x and y offset relative to the current position given\r\n   * a duration and a {@apilink EasingFunction}. This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset Vector offset relative to the current position\r\n   * @param duration The duration in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunction} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveBy({offset: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeBy(offsetX: number, offsetY: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeBy(...args: any[]): ActionContext {\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      offsetX = args[0].x;\r\n      offsetY = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      offsetX = args[0];\r\n      offsetY = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseBy(this._entity, offsetX, offsetY, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Moves an actor to a specified {@link Vector} in a given duration in milliseconds.\r\n   * You may optionally specify an {@link EasingFunction}\r\n   * @param options\r\n   */\r\n  public moveTo(options: MoveToOptions): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPosOrOptions: number | Vector | MoveToOptions, yOrSpeed?: number, speedOrUndefined?: number): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let speed = 0;\r\n    if (xOrPosOrOptions instanceof Vector) {\r\n      x = xOrPosOrOptions.x;\r\n      y = xOrPosOrOptions.y;\r\n      speed = +(yOrSpeed ?? 0);\r\n      this._queue.add(new MoveTo(this._entity, x, y, speed));\r\n    } else if (typeof xOrPosOrOptions === 'number' && typeof yOrSpeed === 'number' && typeof speedOrUndefined === 'number') {\r\n      x = xOrPosOrOptions;\r\n      y = yOrSpeed;\r\n      speed = speedOrUndefined;\r\n      this._queue.add(new MoveTo(this._entity, x, y, speed));\r\n    } else if (isMoveToOptions(xOrPosOrOptions)) {\r\n      this._queue.add(new MoveToWithOptions(this._entity, xOrPosOrOptions));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Moves an actor by a specified offset {@link Vector} in a given duration in milliseconds.\r\n   * You may optionally specify an {@link EasingFunction}\r\n   * @param options\r\n   */\r\n  public moveBy(options: MoveByOptions): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(\r\n    xOffsetOrVectorOrOptions: number | Vector | MoveByOptions,\r\n    yOffsetOrSpeed?: number,\r\n    speedOrUndefined?: number\r\n  ): ActionContext {\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    let speed = 0;\r\n    if (xOffsetOrVectorOrOptions instanceof Vector && typeof yOffsetOrSpeed === 'number') {\r\n      xOffset = xOffsetOrVectorOrOptions.x;\r\n      yOffset = xOffsetOrVectorOrOptions.y;\r\n      speed = yOffsetOrSpeed;\r\n      this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\r\n    } else if (typeof xOffsetOrVectorOrOptions === 'number' && typeof yOffsetOrSpeed === 'number' && typeof speedOrUndefined === 'number') {\r\n      xOffset = xOffsetOrVectorOrOptions;\r\n      yOffset = yOffsetOrSpeed;\r\n      speed = speedOrUndefined;\r\n      this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\r\n    } else if (isMoveByOptions(xOffsetOrVectorOrOptions)) {\r\n      this._queue.add(new MoveByWithOptions(this._entity, xOffsetOrVectorOrOptions));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Rotates an actor to a specified angle over a duration in milliseconds,\r\n   * you make pick a rotation strategy {@link RotationType} to pick the direction\r\n   * @param options\r\n   */\r\n  public rotateTo(options: RotateToOptions): ActionContext;\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angle  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The {@apilink RotationType} to use for this rotation\r\n   */\r\n  public rotateTo(angle: number, speed: number, rotationType?: RotationType): ActionContext;\r\n  public rotateTo(angleRadiansOrOptions: number | RotateToOptions, speed?: number, rotationType?: RotationType): ActionContext {\r\n    if (typeof angleRadiansOrOptions === 'number' && typeof speed === 'number') {\r\n      this._queue.add(new RotateTo(this._entity, angleRadiansOrOptions, speed, rotationType));\r\n    } else if (typeof angleRadiansOrOptions === 'object') {\r\n      this._queue.add(new RotateToWithOptions(this._entity, angleRadiansOrOptions));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Rotates an actor by a specified offset angle over a duration in milliseconds,\r\n   * you make pick a rotation strategy {@link RotationType} to pick the direction\r\n   * @param options\r\n   */\r\n  public rotateBy(options: RotateByOptions): ActionContext;\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The {@apilink RotationType} to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext;\r\n  public rotateBy(angleRadiansOffsetOrOptions: number | RotateByOptions, speed?: number, rotationType?: RotationType): ActionContext {\r\n    if (typeof angleRadiansOffsetOrOptions === 'object') {\r\n      this._queue.add(new RotateByWithOptions(this._entity, angleRadiansOffsetOrOptions));\r\n    } else {\r\n      this._queue.add(new RotateBy(this._entity, angleRadiansOffsetOrOptions, speed as number, rotationType));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales an actor to a specified scale {@link Vector} over a duration in milliseconds\r\n   * @param options\r\n   */\r\n  public scaleTo(options: ScaleToOptions): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(\r\n    sizeXOrVectorOrOptions: number | Vector | ScaleToOptions,\r\n    sizeYOrSpeed?: number | Vector,\r\n    speedXOrUndefined?: number | undefined,\r\n    speedYOrUndefined?: number | undefined\r\n  ): ActionContext {\r\n    let sizeX = 1;\r\n    let sizeY = 1;\r\n    let speedX = 0;\r\n    let speedY = 0;\r\n\r\n    if (isScaleToOptions(sizeXOrVectorOrOptions)) {\r\n      this._queue.add(new ScaleToWithOptions(this._entity, sizeXOrVectorOrOptions));\r\n      return this;\r\n    }\r\n\r\n    if (sizeXOrVectorOrOptions instanceof Vector && sizeYOrSpeed instanceof Vector) {\r\n      sizeX = sizeXOrVectorOrOptions.x;\r\n      sizeY = sizeXOrVectorOrOptions.y;\r\n\r\n      speedX = sizeYOrSpeed.x;\r\n      speedY = sizeYOrSpeed.y;\r\n    }\r\n    if (typeof sizeXOrVectorOrOptions === 'number' && typeof sizeYOrSpeed === 'number') {\r\n      sizeX = sizeXOrVectorOrOptions;\r\n      sizeY = sizeYOrSpeed;\r\n\r\n      speedX = speedXOrUndefined as any;\r\n      speedY = speedYOrUndefined as any;\r\n    }\r\n\r\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales an actor by a specified scale offset {@link Vector} over a duration in milliseconds\r\n   * @param options\r\n   */\r\n  public scaleBy(options: ScaleByOptions): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(\r\n    sizeOffsetXOrVectorOrOptions: number | Vector | ScaleByOptions,\r\n    sizeOffsetYOrSpeed?: number,\r\n    speed?: number | undefined\r\n  ): ActionContext {\r\n    if (isScaleByOptions(sizeOffsetXOrVectorOrOptions)) {\r\n      this._queue.add(new ScaleByWithOptions(this._entity, sizeOffsetXOrVectorOrOptions));\r\n      return this;\r\n    }\r\n    let sizeOffsetX = 1;\r\n    let sizeOffsetY = 1;\r\n\r\n    if (sizeOffsetXOrVectorOrOptions instanceof Vector) {\r\n      sizeOffsetX = sizeOffsetXOrVectorOrOptions.x;\r\n      sizeOffsetY = sizeOffsetXOrVectorOrOptions.y;\r\n\r\n      speed = sizeOffsetYOrSpeed;\r\n    }\r\n    if (typeof sizeOffsetXOrVectorOrOptions === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\r\n      sizeOffsetX = sizeOffsetXOrVectorOrOptions;\r\n      sizeOffsetY = sizeOffsetYOrSpeed;\r\n    }\r\n\r\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed as any));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\r\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param duration     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, duration: number): ActionContext {\r\n    this._queue.add(new Fade(this._entity, opacity, duration));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This will cause an actor to flash a specific color for a period of time\r\n   * @param color\r\n   * @param duration The duration in milliseconds\r\n   */\r\n  public flash(color: Color, duration: number = 1000) {\r\n    this._queue.add(new Flash(this._entity, color, duration));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param duration  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(duration: number): ActionContext {\r\n    this._queue.add(new Delay(duration));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    this._queue.add(new Die(this._entity));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    this._queue.add(new CallMethod(method));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   * repeatCtx.moveBy(10, 0, 10);\r\n   * repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    if (!times) {\r\n      this.repeatForever(repeatBuilder);\r\n      return this;\r\n    }\r\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   * repeatCtx.moveBy(10, 0, 10);\r\n   * repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Entity, followDistance?: number): ActionContext {\r\n    if (followDistance === undefined) {\r\n      this._queue.add(new Follow(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Follow(this._entity, entity, followDistance));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Entity, speed?: number): ActionContext {\r\n    if (speed === undefined) {\r\n      this._queue.add(new Meet(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Meet(this._entity, entity, speed));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    const temp = new Promise<void>((resolve) => {\r\n      this._queue.add(\r\n        new CallMethod(() => {\r\n          resolve();\r\n        })\r\n      );\r\n    });\r\n    return temp;\r\n  }\r\n}\r\n","import { ActionContext } from './ActionContext';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Actor } from '../Actor';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Vector, RotationType } from '../Math';\r\nimport { EasingFunction } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Action } from './Action';\r\nimport { Color } from '../Color';\r\nimport { CurveToOptions } from './Action/CurveTo';\r\nimport { CurveByOptions } from './Action/CurveBy';\r\nimport { MoveToOptions } from './Action/MoveTo';\r\nimport { MoveByOptions, RotateByOptions, RotateToOptions, ScaleByOptions, ScaleToOptions } from './index';\r\n\r\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> {}\r\n\r\nexport class ActionsComponent extends Component implements ActionContextMethods {\r\n  dependencies = [TransformComponent, MotionComponent];\r\n  private _ctx: ActionContext | null = null;\r\n\r\n  onAdd(entity: Entity) {\r\n    this._ctx = new ActionContext(entity);\r\n  }\r\n\r\n  onRemove() {\r\n    this._ctx = null;\r\n  }\r\n\r\n  private _getCtx() {\r\n    if (!this._ctx) {\r\n      throw new Error('Actions component not attached to an entity, no context available');\r\n    }\r\n    return this._ctx;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal action queue\r\n   * @returns action queue\r\n   */\r\n  public getQueue(): ActionQueue {\r\n    if (!this._ctx) {\r\n      throw new Error('Actions component not attached to an entity, no queue available');\r\n    }\r\n    return this._ctx.getQueue();\r\n  }\r\n\r\n  /**\r\n   * Runs a specific action in the action queue\r\n   * @param action\r\n   */\r\n  public runAction(action: Action): ActionContext {\r\n    if (!this._ctx) {\r\n      throw new Error('Actions component not attached to an entity, cannot run action');\r\n    }\r\n    return this._ctx.runAction(action);\r\n  }\r\n\r\n  /**\r\n   * Updates the internal action context, performing action and moving through the internal queue\r\n   * @param elapsed\r\n   */\r\n  public update(elapsed: number): void {\r\n    return this._ctx?.update(elapsed);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._ctx?.clearActions();\r\n  }\r\n\r\n  /**\r\n   * Animates an actor with a specified bezier curve by an offset to the current position, the start point is assumed\r\n   * to be the actors current position\r\n   * @param options\r\n   */\r\n  public curveBy(options: CurveByOptions): ActionContext {\r\n    return this._getCtx().curveBy.apply(this._ctx, [options]);\r\n  }\r\n\r\n  /**\r\n   * Animates an actor with a specified bezier curve to an absolute world space coordinate, the start point is assumed\r\n   * to be the actors current position\r\n   * @param options\r\n   */\r\n  public curveTo(options: CurveToOptions): ActionContext {\r\n    return this._getCtx().curveTo.apply(this._ctx, [options]);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given {@apilink EasingFunctions} and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunctions} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given {@apilink EasingFunctions} and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use {@apilink EasingFunctions} or a custom function to use to calculate position, Default is {@apilink EasingFunctions.Linear}\r\n   * @deprecated use new moveTo({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeTo(...args: any[]): ActionContext {\r\n    return this._getCtx().easeTo.apply(this._ctx, args as any);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param offset\r\n   * @param duration\r\n   * @param easingFcn\r\n   * @deprecated use new moveBy({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeBy(offset: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   *\r\n   * @param offsetX\r\n   * @param offsetY\r\n   * @param duration\r\n   * @param easingFcn\r\n   * @deprecated use new moveBy({pos: Vector, duration: number, easing: EasingFunction})\r\n   */\r\n  public easeBy(offsetX: number, offsetY: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeBy(...args: any[]): ActionContext {\r\n    return this._getCtx().easeBy.apply(this._ctx, args as any);\r\n  }\r\n\r\n  /**\r\n   * Moves an actor to a specified {@link Vector} in a given duration in milliseconds.\r\n   * You may optionally specify an {@link EasingFunction}\r\n   * @param options\r\n   */\r\n  public moveTo(options: MoveToOptions): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPosOrOptions: number | Vector | MoveToOptions, yOrSpeed?: number, speedOrUndefined?: number): ActionContext {\r\n    return this._getCtx().moveTo.apply(this._ctx, [xOrPosOrOptions, yOrSpeed, speedOrUndefined] as any);\r\n  }\r\n\r\n  /**\r\n   * Moves an actor by a specified offset {@link Vector} in a given duration in milliseconds.\r\n   * You may optionally specify an {@link EasingFunction}\r\n   * @param options\r\n   */\r\n  public moveBy(options: MoveByOptions): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset The (x, y) offset to apply to this actor\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(\r\n    xOffsetOrVectorOptions: number | Vector | MoveByOptions,\r\n    yOffsetOrSpeed?: number,\r\n    speedOrUndefined?: number\r\n  ): ActionContext {\r\n    return this._getCtx().moveBy.apply(this._ctx, [xOffsetOrVectorOptions, yOffsetOrSpeed, speedOrUndefined] as any);\r\n  }\r\n\r\n  /**\r\n   * Rotates an actor to a specified angle over a duration in milliseconds,\r\n   * you make pick a rotation strategy {@link RotationType} to pick the direction\r\n   * @param options\r\n   */\r\n  public rotateTo(options: RotateToOptions): ActionContext;\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angle  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The {@apilink RotationType} to use for this rotation\r\n   */\r\n  public rotateTo(angle: number, speed: number, rotationType?: RotationType): ActionContext;\r\n  public rotateTo(angle: number | RotateToOptions, speed?: number, rotationType?: RotationType): ActionContext {\r\n    return this._getCtx().rotateTo.apply(this._ctx, [angle, speed, rotationType] as any);\r\n  }\r\n\r\n  /**\r\n   * Rotates an actor by a specified offset angle over a duration in milliseconds,\r\n   * you make pick a rotation strategy {@link RotationType} to pick the direction\r\n   * @param options\r\n   */\r\n  public rotateBy(options: RotateByOptions): ActionContext;\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The {@apilink RotationType} to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext;\r\n  public rotateBy(angleRadiansOffsetOrOptions: number | RotateByOptions, speed?: number, rotationType?: RotationType): ActionContext {\r\n    return this._getCtx().rotateBy.apply(this._ctx, [angleRadiansOffsetOrOptions, speed, rotationType] as any);\r\n  }\r\n\r\n  /**\r\n   * Scales an actor to a specified scale {@link Vector} over a duration\r\n   * @param options\r\n   */\r\n  public scaleTo(options: ScaleToOptions): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(\r\n    sizeXOrVectorOrOptions: number | Vector | ScaleToOptions,\r\n    sizeYOrSpeed?: number | Vector,\r\n    speedXOrUndefined?: number,\r\n    speedYOrUndefined?: number\r\n  ): ActionContext {\r\n    return this._getCtx().scaleTo.apply(this._ctx, [sizeXOrVectorOrOptions, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined] as any);\r\n  }\r\n\r\n  /**\r\n   * Scales an actor by a specified scale offset {@link Vector} over a duration in milliseconds\r\n   * @param options\r\n   */\r\n  public scaleBy(options: ScaleByOptions): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(\r\n    sizeOffsetXOrVectorOrOptions: number | Vector | ScaleByOptions,\r\n    sizeOffsetYOrSpeed?: number,\r\n    speed?: number\r\n  ): ActionContext {\r\n    return this._getCtx().scaleBy.apply(this._ctx, [sizeOffsetXOrVectorOrOptions, sizeOffsetYOrSpeed, speed] as any);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\r\n    return this._getCtx().blink(timeVisible, timeNotVisible, numBlinks);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param duration     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, duration: number): ActionContext {\r\n    return this._getCtx().fade(opacity, duration);\r\n  }\r\n\r\n  /**\r\n   * This will cause an actor to flash a specific color for a period of time\r\n   * @param color\r\n   * @param duration The duration in milliseconds\r\n   */\r\n  public flash(color: Color, duration: number = 1000) {\r\n    return this._getCtx().flash(color, duration);\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param duration  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(duration: number): ActionContext {\r\n    return this._getCtx().delay(duration);\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    return this._getCtx().die();\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    return this._getCtx().callMethod(method);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   * repeatCtx.moveBy(10, 0, 10);\r\n   * repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    return this._getCtx().repeat(repeatBuilder, times);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   * repeatCtx.moveBy(10, 0, 10);\r\n   * repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    return this._getCtx().repeatForever(repeatBuilder);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Actor, followDistance?: number): ActionContext {\r\n    return this._getCtx().follow(entity, followDistance);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Actor, speed?: number): ActionContext {\r\n    return this._getCtx().meet(entity, speed);\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    return this._getCtx().toPromise();\r\n  }\r\n}\r\n","import {\r\n  KillEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PostCollisionEvent,\r\n  PreCollisionEvent,\r\n  CollisionStartEvent,\r\n  CollisionEndEvent,\r\n  PostKillEvent,\r\n  PreKillEvent,\r\n  EnterViewPortEvent,\r\n  ExitViewPortEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  ActionStartEvent,\r\n  ActionCompleteEvent\r\n} from './Events';\r\nimport { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { CanInitialize, CanUpdate, CanBeKilled } from './Interfaces/LifecycleEvents';\r\nimport { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { Eventable } from './Interfaces/Evented';\r\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\nimport { Entity, EntityEvents } from './EntityComponentSystem/Entity';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Rectangle } from './Graphics/Rectangle';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { watch } from './Util/Watch';\r\nimport { Collider, CollisionContact, CollisionGroup, Side } from './Collision/Index';\r\nimport { Circle } from './Graphics/Circle';\r\nimport { PointerEvent } from './Input/PointerEvent';\r\nimport { WheelEvent } from './Input/WheelEvent';\r\nimport { PointerComponent } from './Input/PointerComponent';\r\nimport { ActionsComponent } from './Actions/ActionsComponent';\r\nimport { CoordPlane } from './Math/coord-plane';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from './EventEmitter';\r\nimport { Component } from './EntityComponentSystem';\r\n\r\n/**\r\n * Type guard for checking if something is an Actor\r\n * @param x\r\n */\r\nexport function isActor(x: any): x is Actor {\r\n  return x instanceof Actor;\r\n}\r\n\r\n/**\r\n * Actor constructor options\r\n */\r\nexport type ActorArgs = ColliderArgs & {\r\n  /**\r\n   * Optionally set the name of the actor, default is 'anonymous'\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally set the x position of the actor, default is 0\r\n   */\r\n  x?: number;\r\n  /**\r\n   * Optionally set the y position of the actor, default is 0\r\n   */\r\n  y?: number;\r\n  /**\r\n   * Optionally set the (x, y) position of the actor as a vector, default is (0, 0)\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally set the coordinate plane of the actor, default is {@apilink CoordPlane.World} meaning actor is subject to camera positioning\r\n   */\r\n  coordPlane?: CoordPlane;\r\n  /**\r\n   * Optionally set the velocity of the actor in pixels/sec\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Optionally set the acceleration of the actor in pixels/sec^2\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Optionally set the scale of the actor's transform\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * Optionally set the z index of the actor, default is 0\r\n   */\r\n  z?: number;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  opacity?: number;\r\n  /**\r\n   * Optionally set the visibility of the actor\r\n   */\r\n  visible?: boolean;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  anchor?: Vector;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Optionally set the collision type\r\n   */\r\n  collisionType?: CollisionType;\r\n\r\n  /**\r\n   * Optionally supply a {@apilink CollisionGroup}\r\n   */\r\n  collisionGroup?: CollisionGroup;\r\n\r\n  /**\r\n   * Optionally silence excalibur warning warnings\r\n   */\r\n  silenceWarnings?: boolean;\r\n};\r\n\r\ntype ColliderArgs =\r\n  | // custom collider\r\n  {\r\n      /**\r\n       * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\r\n       */\r\n      collider?: Collider;\r\n\r\n      width?: undefined;\r\n      height?: undefined;\r\n      radius?: undefined;\r\n    }\r\n  // box collider\r\n  | {\r\n      /**\r\n       * Optionally set the width of a box collider for the actor\r\n       */\r\n      width?: number;\r\n      /**\r\n       * Optionally set the height of a box collider for the actor\r\n       */\r\n      height?: number;\r\n\r\n      collider?: undefined;\r\n      radius?: undefined;\r\n    }\r\n  // circle collider\r\n  | {\r\n      /**\r\n       * Optionally set the radius of the circle collider for the actor\r\n       */\r\n      radius?: number;\r\n\r\n      collider?: undefined;\r\n      width?: undefined;\r\n      height?: undefined;\r\n    };\r\n\r\nexport type ActorEvents = EntityEvents & {\r\n  collisionstart: CollisionStartEvent;\r\n  collisionend: CollisionEndEvent;\r\n  precollision: PreCollisionEvent;\r\n  postcollision: PostCollisionEvent;\r\n  kill: KillEvent;\r\n  prekill: PreKillEvent;\r\n  postkill: PostKillEvent;\r\n  predraw: PreDrawEvent;\r\n  postdraw: PostDrawEvent;\r\n  pretransformdraw: PreDrawEvent;\r\n  posttransformdraw: PostDrawEvent;\r\n  predebugdraw: PreDebugDrawEvent;\r\n  postdebugdraw: PostDebugDrawEvent;\r\n  pointerup: PointerEvent;\r\n  pointerdown: PointerEvent;\r\n  pointerenter: PointerEvent;\r\n  pointerleave: PointerEvent;\r\n  pointermove: PointerEvent;\r\n  pointercancel: PointerEvent;\r\n  pointerwheel: WheelEvent;\r\n  pointerdragstart: PointerEvent;\r\n  pointerdragend: PointerEvent;\r\n  pointerdragenter: PointerEvent;\r\n  pointerdragleave: PointerEvent;\r\n  pointerdragmove: PointerEvent;\r\n  enterviewport: EnterViewPortEvent;\r\n  exitviewport: ExitViewPortEvent;\r\n  actionstart: ActionStartEvent;\r\n  actioncomplete: ActionCompleteEvent;\r\n};\r\n\r\nexport const ActorEvents = {\r\n  CollisionStart: 'collisionstart',\r\n  CollisionEnd: 'collisionend',\r\n  PreCollision: 'precollision',\r\n  PostCollision: 'postcollision',\r\n  Kill: 'kill',\r\n  PreKill: 'prekill',\r\n  PostKill: 'postkill',\r\n  PreDraw: 'predraw',\r\n  PostDraw: 'postdraw',\r\n  PreTransformDraw: 'pretransformdraw',\r\n  PostTransformDraw: 'posttransformdraw',\r\n  PreDebugDraw: 'predebugdraw',\r\n  PostDebugDraw: 'postdebugdraw',\r\n  PointerUp: 'pointerup',\r\n  PointerDown: 'pointerdown',\r\n  PointerEnter: 'pointerenter',\r\n  PointerLeave: 'pointerleave',\r\n  PointerMove: 'pointermove',\r\n  PointerCancel: 'pointercancel',\r\n  Wheel: 'pointerwheel',\r\n  PointerDrag: 'pointerdragstart',\r\n  PointerDragEnd: 'pointerdragend',\r\n  PointerDragEnter: 'pointerdragenter',\r\n  PointerDragLeave: 'pointerdragleave',\r\n  PointerDragMove: 'pointerdragmove',\r\n  EnterViewPort: 'enterviewport',\r\n  ExitViewPort: 'exitviewport',\r\n  ActionStart: 'actionstart',\r\n  ActionComplete: 'actioncomplete'\r\n};\r\n\r\n/**\r\n * The most important primitive in Excalibur is an `Actor`. Anything that\r\n * can move on the screen, collide with another `Actor`, respond to events,\r\n * or interact with the current scene, must be an actor. An `Actor` **must**\r\n * be part of a {@apilink Scene} for it to be drawn to the screen.\r\n */\r\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanBeKilled {\r\n  public events = new EventEmitter<ActorEvents>();\r\n  // #region Properties\r\n\r\n  /**\r\n   * Set defaults for all Actors\r\n   */\r\n  public static defaults = {\r\n    anchor: Vector.Half\r\n  };\r\n\r\n  /**\r\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\r\n   * acceleration, mass, inertia, etc.\r\n   */\r\n  public body: BodyComponent;\r\n\r\n  /**\r\n   * Access the Actor's built in {@apilink TransformComponent}\r\n   */\r\n  public transform: TransformComponent;\r\n\r\n  /**\r\n   * Access the Actor's built in {@apilink MotionComponent}\r\n   */\r\n  public motion: MotionComponent;\r\n\r\n  /**\r\n   * Access to the Actor's built in {@apilink GraphicsComponent}\r\n   */\r\n  public graphics: GraphicsComponent;\r\n\r\n  /**\r\n   * Access to the Actor's built in {@apilink ColliderComponent}\r\n   */\r\n  public collider: ColliderComponent;\r\n\r\n  /**\r\n   * Access to the Actor's built in {@apilink PointerComponent} config\r\n   */\r\n  public pointer: PointerComponent;\r\n\r\n  /**\r\n   * Useful for quickly scripting actor behavior, like moving to a place, patrolling back and forth, blinking, etc.\r\n   *\r\n   *  Access to the Actor's built in {@apilink ActionsComponent} which forwards to the\r\n   * {@apilink ActionContext | `Action context`} of the actor.\r\n   */\r\n  public actions: ActionsComponent;\r\n  private _silenceWarnings: boolean;\r\n\r\n  /**\r\n   * Gets the position vector of the actor in pixels\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in pixels\r\n   */\r\n  public set pos(thePos: Vector) {\r\n    this.transform.pos = thePos.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor from the last frame\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.body.oldPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global position vector of the actor from the last frame\r\n   */\r\n  public get oldGlobalPos(): Vector {\r\n    return this.body.oldGlobalPos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in the last frame\r\n   */\r\n  public set oldPos(thePos: Vector) {\r\n    this.body.oldPos.setTo(thePos.x, thePos.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public set vel(theVel: Vector) {\r\n    this.motion.vel = theVel.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor from the last frame\r\n   */\r\n  public get oldVel(): Vector {\r\n    return this.body.oldVel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor from the last frame\r\n   */\r\n  public set oldVel(theVel: Vector) {\r\n    this.body.oldVel.setTo(theVel.x, theVel.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\r\n   * useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration vector of teh actor in pixels/second/second\r\n   */\r\n  public set acc(theAcc: Vector) {\r\n    this.motion.acc = theAcc.clone();\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\r\n   */\r\n  public set oldAcc(theAcc: Vector) {\r\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc {@apilink Physics.acc}.\r\n   */\r\n  public get oldAcc(): Vector {\r\n    return this.body.oldAcc;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public get rotation(): number {\r\n    return this.transform.rotation;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public set rotation(theAngle: number) {\r\n    this.transform.rotation = theAngle;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotational velocity of the actor in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotational velocity of the actor in radians/sec\r\n   */\r\n  public set angularVelocity(angularVelocity: number) {\r\n    this.motion.angularVelocity = angularVelocity;\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this.get(TransformComponent).scale;\r\n  }\r\n\r\n  public set scale(scale: Vector) {\r\n    this.get(TransformComponent).scale = scale;\r\n  }\r\n\r\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\r\n  /**\r\n   * The anchor to apply all actor related transformations like rotation,\r\n   * translation, and scaling. By default the anchor is in the center of\r\n   * the actor. By default it is set to the center of the actor (.5, .5)\r\n   *\r\n   * An anchor of (.5, .5) will ensure that drawings are centered.\r\n   *\r\n   * Use `anchor.setTo` to set the anchor to a different point using\r\n   * values between 0 and 1. For example, anchoring to the top-left would be\r\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\r\n   */\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n\r\n  public set anchor(vec: Vector) {\r\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\r\n    this._handleAnchorChange(vec);\r\n  }\r\n\r\n  private _handleAnchorChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.anchor = v;\r\n    }\r\n  }\r\n\r\n  private _offset: Vector = watch(Vector.Zero, (v) => this._handleOffsetChange(v));\r\n  /**\r\n   * The offset in pixels to apply to all actor graphics\r\n   *\r\n   * Default offset of (0, 0)\r\n   */\r\n  public get offset(): Vector {\r\n    return this._offset;\r\n  }\r\n\r\n  public set offset(vec: Vector) {\r\n    this._offset = watch(vec, (v) => this._handleOffsetChange(v));\r\n    this._handleOffsetChange(vec);\r\n  }\r\n\r\n  private _handleOffsetChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.offset = v;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the actor is physically in the viewport\r\n   */\r\n  public get isOffScreen(): boolean {\r\n    return this.hasTag('ex.offscreen');\r\n  }\r\n\r\n  /**\r\n   * Convenience reference to the global logger\r\n   */\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * Draggable helper\r\n   */\r\n  private _draggable: boolean = false;\r\n  private _dragging: boolean = false;\r\n\r\n  private _pointerDragStartHandler = () => {\r\n    this._dragging = true;\r\n  };\r\n\r\n  private _pointerDragEndHandler = () => {\r\n    this._dragging = false;\r\n  };\r\n\r\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.worldPos;\r\n    }\r\n  };\r\n\r\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.worldPos;\r\n    }\r\n  };\r\n\r\n  public get draggable(): boolean {\r\n    return this._draggable;\r\n  }\r\n\r\n  public set draggable(isDraggable: boolean) {\r\n    if (isDraggable) {\r\n      if (isDraggable && !this._draggable) {\r\n        this.events.on('pointerdragstart', this._pointerDragStartHandler);\r\n        this.events.on('pointerdragend', this._pointerDragEndHandler);\r\n        this.events.on('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.events.on('pointerdragleave', this._pointerDragLeaveHandler);\r\n      } else if (!isDraggable && this._draggable) {\r\n        this.events.off('pointerdragstart', this._pointerDragStartHandler);\r\n        this.events.off('pointerdragend', this._pointerDragEndHandler);\r\n        this.events.off('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.events.off('pointerdragleave', this._pointerDragLeaveHandler);\r\n      }\r\n\r\n      this._draggable = isDraggable;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the color of the actor's current graphic\r\n   */\r\n  public get color(): Color {\r\n    return this.graphics.color;\r\n  }\r\n  public set color(v: Color) {\r\n    this.graphics.color = v;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   *\r\n   * @param config\r\n   */\r\n  constructor(config?: ActorArgs) {\r\n    super();\r\n\r\n    const {\r\n      name,\r\n      x,\r\n      y,\r\n      pos,\r\n      coordPlane,\r\n      scale,\r\n      width,\r\n      height,\r\n      radius,\r\n      collider,\r\n      vel,\r\n      acc,\r\n      rotation,\r\n      angularVelocity,\r\n      z,\r\n      color,\r\n      visible,\r\n      opacity,\r\n      anchor,\r\n      offset,\r\n      collisionType,\r\n      collisionGroup,\r\n      silenceWarnings\r\n    } = {\r\n      ...config\r\n    };\r\n\r\n    this.name = name ?? this.name;\r\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\r\n    this.offset = offset ?? Vector.Zero;\r\n    this.transform = new TransformComponent();\r\n    this.addComponent(this.transform);\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.rotation = rotation ?? 0;\r\n    this.scale = scale ?? vec(1, 1);\r\n    this.z = z ?? 0;\r\n    this.transform.coordPlane = coordPlane ?? CoordPlane.World;\r\n    this._silenceWarnings = silenceWarnings ?? false;\r\n\r\n    this.pointer = new PointerComponent();\r\n    this.addComponent(this.pointer);\r\n\r\n    this.graphics = new GraphicsComponent({\r\n      anchor: this.anchor,\r\n      offset: this.offset,\r\n      opacity: opacity\r\n    });\r\n    this.addComponent(this.graphics);\r\n\r\n    this.motion = new MotionComponent();\r\n    this.addComponent(this.motion);\r\n    this.vel = vel ?? Vector.Zero;\r\n    this.acc = acc ?? Vector.Zero;\r\n    this.angularVelocity = angularVelocity ?? 0;\r\n\r\n    this.actions = new ActionsComponent();\r\n    this.addComponent(this.actions);\r\n\r\n    this.body = new BodyComponent();\r\n    this.addComponent(this.body);\r\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\r\n    if (collisionGroup) {\r\n      this.body.group = collisionGroup;\r\n    }\r\n\r\n    if (color) {\r\n      this.color = color;\r\n    }\r\n\r\n    if (collider) {\r\n      this.collider = new ColliderComponent(collider);\r\n      this.addComponent(this.collider);\r\n    } else if (radius) {\r\n      this.collider = new ColliderComponent(Shape.Circle(radius));\r\n      this.addComponent(this.collider);\r\n\r\n      if (color) {\r\n        this.graphics.add(\r\n          new Circle({\r\n            color: color,\r\n            radius\r\n          })\r\n        );\r\n      }\r\n    } else {\r\n      if (width > 0 && height > 0) {\r\n        this.collider = new ColliderComponent(Shape.Box(width, height, this.anchor));\r\n        this.addComponent(this.collider);\r\n\r\n        if (color && width && height) {\r\n          this.graphics.add(\r\n            new Rectangle({\r\n              color: color,\r\n              width,\r\n              height\r\n            })\r\n          );\r\n        }\r\n      } else {\r\n        this.collider = new ColliderComponent();\r\n        this.addComponent(this.collider); // no collider\r\n      }\r\n    }\r\n\r\n    this.graphics.isVisible = visible ?? true;\r\n  }\r\n\r\n  public clone(): Actor {\r\n    const clone = new Actor({\r\n      silenceWarnings: this._silenceWarnings,\r\n      color: this.color.clone(),\r\n      anchor: this.anchor.clone(),\r\n      offset: this.offset.clone()\r\n    });\r\n    clone.clearComponents();\r\n    clone.processComponentRemoval();\r\n\r\n    // Clone builtins, order is important, same as ctor\r\n    clone.addComponent((clone.transform = this.transform.clone() as TransformComponent), true);\r\n    clone.addComponent((clone.pointer = this.pointer.clone() as PointerComponent), true);\r\n    clone.addComponent((clone.graphics = this.graphics.clone() as GraphicsComponent), true);\r\n    clone.addComponent((clone.motion = this.motion.clone() as MotionComponent), true);\r\n    clone.addComponent((clone.actions = this.actions.clone() as ActionsComponent), true);\r\n    clone.addComponent((clone.body = this.body.clone() as BodyComponent), true);\r\n    clone.addComponent((clone.collider = this.collider.clone() as ColliderComponent), true);\r\n\r\n    const builtInComponents: Component[] = [\r\n      this.transform,\r\n      this.pointer,\r\n      this.graphics,\r\n      this.motion,\r\n      this.actions,\r\n      this.body,\r\n      this.collider\r\n    ];\r\n\r\n    // Clone non-builtin the current actors components\r\n    const components = this.getComponents();\r\n    for (const c of components) {\r\n      if (!builtInComponents.includes(c)) {\r\n        clone.addComponent(c.clone(), true);\r\n      }\r\n    }\r\n    return clone;\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    for (const child of this.children) {\r\n      child._initialize(engine);\r\n    }\r\n  }\r\n\r\n  // #region Events\r\n  public emit<TEventName extends EventKey<ActorEvents>>(eventName: TEventName, event: ActorEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<ActorEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<ActorEvents>>(eventName: TEventName, handler: Handler<ActorEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<ActorEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<ActorEvents>>(eventName: TEventName, handler: Handler<ActorEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<ActorEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<ActorEvents>>(eventName: TEventName, handler: Handler<ActorEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<ActorEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for {@apilink onPreKill} lifecycle event\r\n   * @internal\r\n   */\r\n  public _prekill(scene: Scene) {\r\n    this.events.emit('prekill', new PreKillEvent(this));\r\n    this.onPreKill(scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\r\n   *\r\n   * `onPreKill` is called directly before an actor is killed and removed from its current {@apilink Scene}.\r\n   */\r\n  public onPreKill(scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for {@apilink onPostKill} lifecycle event\r\n   * @internal\r\n   */\r\n  public _postkill(scene: Scene) {\r\n    this.events.emit('postkill', new PostKillEvent(this));\r\n    this.onPostKill(scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\r\n   *\r\n   * `onPostKill` is called directly after an actor is killed and remove from its current {@apilink Scene}.\r\n   */\r\n  public onPostKill(scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If the current actor is a member of the scene, this will remove\r\n   * it from the scene graph. It will no longer be drawn or updated.\r\n   */\r\n  public kill() {\r\n    if (this.scene) {\r\n      this._prekill(this.scene);\r\n      this.events.emit('kill', new KillEvent(this));\r\n      super.kill();\r\n      this._postkill(this.scene);\r\n    } else {\r\n      this.logger.warn(`Cannot kill actor named \"${this.name}\", it was never added to the Scene`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the current actor is killed, it will now not be killed.\r\n   */\r\n  public unkill() {\r\n    this.isActive = true;\r\n  }\r\n\r\n  /**\r\n   * Indicates wether the actor has been killed.\r\n   */\r\n  public isKilled(): boolean {\r\n    return !this.isActive;\r\n  }\r\n\r\n  /**\r\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   */\r\n  public get z(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\r\n   * The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   * @param newZ new z-index to assign\r\n   */\r\n  public set z(newZ: number) {\r\n    this.get(TransformComponent).z = newZ;\r\n  }\r\n\r\n  /**\r\n   * Get the center point of an actor (global position)\r\n   */\r\n  public get center(): Vector {\r\n    const globalPos = this.getGlobalPos();\r\n    return new Vector(\r\n      globalPos.x + this.width / 2 - this.anchor.x * this.width,\r\n      globalPos.y + this.height / 2 - this.anchor.y * this.height\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the local center point of an actor\r\n   */\r\n  public get localCenter(): Vector {\r\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  public get width() {\r\n    return this.collider.localBounds.width * this.getGlobalScale().x;\r\n  }\r\n\r\n  public get height() {\r\n    return this.collider.localBounds.height * this.getGlobalScale().y;\r\n  }\r\n\r\n  /**\r\n   * Gets this actor's rotation taking into account any parent relationships\r\n   * @returns Rotation angle in radians\r\n   * @deprecated Use {@apilink globalRotation} instead\r\n   */\r\n  public getGlobalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * The actor's rotation (in radians) taking into account any parent relationships\r\n   */\r\n  public get globalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   * @returns Position in world coordinates\r\n   * @deprecated Use {@apilink globalPos} instead\r\n   */\r\n  public getGlobalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * The actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   */\r\n  public get globalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global scale of the Actor\r\n   * @deprecated Use {@apilink globalScale} instead\r\n   */\r\n  public getGlobalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  /**\r\n   * The global scale of the Actor\r\n   */\r\n  public get globalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  /**\r\n   * The global z-index of the actor\r\n   */\r\n  public get globalZ(): number {\r\n    return this.get(TransformComponent).globalZ;\r\n  }\r\n\r\n  // #region Collision\r\n\r\n  /**\r\n   * Tests whether the x/y specified are contained in the actor\r\n   * @param x  X coordinate to test (in world coordinates)\r\n   * @param y  Y coordinate to test (in world coordinates)\r\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\r\n   */\r\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\r\n    const point = vec(x, y);\r\n    const collider = this.get(ColliderComponent);\r\n    collider.update();\r\n    const geom = collider.get();\r\n    if (!geom) {\r\n      return false;\r\n    }\r\n    const containment = geom.contains(point);\r\n\r\n    if (recurse) {\r\n      return (\r\n        containment ||\r\n        this.children.some((child: Actor) => {\r\n          return child.contains(x, y, true);\r\n        })\r\n      );\r\n    }\r\n\r\n    return containment;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\r\n   * @param actor     Actor to test\r\n   * @param distance  Distance in pixels to test\r\n   */\r\n  public within(actor: Actor, distance: number): boolean {\r\n    const collider = this.get(ColliderComponent);\r\n    const otherCollider = actor.get(ColliderComponent);\r\n    const me = collider.get();\r\n    const other = otherCollider.get();\r\n    if (me && other) {\r\n      return me.getClosestLineBetween(other).getLength() <= distance;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Update\r\n\r\n  /**\r\n   * Called by the Engine, updates the state of the actor\r\n   * @internal\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public update(engine: Engine, elapsed: number) {\r\n    this._initialize(engine);\r\n    this._add(engine);\r\n    this._preupdate(engine, elapsed);\r\n    this._postupdate(engine, elapsed);\r\n    this._remove(engine);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an actor is updated.\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an actor is updated.\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Fires before every collision resolution for a confirmed contact\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param contact\r\n   */\r\n  public onPreCollisionResolve(self: Collider, other: Collider, side: Side, contact: CollisionContact) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Fires after every resolution for a confirmed contact.\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param contact\r\n   */\r\n  public onPostCollisionResolve(self: Collider, other: Collider, side: Side, contact: CollisionContact) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Fires once when 2 entities with a ColliderComponent first start colliding or touching, if the Colliders stay in contact this\r\n   * does not continue firing until they separate and re-collide.\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param contact\r\n   */\r\n  public onCollisionStart(self: Collider, other: Collider, side: Side, contact: CollisionContact) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Fires once when 2 entities with a ColliderComponent separate after having been in contact.\r\n   * @param self\r\n   * @param other\r\n   * @param side\r\n   * @param lastContact\r\n   */\r\n  public onCollisionEnd(self: Collider, other: Collider, side: Side, lastContact: CollisionContact) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n    this.onPreUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n    this.onPostUpdate(engine, elapsed);\r\n  }\r\n\r\n  // endregion\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Engine } from './Engine';\r\nimport { Actor, ActorArgs } from './Actor';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { CoordPlane } from './Math/coord-plane';\r\n\r\n/**\r\n * Type guard to detect a screen element\r\n */\r\nexport function isScreenElement(actor: Actor) {\r\n  return actor instanceof ScreenElement;\r\n}\r\n\r\n/**\r\n * Helper {@apilink Actor} primitive for drawing UI's, optimized for UI drawing. Does\r\n * not participate in collisions. Drawn on top of all other actors.\r\n */\r\nexport class ScreenElement extends Actor {\r\n  protected _engine: Engine;\r\n\r\n  constructor();\r\n  constructor(config?: ActorArgs);\r\n\r\n  constructor(config?: ActorArgs) {\r\n    super({ ...config });\r\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\r\n    this.anchor = config?.anchor ?? vec(0, 0);\r\n    this.body.collisionType = config?.collisionType ?? CollisionType.PreventCollision;\r\n    this.pointer.useGraphicsBounds = true;\r\n    this.pointer.useColliderShape = false;\r\n    if (!config?.collider && config?.width > 0 && config?.height > 0) {\r\n      this.collider.useBoxCollider(this.width, this.height, this.anchor);\r\n    }\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    this._engine = engine;\r\n    super._initialize(engine);\r\n  }\r\n\r\n  public contains(x: number, y: number, useWorld: boolean = true) {\r\n    if (useWorld) {\r\n      return super.contains(x, y);\r\n    }\r\n\r\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\r\n    return super.contains(coords.x, coords.y);\r\n  }\r\n}\r\n","import { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport * as ex from './index';\r\nimport { Random } from './Math/Random';\r\n\r\nexport interface TimerOptions {\r\n  /**\r\n   * If true the timer repeats every interval infinitely\r\n   */\r\n  repeats?: boolean;\r\n  /**\r\n   * If a number is specified then it will only repeat a number of times\r\n   */\r\n  numberOfRepeats?: number;\r\n  /**\r\n   * @deprecated use action: () => void, will be removed in v1.0\r\n   */\r\n  fcn?: () => void;\r\n  /**\r\n   * Action to perform every time the timer fires\r\n   */\r\n  action?: () => void;\r\n  /**\r\n   * Interval in milliseconds for the timer to fire\r\n   */\r\n  interval: number;\r\n  /**\r\n   * Optionally specify a random range of milliseconds for the timer to fire\r\n   */\r\n  randomRange?: [number, number];\r\n  /**\r\n   * Optionally provide a random instance to use for random behavior, otherwise a new random will be created seeded from the current time.\r\n   */\r\n  random?: ex.Random;\r\n}\r\n\r\n/**\r\n * The Excalibur timer hooks into the internal timer and fires callbacks,\r\n * after a certain interval, optionally repeating.\r\n */\r\nexport class Timer {\r\n  private _logger = Logger.getInstance();\r\n  private static _MAX_ID: number = 0;\r\n  public id: number = 0;\r\n\r\n  private _elapsedTime: number = 0;\r\n  private _totalTimeAlive: number = 0;\r\n\r\n  private _running = false;\r\n\r\n  private _numberOfTicks: number = 0;\r\n  private _callbacks: Array<() => void>;\r\n\r\n  public interval: number = 10;\r\n  public repeats: boolean = false;\r\n  public maxNumberOfRepeats: number = -1;\r\n  public randomRange: [number, number] = [0, 0];\r\n  public random: ex.Random;\r\n  private _baseInterval = 10;\r\n  private _generateRandomInterval = () => {\r\n    return this._baseInterval + this.random.integer(this.randomRange[0], this.randomRange[1]);\r\n  };\r\n\r\n  private _complete = false;\r\n  public get complete() {\r\n    return this._complete;\r\n  }\r\n\r\n  public scene: Scene = null;\r\n\r\n  constructor(options: TimerOptions) {\r\n    const fcn = options.action ?? options.fcn;\r\n    const interval = options.interval;\r\n    const repeats = options.repeats;\r\n    const numberOfRepeats = options.numberOfRepeats;\r\n    const randomRange = options.randomRange;\r\n    const random = options.random;\r\n\r\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = numberOfRepeats;\r\n      if (!repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this.id = Timer._MAX_ID++;\r\n    this._callbacks = [];\r\n    this._baseInterval = this.interval = interval;\r\n    if (!!randomRange) {\r\n      if (randomRange[0] > randomRange[1]) {\r\n        throw new Error('min value must be lower than max value for range');\r\n      }\r\n      //We use the instance of ex.Random to generate the range\r\n      this.random = random ?? new Random();\r\n      this.randomRange = randomRange;\r\n\r\n      this.interval = this._generateRandomInterval();\r\n      this.on(() => {\r\n        this.interval = this._generateRandomInterval();\r\n      });\r\n    }\r\n    this.repeats = repeats || this.repeats;\r\n    if (fcn) {\r\n      this.on(fcn);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a new callback to be fired after the interval is complete\r\n   * @param action The callback to be added to the callback list, to be fired after the interval is complete.\r\n   */\r\n  public on(action: () => void) {\r\n    this._callbacks.push(action);\r\n  }\r\n\r\n  /**\r\n   * Removes a callback from the callback list to be fired after the interval is complete.\r\n   * @param action The callback to be removed from the callback list, to be fired after the interval is complete.\r\n   */\r\n  public off(action: () => void) {\r\n    const index = this._callbacks.indexOf(action);\r\n    this._callbacks.splice(index, 1);\r\n  }\r\n  /**\r\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\r\n   * @param elapsed  Number of elapsed milliseconds since the last update.\r\n   */\r\n  public update(elapsed: number) {\r\n    if (this._running) {\r\n      this._totalTimeAlive += elapsed;\r\n      this._elapsedTime += elapsed;\r\n\r\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\r\n        this._complete = true;\r\n        this._running = false;\r\n        this._elapsedTime = 0;\r\n      }\r\n\r\n      if (!this.complete && this._elapsedTime >= this.interval) {\r\n        this._callbacks.forEach((c) => {\r\n          c.call(this);\r\n        });\r\n        this._numberOfTicks++;\r\n        if (this.repeats) {\r\n          this._elapsedTime = 0;\r\n        } else {\r\n          this._complete = true;\r\n          this._running = false;\r\n          this._elapsedTime = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\r\n   *\r\n   * Warning** you may need to call `timer.start()` again if the timer had completed\r\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\r\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\r\n   */\r\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\r\n    if (!!newInterval && newInterval >= 0) {\r\n      this._baseInterval = this.interval = newInterval;\r\n    }\r\n\r\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = newNumberOfRepeats;\r\n      if (!this.repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this._complete = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n  }\r\n\r\n  public get timesRepeated(): number {\r\n    return this._numberOfTicks;\r\n  }\r\n\r\n  public getTimeRunning(): number {\r\n    return this._totalTimeAlive;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds until the next action callback, if complete will return 0\r\n   */\r\n  public get timeToNextAction() {\r\n    if (this.complete) {\r\n      return 0;\r\n    }\r\n    return this.interval - this._elapsedTime;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds elapsed toward the next action\r\n   */\r\n  public get timeElapsedTowardNextAction() {\r\n    return this._elapsedTime;\r\n  }\r\n\r\n  public get isRunning() {\r\n    return this._running;\r\n  }\r\n\r\n  /**\r\n   * Pauses the timer, time will no longer increment towards the next call\r\n   */\r\n  public pause(): Timer {\r\n    this._running = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Resumes the timer, time will now increment towards the next call.\r\n   */\r\n  public resume(): Timer {\r\n    this._running = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\r\n   */\r\n  public start(): Timer {\r\n    if (!this.scene) {\r\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\r\n    }\r\n\r\n    this._running = true;\r\n    if (this.complete) {\r\n      this._complete = false;\r\n      this._elapsedTime = 0;\r\n      this._numberOfTicks = 0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\r\n   */\r\n  public stop(): Timer {\r\n    this._running = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Cancels the timer, preventing any further executions.\r\n   */\r\n  public cancel() {\r\n    this.pause();\r\n    if (this.scene) {\r\n      this.scene.cancelTimer(this);\r\n    }\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem/Component';\r\nimport { vec, Vector } from '../Math/vector';\r\n\r\nexport class ParallaxComponent extends Component {\r\n  parallaxFactor = vec(1.0, 1.0);\r\n\r\n  constructor(parallaxFactor?: Vector) {\r\n    super();\r\n    this.parallaxFactor = parallaxFactor ?? this.parallaxFactor;\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { DebugConfig } from '../Debug';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\n\r\n/**\r\n * Provide arbitrary drawing for the purposes of debugging your game\r\n *\r\n * Will only show when the Engine is set to debug mode {@apilink Engine.showDebug} or {@apilink Engine.toggleDebug}\r\n *\r\n */\r\nexport class DebugGraphicsComponent extends Component {\r\n  constructor(\r\n    public draw: (ctx: ExcaliburGraphicsContext, debugFlags: DebugConfig) => void,\r\n    public useTransform = true\r\n  ) {\r\n    super();\r\n  }\r\n}\r\n","import { EventEmitter } from '../EventEmitter';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { GlobalCoordinates } from '../Math';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\nimport { RentalPool } from '../Util/RentalPool';\r\n\r\n/**\r\n * Signals that an object has nested pointer events on nested objects that are not an Entity with\r\n * a PointerComponent. For example TileMap Tiles\r\n */\r\nexport interface HasNestedPointerEvents {\r\n  _dispatchPointerEvents(receiver: PointerEventReceiver): void;\r\n  _processPointerToObject(receiver: PointerEventReceiver): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nfunction hasNestedEvents(object: any): object is HasNestedPointerEvents {\r\n  return object && object._dispatchPointerEvents && object._processPointerToObject;\r\n}\r\n\r\nexport class PointerTargetObjectProxy<TObject extends { events: EventEmitter }> {\r\n  public object!: TObject;\r\n  public contains!: (point: GlobalCoordinates) => boolean;\r\n  public active!: () => boolean;\r\n  public get events(): EventEmitter {\r\n    return this.object.events;\r\n  }\r\n  public init(object: TObject, contains: (point: GlobalCoordinates) => boolean, active: () => boolean): void {\r\n    this.object = object;\r\n    this.contains = contains;\r\n    this.active = active;\r\n  }\r\n}\r\n\r\nexport class PointerEventsToObjectDispatcher<TObject extends { events: EventEmitter }> {\r\n  private _proxyPool = new RentalPool(\r\n    () => new PointerTargetObjectProxy<TObject>(),\r\n    (p) => p,\r\n    100\r\n  );\r\n  private _objectToProxy = new Map<TObject, PointerTargetObjectProxy<TObject>>();\r\n  private _proxies: PointerTargetObjectProxy<TObject>[] = [];\r\n\r\n  /**\r\n   * Tracks an object to associate with pointers and their events\r\n   * @param object\r\n   * @param contains\r\n   * @param active\r\n   */\r\n  public addObject(object: TObject, contains: (point: GlobalCoordinates) => boolean, active: () => boolean): void {\r\n    const proxy = this._proxyPool.rent(false);\r\n    proxy.init(object, contains, active);\r\n    this._proxies.push(proxy);\r\n    this._objectToProxy.set(object, proxy);\r\n  }\r\n\r\n  private _getProxy(object: TObject): PointerTargetObjectProxy<TObject> {\r\n    const proxy = this._objectToProxy.get(object);\r\n    if (proxy) {\r\n      return proxy;\r\n    }\r\n    throw new Error('No PointerTargetProxy for object');\r\n  }\r\n\r\n  /**\r\n   * Untracks an object associated with pointers and their events\r\n   * @param object\r\n   */\r\n  public removeObject(object: TObject): void {\r\n    const proxy = this._objectToProxy.get(object);\r\n    if (proxy) {\r\n      const index = this._proxies.indexOf(proxy);\r\n      if (index > -1) {\r\n        this._proxies.splice(index, 1);\r\n      }\r\n      this._proxyPool.return(proxy);\r\n    }\r\n  }\r\n  private _lastFrameObjectToPointers = new Map<PointerTargetObjectProxy<any>, number[]>();\r\n  private _currentFrameObjectToPointers = new Map<PointerTargetObjectProxy<any>, number[]>();\r\n  private _objectCurrentlyUnderPointer(object: PointerTargetObjectProxy<any>, pointerId: number): boolean {\r\n    return !!(this._currentFrameObjectToPointers.has(object) && this._currentFrameObjectToPointers.get(object)!.includes(pointerId));\r\n  }\r\n\r\n  private _objectWasUnderPointer(object: PointerTargetObjectProxy<any>, pointerId: number): boolean {\r\n    return !!(this._lastFrameObjectToPointers.has(object) && this._lastFrameObjectToPointers.get(object)!.includes(pointerId));\r\n  }\r\n\r\n  private _entered(object: PointerTargetObjectProxy<any>, pointerId: number): boolean {\r\n    return this._objectCurrentlyUnderPointer(object, pointerId) && !this._lastFrameObjectToPointers.has(object);\r\n  }\r\n\r\n  private _left(object: PointerTargetObjectProxy<any>, pointerId: number): boolean {\r\n    return !this._currentFrameObjectToPointers.has(object) && this._objectWasUnderPointer(object, pointerId);\r\n  }\r\n\r\n  /**\r\n   * Manually associate a pointer id with an object.\r\n   *\r\n   * This assumes you've checked that the pointer is indeed over the object.\r\n   */\r\n  public addPointerToObject(object: TObject, pointerId: number): void {\r\n    const maybeProxy = this._objectToProxy.get(object);\r\n    if (maybeProxy) {\r\n      this._addPointerToProxy(maybeProxy, pointerId);\r\n    }\r\n  }\r\n\r\n  private _addPointerToProxy(object: PointerTargetObjectProxy<any>, pointerId: number): void {\r\n    if (!this._currentFrameObjectToPointers.has(object)) {\r\n      this._currentFrameObjectToPointers.set(object, [pointerId]);\r\n      return;\r\n    }\r\n    const pointers = this._currentFrameObjectToPointers.get(object)!;\r\n    this._currentFrameObjectToPointers.set(object, pointers.concat(pointerId));\r\n  }\r\n\r\n  /**\r\n   * Dispatches the appropriate pointer events in sortedObject order on tracked objects\r\n   * @param receiver\r\n   * @param sortedObjects\r\n   */\r\n  public dispatchEvents(receiver: PointerEventReceiver, sortedObjects: TObject[]) {\r\n    const lastFrameEntities = new Set(this._lastFrameObjectToPointers.keys());\r\n    const currentFrameEntities = new Set(this._currentFrameObjectToPointers.keys());\r\n    // Filter preserves z order\r\n    let lastMovePerPointer: Map<number, PointerEvent>;\r\n    let lastUpPerPointer: Map<number, PointerEvent>;\r\n    let lastDownPerPointer: Map<number, PointerEvent>;\r\n    // Dispatch events in proxy z order\r\n    for (let i = 0; i < sortedObjects.length; i++) {\r\n      const object = sortedObjects[i];\r\n      const proxy = this._getProxy(object);\r\n      if (hasNestedEvents(object)) {\r\n        object._dispatchPointerEvents(receiver);\r\n      }\r\n      if (lastFrameEntities.has(proxy) || currentFrameEntities.has(proxy)) {\r\n        lastDownPerPointer = this._processDownAndEmit(receiver, proxy);\r\n\r\n        lastUpPerPointer = this._processUpAndEmit(receiver, proxy);\r\n\r\n        lastMovePerPointer = this._processMoveAndEmit(receiver, proxy);\r\n\r\n        const lastUpDownMoveEvents = [...lastMovePerPointer.values(), ...lastDownPerPointer.values(), ...lastUpPerPointer.values()];\r\n        this._processEnterLeaveAndEmit(receiver, proxy, lastUpDownMoveEvents);\r\n\r\n        this._processCancelAndEmit(receiver, proxy);\r\n\r\n        this._processWheelAndEmit(receiver, proxy);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Given the tracked objects, update pointer containment given the provided contains()\r\n   * @param receiver\r\n   * @param objects\r\n   */\r\n  public processPointerToObject(receiver: PointerEventReceiver, objects: TObject[]) {\r\n    // Pre-process find entities under pointers\r\n    for (let objectIndex = 0; objectIndex < objects.length; objectIndex++) {\r\n      const object = objects[objectIndex];\r\n      const proxy = this._getProxy(object);\r\n      if (hasNestedEvents(object)) {\r\n        object._processPointerToObject(receiver);\r\n      }\r\n      for (const [pointerId, pos] of receiver.currentFramePointerCoords.entries()) {\r\n        if (proxy.contains(pos)) {\r\n          this._addPointerToProxy(proxy, pointerId);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear current frames pointer-object associations and track last frame pointer-object associations\r\n   */\r\n  public clear() {\r\n    this._lastFrameObjectToPointers.clear();\r\n    this._lastFrameObjectToPointers = new Map<PointerTargetObjectProxy<any>, number[]>(this._currentFrameObjectToPointers);\r\n    this._currentFrameObjectToPointers.clear();\r\n  }\r\n\r\n  private _processDownAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>): Map<number, PointerEvent> {\r\n    const lastDownPerPointer = new Map<number, PointerEvent>();\r\n    // Loop through down and dispatch to entities\r\n    for (const event of receiver.currentFrameDown) {\r\n      if (event.active && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\r\n        object.events.emit('pointerdown', event as any);\r\n        if (receiver.isDragStart(event.pointerId)) {\r\n          object.events.emit('pointerdragstart', event as any);\r\n        }\r\n      }\r\n      lastDownPerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastDownPerPointer;\r\n  }\r\n\r\n  private _processUpAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>): Map<number, PointerEvent> {\r\n    const lastUpPerPointer = new Map<number, PointerEvent>();\r\n    // Loop through up and dispatch to entities\r\n    for (const event of receiver.currentFrameUp) {\r\n      if (event.active && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\r\n        object.events.emit('pointerup', event as any);\r\n        if (receiver.isDragEnd(event.pointerId)) {\r\n          object.events.emit('pointerdragend', event as any);\r\n        }\r\n      }\r\n      lastUpPerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastUpPerPointer;\r\n  }\r\n\r\n  private _processMoveAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>): Map<number, PointerEvent> {\r\n    const lastMovePerPointer = new Map<number, PointerEvent>();\r\n    // Loop through move and dispatch to entities\r\n    for (const event of receiver.currentFrameMove) {\r\n      if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\r\n        // move\r\n        object.events.emit('pointermove', event as any);\r\n\r\n        if (receiver.isDragging(event.pointerId)) {\r\n          object.events.emit('pointerdragmove', event as any);\r\n        }\r\n      }\r\n      lastMovePerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastMovePerPointer;\r\n  }\r\n\r\n  private _processEnterLeaveAndEmit(\r\n    receiver: PointerEventReceiver,\r\n    object: PointerTargetObjectProxy<any>,\r\n    lastUpDownMoveEvents: PointerEvent[]\r\n  ) {\r\n    // up, down, and move are considered for enter and leave\r\n    for (const event of lastUpDownMoveEvents) {\r\n      // enter\r\n      if (event.active && object.active() && this._entered(object, event.pointerId)) {\r\n        object.events.emit('pointerenter', event as any);\r\n        if (receiver.isDragging(event.pointerId)) {\r\n          object.events.emit('pointerdragenter', event as any);\r\n        }\r\n        break;\r\n      }\r\n      if (\r\n        event.active &&\r\n        object.active() &&\r\n        // leave can happen on move\r\n        (this._left(object, event.pointerId) ||\r\n          // or leave can happen on pointer up\r\n          (this._objectCurrentlyUnderPointer(object, event.pointerId) && event.type === 'up'))\r\n      ) {\r\n        object.events.emit('pointerleave', event as any);\r\n        if (receiver.isDragging(event.pointerId)) {\r\n          object.events.emit('pointerdragleave', event as any);\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processCancelAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>) {\r\n    // cancel\r\n    for (const event of receiver.currentFrameCancel) {\r\n      if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, event.pointerId)) {\r\n        object.events.emit('pointercancel', event as any);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processWheelAndEmit(receiver: PointerEventReceiver, object: PointerTargetObjectProxy<any>) {\r\n    // wheel\r\n    for (const event of receiver.currentFrameWheel) {\r\n      // Currently the wheel only fires under the primary pointer '0'\r\n      if (event.active && object.active() && this._objectCurrentlyUnderPointer(object, 0)) {\r\n        object.events.emit('pointerwheel', event as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Engine } from '../Engine';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { Entity, EntityEvents } from '../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { BodyComponent } from '../Collision/BodyComponent';\r\nimport { CollisionType } from '../Collision/CollisionType';\r\nimport { Shape } from '../Collision/Colliders/Shape';\r\nimport { ExcaliburGraphicsContext, Graphic, GraphicsComponent, hasGraphicsTick, ParallaxComponent } from '../Graphics';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\r\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\r\nimport { Collider } from '../Collision/Colliders/Collider';\r\nimport { PostDrawEvent, PostUpdateEvent, PreDrawEvent, PreUpdateEvent } from '../Events';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { DebugConfig } from '../Debug';\r\nimport { clamp } from '../Math/util';\r\nimport { PointerComponent } from '../Input/PointerComponent';\r\nimport { PointerEvent } from '../Input/PointerEvent';\r\nimport { PointerEventReceiver } from '../Input/PointerEventReceiver';\r\nimport { HasNestedPointerEvents, PointerEventsToObjectDispatcher } from '../Input/PointerEventsToObjectDispatcher';\r\nimport { GlobalCoordinates } from '../Math';\r\n\r\nexport interface TileMapOptions {\r\n  /**\r\n   * Optionally name the tile map\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally specify the position of the tile map\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Width of an individual tile in pixels\r\n   */\r\n  tileWidth: number;\r\n  /**\r\n   * Height of an individual tile in pixels\r\n   */\r\n  tileHeight: number;\r\n  /**\r\n   * The number of tile columns, or the number of tiles wide\r\n   */\r\n  columns: number;\r\n  /**\r\n   * The number of tile  rows, or the number of tiles high\r\n   */\r\n  rows: number;\r\n\r\n  /**\r\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\r\n   */\r\n  renderFromTopOfGraphic?: boolean;\r\n\r\n  /**\r\n   * Optionally configure the meshing lookbehind for Tilemap, Tilemaps combine solid tiles into optimal\r\n   * geometry and the lookbehind configures how far back the Tilemap to look for geometry when combining. Meshing\r\n   * is an expensive operation, so when the Tilemap geometry is invalidated it must be recalculated.\r\n   *\r\n   * Default is 10 slots, but if your Tilemap does not change positions or solid tiles often you can increase this to\r\n   * Infinity.\r\n   */\r\n  meshingLookBehind?: number;\r\n}\r\n\r\nexport type TilePointerEvents = {\r\n  pointerup: PointerEvent;\r\n  pointerdown: PointerEvent;\r\n  pointermove: PointerEvent;\r\n  pointercancel: PointerEvent;\r\n  pointerenter: PointerEvent;\r\n  pointerleave: PointerEvent;\r\n};\r\n\r\nexport type TileMapEvents = EntityEvents &\r\n  TilePointerEvents & {\r\n    preupdate: PreUpdateEvent<TileMap>;\r\n    postupdate: PostUpdateEvent<TileMap>;\r\n    predraw: PreDrawEvent;\r\n    postdraw: PostDrawEvent;\r\n  };\r\n\r\nexport const TileMapEvents = {\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate',\r\n  PreDraw: 'predraw',\r\n  PostDraw: 'postdraw',\r\n  PointerUp: 'pointerup',\r\n  PointerDown: 'pointerdown',\r\n  PointerMove: 'pointermove',\r\n  PointerCancel: 'pointercancel'\r\n};\r\n\r\n/**\r\n * The TileMap provides a mechanism for doing flat 2D tiles rendered in a grid.\r\n *\r\n * TileMaps are useful for top down or side scrolling grid oriented games.\r\n */\r\nexport class TileMap extends Entity implements HasNestedPointerEvents {\r\n  public events = new EventEmitter<TileMapEvents>();\r\n  private _token = 0;\r\n  private _engine!: Engine;\r\n\r\n  public logger: Logger = Logger.getInstance();\r\n  public readonly tiles: Tile[] = [];\r\n  private _rows: Tile[][] = [];\r\n  private _cols: Tile[][] = [];\r\n\r\n  public readonly tileWidth: number;\r\n  public readonly tileHeight: number;\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  public renderFromTopOfGraphic = false;\r\n  public meshingLookBehind = 10;\r\n\r\n  private _collidersDirty = true;\r\n  private _pointerEventDispatcher: PointerEventsToObjectDispatcher<Tile>;\r\n  public flagCollidersDirty() {\r\n    this._collidersDirty = true;\r\n  }\r\n\r\n  public flagTilesDirty() {\r\n    for (let i = 0; i < this.tiles.length; i++) {\r\n      if (this.tiles[i]) {\r\n        this.tiles[i].flagDirty();\r\n      }\r\n    }\r\n  }\r\n\r\n  public pointer: PointerComponent;\r\n  public transform: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _graphics: GraphicsComponent;\r\n  public collider: ColliderComponent;\r\n  private _composite: CompositeCollider;\r\n\r\n  public get x(): number {\r\n    return this.transform.pos.x ?? 0;\r\n  }\r\n\r\n  public set x(val: number) {\r\n    if (this.transform?.pos) {\r\n      this.get(TransformComponent).pos = vec(val, this.y);\r\n    }\r\n  }\r\n\r\n  public get y(): number {\r\n    return this.transform?.pos.y ?? 0;\r\n  }\r\n\r\n  public set y(val: number) {\r\n    if (this.transform?.pos) {\r\n      this.transform.pos = vec(this.x, val);\r\n    }\r\n  }\r\n\r\n  public get z(): number {\r\n    return this.transform.z ?? 0;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    if (this.transform) {\r\n      this.transform.z = val;\r\n    }\r\n  }\r\n\r\n  private _oldRotation: number = 0;\r\n  public get rotation(): number {\r\n    return this.transform?.rotation ?? 0;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    if (this.transform) {\r\n      this.transform.rotation = val;\r\n    }\r\n  }\r\n\r\n  private _oldScale: Vector;\r\n  public get scale(): Vector {\r\n    return this.transform?.scale ?? Vector.One;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    if (this.transform?.scale) {\r\n      this.transform.scale = val;\r\n    }\r\n  }\r\n\r\n  private _oldPos: Vector;\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.pos = val;\r\n  }\r\n\r\n  public get vel(): Vector {\r\n    return this._motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this._motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * Width of the whole tile map in pixels\r\n   */\r\n  public get width(): number {\r\n    return this.tileWidth * this.columns * this.scale.x;\r\n  }\r\n\r\n  /**\r\n   * Height of the whole tilemap in pixels\r\n   */\r\n  public get height(): number {\r\n    return this.tileHeight * this.rows * this.scale.y;\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<TileMapEvents>>(eventName: TEventName, event: TileMapEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<TileMapEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<TileMapEvents>>(eventName: TEventName, handler: Handler<TileMapEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<TileMapEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<TileMapEvents>>(eventName: TEventName, handler: Handler<TileMapEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<TileMapEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<TileMapEvents>>(eventName: TEventName, handler: Handler<TileMapEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<TileMapEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler as any);\r\n  }\r\n\r\n  /**\r\n   * @param options\r\n   */\r\n  constructor(options: TileMapOptions) {\r\n    super([], options.name);\r\n    this.meshingLookBehind = options.meshingLookBehind ?? this.meshingLookBehind;\r\n    this.addComponent(new TransformComponent());\r\n    this.addComponent(new MotionComponent());\r\n    this.addComponent(\r\n      new BodyComponent({\r\n        type: CollisionType.Fixed\r\n      })\r\n    );\r\n    this.addComponent(\r\n      new GraphicsComponent({\r\n        onPostDraw: (ctx, elapsed) => this.draw(ctx, elapsed)\r\n      })\r\n    );\r\n    this.addComponent(new DebugGraphicsComponent((ctx, debugFlags) => this.debug(ctx, debugFlags), false));\r\n    this.addComponent(new ColliderComponent());\r\n    this.addComponent(new PointerComponent());\r\n    this.pointer = this.get(PointerComponent);\r\n    this._graphics = this.get(GraphicsComponent);\r\n    this.transform = this.get(TransformComponent);\r\n    this._motion = this.get(MotionComponent);\r\n    this.collider = this.get(ColliderComponent);\r\n    this._composite = this.collider.useCompositeCollider([]);\r\n\r\n    this.transform.pos = options.pos ?? Vector.Zero;\r\n    this._oldPos = this.transform.pos.clone();\r\n    this._oldScale = this.transform.scale.clone();\r\n    this.renderFromTopOfGraphic = options.renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\r\n    this.tileWidth = options.tileWidth;\r\n    this.tileHeight = options.tileHeight;\r\n    this.rows = options.rows;\r\n    this.columns = options.columns;\r\n\r\n    this._pointerEventDispatcher = new PointerEventsToObjectDispatcher();\r\n\r\n    this.tiles = new Array<Tile>(this.rows * this.columns);\r\n    this._rows = new Array(this.rows);\r\n    this._cols = new Array(this.columns);\r\n    let currentCol: Tile[] = [];\r\n    for (let i = 0; i < this.columns; i++) {\r\n      for (let j = 0; j < this.rows; j++) {\r\n        const tile = new Tile({\r\n          x: i,\r\n          y: j,\r\n          map: this\r\n        });\r\n        tile.map = this;\r\n        this.tiles[i + j * this.columns] = tile;\r\n        this._pointerEventDispatcher.addObject(\r\n          tile,\r\n          (vec: GlobalCoordinates) => {\r\n            // TODO handle geometry/graphics\r\n            return tile.bounds.contains(vec.worldPos);\r\n          },\r\n          () => true\r\n        );\r\n        currentCol.push(tile);\r\n        if (!this._rows[j]) {\r\n          this._rows[j] = [];\r\n        }\r\n        this._rows[j].push(tile);\r\n      }\r\n      this._cols[i] = currentCol;\r\n      currentCol = [];\r\n    }\r\n\r\n    this._graphics.localBounds = new BoundingBox({\r\n      left: 0,\r\n      top: 0,\r\n      right: this.columns * this.tileWidth * this.scale.x,\r\n      bottom: this.rows * this.tileHeight * this.scale.y\r\n    });\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    this._engine = engine;\r\n  }\r\n\r\n  private _originalOffsets = new WeakMap<Collider, Vector>();\r\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\r\n    if (!this._originalOffsets.has(collider)) {\r\n      const originalOffset = collider.offset;\r\n      this._originalOffsets.set(collider, originalOffset);\r\n      return originalOffset;\r\n    } else {\r\n      return this._originalOffsets.get(collider) ?? Vector.Zero;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tiles colliders based on the solid tiles in the tilemap.\r\n   */\r\n  private _updateColliders(): void {\r\n    this.collider.$colliderRemoved.notifyAll(this._composite);\r\n    this._composite.clearColliders();\r\n    const colliders: BoundingBox[] = [];\r\n    this._composite = this.collider.useCompositeCollider([]);\r\n    let current: BoundingBox | null = null;\r\n\r\n    /**\r\n     * Returns wether or not the 2 boxes share an edge and are the same height\r\n     * @param prev\r\n     * @param next\r\n     * @returns true if they share and edge, false if not\r\n     */\r\n    const shareEdges = (prev: BoundingBox, next: BoundingBox) => {\r\n      if (prev && next) {\r\n        // same top/bottom\r\n        return (\r\n          prev.top === next.top &&\r\n          prev.bottom === next.bottom &&\r\n          // Shared right/left edge\r\n          prev.right === next.left\r\n        );\r\n      }\r\n      return false;\r\n    };\r\n\r\n    /**\r\n     * Potentially merges the current collider into a list of previous ones, mutating the list\r\n     * If checkAndCombine returns true, the collider was successfully merged and should be thrown away\r\n     * @param current current collider to test\r\n     * @param colliders List of colliders to consider merging with\r\n     * @param maxLookBack The amount of colliders to look back for combination\r\n     * @returns false when no combination found, true when successfully combined\r\n     */\r\n    const checkAndCombine = (current: BoundingBox, colliders: BoundingBox[], maxLookBack = this.meshingLookBehind) => {\r\n      if (!current) {\r\n        return false;\r\n      }\r\n      // walk backwards through the list of colliders and combine with the first that shares an edge\r\n      for (let i = colliders.length - 1; i >= 0; i--) {\r\n        if (maxLookBack-- < 0) {\r\n          // blunt the O(n^2) algorithm a bit\r\n          return false;\r\n        }\r\n        const prev = colliders[i];\r\n        if (shareEdges(prev, current)) {\r\n          colliders[i] = prev.combine(current);\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n\r\n    // ? configurable bias perhaps, horizontal strips vs. vertical ones\r\n    // Bad tile collider packing algorithm\r\n    for (let i = 0; i < this.columns; i++) {\r\n      // Scan column for colliders\r\n      for (let j = 0; j < this.rows; j++) {\r\n        const tile = this.tiles[i + j * this.columns];\r\n        // Current tile in column is solid build up current collider\r\n        if (tile.solid) {\r\n          // Use custom collider otherwise bounding box\r\n          if (tile.getColliders().length > 0) {\r\n            // tile with custom collider interrupting the current run\r\n            for (const collider of tile.getColliders()) {\r\n              const originalOffset = this._getOrSetColliderOriginalOffset(collider);\r\n              collider.offset = vec(tile.x * this.tileWidth * this.scale.x, tile.y * this.tileHeight * this.scale.y).add(originalOffset);\r\n              collider.owner = this;\r\n              this._composite.addCollider(collider);\r\n            }\r\n            //we push any current collider before nulling the current run\r\n            if (current && !checkAndCombine(current, colliders)) {\r\n              colliders.push(current);\r\n            }\r\n            current = null;\r\n            // Use the bounding box\r\n          } else {\r\n            if (!current) {\r\n              // no current run, start one\r\n              current = tile.defaultGeometry;\r\n            } else {\r\n              // combine with current run\r\n              current = current.combine(tile.defaultGeometry);\r\n            }\r\n          }\r\n        } else {\r\n          // Not solid skip and cut off the current collider\r\n          // End of run check and combine\r\n          if (current && !checkAndCombine(current, colliders)) {\r\n            colliders.push(current);\r\n          }\r\n          current = null;\r\n        }\r\n      }\r\n      // After a column is complete check to see if it can be merged into the last one\r\n      // Eno of run check and combine\r\n      if (current && !checkAndCombine(current, colliders)) {\r\n        // else new collider if no combination\r\n        colliders.push(current);\r\n      }\r\n      current = null;\r\n    }\r\n\r\n    for (const c of colliders) {\r\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\r\n      collider.owner = this;\r\n      this._composite.addCollider(collider);\r\n    }\r\n    this.collider.update();\r\n    // Notify that colliders have been updated\r\n    this.collider.$colliderAdded.notifyAll(this._composite);\r\n  }\r\n\r\n  /**\r\n   * Returns the {@apilink Tile} by index (row major order)\r\n   *\r\n   * Returns null if out of bounds\r\n   */\r\n  public getTileByIndex(index: number): Tile | null {\r\n    return this.tiles[index] ?? null;\r\n  }\r\n  /**\r\n   * Returns the {@apilink Tile} by its x and y integer coordinates\r\n   *\r\n   * Returns null if out of bounds\r\n   *\r\n   * For example, if I want the tile in fifth column (x), and second row (y):\r\n   * `getTile(4, 1)` 0 based, so 0 is the first in row/column\r\n   */\r\n  public getTile(x: number, y: number): Tile | null {\r\n    if (x < 0 || y < 0 || x >= this.columns || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.tiles[x + y * this.columns];\r\n  }\r\n  /**\r\n   * Returns the {@apilink Tile} by testing a point in world coordinates,\r\n   * returns `null` if no Tile was found.\r\n   */\r\n  public getTileByPoint(point: Vector): Tile | null {\r\n    const { x, y } = this._getTileCoordinates(point);\r\n    const tile = this.getTile(x, y);\r\n    if (x >= 0 && y >= 0 && x < this.columns && y < this.rows && tile) {\r\n      return tile;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private _getTileCoordinates(point: Vector): { x: number; y: number } {\r\n    // Convert to Tile Space point\r\n    point = this.transform.applyInverse(point);\r\n\r\n    const x = Math.floor(point.x / this.tileWidth);\r\n    const y = Math.floor(point.y / this.tileHeight);\r\n    return { x, y };\r\n  }\r\n\r\n  public getRows(): readonly Tile[][] {\r\n    return this._rows;\r\n  }\r\n\r\n  public getColumns(): readonly Tile[][] {\r\n    return this._cols;\r\n  }\r\n\r\n  /**\r\n   * Returns the on screen tiles for a tilemap, this will overshoot by a small amount because of the internal quad tree data structure.\r\n   *\r\n   * Useful if you need to perform specific logic on onscreen tiles\r\n   */\r\n  public getOnScreenTiles(): readonly Tile[] {\r\n    let worldBounds = this._engine.screen.getWorldBounds();\r\n    const maybeParallax = this.get(ParallaxComponent);\r\n    if (maybeParallax && this.isInitialized) {\r\n      let pos = this.pos;\r\n      const oneMinusFactor = Vector.One.sub(maybeParallax.parallaxFactor);\r\n      const parallaxOffset = this._engine.currentScene.camera.pos.scale(oneMinusFactor);\r\n      pos = pos.sub(parallaxOffset);\r\n      // adjust world bounds by parallax factor\r\n      worldBounds = worldBounds.translate(pos);\r\n    }\r\n\r\n    const bounds = this.transform.coordPlane === CoordPlane.Screen ? this._engine.screen.getScreenBounds() : worldBounds;\r\n    const topLeft = this._getTileCoordinates(bounds.topLeft);\r\n    const topRight = this._getTileCoordinates(bounds.topRight);\r\n    const bottomRight = this._getTileCoordinates(bounds.bottomRight);\r\n    const bottomLeft = this._getTileCoordinates(bounds.bottomLeft);\r\n\r\n    const tileStartX = Math.min(clamp(topLeft.x, 0, this.columns - 1), clamp(topRight.x, 0, this.columns - 1));\r\n    const tileStartY = Math.min(clamp(topLeft.y, 0, this.rows - 1), clamp(topRight.y, 0, this.rows - 1));\r\n    const tileEndX = Math.max(clamp(bottomRight.x, 0, this.columns - 1), clamp(bottomLeft.x, 0, this.columns - 1));\r\n    const tileEndY = Math.max(clamp(bottomRight.y, 0, this.rows - 1), clamp(bottomLeft.y, 0, this.rows - 1));\r\n\r\n    const tiles: Tile[] = [];\r\n    for (let x = tileStartX; x <= tileEndX; x++) {\r\n      for (let y = tileStartY; y <= tileEndY; y++) {\r\n        tiles.push(this.getTile(x, y)!);\r\n      }\r\n    }\r\n    return tiles;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _processPointerToObject(receiver: PointerEventReceiver) {\r\n    this._pointerEventDispatcher.processPointerToObject(receiver, this.tiles);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _dispatchPointerEvents(receiver: PointerEventReceiver) {\r\n    this._pointerEventDispatcher.dispatchEvents(receiver, this.tiles);\r\n  }\r\n\r\n  public update(engine: Engine, elapsed: number) {\r\n    this._initialize(engine);\r\n    this.onPreUpdate(engine, elapsed);\r\n    this.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n\r\n    // Update colliders\r\n    if (!this._oldPos.equals(this.pos) || this._oldRotation !== this.rotation || !this._oldScale.equals(this.scale)) {\r\n      this.flagCollidersDirty();\r\n      this.flagTilesDirty();\r\n    }\r\n    if (this._collidersDirty) {\r\n      this._collidersDirty = false;\r\n      this._updateColliders();\r\n    }\r\n\r\n    // Clear last frame's events\r\n    this._pointerEventDispatcher.clear();\r\n\r\n    this._token++;\r\n\r\n    this.pos.clone(this._oldPos);\r\n    this._oldRotation = this.rotation;\r\n    this.scale.clone(this._oldScale);\r\n    this.transform.pos = this.pos;\r\n    this.onPostUpdate(engine, elapsed);\r\n    this.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n  }\r\n\r\n  /**\r\n   * Draws the tile map to the screen. Called by the {@apilink Scene}.\r\n   * @param ctx ExcaliburGraphicsContext\r\n   * @param elapsed  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    if (!this.isInitialized) {\r\n      return;\r\n    }\r\n    this.emit('predraw', new PreDrawEvent(ctx as any, elapsed, this)); // TODO fix event\r\n\r\n    let graphics: readonly Graphic[], graphicsIndex: number, graphicsLen: number;\r\n\r\n    const tiles = this.getOnScreenTiles();\r\n    for (let i = 0; i < tiles.length; i++) {\r\n      const tile = tiles[i];\r\n      // get non-negative tile sprites\r\n      const offsets = tile.getGraphicsOffsets();\r\n      graphics = tile.getGraphics();\r\n\r\n      for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\r\n        // draw sprite, warning if sprite doesn't exist\r\n        const graphic = graphics[graphicsIndex];\r\n        const offset = offsets[graphicsIndex];\r\n        if (graphic) {\r\n          if (hasGraphicsTick(graphic)) {\r\n            graphic?.tick(elapsed, this._token);\r\n          }\r\n          const offsetY = this.renderFromTopOfGraphic ? 0 : graphic.height - this.tileHeight;\r\n          graphic.draw(ctx, tile.x * this.tileWidth + offset.x, tile.y * this.tileHeight - offsetY + offset.y);\r\n        }\r\n      }\r\n    }\r\n    this.emit('postdraw', new PostDrawEvent(ctx as any, elapsed, this));\r\n  }\r\n\r\n  public debug(gfx: ExcaliburGraphicsContext, debugFlags: DebugConfig) {\r\n    const {\r\n      showAll,\r\n      showGrid,\r\n      gridColor,\r\n      gridWidth,\r\n      showSolidBounds: showColliderBounds,\r\n      solidBoundsColor: colliderBoundsColor,\r\n      showColliderGeometry\r\n    } = debugFlags.tilemap;\r\n    const { geometryColor, geometryLineWidth, geometryPointSize } = debugFlags.collider;\r\n    const width = this.tileWidth * this.columns * this.scale.x;\r\n    const height = this.tileHeight * this.rows * this.scale.y;\r\n    const pos = this.pos;\r\n    if (showGrid || showAll) {\r\n      for (let r = 0; r < this.rows + 1; r++) {\r\n        const yOffset = vec(0, r * this.tileHeight * this.scale.y);\r\n        gfx.drawLine(pos.add(yOffset), pos.add(vec(width, yOffset.y)), gridColor, gridWidth);\r\n      }\r\n\r\n      for (let c = 0; c < this.columns + 1; c++) {\r\n        const xOffset = vec(c * this.tileWidth * this.scale.x, 0);\r\n        gfx.drawLine(pos.add(xOffset), pos.add(vec(xOffset.x, height)), gridColor, gridWidth);\r\n      }\r\n    }\r\n\r\n    if (showAll || showColliderBounds || showColliderGeometry) {\r\n      const colliders = this._composite.getColliders();\r\n      gfx.save();\r\n      gfx.translate(this.pos.x, this.pos.y);\r\n      gfx.scale(this.scale.x, this.scale.y);\r\n      for (const collider of colliders) {\r\n        const bounds = collider.localBounds;\r\n        const pos = collider.worldPos.sub(this.pos);\r\n        if (showColliderBounds) {\r\n          gfx.drawRectangle(pos, bounds.width, bounds.height, colliderBoundsColor);\r\n        }\r\n      }\r\n      gfx.restore();\r\n      if (showColliderGeometry) {\r\n        for (const collider of colliders) {\r\n          collider.debug(gfx, geometryColor, { lineWidth: geometryLineWidth, pointSize: geometryPointSize });\r\n        }\r\n      }\r\n    }\r\n\r\n    if (showAll || showColliderBounds) {\r\n      gfx.save();\r\n      gfx.z = 999;\r\n      if (showColliderBounds) {\r\n        for (let i = 0; i < this.tiles.length; i++) {\r\n          this.tiles[i].bounds.draw(gfx);\r\n        }\r\n      }\r\n      gfx.restore();\r\n    }\r\n  }\r\n}\r\n\r\nexport interface TileOptions {\r\n  /**\r\n   * Integer tile x coordinate\r\n   */\r\n  x: number;\r\n  /**\r\n   * Integer tile y coordinate\r\n   */\r\n  y: number;\r\n  map: TileMap;\r\n  solid?: boolean;\r\n  graphics?: Graphic[];\r\n}\r\n\r\n/**\r\n * TileMap Tile\r\n *\r\n * A light-weight object that occupies a space in a collision map. Generally\r\n * created by a {@apilink TileMap}.\r\n *\r\n * Tiles can draw multiple sprites. Note that the order of drawing is the order\r\n * of the sprites in the array so the last one will be drawn on top. You can\r\n * use transparency to create layers this way.\r\n */\r\nexport class Tile {\r\n  private _bounds!: BoundingBox;\r\n  private _geometry!: BoundingBox;\r\n  private _pos!: Vector;\r\n  private _posDirty = false;\r\n\r\n  public events = new EventEmitter<TilePointerEvents>();\r\n\r\n  /**\r\n   * Return the world position of the top left corner of the tile\r\n   */\r\n  public get pos() {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n      this._posDirty = false;\r\n    }\r\n    return this._pos;\r\n  }\r\n\r\n  /**\r\n   * Integer x coordinate of the tile\r\n   */\r\n  public readonly x: number;\r\n\r\n  /**\r\n   * Integer y coordinate of the tile\r\n   */\r\n  public readonly y: number;\r\n\r\n  private _width: number;\r\n  /**\r\n   * Width of the tile in pixels\r\n   */\r\n  public get width(): number {\r\n    return this._width;\r\n  }\r\n\r\n  private _height: number;\r\n  /**\r\n   * Height of the tile in pixels\r\n   */\r\n  public get height(): number {\r\n    return this._height;\r\n  }\r\n\r\n  /**\r\n   * Reference to the TileMap this tile is associated with\r\n   */\r\n  public map: TileMap;\r\n\r\n  private _solid = false;\r\n  /**\r\n   * Wether this tile should be treated as solid by the tilemap\r\n   */\r\n  public get solid(): boolean {\r\n    return this._solid;\r\n  }\r\n  /**\r\n   * Wether this tile should be treated as solid by the tilemap\r\n   */\r\n  public set solid(val: boolean) {\r\n    this.map?.flagCollidersDirty();\r\n    this._solid = val;\r\n  }\r\n\r\n  private _graphics: Graphic[] = [];\r\n  private _offsets: Vector[] = [];\r\n\r\n  /**\r\n   * Current list of graphics for this tile\r\n   */\r\n  public getGraphics(): readonly Graphic[] {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Current list of offsets for this tile's graphics\r\n   */\r\n  public getGraphicsOffsets(): readonly Vector[] {\r\n    return this._offsets;\r\n  }\r\n\r\n  /**\r\n   * Add another {@apilink Graphic} to this TileMap tile\r\n   * @param graphic\r\n   */\r\n  public addGraphic(graphic: Graphic, options?: { offset?: Vector }) {\r\n    this._graphics.push(graphic);\r\n    if (options?.offset) {\r\n      this._offsets.push(options.offset);\r\n    } else {\r\n      this._offsets.push(Vector.Zero);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an instance of a {@apilink Graphic} from this tile\r\n   */\r\n  public removeGraphic(graphic: Graphic) {\r\n    const index = this._graphics.indexOf(graphic);\r\n    if (index > -1) {\r\n      this._graphics.splice(index, 1);\r\n      this._offsets.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all graphics from this tile\r\n   */\r\n  public clearGraphics() {\r\n    this._graphics.length = 0;\r\n    this._offsets.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Current list of colliders for this tile\r\n   */\r\n  private _colliders: Collider[] = [];\r\n\r\n  /**\r\n   * Returns the list of colliders\r\n   */\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Adds a custom collider to the {@apilink Tile} to use instead of it's bounds\r\n   *\r\n   * If no collider is set but {@apilink Tile.solid} is set, the tile bounds are used as a collider.\r\n   *\r\n   * **Note!** the {@apilink Tile.solid} must be set to true for it to act as a \"fixed\" collider\r\n   * @param collider\r\n   */\r\n  public addCollider(collider: Collider) {\r\n    this._colliders.push(collider);\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Removes a collider from the {@apilink Tile}\r\n   * @param collider\r\n   */\r\n  public removeCollider(collider: Collider) {\r\n    const index = this._colliders.indexOf(collider);\r\n    if (index > -1) {\r\n      this._colliders.splice(index, 1);\r\n    }\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Clears all colliders from the {@apilink Tile}\r\n   */\r\n  public clearColliders() {\r\n    this._colliders.length = 0;\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Arbitrary data storage per tile, useful for any game specific data\r\n   */\r\n  public data = new Map<string, any>();\r\n\r\n  constructor(options: TileOptions) {\r\n    this.x = options.x;\r\n    this.y = options.y;\r\n    this.map = options.map;\r\n    this._width = options.map.tileWidth * this.map.scale.x;\r\n    this._height = options.map.tileHeight * this.map.scale.y;\r\n    this.solid = options.solid ?? this.solid;\r\n    this._graphics = options.graphics ?? [];\r\n    this._recalculate();\r\n  }\r\n\r\n  public flagDirty() {\r\n    return (this._posDirty = true);\r\n  }\r\n\r\n  private _recalculate() {\r\n    const geometryPos = this.map.pos.add(vec(this.x * this.map.tileWidth, this.y * this.map.tileHeight));\r\n    this._geometry = new BoundingBox(geometryPos.x, geometryPos.y, geometryPos.x + this.map.tileWidth, geometryPos.y + this.map.tileHeight);\r\n\r\n    this._width = this.map.tileWidth * this.map.scale.x;\r\n    this._height = this.map.tileHeight * this.map.scale.y;\r\n\r\n    this._pos = this.map.pos.add(vec(this.x * this._width, this.y * this._height));\r\n    this._bounds = new BoundingBox(this._pos.x, this._pos.y, this._pos.x + this._width, this._pos.y + this._height);\r\n\r\n    if (this.map.rotation) {\r\n      this._bounds = this._bounds.rotate(this.map.rotation, this.map.pos);\r\n    }\r\n    this._posDirty = false;\r\n  }\r\n\r\n  /**\r\n   * Tile bounds in world space\r\n   */\r\n  public get bounds() {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._bounds;\r\n  }\r\n\r\n  public get defaultGeometry() {\r\n    return this._geometry;\r\n  }\r\n\r\n  /**\r\n   * Tile position in world space\r\n   */\r\n  public get center(): Vector {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n    }\r\n    return new Vector(this._pos.x + this._width / 2, this._pos.y + this._height / 2);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<TilePointerEvents>>(eventName: TEventName, event: TilePointerEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<TilePointerEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<TilePointerEvents>>(\r\n    eventName: TEventName,\r\n    handler: Handler<TilePointerEvents[TEventName]>\r\n  ): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<TilePointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<TilePointerEvents>>(\r\n    eventName: TEventName,\r\n    handler: Handler<TilePointerEvents[TEventName]>\r\n  ): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<TilePointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<TilePointerEvents>>(eventName: TEventName, handler: Handler<TilePointerEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<TilePointerEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    if (handler) {\r\n      this.events.off(eventName, handler);\r\n    } else {\r\n      this.events.off(eventName);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Screen } from './Screen';\r\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { PreUpdateEvent, PostUpdateEvent, InitializeEvent } from './Events';\r\nimport { BoundingBox } from './Collision/BoundingBox';\r\nimport { Logger } from './Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { AffineMatrix } from './Math/affine-matrix';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from './EventEmitter';\r\nimport { pixelSnapEpsilon } from './Graphics';\r\nimport { sign } from './Math/util';\r\nimport { WatchVector } from './Math/watch-vector';\r\n\r\n/**\r\n * Interface that describes a custom camera strategy for tracking targets\r\n */\r\nexport interface CameraStrategy<T> {\r\n  /**\r\n   * Target of the camera strategy that will be passed to the action\r\n   */\r\n  target: T;\r\n\r\n  /**\r\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\r\n   * @param target The target object to apply this camera strategy (if any)\r\n   * @param camera The current camera implementation in excalibur running the game\r\n   * @param engine The current engine running the game\r\n   * @param elapsed The elapsed time in milliseconds since the last frame\r\n   */\r\n  action: (target: T, camera: Camera, engine: Engine, elapsed: number) => Vector;\r\n}\r\n\r\n/**\r\n * Container to house convenience strategy methods\r\n * @internal\r\n */\r\nexport class StrategyContainer {\r\n  constructor(public camera: Camera) {}\r\n\r\n  /**\r\n   * Creates and adds the {@apilink LockCameraToActorStrategy} on the current camera.\r\n   * @param actor The actor to lock the camera to\r\n   */\r\n  public lockToActor(actor: Actor) {\r\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the {@apilink LockCameraToActorAxisStrategy} on the current camera\r\n   * @param actor The actor to lock the camera to\r\n   * @param axis The axis to follow the actor on\r\n   */\r\n  public lockToActorAxis(actor: Actor, axis: Axis) {\r\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the {@apilink ElasticToActorStrategy} on the current camera\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   * @param actor Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\r\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the {@apilink RadiusAroundActorStrategy} on the current camera\r\n   * @param actor Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  public radiusAroundActor(actor: Actor, radius: number) {\r\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the {@apilink LimitCameraBoundsStrategy} on the current camera\r\n   * @param box The bounding box to limit the camera to.\r\n   */\r\n  public limitCameraBounds(box: BoundingBox) {\r\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\r\n  }\r\n}\r\n\r\n/**\r\n * Camera axis enum\r\n */\r\nexport enum Axis {\r\n  X,\r\n  Y\r\n}\r\n\r\n/**\r\n * Lock a camera to the exact x/y position of an actor.\r\n */\r\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor) {}\r\n  public action = (target: Actor, camera: Camera, engine: Engine, elapsed: number) => {\r\n    const center = target.center;\r\n    return center;\r\n  };\r\n}\r\n\r\n/**\r\n * Lock a camera to a specific axis around an actor.\r\n */\r\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\r\n  constructor(\r\n    public target: Actor,\r\n    public axis: Axis\r\n  ) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, elapsed: number) => {\r\n    const center = target.center;\r\n    const currentFocus = cam.getFocus();\r\n    if (this.axis === Axis.X) {\r\n      return new Vector(center.x, currentFocus.y);\r\n    } else {\r\n      return new Vector(currentFocus.x, center.y);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\r\n */\r\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   * @param target Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  constructor(\r\n    public target: Actor,\r\n    public cameraElasticity: number,\r\n    public cameraFriction: number\r\n  ) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, elapsed: number) => {\r\n    const position = target.center;\r\n    let focus = cam.getFocus();\r\n    let cameraVel = cam.vel.clone();\r\n\r\n    // Calculate the stretch vector, using the spring equation\r\n    // F = kX\r\n    // https://en.wikipedia.org/wiki/Hooke's_law\r\n    // Apply to the current camera velocity\r\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\r\n    cameraVel = cameraVel.add(stretch);\r\n\r\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\r\n    // Apply to the current camera velocity\r\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\r\n    cameraVel = cameraVel.add(friction);\r\n\r\n    // Update position by velocity deltas\r\n    focus = focus.add(cameraVel);\r\n\r\n    return focus;\r\n  };\r\n}\r\n\r\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   *\r\n   * @param target Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  constructor(\r\n    public target: Actor,\r\n    public radius: number\r\n  ) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, elapsed: number) => {\r\n    const position = target.center;\r\n    const focus = cam.getFocus();\r\n\r\n    const direction = position.sub(focus);\r\n    const distance = direction.magnitude;\r\n    if (distance >= this.radius) {\r\n      const offset = distance - this.radius;\r\n      return focus.add(direction.normalize().scale(offset));\r\n    }\r\n    return focus;\r\n  };\r\n}\r\n\r\n/**\r\n * Prevent a camera from going beyond the given camera dimensions.\r\n */\r\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\r\n  /**\r\n   * Useful for limiting the camera to a {@apilink TileMap}'s dimensions, or a specific area inside the map.\r\n   *\r\n   * Note that this strategy does not perform any movement by itself.\r\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\r\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\r\n   *\r\n   * Make sure that the camera bounds are at least as large as the viewport size.\r\n   * @param target The bounding box to limit the camera to\r\n   */\r\n\r\n  boundSizeChecked: boolean = false; // Check and warn only once\r\n\r\n  constructor(public target: BoundingBox) {}\r\n\r\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, elapsed: number) => {\r\n    const focus = cam.getFocus();\r\n\r\n    if (!this.boundSizeChecked) {\r\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\r\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\r\n      }\r\n      this.boundSizeChecked = true;\r\n    }\r\n\r\n    let focusX = focus.x;\r\n    let focusY = focus.y;\r\n    if (focus.x < target.left + _eng.halfDrawWidth) {\r\n      focusX = target.left + _eng.halfDrawWidth;\r\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\r\n      focusX = target.right - _eng.halfDrawWidth;\r\n    }\r\n\r\n    if (focus.y < target.top + _eng.halfDrawHeight) {\r\n      focusY = target.top + _eng.halfDrawHeight;\r\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\r\n      focusY = target.bottom - _eng.halfDrawHeight;\r\n    }\r\n\r\n    return vec(focusX, focusY);\r\n  };\r\n}\r\n\r\nexport type CameraEvents = {\r\n  preupdate: PreUpdateEvent<Camera>;\r\n  postupdate: PostUpdateEvent<Camera>;\r\n  initialize: InitializeEvent<Camera>;\r\n};\r\n\r\nexport const CameraEvents = {\r\n  Initialize: 'initialize',\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate'\r\n};\r\n\r\n/**\r\n * Cameras\r\n *\r\n * {@apilink Camera} is the base class for all Excalibur cameras. Cameras are used\r\n * to move around your game and set focus. They are used to determine\r\n * what is \"off screen\" and can be used to scale the game.\r\n *\r\n */\r\nexport class Camera implements CanUpdate, CanInitialize {\r\n  public events = new EventEmitter<CameraEvents>();\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public inverse: AffineMatrix = AffineMatrix.identity();\r\n\r\n  protected _follow: Actor;\r\n\r\n  private _cameraStrategies: CameraStrategy<any>[] = [];\r\n\r\n  public strategy: StrategyContainer = new StrategyContainer(this);\r\n\r\n  /**\r\n   * Get or set current zoom of the camera, defaults to 1\r\n   */\r\n  private _z = 1;\r\n  public get zoom(): number {\r\n    return this._z;\r\n  }\r\n\r\n  public set zoom(val: number) {\r\n    this._z = val;\r\n    if (this._engine) {\r\n      this._halfWidth = this._engine.halfDrawWidth;\r\n      this._halfHeight = this._engine.halfDrawHeight;\r\n    }\r\n  }\r\n  /**\r\n   * Get or set rate of change in zoom, defaults to 0\r\n   */\r\n  public dz: number = 0;\r\n  /**\r\n   * Get or set zoom acceleration\r\n   */\r\n  public az: number = 0;\r\n\r\n  /**\r\n   * Current rotation of the camera\r\n   */\r\n  public rotation: number = 0;\r\n\r\n  private _angularVelocity: number = 0;\r\n\r\n  /**\r\n   * Get or set the camera's angular velocity\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this._angularVelocity;\r\n  }\r\n\r\n  public set angularVelocity(value: number) {\r\n    this._angularVelocity = value;\r\n  }\r\n\r\n  private _posChanged = false;\r\n  private _pos: Vector = new WatchVector(Vector.Zero, () => {\r\n    this._posChanged = true;\r\n  });\r\n  /**\r\n   * Get or set the camera's position\r\n   */\r\n  public get pos(): Vector {\r\n    return this._pos;\r\n  }\r\n  public set pos(vec: Vector) {\r\n    this._posChanged = true;\r\n    this._pos = new WatchVector(vec, () => {\r\n      this._posChanged = true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Has the position changed since the last update\r\n   */\r\n  public hasChanged(): boolean {\r\n    return this._posChanged;\r\n  }\r\n  /**\r\n   * Interpolated camera position if more draws are running than updates\r\n   *\r\n   * Enabled when `Engine.fixedUpdateFps` is enabled, in all other cases this will be the same as pos\r\n   */\r\n  public drawPos: Vector = this.pos.clone();\r\n\r\n  private _oldPos = this.pos.clone();\r\n\r\n  /**\r\n   * Get or set the camera's velocity\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Get or set the camera's acceleration\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  private _cameraMoving: boolean = false;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1000; // 1 second\r\n  private _lerpStart: Vector = null;\r\n  private _lerpEnd: Vector = null;\r\n  private _lerpResolve: (value: Vector) => void;\r\n  private _lerpPromise: Promise<Vector>;\r\n\r\n  //camera effects\r\n  protected _isShaking: boolean = false;\r\n  private _shakeMagnitudeX: number = 0;\r\n  private _shakeMagnitudeY: number = 0;\r\n  private _shakeDuration: number = 0;\r\n  private _elapsedShakeTime: number = 0;\r\n  private _xShake: number = 0;\r\n  private _yShake: number = 0;\r\n\r\n  protected _isZooming: boolean = false;\r\n  private _zoomStart: number = 1;\r\n  private _zoomEnd: number = 1;\r\n  private _currentZoomTime: number = 0;\r\n  private _zoomDuration: number = 0;\r\n\r\n  private _zoomResolve: (val: boolean) => void;\r\n  private _zoomPromise: Promise<boolean>;\r\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n\r\n  private _halfWidth: number = 0;\r\n  private _halfHeight: number = 0;\r\n\r\n  /**\r\n   * Get the camera's x position\r\n   */\r\n  public get x() {\r\n    return this.pos.x;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's x position (cannot be set when following an {@apilink Actor} or when moving)\r\n   */\r\n  public set x(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(value, this.pos.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the camera's y position\r\n   */\r\n  public get y() {\r\n    return this.pos.y;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's y position (cannot be set when following an {@apilink Actor} or when moving)\r\n   */\r\n  public set y(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(this.pos.x, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x velocity\r\n   */\r\n  public get dx() {\r\n    return this.vel.x;\r\n  }\r\n\r\n  public set dx(value: number) {\r\n    this.vel = vec(value, this.vel.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y velocity\r\n   */\r\n  public get dy() {\r\n    return this.vel.y;\r\n  }\r\n\r\n  public set dy(value: number) {\r\n    this.vel = vec(this.vel.x, value);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x acceleration\r\n   */\r\n  public get ax() {\r\n    return this.acc.x;\r\n  }\r\n\r\n  public set ax(value: number) {\r\n    this.acc = vec(value, this.acc.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y acceleration\r\n   */\r\n  public get ay() {\r\n    return this.acc.y;\r\n  }\r\n\r\n  public set ay(value: number) {\r\n    this.acc = vec(this.acc.x, value);\r\n  }\r\n\r\n  /**\r\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\r\n   */\r\n  public getFocus() {\r\n    return this.pos;\r\n  }\r\n\r\n  /**\r\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\r\n   * @param pos The target position to move to\r\n   * @param duration The duration in milliseconds the move should last\r\n   * @param [easingFn] An optional easing function ({@apilink EasingFunctions.EaseInOutCubic} by default)\r\n   * @returns A {@apilink Promise} that resolves when movement is finished, including if it's interrupted.\r\n   *          The {@apilink Promise} value is the {@apilink Vector} of the target position. It will be rejected if a move cannot be made.\r\n   */\r\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\r\n    if (typeof easingFn !== 'function') {\r\n      throw 'Please specify an EasingFunction';\r\n    }\r\n\r\n    // cannot move when following an actor\r\n    if (this._follow) {\r\n      return Promise.reject(pos);\r\n    }\r\n\r\n    // resolve existing promise, if any\r\n    if (this._lerpPromise && this._lerpResolve) {\r\n      this._lerpResolve(pos);\r\n    }\r\n\r\n    this._lerpPromise = new Promise<Vector>((resolve) => {\r\n      this._lerpResolve = resolve;\r\n    });\r\n    this._lerpStart = this.getFocus().clone();\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = pos;\r\n    this._currentLerpTime = 0;\r\n    this._cameraMoving = true;\r\n    this._easing = easingFn;\r\n\r\n    return this._lerpPromise;\r\n  }\r\n\r\n  /**\r\n   * Sets the camera to shake at the specified magnitudes for the specified duration\r\n   * @param magnitudeX  The x magnitude of the shake\r\n   * @param magnitudeY  The y magnitude of the shake\r\n   * @param duration    The duration of the shake in milliseconds\r\n   */\r\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\r\n    this._isShaking = true;\r\n    this._shakeMagnitudeX = magnitudeX;\r\n    this._shakeMagnitudeY = magnitudeY;\r\n    this._shakeDuration = duration;\r\n  }\r\n\r\n  /**\r\n   * Zooms the camera in or out by the specified scale over the specified duration.\r\n   * If no duration is specified, it take effect immediately.\r\n   * @param scale    The scale of the zoom\r\n   * @param duration The duration of the zoom in milliseconds\r\n   */\r\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\r\n    this._zoomPromise = new Promise<boolean>((resolve) => {\r\n      this._zoomResolve = resolve;\r\n    });\r\n\r\n    if (duration) {\r\n      this._isZooming = true;\r\n      this._zoomEasing = easingFn;\r\n      this._currentZoomTime = 0;\r\n      this._zoomDuration = duration;\r\n      this._zoomStart = this.zoom;\r\n      this._zoomEnd = scale;\r\n    } else {\r\n      this._isZooming = false;\r\n      this.zoom = scale;\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    return this._zoomPromise;\r\n  }\r\n\r\n  private _viewport: BoundingBox = null;\r\n  /**\r\n   * Gets the bounding box of the viewport of this camera in world coordinates\r\n   */\r\n  public get viewport(): BoundingBox {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n\r\n    return new BoundingBox(0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Adds a new camera strategy to this camera\r\n   * @param cameraStrategy Instance of an {@apilink CameraStrategy}\r\n   */\r\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    this._cameraStrategies.push(cameraStrategy);\r\n  }\r\n\r\n  /**\r\n   * Removes a camera strategy by reference\r\n   * @param cameraStrategy Instance of an {@apilink CameraStrategy}\r\n   */\r\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\r\n  }\r\n\r\n  /**\r\n   * Clears all camera strategies from the camera\r\n   */\r\n  public clearAllStrategies() {\r\n    this._cameraStrategies.length = 0;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n    this.onPreUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, elapsed: number): void {\r\n    this.events.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n    this.onPostUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  private _engine: Engine;\r\n  private _screen: Screen;\r\n  private _isInitialized = false;\r\n  public get isInitialized() {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this._engine = engine;\r\n      this._screen = engine.screen;\r\n\r\n      const currentRes = this._screen.contentArea;\r\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\r\n      if (!this._engine.loadingComplete) {\r\n        // If there was a loading screen, we peek the configured resolution\r\n        const res = this._screen.peekResolution();\r\n        if (res) {\r\n          center = vec(res.width / 2, res.height / 2);\r\n        }\r\n      }\r\n      this._halfWidth = center.x;\r\n      this._halfHeight = center.y;\r\n\r\n      // If the user has not set the camera pos, apply default center screen position\r\n      if (!this._posChanged) {\r\n        this.pos = center;\r\n      }\r\n      this.pos.clone(this.drawPos);\r\n      // First frame bootstrap\r\n\r\n      // Ensure camera tx is correct\r\n      // Run update twice to ensure properties are init'd\r\n      this.updateTransform(this.pos);\r\n\r\n      // Run strategies for first frame\r\n      this.runStrategies(engine, engine.clock.elapsed());\r\n\r\n      // Setup the first frame viewport\r\n      this.updateViewport();\r\n\r\n      // It's important to update the camera after strategies\r\n      // This prevents jitter\r\n      this.updateTransform(this.pos);\r\n      this.pos.clone(this._oldPos);\r\n\r\n      this.onInitialize(engine);\r\n      this.events.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onInitialize(engine: Engine) {\r\n    // Overridable\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<CameraEvents>>(eventName: TEventName, event: CameraEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<CameraEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<CameraEvents>>(eventName: TEventName, handler: Handler<CameraEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<CameraEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<CameraEvents>>(eventName: TEventName, handler: Handler<CameraEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<CameraEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<CameraEvents>>(eventName: TEventName, handler: Handler<CameraEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<CameraEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  public runStrategies(engine: Engine, elapsed: number) {\r\n    for (const s of this._cameraStrategies) {\r\n      this.pos = s.action.call(s, s.target, this, engine, elapsed);\r\n    }\r\n  }\r\n\r\n  public updateViewport() {\r\n    // recalculate viewport\r\n    this._viewport = new BoundingBox(\r\n      this.x - this._halfWidth,\r\n      this.y - this._halfHeight,\r\n      this.x + this._halfWidth,\r\n      this.y + this._halfHeight\r\n    );\r\n  }\r\n\r\n  public update(engine: Engine, elapsed: number) {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, elapsed);\r\n    this.pos.clone(this._oldPos);\r\n\r\n    // Update placements based on linear algebra\r\n    this.pos = this.pos.add(this.vel.scale(elapsed / 1000));\r\n    this.zoom += (this.dz * elapsed) / 1000;\r\n\r\n    this.vel = this.vel.add(this.acc.scale(elapsed / 1000));\r\n    this.dz += (this.az * elapsed) / 1000;\r\n\r\n    this.rotation += (this.angularVelocity * elapsed) / 1000;\r\n\r\n    if (this._isZooming) {\r\n      if (this._currentZoomTime < this._zoomDuration) {\r\n        const zoomEasing = this._zoomEasing;\r\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\r\n\r\n        this.zoom = newZoom;\r\n        this._currentZoomTime += elapsed;\r\n      } else {\r\n        this._isZooming = false;\r\n        this.zoom = this._zoomEnd;\r\n        this._currentZoomTime = 0;\r\n        this._zoomResolve(true);\r\n      }\r\n    }\r\n\r\n    if (this._cameraMoving) {\r\n      if (this._currentLerpTime < this._lerpDuration) {\r\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n\r\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\r\n\r\n        this.pos = lerpPoint;\r\n\r\n        this._currentLerpTime += elapsed;\r\n      } else {\r\n        this.pos = this._lerpEnd;\r\n        const end = this._lerpEnd.clone();\r\n\r\n        this._lerpStart = null;\r\n        this._lerpEnd = null;\r\n        this._currentLerpTime = 0;\r\n        this._cameraMoving = false;\r\n        // Order matters here, resolve should be last so any chain promises have a clean slate\r\n        this._lerpResolve(end);\r\n      }\r\n    }\r\n\r\n    if (this._isDoneShaking()) {\r\n      this._isShaking = false;\r\n      this._elapsedShakeTime = 0;\r\n      this._shakeMagnitudeX = 0;\r\n      this._shakeMagnitudeY = 0;\r\n      this._shakeDuration = 0;\r\n      this._xShake = 0;\r\n      this._yShake = 0;\r\n    } else {\r\n      this._elapsedShakeTime += elapsed;\r\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\r\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\r\n    }\r\n\r\n    this.runStrategies(engine, elapsed);\r\n\r\n    this.updateViewport();\r\n\r\n    // It's important to update the camera after strategies\r\n    // This prevents jitter\r\n    this.updateTransform(this.pos);\r\n    this._postupdate(engine, elapsed);\r\n    this._posChanged = false;\r\n  }\r\n\r\n  private _snapPos = vec(0, 0);\r\n  /**\r\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\r\n   * @param ctx Canvas context to apply transformations\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext): void {\r\n    // default to the current position\r\n    this.pos.clone(this.drawPos);\r\n\r\n    // interpolation if fixed update is on\r\n    // must happen on the draw, because more draws are potentially happening than updates\r\n    if (this._engine.fixedUpdateTimestep) {\r\n      const blend = this._engine.currentFrameLagMs / this._engine.fixedUpdateTimestep;\r\n      const interpolatedPos = this.pos.scale(blend).add(this._oldPos.scale(1.0 - blend));\r\n      interpolatedPos.clone(this.drawPos);\r\n      this.updateTransform(interpolatedPos);\r\n    }\r\n    // Snap camera to pixel\r\n    if (ctx.snapToPixel) {\r\n      const snapPos = this.drawPos.clone(this._snapPos);\r\n      snapPos.x = ~~(snapPos.x + pixelSnapEpsilon * sign(snapPos.x));\r\n      snapPos.y = ~~(snapPos.y + pixelSnapEpsilon * sign(snapPos.y));\r\n      snapPos.clone(this.drawPos);\r\n      this.updateTransform(snapPos);\r\n    }\r\n    ctx.multiply(this.transform);\r\n  }\r\n\r\n  public updateTransform(pos: Vector) {\r\n    // center the camera\r\n    const newCanvasWidth = this._screen.resolution.width / this.zoom;\r\n    const newCanvasHeight = this._screen.resolution.height / this.zoom;\r\n    const cameraPos = vec(-pos.x + newCanvasWidth / 2 + this._xShake, -pos.y + newCanvasHeight / 2 + this._yShake);\r\n\r\n    // Calculate camera transform\r\n    this.transform.reset();\r\n\r\n    this.transform.scale(this.zoom, this.zoom);\r\n\r\n    // rotate about the focus\r\n    this.transform.translate(newCanvasWidth / 2, newCanvasHeight / 2);\r\n    this.transform.rotate(this.rotation);\r\n    this.transform.translate(-newCanvasWidth / 2, -newCanvasHeight / 2);\r\n\r\n    this.transform.translate(cameraPos.x, cameraPos.y);\r\n    this.transform.inverse(this.inverse);\r\n  }\r\n\r\n  private _isDoneShaking(): boolean {\r\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\r\n  }\r\n}\r\n","import { Vector } from './Math/vector';\r\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { Entity } from './EntityComponentSystem';\r\nimport { Actor, ActorArgs, ActorEvents } from './Actor';\r\nimport { EventEmitter } from './EventEmitter';\r\n\r\nexport type TriggerEvents = ActorEvents & {\r\n  exit: ExitTriggerEvent;\r\n  enter: EnterTriggerEvent;\r\n};\r\n\r\nexport const TriggerEvents = {\r\n  ExitTrigger: 'exit',\r\n  EnterTrigger: 'enter'\r\n};\r\n\r\n/**\r\n * TriggerOptions\r\n */\r\nexport interface TriggerOptions {\r\n  // position of the trigger\r\n  pos: Vector;\r\n  // width of the trigger\r\n  width: number;\r\n  // height of the trigger\r\n  height: number;\r\n  // whether the trigger is visible or not\r\n  visible: boolean;\r\n  // action to take when triggered\r\n  action: (entity: Entity) => void;\r\n  // if specified the trigger will only fire on a specific entity and overrides any filter\r\n  target: Entity;\r\n  // Returns true if the triggers should fire on the collided entity\r\n  filter: (entity: Entity) => boolean;\r\n  // -1 if it should repeat forever\r\n  repeat: number;\r\n}\r\n\r\n/**\r\n * Triggers are a method of firing arbitrary code on collision. These are useful\r\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\r\n * are invisible, and can only be seen when {@apilink Trigger.visible} is set to `true`.\r\n */\r\nexport class Trigger extends Actor {\r\n  public events = new EventEmitter<TriggerEvents & ActorEvents>();\r\n  public target?: Entity;\r\n  /**\r\n   * Action to fire when triggered by collision\r\n   */\r\n  public action: (entity: Entity) => void;\r\n  /**\r\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\r\n   * filter return true for the collided entity.\r\n   */\r\n  public filter: (entity: Entity) => boolean;\r\n  /**\r\n   * Number of times to repeat before killing the trigger,\r\n   */\r\n  public repeat: number;\r\n\r\n  /**\r\n   * @param options Trigger options\r\n   */\r\n  constructor(options: Partial<TriggerOptions> & ActorArgs) {\r\n    super({ ...options });\r\n\r\n    this.filter = options.filter ?? (() => true);\r\n    this.repeat = options.repeat ?? -1;\r\n    this.action = options.action ?? (() => undefined);\r\n    this.target = options.target;\r\n\r\n    this.graphics.isVisible = options.visible ?? false;\r\n    this.body.collisionType = CollisionType.Passive;\r\n\r\n    this.events.on('collisionstart', ({ other: collider }: CollisionStartEvent) => {\r\n      if (!this._matchesTarget(collider.owner)) {\r\n        return;\r\n      }\r\n\r\n      this.events.emit('enter', new EnterTriggerEvent(this, collider.owner));\r\n      this._dispatchAction(collider.owner);\r\n      // remove trigger if its done, -1 repeat forever\r\n      if (this.repeat === 0) {\r\n        this.kill();\r\n      }\r\n    });\r\n\r\n    this.events.on('collisionend', ({ other: collider }: CollisionEndEvent) => {\r\n      if (this._matchesTarget(collider.owner)) {\r\n        this.events.emit('exit', new ExitTriggerEvent(this, collider.owner));\r\n      }\r\n    });\r\n  }\r\n\r\n  private _matchesTarget(entity: Entity): boolean {\r\n    return this.filter(entity) && (this.target === undefined || this.target === entity);\r\n  }\r\n\r\n  private _dispatchAction(target: Entity) {\r\n    if (this.repeat !== 0) {\r\n      this.action.call(this, target);\r\n      this.repeat--;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Higher priorities run earlier than others in the system update\r\n */\r\nexport const SystemPriority = {\r\n  Highest: -Infinity,\r\n  Higher: -5,\r\n  Average: 0,\r\n  Lower: 5,\r\n  Lowest: Infinity\r\n} as const;\r\n","import { Scene } from '../Scene';\r\nimport { SystemPriority } from './Priority';\r\nimport { World } from './World';\r\n\r\n/**\r\n * Enum that determines whether to run the system in the update or draw phase\r\n */\r\nexport enum SystemType {\r\n  Update = 'update',\r\n  Draw = 'draw'\r\n}\r\n\r\n/**\r\n * An Excalibur {@apilink System} that updates entities of certain types.\r\n * Systems are scene specific\r\n *\r\n *\r\n *\r\n * Excalibur Systems currently require at least 1 Component type to operated\r\n *\r\n * Multiple types are declared as a type union\r\n * For example:\r\n *\r\n * ```typescript\r\n * class MySystem extends System {\r\n *   static priority = SystemPriority.Lowest;\r\n *   public readonly systemType = SystemType.Update;\r\n *   public query: Query<typeof TransformComponent>;\r\n *   constructor(public world: World) {\r\n *   super();\r\n *      this.query = this.world.query([TransformComponent]);\r\n *   }\r\n *   public update(elapsed: number) {\r\n *      ...\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport abstract class System {\r\n  /**\r\n   * Determine whether the system is called in the {@apilink SystemType.Update} or the {@apilink SystemType.Draw} phase. Update is first, then Draw.\r\n   */\r\n  abstract readonly systemType: SystemType;\r\n\r\n  /**\r\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\r\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\r\n   * For a system to execute after all other a higher priority value (10 for example) must be set.\r\n   */\r\n  public static priority: number = SystemPriority.Average;\r\n\r\n  /**\r\n   * Optionally specify an initialize handler\r\n   * @param scene\r\n   */\r\n  initialize?(world: World, scene: Scene): void;\r\n\r\n  /**\r\n   * Update all entities that match this system's types\r\n   * @param elapsed Time in milliseconds\r\n   */\r\n  abstract update(elapsed: number): void;\r\n\r\n  /**\r\n   * Optionally run a preupdate before the system processes matching entities\r\n   * @param scene\r\n   * @param elapsed Time in milliseconds since the last frame\r\n   */\r\n  preupdate?(scene: Scene, elapsed: number): void;\r\n\r\n  /**\r\n   * Optionally run a postupdate after the system processes matching entities\r\n   * @param scene\r\n   * @param elapsed Time in milliseconds since the last frame\r\n   */\r\n  postupdate?(scene: Scene, elapsed: number): void;\r\n}\r\n","import { Entity } from './Entity';\r\nimport { World } from './World';\r\nimport { removeItemFromArray } from '../Util/Util';\r\nimport { Scene } from '../Scene';\r\n\r\n// Add/Remove entities and components\r\n\r\nexport class EntityManager {\r\n  public entities: Entity[] = [];\r\n  public _entityIndex: { [entityId: string]: Entity } = {};\r\n  private _childAddedHandlerMap = new Map<Entity, (entity: Entity) => void>();\r\n  private _childRemovedHandlerMap = new Map<Entity, (entity: Entity) => void>();\r\n\r\n  constructor(private _world: World) {}\r\n\r\n  /**\r\n   * Runs the entity lifecycle\r\n   * @param scene\r\n   * @param elapsed\r\n   */\r\n  public updateEntities(scene: Scene, elapsed: number) {\r\n    for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\r\n      const entity = this.entities[entityIndex];\r\n      entity.update(scene.engine, elapsed);\r\n      if (!entity.isActive) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  public findEntitiesForRemoval() {\r\n    for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\r\n      const entity = this.entities[entityIndex];\r\n      if (!entity.isActive) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _createChildAddedHandler = () => (e: Entity) => {\r\n    this.addEntity(e);\r\n  };\r\n\r\n  private _createChildRemovedHandler = () => (e: Entity) => {\r\n    this.removeEntity(e, false);\r\n  };\r\n\r\n  /**\r\n   * Adds an entity to be tracked by the EntityManager\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    entity.isActive = true;\r\n    entity.scene = this._world.scene;\r\n    if (entity && !this._entityIndex[entity.id]) {\r\n      this._entityIndex[entity.id] = entity;\r\n      this.entities.push(entity);\r\n      this._world.queryManager.addEntity(entity);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => {\r\n        c.scene = entity.scene;\r\n        this.addEntity(c);\r\n      });\r\n      const childAdded = this._createChildAddedHandler();\r\n      this._childAddedHandlerMap.set(entity, childAdded);\r\n      const childRemoved = this._createChildRemovedHandler();\r\n      this._childRemovedHandlerMap.set(entity, childRemoved);\r\n      entity.childrenAdded$.subscribe(childAdded);\r\n      entity.childrenRemoved$.subscribe(childRemoved);\r\n    }\r\n  }\r\n\r\n  public removeEntity(entity: Entity, deferred?: boolean): void;\r\n  public removeEntity(id: number, deferred?: boolean): void;\r\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\r\n    let id = 0;\r\n    if (idOrEntity instanceof Entity) {\r\n      id = idOrEntity.id;\r\n    } else {\r\n      id = idOrEntity;\r\n    }\r\n    const entity = this._entityIndex[id];\r\n    if (entity && entity.isActive) {\r\n      entity.isActive = false;\r\n    }\r\n\r\n    if (entity && deferred) {\r\n      this._entitiesToRemove.push(entity);\r\n      return;\r\n    }\r\n\r\n    delete this._entityIndex[id];\r\n    if (entity) {\r\n      entity.scene = null;\r\n      removeItemFromArray(entity, this.entities);\r\n      this._world.queryManager.removeEntity(entity);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => {\r\n        c.scene = null;\r\n        this.removeEntity(c, deferred);\r\n      });\r\n      const childAddedHandler = this._childAddedHandlerMap.get(entity);\r\n      if (childAddedHandler) {\r\n        entity.childrenAdded$.unsubscribe(childAddedHandler);\r\n      }\r\n      const childRemovedHandler = this._childRemovedHandlerMap.get(entity);\r\n      if (childRemovedHandler) {\r\n        entity.childrenRemoved$.unsubscribe(childRemovedHandler);\r\n      }\r\n\r\n      // stats\r\n      if (this._world?.scene?.engine) {\r\n        this._world.scene.engine.stats.currFrame.actors.killed++;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _entitiesToRemove: Entity[] = [];\r\n  public processEntityRemovals(): void {\r\n    for (let entityIndex = 0; entityIndex < this._entitiesToRemove.length; entityIndex++) {\r\n      const entity = this._entitiesToRemove[entityIndex];\r\n      if (entity.isActive) {\r\n        continue;\r\n      }\r\n      this.removeEntity(entity, false);\r\n    }\r\n    this._entitiesToRemove.length = 0;\r\n  }\r\n\r\n  public processComponentRemovals(): void {\r\n    for (let entityIndex = 0; entityIndex < this.entities.length; entityIndex++) {\r\n      const entity = this.entities[entityIndex];\r\n      entity.processComponentRemoval();\r\n    }\r\n  }\r\n\r\n  public getById(id: number): Entity | undefined {\r\n    return this._entityIndex[id];\r\n  }\r\n\r\n  public getByName(name: string): Entity[] {\r\n    return this.entities.filter((e) => e.name === name);\r\n  }\r\n\r\n  public clear(): void {\r\n    for (let i = this.entities.length - 1; i >= 0; i--) {\r\n      this.removeEntity(this.entities[i]);\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { Observable } from '../Util/Observable';\r\nimport { Component, ComponentCtor } from '../EntityComponentSystem/Component';\r\n\r\nexport type ComponentInstance<T> = T extends ComponentCtor<infer R> ? R : never;\r\n\r\n/**\r\n * Represents query for entities that match a list of types that is cached and observable\r\n *\r\n * Queries can be strongly typed by supplying a type union in the optional type parameter\r\n * ```typescript\r\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\r\n * ```\r\n */\r\nexport class Query<TKnownComponentCtors extends ComponentCtor<Component> = never> {\r\n  public readonly id: string;\r\n  public components = new Set<TKnownComponentCtors>();\r\n  public entities: Entity<ComponentInstance<TKnownComponentCtors>>[] = [];\r\n  /**\r\n   * This fires right after the component is added\r\n   */\r\n  public entityAdded$ = new Observable<Entity<ComponentInstance<TKnownComponentCtors>>>();\r\n  /**\r\n   * This fires right before the component is actually removed from the entity, it will still be available for cleanup purposes\r\n   */\r\n  public entityRemoved$ = new Observable<Entity<ComponentInstance<TKnownComponentCtors>>>();\r\n\r\n  constructor(public readonly requiredComponents: TKnownComponentCtors[]) {\r\n    if (requiredComponents.length === 0) {\r\n      throw new Error('Cannot create query without components');\r\n    }\r\n    for (const type of requiredComponents) {\r\n      this.components.add(type);\r\n    }\r\n\r\n    this.id = Query.createId(requiredComponents);\r\n  }\r\n\r\n  static createId(requiredComponents: Function[]) {\r\n    // TODO what happens if a user defines the same type name as a built in type\r\n    // ! TODO this could be dangerous depending on the bundler's settings for names\r\n    // Maybe some kind of hash function is better here?\r\n    return requiredComponents\r\n      .slice()\r\n      .map((c) => c.name)\r\n      .sort()\r\n      .join('-');\r\n  }\r\n\r\n  /**\r\n   * Potentially adds an entity to a query index, returns true if added, false if not\r\n   * @param entity\r\n   */\r\n  checkAndAdd(entity: Entity) {\r\n    if (!this.entities.includes(entity) && entity.hasAll(Array.from(this.components))) {\r\n      this.entities.push(entity);\r\n      this.entityAdded$.notifyAll(entity);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  removeEntity(entity: Entity) {\r\n    const index = this.entities.indexOf(entity);\r\n    if (index > -1) {\r\n      this.entities.splice(index, 1);\r\n      this.entityRemoved$.notifyAll(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity<ComponentInstance<TKnownComponentCtors>>[] {\r\n    if (sort) {\r\n      this.entities.sort(sort);\r\n    }\r\n    return this.entities;\r\n  }\r\n}\r\n","import { Observable } from '../Util/Observable';\r\nimport { Entity } from './Entity';\r\n\r\nexport class TagQuery<TKnownTags extends string = never> {\r\n  public readonly id: string;\r\n  public tags = new Set<TKnownTags>();\r\n  public entities: Entity<any>[] = [];\r\n  /**\r\n   * This fires right after the component is added\r\n   */\r\n  public entityAdded$ = new Observable<Entity<any>>();\r\n  /**\r\n   * This fires right before the component is actually removed from the entity, it will still be available for cleanup purposes\r\n   */\r\n  public entityRemoved$ = new Observable<Entity<any>>();\r\n\r\n  constructor(public readonly requiredTags: TKnownTags[]) {\r\n    if (requiredTags.length === 0) {\r\n      throw new Error('Cannot create tag query without tags');\r\n    }\r\n    for (const tag of requiredTags) {\r\n      this.tags.add(tag);\r\n    }\r\n\r\n    this.id = TagQuery.createId(requiredTags);\r\n  }\r\n\r\n  static createId(requiredComponents: string[]) {\r\n    return requiredComponents.slice().sort().join('-');\r\n  }\r\n\r\n  checkAndAdd(entity: Entity) {\r\n    if (!this.entities.includes(entity) && entity.hasAllTags(Array.from(this.tags))) {\r\n      this.entities.push(entity);\r\n      this.entityAdded$.notifyAll(entity);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  removeEntity(entity: Entity) {\r\n    const index = this.entities.indexOf(entity);\r\n    if (index > -1) {\r\n      this.entities.splice(index, 1);\r\n      this.entityRemoved$.notifyAll(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity<any>[] {\r\n    if (sort) {\r\n      this.entities.sort(sort);\r\n    }\r\n    return this.entities;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { Query } from './Query';\r\nimport { Component, ComponentCtor } from './Component';\r\nimport { World } from './World';\r\nimport { TagQuery } from './TagQuery';\r\n\r\n/**\r\n * The query manager is responsible for updating all queries when entities/components change\r\n */\r\nexport class QueryManager {\r\n  private _queries = new Map<string, Query<any>>();\r\n  private _addComponentHandlers = new Map<Entity, (c: Component) => any>();\r\n  private _removeComponentHandlers = new Map<Entity, (c: Component) => any>();\r\n  private _componentToQueriesIndex = new Map<ComponentCtor<any>, Query<any>[]>();\r\n\r\n  private _tagQueries = new Map<string, TagQuery<any>>();\r\n  private _addTagHandlers = new Map<Entity, (tag: string) => any>();\r\n  private _removeTagHandlers = new Map<Entity, (tag: string) => any>();\r\n  private _tagToQueriesIndex = new Map<string, TagQuery<any>[]>();\r\n\r\n  constructor(private _world: World) {}\r\n\r\n  public createQuery<TKnownComponentCtors extends ComponentCtor<Component>>(\r\n    requiredComponents: TKnownComponentCtors[]\r\n  ): Query<TKnownComponentCtors> {\r\n    const id = Query.createId(requiredComponents);\r\n    if (this._queries.has(id)) {\r\n      // short circuit if query is already created\r\n      return this._queries.get(id) as Query<TKnownComponentCtors>;\r\n    }\r\n\r\n    const query = new Query(requiredComponents);\r\n\r\n    this._queries.set(query.id, query);\r\n\r\n    // index maintenance\r\n    for (const component of requiredComponents) {\r\n      const queries = this._componentToQueriesIndex.get(component);\r\n      if (!queries) {\r\n        this._componentToQueriesIndex.set(component, [query]);\r\n      } else {\r\n        queries.push(query);\r\n      }\r\n    }\r\n\r\n    for (const entity of this._world.entities) {\r\n      this.addEntity(entity);\r\n    }\r\n\r\n    return query;\r\n  }\r\n\r\n  public createTagQuery<TKnownTags extends string>(requiredTags: TKnownTags[]): TagQuery<TKnownTags> {\r\n    const id = TagQuery.createId(requiredTags);\r\n    if (this._tagQueries.has(id)) {\r\n      // short circuit if query is already created\r\n      return this._tagQueries.get(id) as TagQuery<TKnownTags>;\r\n    }\r\n\r\n    const query = new TagQuery(requiredTags);\r\n\r\n    this._tagQueries.set(query.id, query);\r\n\r\n    // index maintenance\r\n    for (const tag of requiredTags) {\r\n      const queries = this._tagToQueriesIndex.get(tag);\r\n      if (!queries) {\r\n        this._tagToQueriesIndex.set(tag, [query]);\r\n      } else {\r\n        queries.push(query);\r\n      }\r\n    }\r\n\r\n    for (const entity of this._world.entities) {\r\n      this.addEntity(entity);\r\n    }\r\n\r\n    return query;\r\n  }\r\n\r\n  private _createAddComponentHandler = (entity: Entity) => (c: Component) => {\r\n    this.addComponent(entity, c);\r\n  };\r\n\r\n  private _createRemoveComponentHandler = (entity: Entity) => (c: Component) => {\r\n    this.removeComponent(entity, c);\r\n  };\r\n\r\n  private _createAddTagHandler = (entity: Entity) => (tag: string) => {\r\n    this.addTag(entity, tag);\r\n  };\r\n\r\n  private _createRemoveTagHandler = (entity: Entity) => (tag: string) => {\r\n    this.removeTag(entity, tag);\r\n  };\r\n\r\n  /**\r\n   * Scans queries and locates any that need this entity added\r\n   * @param entity\r\n   */\r\n  addEntity(entity: Entity) {\r\n    const maybeAddComponent = this._addComponentHandlers.get(entity);\r\n    const maybeRemoveComponent = this._removeComponentHandlers.get(entity);\r\n    const addComponent = maybeAddComponent ?? this._createAddComponentHandler(entity);\r\n    const removeComponent = maybeRemoveComponent ?? this._createRemoveComponentHandler(entity);\r\n    this._addComponentHandlers.set(entity, addComponent);\r\n    this._removeComponentHandlers.set(entity, removeComponent);\r\n\r\n    const maybeAddTag = this._addTagHandlers.get(entity);\r\n    const maybeRemoveTag = this._removeTagHandlers.get(entity);\r\n    const addTag = maybeAddTag ?? this._createAddTagHandler(entity);\r\n    const removeTag = maybeRemoveTag ?? this._createRemoveTagHandler(entity);\r\n    this._addTagHandlers.set(entity, addTag);\r\n    this._removeTagHandlers.set(entity, removeTag);\r\n\r\n    for (const query of this._queries.values()) {\r\n      query.checkAndAdd(entity);\r\n    }\r\n    for (const tagQuery of this._tagQueries.values()) {\r\n      tagQuery.checkAndAdd(entity);\r\n    }\r\n    entity.componentAdded$.subscribe(addComponent);\r\n    entity.componentRemoved$.subscribe(removeComponent);\r\n    entity.tagAdded$.subscribe(addTag);\r\n    entity.tagRemoved$.subscribe(removeTag);\r\n  }\r\n\r\n  /**\r\n   * Scans queries and locates any that need this entity removed\r\n   * @param entity\r\n   */\r\n  removeEntity(entity: Entity) {\r\n    // Handle components\r\n    const addComponent = this._addComponentHandlers.get(entity);\r\n    const removeComponent = this._removeComponentHandlers.get(entity);\r\n    for (const query of this._queries.values()) {\r\n      query.removeEntity(entity);\r\n    }\r\n    if (addComponent) {\r\n      entity.componentAdded$.unsubscribe(addComponent);\r\n    }\r\n    if (removeComponent) {\r\n      entity.componentRemoved$.unsubscribe(removeComponent);\r\n    }\r\n\r\n    // Handle tags\r\n    const addTag = this._addTagHandlers.get(entity);\r\n    const removeTag = this._removeTagHandlers.get(entity);\r\n    for (const tagQuery of this._tagQueries.values()) {\r\n      tagQuery.removeEntity(entity);\r\n    }\r\n\r\n    if (addTag) {\r\n      entity.tagAdded$.unsubscribe(addTag);\r\n    }\r\n    if (removeTag) {\r\n      entity.tagRemoved$.unsubscribe(removeTag);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates any queries when a component is added to an entity\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  addComponent(entity: Entity, component: Component) {\r\n    const queries = this._componentToQueriesIndex.get(component.constructor as ComponentCtor<any>) ?? [];\r\n    for (const query of queries) {\r\n      query.checkAndAdd(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates any queries when a component is removed from an entity\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  removeComponent(entity: Entity, component: Component) {\r\n    const queries = this._componentToQueriesIndex.get(component.constructor as ComponentCtor<any>) ?? [];\r\n    for (const query of queries) {\r\n      query.removeEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates any queries when a tag is added to an entity\r\n   * @param entity\r\n   * @param tag\r\n   */\r\n  addTag(entity: Entity, tag: string) {\r\n    const queries = this._tagToQueriesIndex.get(tag) ?? [];\r\n    for (const query of queries) {\r\n      query.checkAndAdd(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates any queries when a component is removed from an entity\r\n   * @param entity\r\n   * @param tag\r\n   */\r\n  removeTag(entity: Entity, tag: string) {\r\n    const queries = this._tagToQueriesIndex.get(tag) ?? [];\r\n    for (const query of queries) {\r\n      query.removeEntity(entity);\r\n    }\r\n  }\r\n}\r\n","import { System, SystemType } from './System';\r\nimport { Scene } from '../Scene';\r\nimport { World } from './World';\r\nimport { removeItemFromArray } from '../Util/Util';\r\n\r\nexport interface SystemCtor<T extends System> {\r\n  new (...args: any[]): T;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function isSystemConstructor(x: any): x is SystemCtor<System> {\r\n  return !!x?.prototype && !!x?.prototype?.constructor?.name;\r\n}\r\n\r\n/**\r\n * The SystemManager is responsible for keeping track of all systems in a scene.\r\n * Systems are scene specific\r\n */\r\nexport class SystemManager {\r\n  /**\r\n   * List of systems, to add a new system call {@apilink SystemManager.addSystem}\r\n   */\r\n  public systems: System[] = [];\r\n  public initialized = false;\r\n  constructor(private _world: World) {}\r\n\r\n  /**\r\n   * Get a system registered in the manager by type\r\n   * @param systemType\r\n   */\r\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\r\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\r\n  }\r\n\r\n  /**\r\n   * Adds a system to the manager, it will now be updated every frame\r\n   * @param systemOrCtor\r\n   */\r\n  public addSystem(systemOrCtor: SystemCtor<System> | System): void {\r\n    let system: System;\r\n    if (systemOrCtor instanceof System) {\r\n      system = systemOrCtor;\r\n    } else {\r\n      system = new systemOrCtor(this._world);\r\n    }\r\n\r\n    this.systems.push(system);\r\n    this.systems.sort((a, b) => (a.constructor as typeof System).priority - (b.constructor as typeof System).priority);\r\n    // If systems are added and the manager has already been init'd\r\n    // then immediately init the system\r\n    if (this.initialized && system.initialize) {\r\n      system.initialize(this._world, this._world.scene);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a system from the manager, it will no longer be updated\r\n   * @param system\r\n   */\r\n  public removeSystem(system: System) {\r\n    removeItemFromArray(system, this.systems);\r\n  }\r\n\r\n  /**\r\n   * Initialize all systems in the manager\r\n   *\r\n   * Systems added after initialize() will be initialized on add\r\n   */\r\n  public initialize() {\r\n    if (!this.initialized) {\r\n      this.initialized = true;\r\n      for (const s of this.systems) {\r\n        if (s.initialize) {\r\n          s.initialize(this._world, this._world.scene);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates all systems\r\n   * @param type whether this is an update or draw system\r\n   * @param scene context reference\r\n   * @param elapsed time in milliseconds\r\n   */\r\n  public updateSystems(type: SystemType, scene: Scene, elapsed: number) {\r\n    const systems = this.systems.filter((s) => s.systemType === type);\r\n    for (const s of systems) {\r\n      if (s.preupdate) {\r\n        s.preupdate(scene, elapsed);\r\n      }\r\n    }\r\n\r\n    for (const s of systems) {\r\n      s.update(elapsed);\r\n    }\r\n\r\n    for (const s of systems) {\r\n      if (s.postupdate) {\r\n        s.postupdate(scene, elapsed);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    for (let i = this.systems.length - 1; i >= 0; i--) {\r\n      this.removeSystem(this.systems[i]);\r\n    }\r\n  }\r\n}\r\n","import { Scene } from '../Scene';\r\nimport { Logger } from '../Util/Log';\r\nimport { Component, ComponentCtor } from './Component';\r\nimport { Entity } from './Entity';\r\nimport { EntityManager } from './EntityManager';\r\nimport { Query } from './Query';\r\nimport { QueryManager } from './QueryManager';\r\nimport { System, SystemType } from './System';\r\nimport { SystemCtor, SystemManager, isSystemConstructor } from './SystemManager';\r\nimport { TagQuery } from './TagQuery';\r\n\r\n/**\r\n * The World is a self-contained entity component system for a particular context.\r\n */\r\nexport class World {\r\n  private _logger = Logger.getInstance();\r\n  public queryManager: QueryManager = new QueryManager(this);\r\n  public entityManager: EntityManager = new EntityManager(this);\r\n  public systemManager: SystemManager = new SystemManager(this);\r\n\r\n  /**\r\n   * The context type is passed to the system updates\r\n   * @param scene\r\n   */\r\n  constructor(public scene: Scene) {}\r\n\r\n  /**\r\n   * Query the ECS world for entities that match your components\r\n   * @param requiredTypes\r\n   */\r\n  query<TKnownComponentCtors extends ComponentCtor<Component>>(requiredTypes: TKnownComponentCtors[]): Query<TKnownComponentCtors> {\r\n    return this.queryManager.createQuery(requiredTypes);\r\n  }\r\n\r\n  queryTags<TKnownTags extends string>(requiredTags: TKnownTags[]): TagQuery<TKnownTags> {\r\n    return this.queryManager.createTagQuery(requiredTags);\r\n  }\r\n\r\n  /**\r\n   * Update systems by type and time elapsed in milliseconds\r\n   */\r\n  update(type: SystemType, elapsed: number) {\r\n    if (type === SystemType.Update) {\r\n      this.entityManager.updateEntities(this.scene, elapsed);\r\n    }\r\n    this.systemManager.updateSystems(type, this.scene, elapsed);\r\n    this.entityManager.findEntitiesForRemoval();\r\n    this.entityManager.processComponentRemovals();\r\n    this.entityManager.processEntityRemovals();\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the ECS world\r\n   * @param entity\r\n   */\r\n  add(entity: Entity): void;\r\n  /**\r\n   * Add a system to the ECS world\r\n   * @param system\r\n   */\r\n  add(system: System): void;\r\n  add(system: SystemCtor<System>): void;\r\n  add(entityOrSystem: Entity | System | SystemCtor<System>): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.addEntity(entityOrSystem);\r\n      return;\r\n    }\r\n\r\n    if (entityOrSystem instanceof System || isSystemConstructor(entityOrSystem)) {\r\n      this.systemManager.addSystem(entityOrSystem);\r\n      return;\r\n    }\r\n\r\n    this._logger.warn(\r\n      `Could not add entity/system ${(entityOrSystem as any).constructor.name} to Excalibur!\\n\\n` +\r\n        `If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.\\n\\n` +\r\n        `Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get a system out of the ECS world\r\n   */\r\n  get(system: SystemCtor<System>) {\r\n    return this.systemManager.get(system);\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from the ECS world\r\n   * @param entity\r\n   */\r\n  remove(entity: Entity, deferred?: boolean): void;\r\n  /**\r\n   * Remove a system from the ECS world\r\n   * @param system\r\n   */\r\n  remove(system: System): void;\r\n  remove(entityOrSystem: Entity | System, deferred = true): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.removeEntity(entityOrSystem, deferred);\r\n      return;\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.removeSystem(entityOrSystem);\r\n      return;\r\n    }\r\n\r\n    this._logger.warn(\r\n      `Could not remove entity/system ${(entityOrSystem as any).constructor.name} to Excalibur!\\n\\n` +\r\n        `If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.\\n\\n` +\r\n        `Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`\r\n    );\r\n  }\r\n\r\n  get entities() {\r\n    return this.entityManager.entities;\r\n  }\r\n\r\n  clearEntities(): void {\r\n    this.entityManager.clear();\r\n  }\r\n\r\n  clearSystems(): void {\r\n    this.systemManager.clear();\r\n  }\r\n}\r\n","import { Entity, Query, SystemPriority, World } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { CollisionType } from './CollisionType';\r\nimport { EulerIntegrator } from './Integrator';\r\nimport { PhysicsWorld } from './PhysicsWorld';\r\n\r\nexport class MotionSystem extends System {\r\n  static priority = SystemPriority.Higher;\r\n\r\n  public systemType = SystemType.Update;\r\n  private _physicsConfigDirty = false;\r\n  query: Query<typeof TransformComponent | typeof MotionComponent>;\r\n  constructor(\r\n    public world: World,\r\n    public physics: PhysicsWorld\r\n  ) {\r\n    super();\r\n    physics.$configUpdate.subscribe(() => (this._physicsConfigDirty = true));\r\n    this.query = this.world.query([TransformComponent, MotionComponent]);\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    let transform: TransformComponent;\r\n    let motion: MotionComponent;\r\n    const entities = this.query.entities;\r\n    const substep = this.physics.config.substep;\r\n\r\n    for (let i = 0; i < entities.length; i++) {\r\n      transform = entities[i].get(TransformComponent);\r\n      motion = entities[i].get(MotionComponent);\r\n\r\n      const optionalBody = entities[i].get(BodyComponent);\r\n      if (this._physicsConfigDirty && optionalBody) {\r\n        optionalBody.updatePhysicsConfig(this.physics.config.bodies);\r\n      }\r\n\r\n      if (optionalBody?.isSleeping) {\r\n        continue;\r\n      }\r\n\r\n      const totalAcc = motion.acc.clone();\r\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\r\n        totalAcc.addEqual(this.physics.config.gravity);\r\n      }\r\n\r\n      // capture old transform of this entity and all of its children so that\r\n      // any transform properties that derived from their parents are properly captured\r\n      if (!entities[i].parent) {\r\n        this.captureOldTransformWithChildren(entities[i]);\r\n      }\r\n\r\n      // Update transform and motion based on Euler linear algebra\r\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsed / substep);\r\n    }\r\n    this._physicsConfigDirty = false;\r\n  }\r\n\r\n  captureOldTransformWithChildren(entity: Entity) {\r\n    entity.get(BodyComponent)?.captureOldTransform();\r\n\r\n    for (let i = 0; i < entity.children.length; i++) {\r\n      this.captureOldTransformWithChildren(entity.children[i]);\r\n    }\r\n  }\r\n}\r\n","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { ContactBias, ContactSolveBias, HorizontalFirst, None, VerticalFirst } from './ContactBias';\r\nimport { PhysicsConfig } from '../PhysicsConfig';\r\nimport { DeepRequired } from '../../Util/Required';\r\n\r\n/**\r\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\r\n * and negates velocity along the collision normal.\r\n *\r\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\r\n *\r\n */\r\nexport class ArcadeSolver implements CollisionSolver {\r\n  directionMap = new Map<string, 'horizontal' | 'vertical'>();\r\n  distanceMap = new Map<string, number>();\r\n\r\n  constructor(public config: DeepRequired<Pick<PhysicsConfig, 'arcade'>['arcade']>) {}\r\n\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter((c) => !c.isCanceled());\r\n\r\n    // Locate collision bias order\r\n    let bias: ContactBias;\r\n    switch (this.config.contactSolveBias) {\r\n      case ContactSolveBias.HorizontalFirst: {\r\n        bias = HorizontalFirst;\r\n        break;\r\n      }\r\n      case ContactSolveBias.VerticalFirst: {\r\n        bias = VerticalFirst;\r\n        break;\r\n      }\r\n      default: {\r\n        bias = None;\r\n      }\r\n    }\r\n\r\n    // Sort by bias (None, VerticalFirst, HorizontalFirst) to avoid artifacts with seams\r\n    // Sort contacts by distance to avoid artifacts with seams\r\n    // It's important to solve in a specific order\r\n    contacts.sort((a, b) => {\r\n      const aDir = this.directionMap.get(a.id);\r\n      const bDir = this.directionMap.get(b.id);\r\n      const aDist = this.distanceMap.get(a.id);\r\n      const bDist = this.distanceMap.get(b.id);\r\n      return bias[aDir] - bias[bDir] || aDist - bDist;\r\n    });\r\n\r\n    for (const contact of contacts) {\r\n      // Solve position first in arcade\r\n      this.solvePosition(contact);\r\n\r\n      // Solve velocity second in arcade\r\n      this.solveVelocity(contact);\r\n    }\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n\r\n  public preSolve(contacts: CollisionContact[]) {\r\n    const epsilon = 0.0001;\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\r\n        // Cancel near 0 mtv collisions\r\n        contact.cancel();\r\n        continue;\r\n      }\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n\r\n      const distance = Math.abs(contact.info.separation);\r\n      this.distanceMap.set(contact.id, distance);\r\n\r\n      this.directionMap.set(contact.id, side === Side.Left || side === Side.Right ? 'horizontal' : 'vertical');\r\n\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv, contact));\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate(), contact)\r\n      );\r\n    }\r\n  }\r\n\r\n  public postSolve(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      if (contact.isCanceled()) {\r\n        continue;\r\n      }\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv, contact));\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate(), contact)\r\n      );\r\n    }\r\n  }\r\n\r\n  public solvePosition(contact: CollisionContact) {\r\n    const epsilon = 0.0001;\r\n    // if bounds no longer intersect skip to the next\r\n    // this removes jitter from overlapping/stacked solid tiles or a wall of solid tiles\r\n    if (!contact.colliderA.bounds.overlaps(contact.colliderB.bounds, epsilon)) {\r\n      // Cancel the contact to prevent and solving\r\n      contact.cancel();\r\n      return;\r\n    }\r\n\r\n    if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\r\n      // Cancel near 0 mtv collisions\r\n      contact.cancel();\r\n      return;\r\n    }\r\n\r\n    let mtv = contact.mtv;\r\n    const colliderA = contact.colliderA;\r\n    const colliderB = contact.colliderB;\r\n    const bodyA = colliderA.owner?.get(BodyComponent);\r\n    const bodyB = colliderB.owner?.get(BodyComponent);\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n        return;\r\n      }\r\n\r\n      if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\r\n        // split overlaps if both are Active\r\n        mtv = mtv.scale(0.5);\r\n      }\r\n\r\n      // Resolve overlaps\r\n      if (bodyA.collisionType === CollisionType.Active) {\r\n        bodyA.globalPos.x -= mtv.x;\r\n        bodyA.globalPos.y -= mtv.y;\r\n        colliderA.update(bodyA.transform.get());\r\n      }\r\n\r\n      if (bodyB.collisionType === CollisionType.Active) {\r\n        bodyB.globalPos.x += mtv.x;\r\n        bodyB.globalPos.y += mtv.y;\r\n        colliderB.update(bodyB.transform.get());\r\n      }\r\n    }\r\n  }\r\n\r\n  public solveVelocity(contact: CollisionContact) {\r\n    if (contact.isCanceled()) {\r\n      return;\r\n    }\r\n\r\n    const colliderA = contact.colliderA;\r\n    const colliderB = contact.colliderB;\r\n    const bodyA = colliderA.owner?.get(BodyComponent);\r\n    const bodyB = colliderB.owner?.get(BodyComponent);\r\n\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n        return;\r\n      }\r\n\r\n      const normal = contact.normal;\r\n      const opposite = normal.negate();\r\n\r\n      if (bodyA.collisionType === CollisionType.Active) {\r\n        // only adjust velocity if the contact normal is opposite to the current velocity\r\n        // this avoids catching edges on a platform when sliding off\r\n        if (bodyA.vel.normalize().dot(opposite) < 0) {\r\n          // Cancel out velocity opposite direction of collision normal\r\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\r\n          bodyA.vel = bodyA.vel.add(velAdj);\r\n        }\r\n      }\r\n\r\n      if (bodyB.collisionType === CollisionType.Active) {\r\n        // only adjust velocity if the contact normal is opposite to the current velocity\r\n        // this avoids catching edges on a platform\r\n        if (bodyB.vel.normalize().dot(normal) < 0) {\r\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\r\n          bodyB.vel = bodyB.vel.add(velAdj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\n\r\n/**\r\n * Holds information about contact points, meant to be reused over multiple frames of contact\r\n */\r\nexport class ContactConstraintPoint {\r\n  constructor(\r\n    public point: Vector,\r\n    public local: Vector,\r\n    public contact: CollisionContact\r\n  ) {\r\n    this.update();\r\n  }\r\n\r\n  /**\r\n   * Updates the contact information\r\n   */\r\n  update() {\r\n    const bodyA = this.contact.bodyA;\r\n    const bodyB = this.contact.bodyB;\r\n\r\n    if (bodyA && bodyB) {\r\n      const normal = this.contact.normal;\r\n      const tangent = this.contact.tangent;\r\n\r\n      this.aToContact = this.point.sub(bodyA.globalPos);\r\n      this.bToContact = this.point.sub(bodyB.globalPos);\r\n\r\n      const aToContactNormal = this.aToContact.cross(normal);\r\n      const bToContactNormal = this.bToContact.cross(normal);\r\n\r\n      this.normalMass =\r\n        bodyA.inverseMass +\r\n        bodyB.inverseMass +\r\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n      const aToContactTangent = this.aToContact.cross(tangent);\r\n      const bToContactTangent = this.bToContact.cross(tangent);\r\n\r\n      this.tangentMass =\r\n        bodyA.inverseMass +\r\n        bodyB.inverseMass +\r\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns the relative velocity between bodyA and bodyB\r\n   */\r\n  public getRelativeVelocity() {\r\n    const bodyA = this.contact.bodyA;\r\n    const bodyB = this.contact.bodyB;\r\n    if (bodyA && bodyB) {\r\n      // Relative velocity in linear terms\r\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\r\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\r\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\r\n      return velB.sub(velA);\r\n    }\r\n    return Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Impulse accumulated over time in normal direction\r\n   */\r\n  public normalImpulse: number = 0;\r\n\r\n  /**\r\n   * Impulse accumulated over time in the tangent direction\r\n   */\r\n  public tangentImpulse: number = 0;\r\n\r\n  /**\r\n   * Effective mass seen in the normal direction\r\n   */\r\n  public normalMass: number = 0;\r\n\r\n  /**\r\n   * Effective mass seen in the tangent direction\r\n   */\r\n  public tangentMass: number = 0;\r\n\r\n  /**\r\n   * Direction from center of mass of bodyA to contact point\r\n   */\r\n  public aToContact: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Direction from center of mass of bodyB to contact point\r\n   */\r\n  public bToContact: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Original contact velocity combined with bounciness\r\n   */\r\n  public originalVelocityAndRestitution: number = 0;\r\n}\r\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { clamp } from '../../Math/util';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { DegreeOfFreedom } from '../BodyComponent';\r\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\r\nimport { DeepRequired } from '../../Util/Required';\r\nimport { PhysicsConfig } from '../PhysicsConfig';\r\n\r\nexport class RealisticSolver implements CollisionSolver {\r\n  constructor(public config: DeepRequired<Pick<PhysicsConfig, 'realistic'>['realistic']>) {}\r\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\r\n\r\n  // map contact id to contact points\r\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\r\n\r\n  getContactConstraints(id: string) {\r\n    return this.idToContactConstraint.get(id) ?? [];\r\n  }\r\n\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter((c) => !c.isCanceled());\r\n\r\n    // Solve velocity first\r\n    this.solveVelocity(contacts);\r\n\r\n    // Solve position last because non-overlap is the most important\r\n    this.solvePosition(contacts);\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n\r\n  preSolve(contacts: CollisionContact[]) {\r\n    const epsilon = 0.0001;\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\r\n        // Cancel near 0 mtv collisions\r\n        contact.cancel();\r\n        continue;\r\n      }\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact)\r\n      );\r\n      contact.colliderA.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact)\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n\r\n      // Match awake state for sleeping\r\n      contact.matchAwake();\r\n    }\r\n\r\n    // Keep track of contacts that done\r\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      // Remove all current contacts that are not done\r\n      const index = finishedContactIds.indexOf(contact.id);\r\n      if (index > -1) {\r\n        finishedContactIds.splice(index, 1);\r\n      }\r\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n      let pointIndex = 0;\r\n      const bodyA = contact.bodyA;\r\n      const bodyB = contact.bodyB;\r\n      if (bodyA && bodyB) {\r\n        for (let j = 0; j < contact.points.length; j++) {\r\n          const point = contact.points[j];\r\n          const normal = contact.normal;\r\n          const tangent = contact.tangent;\r\n\r\n          const aToContact = point.sub(bodyA.globalPos);\r\n          const bToContact = point.sub(bodyB.globalPos);\r\n\r\n          const aToContactNormal = aToContact.cross(normal);\r\n          const bToContactNormal = bToContact.cross(normal);\r\n\r\n          const normalMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n          const aToContactTangent = aToContact.cross(tangent);\r\n          const bToContactTangent = bToContact.cross(tangent);\r\n\r\n          const tangentMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n\r\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\r\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\r\n            contactPoints[pointIndex].point = point;\r\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\r\n          } else {\r\n            // new contact if it's not close or doesn't exist\r\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\r\n          }\r\n\r\n          // Update contact point calculations\r\n          contactPoints[pointIndex].aToContact = aToContact;\r\n          contactPoints[pointIndex].bToContact = bToContact;\r\n          contactPoints[pointIndex].normalMass = 1.0 / normalMass;\r\n          contactPoints[pointIndex].tangentMass = 1.0 / tangentMass;\r\n\r\n          // Calculate relative velocity before solving to accurately do restitution\r\n          const restitution = bodyA.bounciness > bodyB.bounciness ? bodyA.bounciness : bodyB.bounciness;\r\n          const relativeVelocity = contact.normal.dot(contactPoints[pointIndex].getRelativeVelocity());\r\n          contactPoints[pointIndex].originalVelocityAndRestitution = 0;\r\n          if (relativeVelocity < -0.1) {\r\n            // TODO what's a good threshold here?\r\n            contactPoints[pointIndex].originalVelocityAndRestitution = -restitution * relativeVelocity;\r\n          }\r\n          pointIndex++;\r\n        }\r\n      }\r\n      this.idToContactConstraint.set(contact.id, contactPoints);\r\n    }\r\n\r\n    // Clean up any contacts that did not occur last frame\r\n    for (const id of finishedContactIds) {\r\n      this.idToContactConstraint.delete(id);\r\n    }\r\n\r\n    // Warm contacts with accumulated impulse\r\n    // Useful for tall stacks\r\n    if (this.config.warmStart) {\r\n      this.warmStart(contacts);\r\n    } else {\r\n      for (let i = 0; i < contacts.length; i++) {\r\n        const contact = contacts[i];\r\n        const contactPoints = this.getContactConstraints(contact.id);\r\n        for (const point of contactPoints) {\r\n          point.normalImpulse = 0;\r\n          point.tangentImpulse = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  postSolve(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      const bodyA = contact.bodyA;\r\n      const bodyB = contact.bodyB;\r\n\r\n      if (bodyA && bodyB) {\r\n        // Skip post solve for active+passive collisions\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        // Update motion values for sleeping\r\n        bodyA.updateMotion();\r\n        bodyB.updateMotion();\r\n      }\r\n\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact)\r\n      );\r\n      contact.colliderA.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact)\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n    }\r\n\r\n    // Store contacts\r\n    this.lastFrameContacts.clear();\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const c = contacts[i];\r\n      this.lastFrameContacts.set(c.id, c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Warm up body's based on previous frame contact points\r\n   * @param contacts\r\n   */\r\n  warmStart(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < contacts.length; i++) {\r\n      const contact = contacts[i];\r\n      const bodyA = contact.bodyA;\r\n      const bodyB = contact.bodyB;\r\n      if (bodyA && bodyB) {\r\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n        for (const point of contactPoints) {\r\n          if (this.config.warmStart) {\r\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\r\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\r\n            const impulse = normalImpulse.add(tangentImpulse);\r\n\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          } else {\r\n            point.normalImpulse = 0;\r\n            point.tangentImpulse = 0;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Iteratively solve the position overlap constraint\r\n   * @param contacts\r\n   */\r\n  solvePosition(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < this.config.positionIterations; i++) {\r\n      for (let i = 0; i < contacts.length; i++) {\r\n        const contact = contacts[i];\r\n        const bodyA = contact.bodyA;\r\n        const bodyB = contact.bodyB;\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n          for (const point of constraints) {\r\n            const normal = contact.normal;\r\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\r\n\r\n            const steeringConstant = this.config.steeringFactor; //0.2;\r\n            const maxCorrection = -5;\r\n            const slop = this.config.slop; //1;\r\n\r\n            // Clamp to avoid over-correction\r\n            // Remember that we are shooting for 0 overlap in the end\r\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\r\n            const impulse = normal.scale(-steeringForce * point.normalMass);\r\n\r\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\r\n            // We adjust position and rotation instead of doing the velocity\r\n            if (bodyA.collisionType === CollisionType.Active) {\r\n              // TODO make applyPseudoImpulse function?\r\n              const impulseForce = impulse.negate().scale(bodyA.inverseMass);\r\n              if (bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n                impulseForce.x = 0;\r\n              }\r\n              if (bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n                impulseForce.y = 0;\r\n              }\r\n\r\n              bodyA.globalPos = bodyA.globalPos.add(impulseForce);\r\n              if (!bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n                bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\r\n              }\r\n            }\r\n\r\n            if (bodyB.collisionType === CollisionType.Active) {\r\n              const impulseForce = impulse.scale(bodyB.inverseMass);\r\n              if (bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n                impulseForce.x = 0;\r\n              }\r\n              if (bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n                impulseForce.y = 0;\r\n              }\r\n\r\n              bodyB.globalPos = bodyB.globalPos.add(impulseForce);\r\n              if (!bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n                bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  solveVelocity(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < this.config.velocityIterations; i++) {\r\n      for (let i = 0; i < contacts.length; i++) {\r\n        const contact = contacts[i];\r\n        const bodyA = contact.bodyA;\r\n        const bodyB = contact.bodyB;\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const friction = Math.min(bodyA.friction, bodyB.friction);\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n          // Friction constraint\r\n          for (const point of constraints) {\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Negate velocity in tangent direction to simulate friction\r\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\r\n            let impulseDelta = tangentVelocity * point.tangentMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2006 talk\r\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\r\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\r\n            // But deltas can vary\r\n            const maxFriction = friction * point.normalImpulse;\r\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\r\n            impulseDelta = newImpulse - point.tangentImpulse;\r\n            point.tangentImpulse = newImpulse;\r\n\r\n            const impulse = contact.tangent.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n\r\n          // Bounce constraint\r\n          for (const point of constraints) {\r\n            // Need to recalc relative velocity because the previous step could have changed vel\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Compute impulse in normal direction\r\n            const normalVelocity = relativeVelocity.dot(contact.normal);\r\n\r\n            // Per Erin it is a mistake to apply the restitution inside the iteration\r\n            // From Erin Catto's Box2D we keep original contact velocity and adjust by small impulses\r\n            let impulseDelta = -point.normalMass * (normalVelocity - point.originalVelocityAndRestitution);\r\n\r\n            // Clamping based in Erin Catto's GDC 2014 talk\r\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\r\n            // But deltas can be negative\r\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\r\n            impulseDelta = newImpulse - point.normalImpulse;\r\n            point.normalImpulse = newImpulse;\r\n\r\n            const impulse = contact.normal.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { ComponentCtor, Query, SystemPriority, World } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\r\nimport { SolverStrategy } from './SolverStrategy';\r\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { RealisticSolver } from './Solver/RealisticSolver';\r\nimport { CollisionSolver } from './Solver/Solver';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { Engine } from '../Engine';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { Side } from '../Collision/Side';\r\nimport { PhysicsWorld } from './PhysicsWorld';\r\nimport { CollisionProcessor } from './Detection/CollisionProcessor';\r\nimport { SeparatingAxis } from './Colliders/SeparatingAxis';\r\nimport { MotionSystem } from './MotionSystem';\r\nimport { Pair } from './Detection/Pair';\r\nexport class CollisionSystem extends System {\r\n  static priority = SystemPriority.Higher;\r\n\r\n  public systemType = SystemType.Update;\r\n  public query: Query<ComponentCtor<TransformComponent> | ComponentCtor<MotionComponent> | ComponentCtor<ColliderComponent>>;\r\n\r\n  private _engine: Engine;\r\n  private _configDirty = false;\r\n  private _realisticSolver: RealisticSolver;\r\n  private _arcadeSolver: ArcadeSolver;\r\n  private _lastFrameContacts = new Map<string, CollisionContact>();\r\n  private _currentFrameContacts = new Map<string, CollisionContact>();\r\n  private _motionSystem: MotionSystem;\r\n  private get _processor(): CollisionProcessor {\r\n    return this._physics.collisionProcessor;\r\n  }\r\n\r\n  private _trackCollider: (c: Collider) => void;\r\n  private _untrackCollider: (c: Collider) => void;\r\n\r\n  constructor(\r\n    world: World,\r\n    private _physics: PhysicsWorld\r\n  ) {\r\n    super();\r\n    this._arcadeSolver = new ArcadeSolver(_physics.config.arcade);\r\n    this._realisticSolver = new RealisticSolver(_physics.config.realistic);\r\n    this._physics.$configUpdate.subscribe(() => (this._configDirty = true));\r\n    this._trackCollider = (c: Collider) => this._processor.track(c);\r\n    this._untrackCollider = (c: Collider) => this._processor.untrack(c);\r\n    this.query = world.query([TransformComponent, MotionComponent, ColliderComponent]);\r\n    this.query.entityAdded$.subscribe((e) => {\r\n      const colliderComponent = e.get(ColliderComponent);\r\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\r\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\r\n      const collider = colliderComponent.get();\r\n      if (collider) {\r\n        this._processor.track(collider);\r\n      }\r\n    });\r\n    this.query.entityRemoved$.subscribe((e) => {\r\n      const colliderComponent = e.get(ColliderComponent);\r\n      const collider = colliderComponent.get();\r\n      if (colliderComponent && collider) {\r\n        this._processor.untrack(collider);\r\n      }\r\n    });\r\n    this._motionSystem = world.get(MotionSystem) as MotionSystem;\r\n  }\r\n\r\n  initialize(world: World, scene: Scene) {\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    if (!this._physics.config.enabled) {\r\n      return;\r\n    }\r\n\r\n    // TODO do we need to do this every frame?\r\n    // Collect up all the colliders and update them\r\n    let colliders: Collider[] = [];\r\n    for (let entityIndex = 0; entityIndex < this.query.entities.length; entityIndex++) {\r\n      const entity = this.query.entities[entityIndex];\r\n      const colliderComp = entity.get(ColliderComponent);\r\n      const collider = colliderComp?.get();\r\n      if (colliderComp && colliderComp.owner?.isActive && collider) {\r\n        colliderComp.update();\r\n\r\n        // Flatten composite colliders\r\n        if (collider instanceof CompositeCollider) {\r\n          const compositeColliders = collider.getColliders();\r\n          if (!collider.compositeStrategy) {\r\n            collider.compositeStrategy = this._physics.config.colliders.compositeStrategy;\r\n          }\r\n          colliders = colliders.concat(compositeColliders);\r\n        } else {\r\n          colliders.push(collider);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update the spatial partitioning data structures\r\n    // TODO if collider invalid it will break the processor\r\n    // TODO rename \"update\" to something more specific\r\n    this._processor.update(colliders, elapsed);\r\n\r\n    // Run broadphase on all colliders and locates potential collisions\r\n    let pairs = this._processor.broadphase(colliders, elapsed);\r\n\r\n    this._currentFrameContacts.clear();\r\n\r\n    // Given possible pairs find actual contacts\r\n    let contacts: CollisionContact[] = []; // = this._processor.narrowphase(pairs, this._engine?.debug?.stats?.currFrame);\r\n\r\n    const solver: CollisionSolver = this.getSolver();\r\n\r\n    // Solve, this resolves the position/velocity so entities aren't overlapping\r\n    const substep = this._physics.config.substep;\r\n    for (let step = 0; step < substep; step++) {\r\n      if (step > 0) {\r\n        // first step is run by the MotionSystem when configured, so skip\r\n        this._motionSystem.update(elapsed);\r\n      }\r\n      // Re-use pairs from previous collision\r\n      if (contacts.length) {\r\n        pairs = contacts.map((c) => new Pair(c.colliderA, c.colliderB));\r\n      }\r\n\r\n      if (pairs.length) {\r\n        contacts = this._processor.narrowphase(pairs, this._engine?.debug?.stats?.currFrame);\r\n        contacts = solver.solve(contacts);\r\n\r\n        // Record contacts for start/end\r\n        for (const contact of contacts) {\r\n          if (contact.isCanceled()) {\r\n            continue;\r\n          }\r\n          // Process composite ids, things with the same composite id are treated as the same collider for start/end\r\n          const index = contact.id.indexOf('|');\r\n          if (index > 0) {\r\n            const compositeId = contact.id.substring(index + 1);\r\n            this._currentFrameContacts.set(compositeId, contact);\r\n          } else {\r\n            this._currentFrameContacts.set(contact.id, contact);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Emit contact start/end events\r\n    this.runContactStartEnd();\r\n\r\n    // reset the last frame cache\r\n    this._lastFrameContacts.clear();\r\n\r\n    // Keep track of collisions contacts that have started or ended\r\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\r\n\r\n    // Process deferred collider removals\r\n    for (const entity of this.query.entities) {\r\n      const collider = entity.get(ColliderComponent);\r\n      if (collider) {\r\n        collider.processColliderRemoval();\r\n      }\r\n    }\r\n  }\r\n\r\n  postupdate(): void {\r\n    SeparatingAxis.SeparationPool.done();\r\n  }\r\n\r\n  getSolver(): CollisionSolver {\r\n    if (this._configDirty) {\r\n      this._configDirty = false;\r\n      this._arcadeSolver = new ArcadeSolver(this._physics.config.arcade);\r\n      this._realisticSolver = new RealisticSolver(this._physics.config.realistic);\r\n    }\r\n    return this._physics.config.solver === SolverStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext) {\r\n    this._processor.debug(ex, 0);\r\n  }\r\n\r\n  public runContactStartEnd() {\r\n    // If composite colliders are 'together' collisions may have a duplicate id because we want to treat those as a singular start/end\r\n    for (const [id, c] of this._currentFrameContacts) {\r\n      // find all new contacts\r\n      if (!this._lastFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        const side = Side.fromDirection(c.mtv);\r\n        const opposite = Side.getOpposite(side);\r\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, side, c));\r\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, side, c) as any);\r\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, opposite, c));\r\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, opposite, c) as any);\r\n      }\r\n    }\r\n\r\n    // find all contacts that have ceased\r\n    for (const [id, c] of this._lastFrameContacts) {\r\n      if (!this._currentFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        const side = Side.fromDirection(c.mtv);\r\n        const opposite = Side.getOpposite(side);\r\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB, side, c));\r\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB, side, c) as any);\r\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA, opposite, c));\r\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA, opposite, c) as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Transform } from '../Math/transform';\r\n\r\n/**\r\n * Blend 2 transforms for interpolation, will interpolate from the context of newTx's parent if it exists\r\n */\r\nexport function blendTransform(oldTx: Transform, newTx: Transform, blend: number, target?: Transform): Transform {\r\n  if (oldTx.parent !== newTx.parent) {\r\n    // Caller expects a local transform\r\n    // Adjust old tx to be local to the new parent whatever that is\r\n    const oldTxWithNewParent = oldTx.clone();\r\n    const oldGlobalPos = oldTx.globalPos.clone();\r\n    const oldGlobalScale = oldTx.globalScale.clone();\r\n    const oldGlobalRotation = oldTx.globalRotation;\r\n    oldTxWithNewParent.parent = newTx.parent;\r\n    oldTxWithNewParent.globalPos = oldGlobalPos;\r\n    oldTxWithNewParent.globalScale = oldGlobalScale;\r\n    oldTxWithNewParent.globalRotation = oldGlobalRotation;\r\n    oldTx = oldTxWithNewParent;\r\n  }\r\n  let interpolatedPos = newTx.pos;\r\n  let interpolatedScale = newTx.scale;\r\n  let interpolatedRotation = newTx.rotation;\r\n\r\n  interpolatedPos = newTx.pos.scale(blend).add(oldTx.pos.scale(1.0 - blend));\r\n  interpolatedScale = newTx.scale.scale(blend).add(oldTx.scale.scale(1.0 - blend));\r\n  // Rotational lerp https://stackoverflow.com/a/30129248\r\n  const cosine = (1.0 - blend) * Math.cos(oldTx.rotation) + blend * Math.cos(newTx.rotation);\r\n  const sine = (1.0 - blend) * Math.sin(oldTx.rotation) + blend * Math.sin(newTx.rotation);\r\n  interpolatedRotation = Math.atan2(sine, cosine);\r\n\r\n  const tx = target ?? new Transform();\r\n  tx.setTransform(interpolatedPos, interpolatedRotation, interpolatedScale);\r\n  return tx;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function blendGlobalTransform(oldTx: Transform, newTx: Transform, blend: number, target?: Transform): Transform {\r\n  let interpolatedPos = newTx.globalPos;\r\n  let interpolatedScale = newTx.globalScale;\r\n  let interpolatedRotation = newTx.globalRotation;\r\n\r\n  interpolatedPos = newTx.globalPos.scale(blend).add(oldTx.globalPos.scale(1.0 - blend));\r\n  interpolatedScale = newTx.globalScale.scale(blend).add(oldTx.globalScale.scale(1.0 - blend));\r\n  // Rotational lerp https://stackoverflow.com/a/30129248\r\n  const cosine = (1.0 - blend) * Math.cos(oldTx.globalRotation) + blend * Math.cos(newTx.globalRotation);\r\n  const sine = (1.0 - blend) * Math.sin(oldTx.globalRotation) + blend * Math.sin(newTx.globalRotation);\r\n  interpolatedRotation = Math.atan2(sine, cosine);\r\n\r\n  const tx = target ?? new Transform();\r\n  tx.setTransform(interpolatedPos, interpolatedRotation, interpolatedScale);\r\n  return tx;\r\n}\r\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { GraphicsComponent } from './GraphicsComponent';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Camera } from '../Camera';\r\nimport { Query, System, SystemPriority, SystemType, World } from '../EntityComponentSystem';\r\nimport { Engine } from '../Engine';\r\nimport { GraphicsGroup } from './GraphicsGroup';\r\nimport { ParallaxComponent } from './ParallaxComponent';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { BodyComponent } from '../Collision/BodyComponent';\r\nimport { FontCache } from './FontCache';\r\nimport { PostDrawEvent, PostTransformDrawEvent, PreDrawEvent, PreTransformDrawEvent } from '../Events';\r\nimport { Transform } from '../Math/transform';\r\nimport { blendTransform } from './TransformInterpolation';\r\nimport { Graphic } from './Graphic';\r\n\r\nexport class GraphicsSystem extends System {\r\n  static priority = SystemPriority.Average;\r\n\r\n  public readonly systemType = SystemType.Draw;\r\n  private _token = 0;\r\n  // Set in the initialize\r\n  private _graphicsContext!: ExcaliburGraphicsContext;\r\n  private _camera!: Camera;\r\n  private _engine!: Engine;\r\n  private _sortedTransforms: TransformComponent[] = [];\r\n  query: Query<typeof TransformComponent | typeof GraphicsComponent>;\r\n  public get sortedTransforms() {\r\n    return this._sortedTransforms;\r\n  }\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent, GraphicsComponent]);\r\n    this.query.entityAdded$.subscribe((e) => {\r\n      const tx = e.get(TransformComponent);\r\n      this._sortedTransforms.push(tx);\r\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\r\n      this._zHasChanged = true;\r\n    });\r\n    this.query.entityRemoved$.subscribe((e) => {\r\n      const tx = e.get(TransformComponent);\r\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\r\n      const index = this._sortedTransforms.indexOf(tx);\r\n      if (index > -1) {\r\n        this._sortedTransforms.splice(index, 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  public initialize(world: World, scene: Scene): void {\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  private _zHasChanged = false;\r\n  private _zIndexUpdate = () => {\r\n    this._zHasChanged = true;\r\n  };\r\n\r\n  public preupdate(): void {\r\n    // Graphics context could be switched to fallback in a new frame\r\n    this._graphicsContext = this._engine.graphicsContext;\r\n    if (this._zHasChanged) {\r\n      this._sortedTransforms.sort((a, b) => {\r\n        return a.globalZ - b.globalZ;\r\n      });\r\n      this._zHasChanged = false;\r\n    }\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    this._token++;\r\n    let graphics: GraphicsComponent;\r\n    FontCache.checkAndClearCache();\r\n\r\n    // This is a performance enhancement, most things are in world space\r\n    // so if we can only do this once saves a ton of transform updates\r\n    this._graphicsContext.save();\r\n    if (this._camera) {\r\n      this._camera.draw(this._graphicsContext);\r\n    }\r\n    for (let transformIndex = 0; transformIndex < this._sortedTransforms.length; transformIndex++) {\r\n      const transform = this._sortedTransforms[transformIndex];\r\n      const entity = transform.owner as Entity;\r\n\r\n      // If the entity is offscreen skip\r\n      if (entity.hasTag('ex.offscreen')) {\r\n        continue;\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      // Exit if graphics set to not visible\r\n      if (!graphics.isVisible) {\r\n        continue;\r\n      }\r\n\r\n      // Optionally run the onPreTransformDraw graphics lifecycle draw\r\n      if (graphics.onPreTransformDraw) {\r\n        graphics.onPreTransformDraw(this._graphicsContext, elapsed);\r\n      }\r\n      entity.events.emit('pretransformdraw', new PreTransformDrawEvent(this._graphicsContext, elapsed, entity));\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      if (transform.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.restore();\r\n      }\r\n\r\n      this._graphicsContext.save();\r\n      if (transform.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\r\n      }\r\n\r\n      // Tick any graphics state (but only once) for animations and graphics groups\r\n      graphics.update(elapsed, this._token);\r\n\r\n      // Apply parallax\r\n      const parallax = entity.get(ParallaxComponent);\r\n      if (parallax) {\r\n        // We use the Tiled formula\r\n        // https://doc.mapeditor.org/en/latest/manual/layers/#parallax-scrolling-factor\r\n        // cameraPos * (1 - parallaxFactor)\r\n        const oneMinusFactor = Vector.One.sub(parallax.parallaxFactor);\r\n        const parallaxOffset = this._camera.drawPos.scale(oneMinusFactor);\r\n        this._graphicsContext.translate(parallaxOffset.x, parallaxOffset.y);\r\n      }\r\n\r\n      // Position the entity + estimate lag\r\n      this._applyTransform(entity);\r\n\r\n      // If there is a material enable it on the context\r\n      if (graphics.material) {\r\n        this._graphicsContext.material = graphics.material;\r\n      }\r\n\r\n      // Optionally run the onPreDraw graphics lifecycle draw\r\n      if (graphics.onPreDraw) {\r\n        graphics.onPreDraw(this._graphicsContext, elapsed);\r\n      }\r\n      entity.events.emit('predraw', new PreDrawEvent(this._graphicsContext, elapsed, entity));\r\n\r\n      // this._graphicsContext.opacity *= graphics.opacity;\r\n      this._applyOpacity(entity);\r\n\r\n      // Draw the graphics component\r\n      this._drawGraphicsComponent(graphics, transform);\r\n\r\n      // Optionally run the onPostDraw graphics lifecycle draw\r\n      if (graphics.onPostDraw) {\r\n        graphics.onPostDraw(this._graphicsContext, elapsed);\r\n      }\r\n      entity.events.emit('postdraw', new PostDrawEvent(this._graphicsContext, elapsed, entity));\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // Reset the transform back to the original world space\r\n      if (transform.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.save();\r\n        if (this._camera) {\r\n          this._camera.draw(this._graphicsContext);\r\n        }\r\n      }\r\n\r\n      // Optionally run the onPreTransformDraw graphics lifecycle draw\r\n      if (graphics.onPostTransformDraw) {\r\n        graphics.onPostTransformDraw(this._graphicsContext, elapsed);\r\n      }\r\n      entity.events.emit('posttransformdraw', new PostTransformDrawEvent(this._graphicsContext, elapsed, entity));\r\n    }\r\n    this._graphicsContext.restore();\r\n  }\r\n\r\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent, transformComponent: TransformComponent) {\r\n    if (graphicsComponent.isVisible) {\r\n      const flipHorizontal = graphicsComponent.flipHorizontal;\r\n      const flipVertical = graphicsComponent.flipVertical;\r\n\r\n      const graphic = graphicsComponent.current;\r\n      const options = graphicsComponent.currentOptions ?? {};\r\n\r\n      if (graphic) {\r\n        let anchor = graphicsComponent.anchor;\r\n        let offset = graphicsComponent.offset;\r\n        let scaleX = 1;\r\n        let scaleY = 1;\r\n        // handle specific overrides\r\n        if (options?.anchor) {\r\n          anchor = options.anchor;\r\n        }\r\n        if (options?.offset) {\r\n          offset = options.offset;\r\n        }\r\n        const globalScale = transformComponent.globalScale;\r\n        scaleX *= graphic.scale.x * globalScale.x;\r\n        scaleY *= graphic.scale.y * globalScale.y;\r\n\r\n        // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n        const offsetX = -graphic.width * anchor.x + offset.x * scaleX;\r\n        const offsetY = -graphic.height * anchor.y + offset.y * scaleY;\r\n\r\n        const oldFlipHorizontal = graphic.flipHorizontal;\r\n        const oldFlipVertical = graphic.flipVertical;\r\n        if (flipHorizontal || flipVertical) {\r\n          // flip any currently flipped graphics\r\n          graphic.flipHorizontal = flipHorizontal ? !oldFlipHorizontal : oldFlipHorizontal;\r\n          graphic.flipVertical = flipVertical ? !oldFlipVertical : oldFlipVertical;\r\n        }\r\n\r\n        graphic?.draw(this._graphicsContext, offsetX, offsetY);\r\n\r\n        if (flipHorizontal || flipVertical) {\r\n          graphic.flipHorizontal = oldFlipHorizontal;\r\n          graphic.flipVertical = oldFlipVertical;\r\n        }\r\n\r\n        // TODO move debug code out?\r\n        if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\r\n          const offset = vec(offsetX, offsetY);\r\n          if (graphic instanceof GraphicsGroup) {\r\n            for (const member of graphic.members) {\r\n              let g: Graphic;\r\n              let pos: Vector = Vector.Zero;\r\n              if (member instanceof Graphic) {\r\n                g = member;\r\n              } else {\r\n                g = member.graphic;\r\n                pos = member.offset;\r\n              }\r\n\r\n              if (graphic.useAnchor) {\r\n                g?.localBounds.translate(offset.add(pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              } else {\r\n                g?.localBounds.translate(pos).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              }\r\n            }\r\n          } else {\r\n            /* istanbul ignore next */\r\n            graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _targetInterpolationTransform = new Transform();\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (let i = 0; i < ancestors.length; i++) {\r\n      const ancestor = ancestors[i];\r\n      const transform = ancestor?.get(TransformComponent);\r\n      const optionalBody = ancestor?.get(BodyComponent);\r\n      if (transform) {\r\n        let tx = transform.get();\r\n        if (optionalBody) {\r\n          if (this._engine.fixedUpdateTimestep && optionalBody.__oldTransformCaptured && optionalBody.enableFixedUpdateInterpolate) {\r\n            // Interpolate graphics if needed\r\n            const blend = this._engine.currentFrameLagMs / this._engine.fixedUpdateTimestep;\r\n            tx = blendTransform(optionalBody.oldTransform, transform.get(), blend, this._targetInterpolationTransform);\r\n          }\r\n        }\r\n        this._graphicsContext.z = transform.globalZ;\r\n        this._graphicsContext.translate(tx.pos.x, tx.pos.y);\r\n        this._graphicsContext.scale(tx.scale.x, tx.scale.y);\r\n        this._graphicsContext.rotate(tx.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _applyOpacity(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (let i = 0; i < ancestors.length; i++) {\r\n      const ancestor = ancestors[i];\r\n      const maybeGraphics = ancestor?.get(GraphicsComponent);\r\n      this._graphicsContext.opacity *= maybeGraphics?.opacity ?? 1;\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { Entity, Query, SystemPriority, TransformComponent, World } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { toDegrees } from '../Math/util';\r\nimport { BodyComponent } from '../Collision/BodyComponent';\r\nimport { CollisionSystem } from '../Collision/CollisionSystem';\r\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Particle } from '../Particles/Particles';\r\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { Debug } from '../Graphics/Debug';\r\n\r\nexport class DebugSystem extends System {\r\n  static priority = SystemPriority.Lowest;\r\n\r\n  public readonly systemType = SystemType.Draw;\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _collisionSystem: CollisionSystem;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n  query: Query<typeof TransformComponent>;\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent]);\r\n  }\r\n\r\n  public initialize(world: World, scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n    this._collisionSystem = world.systemManager.get(CollisionSystem);\r\n  }\r\n\r\n  update(): void {\r\n    if (!this._engine.isDebug) {\r\n      return;\r\n    }\r\n\r\n    const filterSettings = this._engine.debug.filter;\r\n\r\n    let id: number;\r\n    let name: string;\r\n    const entitySettings = this._engine.debug.entity;\r\n\r\n    let tx: TransformComponent;\r\n    const txSettings = this._engine.debug.transform;\r\n\r\n    let motion: MotionComponent;\r\n    const motionSettings = this._engine.debug.motion;\r\n\r\n    let colliderComp: ColliderComponent;\r\n    const colliderSettings = this._engine.debug.collider;\r\n\r\n    const physicsSettings = this._engine.debug.physics;\r\n\r\n    let graphics: GraphicsComponent;\r\n    const graphicsSettings = this._engine.debug.graphics;\r\n\r\n    let debugDraw: DebugGraphicsComponent;\r\n\r\n    let body: BodyComponent;\r\n    const bodySettings = this._engine.debug.body;\r\n\r\n    const cameraSettings = this._engine.debug.camera;\r\n    for (let i = 0; i < this.query.entities.length; i++) {\r\n      const entity = this.query.entities[i];\r\n      if (entity.hasTag('offscreen')) {\r\n        // skip offscreen entities\r\n        continue;\r\n      }\r\n      if (entity instanceof Particle) {\r\n        // Particles crush the renderer :(\r\n        continue;\r\n      }\r\n      if (filterSettings.useFilter) {\r\n        const allIds = filterSettings.ids.length === 0;\r\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\r\n        if (!idMatch) {\r\n          continue;\r\n        }\r\n        const allNames = filterSettings.nameQuery === '';\r\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\r\n        if (!nameMatch) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      let cursor = Vector.Zero;\r\n      const lineHeight = vec(0, 16);\r\n      id = entity.id;\r\n      name = entity.name;\r\n      tx = entity.get(TransformComponent);\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(tx);\r\n\r\n      this._graphicsContext.save();\r\n      if (tx.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\r\n      }\r\n      this._graphicsContext.z = txSettings.debugZIndex;\r\n\r\n      this._applyTransform(entity);\r\n      if (tx) {\r\n        if (txSettings.showAll || txSettings.showPosition) {\r\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 4, color: txSettings.positionColor });\r\n        }\r\n        if (txSettings.showAll || txSettings.showPositionLabel) {\r\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n        if (txSettings.showAll || txSettings.showZIndex) {\r\n          this._graphicsContext.debug.drawText(`z(${tx.z.toFixed(1)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showId) {\r\n          this._graphicsContext.debug.drawText(`id(${id}) ${entity.parent ? 'child of id(' + entity.parent?.id + ')' : ''}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showName) {\r\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showRotation) {\r\n          this._graphicsContext.drawLine(\r\n            Vector.Zero,\r\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\r\n            txSettings.rotationColor,\r\n            2\r\n          );\r\n          this._graphicsContext.debug.drawText(`rot deg(${toDegrees(tx.rotation).toFixed(2)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showScale) {\r\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\r\n        }\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics) {\r\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\r\n          const bounds = graphics.localBounds;\r\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\r\n        }\r\n      }\r\n\r\n      debugDraw = entity.get(DebugGraphicsComponent);\r\n      if (debugDraw) {\r\n        if (!debugDraw.useTransform) {\r\n          this._graphicsContext.restore();\r\n        }\r\n        debugDraw.draw(this._graphicsContext, this._engine.debug);\r\n        if (!debugDraw.useTransform) {\r\n          this._graphicsContext.save();\r\n          this._applyTransform(entity);\r\n        }\r\n      }\r\n\r\n      body = entity.get(BodyComponent);\r\n      if (body) {\r\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\r\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\r\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMass) {\r\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMotion) {\r\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showSleeping) {\r\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.isSleeping : 'cant sleep'})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // World space\r\n      this._graphicsContext.save();\r\n      if (tx.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.translate(this._engine.screen.contentArea.left, this._engine.screen.contentArea.top);\r\n      }\r\n      this._graphicsContext.z = txSettings.debugZIndex;\r\n      motion = entity.get(MotionComponent);\r\n      if (motion) {\r\n        if (motionSettings.showAll || motionSettings.showVelocity) {\r\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\r\n        }\r\n      }\r\n\r\n      // Colliders live in world space already so after the restore()\r\n      colliderComp = entity.get(ColliderComponent);\r\n      if (colliderComp) {\r\n        const collider = colliderComp.get();\r\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\r\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor, {\r\n            lineWidth: colliderSettings.geometryLineWidth,\r\n            pointSize: colliderSettings.geometryPointSize\r\n          });\r\n        }\r\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\r\n          if (collider instanceof CompositeCollider) {\r\n            const colliders = collider.getColliders();\r\n            for (const collider of colliders) {\r\n              const bounds = collider.bounds;\r\n              const pos = vec(bounds.left, bounds.top);\r\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\r\n              }\r\n            }\r\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\r\n          } else if (collider) {\r\n            const bounds = colliderComp.bounds;\r\n            const pos = vec(bounds.left, bounds.top);\r\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n      this._popCameraTransform(tx);\r\n    }\r\n\r\n    this._graphicsContext.save();\r\n    this._camera.draw(this._graphicsContext);\r\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\r\n      this._collisionSystem.debug(this._graphicsContext);\r\n    }\r\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\r\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawPoint(point, {\r\n              size: physicsSettings.contactSize,\r\n              color: physicsSettings.collisionContactColor\r\n            });\r\n          }\r\n        }\r\n\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\r\n              color: physicsSettings.collisionNormalColor\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this._graphicsContext.restore();\r\n\r\n    if (cameraSettings) {\r\n      this._graphicsContext.save();\r\n      this._camera.draw(this._graphicsContext);\r\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\r\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\r\n      }\r\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\r\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\r\n      }\r\n      this._graphicsContext.restore();\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n  }\r\n\r\n  postupdate(engine: Scene<unknown>, elapsed: number): void {\r\n    if (this._engine.isDebug) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n      Debug.flush(this._graphicsContext);\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { RentalPool } from '../../Util/RentalPool';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nexport class HashGridProxy<T extends { bounds: BoundingBox }> {\r\n  id: number = -1;\r\n  /**\r\n   * left bounds x hash coordinate\r\n   */\r\n  leftX: number;\r\n  /**\r\n   * right bounds x hash coordinate\r\n   */\r\n  rightX: number;\r\n  /**\r\n   * bottom bounds y hash coordinate\r\n   */\r\n  bottomY: number;\r\n  /**\r\n   * top bounds y hash coordinate\r\n   */\r\n  topY: number;\r\n\r\n  bounds: BoundingBox;\r\n\r\n  cells: HashGridCell<T>[] = [];\r\n  hasZeroBounds = false;\r\n  /**\r\n   * Grid size in pixels\r\n   */\r\n  readonly gridSize: number;\r\n  constructor(\r\n    public object: T,\r\n    gridSize: number\r\n  ) {\r\n    this.gridSize = gridSize;\r\n    this.bounds = object.bounds;\r\n    this.hasZeroBounds = this.bounds.hasZeroDimensions();\r\n    this.leftX = Math.floor(this.bounds.left / this.gridSize);\r\n    this.rightX = Math.floor(this.bounds.right / this.gridSize);\r\n    this.bottomY = Math.floor(this.bounds.bottom / this.gridSize);\r\n    this.topY = Math.floor(this.bounds.top / this.gridSize);\r\n  }\r\n\r\n  /**\r\n   * Has the hashed bounds changed\r\n   */\r\n  hasChanged(): boolean {\r\n    const bounds = this.object.bounds;\r\n    const leftX = Math.floor(bounds.left / this.gridSize);\r\n    const rightX = Math.floor(bounds.right / this.gridSize);\r\n    const bottomY = Math.floor(bounds.bottom / this.gridSize);\r\n    const topY = Math.floor(bounds.top / this.gridSize);\r\n    if (this.leftX !== leftX || this.rightX !== rightX || this.bottomY !== bottomY || this.topY !== topY) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Clears all collider references\r\n   */\r\n  clear(): void {\r\n    for (const cell of this.cells) {\r\n      const index = cell.proxies.indexOf(this);\r\n      if (index > -1) {\r\n        cell.proxies.splice(index, 1);\r\n      }\r\n      // TODO reclaim cell in pool if empty?\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update bounds of the proxy\r\n   */\r\n  updateBounds(): void {\r\n    this.bounds = this.object.bounds;\r\n  }\r\n\r\n  /**\r\n   * Updates the hashed bounds coordinates\r\n   */\r\n  update(): void {\r\n    this.bounds = this.object.bounds;\r\n\r\n    this.leftX = Math.floor(this.bounds.left / this.gridSize);\r\n    this.rightX = Math.floor(this.bounds.right / this.gridSize);\r\n    this.bottomY = Math.floor(this.bounds.bottom / this.gridSize);\r\n    this.topY = Math.floor(this.bounds.top / this.gridSize);\r\n    this.hasZeroBounds = this.object.bounds.hasZeroDimensions();\r\n  }\r\n}\r\n\r\nexport class HashGridCell<TObject extends { bounds: BoundingBox }, TProxy extends HashGridProxy<TObject> = HashGridProxy<TObject>> {\r\n  proxies: TProxy[] = [];\r\n  key: string;\r\n  x: number;\r\n  y: number;\r\n\r\n  configure(x: number, y: number) {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.key = HashGridCell.calculateHashKey(x, y);\r\n  }\r\n\r\n  static calculateHashKey(x: number, y: number) {\r\n    return `${x}+${y}`;\r\n  }\r\n}\r\n\r\nexport class SparseHashGrid<TObject extends { bounds: BoundingBox }, TProxy extends HashGridProxy<TObject> = HashGridProxy<TObject>> {\r\n  readonly gridSize: number;\r\n  readonly sparseHashGrid: Map<string, HashGridCell<TObject, TProxy>>;\r\n  readonly objectToProxy: Map<TObject, TProxy>;\r\n\r\n  public bounds = new BoundingBox();\r\n\r\n  private _hashGridCellPool = new RentalPool<HashGridCell<TObject, TProxy>>(\r\n    () => new HashGridCell(),\r\n    (instance) => {\r\n      instance.configure(0, 0);\r\n      instance.proxies.length = 0;\r\n      return instance;\r\n    },\r\n    1000\r\n  );\r\n\r\n  private _buildProxy: (object: TObject) => TProxy;\r\n\r\n  constructor(options: { size: number; proxyFactory?: (object: TObject, gridSize: number) => TProxy }) {\r\n    this.gridSize = options.size;\r\n    this.sparseHashGrid = new Map<string, HashGridCell<TObject, TProxy>>();\r\n    this.objectToProxy = new Map<TObject, TProxy>();\r\n    if (options.proxyFactory) {\r\n      this._buildProxy = (object: TObject) => options.proxyFactory(object, this.gridSize);\r\n    } else {\r\n      this._buildProxy = (object: TObject) => new HashGridProxy(object, this.gridSize) as TProxy;\r\n    }\r\n\r\n    // TODO dynamic grid size potentially larger than the largest collider\r\n    // TODO Re-hash the objects if the median proves to be different\r\n  }\r\n\r\n  query(point: Vector): TObject[];\r\n  query(bounds: BoundingBox): TObject[];\r\n  query(boundsOrPoint: BoundingBox | Vector): TObject[] {\r\n    const results = new Set<TObject>();\r\n    if (boundsOrPoint instanceof BoundingBox) {\r\n      const bounds = boundsOrPoint;\r\n      const leftX = Math.floor(bounds.left / this.gridSize);\r\n      const rightX = Math.floor(bounds.right / this.gridSize);\r\n      const bottomY = Math.floor(bounds.bottom / this.gridSize);\r\n      const topY = Math.floor(bounds.top / this.gridSize);\r\n      for (let x = leftX; x <= rightX; x++) {\r\n        for (let y = topY; y <= bottomY; y++) {\r\n          const key = HashGridCell.calculateHashKey(x, y);\r\n          // Hash bounds into appropriate cell\r\n          const cell = this.sparseHashGrid.get(key);\r\n          if (cell) {\r\n            for (let i = 0; i < cell.proxies.length; i++) {\r\n              cell.proxies[i].updateBounds();\r\n              if (cell.proxies[i].bounds.intersect(bounds)) {\r\n                results.add(cell.proxies[i].object);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      const point = boundsOrPoint;\r\n      const key = HashGridCell.calculateHashKey(Math.floor(point.x / this.gridSize), Math.floor(point.y / this.gridSize));\r\n      // Hash points into appropriate cell\r\n      const cell = this.sparseHashGrid.get(key);\r\n      if (cell) {\r\n        for (let i = 0; i < cell.proxies.length; i++) {\r\n          cell.proxies[i].updateBounds();\r\n          if (cell.proxies[i].bounds.contains(point)) {\r\n            results.add(cell.proxies[i].object);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return Array.from(results);\r\n  }\r\n\r\n  get(xCoord: number, yCoord: number): HashGridCell<TObject> {\r\n    const key = HashGridCell.calculateHashKey(xCoord, yCoord);\r\n    const cell = this.sparseHashGrid.get(key);\r\n    return cell;\r\n  }\r\n\r\n  private _insert(x: number, y: number, proxy: TProxy): void {\r\n    const key = HashGridCell.calculateHashKey(x, y);\r\n    // Hash collider into appropriate cell\r\n    let cell = this.sparseHashGrid.get(key);\r\n    if (!cell) {\r\n      cell = this._hashGridCellPool.rent();\r\n      cell.configure(x, y);\r\n      this.sparseHashGrid.set(cell.key, cell);\r\n    }\r\n    cell.proxies.push(proxy);\r\n    proxy.cells.push(cell); // TODO dupes, doesn't seem to be a problem\r\n    this.bounds.combine(proxy.bounds, this.bounds);\r\n  }\r\n\r\n  private _remove(x: number, y: number, proxy: TProxy): void {\r\n    const key = HashGridCell.calculateHashKey(x, y);\r\n    // Hash collider into appropriate cell\r\n    const cell = this.sparseHashGrid.get(key);\r\n    if (cell) {\r\n      const proxyIndex = cell.proxies.indexOf(proxy);\r\n      if (proxyIndex > -1) {\r\n        cell.proxies.splice(proxyIndex, 1);\r\n      }\r\n      const cellIndex = proxy.cells.indexOf(cell);\r\n      if (cellIndex > -1) {\r\n        proxy.cells.splice(cellIndex, 1);\r\n      }\r\n      if (cell.proxies.length === 0) {\r\n        this._hashGridCellPool.return(cell);\r\n        this.sparseHashGrid.delete(key);\r\n      }\r\n    }\r\n  }\r\n\r\n  track(target: TObject): void {\r\n    const proxy = this._buildProxy(target);\r\n    this.objectToProxy.set(target, proxy);\r\n    for (let x = proxy.leftX; x <= proxy.rightX; x++) {\r\n      for (let y = proxy.topY; y <= proxy.bottomY; y++) {\r\n        this._insert(x, y, proxy);\r\n      }\r\n    }\r\n  }\r\n\r\n  untrack(target: TObject): void {\r\n    const proxy = this.objectToProxy.get(target);\r\n    if (proxy) {\r\n      proxy.clear();\r\n      this.objectToProxy.delete(target);\r\n    }\r\n  }\r\n\r\n  update(targets: TObject[]): number {\r\n    let updated = 0;\r\n    // FIXME resetting bounds is wrong, if nothing has updated then\r\n    // the bounds stay 0\r\n    // this.bounds.reset();\r\n    for (const target of targets) {\r\n      const proxy = this.objectToProxy.get(target);\r\n      if (!proxy) {\r\n        continue;\r\n      }\r\n      if (proxy.hasChanged()) {\r\n        // TODO slightly wasteful only remove from changed\r\n        for (let x = proxy.leftX; x <= proxy.rightX; x++) {\r\n          for (let y = proxy.topY; y <= proxy.bottomY; y++) {\r\n            this._remove(x, y, proxy);\r\n          }\r\n        }\r\n        proxy.update();\r\n        // TODO slightly wasteful only add new\r\n        for (let x = proxy.leftX; x <= proxy.rightX; x++) {\r\n          for (let y = proxy.topY; y <= proxy.bottomY; y++) {\r\n            this._insert(x, y, proxy);\r\n          }\r\n        }\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext, elapsed: number): void {\r\n    const transparent = Color.Transparent;\r\n    const color = Color.White;\r\n    for (const cell of this.sparseHashGrid.values()) {\r\n      ex.drawRectangle(vec(cell.x * this.gridSize, cell.y * this.gridSize), this.gridSize, this.gridSize, transparent, color, 2);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { System, TransformComponent, SystemType, Entity, World, Query, SystemPriority } from '../EntityComponentSystem';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Scene } from '../Scene';\r\nimport { PointerComponent } from './PointerComponent';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { SparseHashGrid } from '../Collision/Detection/SparseHashGrid';\r\nimport { PointerEventsToObjectDispatcher } from './PointerEventsToObjectDispatcher';\r\n\r\n/**\r\n * The PointerSystem is responsible for dispatching pointer events to entities\r\n * that need them.\r\n *\r\n * The PointerSystem can be optionally configured by the {@apilink PointerComponent}, by default Entities use\r\n * the {@apilink Collider}'s shape for pointer events.\r\n */\r\nexport class PointerSystem extends System {\r\n  static priority = SystemPriority.Higher;\r\n\r\n  public readonly systemType = SystemType.Update;\r\n\r\n  private _engine: Engine;\r\n  private _receivers: PointerEventReceiver[];\r\n  private _engineReceiver: PointerEventReceiver;\r\n  private _graphicsHashGrid = new SparseHashGrid<GraphicsComponent>({ size: 100 });\r\n  private _graphics: GraphicsComponent[] = [];\r\n  private _entityToPointer = new Map<Entity, PointerComponent>();\r\n  private _pointerEventDispatcher = new PointerEventsToObjectDispatcher();\r\n\r\n  query: Query<typeof TransformComponent | typeof PointerComponent>;\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent, PointerComponent]);\r\n\r\n    this.query.entityAdded$.subscribe((e) => {\r\n      const tx = e.get(TransformComponent);\r\n      const pointer = e.get(PointerComponent);\r\n      this._pointerEventDispatcher.addObject(\r\n        e,\r\n        (pos) => {\r\n          // If pointer bounds defined\r\n          if (pointer && pointer.localBounds) {\r\n            const pointerBounds = pointer.localBounds.transform(tx.get().matrix);\r\n            return pointerBounds.contains(tx.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos);\r\n          }\r\n          return false;\r\n        },\r\n        () => e.isActive\r\n      );\r\n      this._entityToPointer.set(e, pointer);\r\n      const maybeGfx = e.get(GraphicsComponent);\r\n      if (maybeGfx) {\r\n        this._graphics.push(maybeGfx);\r\n        this._graphicsHashGrid.track(maybeGfx);\r\n      }\r\n      this._sortedTransforms.push(tx);\r\n      this._sortedEntities.push(tx.owner);\r\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\r\n      this._zHasChanged = true;\r\n    });\r\n\r\n    this.query.entityRemoved$.subscribe((e) => {\r\n      this._pointerEventDispatcher.removeObject(e);\r\n      const tx = e.get(TransformComponent);\r\n      this._entityToPointer.delete(e);\r\n      const maybeGfx = e.get(GraphicsComponent);\r\n      if (maybeGfx) {\r\n        const index = this._graphics.indexOf(maybeGfx);\r\n        if (index > -1) {\r\n          this._graphics.splice(index, 1);\r\n        }\r\n        this._graphicsHashGrid.untrack(maybeGfx);\r\n      }\r\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\r\n      const index = this._sortedTransforms.indexOf(tx);\r\n      if (index > -1) {\r\n        this._sortedTransforms.splice(index, 1);\r\n        this._sortedEntities.splice(index, 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Optionally override component configuration for all entities\r\n   */\r\n  public overrideUseColliderShape = false;\r\n  /**\r\n   * Optionally override component configuration for all entities\r\n   */\r\n  public overrideUseGraphicsBounds = false;\r\n\r\n  private _scene: Scene<unknown>;\r\n\r\n  public initialize(world: World, scene: Scene): void {\r\n    this._engine = scene.engine;\r\n    this._scene = scene;\r\n  }\r\n\r\n  private _sortedTransforms: TransformComponent[] = [];\r\n  private _sortedEntities: Entity[] = [];\r\n\r\n  private _zHasChanged = false;\r\n  private _zIndexUpdate = () => {\r\n    this._zHasChanged = true;\r\n  };\r\n\r\n  public preupdate(): void {\r\n    if (this._scene.camera.hasChanged()) {\r\n      // if the camera has changed we want to force a transform update so pointers can be correctly calc'd\r\n      this._scene.camera.updateTransform(this._scene.camera.pos);\r\n    }\r\n\r\n    // event receiver might change per frame\r\n    this._receivers = [this._engine.input.pointers, this._scene.input.pointers];\r\n    this._engineReceiver = this._engine.input.pointers;\r\n    if (this._zHasChanged) {\r\n      this._sortedTransforms.sort((a, b) => {\r\n        return b.z - a.z;\r\n      });\r\n      this._sortedEntities = this._sortedTransforms.map((t) => t.owner);\r\n      this._zHasChanged = false;\r\n    }\r\n  }\r\n\r\n  public update(): void {\r\n    // Update graphics\r\n    this._graphicsHashGrid.update(this._graphics);\r\n\r\n    // Locate all the pointer/entity mappings\r\n    for (const [pointerId, pos] of this._engineReceiver.currentFramePointerCoords.entries()) {\r\n      const colliders = this._scene.physics.query(pos.worldPos);\r\n      for (let i = 0; i < colliders.length; i++) {\r\n        const collider = colliders[i];\r\n        const maybePointer = this._entityToPointer.get(collider.owner);\r\n        if (maybePointer && (maybePointer.useColliderShape || this.overrideUseColliderShape)) {\r\n          this._pointerEventDispatcher.addPointerToObject(collider.owner, pointerId);\r\n        }\r\n      }\r\n\r\n      const graphics = this._graphicsHashGrid.query(pos.worldPos);\r\n      for (let i = 0; i < graphics.length; i++) {\r\n        const graphic = graphics[i];\r\n        const maybePointer = this._entityToPointer.get(graphic.owner);\r\n        if (maybePointer && (maybePointer.useGraphicsBounds || this.overrideUseGraphicsBounds)) {\r\n          this._pointerEventDispatcher.addPointerToObject(graphic.owner, pointerId);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._pointerEventDispatcher.processPointerToObject(this._engineReceiver, this._sortedEntities);\r\n\r\n    // Dispatch pointer events on entities\r\n    this._pointerEventDispatcher.dispatchEvents(this._engineReceiver, this._sortedEntities);\r\n\r\n    // Dispatch pointer events on top level pointers\r\n    this._receivers.forEach((r) => r.update());\r\n\r\n    // Clear last frame's events\r\n    this._pointerEventDispatcher.clear();\r\n\r\n    this._receivers.forEach((r) => r.clear());\r\n  }\r\n}\r\n","import { Query, SystemPriority, World } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ActionsComponent } from './ActionsComponent';\r\n\r\nexport class ActionsSystem extends System {\r\n  static priority = SystemPriority.Higher;\r\n\r\n  systemType = SystemType.Update;\r\n  private _actions: ActionsComponent[] = [];\r\n  query: Query<typeof ActionsComponent>;\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([ActionsComponent]);\r\n\r\n    this.query.entityAdded$.subscribe((e) => this._actions.push(e.get(ActionsComponent)));\r\n    this.query.entityRemoved$.subscribe((e) => {\r\n      const action = e.get(ActionsComponent);\r\n      const index = this._actions.indexOf(action);\r\n      if (index > -1) {\r\n        this._actions.splice(index, 1);\r\n      }\r\n    });\r\n  }\r\n  update(elapsed: number): void {\r\n    for (let i = 0; i < this._actions.length; i++) {\r\n      const action = this._actions[i];\r\n      action.update(elapsed);\r\n    }\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem/Component';\r\nimport { IsometricMap } from './IsometricMap';\r\n\r\nexport interface IsometricEntityComponentOptions {\r\n  columns: number;\r\n  rows: number;\r\n  tileWidth: number;\r\n  tileHeight: number;\r\n}\r\n\r\nexport class IsometricEntityComponent extends Component {\r\n  /**\r\n   * Vertical \"height\" in the isometric world\r\n   */\r\n  public elevation: number = 0;\r\n\r\n  public readonly columns: number;\r\n  public readonly rows: number;\r\n  public readonly tileWidth: number;\r\n  public readonly tileHeight: number;\r\n\r\n  /**\r\n   * Specify the isometric map to use to position this entity's z-index\r\n   * @param mapOrOptions\r\n   */\r\n  constructor(mapOrOptions: IsometricMap | IsometricEntityComponentOptions) {\r\n    super();\r\n    this.columns = mapOrOptions.columns;\r\n    this.rows = mapOrOptions.rows;\r\n    this.tileWidth = mapOrOptions.tileWidth;\r\n    this.tileHeight = mapOrOptions.tileHeight;\r\n  }\r\n}\r\n","import { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\r\nimport { Query, SystemPriority, World } from '../EntityComponentSystem';\r\n\r\nexport class IsometricEntitySystem extends System {\r\n  static priority: number = SystemPriority.Lower;\r\n\r\n  public readonly systemType = SystemType.Update;\r\n  query: Query<typeof TransformComponent | typeof IsometricEntityComponent>;\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent, IsometricEntityComponent]);\r\n  }\r\n\r\n  update(): void {\r\n    let transform: TransformComponent;\r\n    let iso: IsometricEntityComponent;\r\n    for (let i = 0; i < this.query.entities.length; i++) {\r\n      const entity = this.query.entities[i];\r\n      transform = entity.get(TransformComponent);\r\n      iso = entity.get(IsometricEntityComponent);\r\n\r\n      const maxZindexPerElevation = Math.max(iso.columns * iso.tileWidth, iso.rows * iso.tileHeight);\r\n\r\n      const newZ = maxZindexPerElevation * iso.elevation + transform.pos.y;\r\n      transform.z = newZ;\r\n    }\r\n  }\r\n}\r\n","import { GraphicsComponent } from './GraphicsComponent';\r\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\r\nimport { Scene } from '../Scene';\r\nimport { Screen } from '../Screen';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Camera } from '../Camera';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ParallaxComponent } from './ParallaxComponent';\r\nimport { Vector } from '../Math/vector';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Query, SystemPriority, World } from '../EntityComponentSystem';\r\n\r\nexport class OffscreenSystem extends System {\r\n  static priority: number = SystemPriority.Higher;\r\n\r\n  public systemType = SystemType.Draw;\r\n  private _camera!: Camera;\r\n  private _screen!: Screen;\r\n  private _worldBounds!: BoundingBox;\r\n  query: Query<typeof TransformComponent | typeof GraphicsComponent>;\r\n\r\n  constructor(public world: World) {\r\n    super();\r\n    this.query = this.world.query([TransformComponent, GraphicsComponent]);\r\n  }\r\n\r\n  public initialize(world: World, scene: Scene): void {\r\n    this._camera = scene.camera;\r\n    this._screen = scene.engine.screen;\r\n  }\r\n\r\n  update(): void {\r\n    this._worldBounds = this._screen.getWorldBounds();\r\n    let transform: TransformComponent;\r\n    let graphics: GraphicsComponent;\r\n    let maybeParallax: ParallaxComponent | undefined;\r\n\r\n    for (let i = 0; i < this.query.entities.length; i++) {\r\n      const entity = this.query.entities[i];\r\n      graphics = entity.get(GraphicsComponent);\r\n      transform = entity.get(TransformComponent);\r\n      maybeParallax = entity.get(ParallaxComponent);\r\n\r\n      let parallaxOffset: Vector | undefined;\r\n      if (maybeParallax) {\r\n        // We use the Tiled formula\r\n        // https://doc.mapeditor.org/en/latest/manual/layers/#parallax-scrolling-factor\r\n        // cameraPos * (1 - parallaxFactor)\r\n        const oneMinusFactor = Vector.One.sub(maybeParallax.parallaxFactor);\r\n        parallaxOffset = this._camera.pos.scale(oneMinusFactor);\r\n      }\r\n\r\n      // Figure out if entities are offscreen\r\n      const entityOffscreen = this._isOffscreen(transform, graphics, parallaxOffset);\r\n      if (entityOffscreen && !entity.hasTag('ex.offscreen')) {\r\n        entity.events.emit('exitviewport', new ExitViewPortEvent(entity));\r\n        entity.addTag('ex.offscreen');\r\n      }\r\n\r\n      if (!entityOffscreen && entity.hasTag('ex.offscreen')) {\r\n        entity.events.emit('enterviewport', new EnterViewPortEvent(entity));\r\n        entity.removeTag('ex.offscreen');\r\n      }\r\n    }\r\n  }\r\n\r\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent, parallaxOffset: Vector | undefined) {\r\n    if (graphics.forceOnScreen) {\r\n      return false;\r\n    }\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      let bounds = graphics.localBounds;\r\n      if (parallaxOffset) {\r\n        bounds = bounds.translate(parallaxOffset);\r\n      }\r\n      const transformedBounds = bounds.transform(transform.get().matrix);\r\n      const graphicsOffscreen = !this._worldBounds.overlaps(transformedBounds);\r\n      return graphicsOffscreen;\r\n    } else {\r\n      // TODO screen coordinates\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","import { FrameStats } from '../../Debug/DebugConfig';\r\nimport { Entity } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { createId } from '../../Id';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Pool } from '../../Util/Pool';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { CollisionGroup } from '../Group/CollisionGroup';\r\nimport { CollisionContact } from './CollisionContact';\r\nimport { CollisionProcessor } from './CollisionProcessor';\r\nimport { Pair } from './Pair';\r\nimport { RayCastHit } from './RayCastHit';\r\nimport { RayCastOptions } from './RayCastOptions';\r\nimport { HashGridCell, HashGridProxy, SparseHashGrid } from './SparseHashGrid';\r\n\r\n/**\r\n * Proxy type to stash collision info\r\n */\r\nexport class HashColliderProxy extends HashGridProxy<Collider> {\r\n  id: number = -1;\r\n  owner: Entity;\r\n  body: BodyComponent;\r\n  collisionType: CollisionType;\r\n  hasZeroBounds = false;\r\n  /**\r\n   * left bounds x hash coordinate\r\n   */\r\n  leftX: number;\r\n  /**\r\n   * right bounds x hash coordinate\r\n   */\r\n  rightX: number;\r\n  /**\r\n   * bottom bounds y hash coordinate\r\n   */\r\n  bottomY: number;\r\n  /**\r\n   * top bounds y hash coordinate\r\n   */\r\n  topY: number;\r\n  /**\r\n   * References to the hash cell the collider is a current member of\r\n   */\r\n  cells: HashGridCell<Collider, HashColliderProxy>[] = [];\r\n  /**\r\n   * Grid size in pixels\r\n   */\r\n  readonly gridSize: number;\r\n  constructor(\r\n    public collider: Collider,\r\n    gridSize: number\r\n  ) {\r\n    super(collider, gridSize);\r\n    this.gridSize = gridSize;\r\n    const bounds = collider.bounds;\r\n    this.hasZeroBounds = bounds.hasZeroDimensions();\r\n    this.leftX = Math.floor(bounds.left / this.gridSize);\r\n    this.rightX = Math.floor(bounds.right / this.gridSize);\r\n    this.bottomY = Math.floor(bounds.bottom / this.gridSize);\r\n    this.topY = Math.floor(bounds.top / this.gridSize);\r\n    this.owner = collider.owner;\r\n    this.body = this.owner?.get(BodyComponent);\r\n    this.collisionType = this.body.collisionType ?? CollisionType.PreventCollision;\r\n  }\r\n\r\n  /**\r\n   * Updates the hashed bounds coordinates\r\n   */\r\n  update(): void {\r\n    super.update();\r\n    this.body = this.owner?.get(BodyComponent);\r\n    this.collisionType = this.body.collisionType ?? CollisionType.PreventCollision;\r\n    this.hasZeroBounds = this.collider.localBounds.hasZeroDimensions();\r\n  }\r\n}\r\n\r\n/**\r\n * This collision processor uses a sparsely populated grid of uniform cells to bucket potential\r\n * colliders together for the purpose of detecting collision pairs and collisions.\r\n */\r\nexport class SparseHashGridCollisionProcessor implements CollisionProcessor {\r\n  readonly gridSize: number;\r\n  readonly hashGrid: SparseHashGrid<Collider, HashColliderProxy>;\r\n\r\n  private _pairs = new Set<string>();\r\n  private _nonPairs = new Set<string>();\r\n\r\n  public _pairPool = new Pool<Pair>(\r\n    () => new Pair({ id: createId('collider', 0) } as Collider, { id: createId('collider', 0) } as Collider),\r\n    (instance) => {\r\n      instance.colliderA = null;\r\n      instance.colliderB = null;\r\n      return instance;\r\n    },\r\n    200\r\n  );\r\n\r\n  constructor(options: { size: number }) {\r\n    this.gridSize = options.size;\r\n    this.hashGrid = new SparseHashGrid<Collider, HashColliderProxy>({\r\n      size: this.gridSize,\r\n      proxyFactory: (collider, size) => new HashColliderProxy(collider, size)\r\n    });\r\n    this._pairPool.disableWarnings = true;\r\n\r\n    // TODO dynamic grid size potentially larger than the largest collider\r\n    // TODO Re-hash the objects if the median proves to be different\r\n  }\r\n\r\n  getColliders(): readonly Collider[] {\r\n    return Array.from(this.hashGrid.objectToProxy.keys());\r\n  }\r\n\r\n  query(point: Vector): Collider[];\r\n  query(bound: BoundingBox): Collider[];\r\n  query(boundsOrPoint: Vector | BoundingBox): Collider[] {\r\n    // FIXME workaround TS: https://github.com/microsoft/TypeScript/issues/14107\r\n    return this.hashGrid.query(boundsOrPoint as any);\r\n  }\r\n\r\n  rayCast(ray: Ray, options?: RayCastOptions): RayCastHit[] {\r\n    // DDA raycast algo\r\n    const results: RayCastHit[] = [];\r\n    const maxDistance = options?.maxDistance ?? Infinity;\r\n    const collisionGroup = options?.collisionGroup;\r\n    const collisionMask = !collisionGroup ? options?.collisionMask ?? CollisionGroup.All.category : collisionGroup.category;\r\n    const searchAllColliders = options?.searchAllColliders ?? false;\r\n\r\n    const unitRay = ray.dir.normalize();\r\n\r\n    const dydx = unitRay.y / unitRay.x;\r\n    const dxdy = unitRay.x / unitRay.y;\r\n\r\n    const unitStepX = Math.sqrt(1 + dydx * dydx) * this.gridSize;\r\n    const unitStepY = Math.sqrt(1 + dxdy * dxdy) * this.gridSize;\r\n\r\n    const startXCoord = ray.pos.x / this.gridSize;\r\n    const startYCoord = ray.pos.y / this.gridSize;\r\n\r\n    const stepDir = vec(1, 1);\r\n\r\n    let currentXCoord = ~~startXCoord;\r\n    let currentYCoord = ~~startYCoord;\r\n    let currentRayLengthX = 0;\r\n    let currentRayLengthY = 0;\r\n\r\n    if (unitRay.x < 0) {\r\n      stepDir.x = -1;\r\n      currentRayLengthX = (startXCoord - currentXCoord) * unitStepX;\r\n    } else {\r\n      stepDir.x = 1;\r\n      currentRayLengthX = (currentXCoord + 1 - startXCoord) * unitStepX;\r\n    }\r\n\r\n    if (unitRay.y < 0) {\r\n      stepDir.y = -1;\r\n      currentRayLengthY = (startYCoord - currentYCoord) * unitStepY;\r\n    } else {\r\n      stepDir.y = 1;\r\n      currentRayLengthY = (currentYCoord + 1 - startYCoord) * unitStepY;\r\n    }\r\n\r\n    const collidersVisited = new Set<number>();\r\n\r\n    let done = false;\r\n    let maxIterations = 9999;\r\n    while (!done && maxIterations > 0) {\r\n      maxIterations--; // safety exit\r\n      // exit if exhausted max hash grid coordinate, bounds of the sparse grid\r\n      if (!this.hashGrid.bounds.contains(vec(currentXCoord * this.gridSize, currentYCoord * this.gridSize))) {\r\n        break;\r\n      }\r\n      // Test colliders at cell\r\n      const key = HashGridCell.calculateHashKey(currentXCoord, currentYCoord);\r\n      const cell = this.hashGrid.sparseHashGrid.get(key);\r\n      if (cell) {\r\n        const cellHits: RayCastHit[] = [];\r\n        for (let colliderIndex = 0; colliderIndex < cell.proxies.length; colliderIndex++) {\r\n          const collider = cell.proxies[colliderIndex];\r\n          if (!collidersVisited.has(collider.collider.id.value)) {\r\n            collidersVisited.add(collider.collider.id.value);\r\n\r\n            if (options?.ignoreCollisionGroupAll && collider.body.group === CollisionGroup.All) {\r\n              continue;\r\n            }\r\n\r\n            const canCollide = (collisionMask & collider.body.group.category) !== 0;\r\n\r\n            // Early exit if not the right group\r\n            if (collider.body.group && !canCollide) {\r\n              continue;\r\n            }\r\n\r\n            const hit = collider.collider.rayCast(ray, maxDistance);\r\n\r\n            // Collect up all the colliders that hit inside a cell\r\n            // they can be in any order so we need to sort them next\r\n            if (hit) {\r\n              cellHits.push(hit);\r\n            }\r\n          }\r\n        }\r\n        cellHits.sort((hit1, hit2) => hit1.distance - hit2.distance);\r\n        for (let i = 0; i < cellHits.length; i++) {\r\n          const hit = cellHits[i];\r\n          if (options?.filter) {\r\n            if (options.filter(hit)) {\r\n              results.push(hit);\r\n              if (!searchAllColliders) {\r\n                done = true;\r\n                break;\r\n              }\r\n            }\r\n          } else {\r\n            results.push(hit);\r\n            if (!searchAllColliders) {\r\n              done = true;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (currentRayLengthX < currentRayLengthY) {\r\n        currentXCoord += stepDir.x;\r\n        currentRayLengthX += unitStepX;\r\n      } else {\r\n        currentYCoord += stepDir.y;\r\n        currentRayLengthY += unitStepY;\r\n      }\r\n    }\r\n\r\n    // Sort by distance\r\n    results.sort((hit1, hit2) => hit1.distance - hit2.distance);\r\n    if (!searchAllColliders && results.length) {\r\n      return [results[0]];\r\n    }\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Adds the collider to the internal data structure for collision tracking\r\n   * @param target\r\n   */\r\n  track(target: Collider): void {\r\n    let colliders = [target];\r\n    if (target instanceof CompositeCollider) {\r\n      const compColliders = target.getColliders();\r\n      for (const c of compColliders) {\r\n        c.owner = target.owner;\r\n      }\r\n      colliders = compColliders;\r\n    }\r\n\r\n    for (const target of colliders) {\r\n      this.hashGrid.track(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a collider from the internal data structure for tracking collisions\r\n   * @param target\r\n   */\r\n  untrack(target: Collider): void {\r\n    let colliders = [target];\r\n    if (target instanceof CompositeCollider) {\r\n      colliders = target.getColliders();\r\n    }\r\n\r\n    for (const target of colliders) {\r\n      this.hashGrid.untrack(target);\r\n    }\r\n  }\r\n\r\n  private _canCollide(colliderA: HashColliderProxy, colliderB: HashColliderProxy) {\r\n    // Prevent self collision\r\n    if (colliderA.collider.id === colliderB.collider.id) {\r\n      return false;\r\n    }\r\n\r\n    // Colliders with the same owner do not collide (composite colliders)\r\n    if (colliderA.owner && colliderB.owner && colliderA.owner.id === colliderB.owner.id) {\r\n      return false;\r\n    }\r\n\r\n    // if the pair has a member with zero dimension don't collide\r\n    if (colliderA.hasZeroBounds || colliderB.hasZeroBounds) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!colliderA.body.group.canCollide(colliderB.body.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (colliderA.collisionType === CollisionType.Fixed && colliderB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (colliderA.collisionType === CollisionType.PreventCollision || colliderB.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!colliderA.owner.isActive || !colliderB.owner.isActive) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Runs the broadphase sweep over tracked colliders and returns possible collision pairs\r\n   * @param targets\r\n   * @param elapsed\r\n   */\r\n  broadphase(targets: Collider[], elapsed: number): Pair[] {\r\n    const pairs: Pair[] = [];\r\n    this._pairs.clear();\r\n    this._nonPairs.clear();\r\n\r\n    let proxyId = 0;\r\n    for (const proxy of this.hashGrid.objectToProxy.values()) {\r\n      proxy.id = proxyId++; // track proxies we've already processed\r\n      if (!proxy.owner.isActive || proxy.collisionType === CollisionType.PreventCollision) {\r\n        continue;\r\n      }\r\n      // for every cell proxy collider is member of\r\n      for (let cellIndex = 0; cellIndex < proxy.cells.length; cellIndex++) {\r\n        const cell = proxy.cells[cellIndex];\r\n        // TODO Can we skip any cells or make this iteration faster?\r\n        // maybe a linked list here\r\n        for (let otherIndex = 0; otherIndex < cell.proxies.length; otherIndex++) {\r\n          const other = cell.proxies[otherIndex];\r\n          if (other.id === proxy.id) {\r\n            // skip duplicates\r\n            continue;\r\n          }\r\n          const id = Pair.calculatePairHash(proxy.collider.id, other.collider.id);\r\n          if (this._nonPairs.has(id)) {\r\n            continue; // Is there a way we can re-use the non-pair cache\r\n          }\r\n          if (!this._pairs.has(id) && this._canCollide(proxy, other) && proxy.object.bounds.overlaps(other.object.bounds)) {\r\n            const pair = this._pairPool.get();\r\n            pair.colliderA = proxy.collider;\r\n            pair.colliderB = other.collider;\r\n            pair.id = id;\r\n            this._pairs.add(id);\r\n            pairs.push(pair);\r\n          } else {\r\n            this._nonPairs.add(id);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return pairs;\r\n  }\r\n\r\n  /**\r\n   * Runs a fine grain pass on collision pairs and does geometry intersection tests producing any contacts\r\n   * @param pairs\r\n   * @param stats\r\n   */\r\n  narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    const contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      for (let j = 0; j < newContacts.length; j++) {\r\n        const c = newContacts[j];\r\n        contacts.push(c);\r\n        if (stats) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    this._pairPool.done();\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts; // TODO maybe we can re-use contacts as likely pairs next frame\r\n  }\r\n\r\n  /**\r\n   * Perform data structure maintenance, returns number of colliders updated\r\n   */\r\n  update(targets: Collider[], elapsed: number): number {\r\n    return this.hashGrid.update(targets);\r\n  }\r\n\r\n  /**\r\n   * Draws the internal data structure\r\n   * @param ex\r\n   * @param elapsed\r\n   */\r\n  debug(ex: ExcaliburGraphicsContext, elapsed: number): void {\r\n    this.hashGrid.debug(ex, elapsed);\r\n  }\r\n}\r\n","import { Ray } from '../Math/ray';\r\nimport { DeepRequired } from '../Util/Required';\r\nimport { Observable } from '../Util/Observable';\r\nimport {\r\n  BoundingBox,\r\n  Collider,\r\n  CollisionProcessor,\r\n  DynamicTreeCollisionProcessor,\r\n  RayCastHit,\r\n  RayCastOptions,\r\n  SparseHashGridCollisionProcessor\r\n} from './Index';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { PhysicsConfig } from './PhysicsConfig';\r\nimport { watchDeep } from '../Util/Watch';\r\nimport { Vector } from '../Math/vector';\r\nimport { SpatialPartitionStrategy } from './Detection/SpatialPartitionStrategy';\r\n\r\nexport class PhysicsWorld {\r\n  $configUpdate = new Observable<DeepRequired<PhysicsConfig>>();\r\n\r\n  private _configDirty = false;\r\n  private _config: DeepRequired<PhysicsConfig>;\r\n  get config(): DeepRequired<PhysicsConfig> {\r\n    return watchDeep(this._config, (change) => {\r\n      this.$configUpdate.notifyAll(change);\r\n    });\r\n  }\r\n  set config(newConfig: DeepRequired<PhysicsConfig>) {\r\n    this._config = newConfig;\r\n    this.$configUpdate.notifyAll(newConfig);\r\n  }\r\n\r\n  private _collisionProcessor: CollisionProcessor;\r\n  /**\r\n   * Spatial data structure for locating potential collision pairs and ray casts\r\n   */\r\n  public get collisionProcessor(): CollisionProcessor {\r\n    if (this._configDirty) {\r\n      this._configDirty = false;\r\n      // preserve tracked colliders if config updates\r\n      const colliders = this._collisionProcessor.getColliders();\r\n      if (this._config.spatialPartition === SpatialPartitionStrategy.SparseHashGrid) {\r\n        this._collisionProcessor = new SparseHashGridCollisionProcessor(this._config.sparseHashGrid);\r\n      } else {\r\n        this._collisionProcessor = new DynamicTreeCollisionProcessor(this._config);\r\n      }\r\n      for (const collider of colliders) {\r\n        this._collisionProcessor.track(collider);\r\n      }\r\n    }\r\n    return this._collisionProcessor;\r\n  }\r\n  constructor(config: DeepRequired<PhysicsConfig>) {\r\n    this.config = config;\r\n    this.$configUpdate.subscribe((config) => {\r\n      this._configDirty = true;\r\n      BodyComponent.updateDefaultPhysicsConfig(config.bodies);\r\n    });\r\n    if (this._config.spatialPartition === SpatialPartitionStrategy.SparseHashGrid) {\r\n      this._collisionProcessor = new SparseHashGridCollisionProcessor(this._config.sparseHashGrid);\r\n    } else {\r\n      this._collisionProcessor = new DynamicTreeCollisionProcessor(this._config);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Raycast into the scene's physics world\r\n   * @param ray\r\n   * @param options\r\n   */\r\n  public rayCast(ray: Ray, options?: RayCastOptions): RayCastHit[] {\r\n    return this.collisionProcessor.rayCast(ray, options);\r\n  }\r\n\r\n  /**\r\n   * Query for colliders in the scene's physics world\r\n   * @param point\r\n   */\r\n  public query(point: Vector): Collider[];\r\n  public query(bounds: BoundingBox): Collider[];\r\n  public query(pointOrBounds: Vector | BoundingBox): Collider[] {\r\n    // FIXME workaround TS: https://github.com/microsoft/TypeScript/issues/14107\r\n    return this._collisionProcessor.query(pointOrBounds as any);\r\n  }\r\n}\r\n","import { GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\n\r\nexport type GamepadEvents = {\r\n  connect: GamepadConnectEvent;\r\n  disconnect: GamepadDisconnectEvent;\r\n  button: GamepadButtonEvent;\r\n  axis: GamepadAxisEvent;\r\n};\r\n\r\nexport const GamepadEvents = {\r\n  GamepadConnect: 'connect',\r\n  GamepadDisconnect: 'disconnect',\r\n  GamepadButton: 'button',\r\n  GamepadAxis: 'axis'\r\n};\r\n\r\n/**\r\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\r\n * to provide controller support for your games.\r\n */\r\nexport class Gamepads {\r\n  public events = new EventEmitter<GamepadEvents>();\r\n  /**\r\n   * Whether or not to poll for Gamepad input (default: `false`)\r\n   */\r\n  public enabled = false;\r\n\r\n  /**\r\n   * Whether or not Gamepad API is supported\r\n   */\r\n  public supported = !!(<any>navigator).getGamepads;\r\n\r\n  /**\r\n   * The minimum value an axis has to move before considering it a change\r\n   */\r\n  public static MinAxisMoveThreshold = 0.05;\r\n\r\n  private _gamePadTimeStamps = [0, 0, 0, 0];\r\n  private _oldPads: Gamepad[] = [];\r\n  private _pads: Gamepad[] = [];\r\n  private _initSuccess: boolean = false;\r\n  private _navigator: NavigatorGamepads = <any>navigator;\r\n  private _minimumConfiguration: GamepadConfiguration = null;\r\n  private _enabled = true;\r\n\r\n  public init() {\r\n    if (!this.supported) {\r\n      return;\r\n    }\r\n    if (this._initSuccess) {\r\n      return;\r\n    }\r\n\r\n    // In Chrome, this will return 4 undefined items until a button is pressed\r\n    // In FF, this will not return any items until a button is pressed\r\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\r\n    if (this._oldPads.length && this._oldPads[0]) {\r\n      this._initSuccess = true;\r\n    }\r\n  }\r\n\r\n  public toggleEnabled(enabled: boolean) {\r\n    this._enabled = enabled;\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\r\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\r\n   * all other controllers with more axis or buttons are valid as well. If no minimum\r\n   * configuration is set all pads are valid.\r\n   */\r\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\r\n    this._enableAndUpdate(); // if config is used, implicitly enable\r\n    this._minimumConfiguration = config;\r\n  }\r\n\r\n  /**\r\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\r\n   */\r\n  private _enableAndUpdate() {\r\n    if (!this.enabled) {\r\n      this.enabled = true;\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks a navigator gamepad against the minimum configuration if present.\r\n   */\r\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\r\n    if (!this._minimumConfiguration) {\r\n      return true;\r\n    }\r\n    if (!pad) {\r\n      return false;\r\n    }\r\n    const axesLength = pad.axes.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n\r\n    const buttonLength = pad.buttons.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, event: GamepadEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Updates Gamepad state and publishes Gamepad events\r\n   */\r\n  public update() {\r\n    if (!this.enabled || !this.supported) {\r\n      return;\r\n    }\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n    this.init();\r\n\r\n    const gamepads = this._navigator.getGamepads();\r\n\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n      if (!gamepads[i]) {\r\n        const gamepad = this.at(i);\r\n        // If was connected, but now isn't emit the disconnect event\r\n        if (gamepad.connected) {\r\n          this.events.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\r\n        }\r\n        // Reset connection status\r\n        gamepad.connected = false;\r\n        continue;\r\n      } else {\r\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\r\n          this.events.emit('connect', new GamepadConnectEvent(i, this.at(i)));\r\n        }\r\n        // Set connection status\r\n        this.at(i).connected = true;\r\n      }\r\n\r\n      this.at(i).update();\r\n\r\n      // Only supported in Chrome\r\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\r\n        continue;\r\n      }\r\n\r\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\r\n\r\n      // Add reference to navigator gamepad\r\n      this.at(i).navigatorGamepad = gamepads[i];\r\n\r\n      // Buttons\r\n      let b: string, bi: number, a: string, ai: number, value: number;\r\n\r\n      for (b in Buttons) {\r\n        bi = <any>Buttons[b];\r\n        if (typeof bi === 'number') {\r\n          if (gamepads[i].buttons[bi]) {\r\n            value = gamepads[i].buttons[bi].value;\r\n            if (value !== this._oldPads[i].getButton(bi)) {\r\n              if (gamepads[i].buttons[bi].pressed) {\r\n                this.at(i).updateButton(bi, value);\r\n                this.at(i).events.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\r\n              } else {\r\n                this.at(i).updateButton(bi, 0);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Axes\r\n      for (a in Axes) {\r\n        ai = <any>Axes[a];\r\n        if (typeof ai === 'number') {\r\n          value = gamepads[i].axes[ai];\r\n          if (value !== this._oldPads[i].getAxes(ai)) {\r\n            this.at(i).updateAxes(ai, value);\r\n            this.at(i).events.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\r\n          }\r\n        }\r\n      }\r\n\r\n      this._oldPads[i] = this._clonePad(gamepads[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\r\n   */\r\n  public at(index: number): Gamepad {\r\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\r\n    if (index >= this._pads.length) {\r\n      // Ensure there is a pad to retrieve\r\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\r\n        this._pads.push(new Gamepad());\r\n        this._oldPads.push(new Gamepad());\r\n      }\r\n    }\r\n\r\n    return this._pads[index];\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\r\n   */\r\n  public getValidGamepads(): Gamepad[] {\r\n    this._enableAndUpdate();\r\n    const result: Gamepad[] = [];\r\n    for (let i = 0; i < this._pads.length; i++) {\r\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\r\n        result.push(this.at(i));\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the number of connected gamepads\r\n   */\r\n  public count() {\r\n    return this._pads.filter((p) => p.connected).length;\r\n  }\r\n\r\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\r\n    const arr = [];\r\n    for (let i = 0, len = pads.length; i < len; i++) {\r\n      arr.push(this._clonePad(pads[i]));\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  /**\r\n   * Fastest way to clone a known object is to do it yourself\r\n   */\r\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\r\n    let i, len;\r\n    const clonedPad = new Gamepad();\r\n\r\n    if (!pad) {\r\n      return clonedPad;\r\n    }\r\n\r\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\r\n      if (pad.buttons[i]) {\r\n        clonedPad.updateButton(i, pad.buttons[i].value);\r\n      }\r\n    }\r\n    for (i = 0, len = pad.axes.length; i < len; i++) {\r\n      clonedPad.updateAxes(i, pad.axes[i]);\r\n    }\r\n\r\n    return clonedPad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad holds state information for a connected controller. See {@apilink Gamepads}\r\n * for more information on handling controller input.\r\n */\r\nexport class Gamepad {\r\n  public events = new EventEmitter<GamepadEvents>();\r\n  public connected = false;\r\n  public navigatorGamepad: NavigatorGamepad;\r\n  private _axes: number[] = new Array(4);\r\n  private _buttons: number[] = new Array(16);\r\n  private _buttonsUp: number[] = new Array(16);\r\n  private _buttonsDown: number[] = new Array(16);\r\n\r\n  constructor() {\r\n    for (let i = 0; i < this._buttons.length; i++) {\r\n      this._buttons[i] = 0;\r\n    }\r\n    for (let i = 0; i < this._axes.length; i++) {\r\n      this._axes[i] = 0;\r\n    }\r\n  }\r\n\r\n  public update() {\r\n    // Reset buttonsDown and buttonsUp after update is complete\r\n    this._buttonsDown = new Array(16);\r\n    this._buttonsUp = new Array(16);\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given button is pressed\r\n   * @deprecated will be removed in v0.28.0. Use isButtonHeld instead\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain button is held down. This is persisted between frames.\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonHeld(button: Buttons, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain button was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param button Test whether a button was just pressed\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public wasButtonPressed(button: Buttons, threshold: number = 1) {\r\n    return this._buttonsDown[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain button was just released this frame. This is cleared at the end of the update frame.\r\n   * @param button  Test whether a button was just released\r\n   */\r\n  public wasButtonReleased(button: Buttons) {\r\n    return Boolean(this._buttonsUp[button]);\r\n  }\r\n\r\n  /**\r\n   * Gets the given button value between 0 and 1\r\n   */\r\n  public getButton(button: Buttons) {\r\n    return this._buttons[button];\r\n  }\r\n\r\n  /**\r\n   * Gets the given axis value between -1 and 1. Values below\r\n   * {@apilink MinAxisMoveThreshold} are considered 0.\r\n   */\r\n  public getAxes(axes: Axes) {\r\n    const value = this._axes[axes];\r\n\r\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\r\n      return 0;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  public updateButton(buttonIndex: number, value: number) {\r\n    // button was just released\r\n    if (value === 0 && this._buttons[buttonIndex]) {\r\n      this._buttonsUp[buttonIndex] = 1;\r\n\r\n      // button was just pressed\r\n    } else {\r\n      this._buttonsDown[buttonIndex] = value;\r\n    }\r\n\r\n    this._buttons[buttonIndex] = value;\r\n  }\r\n\r\n  public updateAxes(axesIndex: number, value: number) {\r\n    this._axes[axesIndex] = value;\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, event: GamepadEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<GamepadEvents>>(eventName: TEventName, handler: Handler<GamepadEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<GamepadEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad Buttons enumeration\r\n */\r\nexport enum Buttons {\r\n  /**\r\n   * Face 1 button (e.g. A)\r\n   */\r\n  Face1 = 0,\r\n  /**\r\n   * Face 2 button (e.g. B)\r\n   */\r\n  Face2 = 1,\r\n  /**\r\n   * Face 3 button (e.g. X)\r\n   */\r\n  Face3 = 2,\r\n  /**\r\n   * Face 4 button (e.g. Y)\r\n   */\r\n  Face4 = 3,\r\n  /**\r\n   * Left bumper button\r\n   */\r\n  LeftBumper = 4,\r\n  /**\r\n   * Right bumper button\r\n   */\r\n  RightBumper = 5,\r\n  /**\r\n   * Left trigger button\r\n   */\r\n  LeftTrigger = 6,\r\n  /**\r\n   * Right trigger button\r\n   */\r\n  RightTrigger = 7,\r\n  /**\r\n   * Select button\r\n   */\r\n  Select = 8,\r\n  /**\r\n   * Start button\r\n   */\r\n  Start = 9,\r\n  /**\r\n   * Left analog stick press (e.g. L3)\r\n   */\r\n  LeftStick = 10,\r\n  /**\r\n   * Right analog stick press (e.g. R3)\r\n   */\r\n  RightStick = 11,\r\n  /**\r\n   * D-pad up\r\n   */\r\n  DpadUp = 12,\r\n  /**\r\n   * D-pad down\r\n   */\r\n  DpadDown = 13,\r\n  /**\r\n   * D-pad left\r\n   */\r\n  DpadLeft = 14,\r\n  /**\r\n   * D-pad right\r\n   */\r\n  DpadRight = 15\r\n}\r\n\r\n/**\r\n * Gamepad Axes enumeration\r\n */\r\nexport enum Axes {\r\n  /**\r\n   * Left analogue stick X direction\r\n   */\r\n  LeftStickX = 0,\r\n  /**\r\n   * Left analogue stick Y direction\r\n   */\r\n  LeftStickY = 1,\r\n  /**\r\n   * Right analogue stick X direction\r\n   */\r\n  RightStickX = 2,\r\n  /**\r\n   * Right analogue stick Y direction\r\n   */\r\n  RightStickY = 3\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepads {\r\n  getGamepads(): NavigatorGamepad[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepad {\r\n  axes: number[];\r\n  buttons: NavigatorGamepadButton[];\r\n  connected: boolean;\r\n  id: string;\r\n  index: number;\r\n  mapping: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadButton {\r\n  pressed: boolean;\r\n  value: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadEvent {\r\n  gamepad: NavigatorGamepad;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface GamepadConfiguration {\r\n  axis: number;\r\n  buttons: number;\r\n}\r\n","import { Logger } from '../Util/Log';\r\nimport * as Events from '../Events';\r\nimport { isCrossOriginIframe } from '../Util/IFrame';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\n\r\n/**\r\n * Enum representing physical input key codes\r\n *\r\n * Spec: https://w3c.github.io/uievents-code/#key-alphanumeric-section\r\n */\r\nexport enum Keys {\r\n  // Writing System Keys https://w3c.github.io/uievents-code/#key-alphanumeric-writing-system\r\n  Backquote = 'Backquote',\r\n  Backslash = 'Backslash',\r\n  BracketLeft = 'BracketLeft',\r\n  BracketRight = 'BracketRight',\r\n  Comma = 'Comma',\r\n\r\n  // NUMBERS\r\n  Key0 = 'Digit0',\r\n  Key1 = 'Digit1',\r\n  Key2 = 'Digit2',\r\n  Key3 = 'Digit3',\r\n  Key4 = 'Digit4',\r\n  Key5 = 'Digit5',\r\n  Key6 = 'Digit6',\r\n  Key7 = 'Digit7',\r\n  Key8 = 'Digit8',\r\n  Key9 = 'Digit9',\r\n  Digit0 = 'Digit0',\r\n  Digit1 = 'Digit1',\r\n  Digit2 = 'Digit2',\r\n  Digit3 = 'Digit3',\r\n  Digit4 = 'Digit4',\r\n  Digit5 = 'Digit5',\r\n  Digit6 = 'Digit6',\r\n  Digit7 = 'Digit7',\r\n  Digit8 = 'Digit8',\r\n  Digit9 = 'Digit9',\r\n\r\n  Equal = 'Equal',\r\n\r\n  IntlBackslash = 'IntlBackslash',\r\n  IntlRo = 'IntlRo',\r\n  IntlYen = 'IntlYen',\r\n\r\n  // LETTERS\r\n  A = 'KeyA',\r\n  B = 'KeyB',\r\n  C = 'KeyC',\r\n  D = 'KeyD',\r\n  E = 'KeyE',\r\n  F = 'KeyF',\r\n  G = 'KeyG',\r\n  H = 'KeyH',\r\n  I = 'KeyI',\r\n  J = 'KeyJ',\r\n  K = 'KeyK',\r\n  L = 'KeyL',\r\n  M = 'KeyM',\r\n  N = 'KeyN',\r\n  O = 'KeyO',\r\n  P = 'KeyP',\r\n  Q = 'KeyQ',\r\n  R = 'KeyR',\r\n  S = 'KeyS',\r\n  T = 'KeyT',\r\n  U = 'KeyU',\r\n  V = 'KeyV',\r\n  W = 'KeyW',\r\n  X = 'KeyX',\r\n  Y = 'KeyY',\r\n  Z = 'KeyZ',\r\n  KeyA = 'KeyA',\r\n  KeyB = 'KeyB',\r\n  KeyC = 'KeyC',\r\n  KeyD = 'KeyD',\r\n  KeyE = 'KeyE',\r\n  KeyF = 'KeyF',\r\n  KeyG = 'KeyG',\r\n  KeyH = 'KeyH',\r\n  KeyI = 'KeyI',\r\n  KeyJ = 'KeyJ',\r\n  KeyK = 'KeyK',\r\n  KeyL = 'KeyL',\r\n  KeyM = 'KeyM',\r\n  KeyN = 'KeyN',\r\n  KeyO = 'KeyO',\r\n  KeyP = 'KeyP',\r\n  KeyQ = 'KeyQ',\r\n  KeyR = 'KeyR',\r\n  KeyS = 'KeyS',\r\n  KeyT = 'KeyT',\r\n  KeyU = 'KeyU',\r\n  KeyV = 'KeyV',\r\n  KeyW = 'KeyW',\r\n  KeyX = 'KeyX',\r\n  KeyY = 'KeyY',\r\n  KeyZ = 'KeyZ',\r\n\r\n  // SYMBOLS\r\n  Minus = 'Minus',\r\n  Period = 'Period',\r\n  Quote = 'Quote',\r\n  Semicolon = 'Semicolon',\r\n  Slash = 'Slash',\r\n\r\n  // Functional keys https://w3c.github.io/uievents-code/#key-alphanumeric-functional\r\n  AltLeft = 'AltLeft',\r\n  AltRight = 'AltRight',\r\n  Alt = 'Alt',\r\n  AltGraph = 'AltGraph',\r\n  Backspace = 'Backspace',\r\n  CapsLock = 'CapsLock',\r\n  ContextMenu = 'ContextMenu',\r\n  ControlLeft = 'ControlLeft',\r\n  ControlRight = 'ControlRight',\r\n  Enter = 'Enter',\r\n  MetaLeft = 'MetaLeft',\r\n  MetaRight = 'MetaRight',\r\n  ShiftLeft = 'ShiftLeft',\r\n  ShiftRight = 'ShiftRight',\r\n  Space = 'Space',\r\n  Tab = 'Tab',\r\n\r\n  Convert = 'Convert',\r\n  KanaMode = 'KanaMode',\r\n  NonConvert = 'NonConvert',\r\n\r\n  // Control Pad https://w3c.github.io/uievents-code/#key-controlpad-section\r\n  Delete = 'Delete',\r\n  End = 'End',\r\n  Help = 'Help',\r\n  Home = 'Home',\r\n  Insert = 'Insert',\r\n  PageDown = 'PageDown',\r\n  PageUp = 'PageUp',\r\n\r\n  // Arrow Pad https://w3c.github.io/uievents-code/#key-arrowpad-section\r\n  Up = 'ArrowUp',\r\n  Down = 'ArrowDown',\r\n  Left = 'ArrowLeft',\r\n  Right = 'ArrowRight',\r\n\r\n  ArrowUp = 'ArrowUp',\r\n  ArrowDown = 'ArrowDown',\r\n  ArrowLeft = 'ArrowLeft',\r\n  ArrowRight = 'ArrowRight',\r\n\r\n  // Numpad Section https://w3c.github.io/uievents-code/#key-numpad-section\r\n  NumLock = 'NumLock',\r\n  Numpad0 = 'Numpad0',\r\n  Numpad1 = 'Numpad1',\r\n  Numpad2 = 'Numpad2',\r\n  Numpad3 = 'Numpad3',\r\n  Numpad4 = 'Numpad4',\r\n  Numpad5 = 'Numpad5',\r\n  Numpad6 = 'Numpad6',\r\n  Numpad7 = 'Numpad7',\r\n  Numpad8 = 'Numpad8',\r\n  Numpad9 = 'Numpad9',\r\n  Num0 = 'Numpad0',\r\n  Num1 = 'Numpad1',\r\n  Num2 = 'Numpad2',\r\n  Num3 = 'Numpad3',\r\n  Num4 = 'Numpad4',\r\n  Num5 = 'Numpad5',\r\n  Num6 = 'Numpad6',\r\n  Num7 = 'Numpad7',\r\n  Num8 = 'Numpad8',\r\n  Num9 = 'Numpad9',\r\n\r\n  NumAdd = 'NumpadAdd',\r\n  NumpadAdd = 'NumpadAdd',\r\n\r\n  NumDecimal = 'NumpadDecimal',\r\n  NumpadDecimal = 'NumpadDecimal',\r\n\r\n  NumDivide = 'NumpadDivide',\r\n  NumpadDivide = 'NumpadDivide',\r\n\r\n  NumEnter = 'NumpadEnter',\r\n  NumpadEnter = 'NumpadEnter',\r\n\r\n  NumMultiply = 'NumpadMultiply',\r\n  NumpadMultiply = 'NumpadMultiply',\r\n\r\n  NumSubtract = 'NumpadSubtract',\r\n  NumpadSubtract = 'NumpadSubtract',\r\n  // NumComma = 'NumpadComma', // not x-browser\r\n  // NumpadComma = 'NumpadComma', // not x-browser\r\n\r\n  // Function section https://w3c.github.io/uievents-code/#key-function-section\r\n  Esc = 'Escape',\r\n  Escape = 'Escape',\r\n  F1 = 'F1',\r\n  F2 = 'F2',\r\n  F3 = 'F3',\r\n  F4 = 'F4',\r\n  F5 = 'F5',\r\n  F6 = 'F6',\r\n  F7 = 'F7',\r\n  F8 = 'F8',\r\n  F9 = 'F9',\r\n  F10 = 'F10',\r\n  F11 = 'F11',\r\n  F12 = 'F12',\r\n  F13 = 'F13',\r\n  F14 = 'F14',\r\n  F15 = 'F15',\r\n  F16 = 'F16',\r\n  F17 = 'F17',\r\n  F18 = 'F18',\r\n  F19 = 'F19',\r\n  F20 = 'F20',\r\n  PrintScreen = 'PrintScreen',\r\n  ScrollLock = 'ScrollLock',\r\n  Pause = 'Pause',\r\n\r\n  Unidentified = 'Unidentified'\r\n}\r\n\r\n/**\r\n * Event thrown on a game object for a key event\r\n */\r\nexport class KeyEvent extends Events.GameEvent<any> {\r\n  /**\r\n   * @param key  The key responsible for throwing the event\r\n   * @param value The key's typed value the browser detected\r\n   * @param originalEvent The original keyboard event that Excalibur handled\r\n   */\r\n  constructor(\r\n    public key: Keys,\r\n    public value?: string,\r\n    public originalEvent?: KeyboardEvent\r\n  ) {\r\n    super();\r\n  }\r\n}\r\n\r\nexport interface KeyboardInitOptions {\r\n  global?: GlobalEventHandlers;\r\n  grabWindowFocus?: boolean;\r\n}\r\n\r\nexport type KeyEvents = {\r\n  press: KeyEvent;\r\n  hold: KeyEvent;\r\n  release: KeyEvent;\r\n};\r\n\r\nexport const KeyEvents = {\r\n  Press: 'press',\r\n  Hold: 'hold',\r\n  Release: 'release'\r\n};\r\n\r\n/**\r\n * Provides keyboard support for Excalibur.\r\n */\r\nexport class Keyboard {\r\n  public events = new EventEmitter<KeyEvents>();\r\n  private _enabled = true;\r\n  /**\r\n   * Keys that are currently held down\r\n   */\r\n  private _keys: Keys[] = [];\r\n  /**\r\n   * Keys up in the current frame\r\n   */\r\n  private _keysUp: Keys[] = [];\r\n  /**\r\n   * Keys down in the current frame\r\n   */\r\n  private _keysDown: Keys[] = [];\r\n\r\n  public emit<TEventName extends EventKey<KeyEvents>>(eventName: TEventName, event: KeyEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<KeyEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<KeyEvents>>(eventName: TEventName, handler: Handler<KeyEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<KeyEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<KeyEvents>>(eventName: TEventName, handler: Handler<KeyEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<KeyEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<KeyEvents>>(eventName: TEventName, handler: Handler<KeyEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<KeyEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Initialize Keyboard event listeners\r\n   */\r\n  init(keyboardOptions?: KeyboardInitOptions): void {\r\n    let { global } = keyboardOptions;\r\n    const { grabWindowFocus } = keyboardOptions;\r\n    if (!global) {\r\n      if (isCrossOriginIframe()) {\r\n        global = window;\r\n        // Workaround for iframes like for itch.io or codesandbox\r\n        // https://www.reddit.com/r/gamemaker/comments/kfs5cs/keyboard_inputs_no_longer_working_in_html5_game/\r\n        // https://forum.gamemaker.io/index.php?threads/solved-keyboard-issue-on-itch-io.87336/\r\n        if (grabWindowFocus) {\r\n          window.focus();\r\n        }\r\n\r\n        Logger.getInstance().warn('Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus');\r\n      } else {\r\n        global = window.top;\r\n      }\r\n    }\r\n\r\n    global.addEventListener('blur', () => {\r\n      this._keys.length = 0; // empties array efficiently\r\n    });\r\n\r\n    // key up is on window because canvas cannot have focus\r\n    global.addEventListener('keyup', this._handleKeyUp);\r\n\r\n    // key down is on window because canvas cannot have focus\r\n    global.addEventListener('keydown', this._handleKeyDown);\r\n  }\r\n\r\n  toggleEnabled(enabled: boolean) {\r\n    this._enabled = enabled;\r\n  }\r\n\r\n  private _releaseAllKeys = (ev: KeyboardEvent) => {\r\n    for (const code of this._keys) {\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n      this.events.emit('up', keyEvent);\r\n      this.events.emit('release', keyEvent);\r\n    }\r\n    this._keysUp = Array.from(new Set(this._keys.concat(this._keysUp)));\r\n    this._keys.length = 0;\r\n  };\r\n\r\n  public clear() {\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n    this._keys.length = 0;\r\n  }\r\n\r\n  private _handleKeyDown = (ev: KeyboardEvent) => {\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n\r\n    // handle macos meta key issue\r\n    // https://github.com/excaliburjs/Excalibur/issues/2608\r\n    if (!ev.metaKey && (this._keys.includes(Keys.MetaLeft) || this._keys.includes(Keys.MetaRight))) {\r\n      this._releaseAllKeys(ev);\r\n    }\r\n\r\n    const code = ev.code as Keys;\r\n    if (this._keys.indexOf(code) === -1) {\r\n      this._keys.push(code);\r\n      this._keysDown.push(code);\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n      this.events.emit('down', keyEvent);\r\n      this.events.emit('press', keyEvent);\r\n    }\r\n  };\r\n\r\n  private _handleKeyUp = (ev: KeyboardEvent) => {\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n    const code = ev.code as Keys;\r\n    const key = this._keys.indexOf(code);\r\n    this._keys.splice(key, 1);\r\n    this._keysUp.push(code);\r\n    const keyEvent = new KeyEvent(code, ev.key, ev);\r\n\r\n    // alias the old api, we may want to deprecate this in the future\r\n    this.events.emit('up', keyEvent);\r\n    this.events.emit('release', keyEvent);\r\n\r\n    // handle macos meta key issue\r\n    // https://github.com/excaliburjs/Excalibur/issues/2608\r\n    if (ev.key === 'Meta') {\r\n      this._releaseAllKeys(ev);\r\n    }\r\n  };\r\n\r\n  public update() {\r\n    // Reset keysDown and keysUp after update is complete\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n\r\n    // Emit synthetic \"hold\" event\r\n    for (let i = 0; i < this._keys.length; i++) {\r\n      this.events.emit('hold', new KeyEvent(this._keys[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets list of keys being pressed down\r\n   */\r\n  public getKeys(): Keys[] {\r\n    return this._keys;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param key Test whether a key was just pressed\r\n   */\r\n  public wasPressed(key: Keys): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this._keysDown.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key is held down. This is persisted between frames.\r\n   * @param key  Test whether a key is held down\r\n   */\r\n  public isHeld(key: Keys): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this._keys.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\r\n   * @param key  Test whether a key was just released\r\n   */\r\n  public wasReleased(key: Keys): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this._keysUp.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Trigger a manual key event\r\n   * @param type\r\n   * @param key\r\n   * @param character\r\n   */\r\n  public triggerEvent(type: 'down' | 'up', key: Keys, character?: string) {\r\n    if (type === 'down') {\r\n      this._handleKeyDown(\r\n        new KeyboardEvent('keydown', {\r\n          code: key,\r\n          key: character ?? null\r\n        })\r\n      );\r\n    }\r\n    if (type === 'up') {\r\n      this._handleKeyUp(\r\n        new KeyboardEvent('keyup', {\r\n          code: key,\r\n          key: character ?? null\r\n        })\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { Gamepads } from './Gamepad';\r\nimport { Keyboard } from './Keyboard';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\n\r\nexport interface InputsOptions {\r\n  keyboard: Keyboard;\r\n  gamepads: Gamepads;\r\n  pointers: PointerEventReceiver;\r\n}\r\n\r\n/**\r\n * This allows you to map multiple inputs to specific commands! This is especially useful when\r\n * you need to allow multiple input sources to control a specific action.\r\n */\r\nexport class InputMapper {\r\n  private _handlers = new Map<any, any>();\r\n  constructor(public inputs: InputsOptions) {}\r\n\r\n  /**\r\n   * Executes the input map, called internally by Excalibur\r\n   */\r\n  execute() {\r\n    for (const [input, command] of this._handlers.entries()) {\r\n      const results = input(this.inputs);\r\n      if (results) {\r\n        command(results);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This allows you to map multiple inputs to specific commands! This is useful\r\n   *\r\n   * The inputHandler should return a truthy value if you wish the commandHandler to fire.\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const moveRight = (amount: number) => { actor.vel.x = 100 * amount }\r\n   * const moveLeft = (amount: number) => { actor.vel.x = -100 * amount }\r\n   * const moveUp = (amount: number) => { actor.vel.y = -100 * amount }\r\n   * const moveDown = (amount: number) => { actor.vel.y = 100 * amount }\r\n   *\r\n   * engine.inputMapper.on(({keyboard}) => keyboard.isHeld(ex.Keys.ArrowRight) ? 1 : 0, moveRight);\r\n   * engine.inputMapper.on(({gamepads}) => gamepads.at(0).isButtonPressed(ex.Buttons.DpadRight) ? 1 : 0, moveRight);\r\n   * engine.inputMapper.on(({gamepads}) => gamepads.at(0).getAxes(ex.Axes.LeftStickX) > 0 ?\r\n   *  gamepads.at(0).getAxes(ex.Axes.LeftStickX) : 0, moveRight);\r\n   * ```\r\n   * @param inputHandler\r\n   * @param commandHandler\r\n   */\r\n  on<TInputHandlerData>(\r\n    inputHandler: (inputs: InputsOptions) => TInputHandlerData | false,\r\n    commandHandler: (data: TInputHandlerData) => any\r\n  ) {\r\n    this._handlers.set(inputHandler, commandHandler);\r\n  }\r\n}\r\n","/**\r\n * Checks if excalibur is in a x-origin iframe\r\n */\r\nexport function isCrossOriginIframe() {\r\n  try {\r\n    // Try and listen to events on top window frame if within an iframe.\r\n    //\r\n    // See https://github.com/excaliburjs/Excalibur/issues/1294\r\n    //\r\n    // Attempt to add an event listener, which triggers a DOMException on\r\n    // cross-origin iframes\r\n    const noop = () => {\r\n      return;\r\n    };\r\n    window.top.addEventListener('blur', noop);\r\n    window.top.removeEventListener('blur', noop);\r\n  } catch {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Vector } from './vector';\r\n\r\nexport class GlobalCoordinates {\r\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\r\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\r\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\r\n    let pageX: number;\r\n    let pageY: number;\r\n    let pagePos: Vector;\r\n    let engine: Engine;\r\n\r\n    if (arguments.length === 3) {\r\n      pageX = <number>xOrPos;\r\n      pageY = <number>yOrEngine;\r\n      pagePos = new Vector(pageX, pageY);\r\n      engine = engineOrUndefined;\r\n    } else {\r\n      pagePos = <Vector>xOrPos;\r\n      pageX = pagePos.x;\r\n      pageY = pagePos.y;\r\n      engine = <Engine>yOrEngine;\r\n    }\r\n\r\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\r\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\r\n\r\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\r\n  }\r\n\r\n  constructor(\r\n    public worldPos: Vector,\r\n    public pagePos: Vector,\r\n    public screenPos: Vector\r\n  ) {}\r\n}\r\n","import { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Vector } from '../Math/vector';\r\nimport { PointerButton } from './PointerButton';\r\nimport { PointerType } from './PointerType';\r\n\r\nexport class PointerEvent {\r\n  public active = true;\r\n  public cancel() {\r\n    this.active = false;\r\n  }\r\n\r\n  get pagePos(): Vector {\r\n    return this.coordinates.pagePos;\r\n  }\r\n\r\n  get screenPos(): Vector {\r\n    return this.coordinates.screenPos;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    return this.coordinates.worldPos;\r\n  }\r\n\r\n  constructor(\r\n    public type: 'down' | 'up' | 'move' | 'cancel',\r\n    public pointerId: number,\r\n    public button: PointerButton,\r\n    public pointerType: PointerType,\r\n    public coordinates: GlobalCoordinates,\r\n    public nativeEvent: Event\r\n  ) {}\r\n}\r\n","import { WheelDeltaMode } from './WheelDeltaMode';\r\n\r\nexport class WheelEvent {\r\n  public active = true;\r\n  public cancel() {\r\n    this.active = false;\r\n  }\r\n  constructor(\r\n    public x: number,\r\n    public y: number,\r\n    public pageX: number,\r\n    public pageY: number,\r\n    public screenX: number,\r\n    public screenY: number,\r\n    public index: number,\r\n    public deltaX: number,\r\n    public deltaY: number,\r\n    public deltaZ: number,\r\n    public deltaMode: WheelDeltaMode,\r\n    public ev: Event\r\n  ) {}\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\nimport { PointerEvents } from './PointerEventReceiver';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Engine } from '../Engine';\r\n\r\nexport class PointerAbstraction {\r\n  public events = new EventEmitter<PointerEvents>();\r\n  /**\r\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastPagePos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastScreenPos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastWorldPos: Vector = Vector.Zero;\r\n\r\n  constructor() {\r\n    this.on('move', this._onPointerMove);\r\n    this.on('down', this._onPointerDown);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, event: PointerEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Called internally by excalibur to keep pointers up to date\r\n   * @internal\r\n   * @param engine\r\n   */\r\n  public _updateWorldPosition(engine: Engine) {\r\n    const coord = GlobalCoordinates.fromPagePosition(this.lastPagePos, engine);\r\n    this.lastScreenPos = coord.screenPos;\r\n    this.lastWorldPos = coord.worldPos;\r\n  }\r\n\r\n  private _onPointerMove = (ev: PointerEvent): void => {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  };\r\n\r\n  private _onPointerDown = (ev: PointerEvent): void => {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  };\r\n}\r\n","export enum WheelDeltaMode {\r\n  Pixel = 'Pixel',\r\n  Line = 'Line',\r\n  Page = 'Page'\r\n}\r\n","/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n","/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n","/**\r\n * The type of pointer for a {@apilink PointerEvent}.\r\n */\r\nexport enum PointerType {\r\n  Touch = 'Touch',\r\n  Mouse = 'Mouse',\r\n  Pen = 'Pen',\r\n  Unknown = 'Unknown'\r\n}\r\n","import { Engine, ScrollPreventionMode } from '../Engine';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { WheelEvent } from './WheelEvent';\r\nimport { PointerAbstraction } from './PointerAbstraction';\r\n\r\nimport { WheelDeltaMode } from './WheelDeltaMode';\r\nimport { PointerSystem } from './PointerSystem';\r\nimport { NativePointerButton } from './NativePointerButton';\r\nimport { PointerButton } from './PointerButton';\r\nimport { fail } from '../Util/Util';\r\nimport { PointerType } from './PointerType';\r\nimport { isCrossOriginIframe } from '../Util/IFrame';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from '../EventEmitter';\r\n\r\nexport type NativePointerEvent = globalThis.PointerEvent;\r\nexport type NativeMouseEvent = globalThis.MouseEvent;\r\nexport type NativeTouchEvent = globalThis.TouchEvent;\r\nexport type NativeWheelEvent = globalThis.WheelEvent;\r\n\r\nexport type PointerEvents = {\r\n  move: PointerEvent;\r\n  down: PointerEvent;\r\n  up: PointerEvent;\r\n  wheel: WheelEvent;\r\n};\r\n\r\nexport const PointerEvents = {\r\n  Move: 'move',\r\n  Down: 'down',\r\n  Up: 'up',\r\n  Wheel: 'wheel'\r\n};\r\n\r\n/**\r\n * Is this event a native touch event?\r\n */\r\nfunction isTouchEvent(value: any): value is NativeTouchEvent {\r\n  // Guard for Safari <= 13.1\r\n  return globalThis.TouchEvent && value instanceof globalThis.TouchEvent;\r\n}\r\n\r\n/**\r\n * Is this event a native pointer event\r\n */\r\nfunction isPointerEvent(value: any): value is NativePointerEvent {\r\n  // Guard for Safari <= 13.1\r\n  return globalThis.PointerEvent && value instanceof globalThis.PointerEvent;\r\n}\r\n\r\nexport interface PointerInitOptions {\r\n  grabWindowFocus?: boolean;\r\n}\r\n\r\n/**\r\n * The PointerEventProcessor is responsible for collecting all the events from the canvas and transforming them into GlobalCoordinates\r\n */\r\nexport class PointerEventReceiver {\r\n  public events = new EventEmitter<PointerEvents>();\r\n  public primary: PointerAbstraction = new PointerAbstraction();\r\n\r\n  private _activeNativePointerIdsToNormalized = new Map<number, number>();\r\n  public lastFramePointerCoords = new Map<number, GlobalCoordinates>();\r\n  public currentFramePointerCoords = new Map<number, GlobalCoordinates>();\r\n\r\n  public currentFramePointerDown = new Map<number, boolean>();\r\n  public lastFramePointerDown = new Map<number, boolean>();\r\n\r\n  public currentFrameDown: PointerEvent[] = [];\r\n  public currentFrameUp: PointerEvent[] = [];\r\n  public currentFrameMove: PointerEvent[] = [];\r\n  public currentFrameCancel: PointerEvent[] = [];\r\n  public currentFrameWheel: WheelEvent[] = [];\r\n\r\n  private _enabled = true;\r\n\r\n  constructor(\r\n    public readonly target: GlobalEventHandlers & EventTarget,\r\n    public engine: Engine\r\n  ) {}\r\n\r\n  public toggleEnabled(enabled: boolean) {\r\n    this._enabled = enabled;\r\n  }\r\n\r\n  /**\r\n   * Creates a new PointerEventReceiver with a new target and engine while preserving existing pointer event\r\n   * handlers.\r\n   * @param target\r\n   * @param engine\r\n   */\r\n  public recreate(target: GlobalEventHandlers & EventTarget, engine: Engine) {\r\n    const eventReceiver = new PointerEventReceiver(target, engine);\r\n    eventReceiver.primary = this.primary;\r\n    eventReceiver._pointers = this._pointers;\r\n    return eventReceiver;\r\n  }\r\n\r\n  private _pointers: PointerAbstraction[] = [this.primary];\r\n  /**\r\n   * Locates a specific pointer by id, creates it if it doesn't exist\r\n   * @param index\r\n   */\r\n  public at(index: number): PointerAbstraction {\r\n    if (index >= this._pointers.length) {\r\n      // Ensure there is a pointer to retrieve\r\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\r\n        this._pointers.push(new PointerAbstraction());\r\n      }\r\n    }\r\n    return this._pointers[index];\r\n  }\r\n\r\n  /**\r\n   * The number of pointers currently being tracked by excalibur\r\n   */\r\n  public count(): number {\r\n    return this._pointers.length;\r\n  }\r\n\r\n  /**\r\n   * Is the specified pointer id down this frame\r\n   * @param pointerId\r\n   */\r\n  public isDown(pointerId: number) {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this.currentFramePointerDown.get(pointerId) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Was the specified pointer id down last frame\r\n   * @param pointerId\r\n   */\r\n  public wasDown(pointerId: number) {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this.lastFramePointerDown.get(pointerId) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer is currently dragging.\r\n   */\r\n  public isDragging(pointerId: number): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this.isDown(pointerId);\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just started dragging.\r\n   */\r\n  public isDragStart(pointerId: number): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return this.isDown(pointerId) && !this.wasDown(pointerId);\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just ended dragging.\r\n   */\r\n  public isDragEnd(pointerId: number): boolean {\r\n    if (!this._enabled) {\r\n      return false;\r\n    }\r\n    return !this.isDown(pointerId) && this.wasDown(pointerId);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, event: PointerEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<PointerEvents>>(eventName: TEventName, handler: Handler<PointerEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<PointerEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Called internally by excalibur\r\n   *\r\n   * Updates the current frame pointer info and emits raw pointer events\r\n   *\r\n   * This does not emit events to entities, see PointerSystem\r\n   * @internal\r\n   */\r\n  public update() {\r\n    this.lastFramePointerDown = new Map(this.currentFramePointerDown);\r\n    this.lastFramePointerCoords = new Map(this.currentFramePointerCoords);\r\n\r\n    for (const event of this.currentFrameDown) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('down', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('down', event);\r\n      this.primary.emit('pointerdown', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameUp) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('up', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('up', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameMove) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('move', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('move', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameCancel) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('cancel', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('cancel', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameWheel) {\r\n      if (!event.active) {\r\n        continue;\r\n      }\r\n      this.emit('pointerwheel', event);\r\n      this.emit('wheel', event);\r\n      this.primary.emit('pointerwheel', event);\r\n      this.primary.emit('wheel', event);\r\n    }\r\n\r\n    if (this.engine.currentScene.camera.hasChanged()) {\r\n      for (const pointer of this._pointers) {\r\n        pointer._updateWorldPosition(this.engine);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the current frame event and pointer data\r\n   */\r\n  public clear() {\r\n    for (const event of this.currentFrameUp) {\r\n      this.currentFramePointerCoords.delete(event.pointerId);\r\n      const ids = this._activeNativePointerIdsToNormalized.entries();\r\n      for (const [native, normalized] of ids) {\r\n        if (normalized === event.pointerId) {\r\n          this._activeNativePointerIdsToNormalized.delete(native);\r\n        }\r\n      }\r\n    }\r\n    this.currentFrameDown.length = 0;\r\n    this.currentFrameUp.length = 0;\r\n    this.currentFrameMove.length = 0;\r\n    this.currentFrameCancel.length = 0;\r\n    this.currentFrameWheel.length = 0;\r\n  }\r\n\r\n  private _boundHandle = this._handle.bind(this);\r\n  private _boundWheel = this._handleWheel.bind(this);\r\n  /**\r\n   * Initializes the pointer event receiver so that it can start listening to native\r\n   * browser events.\r\n   */\r\n  public init(options?: PointerInitOptions) {\r\n    if (this.engine.isDisposed()) {\r\n      return;\r\n    }\r\n    // Disabling the touch action avoids browser/platform gestures from firing on the canvas\r\n    // It is important on mobile to have touch action 'none'\r\n    // https://stackoverflow.com/questions/48124372/pointermove-event-not-working-with-touch-why-not\r\n    if (this.target === this.engine.canvas) {\r\n      this.engine.canvas.style.touchAction = 'none';\r\n    } else {\r\n      document.body.style.touchAction = 'none';\r\n    }\r\n    // Preferred pointer events\r\n    if (window.PointerEvent) {\r\n      this.target.addEventListener('pointerdown', this._boundHandle);\r\n      this.target.addEventListener('pointerup', this._boundHandle);\r\n      this.target.addEventListener('pointermove', this._boundHandle);\r\n      this.target.addEventListener('pointercancel', this._boundHandle);\r\n    } else {\r\n      // Touch Events\r\n      this.target.addEventListener('touchstart', this._boundHandle);\r\n      this.target.addEventListener('touchend', this._boundHandle);\r\n      this.target.addEventListener('touchmove', this._boundHandle);\r\n      this.target.addEventListener('touchcancel', this._boundHandle);\r\n\r\n      // Mouse Events\r\n      this.target.addEventListener('mousedown', this._boundHandle);\r\n      this.target.addEventListener('mouseup', this._boundHandle);\r\n      this.target.addEventListener('mousemove', this._boundHandle);\r\n    }\r\n\r\n    // MDN MouseWheelEvent\r\n    const wheelOptions = {\r\n      passive: !(\r\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\r\n      )\r\n    };\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      this.target.addEventListener('wheel', this._boundWheel, wheelOptions);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      this.target.addEventListener('mousewheel', this._boundWheel, wheelOptions);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel, wheelOptions);\r\n    }\r\n\r\n    const grabWindowFocus = options?.grabWindowFocus ?? true;\r\n    // Handle cross origin iframe\r\n    if (grabWindowFocus && isCrossOriginIframe()) {\r\n      const grabFocus = () => {\r\n        window.focus();\r\n      };\r\n      // Preferred pointer events\r\n      if (window.PointerEvent) {\r\n        this.target.addEventListener('pointerdown', grabFocus);\r\n      } else {\r\n        // Touch Events\r\n        this.target.addEventListener('touchstart', grabFocus);\r\n\r\n        // Mouse Events\r\n        this.target.addEventListener('mousedown', grabFocus);\r\n      }\r\n    }\r\n  }\r\n\r\n  public detach() {\r\n    // Preferred pointer events\r\n    if (window.PointerEvent) {\r\n      this.target.removeEventListener('pointerdown', this._boundHandle);\r\n      this.target.removeEventListener('pointerup', this._boundHandle);\r\n      this.target.removeEventListener('pointermove', this._boundHandle);\r\n      this.target.removeEventListener('pointercancel', this._boundHandle);\r\n    } else {\r\n      // Touch Events\r\n      this.target.removeEventListener('touchstart', this._boundHandle);\r\n      this.target.removeEventListener('touchend', this._boundHandle);\r\n      this.target.removeEventListener('touchmove', this._boundHandle);\r\n      this.target.removeEventListener('touchcancel', this._boundHandle);\r\n\r\n      // Mouse Events\r\n      this.target.removeEventListener('mousedown', this._boundHandle);\r\n      this.target.removeEventListener('mouseup', this._boundHandle);\r\n      this.target.removeEventListener('mousemove', this._boundHandle);\r\n    }\r\n\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      this.target.removeEventListener('wheel', this._boundWheel);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      this.target.addEventListener('mousewheel', this._boundWheel);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Take native pointer id and map it to index in active pointers\r\n   * @param nativePointerId\r\n   */\r\n  private _normalizePointerId(nativePointerId: number) {\r\n    // Add to the the native pointer set id\r\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, -1);\r\n\r\n    // Native pointer ids in ascending order\r\n    const currentPointerIds = Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((a, b) => a - b);\r\n\r\n    // The index into sorted ids will be the new id, will always have an id\r\n    const id = currentPointerIds.findIndex((p) => p === nativePointerId);\r\n\r\n    // Save the mapping so we can reverse it later\r\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, id);\r\n\r\n    // ignore pointer because game isn't watching\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Responsible for handling and parsing pointer events\r\n   */\r\n  private _handle(ev: NativeTouchEvent | NativePointerEvent | NativeMouseEvent) {\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n    ev.preventDefault();\r\n    const eventCoords = new Map<number, GlobalCoordinates>();\r\n    let button: PointerButton;\r\n    let pointerType: PointerType;\r\n    if (isTouchEvent(ev)) {\r\n      button = PointerButton.Unknown;\r\n      pointerType = PointerType.Touch;\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\r\n      for (let i = 0; i < ev.changedTouches.length; i++) {\r\n        const touch = ev.changedTouches[i];\r\n        const coordinates = GlobalCoordinates.fromPagePosition(touch.pageX, touch.pageY, this.engine);\r\n        const nativePointerId = i + 1;\r\n        const pointerId = this._normalizePointerId(nativePointerId);\r\n        this.currentFramePointerCoords.set(pointerId, coordinates);\r\n        eventCoords.set(pointerId, coordinates);\r\n      }\r\n    } else {\r\n      button = this._nativeButtonToPointerButton(ev.button);\r\n      pointerType = PointerType.Mouse;\r\n      const coordinates = GlobalCoordinates.fromPagePosition(ev.pageX, ev.pageY, this.engine);\r\n      let nativePointerId = 1;\r\n      if (isPointerEvent(ev)) {\r\n        nativePointerId = ev.pointerId;\r\n        pointerType = this._stringToPointerType(ev.pointerType);\r\n      }\r\n      const pointerId = this._normalizePointerId(nativePointerId);\r\n      this.currentFramePointerCoords.set(pointerId, coordinates);\r\n      eventCoords.set(pointerId, coordinates);\r\n    }\r\n\r\n    for (const [pointerId, coord] of eventCoords.entries()) {\r\n      switch (ev.type) {\r\n        case 'mousedown':\r\n        case 'pointerdown':\r\n        case 'touchstart':\r\n          this.currentFrameDown.push(new PointerEvent('down', pointerId, button, pointerType, coord, ev));\r\n          this.currentFramePointerDown.set(pointerId, true);\r\n          break;\r\n        case 'mouseup':\r\n        case 'pointerup':\r\n        case 'touchend':\r\n          this.currentFrameUp.push(new PointerEvent('up', pointerId, button, pointerType, coord, ev));\r\n          this.currentFramePointerDown.set(pointerId, false);\r\n          break;\r\n        case 'mousemove':\r\n        case 'pointermove':\r\n        case 'touchmove':\r\n          this.currentFrameMove.push(new PointerEvent('move', pointerId, button, pointerType, coord, ev));\r\n          break;\r\n        case 'touchcancel':\r\n        case 'pointercancel':\r\n          this.currentFrameCancel.push(new PointerEvent('cancel', pointerId, button, pointerType, coord, ev));\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleWheel(ev: NativeWheelEvent) {\r\n    if (!this._enabled) {\r\n      return;\r\n    }\r\n    // Should we prevent page scroll because of this event\r\n    if (\r\n      this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n      (this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && ev.target === this.engine.canvas)\r\n    ) {\r\n      ev.preventDefault();\r\n    }\r\n    const screen = this.engine.screen.pageToScreenCoordinates(vec(ev.pageX, ev.pageY));\r\n    const world = this.engine.screen.screenToWorldCoordinates(screen);\r\n\r\n    /**\r\n     * A constant used to normalize wheel events across different browsers\r\n     *\r\n     * This normalization factor is pulled from\r\n     * https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\r\n     */\r\n    const ScrollWheelNormalizationFactor = -1 / 40;\r\n\r\n    const deltaX = ev.deltaX || ev.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\r\n    const deltaY =\r\n      ev.deltaY || ev.wheelDeltaY * ScrollWheelNormalizationFactor || ev.wheelDelta * ScrollWheelNormalizationFactor || ev.detail || 0;\r\n    const deltaZ = ev.deltaZ || 0;\r\n    let deltaMode = WheelDeltaMode.Pixel;\r\n\r\n    if (ev.deltaMode) {\r\n      if (ev.deltaMode === 1) {\r\n        deltaMode = WheelDeltaMode.Line;\r\n      } else if (ev.deltaMode === 2) {\r\n        deltaMode = WheelDeltaMode.Page;\r\n      }\r\n    }\r\n\r\n    const we = new WheelEvent(world.x, world.y, ev.pageX, ev.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, ev);\r\n    this.currentFrameWheel.push(we);\r\n  }\r\n\r\n  /**\r\n   * Triggers an excalibur pointer event in a world space pos\r\n   *\r\n   * Useful for testing pointers in excalibur\r\n   * @param type\r\n   * @param pos\r\n   */\r\n  public triggerEvent(type: 'down' | 'up' | 'move' | 'cancel', pos: Vector) {\r\n    const page = this.engine.screen.worldToPageCoordinates(pos);\r\n    // Send an event to the event receiver\r\n    if (window.PointerEvent) {\r\n      this._handle(\r\n        new window.PointerEvent('pointer' + type, {\r\n          pointerId: 0,\r\n          clientX: page.x,\r\n          clientY: page.y\r\n        })\r\n      );\r\n    } else {\r\n      // Safari hack\r\n      this._handle(\r\n        new window.MouseEvent('mouse' + type, {\r\n          clientX: page.x,\r\n          clientY: page.y\r\n        })\r\n      );\r\n    }\r\n\r\n    // Force update pointer system\r\n    const pointerSystem = this.engine.currentScene.world.get(PointerSystem);\r\n    pointerSystem.preupdate(this.engine.currentScene, 1);\r\n    pointerSystem.update(1);\r\n  }\r\n\r\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\r\n    switch (s) {\r\n      case NativePointerButton.NoButton:\r\n        return PointerButton.NoButton;\r\n      case NativePointerButton.Left:\r\n        return PointerButton.Left;\r\n      case NativePointerButton.Middle:\r\n        return PointerButton.Middle;\r\n      case NativePointerButton.Right:\r\n        return PointerButton.Right;\r\n      case NativePointerButton.Unknown:\r\n        return PointerButton.Unknown;\r\n      default:\r\n        return fail(s);\r\n    }\r\n  }\r\n\r\n  private _stringToPointerType(s: string) {\r\n    switch (s) {\r\n      case 'touch':\r\n        return PointerType.Touch;\r\n      case 'mouse':\r\n        return PointerType.Mouse;\r\n      case 'pen':\r\n        return PointerType.Pen;\r\n      default:\r\n        return PointerType.Unknown;\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Gamepads } from './Gamepad';\r\nimport { InputMapper } from './InputMapper';\r\nimport { Keyboard } from './Keyboard';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\n\r\nexport interface InputHostOptions {\r\n  pointerTarget: Document | HTMLCanvasElement;\r\n  grabWindowFocus: boolean;\r\n  engine: Engine;\r\n}\r\n\r\nexport class InputHost {\r\n  private _enabled = true;\r\n\r\n  keyboard: Keyboard;\r\n  pointers: PointerEventReceiver;\r\n  gamepads: Gamepads;\r\n  inputMapper: InputMapper;\r\n\r\n  constructor(options: InputHostOptions) {\r\n    const { pointerTarget, grabWindowFocus, engine } = options;\r\n    this.keyboard = new Keyboard();\r\n    this.pointers = new PointerEventReceiver(pointerTarget, engine);\r\n    this.gamepads = new Gamepads();\r\n\r\n    this.keyboard.init({ grabWindowFocus });\r\n    this.pointers.init({ grabWindowFocus });\r\n    this.gamepads.init();\r\n    this.inputMapper = new InputMapper({\r\n      keyboard: this.keyboard,\r\n      pointers: this.pointers,\r\n      gamepads: this.gamepads\r\n    });\r\n  }\r\n\r\n  get enabled() {\r\n    return this._enabled;\r\n  }\r\n\r\n  toggleEnabled(enabled: boolean) {\r\n    this._enabled = enabled;\r\n    this.keyboard.toggleEnabled(this._enabled);\r\n    this.pointers.toggleEnabled(this._enabled);\r\n    this.gamepads.toggleEnabled(this._enabled);\r\n  }\r\n\r\n  update() {\r\n    if (this._enabled) {\r\n      this.inputMapper.execute();\r\n      this.keyboard.update();\r\n      this.gamepads.update();\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.keyboard.clear();\r\n    this.pointers.clear();\r\n    // this.gamepads.clear();\r\n  }\r\n}\r\n","import { isScreenElement, ScreenElement } from './ScreenElement';\r\nimport {\r\n  InitializeEvent,\r\n  ActivateEvent,\r\n  DeactivateEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent\r\n} from './Events';\r\nimport { Logger } from './Util/Log';\r\nimport { Timer } from './Timer';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Camera } from './Camera';\r\nimport { Actor } from './Actor';\r\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw, SceneActivationContext } from './Interfaces/LifecycleEvents';\r\nimport * as Util from './Util/Util';\r\nimport { Trigger } from './Trigger';\r\nimport { SystemType } from './EntityComponentSystem/System';\r\nimport { World } from './EntityComponentSystem/World';\r\nimport { MotionSystem } from './Collision/MotionSystem';\r\nimport { CollisionSystem } from './Collision/CollisionSystem';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\r\nimport { DebugSystem } from './Debug/DebugSystem';\r\nimport { PointerSystem } from './Input/PointerSystem';\r\nimport { ActionsSystem } from './Actions/ActionsSystem';\r\nimport { IsometricEntitySystem } from './TileMap/IsometricEntitySystem';\r\nimport { OffscreenSystem } from './Graphics/OffscreenSystem';\r\nimport { ExcaliburGraphicsContext } from './Graphics';\r\nimport { PhysicsWorld } from './Collision/PhysicsWorld';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from './EventEmitter';\r\nimport { Color } from './Color';\r\nimport { DefaultLoader } from './Director/DefaultLoader';\r\nimport { Transition } from './Director';\r\nimport { InputHost } from './Input/InputHost';\r\nimport { PointerScope } from './Input/PointerScope';\r\nimport { getDefaultPhysicsConfig } from './Collision/PhysicsConfig';\r\n\r\nexport class PreLoadEvent {\r\n  loader: DefaultLoader;\r\n}\r\n\r\nexport type SceneEvents = {\r\n  initialize: InitializeEvent<Scene>;\r\n  activate: ActivateEvent;\r\n  deactivate: DeactivateEvent;\r\n  preupdate: PreUpdateEvent;\r\n  postupdate: PostUpdateEvent;\r\n  predraw: PreDrawEvent;\r\n  postdraw: PostDrawEvent;\r\n  predebugdraw: PreDebugDrawEvent;\r\n  postdebugdraw: PostDebugDrawEvent;\r\n  preload: PreLoadEvent;\r\n};\r\n\r\nexport const SceneEvents = {\r\n  Initialize: 'initialize',\r\n  Activate: 'activate',\r\n  Deactivate: 'deactivate',\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate',\r\n  PreDraw: 'predraw',\r\n  PostDraw: 'postdraw',\r\n  PreDebugDraw: 'predebugdraw',\r\n  PostDebugDraw: 'postdebugdraw',\r\n  PreLoad: 'preload'\r\n};\r\n\r\nexport type SceneConstructor = new (...args: any[]) => Scene;\r\n/**\r\n *\r\n */\r\nexport function isSceneConstructor(x: any): x is SceneConstructor {\r\n  return !!x?.prototype && !!x?.prototype?.constructor?.name;\r\n}\r\n\r\n/**\r\n * {@apilink Actor | `Actors`} are composed together into groupings called Scenes in\r\n * Excalibur. The metaphor models the same idea behind real world\r\n * actors in a scene. Only actors in scenes will be updated and drawn.\r\n *\r\n * Typical usages of a scene include: levels, menus, loading screens, etc.\r\n */\r\nexport class Scene<TActivationData = unknown> implements CanInitialize, CanActivate<TActivationData>, CanDeactivate, CanUpdate, CanDraw {\r\n  private _logger: Logger = Logger.getInstance();\r\n  public events = new EventEmitter<SceneEvents>();\r\n\r\n  /**\r\n   * Gets or sets the current camera for the scene\r\n   */\r\n  public camera: Camera = new Camera();\r\n\r\n  /**\r\n   * Scene specific background color\r\n   */\r\n  public backgroundColor?: Color;\r\n\r\n  /**\r\n   * The ECS world for the scene\r\n   */\r\n  public world: World = new World(this);\r\n\r\n  /**\r\n   * The Excalibur physics world for the scene. Used to interact\r\n   * with colliders included in the scene.\r\n   *\r\n   * Can be used to perform scene ray casts, track colliders, broadphase, and narrowphase.\r\n   */\r\n  public physics = new PhysicsWorld(getDefaultPhysicsConfig());\r\n\r\n  /**\r\n   * The actors in the current scene\r\n   */\r\n  public get actors(): readonly Actor[] {\r\n    return this.world.entityManager.entities.filter((e: Entity<any>) => {\r\n      return e instanceof Actor;\r\n    }) as Actor[];\r\n  }\r\n\r\n  /**\r\n   * The entities in the current scene\r\n   */\r\n  public get entities(): readonly Entity[] {\r\n    return this.world.entityManager.entities;\r\n  }\r\n\r\n  /**\r\n   * The triggers in the current scene\r\n   */\r\n  public get triggers(): readonly Trigger[] {\r\n    return this.world.entityManager.entities.filter((e: Entity<any>) => {\r\n      return e instanceof Trigger;\r\n    }) as Trigger[];\r\n  }\r\n\r\n  /**\r\n   * The {@apilink TileMap}s in the scene, if any\r\n   */\r\n  public get tileMaps(): readonly TileMap[] {\r\n    return this.world.entityManager.entities.filter((e: Entity<any>) => {\r\n      return e instanceof TileMap;\r\n    }) as TileMap[];\r\n  }\r\n\r\n  /**\r\n   * Access to the Excalibur engine\r\n   */\r\n  public engine: Engine;\r\n\r\n  /**\r\n   * Access scene specific input, handlers on this only fire when this scene is active.\r\n   */\r\n  public input: InputHost;\r\n\r\n  private _isInitialized: boolean = false;\r\n  private _timers: Timer[] = [];\r\n  public get timers(): readonly Timer[] {\r\n    return this._timers;\r\n  }\r\n  private _cancelQueue: Timer[] = [];\r\n\r\n  constructor() {\r\n    // Initialize systems\r\n\r\n    // Update\r\n    this.world.add(ActionsSystem);\r\n    this.world.add(new MotionSystem(this.world, this.physics));\r\n    this.world.add(new CollisionSystem(this.world, this.physics));\r\n    this.world.add(PointerSystem);\r\n    this.world.add(IsometricEntitySystem);\r\n    // Draw\r\n    this.world.add(OffscreenSystem);\r\n    this.world.add(GraphicsSystem);\r\n    this.world.add(DebugSystem);\r\n  }\r\n\r\n  public emit<TEventName extends EventKey<SceneEvents>>(eventName: TEventName, event: SceneEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<SceneEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<SceneEvents>>(eventName: TEventName, handler: Handler<SceneEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<SceneEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<SceneEvents>>(eventName: TEventName, handler: Handler<SceneEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<SceneEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<SceneEvents>>(eventName: TEventName, handler: Handler<SceneEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<SceneEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Event hook to provide Scenes a way of loading scene specific resources.\r\n   *\r\n   * This is called before the Scene.onInitialize during scene transition. It will only ever fire once for a scene.\r\n   * @param loader\r\n   */\r\n  public onPreLoad(loader: DefaultLoader) {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Event hook fired directly before transition, either \"in\" or \"out\" of the scene\r\n   *\r\n   * This overrides the Engine scene definition. However transitions specified in goToScene take highest precedence\r\n   *\r\n   * ```typescript\r\n   * // Overrides all\r\n   * Engine.goToScene('scene', { destinationIn: ..., sourceOut: ... });\r\n   * ```\r\n   *\r\n   * This can be used to configure custom transitions for a scene dynamically\r\n   */\r\n  public onTransition(direction: 'in' | 'out'): Transition | undefined {\r\n    // will be overridden\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * This is called before the first update of the {@apilink Scene}. Initializes scene members like the camera. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   */\r\n  public onInitialize(engine: Engine): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made active and started. It is meant to be overridden,\r\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onActivate(context: SceneActivationContext<TActivationData>): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\r\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onDeactivate(context: SceneActivationContext): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   * @param engine reference to the engine\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   * @param engine reference to the engine\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before a scene is drawn.\r\n   *\r\n   */\r\n  public onPreDraw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after a scene is drawn.\r\n   *\r\n   */\r\n  public onPostDraw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Initializes actors in the scene\r\n   */\r\n  private _initializeChildren() {\r\n    for (const child of this.entities) {\r\n      child._initialize(this.engine);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets whether or not the {@apilink Scene} has been initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Initializes the scene before the first update, meant to be called by engine not by users of\r\n   * Excalibur\r\n   * @internal\r\n   */\r\n  public async _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      try {\r\n        this.engine = engine;\r\n        // PhysicsWorld config is watched so things will automagically update\r\n        this.physics.config = this.engine.physics;\r\n        this.input = new InputHost({\r\n          pointerTarget: engine.pointerScope === PointerScope.Canvas ? engine.canvas : document,\r\n          grabWindowFocus: engine.grabWindowFocus,\r\n          engine\r\n        });\r\n        // Initialize camera first\r\n        this.camera._initialize(engine);\r\n\r\n        this.world.systemManager.initialize();\r\n\r\n        // This order is important! we want to be sure any custom init that add actors\r\n        // fire before the actor init\r\n        await this.onInitialize(engine);\r\n        this._initializeChildren();\r\n\r\n        this._logger.debug('Scene.onInitialize', this, engine);\r\n        this.events.emit('initialize', new InitializeEvent(engine, this));\r\n      } catch (e) {\r\n        this._logger.error(`Error during scene initialization for scene ${engine.director?.getSceneName(this)}!`);\r\n        throw e;\r\n      }\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\r\n   * @internal\r\n   */\r\n  public async _activate(context: SceneActivationContext<TActivationData>) {\r\n    try {\r\n      this._logger.debug('Scene.onActivate', this);\r\n      this.input.toggleEnabled(true);\r\n      await this.onActivate(context);\r\n    } catch (e) {\r\n      this._logger.error(`Error during scene activation for scene ${this.engine?.director?.getSceneName(this)}!`);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\r\n   * @internal\r\n   */\r\n  public async _deactivate(context: SceneActivationContext<never>) {\r\n    this._logger.debug('Scene.onDeactivate', this);\r\n    this.input.toggleEnabled(false);\r\n    await this.onDeactivate(context);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPreUpdate} lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, elapsed: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, elapsed, this));\r\n    this.onPreUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for {@apilink onPostUpdate} lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, elapsed: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, elapsed, this));\r\n    this.onPostUpdate(engine, elapsed);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for {@apilink onPreDraw} lifecycle event\r\n   * @internal\r\n   */\r\n  public _predraw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    this.emit('predraw', new PreDrawEvent(ctx, elapsed, this));\r\n    this.onPreDraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for {@apilink onPostDraw} lifecycle event\r\n   * @internal\r\n   */\r\n  public _postdraw(ctx: ExcaliburGraphicsContext, elapsed: number): void {\r\n    this.emit('postdraw', new PostDrawEvent(ctx, elapsed, this));\r\n    this.onPostDraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Updates all the actors and timers in the scene. Called by the {@apilink Engine}.\r\n   * @param engine  Reference to the current Engine\r\n   * @param elapsed   The number of milliseconds since the last update\r\n   */\r\n  public update(engine: Engine, elapsed: number) {\r\n    if (!this.isInitialized) {\r\n      this._logger.warnOnce(`Scene update called before initialize for scene ${engine.director?.getSceneName(this)}!`);\r\n      return;\r\n    }\r\n    this._preupdate(engine, elapsed);\r\n\r\n    // TODO differed entity removal for timers\r\n    let i: number, len: number;\r\n    // Remove timers in the cancel queue before updating them\r\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\r\n      this.removeTimer(this._cancelQueue[i]);\r\n    }\r\n    this._cancelQueue.length = 0;\r\n\r\n    // Cycle through timers updating timers\r\n    for (const timer of this._timers) {\r\n      timer.update(elapsed);\r\n    }\r\n\r\n    this.world.update(SystemType.Update, elapsed);\r\n\r\n    // Camera last keeps renders smooth that are based on entity/actor\r\n    if (this.camera) {\r\n      this.camera.update(engine, elapsed);\r\n    }\r\n\r\n    this._collectActorStats(engine);\r\n\r\n    this._postupdate(engine, elapsed);\r\n\r\n    this.input.update();\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors in the Scene. Called by the {@apilink Engine}.\r\n   * @param ctx    The current rendering context\r\n   * @param elapsed  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    if (!this.isInitialized) {\r\n      this._logger.warnOnce(`Scene draw called before initialize!`);\r\n      return;\r\n    }\r\n    this._predraw(ctx, elapsed);\r\n\r\n    this.world.update(SystemType.Draw, elapsed);\r\n\r\n    if (this.engine?.isDebug) {\r\n      this.debugDraw(ctx);\r\n    }\r\n    this._postdraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors' debug information in the Scene. Called by the {@apilink Engine}.\r\n   * @param ctx  The current rendering context\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: ExcaliburGraphicsContext) {\r\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\r\n    // pass\r\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\r\n  }\r\n\r\n  /**\r\n   * Checks whether an actor is contained in this scene or not\r\n   */\r\n  public contains(actor: Actor): boolean {\r\n    return this.actors.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Timer} to the current {@apilink Scene}.\r\n   * @param timer  The timer to add to the current {@apilink Scene}.\r\n   */\r\n  public add(timer: Timer): void;\r\n\r\n  /**\r\n   * Adds a {@apilink TileMap} to the {@apilink Scene}, once this is done the {@apilink TileMap} will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Adds a {@apilink Trigger} to the {@apilink Scene}, once this is done the {@apilink Trigger} will listen for interactions with other actors.\r\n   * @param trigger\r\n   */\r\n  public add(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Adds an actor to the scene, once this is done the {@apilink Actor} will be drawn and updated.\r\n   * @param actor  The actor to add to the current scene\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  /**\r\n   * Adds an {@apilink Entity} to the scene, once this is done the {@apilink Actor} will be drawn and updated.\r\n   * @param entity The entity to add to the current scene\r\n   */\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a {@apilink ScreenElement} to the scene.\r\n   * @param screenElement  The ScreenElement to add to the current scene\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    this.emit('entityadded', { target: entity } as any);\r\n    this.world.add(entity);\r\n    entity.scene = this;\r\n    if (entity instanceof Timer) {\r\n      if (!Util.contains(this._timers, entity)) {\r\n        this.addTimer(entity);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Timer} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param timer The Timer to transfer to the current scene\r\n   */\r\n  public transfer(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a {@apilink TileMap} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param tileMap The TileMap to transfer to the current scene\r\n   */\r\n  public transfer(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes a {@apilink Trigger} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param trigger The Trigger to transfer to the current scene\r\n   */\r\n  public transfer(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Removes an {@apilink Actor} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param actor The Actor to transfer to the current scene\r\n   */\r\n  public transfer(actor: Actor): void;\r\n\r\n  /**\r\n   * Removes an {@apilink Entity} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param entity The Entity to transfer to the current scene\r\n   */\r\n  public transfer(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a {@apilink ScreenElement} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param screenElement The ScreenElement to transfer to the current scene\r\n   */\r\n  public transfer(screenElement: ScreenElement): void;\r\n\r\n  /**\r\n   * Removes an {@apilink Entity} (Actor, TileMap, Trigger, etc) or {@apilink Timer} from it's current scene\r\n   * and adds it to this scene.\r\n   *\r\n   * Useful if you want to have an object be present in only 1 scene at a time.\r\n   * @param entity\r\n   */\r\n  public transfer(entity: any): void {\r\n    let scene: Scene;\r\n    if (entity instanceof Entity && entity.scene && entity.scene !== this) {\r\n      scene = entity.scene;\r\n      entity.scene.world.remove(entity, false);\r\n    }\r\n    if (entity instanceof Timer && entity.scene) {\r\n      scene = entity.scene;\r\n      entity.scene.removeTimer(entity);\r\n    }\r\n\r\n    scene?.emit('entityremoved', { target: entity } as any);\r\n    this.add(entity);\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Timer} from the current scene, it will no longer be updated.\r\n   * @param timer  The timer to remove to the current scene.\r\n   */\r\n  public remove(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a {@apilink TileMap} from the scene, it will no longer be drawn or updated.\r\n   * @param tileMap {TileMap}\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes an actor from the scene, it will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the current scene.\r\n   */\r\n  public remove(actor: Actor): void;\r\n\r\n  public remove(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a {@apilink ScreenElement} to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the current scene\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.emit('entityremoved', { target: entity } as any);\r\n      if (entity.isActive) {\r\n        entity.kill();\r\n      }\r\n      this.world.remove(entity);\r\n    }\r\n    if (entity instanceof Timer) {\r\n      this.removeTimer(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all entities and timers from the scene, optionally indicate whether deferred should or shouldn't be used.\r\n   *\r\n   * By default entities use deferred removal\r\n   * @param deferred\r\n   */\r\n  public clear(deferred: boolean = true): void {\r\n    for (let i = this.entities.length - 1; i >= 0; i--) {\r\n      this.world.remove(this.entities[i], deferred);\r\n    }\r\n    for (let i = this.timers.length - 1; i >= 0; i--) {\r\n      this.removeTimer(this.timers[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Timer} to the scene\r\n   * @param timer  The timer to add\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    this._timers.push(timer);\r\n    timer.scene = this;\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Timer} from the scene.\r\n   * @warning Can be dangerous, use {@apilink cancelTimer} instead\r\n   * @param timer  The timer to remove\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    const i = this._timers.indexOf(timer);\r\n    if (i !== -1) {\r\n      this._timers.splice(i, 1);\r\n    }\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Cancels a {@apilink Timer}, removing it from the scene nicely\r\n   * @param timer  The timer to cancel\r\n   */\r\n  public cancelTimer(timer: Timer): Timer {\r\n    this._cancelQueue.push(timer);\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a {@apilink Timer} is active in the scene\r\n   */\r\n  public isTimerActive(timer: Timer): boolean {\r\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\r\n  }\r\n\r\n  public isCurrentScene(): boolean {\r\n    if (this.engine) {\r\n      return this.engine.currentScene === this;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _collectActorStats(engine: Engine) {\r\n    const actors = this.actors;\r\n    for (let i = 0; i < actors.length; i++) {\r\n      const actor = actors[i];\r\n      if (actor instanceof ScreenElement) {\r\n        engine.stats.currFrame.actors.ui++;\r\n      }\r\n      engine.stats.currFrame.actors.alive++;\r\n      for (let j = 0; j < actor.children.length; j++) {\r\n        const child = actor.children[j];\r\n        if (isScreenElement(child as Actor)) {\r\n          // TODO not true\r\n          engine.stats.currFrame.actors.ui++;\r\n        } else {\r\n          engine.stats.currFrame.actors.alive++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export enum ColorBlindnessMode {\r\n  Protanope = 'Protanope',\r\n  Deuteranope = 'Deuteranope',\r\n  Tritanope = 'Tritanope'\r\n}\r\n","import { Logger } from '../../Util/Log';\r\nimport { Shader } from '../Context/shader';\r\nimport { VertexBuffer } from '../Context/vertex-buffer';\r\nimport { VertexLayout } from '../Context/vertex-layout';\r\n\r\n/**\r\n * Helper that defines a whole screen renderer, just provide a fragment source!\r\n *\r\n * Currently supports 1 varying\r\n * - vec2 a_texcoord between 0-1 which corresponds to screen position\r\n */\r\nexport class ScreenShader {\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  constructor(gl: WebGL2RenderingContext, fragmentSource: string) {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      if (fragmentSource.includes('v_texcoord')) {\r\n        Logger.getInstance().warn(\r\n          `ScreenShader: \"v_texcoord\" is deprecated in postprocessing fragment shaders will be removed in v1.0,` +\r\n            ` use \"v_uv\" instead. Source [${fragmentSource}]`\r\n        );\r\n      }\r\n    }\r\n    this._shader = new Shader({\r\n      gl,\r\n      vertexSource: `#version 300 es\r\n      in vec2 a_position;\r\n      in vec2 a_uv;\r\n      out vec2 v_texcoord;\r\n      out vec2 v_uv;\r\n\r\n      void main() {\r\n        gl_Position = vec4(a_position, 0.0, 1.0);\r\n        // Pass the texcoord to the fragment shader.\r\n        v_texcoord = a_uv;\r\n        v_uv = a_uv;\r\n      }`,\r\n      fragmentSource: fragmentSource\r\n    });\r\n    this._shader.compile();\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      gl,\r\n      type: 'static',\r\n      // clip space quad + uv since we don't need a camera\r\n      data: new Float32Array([\r\n        -1, -1, 0, 0, -1, 1, 0, 1, 1, -1, 1, 0,\r\n\r\n        1, -1, 1, 0, -1, 1, 0, 1, 1, 1, 1, 1\r\n      ])\r\n    });\r\n    this._layout = new VertexLayout({\r\n      gl,\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2]\r\n      ]\r\n    });\r\n    this._buffer.upload();\r\n  }\r\n\r\n  public getShader() {\r\n    return this._shader;\r\n  }\r\n  public getLayout() {\r\n    return this._layout;\r\n  }\r\n}\r\n","import colorBlindCorrectSource from './color-blind-fragment.glsl';\r\nimport { PostProcessor } from './PostProcessor';\r\nimport { ColorBlindnessMode } from './ColorBlindnessMode';\r\nimport { Shader } from '../Context/shader';\r\nimport { VertexLayout } from '../Context/vertex-layout';\r\nimport { ScreenShader } from './ScreenShader';\r\n\r\nexport class ColorBlindnessPostProcessor implements PostProcessor {\r\n  private _shader!: ScreenShader;\r\n  private _simulate = false;\r\n  constructor(\r\n    private _colorBlindnessMode: ColorBlindnessMode,\r\n    simulate = false\r\n  ) {\r\n    this._simulate = simulate;\r\n  }\r\n\r\n  initialize(gl: WebGL2RenderingContext): void {\r\n    this._shader = new ScreenShader(gl, colorBlindCorrectSource);\r\n    this.simulate = this._simulate;\r\n    this.colorBlindnessMode = this._colorBlindnessMode;\r\n  }\r\n\r\n  getShader(): Shader {\r\n    return this._shader.getShader();\r\n  }\r\n\r\n  getLayout(): VertexLayout {\r\n    return this._shader.getLayout();\r\n  }\r\n\r\n  set colorBlindnessMode(colorBlindMode: ColorBlindnessMode) {\r\n    this._colorBlindnessMode = colorBlindMode;\r\n    if (this._shader) {\r\n      const shader = this._shader.getShader();\r\n      shader.use();\r\n      if (this._colorBlindnessMode === ColorBlindnessMode.Protanope) {\r\n        shader.setUniformInt('u_type', 0);\r\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Deuteranope) {\r\n        shader.setUniformInt('u_type', 1);\r\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Tritanope) {\r\n        shader.setUniformInt('u_type', 2);\r\n      }\r\n    }\r\n  }\r\n\r\n  get colorBlindnessMode(): ColorBlindnessMode {\r\n    return this._colorBlindnessMode;\r\n  }\r\n\r\n  set simulate(value: boolean) {\r\n    this._simulate = value;\r\n    if (this._shader) {\r\n      const shader = this._shader.getShader();\r\n      shader.use();\r\n      shader.setUniformBoolean('u_simulate', value);\r\n    }\r\n  }\r\n\r\n  get simulate(): boolean {\r\n    return this._simulate;\r\n  }\r\n}\r\n","export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n// our texture\\r\\nuniform sampler2D u_image;\\r\\n// the texCoords passed in from the vertex shader.\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// color blind type\\r\\nuniform int u_type;\\r\\n\\r\\n// simulation?\\r\\nuniform bool u_simulate;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  vec4 o =  texture(u_image, v_texcoord);\\r\\n  // RGB to LMS matrix conversion\\r\\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\\r\\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\\r\\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\\r\\n  // Simulate color blindness\\r\\n  float l;\\r\\n  float m;\\r\\n  float s;\\r\\n  //MODE CODE//\\r\\n  if (u_type == 0) {\\r\\n    // Protanope\\r\\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\\r\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\r\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\\r\\n  } else if (u_type == 1) {\\r\\n    // Deuteranope\\r\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\r\\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\\r\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\\r\\n  } else if (u_type == 2) {\\r\\n    // Tritanope\\r\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\r\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\r\\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\\r\\n  }\\r\\n\\r\\n  // LMS to RGB matrix conversion\\r\\n  vec4 error; // simulate the colors\\r\\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\\r\\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\\r\\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\\r\\n  error.a = 1.0;\\r\\n  vec4 diff = o - error;\\r\\n  vec4 correction; // correct the colors\\r\\n  correction.r = 0.0;\\r\\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\\r\\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\\r\\n  correction = o + correction;\\r\\n  correction.a = o.a;\\r\\n  //SIMULATE//\\r\\n\\r\\n  // sim \\r\\n  if (u_simulate) {\\r\\n    fragColor = error.rgba;\\r\\n  } else {\\r\\n    fragColor = correction.rgba;\\r\\n  }\\r\\n}\";","import { ColorBlindnessMode } from '../Graphics/PostProcessor/ColorBlindnessMode';\nimport { ColorBlindnessPostProcessor } from '../Graphics/PostProcessor/ColorBlindnessPostProcessor';\nimport { Engine } from '../Engine';\nimport { ExcaliburGraphicsContextWebGL } from '../Graphics/Context/ExcaliburGraphicsContextWebGL';\n\nexport class ColorBlindFlags {\n  private _engine: Engine;\n  private _colorBlindPostProcessor: ColorBlindnessPostProcessor;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n    this._colorBlindPostProcessor = new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope);\n  }\n\n  /**\n   * Correct colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public correct(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = false;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Simulate colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public simulate(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = true;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Remove color blindness post processor\n   */\n  public clear() {\n    this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor);\n  }\n}\n","import { ColorBlindFlags } from './DebugFlags';\r\nimport { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\r\nimport { StandardClock, TestClock } from '../Util/Clock';\r\n\r\n/**\r\n * Debug stats containing current and previous frame statistics\r\n */\r\nexport interface DebugStats {\r\n  currFrame: FrameStats;\r\n  prevFrame: FrameStats;\r\n}\r\n\r\n/**\r\n * Represents a frame's individual statistics\r\n */\r\nexport interface FrameStatistics {\r\n  /**\r\n   * The number of the frame\r\n   */\r\n  id: number;\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame scaled by {@apilink Engine.timescale}) (in ms)\r\n   *\r\n   * Excalibur extension depends on this\r\n   */\r\n  elapsedMs: number;\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  fps: number;\r\n\r\n  /**\r\n   * Duration statistics (in ms)\r\n   */\r\n  duration: FrameDurationStats;\r\n\r\n  /**\r\n   * Actor statistics\r\n   */\r\n  actors: FrameActorStats;\r\n\r\n  /**\r\n   * Physics statistics\r\n   */\r\n  physics: PhysicsStatistics;\r\n\r\n  /**\r\n   * Graphics statistics\r\n   */\r\n  graphics: GraphicsStatistics;\r\n}\r\n\r\n/**\r\n * Represents actor stats for a frame\r\n */\r\nexport interface FrameActorStats {\r\n  /**\r\n   * Gets the frame's number of actors (alive)\r\n   */\r\n  alive: number;\r\n\r\n  /**\r\n   * Gets the frame's number of actors (killed)\r\n   */\r\n  killed: number;\r\n\r\n  /**\r\n   * Gets the frame's number of remaining actors (alive - killed)\r\n   */\r\n  remaining: number;\r\n\r\n  /**\r\n   * Gets the frame's number of UI actors\r\n   */\r\n  ui: number;\r\n\r\n  /**\r\n   * Gets the frame's number of total actors (remaining + UI)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents duration stats for a frame\r\n */\r\nexport interface FrameDurationStats {\r\n  /**\r\n   * Gets the frame's total time to run the update function (in ms)\r\n   */\r\n  update: number;\r\n\r\n  /**\r\n   * Gets the frame's total time to run the draw function (in ms)\r\n   */\r\n  draw: number;\r\n\r\n  /**\r\n   * Gets the frame's total render duration (update + draw duration) (in ms)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents physics stats for the current frame\r\n */\r\nexport interface PhysicsStatistics {\r\n  /**\r\n   * Gets the number of broadphase collision pairs which\r\n   */\r\n  pairs: number;\r\n\r\n  /**\r\n   * Gets the number of actual collisions\r\n   */\r\n  collisions: number;\r\n\r\n  /**\r\n   * Copy of the current frame contacts (only updated if debug is toggled on)\r\n   */\r\n  contacts: Map<string, CollisionContact>;\r\n\r\n  /**\r\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\r\n   */\r\n  fastBodies: number;\r\n\r\n  /**\r\n   * Gets the number of bodies that had a fast body collision resolution\r\n   */\r\n  fastBodyCollisions: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the broadphase pairs\r\n   */\r\n  broadphase: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the narrowphase\r\n   */\r\n  narrowphase: number;\r\n}\r\n\r\nexport interface GraphicsStatistics {\r\n  drawCalls: number;\r\n  drawnImages: number;\r\n}\r\n\r\n/**\r\n * Debug statistics and flags for Excalibur. If polling these values, it would be\r\n * best to do so on the `postupdate` event for {@apilink Engine}, after all values have been\r\n * updated during a frame.\r\n */\r\nexport class DebugConfig {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n\r\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\r\n  }\r\n\r\n  /**\r\n   * Switch the current excalibur clock with the {@apilink TestClock} and return\r\n   * it in the same running state.\r\n   *\r\n   * This is useful when you need to debug frame by frame.\r\n   */\r\n  public useTestClock(): TestClock {\r\n    const clock = this._engine.clock;\r\n    const wasRunning = clock.isRunning();\r\n    clock.stop();\r\n\r\n    const testClock = clock.toTestClock();\r\n    if (wasRunning) {\r\n      testClock.start();\r\n    }\r\n    this._engine.clock = testClock;\r\n    return testClock;\r\n  }\r\n\r\n  /**\r\n   * Switch the current excalibur clock with the {@apilink StandardClock} and\r\n   * return it in the same running state.\r\n   *\r\n   * This is useful when you need to switch back to normal mode after\r\n   * debugging.\r\n   */\r\n  public useStandardClock(): StandardClock {\r\n    const currentClock = this._engine.clock;\r\n    const wasRunning = currentClock.isRunning();\r\n    currentClock.stop();\r\n\r\n    const standardClock = currentClock.toStandardClock();\r\n    if (wasRunning) {\r\n      standardClock.start();\r\n    }\r\n    this._engine.clock = standardClock;\r\n    return standardClock;\r\n  }\r\n\r\n  /**\r\n   * Performance statistics\r\n   */\r\n  public stats: DebugStats = {\r\n    /**\r\n     * Current frame statistics. Engine reuses this instance, use {@apilink FrameStats.clone} to copy frame stats.\r\n     * Best accessed on {@apilink postframe} event. See {@apilink FrameStats}\r\n     */\r\n    currFrame: new FrameStats(),\r\n\r\n    /**\r\n     * Previous frame statistics. Engine reuses this instance, use {@apilink FrameStats.clone} to copy frame stats.\r\n     * Best accessed on {@apilink preframe} event. Best inspected on engine event `preframe`. See {@apilink FrameStats}\r\n     */\r\n    prevFrame: new FrameStats()\r\n  };\r\n\r\n  /**\r\n   * Correct or simulate color blindness using {@apilink ColorBlindnessPostProcessor}.\r\n   * @warning Will reduce FPS.\r\n   */\r\n  public colorBlindMode: ColorBlindFlags;\r\n\r\n  /**\r\n   * Filter debug context to named entities or entity ids\r\n   */\r\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\r\n    /**\r\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\r\n     */\r\n    useFilter: false,\r\n    /**\r\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\r\n     */\r\n    nameQuery: '',\r\n    /**\r\n     * Query for Entity ids, if the id matches it will be included\r\n     */\r\n    ids: []\r\n  };\r\n\r\n  /**\r\n   * Entity debug settings\r\n   */\r\n  public entity = {\r\n    showAll: false,\r\n    showId: false,\r\n    showName: false\r\n  };\r\n\r\n  /**\r\n   * Transform component debug settings\r\n   */\r\n  public transform = {\r\n    showAll: false,\r\n\r\n    debugZIndex: 10_000_000,\r\n    showPosition: false,\r\n    showPositionLabel: false,\r\n    positionColor: Color.Yellow,\r\n\r\n    showZIndex: false,\r\n\r\n    showScale: false,\r\n    scaleColor: Color.Green,\r\n\r\n    showRotation: false,\r\n    rotationColor: Color.Blue\r\n  };\r\n\r\n  /**\r\n   * Graphics component debug settings\r\n   */\r\n  public graphics = {\r\n    showAll: false,\r\n\r\n    showBounds: false,\r\n    boundsColor: Color.Yellow\r\n  };\r\n\r\n  /**\r\n   * Collider component debug settings\r\n   */\r\n  public collider = {\r\n    showAll: false,\r\n\r\n    showBounds: false,\r\n    boundsColor: Color.Blue,\r\n\r\n    showOwner: false,\r\n\r\n    showGeometry: true,\r\n    geometryColor: Color.Green,\r\n    geometryLineWidth: 1,\r\n    geometryPointSize: 0.5\r\n  };\r\n\r\n  /**\r\n   * Physics simulation debug settings\r\n   */\r\n  public physics = {\r\n    showAll: false,\r\n\r\n    showBroadphaseSpacePartitionDebug: false,\r\n\r\n    showCollisionNormals: false,\r\n    collisionNormalColor: Color.Cyan,\r\n\r\n    showCollisionContacts: true,\r\n    contactSize: 2,\r\n    collisionContactColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Motion component debug settings\r\n   */\r\n  public motion = {\r\n    showAll: false,\r\n\r\n    showVelocity: false,\r\n    velocityColor: Color.Yellow,\r\n\r\n    showAcceleration: false,\r\n    accelerationColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Body component debug settings\r\n   */\r\n  public body = {\r\n    showAll: false,\r\n\r\n    showCollisionGroup: false,\r\n    showCollisionType: false,\r\n    showSleeping: false,\r\n    showMotion: false,\r\n    showMass: false\r\n  };\r\n\r\n  /**\r\n   * Camera debug settings\r\n   */\r\n  public camera = {\r\n    showAll: false,\r\n\r\n    showFocus: false,\r\n    focusColor: Color.Red,\r\n\r\n    showZoom: false\r\n  };\r\n\r\n  public tilemap = {\r\n    showAll: false,\r\n\r\n    showGrid: false,\r\n    gridColor: Color.Red,\r\n    gridWidth: 0.5,\r\n    showSolidBounds: false,\r\n    solidBoundsColor: Color.fromHex('#8080807F'), // grayish\r\n    showColliderGeometry: true\r\n  };\r\n\r\n  public isometric = {\r\n    showAll: false,\r\n    showPosition: false,\r\n    positionColor: Color.Yellow,\r\n    positionSize: 1,\r\n    showGrid: false,\r\n    gridColor: Color.Red,\r\n    gridWidth: 1,\r\n    showColliderGeometry: true\r\n  };\r\n}\r\n\r\n/**\r\n * Implementation of a frame's stats. Meant to have values copied via {@apilink FrameStats.reset}, avoid\r\n * creating instances of this every frame.\r\n */\r\nexport class FrameStats implements FrameStatistics {\r\n  private _id: number = 0;\r\n  private _elapsedMs: number = 0;\r\n  private _fps: number = 0;\r\n  private _actorStats: FrameActorStats = {\r\n    alive: 0,\r\n    killed: 0,\r\n    ui: 0,\r\n    get remaining() {\r\n      return this.alive - this.killed;\r\n    },\r\n    get total() {\r\n      return this.remaining + this.ui;\r\n    }\r\n  };\r\n  private _durationStats: FrameDurationStats = {\r\n    update: 0,\r\n    draw: 0,\r\n    get total() {\r\n      return this.update + this.draw;\r\n    }\r\n  };\r\n\r\n  private _physicsStats: PhysicsStats = new PhysicsStats();\r\n\r\n  private _graphicsStats: GraphicsStatistics = {\r\n    drawCalls: 0,\r\n    drawnImages: 0\r\n  };\r\n\r\n  /**\r\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: FrameStatistics) {\r\n    if (otherStats) {\r\n      this.id = otherStats.id;\r\n      this.elapsedMs = otherStats.elapsedMs;\r\n      this.fps = otherStats.fps;\r\n      this.actors.alive = otherStats.actors.alive;\r\n      this.actors.killed = otherStats.actors.killed;\r\n      this.actors.ui = otherStats.actors.ui;\r\n      this.duration.update = otherStats.duration.update;\r\n      this.duration.draw = otherStats.duration.draw;\r\n      this._physicsStats.reset(otherStats.physics);\r\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\r\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\r\n    } else {\r\n      this.id = this.elapsedMs = this.fps = 0;\r\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\r\n      this.duration.update = this.duration.draw = 0;\r\n      this._physicsStats.reset();\r\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): FrameStats {\r\n    const fs = new FrameStats();\r\n\r\n    fs.reset(this);\r\n\r\n    return fs;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's id\r\n   */\r\n  public get id() {\r\n    return this._id;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's id\r\n   */\r\n  public set id(value: number) {\r\n    this._id = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame)\r\n   */\r\n  public get elapsedMs() {\r\n    return this._elapsedMs;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's delta (time since last frame). Internal use only.\r\n   * @internal\r\n   */\r\n  public set elapsedMs(value: number) {\r\n    this._elapsedMs = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  public get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's frames-per-second (FPS). Internal use only.\r\n   * @internal\r\n   */\r\n  public set fps(value: number) {\r\n    this._fps = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's actor statistics\r\n   */\r\n  public get actors() {\r\n    return this._actorStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's duration statistics\r\n   */\r\n  public get duration() {\r\n    return this._durationStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's physics statistics\r\n   */\r\n  public get physics() {\r\n    return this._physicsStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's graphics statistics\r\n   */\r\n  public get graphics() {\r\n    return this._graphicsStats;\r\n  }\r\n}\r\n\r\nexport class PhysicsStats implements PhysicsStatistics {\r\n  private _pairs: number = 0;\r\n  private _collisions: number = 0;\r\n  private _contacts: Map<string, CollisionContact> = new Map();\r\n  private _fastBodies: number = 0;\r\n  private _fastBodyCollisions: number = 0;\r\n  private _broadphase: number = 0;\r\n  private _narrowphase: number = 0;\r\n\r\n  /**\r\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: PhysicsStatistics) {\r\n    if (otherStats) {\r\n      this.pairs = otherStats.pairs;\r\n      this.collisions = otherStats.collisions;\r\n      this.contacts = otherStats.contacts;\r\n      this.fastBodies = otherStats.fastBodies;\r\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\r\n      this.broadphase = otherStats.broadphase;\r\n      this.narrowphase = otherStats.narrowphase;\r\n    } else {\r\n      this.pairs = this.collisions = this.fastBodies = 0;\r\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\r\n      this.contacts.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): PhysicsStatistics {\r\n    const ps = new PhysicsStats();\r\n\r\n    ps.reset(this);\r\n\r\n    return ps;\r\n  }\r\n\r\n  public get pairs(): number {\r\n    return this._pairs;\r\n  }\r\n\r\n  public set pairs(value: number) {\r\n    this._pairs = value;\r\n  }\r\n\r\n  public get collisions(): number {\r\n    return this._collisions;\r\n  }\r\n\r\n  public set collisions(value: number) {\r\n    this._collisions = value;\r\n  }\r\n\r\n  public get contacts(): Map<string, CollisionContact> {\r\n    return this._contacts;\r\n  }\r\n\r\n  public set contacts(contacts: Map<string, CollisionContact>) {\r\n    this._contacts = contacts;\r\n  }\r\n\r\n  public get fastBodies(): number {\r\n    return this._fastBodies;\r\n  }\r\n\r\n  public set fastBodies(value: number) {\r\n    this._fastBodies = value;\r\n  }\r\n\r\n  public get fastBodyCollisions(): number {\r\n    return this._fastBodyCollisions;\r\n  }\r\n\r\n  public set fastBodyCollisions(value: number) {\r\n    this._fastBodyCollisions = value;\r\n  }\r\n\r\n  public get broadphase(): number {\r\n    return this._broadphase;\r\n  }\r\n\r\n  public set broadphase(value: number) {\r\n    this._broadphase = value;\r\n  }\r\n\r\n  public get narrowphase(): number {\r\n    return this._narrowphase;\r\n  }\r\n\r\n  public set narrowphase(value: number) {\r\n    this._narrowphase = value;\r\n  }\r\n}\r\n","export interface NativeEventable {\r\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\r\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\r\n}\r\n\r\nexport class BrowserComponent<T extends NativeEventable> {\r\n  private _paused = false;\r\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\r\n\r\n  on(eventName: string, handler: (evt: any) => void): void {\r\n    if (this._nativeHandlers[eventName]) {\r\n      this.off(eventName, this._nativeHandlers[eventName]);\r\n    }\r\n    this._nativeHandlers[eventName] = this._decorate(handler);\r\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\r\n  }\r\n  off(eventName: string, handler?: (event: any) => void): void {\r\n    if (!handler) {\r\n      handler = this._nativeHandlers[eventName];\r\n    }\r\n    this.nativeComponent.removeEventListener(eventName, handler);\r\n    this._nativeHandlers[eventName] = null;\r\n  }\r\n\r\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\r\n    return (evt: any) => {\r\n      if (!this._paused) {\r\n        handler(evt);\r\n      }\r\n    };\r\n  }\r\n\r\n  public pause() {\r\n    this._paused = true;\r\n  }\r\n\r\n  public resume() {\r\n    this._paused = false;\r\n  }\r\n\r\n  public clear() {\r\n    for (const event in this._nativeHandlers) {\r\n      this.off(event);\r\n    }\r\n  }\r\n\r\n  constructor(public nativeComponent: T) {}\r\n}\r\n\r\nexport class BrowserEvents {\r\n  private _windowComponent: BrowserComponent<Window>;\r\n  private _documentComponent: BrowserComponent<Document>;\r\n  constructor(\r\n    private _windowGlobal: Window,\r\n    private _documentGlobal: Document\r\n  ) {\r\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\r\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\r\n  }\r\n\r\n  public get window(): BrowserComponent<Window> {\r\n    return this._windowComponent;\r\n  }\r\n\r\n  public get document(): BrowserComponent<Document> {\r\n    return this._documentComponent;\r\n  }\r\n\r\n  public pause() {\r\n    this.window.pause();\r\n    this.document.pause();\r\n  }\r\n\r\n  public resume() {\r\n    this.window.resume();\r\n    this.document.resume();\r\n  }\r\n\r\n  public clear() {\r\n    this.window.clear();\r\n    this.document.clear();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { Resolution } from '../../Screen';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Material, MaterialOptions } from './material';\r\nimport { ImageFiltering } from '../Filtering';\r\n\r\nexport type HTMLImageSource = HTMLImageElement | HTMLCanvasElement;\r\n\r\nexport interface AntialiasOptions {\r\n  /**\r\n   * Turns on the special pixel art sampler in excalibur's image shader for sub pixel\r\n   * anti-aliasing\r\n   *\r\n   * Default false\r\n   */\r\n  pixelArtSampler?: boolean;\r\n  /**\r\n   * Configures the webgl's getContext('webgl2', {antialias: true | false}) or configures\r\n   * Canvas2D imageSmoothing = true;\r\n   *\r\n   * **Note** this option is incompatible with `multiSampleAntialiasing`\r\n   *\r\n   * Default false\r\n   */\r\n  nativeContextAntialiasing?: boolean;\r\n  /**\r\n   * Configures the internal render buffer multi-sampling settings\r\n   *\r\n   * Default true, with max samples that the platform supports\r\n   */\r\n  multiSampleAntialiasing?:\r\n    | boolean\r\n    | {\r\n        /**\r\n         * Optionally specify number of samples (will be clamped to the max the platform supports)\r\n         *\r\n         * Default most platforms are 16 samples\r\n         */\r\n        samples: number;\r\n      };\r\n  /**\r\n   * Sets the default image filtering for excalibur\r\n   *\r\n   * Default {@apilink ImageFiltering.Blended}\r\n   */\r\n  filtering?: ImageFiltering;\r\n  /**\r\n   * Sets the canvas image rendering CSS style\r\n   *\r\n   * Default 'auto'\r\n   */\r\n  canvasImageRendering?: 'pixelated' | 'auto';\r\n}\r\n\r\nexport const DefaultAntialiasOptions: Required<AntialiasOptions> = {\r\n  pixelArtSampler: false,\r\n  nativeContextAntialiasing: false,\r\n  multiSampleAntialiasing: true,\r\n  filtering: ImageFiltering.Blended,\r\n  canvasImageRendering: 'auto'\r\n};\r\n\r\nexport const DefaultPixelArtOptions: Required<AntialiasOptions> = {\r\n  pixelArtSampler: true,\r\n  nativeContextAntialiasing: false,\r\n  multiSampleAntialiasing: true,\r\n  filtering: ImageFiltering.Blended,\r\n  canvasImageRendering: 'auto'\r\n};\r\n\r\nexport interface ExcaliburGraphicsContextOptions {\r\n  /**\r\n   * Target existing html canvas element\r\n   */\r\n  canvasElement: HTMLCanvasElement;\r\n  /**\r\n   * Enables antialiasing on the canvas context (smooths pixels with default canvas sampling)\r\n   */\r\n  antialiasing?: boolean;\r\n  /**\r\n   * Enable the sub pixel antialiasing pixel art sampler for nice looking pixel art\r\n   */\r\n  pixelArtSampler?: boolean;\r\n  /**\r\n   * Enable canvas transparency\r\n   */\r\n  enableTransparency?: boolean;\r\n  /**\r\n   * Enable or disable multi-sample antialiasing in the internal render buffer.\r\n   *\r\n   * If true the max number of samples will be used\r\n   *\r\n   * By default enabled\r\n   */\r\n  multiSampleAntialiasing?:\r\n    | boolean\r\n    | {\r\n        /**\r\n         * Specify number of samples to use during the multi sample anti-alias, if not specified the max will be used.\r\n         * Limited by the hardware (usually 16)\r\n         */\r\n        samples: number;\r\n      };\r\n  /**\r\n   * UV padding in pixels to use in the internal image rendering\r\n   *\r\n   * Recommended .25 - .5 of a pixel\r\n   */\r\n  uvPadding?: number;\r\n  /**\r\n   * Hint the power preference to the graphics context\r\n   */\r\n  powerPreference?: 'default' | 'high-performance' | 'low-power';\r\n  /**\r\n   * Snaps the pixel to an integer value (floor)\r\n   */\r\n  snapToPixel?: boolean;\r\n  /**\r\n   * Current clearing color of the context\r\n   */\r\n  backgroundColor?: Color;\r\n  /**\r\n   * Feature flag that enables draw sorting will removed in v0.29\r\n   */\r\n  useDrawSorting?: boolean;\r\n}\r\n\r\nexport interface ExcaliburGraphicsContextState {\r\n  opacity: number;\r\n  z: number;\r\n  tint: Color | null | undefined;\r\n  material: Material | null | undefined;\r\n}\r\nexport interface LineGraphicsOptions {\r\n  color?: Color;\r\n}\r\n\r\nexport interface RectGraphicsOptions {\r\n  color?: Color;\r\n}\r\n\r\nexport interface PointGraphicsOptions {\r\n  color: Color;\r\n  size: number;\r\n}\r\n\r\nexport interface DebugDraw {\r\n  /**\r\n   * Draw a debugging rectangle to the screen\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   * @param rectOptions\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions?: RectGraphicsOptions): void;\r\n  /**\r\n   * Draw a debugging line to the screen\r\n   * @param start '\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions?: LineGraphicsOptions): void;\r\n  /**\r\n   * Draw a debugging point to the screen\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions?: PointGraphicsOptions): void;\r\n\r\n  /**\r\n   * Draw debug text\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  drawText(text: string, pos: Vector): void;\r\n}\r\n\r\nexport interface ExcaliburGraphicsContext {\r\n  width: number;\r\n  height: number;\r\n\r\n  /**\r\n   * Excalibur will automatically sort draw calls by z and priority for maximal draw performance,\r\n   * this can disrupt a specific desired painter order.\r\n   *\r\n   * To force a specific draw call order, use {@apilink ExcaliburGraphicsContext.z}\r\n   *\r\n   * By default `useDrawSorting` is `true`, to opt out set this to `false`\r\n   */\r\n  useDrawSorting: boolean;\r\n\r\n  /**\r\n   * Set the current z context for the graphics context. Draw calls issued to the context will use this z\r\n   * to inform their sort order.\r\n   *\r\n   * Note it is important to all {@apilink ExcaliburGraphicsContext.save} and {@apilink ExcaliburGraphicsContext.restore} when modifying state.\r\n   */\r\n  z: number;\r\n\r\n  /**\r\n   * Snaps all drawings to the nearest pixel truncated down, by default false\r\n   */\r\n  snapToPixel: boolean;\r\n\r\n  /**\r\n   * Enable smoothed drawing (also known as anti-aliasing), by default true\r\n   */\r\n  smoothing: boolean;\r\n\r\n  /**\r\n   * Set the background color of the graphics context, default is {@apilink Color.ExcaliburBlue}\r\n   */\r\n  backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the opacity of the current {@apilink Graphic} being drawn, default is 1\r\n   */\r\n  opacity: number;\r\n\r\n  /**\r\n   * Sets the tint color to be multiplied by any images drawn, default is black 0xFFFFFFFF\r\n   */\r\n  tint: Color | null | undefined;\r\n\r\n  /**\r\n   * Resets the current transform to the identity matrix\r\n   */\r\n  resetTransform(): void;\r\n\r\n  /**\r\n   * Gets the current transform\r\n   */\r\n  getTransform(): AffineMatrix;\r\n\r\n  /**\r\n   * Multiplies the current transform by a matrix\r\n   * @param m\r\n   */\r\n  multiply(m: AffineMatrix): void;\r\n\r\n  /**\r\n   * Update the context with the current viewport dimensions (used in resizing)\r\n   */\r\n  updateViewport(resolution: Resolution): void;\r\n\r\n  /**\r\n   * Access the debug drawing api\r\n   */\r\n  debug: DebugDraw;\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  /**\r\n   * Draw a solid line to the Excalibur Graphics context\r\n   * @param start\r\n   * @param end\r\n   * @param color\r\n   * @param thickness\r\n   */\r\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number): void;\r\n\r\n  /**\r\n   * Draw a solid rectangle to the Excalibur Graphics context\r\n   * @param pos\r\n   * @param width\r\n   * @param height\r\n   * @param color\r\n   */\r\n  drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number): void;\r\n\r\n  /**\r\n   * Draw a circle to the Excalibur Graphics context\r\n   * @param pos\r\n   * @param radius\r\n   * @param color\r\n   * @param stroke Optionally specify the stroke color\r\n   * @param thickness\r\n   */\r\n  drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number): void;\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void;\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void;\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void;\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void;\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void;\r\n\r\n  /**\r\n   * Add a post processor to the graphics context\r\n   *\r\n   * Post processors are run in the order they were added.\r\n   * @param postprocessor\r\n   */\r\n  addPostProcessor(postprocessor: PostProcessor): void;\r\n\r\n  /**\r\n   * Remove a specific post processor from the graphics context\r\n   * @param postprocessor\r\n   */\r\n  removePostProcessor(postprocessor: PostProcessor): void;\r\n\r\n  /**\r\n   * Remove all post processors from the graphics context\r\n   */\r\n  clearPostProcessors(): void;\r\n\r\n  /**\r\n   * Updates all post processors in the graphics context\r\n   *\r\n   * Called internally by Excalibur\r\n   * @param elapsed\r\n   * @internal\r\n   */\r\n  updatePostProcessors(elapsed: number): void;\r\n\r\n  /**\r\n   * Gets or sets the material to be used in the current context's drawings\r\n   *\r\n   * This allows customs shaders to be used but draw calls are no longer batched by default.\r\n   * @param material\r\n   */\r\n  material: Material | null | undefined;\r\n\r\n  /**\r\n   * Creates and initializes the material which compiles the internal shader\r\n   * @param options\r\n   * @returns\r\n   */\r\n  createMaterial(options: Omit<MaterialOptions, 'graphicsContext'>): Material;\r\n\r\n  /**\r\n   * Clears the screen with the current background color\r\n   */\r\n  clear(): void;\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void;\r\n\r\n  beginDrawLifecycle(): void;\r\n\r\n  endDrawLifecycle(): void;\r\n\r\n  dispose(): void;\r\n}\r\n","export interface FpsSamplerOptions {\r\n  /**\r\n   * Specify the sampling period in milliseconds (default 100)\r\n   */\r\n  samplePeriod?: number;\r\n  /**\r\n   * Specify the initial FPS\r\n   */\r\n  initialFps: number;\r\n\r\n  /**\r\n   * Specify the function used to return the current time (in milliseconds)\r\n   */\r\n  nowFn: () => number;\r\n}\r\n\r\nexport class FpsSampler {\r\n  private _fps: number;\r\n  private _samplePeriod: number = 100;\r\n  private _currentFrameTime: number = 0;\r\n  private _frames: number = 0;\r\n  private _previousSampleTime: number = 0;\r\n  private _beginFrameTime: number = 0;\r\n  private _nowFn: () => number;\r\n\r\n  constructor(options: FpsSamplerOptions) {\r\n    this._fps = options.initialFps;\r\n    this._samplePeriod = options.samplePeriod ?? this._samplePeriod;\r\n    this._currentFrameTime = 1000 / options.initialFps;\r\n    this._nowFn = options.nowFn;\r\n    this._previousSampleTime = this._nowFn();\r\n  }\r\n\r\n  /**\r\n   * Start of code block to sample FPS for\r\n   */\r\n  start() {\r\n    this._beginFrameTime = this._nowFn();\r\n  }\r\n\r\n  /**\r\n   * End of code block to sample FPS for\r\n   */\r\n  end() {\r\n    this._frames++;\r\n    const time = this._nowFn();\r\n\r\n    this._currentFrameTime = time - this._beginFrameTime;\r\n\r\n    if (time >= this._previousSampleTime + this._samplePeriod) {\r\n      this._fps = (this._frames * 1000) / (time - this._previousSampleTime);\r\n      this._previousSampleTime = time;\r\n      this._frames = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the currently sampled fps over the last sample period, by default every 100ms\r\n   */\r\n  get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Return the instantaneous fps, this can be less useful because it will fluctuate given the current frames time\r\n   */\r\n  get instant() {\r\n    return 1000 / this._currentFrameTime;\r\n  }\r\n}\r\n","import { Logger } from '../Util/Log';\r\nimport { FpsSampler } from './Fps';\r\n\r\nexport type ScheduledCallbackTiming = 'preframe' | 'postframe' | 'preupdate' | 'postupdate' | 'predraw' | 'postdraw';\r\n\r\nexport interface ClockOptions {\r\n  /**\r\n   * Define the function you'd like the clock to tick when it is started\r\n   */\r\n  tick: (elapsed: number) => any;\r\n  /**\r\n   * Optionally define the fatal exception handler, used if an error is thrown in tick\r\n   */\r\n  onFatalException?: (e: unknown) => any;\r\n  /**\r\n   * Optionally limit the maximum FPS of the clock\r\n   */\r\n  maxFps?: number;\r\n}\r\n\r\n/**\r\n * Abstract Clock is the base type of all Clocks\r\n *\r\n * It has a few opinions\r\n * 1. It manages the calculation of what \"elapsed\" time means and thus maximum fps\r\n * 2. The default timing api is implemented in now()\r\n *\r\n * To implement your own clock, extend Clock and override start/stop to start and stop the clock, then call update() with whatever\r\n * method is unique to your clock implementation.\r\n */\r\nexport abstract class Clock {\r\n  protected tick: (elapsed: number) => any;\r\n  private _onFatalException: (e: unknown) => any = () => {\r\n    /* default nothing */\r\n  };\r\n  private _maxFps: number = Infinity;\r\n  private _lastTime: number = 0;\r\n  public fpsSampler: FpsSampler;\r\n  private _options: ClockOptions;\r\n  private _elapsed: number = 1;\r\n  private _scheduledCbs: [cb: (elapsed: number) => any, scheduledTime: number, timing: ScheduledCallbackTiming][] = [];\r\n  private _totalElapsed: number = 0;\r\n  constructor(options: ClockOptions) {\r\n    this._options = options;\r\n    this.tick = options.tick;\r\n    this._lastTime = this.now() ?? 0;\r\n    this._maxFps = options.maxFps ?? this._maxFps;\r\n    this._onFatalException = options.onFatalException ?? this._onFatalException;\r\n    this.fpsSampler = new FpsSampler({\r\n      initialFps: 60,\r\n      nowFn: () => this.now()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the elapsed time for the last completed frame\r\n   */\r\n  public elapsed(): number {\r\n    return this._elapsed;\r\n  }\r\n\r\n  /**\r\n   * Get the current time in milliseconds\r\n   */\r\n  public now(): number {\r\n    return performance.now();\r\n  }\r\n\r\n  public toTestClock() {\r\n    const testClock = new TestClock({\r\n      ...this._options,\r\n      defaultUpdateMs: 16.6\r\n    });\r\n    return testClock;\r\n  }\r\n\r\n  public toStandardClock() {\r\n    const clock = new StandardClock({\r\n      ...this._options\r\n    });\r\n    return clock;\r\n  }\r\n\r\n  public setFatalExceptionHandler(handler: (e: unknown) => any) {\r\n    this._onFatalException = handler;\r\n  }\r\n\r\n  /**\r\n   * Schedule a callback to fire given a timeout in milliseconds using the excalibur {@apilink Clock}\r\n   *\r\n   * This is useful to use over the built in browser `setTimeout` because callbacks will be tied to the\r\n   * excalibur update clock, instead of browser time, this means that callbacks wont fire if the game is\r\n   * stopped or paused.\r\n   * @param cb callback to fire\r\n   * @param timeoutMs Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\r\n   * @param timing Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\r\n   */\r\n  public schedule(cb: (elapsed: number) => any, timeoutMs: number = 0, timing: ScheduledCallbackTiming = 'preframe') {\r\n    // Scheduled based on internal elapsed time\r\n    const scheduledTime = this._totalElapsed + timeoutMs;\r\n    this._scheduledCbs.push([cb, scheduledTime, timing]);\r\n  }\r\n\r\n  /**\r\n   * Called internally to trigger scheduled callbacks in the clock\r\n   * @param timing\r\n   * @internal\r\n   */\r\n  public __runScheduledCbs(timing: ScheduledCallbackTiming = 'preframe') {\r\n    // walk backwards to delete items as we loop\r\n    for (let i = this._scheduledCbs.length - 1; i > -1; i--) {\r\n      if (timing === this._scheduledCbs[i][2] && this._scheduledCbs[i][1] <= this._totalElapsed) {\r\n        this._scheduledCbs[i][0](this._elapsed);\r\n        this._scheduledCbs.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected update(overrideUpdateMs?: number): void {\r\n    try {\r\n      this.fpsSampler.start();\r\n      // Get the time to calculate time-elapsed\r\n      const now = this.now();\r\n      let elapsed = now - this._lastTime || 1; // first frame\r\n\r\n      // Constrain fps\r\n      const fpsInterval = 1000 / this._maxFps;\r\n\r\n      // only run frame if enough time has elapsed\r\n      if (elapsed >= fpsInterval) {\r\n        let leftover = 0;\r\n        if (fpsInterval !== 0) {\r\n          leftover = elapsed % fpsInterval;\r\n          elapsed = elapsed - leftover; // shift elapsed to be \"in phase\" with the current loop fps\r\n        }\r\n\r\n        // Resolves issue #138 if the game has been paused, or blurred for\r\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\r\n        // and provides more expected behavior when the engine comes back\r\n        // into focus\r\n        if (elapsed > 200) {\r\n          elapsed = 1;\r\n        }\r\n\r\n        // tick the mainloop and run scheduled callbacks\r\n        this._elapsed = overrideUpdateMs || elapsed;\r\n        this._totalElapsed += this._elapsed;\r\n        this.__runScheduledCbs('preframe');\r\n        this.tick(overrideUpdateMs || elapsed);\r\n        this.__runScheduledCbs('postframe');\r\n\r\n        if (fpsInterval !== 0) {\r\n          this._lastTime = now - leftover;\r\n        } else {\r\n          this._lastTime = now;\r\n        }\r\n        this.fpsSampler.end();\r\n      }\r\n    } catch (e) {\r\n      this._onFatalException(e);\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns if the clock is currently running\r\n   */\r\n  public abstract isRunning(): boolean;\r\n\r\n  /**\r\n   * Start the clock, it will then periodically call the tick(elapsedMilliseconds) since the last tick\r\n   */\r\n  public abstract start(): void;\r\n\r\n  /**\r\n   * Stop the clock, tick() is no longer called\r\n   */\r\n  public abstract stop(): void;\r\n}\r\n\r\n/**\r\n * The {@apilink StandardClock} implements the requestAnimationFrame browser api to run the tick()\r\n */\r\nexport class StandardClock extends Clock {\r\n  private _running = false;\r\n  private _requestId: number;\r\n  constructor(options: ClockOptions) {\r\n    super(options);\r\n  }\r\n\r\n  public isRunning(): boolean {\r\n    return this._running;\r\n  }\r\n\r\n  public start(): void {\r\n    if (this._running) {\r\n      return;\r\n    }\r\n    this._running = true;\r\n    const mainloop = () => {\r\n      // stop the loop\r\n      if (!this._running) {\r\n        return;\r\n      }\r\n      try {\r\n        // request next loop\r\n        this._requestId = window.requestAnimationFrame(mainloop);\r\n        this.update();\r\n      } catch (e) {\r\n        window.cancelAnimationFrame(this._requestId);\r\n        throw e;\r\n      }\r\n    };\r\n\r\n    // begin the first frame\r\n    mainloop();\r\n  }\r\n\r\n  public stop(): void {\r\n    window.cancelAnimationFrame(this._requestId);\r\n    this._running = false;\r\n  }\r\n}\r\n\r\nexport interface TestClockOptions {\r\n  /**\r\n   * Specify the update milliseconds to use for each manual step()\r\n   */\r\n  defaultUpdateMs: number;\r\n}\r\n\r\n/**\r\n * The TestClock is meant for debugging interactions in excalibur that require precise timing to replicate or test\r\n */\r\nexport class TestClock extends Clock {\r\n  private _logger = Logger.getInstance();\r\n  private _updateMs: number;\r\n  private _running: boolean = false;\r\n  private _currentTime = 0;\r\n  constructor(options: ClockOptions & TestClockOptions) {\r\n    super({\r\n      ...options\r\n    });\r\n    this._updateMs = options.defaultUpdateMs;\r\n  }\r\n\r\n  /**\r\n   * Get the current time in milliseconds\r\n   */\r\n  public override now() {\r\n    return this._currentTime ?? 0;\r\n  }\r\n\r\n  public isRunning(): boolean {\r\n    return this._running;\r\n  }\r\n  public start(): void {\r\n    this._running = true;\r\n  }\r\n  public stop(): void {\r\n    this._running = false;\r\n  }\r\n\r\n  /**\r\n   * Manually step the clock forward 1 tick, optionally specify an elapsed time in milliseconds\r\n   * @param overrideUpdateMs\r\n   */\r\n  step(overrideUpdateMs?: number): void {\r\n    const time = overrideUpdateMs ?? this._updateMs;\r\n\r\n    if (this._running) {\r\n      // to be comparable to RAF this needs to be a full blown Task\r\n      // For example, images cannot decode synchronously in a single step\r\n      this.update(time);\r\n      this._currentTime += time;\r\n    } else {\r\n      this._logger.warn('The clock is not running, no step will be performed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Run a number of steps that tick the clock, optionally specify an elapsed time in milliseconds\r\n   * @param numberOfSteps\r\n   * @param overrideUpdateMs\r\n   */\r\n  run(numberOfSteps: number, overrideUpdateMs?: number): void {\r\n    for (let i = 0; i < numberOfSteps; i++) {\r\n      this.step(overrideUpdateMs ?? this._updateMs);\r\n    }\r\n  }\r\n}\r\n","import toasterCss from './Toaster.css';\r\n\r\n/**\r\n * The Toaster is only meant to be called from inside Excalibur to display messages to players\r\n */\r\nexport class Toaster {\r\n  private _styleBlock: HTMLStyleElement;\r\n  private _container: HTMLDivElement;\r\n  private _toasterCss: string = toasterCss.toString();\r\n\r\n  private _isInitialized = false;\r\n  private _initialize() {\r\n    if (!this._isInitialized) {\r\n      this._container = document.createElement('div');\r\n      this._container.id = 'ex-toast-container';\r\n      document.body.appendChild(this._container);\r\n      this._isInitialized = true;\r\n\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._toasterCss;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n  }\r\n\r\n  public dispose() {\r\n    this._container.parentElement.removeChild(this._container);\r\n\r\n    this._styleBlock.parentElement.removeChild(this._styleBlock);\r\n\r\n    this._isInitialized = false;\r\n  }\r\n\r\n  private _createFragment(message: string) {\r\n    const toastMessage = document.createElement('span');\r\n    toastMessage.innerText = message;\r\n    return toastMessage;\r\n  }\r\n\r\n  /**\r\n   * Display a toast message to a player\r\n   * @param message Text of the message, messages may have a single \"[LINK]\" to influence placement\r\n   * @param linkTarget Optionally specify a link location\r\n   * @param linkName Optionally specify a name for that link location\r\n   */\r\n  public toast(message: string, linkTarget?: string, linkName?: string) {\r\n    this._initialize();\r\n    const toast = document.createElement('div');\r\n    toast.className = 'ex-toast-message';\r\n\r\n    const messageFragments: HTMLElement[] = message.split('[LINK]').map((message) => this._createFragment(message));\r\n\r\n    if (linkTarget) {\r\n      const link = document.createElement('a');\r\n      link.href = linkTarget;\r\n      if (linkName) {\r\n        link.innerText = linkName;\r\n      } else {\r\n        link.innerText = linkTarget;\r\n      }\r\n      messageFragments.splice(1, 0, link);\r\n    }\r\n\r\n    // Assembly message\r\n    const finalMessage = document.createElement('div');\r\n    messageFragments.forEach((message) => {\r\n      finalMessage.appendChild(message);\r\n    });\r\n    toast.appendChild(finalMessage);\r\n\r\n    // Dismiss button\r\n    const dismissBtn = document.createElement('button');\r\n    dismissBtn.innerText = 'x';\r\n    dismissBtn.addEventListener('click', () => {\r\n      this._container.removeChild(toast);\r\n    });\r\n    toast.appendChild(dismissBtn);\r\n\r\n    // Escape to dismiss\r\n    const keydownHandler = (evt: KeyboardEvent) => {\r\n      if (evt.key === 'Escape') {\r\n        try {\r\n          this._container.removeChild(toast);\r\n        } catch {\r\n          // pass\r\n        }\r\n      }\r\n      document.removeEventListener('keydown', keydownHandler);\r\n    };\r\n    document.addEventListener('keydown', keydownHandler);\r\n\r\n    // Insert into container\r\n    const first = this._container.firstChild;\r\n    this._container.insertBefore(toast, first);\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { DefaultLoader, LoaderConstructor, isLoaderConstructor } from './DefaultLoader';\r\nimport { Scene, SceneConstructor, isSceneConstructor } from '../Scene';\r\nimport { Transition } from './Transition';\r\nimport { Loader } from './Loader';\r\nimport { Logger } from '../Util/Log';\r\nimport { ActivateEvent, DeactivateEvent } from '../Events';\r\nimport { EventEmitter } from '../EventEmitter';\r\n\r\nexport interface DirectorNavigationEvent {\r\n  sourceName: string;\r\n  sourceScene: Scene;\r\n  destinationName: string;\r\n  destinationScene: Scene;\r\n}\r\n\r\nexport type DirectorEvents = {\r\n  navigationstart: DirectorNavigationEvent;\r\n  navigation: DirectorNavigationEvent;\r\n  navigationend: DirectorNavigationEvent;\r\n};\r\n\r\nexport const DirectorEvents = {\r\n  NavigationStart: 'navigationstart',\r\n  Navigation: 'navigation',\r\n  NavigationEnd: 'navigationend'\r\n};\r\n\r\nexport interface SceneWithOptions {\r\n  /**\r\n   * Scene associated with this route\r\n   *\r\n   * If a constructor is provided it will not be constructed until navigation is requested\r\n   */\r\n  scene: Scene | SceneConstructor;\r\n  /**\r\n   * Specify scene transitions\r\n   */\r\n  transitions?: {\r\n    /**\r\n     * Optionally specify a transition when going \"in\" to this scene\r\n     */\r\n    in?: Transition;\r\n    /**\r\n     * Optionally specify a transition when going \"out\" of this scene\r\n     */\r\n    out?: Transition;\r\n  };\r\n  /**\r\n   * Optionally specify a loader for the scene\r\n   */\r\n  loader?: DefaultLoader | LoaderConstructor;\r\n}\r\n\r\nexport type WithRoot<TScenes> = TScenes | 'root';\r\n\r\nexport type SceneMap<TKnownScenes extends string = any> = Record<TKnownScenes, Scene | SceneConstructor | SceneWithOptions>;\r\n\r\nexport interface StartOptions {\r\n  /**\r\n   * Optionally provide first transition from the game start screen\r\n   */\r\n  inTransition?: Transition;\r\n  /**\r\n   * Optionally provide a main loader to run before the game starts\r\n   */\r\n  loader?: DefaultLoader | LoaderConstructor;\r\n}\r\n\r\n/**\r\n * Provide scene activation data and override any existing configured route transitions or loaders\r\n */\r\nexport interface GoToOptions<TActivationData = any> {\r\n  /**\r\n   * Optionally supply scene activation data passed to Scene.onActivate\r\n   */\r\n  sceneActivationData?: TActivationData;\r\n  /**\r\n   * Optionally supply destination scene \"in\" transition, this will override any previously defined transition\r\n   */\r\n  destinationIn?: Transition;\r\n  /**\r\n   * Optionally supply source scene \"out\" transition, this will override any previously defined transition\r\n   */\r\n  sourceOut?: Transition;\r\n  /**\r\n   * Optionally supply a different loader for the destination scene, this will override any previously defined loader\r\n   */\r\n  loader?: DefaultLoader;\r\n}\r\n\r\n/**\r\n * The Director is responsible for managing scenes and changing scenes in Excalibur.\r\n *\r\n * It deals with transitions, scene loaders, switching scenes\r\n *\r\n * This is used internally by Excalibur, generally not mean to\r\n * be instantiated end users directly.\r\n */\r\nexport class Director<TKnownScenes extends string = any> {\r\n  public events = new EventEmitter<DirectorEvents>();\r\n  private _logger = Logger.getInstance();\r\n  private _deferredGoto?: string;\r\n  private _deferredTransition?: Transition;\r\n  private _initialized = false;\r\n\r\n  /**\r\n   * Current scene's name\r\n   */\r\n  currentSceneName: string;\r\n  /**\r\n   * Current scene playing in excalibur\r\n   */\r\n  currentScene: Scene;\r\n  /**\r\n   * Current transition if any\r\n   */\r\n  currentTransition?: Transition;\r\n\r\n  /**\r\n   * All registered scenes in Excalibur\r\n   */\r\n  public readonly scenes: SceneMap<WithRoot<TKnownScenes>> = {} as SceneMap<WithRoot<TKnownScenes>>;\r\n\r\n  /**\r\n   * Holds all instantiated scenes\r\n   */\r\n  private _sceneToInstance = new Map<string, Scene>();\r\n\r\n  startScene?: string;\r\n  mainLoader?: DefaultLoader;\r\n\r\n  /**\r\n   * The default {@apilink Scene} of the game, use {@apilink Engine.goToScene} to transition to different scenes.\r\n   */\r\n  public readonly rootScene: Scene;\r\n\r\n  private _sceneToLoader = new Map<string, DefaultLoader>();\r\n  private _sceneToTransition = new Map<string, { in?: Transition; out?: Transition }>();\r\n  /**\r\n   * Used to keep track of scenes that have already been loaded so we don't load multiple times\r\n   */\r\n  private _loadedScenes = new Set<Scene>();\r\n\r\n  private _isTransitioning = false;\r\n\r\n  /**\r\n   * Gets whether the director currently transitioning between scenes\r\n   *\r\n   * Useful if you need to block behavior during transition\r\n   */\r\n  public get isTransitioning() {\r\n    return this._isTransitioning;\r\n  }\r\n\r\n  constructor(\r\n    private _engine: Engine,\r\n    scenes: SceneMap<TKnownScenes>\r\n  ) {\r\n    this.rootScene = this.currentScene = new Scene();\r\n    this.add('root', this.rootScene);\r\n    this.currentScene = this.rootScene;\r\n    this.currentSceneName = 'root';\r\n    for (const sceneKey in scenes) {\r\n      const sceneOrOptions = scenes[sceneKey];\r\n      this.add(sceneKey, sceneOrOptions);\r\n      if (sceneKey === 'root') {\r\n        this.rootScene = this.getSceneInstance('root')!; // always a root scene\r\n        this.currentScene = this.rootScene;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the director's internal state\r\n   */\r\n  async onInitialize() {\r\n    if (!this._initialized) {\r\n      this._initialized = true;\r\n      if (this._deferredGoto) {\r\n        const deferredScene = this._deferredGoto;\r\n        this._deferredGoto = undefined;\r\n        const deferredTransition = this._deferredTransition;\r\n        this._deferredTransition = undefined;\r\n        const deferredSceneInstance = this.getSceneInstance(deferredScene);\r\n        if (deferredSceneInstance && deferredTransition) {\r\n          deferredTransition._addToTargetScene(this._engine, deferredSceneInstance);\r\n        }\r\n        await this.swapScene(deferredScene);\r\n        if (deferredSceneInstance && deferredTransition) {\r\n          await this.playTransition(deferredTransition, deferredSceneInstance);\r\n        }\r\n      } else {\r\n        await this.swapScene('root');\r\n      }\r\n    }\r\n  }\r\n\r\n  get isInitialized() {\r\n    return this._initialized;\r\n  }\r\n\r\n  /**\r\n   * Configures the start scene, and optionally the transition & loader for the director\r\n   *\r\n   * Typically this is called at the beginning of the game to the start scene and transition and never again.\r\n   * @param startScene\r\n   * @param options\r\n   */\r\n  configureStart(startScene: WithRoot<TKnownScenes>, options?: StartOptions) {\r\n    const maybeLoaderOrCtor = options?.loader;\r\n    if (maybeLoaderOrCtor instanceof DefaultLoader) {\r\n      this.mainLoader = maybeLoaderOrCtor;\r\n    } else if (isLoaderConstructor(maybeLoaderOrCtor)) {\r\n      this.mainLoader = new maybeLoaderOrCtor();\r\n    } else {\r\n      this.mainLoader = new Loader();\r\n    }\r\n\r\n    let maybeStartTransition: Transition | undefined;\r\n\r\n    if (options?.inTransition) {\r\n      const { inTransition } = options;\r\n      maybeStartTransition = inTransition;\r\n    }\r\n\r\n    this.startScene = startScene;\r\n\r\n    // Fire and forget promise for the initial scene\r\n    if (maybeStartTransition) {\r\n      const startSceneInstance = this.getSceneInstance(this.startScene);\r\n      if (startSceneInstance) {\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        maybeStartTransition._addToTargetScene(this._engine, startSceneInstance);\r\n        this.swapScene(this.startScene).then(() => {\r\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n          return this.playTransition(maybeStartTransition, startSceneInstance);\r\n        });\r\n      }\r\n    } else {\r\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n      this.swapScene(this.startScene);\r\n    }\r\n\r\n    this.currentSceneName = this.startScene;\r\n  }\r\n\r\n  private _getLoader(sceneName: string) {\r\n    return this._sceneToLoader.get(sceneName);\r\n  }\r\n\r\n  private _getInTransition(sceneName: string): Transition | undefined {\r\n    const sceneOrRoute = this.scenes[sceneName as TKnownScenes];\r\n    if (sceneOrRoute instanceof Scene || isSceneConstructor(sceneOrRoute)) {\r\n      return undefined;\r\n    }\r\n    return sceneOrRoute?.transitions?.in;\r\n  }\r\n\r\n  private _getOutTransition(sceneName: string): Transition | undefined {\r\n    const sceneOrRoute = this.scenes[sceneName as TKnownScenes];\r\n    if (sceneOrRoute instanceof Scene || isSceneConstructor(sceneOrRoute)) {\r\n      return undefined;\r\n    }\r\n    return sceneOrRoute?.transitions?.out;\r\n  }\r\n\r\n  getDeferredScene() {\r\n    const maybeDeferred = this.getSceneDefinition(this._deferredGoto);\r\n    if (this._deferredGoto && maybeDeferred) {\r\n      return maybeDeferred;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns a scene by name if it exists, might be the constructor and not the instance of a scene\r\n   * @param name\r\n   */\r\n  getSceneDefinition(name?: string): Scene | SceneConstructor | undefined {\r\n    const maybeScene = this.scenes[name as TKnownScenes];\r\n    if (maybeScene instanceof Scene || isSceneConstructor(maybeScene)) {\r\n      return maybeScene;\r\n    } else if (maybeScene) {\r\n      return maybeScene.scene;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Returns the name of the registered scene, null if none can be found\r\n   * @param scene\r\n   */\r\n  getSceneName(scene: Scene): string | null {\r\n    for (const [name, maybeScene] of Object.entries(this.scenes)) {\r\n      if (maybeScene instanceof Scene) {\r\n        if (scene === maybeScene) {\r\n          return name;\r\n        }\r\n      } else if (!isSceneConstructor(maybeScene)) {\r\n        if (scene === maybeScene.scene) {\r\n          return name;\r\n        }\r\n      }\r\n    }\r\n\r\n    for (const [name, maybeScene] of Object.entries(this.scenes)) {\r\n      if (isSceneConstructor(maybeScene)) {\r\n        if (scene.constructor === maybeScene) {\r\n          return name;\r\n        }\r\n      } else if (!(maybeScene instanceof Scene)) {\r\n        if (scene.constructor === maybeScene.scene) {\r\n          return name;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the same Director, but asserts a scene DOES exist to the type system\r\n   * @param name\r\n   */\r\n  assertAdded<TScene extends string>(name: TScene): Director<TKnownScenes | TScene> {\r\n    return this as Director<TKnownScenes | TScene>;\r\n  }\r\n\r\n  /**\r\n   * Returns the same Director, but asserts a scene DOES NOT exist to the type system\r\n   * @param name\r\n   */\r\n  assertRemoved<TScene extends string>(name: TScene): Director<Exclude<TKnownScenes, TScene>> {\r\n    return this as Director<Exclude<TKnownScenes, TScene>>;\r\n  }\r\n\r\n  /**\r\n   * Adds additional Scenes to the game!\r\n   * @param name\r\n   * @param sceneOrRoute\r\n   */\r\n  add<TScene extends string>(name: TScene, sceneOrRoute: Scene | SceneConstructor | SceneWithOptions): Director<TKnownScenes | TScene> {\r\n    if (!(sceneOrRoute instanceof Scene) && !isSceneConstructor(sceneOrRoute)) {\r\n      const { loader, transitions } = sceneOrRoute;\r\n      const { in: inTransition, out: outTransition } = transitions ?? {};\r\n      this._sceneToTransition.set(name, { in: inTransition, out: outTransition });\r\n\r\n      if (isLoaderConstructor(loader)) {\r\n        this._sceneToLoader.set(name, new loader());\r\n      } else if (loader) {\r\n        this._sceneToLoader.set(name, loader);\r\n      }\r\n    }\r\n\r\n    if (this.scenes[name as unknown as TKnownScenes]) {\r\n      this._logger.warn('Scene', name, 'already exists overwriting');\r\n    }\r\n    this.scenes[name as unknown as TKnownScenes] = sceneOrRoute;\r\n    return this.assertAdded(name);\r\n  }\r\n\r\n  remove(scene: Scene): void;\r\n  remove(sceneCtor: SceneConstructor): void;\r\n  remove(name: WithRoot<TKnownScenes>): void;\r\n  remove(nameOrScene: TKnownScenes | Scene | SceneConstructor | string) {\r\n    if (nameOrScene instanceof Scene || isSceneConstructor(nameOrScene)) {\r\n      const sceneOrCtor = nameOrScene;\r\n      // remove scene\r\n      for (const key in this.scenes) {\r\n        if (this.scenes.hasOwnProperty(key)) {\r\n          const potentialSceneOrOptions = this.scenes[key as TKnownScenes];\r\n          let scene: Scene | SceneConstructor;\r\n          if (potentialSceneOrOptions instanceof Scene || isSceneConstructor(potentialSceneOrOptions)) {\r\n            scene = potentialSceneOrOptions;\r\n          } else {\r\n            scene = potentialSceneOrOptions.scene;\r\n          }\r\n\r\n          if (scene === sceneOrCtor) {\r\n            if (key === this.currentSceneName) {\r\n              throw new Error(`Cannot remove a currently active scene: ${key}`);\r\n            }\r\n\r\n            this._sceneToInstance.delete(key);\r\n            this._sceneToTransition.delete(key);\r\n            this._sceneToLoader.delete(key);\r\n            delete this.scenes[key as TKnownScenes];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (typeof nameOrScene === 'string') {\r\n      if (nameOrScene === this.currentSceneName) {\r\n        throw new Error(`Cannot remove a currently active scene: ${nameOrScene}`);\r\n      }\r\n\r\n      // remove scene\r\n      this._sceneToInstance.delete(nameOrScene);\r\n      this._sceneToTransition.delete(nameOrScene);\r\n      this._sceneToLoader.delete(nameOrScene);\r\n      delete this.scenes[nameOrScene as TKnownScenes];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Go to a specific scene, and optionally override loaders and transitions\r\n   * @param destinationScene\r\n   * @param options\r\n   */\r\n  async goToScene(destinationScene: TKnownScenes | string, options?: GoToOptions) {\r\n    const maybeDest = this.getSceneInstance(destinationScene);\r\n    if (!maybeDest) {\r\n      this._logger.warn(`Scene ${destinationScene} does not exist! Check the name, are you sure you added it?`);\r\n      return;\r\n    }\r\n    const sourceSceneInstance = this.currentScene;\r\n    const sourceScene = this.currentSceneName;\r\n    const engineInputEnabled = this._engine.input?.enabled ?? true;\r\n    this._isTransitioning = true;\r\n\r\n    const maybeSourceOut = this.getSceneInstance(sourceScene)?.onTransition('out');\r\n    const maybeDestinationIn = maybeDest?.onTransition('in');\r\n\r\n    options = {\r\n      // Engine configuration then dynamic scene transitions\r\n      ...{ sourceOut: this._getOutTransition(this.currentSceneName) ?? maybeSourceOut },\r\n      ...{ destinationIn: this._getInTransition(destinationScene) ?? maybeDestinationIn },\r\n      // Goto options\r\n      ...options\r\n    };\r\n\r\n    const { sourceOut, destinationIn, sceneActivationData } = options;\r\n\r\n    const outTransition = sourceOut ?? this._getOutTransition(this.currentSceneName);\r\n    const inTransition = destinationIn ?? this._getInTransition(destinationScene);\r\n\r\n    const hideLoader = outTransition?.hideLoader || inTransition?.hideLoader;\r\n    if (hideLoader) {\r\n      // Start hidden loader early and take advantage of the transition\r\n      // Don't await and block on a hidden loader\r\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n      this.maybeLoadScene(destinationScene, hideLoader);\r\n    }\r\n\r\n    this._emitEvent('navigationstart', sourceScene, destinationScene);\r\n\r\n    // Run the out transition on the current scene if present\r\n    if (outTransition) {\r\n      await this.playTransition(outTransition, sourceSceneInstance);\r\n    }\r\n\r\n    // Run the loader if present\r\n    await this.maybeLoadScene(destinationScene, hideLoader);\r\n\r\n    // Give incoming transition a chance to grab info from previous\r\n    if (inTransition) {\r\n      await inTransition.onPreviousSceneDeactivate(this.currentScene);\r\n    }\r\n\r\n    // Setup the in transition on the destination scene if present\r\n    // this is important to it can be initialized with the\r\n    if (inTransition) {\r\n      inTransition._addToTargetScene(this._engine, maybeDest);\r\n    }\r\n\r\n    // Swap to the new scene\r\n    // Runs scene lifecycle init and activate\r\n    await this.swapScene(destinationScene, sceneActivationData);\r\n    this._emitEvent('navigation', sourceScene, destinationScene);\r\n\r\n    // Run the in transition on the new scene if present\r\n    if (inTransition) {\r\n      await this.playTransition(inTransition, maybeDest);\r\n    }\r\n    this._emitEvent('navigationend', sourceScene, destinationScene);\r\n\r\n    this._engine.input?.toggleEnabled(engineInputEnabled);\r\n    this._isTransitioning = false;\r\n  }\r\n\r\n  /**\r\n   * Retrieves a scene instance by key if it's registered.\r\n   *\r\n   * This will call any constructors that were given as a definition\r\n   * @param scene\r\n   */\r\n  getSceneInstance(scene: string): Scene | undefined {\r\n    const sceneDefinition = this.getSceneDefinition(scene);\r\n    if (!sceneDefinition) {\r\n      return undefined;\r\n    }\r\n    if (this._sceneToInstance.has(scene)) {\r\n      return this._sceneToInstance.get(scene) as Scene;\r\n    }\r\n    if (sceneDefinition instanceof Scene) {\r\n      this._sceneToInstance.set(scene, sceneDefinition);\r\n      return sceneDefinition;\r\n    }\r\n    const newScene = new sceneDefinition();\r\n    this._sceneToInstance.set(scene, newScene);\r\n    return newScene;\r\n  }\r\n\r\n  /**\r\n   * Triggers scene loading if has not already been loaded\r\n   * @param scene\r\n   * @param hideLoader\r\n   */\r\n  async maybeLoadScene(scene: string, hideLoader = false) {\r\n    const loader = this._getLoader(scene) ?? new DefaultLoader();\r\n    const sceneToLoad = this.getSceneDefinition(scene);\r\n    const sceneToLoadInstance = this.getSceneInstance(scene);\r\n    if (sceneToLoad && sceneToLoadInstance && !this._loadedScenes.has(sceneToLoadInstance)) {\r\n      sceneToLoadInstance.onPreLoad(loader);\r\n      sceneToLoadInstance.events.emit('preload', { loader });\r\n      if (hideLoader) {\r\n        // Don't await a hidden loader\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this._engine.load(loader, hideLoader);\r\n      } else {\r\n        await this._engine.load(loader);\r\n      }\r\n      this._loadedScenes.add(sceneToLoadInstance);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Plays a transition in the current scene and does book keeping for input.\r\n   * @param transition\r\n   */\r\n  async playTransition(transition: Transition, targetScene: Scene) {\r\n    if (!this.isInitialized) {\r\n      this._deferredTransition = transition;\r\n      return;\r\n    }\r\n\r\n    if (transition) {\r\n      this.currentTransition = transition;\r\n      const sceneInputEnabled = targetScene.input?.enabled ?? true;\r\n\r\n      targetScene.input?.toggleEnabled(!transition.blockInput);\r\n      this._engine.input?.toggleEnabled(!transition.blockInput);\r\n\r\n      this.currentTransition._addToTargetScene(this._engine, targetScene);\r\n      await this.currentTransition._play();\r\n\r\n      targetScene.input?.toggleEnabled(sceneInputEnabled);\r\n    }\r\n    this.currentTransition?.kill();\r\n    this.currentTransition?.reset();\r\n    this.currentTransition = undefined;\r\n  }\r\n\r\n  /**\r\n   * Swaps the current and destination scene after performing required lifecycle events\r\n   * @param destinationScene\r\n   * @param data\r\n   */\r\n  async swapScene<TData = undefined>(destinationScene: string, data?: TData): Promise<void> {\r\n    const engine = this._engine;\r\n    // if not yet initialized defer goToScene\r\n    if (!this.isInitialized) {\r\n      this._deferredGoto = destinationScene;\r\n      return;\r\n    }\r\n\r\n    const maybeDest = this.getSceneInstance(destinationScene);\r\n\r\n    if (maybeDest) {\r\n      const previousScene = this.currentScene;\r\n      const nextScene = maybeDest;\r\n\r\n      this._logger.debug('Going to scene:', destinationScene);\r\n      // only deactivate when initialized\r\n      if (this.currentScene.isInitialized) {\r\n        const context = { engine, previousScene, nextScene };\r\n        await this.currentScene._deactivate(context);\r\n        this.currentScene.events.emit('deactivate', new DeactivateEvent(context, this.currentScene));\r\n        this.currentScene.input.clear();\r\n      }\r\n\r\n      // wait for the scene to be loaded if needed\r\n      const destLoader = this._sceneToLoader.get(destinationScene);\r\n      await destLoader?.areResourcesLoaded();\r\n\r\n      // set current scene to new one\r\n      this.currentScene = nextScene;\r\n      this.currentSceneName = destinationScene;\r\n      engine.screen.setCurrentCamera(nextScene.camera);\r\n\r\n      // initialize the current scene if has not been already\r\n      await this.currentScene._initialize(engine);\r\n\r\n      const context = { engine, previousScene, nextScene, data };\r\n      await this.currentScene._activate(context);\r\n      this.currentScene.events.emit('activate', new ActivateEvent(context, this.currentScene));\r\n    } else {\r\n      this._logger.error('Scene', destinationScene, 'does not exist!');\r\n    }\r\n  }\r\n\r\n  private _emitEvent(eventName: keyof DirectorEvents, sourceScene: string, destinationScene: string) {\r\n    const source = this.getSceneDefinition(sourceScene)!;\r\n    const dest = this.getSceneDefinition(destinationScene)!;\r\n    this.events.emit(eventName, {\r\n      sourceScene: source,\r\n      sourceName: sourceScene,\r\n      destinationScene: dest,\r\n      destinationName: destinationScene\r\n    } as DirectorNavigationEvent);\r\n  }\r\n}\r\n","export interface Context<TValue> {\r\n  /**\r\n   * Run the callback before popping the context value\r\n   * @param value\r\n   * @param cb\r\n   */\r\n  scope: <TReturn>(value: TValue, cb: () => TReturn) => TReturn;\r\n  value: TValue;\r\n}\r\n\r\n/**\r\n * Creates a injectable context that can be retrieved later with `useContext(context)`\r\n *\r\n * Example\r\n * ```typescript\r\n *\r\n * const AppContext = createContext({some: 'value'});\r\n * context.scope(val, () => {\r\n *    const value = useContext(AppContext);\r\n * })\r\n *\r\n * ```\r\n */\r\nexport function createContext<TValue>() {\r\n  const ctx: Context<TValue> = {\r\n    scope: (value, cb) => {\r\n      const old = ctx.value;\r\n      ctx.value = value;\r\n      try {\r\n        return cb();\r\n      } catch (e) {\r\n        throw e;\r\n      } finally {\r\n        ctx.value = old;\r\n      }\r\n    },\r\n    value: undefined\r\n  };\r\n  return ctx;\r\n}\r\n\r\n/**\r\n * Retrieves the value from the current context\r\n */\r\nexport function useContext<TValue>(context: Context<TValue>): TValue {\r\n  return context.value;\r\n}\r\n","export interface GarbageCollectionOptions {\r\n  /**\r\n   * Textures that aren't drawn after a certain number of milliseconds are unloaded from the GPU\r\n   * Default 60_000 ms\r\n   */\r\n  textureCollectInterval?: number; // default 60_000 ms\r\n  // TODO future work to integrate the font and text configuration, refactor existing collection mechanism\r\n  // /**\r\n  //  * Font pre-renders that aren't drawn after a certain number of milliseconds are unloaded from the GPU\r\n  //  * Default 60_000 ms\r\n  //  */\r\n  // fontCollectInterval: number; // default 60_000 ms\r\n  // /**\r\n  //  * Text measurements that aren't used after a certain number of milliseconds are unloaded from the GPU\r\n  //  * Default 60_000 ms\r\n  //  */\r\n  // textMeasurementCollectInterval: number; // default 60_000 ms\r\n}\r\n\r\nexport const DefaultGarbageCollectionOptions: GarbageCollectionOptions = {\r\n  textureCollectInterval: 60_000\r\n  // TODO future work to integrate the font and text configuration, refactor existing collection mechanism\r\n  // fontCollectInterval: 60_000,\r\n  // textMeasurementCollectInterval: 60_000,\r\n};\r\n\r\nexport interface GarbageCollectorOptions {\r\n  /**\r\n   * Returns a timestamp in milliseconds representing now\r\n   */\r\n  getTimestamp: () => number;\r\n}\r\n\r\nexport class GarbageCollector {\r\n  private _collectHandle: number;\r\n  private _running = false;\r\n  private _collectionMap = new Map<any, [type: string, time: number]>();\r\n  private _collectors = new Map<string, [(resource: any) => boolean, interval: number]>();\r\n\r\n  constructor(public options: GarbageCollectorOptions) {}\r\n\r\n  /**\r\n   *\r\n   * @param type Resource type\r\n   * @param timeoutInterval If resource type exceeds interval in milliseconds collect() is called\r\n   * @param collect Collection implementation, returns true if collected\r\n   */\r\n  registerCollector(type: string, timeoutInterval: number, collect: (resource: any) => boolean) {\r\n    this._collectors.set(type, [collect, timeoutInterval]);\r\n  }\r\n\r\n  /**\r\n   * Add a resource to be tracked for collection\r\n   * @param type\r\n   * @param resource\r\n   */\r\n  addCollectableResource(type: string, resource: any) {\r\n    this._collectionMap.set(resource, [type, this.options.getTimestamp()]);\r\n  }\r\n\r\n  /**\r\n   * Update the resource last used timestamp preventing collection\r\n   * @param resource\r\n   */\r\n  touch(resource: any) {\r\n    const collectionData = this._collectionMap.get(resource);\r\n    if (collectionData) {\r\n      this._collectionMap.set(resource, [collectionData[0], this.options.getTimestamp()]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Runs the collection loop to cleanup any stale resources given the registered collect handlers\r\n   */\r\n  public collectStaleResources = (deadline?: IdleDeadline) => {\r\n    if (!this._running) {\r\n      return;\r\n    }\r\n    for (const [type, [collector, timeoutInterval]] of this._collectors.entries()) {\r\n      const now = this.options.getTimestamp();\r\n      for (const [resource, [resourceType, time]] of this._collectionMap.entries()) {\r\n        if (type !== resourceType || time + timeoutInterval >= now) {\r\n          continue;\r\n        }\r\n\r\n        const collected = collector(resource);\r\n        if (collected) {\r\n          this._collectionMap.delete(resource);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._collectHandle = requestIdleCallback(this.collectStaleResources);\r\n  };\r\n\r\n  /**\r\n   * Force collect all resources, useful for shutting down a game\r\n   * or if you know that you will not use anything you've allocated before now\r\n   */\r\n  public forceCollectAll() {\r\n    for (const [_, [collector]] of this._collectors.entries()) {\r\n      for (const [resource] of this._collectionMap.entries()) {\r\n        const collected = collector(resource);\r\n        if (collected) {\r\n          this._collectionMap.delete(resource);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Starts the garbage collection loop\r\n   */\r\n  start() {\r\n    this._running = true;\r\n    this.collectStaleResources();\r\n  }\r\n\r\n  /**\r\n   * Stops the garbage collection loop\r\n   */\r\n  stop() {\r\n    this._running = false;\r\n    cancelIdleCallback(this._collectHandle);\r\n  }\r\n}\r\n","import { EX_VERSION } from './';\r\nimport { Future } from './Util/Future';\r\nimport { EventEmitter, EventKey, Handler, Subscription } from './EventEmitter';\r\nimport { PointerScope } from './Input/PointerScope';\r\nimport { Flags } from './Flags';\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { Vector } from './Math/vector';\r\nimport { Screen, DisplayMode, Resolution, ViewportDimension } from './Screen';\r\nimport { ScreenElement } from './ScreenElement';\r\nimport { Actor } from './Actor';\r\nimport { Timer } from './Timer';\r\nimport { TileMap } from './TileMap';\r\nimport { DefaultLoader } from './Director/DefaultLoader';\r\nimport { Loader } from './Director/Loader';\r\nimport { Detector } from './Util/Detector';\r\nimport {\r\n  VisibleEvent,\r\n  HiddenEvent,\r\n  GameStartEvent,\r\n  GameStopEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreFrameEvent,\r\n  PostFrameEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  InitializeEvent\r\n} from './Events';\r\nimport { Logger, LogLevel } from './Util/Log';\r\nimport { Color } from './Color';\r\nimport { Scene, SceneConstructor, isSceneConstructor } from './Scene';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { DebugConfig, DebugStats } from './Debug/DebugConfig';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport {\r\n  AntialiasOptions,\r\n  DefaultAntialiasOptions,\r\n  DefaultPixelArtOptions,\r\n  ExcaliburGraphicsContext,\r\n  ExcaliburGraphicsContext2DCanvas,\r\n  ExcaliburGraphicsContextWebGL,\r\n  TextureLoader\r\n} from './Graphics';\r\nimport { Clock, StandardClock } from './Util/Clock';\r\nimport { ImageFiltering } from './Graphics/Filtering';\r\nimport { GraphicsDiagnostics } from './Graphics/GraphicsDiagnostics';\r\nimport { Toaster } from './Util/Toaster';\r\nimport { InputMapper } from './Input/InputMapper';\r\nimport { GoToOptions, SceneMap, Director, StartOptions, SceneWithOptions, WithRoot } from './Director/Director';\r\nimport { InputHost } from './Input/InputHost';\r\nimport { getDefaultPhysicsConfig, PhysicsConfig } from './Collision/PhysicsConfig';\r\nimport { DeepRequired } from './Util/Required';\r\nimport { Context, createContext, useContext } from './Context';\r\nimport { DefaultGarbageCollectionOptions, GarbageCollectionOptions, GarbageCollector } from './GarbageCollector';\r\nimport { mergeDeep } from './Util/Util';\r\n\r\nexport type EngineEvents = {\r\n  fallbackgraphicscontext: ExcaliburGraphicsContext2DCanvas;\r\n  initialize: InitializeEvent<Engine>;\r\n  visible: VisibleEvent;\r\n  hidden: HiddenEvent;\r\n  start: GameStartEvent;\r\n  stop: GameStopEvent;\r\n  preupdate: PreUpdateEvent<Engine>;\r\n  postupdate: PostUpdateEvent<Engine>;\r\n  preframe: PreFrameEvent;\r\n  postframe: PostFrameEvent;\r\n  predraw: PreDrawEvent;\r\n  postdraw: PostDrawEvent;\r\n};\r\n\r\nexport const EngineEvents = {\r\n  FallbackGraphicsContext: 'fallbackgraphicscontext',\r\n  Initialize: 'initialize',\r\n  Visible: 'visible',\r\n  Hidden: 'hidden',\r\n  Start: 'start',\r\n  Stop: 'stop',\r\n  PreUpdate: 'preupdate',\r\n  PostUpdate: 'postupdate',\r\n  PreFrame: 'preframe',\r\n  PostFrame: 'postframe',\r\n  PreDraw: 'predraw',\r\n  PostDraw: 'postdraw'\r\n} as const;\r\n\r\n/**\r\n * Enum representing the different mousewheel event bubble prevention\r\n */\r\nexport enum ScrollPreventionMode {\r\n  /**\r\n   * Do not prevent any page scrolling\r\n   */\r\n  None,\r\n  /**\r\n   * Prevent page scroll if mouse is over the game canvas\r\n   */\r\n  Canvas,\r\n  /**\r\n   * Prevent all page scrolling via mouse wheel\r\n   */\r\n  All\r\n}\r\n\r\n/**\r\n * Defines the available options to configure the Excalibur engine at constructor time.\r\n */\r\nexport interface EngineOptions<TKnownScenes extends string = any> {\r\n  /**\r\n   * Optionally configure the width of the viewport in css pixels\r\n   */\r\n  width?: number;\r\n\r\n  /**\r\n   * Optionally configure the height of the viewport in css pixels\r\n   */\r\n  height?: number;\r\n\r\n  /**\r\n   * Optionally configure the width & height of the viewport in css pixels.\r\n   * Use `viewport` instead of {@apilink EngineOptions.width} and {@apilink EngineOptions.height}, or vice versa.\r\n   */\r\n  viewport?: ViewportDimension;\r\n\r\n  /**\r\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\r\n   * See {@apilink Resolution} for common presets.\r\n   */\r\n  resolution?: Resolution;\r\n\r\n  /**\r\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\r\n   *\r\n   *  * `true` - useful for high resolution art work you would like smoothed, this also hints excalibur to load images\r\n   * with default blending {@apilink ImageFiltering.Blended}\r\n   *\r\n   *  * `false` - useful for pixel art style art work you would like sharp, this also hints excalibur to load images\r\n   * with default blending {@apilink ImageFiltering.Pixel}\r\n   *\r\n   * * {@apilink AntialiasOptions} Optionally deeply configure the different antialiasing settings, **WARNING** thar be dragons here.\r\n   * It is recommended you stick to `true` or `false` unless you understand what you're doing and need to control rendering to\r\n   * a high degree.\r\n   */\r\n  antialiasing?: boolean | AntialiasOptions;\r\n\r\n  /**\r\n   * Optionally specify excalibur garbage collection, by default true.\r\n   *\r\n   * * `true` - garbage collection defaults are enabled (default)\r\n   *\r\n   * * `false` - garbage collection is completely disabled (not recommended)\r\n   *\r\n   * * {@apilink GarbageCollectionOptions} Optionally deeply configure garbage collection settings, **WARNING** thar be dragons here.\r\n   * It is recommended you stick to `true` or `false` unless you understand what you're doing, it is possible to get into a downward\r\n   * spiral if collection timings are set too low where you are stuck in repeated collection.\r\n   */\r\n  garbageCollection?: boolean | GarbageCollectionOptions;\r\n\r\n  /**\r\n   * Quick convenience property to configure Excalibur to use special settings for \"pretty\" anti-aliased pixel art\r\n   *\r\n   * 1. Turns on special shader condition to blend for pixel art and enables various antialiasing settings,\r\n   *  notice blending is ON for this special mode.\r\n   *\r\n   * Equivalent to:\r\n   * ```javascript\r\n   * antialiasing: {\r\n   *  pixelArtSampler: true,\r\n   *  canvasImageRendering: 'auto',\r\n   *  filtering: ImageFiltering.Blended,\r\n   *  webglAntialiasing: true\r\n   * }\r\n   * ```\r\n   */\r\n  pixelArt?: boolean;\r\n\r\n  /**\r\n   * Specify any UV padding you want use in pixels, this brings sampling into the texture if you're using\r\n   * a sprite sheet in one image to prevent sampling bleed.\r\n   *\r\n   * Defaults:\r\n   * * `antialiasing: false` or `filtering: ImageFiltering.Pixel` - 0.0;\r\n   * * `pixelArt: true` - 0.25\r\n   * * All else 0.01\r\n   */\r\n  uvPadding?: number;\r\n\r\n  /**\r\n   * Optionally hint the graphics context into a specific power profile\r\n   *\r\n   * Default \"high-performance\"\r\n   */\r\n  powerPreference?: 'default' | 'high-performance' | 'low-power';\r\n\r\n  /**\r\n   * Optionally upscale the number of pixels in the canvas. Normally only useful if you need a smoother look to your assets, especially\r\n   * {@apilink Text} or Pixel Art assets.\r\n   *\r\n   * **WARNING** It is recommended you try using `antialiasing: true` before adjusting pixel ratio. Pixel ratio will consume more memory\r\n   * and on mobile may break if the internal size of the canvas exceeds 4k pixels in width or height.\r\n   *\r\n   * Default is based the display's pixel ratio, for example a HiDPI screen might have the value 2;\r\n   */\r\n  pixelRatio?: number;\r\n\r\n  /**\r\n   * Optionally configure the native canvas transparent backdrop\r\n   */\r\n  enableCanvasTransparency?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element to render the game in\r\n   */\r\n  canvasElementId?: string;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element directly\r\n   */\r\n  canvasElement?: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Optionally enable the right click context menu on the canvas\r\n   *\r\n   * Default if unset is false\r\n   */\r\n  enableCanvasContextMenu?: boolean;\r\n\r\n  /**\r\n   * Optionally snap graphics to nearest pixel, default is false\r\n   */\r\n  snapToPixel?: boolean;\r\n\r\n  /**\r\n   * The {@apilink DisplayMode} of the game, by default {@apilink DisplayMode.FitScreen} with aspect ratio 4:3 (800x600).\r\n   * Depending on this value, {@apilink width} and {@apilink height} may be ignored.\r\n   */\r\n  displayMode?: DisplayMode;\r\n\r\n  /**\r\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\r\n   * (default) scoped will fire anywhere on the page.\r\n   */\r\n  pointerScope?: PointerScope;\r\n\r\n  /**\r\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\r\n   */\r\n  suppressConsoleBootMessage?: boolean;\r\n\r\n  /**\r\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\r\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\r\n   * browsers or if there is a bug in excalibur preventing execution.\r\n   */\r\n  suppressMinimumBrowserFeatureDetection?: boolean;\r\n\r\n  /**\r\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\r\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\r\n   */\r\n  suppressHiDPIScaling?: boolean;\r\n\r\n  /**\r\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\r\n   * for certain browser features to work like web audio.\r\n   */\r\n  suppressPlayButton?: boolean;\r\n\r\n  /**\r\n   * Sets the focus of the window, this is needed when hosting excalibur in a cross-origin iframe in order for certain events\r\n   * (like keyboard) to work.\r\n   * For example: itch.io or codesandbox.io\r\n   *\r\n   * By default set to true,\r\n   */\r\n  grabWindowFocus?: boolean;\r\n\r\n  /**\r\n   * Scroll prevention method.\r\n   */\r\n  scrollPreventionMode?: ScrollPreventionMode;\r\n\r\n  /**\r\n   * Optionally set the background color\r\n   */\r\n  backgroundColor?: Color;\r\n\r\n  /**\r\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\r\n   *\r\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\r\n   * one that bounces between 30fps and 60fps\r\n   */\r\n  maxFps?: number;\r\n\r\n  /**\r\n   * Optionally configure a fixed update timestep in milliseconds, this can be desirable if you need the physics simulation to be very stable. When\r\n   * set the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   *\r\n   * **WARN:** `fixedUpdateTimestep` takes precedence over `fixedUpdateFps` use whichever is most convenient.\r\n   */\r\n  fixedUpdateTimestep?: number;\r\n\r\n  /**\r\n   * Optionally configure a fixed update fps, this can be desirable if you need the physics simulation to be very stable. When set\r\n   * the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   *\r\n   * **WARN:** `fixedUpdateTimestep` takes precedence over `fixedUpdateFps` use whichever is most convenient.\r\n   */\r\n  fixedUpdateFps?: number;\r\n\r\n  /**\r\n   * Default `true`, optionally configure excalibur to use optimal draw call sorting, to opt out set this to `false`.\r\n   *\r\n   * Excalibur will automatically sort draw calls by z and priority into renderer batches for maximal draw performance,\r\n   * this can disrupt a specific desired painter order.\r\n   *\r\n   */\r\n  useDrawSorting?: boolean;\r\n\r\n  /**\r\n   * Optionally provide a custom handler for the webgl context lost event\r\n   */\r\n  handleContextLost?: (e: Event) => void;\r\n\r\n  /**\r\n   * Optionally provide a custom handler for the webgl context restored event\r\n   */\r\n  handleContextRestored?: (e: Event) => void;\r\n\r\n  /**\r\n   * Optionally configure how excalibur handles poor performance on a player's browser\r\n   */\r\n  configurePerformanceCanvas2DFallback?: {\r\n    /**\r\n     * By default `false`, this will switch the internal graphics context to Canvas2D which can improve performance on non hardware\r\n     * accelerated browsers.\r\n     */\r\n    allow: boolean;\r\n    /**\r\n     * By default `false`, if set to `true` a dialogue will be presented to the player about their browser and how to potentially\r\n     * address any issues.\r\n     */\r\n    showPlayerMessage?: boolean;\r\n    /**\r\n     * Default `{ numberOfFrames: 100, fps: 20 }`, optionally configure excalibur to fallback to the 2D Canvas renderer\r\n     * if bad performance is detected.\r\n     *\r\n     * In this example of the default if excalibur is running at 20fps or less for 100 frames it will trigger the fallback to the 2D\r\n     * Canvas renderer.\r\n     */\r\n    threshold?: { numberOfFrames: number; fps: number };\r\n  };\r\n\r\n  /**\r\n   * Optionally configure the physics simulation in excalibur\r\n   *\r\n   * If false, Excalibur will not produce a physics simulation.\r\n   *\r\n   * Default is configured to use {@apilink SolverStrategy.Arcade} physics simulation\r\n   */\r\n  physics?: boolean | PhysicsConfig;\r\n\r\n  /**\r\n   * Optionally specify scenes with their transitions and loaders to excalibur's scene {@apilink Director}\r\n   *\r\n   * Scene transitions can can overridden dynamically by the `Scene` or by the call to `.goToScene`\r\n   */\r\n  scenes?: SceneMap<TKnownScenes>;\r\n}\r\n\r\n/**\r\n * The Excalibur Engine\r\n *\r\n * The {@apilink Engine} is the main driver for a game. It is responsible for\r\n * starting/stopping the game, maintaining state, transmitting events,\r\n * loading resources, and managing the scene.\r\n */\r\nexport class Engine<TKnownScenes extends string = any> implements CanInitialize, CanUpdate, CanDraw {\r\n  static Context: Context<Engine | null> = createContext<Engine | null>();\r\n  static useEngine(): Engine {\r\n    const value = useContext(Engine.Context);\r\n\r\n    if (!value) {\r\n      throw new Error('Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.');\r\n    }\r\n\r\n    return value;\r\n  }\r\n  static InstanceCount = 0;\r\n\r\n  /**\r\n   * Anything run under scope can use `useEngine()` to inject the current engine\r\n   * @param cb\r\n   */\r\n  scope = <TReturn>(cb: () => TReturn) => Engine.Context.scope(this, cb);\r\n\r\n  private _garbageCollector: GarbageCollector;\r\n\r\n  public readonly garbageCollectorConfig: GarbageCollectionOptions | null;\r\n\r\n  /**\r\n   * Current Excalibur version string\r\n   *\r\n   * Useful for plugins or other tools that need to know what features are available\r\n   */\r\n  public readonly version = EX_VERSION;\r\n\r\n  /**\r\n   * Listen to and emit events on the Engine\r\n   */\r\n  public events = new EventEmitter<EngineEvents>();\r\n\r\n  /**\r\n   * Excalibur browser events abstraction used for wiring to native browser events safely\r\n   */\r\n  public browser: BrowserEvents;\r\n\r\n  /**\r\n   * Screen abstraction\r\n   */\r\n  public screen: Screen;\r\n\r\n  /**\r\n   * Scene director, manages all scenes, scene transitions, and loaders in excalibur\r\n   */\r\n  public director: Director<TKnownScenes>;\r\n\r\n  /**\r\n   * Direct access to the engine's canvas element\r\n   */\r\n  public canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Direct access to the ExcaliburGraphicsContext used for drawing things to the screen\r\n   */\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Direct access to the canvas element ID, if an ID exists\r\n   */\r\n  public canvasElementId: string;\r\n\r\n  /**\r\n   * Direct access to the physics configuration for excalibur\r\n   */\r\n  public physics: DeepRequired<PhysicsConfig>;\r\n\r\n  /**\r\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\r\n   *\r\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\r\n   * one that bounces between 30fps and 60fps\r\n   */\r\n  public maxFps: number = Number.POSITIVE_INFINITY;\r\n\r\n  /**\r\n   * Optionally configure a fixed update fps, this can be desirable if you need the physics simulation to be very stable. When set\r\n   * the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   *\r\n   * **WARN:** `fixedUpdateTimestep` takes precedence over `fixedUpdateFps` use whichever is most convenient.\r\n   */\r\n  public readonly fixedUpdateFps?: number;\r\n\r\n  /**\r\n   * Optionally configure a fixed update timestep in milliseconds, this can be desirable if you need the physics simulation to be very stable. When\r\n   * set the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   *\r\n   * **WARN:** `fixedUpdateTimestep` takes precedence over `fixedUpdateFps` use whichever is most convenient.\r\n   */\r\n  public readonly fixedUpdateTimestep?: number;\r\n\r\n  /**\r\n   * Direct access to the excalibur clock\r\n   */\r\n  public clock: Clock;\r\n\r\n  public readonly pointerScope: PointerScope;\r\n  public readonly grabWindowFocus: boolean;\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.screen.canvasWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.screen.halfCanvasWidth;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.screen.canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.screen.halfCanvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    return this.screen.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.screen.halfDrawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    return this.screen.drawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.screen.halfDrawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns whether excalibur detects the current screen to be HiDPI\r\n   */\r\n  public get isHiDpi(): boolean {\r\n    return this.screen.isHiDpi;\r\n  }\r\n\r\n  /**\r\n   * Access engine input like pointer, keyboard, or gamepad\r\n   */\r\n  public input: InputHost;\r\n\r\n  /**\r\n   * Map multiple input sources to specific game actions actions\r\n   */\r\n  public inputMapper: InputMapper;\r\n\r\n  private _inputEnabled: boolean = true;\r\n\r\n  /**\r\n   * Access Excalibur debugging functionality.\r\n   *\r\n   * Useful when you want to debug different aspects of built in engine features like\r\n   *   * Transform\r\n   *   * Graphics\r\n   *   * Colliders\r\n   */\r\n  public debug: DebugConfig;\r\n\r\n  /**\r\n   * Access {@apilink stats} that holds frame statistics.\r\n   */\r\n  public get stats(): DebugStats {\r\n    return this.debug.stats;\r\n  }\r\n\r\n  /**\r\n   * The current {@apilink Scene} being drawn and updated on screen\r\n   */\r\n  public get currentScene(): Scene {\r\n    return this.director.currentScene;\r\n  }\r\n\r\n  /**\r\n   * The current {@apilink Scene} being drawn and updated on screen\r\n   */\r\n  public get currentSceneName(): string {\r\n    return this.director.currentSceneName;\r\n  }\r\n\r\n  /**\r\n   * The default {@apilink Scene} of the game, use {@apilink Engine.goToScene} to transition to different scenes.\r\n   */\r\n  public get rootScene(): Scene {\r\n    return this.director.rootScene;\r\n  }\r\n\r\n  /**\r\n   * Contains all the scenes currently registered with Excalibur\r\n   */\r\n  public get scenes(): { [key: string]: Scene | SceneConstructor | SceneWithOptions } {\r\n    return this.director.scenes;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the engine is set to fullscreen or not\r\n   */\r\n  public get isFullscreen(): boolean {\r\n    return this.screen.isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current {@apilink DisplayMode} of the engine.\r\n   */\r\n  public get displayMode(): DisplayMode {\r\n    return this.screen.displayMode;\r\n  }\r\n\r\n  private _suppressPlayButton: boolean = false;\r\n  /**\r\n   * Returns the calculated pixel ration for use in rendering\r\n   */\r\n  public get pixelRatio(): number {\r\n    return this.screen.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether audio should be paused when the game is no longer visible.\r\n   */\r\n  public pauseAudioWhenHidden: boolean = true;\r\n\r\n  /**\r\n   * Indicates whether the engine should draw with debug information\r\n   */\r\n  private _isDebug: boolean = false;\r\n  public get isDebug(): boolean {\r\n    return this._isDebug;\r\n  }\r\n\r\n  /**\r\n   * Sets the background color for the engine.\r\n   */\r\n  public backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the Transparency for the engine.\r\n   */\r\n  public enableCanvasTransparency: boolean = true;\r\n\r\n  /**\r\n   * Hints the graphics context to truncate fractional world space coordinates\r\n   */\r\n  public get snapToPixel(): boolean {\r\n    return this.graphicsContext.snapToPixel;\r\n  }\r\n\r\n  public set snapToPixel(shouldSnapToPixel: boolean) {\r\n    this.graphicsContext.snapToPixel = shouldSnapToPixel;\r\n  }\r\n\r\n  /**\r\n   * The action to take when a fatal exception is thrown\r\n   */\r\n  public onFatalException = (e: any) => {\r\n    Logger.getInstance().fatal(e, e.stack);\r\n  };\r\n\r\n  /**\r\n   * The mouse wheel scroll prevention mode\r\n   */\r\n  public pageScrollPreventionMode: ScrollPreventionMode;\r\n\r\n  private _logger: Logger;\r\n\r\n  private _toaster: Toaster = new Toaster();\r\n\r\n  // this determines whether excalibur is compatible with your browser\r\n  private _compatible: boolean;\r\n\r\n  private _timescale: number = 1.0;\r\n\r\n  // loading\r\n  private _loader: DefaultLoader;\r\n\r\n  private _isInitialized: boolean = false;\r\n\r\n  public emit<TEventName extends EventKey<EngineEvents>>(eventName: TEventName, event: EngineEvents[TEventName]): void;\r\n  public emit(eventName: string, event?: any): void;\r\n  public emit<TEventName extends EventKey<EngineEvents> | string>(eventName: TEventName, event?: any): void {\r\n    this.events.emit(eventName, event);\r\n  }\r\n\r\n  public on<TEventName extends EventKey<EngineEvents>>(eventName: TEventName, handler: Handler<EngineEvents[TEventName]>): Subscription;\r\n  public on(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public on<TEventName extends EventKey<EngineEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.on(eventName, handler);\r\n  }\r\n\r\n  public once<TEventName extends EventKey<EngineEvents>>(eventName: TEventName, handler: Handler<EngineEvents[TEventName]>): Subscription;\r\n  public once(eventName: string, handler: Handler<unknown>): Subscription;\r\n  public once<TEventName extends EventKey<EngineEvents> | string>(eventName: TEventName, handler: Handler<any>): Subscription {\r\n    return this.events.once(eventName, handler);\r\n  }\r\n\r\n  public off<TEventName extends EventKey<EngineEvents>>(eventName: TEventName, handler: Handler<EngineEvents[TEventName]>): void;\r\n  public off(eventName: string, handler: Handler<unknown>): void;\r\n  public off(eventName: string): void;\r\n  public off<TEventName extends EventKey<EngineEvents> | string>(eventName: TEventName, handler?: Handler<any>): void {\r\n    this.events.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Default {@apilink EngineOptions}\r\n   */\r\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    enableCanvasTransparency: true,\r\n    useDrawSorting: true,\r\n    configurePerformanceCanvas2DFallback: {\r\n      allow: false,\r\n      showPlayerMessage: false,\r\n      threshold: { fps: 20, numberOfFrames: 100 }\r\n    },\r\n    canvasElementId: '',\r\n    canvasElement: undefined,\r\n    enableCanvasContextMenu: false,\r\n    snapToPixel: false,\r\n    antialiasing: true,\r\n    pixelArt: false,\r\n    garbageCollection: true,\r\n    powerPreference: 'high-performance',\r\n    pointerScope: PointerScope.Canvas,\r\n    suppressConsoleBootMessage: null,\r\n    suppressMinimumBrowserFeatureDetection: null,\r\n    suppressHiDPIScaling: null,\r\n    suppressPlayButton: null,\r\n    grabWindowFocus: true,\r\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\r\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\r\n  };\r\n\r\n  private _originalOptions: EngineOptions = {};\r\n  public readonly _originalDisplayMode: DisplayMode;\r\n\r\n  /**\r\n   * Creates a new game using the given {@apilink EngineOptions}. By default, if no options are provided,\r\n   * the game will be rendered full screen (taking up all available browser window space).\r\n   * You can customize the game rendering through {@apilink EngineOptions}.\r\n   *\r\n   * Example:\r\n   *\r\n   * ```js\r\n   * var game = new ex.Engine({\r\n   *   width: 0, // the width of the canvas\r\n   *   height: 0, // the height of the canvas\r\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\r\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\r\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\r\n   *   pointerScope: ex.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\r\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\r\n   * });\r\n   *\r\n   * // call game.start, which is a Promise\r\n   * game.start().then(function () {\r\n   *   // ready, set, go!\r\n   * });\r\n   * ```\r\n   */\r\n  constructor(options?: EngineOptions<TKnownScenes>) {\r\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\r\n    this._originalOptions = options;\r\n\r\n    Flags.freeze();\r\n\r\n    // Initialize browser events facade\r\n    this.browser = new BrowserEvents(window, document);\r\n\r\n    // Check compatibility\r\n    const detector = new Detector();\r\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\r\n      const message = document.createElement('div');\r\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\r\n      document.body.appendChild(message);\r\n\r\n      detector.failedTests.forEach(function (test) {\r\n        const testMessage = document.createElement('div');\r\n        testMessage.innerText = 'Browser feature missing ' + test;\r\n        document.body.appendChild(testMessage);\r\n      });\r\n\r\n      if (options.canvasElementId) {\r\n        const canvas = document.getElementById(options.canvasElementId);\r\n        if (canvas) {\r\n          canvas.parentElement.removeChild(canvas);\r\n        }\r\n      }\r\n\r\n      return;\r\n    } else {\r\n      this._compatible = true;\r\n    }\r\n\r\n    // Use native console API for color fun\r\n    // eslint-disable-next-line no-console\r\n    if (console.log && !options.suppressConsoleBootMessage) {\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\r\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        '\\n\\\r\n      /| ________________\\n\\\r\nO|===|* >________________>\\n\\\r\n      \\\\|'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\r\n    }\r\n\r\n    // Suppress play button\r\n    if (options.suppressPlayButton) {\r\n      this._suppressPlayButton = true;\r\n    }\r\n\r\n    this._logger = Logger.getInstance();\r\n\r\n    // If debug is enabled, let's log browser features to the console.\r\n    if (this._logger.defaultLevel === LogLevel.Debug) {\r\n      detector.logBrowserFeatures();\r\n    }\r\n\r\n    this._logger.debug('Building engine...');\r\n    if (options.garbageCollection === true) {\r\n      this.garbageCollectorConfig = {\r\n        ...DefaultGarbageCollectionOptions\r\n      };\r\n    } else if (options.garbageCollection === false) {\r\n      this._logger.warn(\r\n        'WebGL Garbage Collection Disabled!!! If you leak any images over time your game will crash when GPU memory is exhausted'\r\n      );\r\n      this.garbageCollectorConfig = null;\r\n    } else {\r\n      this.garbageCollectorConfig = {\r\n        ...DefaultGarbageCollectionOptions,\r\n        ...options.garbageCollection\r\n      };\r\n    }\r\n    this._garbageCollector = new GarbageCollector({ getTimestamp: Date.now });\r\n\r\n    this.canvasElementId = options.canvasElementId;\r\n\r\n    if (options.canvasElementId) {\r\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\r\n\r\n      //test for existence of element\r\n      if (document.getElementById(options.canvasElementId) === null) {\r\n        throw new Error('Cannot find existing element in the DOM, please ensure element is created prior to engine creation.');\r\n      }\r\n\r\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\r\n    } else if (options.canvasElement) {\r\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\r\n      this.canvas = options.canvasElement;\r\n    } else {\r\n      this._logger.debug('Using generated canvas element');\r\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    }\r\n\r\n    if (this.canvas && !options.enableCanvasContextMenu) {\r\n      this.canvas.addEventListener('contextmenu', (evt) => {\r\n        evt.preventDefault();\r\n      });\r\n    }\r\n\r\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    if ((options.width && options.height) || options.viewport) {\r\n      if (options.displayMode === undefined) {\r\n        displayMode = DisplayMode.Fixed;\r\n      }\r\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\r\n    } else if (!options.displayMode) {\r\n      this._logger.debug('Engine viewport is fit');\r\n      displayMode = DisplayMode.FitScreen;\r\n    }\r\n\r\n    this.grabWindowFocus = options.grabWindowFocus;\r\n    this.pointerScope = options.pointerScope;\r\n\r\n    this._originalDisplayMode = displayMode;\r\n\r\n    let pixelArtSampler: boolean;\r\n    let uvPadding: number;\r\n    let nativeContextAntialiasing: boolean;\r\n    let canvasImageRendering: 'pixelated' | 'auto';\r\n    let filtering: ImageFiltering;\r\n    let multiSampleAntialiasing: boolean | { samples: number };\r\n    if (typeof options.antialiasing === 'object') {\r\n      ({ pixelArtSampler, nativeContextAntialiasing, multiSampleAntialiasing, filtering, canvasImageRendering } = {\r\n        ...(options.pixelArt ? DefaultPixelArtOptions : DefaultAntialiasOptions),\r\n        ...options.antialiasing\r\n      });\r\n    } else {\r\n      pixelArtSampler = !!options.pixelArt;\r\n      nativeContextAntialiasing = false;\r\n      multiSampleAntialiasing = options.antialiasing;\r\n      canvasImageRendering = options.antialiasing ? 'auto' : 'pixelated';\r\n      filtering = options.antialiasing ? ImageFiltering.Blended : ImageFiltering.Pixel;\r\n    }\r\n\r\n    if (nativeContextAntialiasing && multiSampleAntialiasing) {\r\n      this._logger.warnOnce(\r\n        `Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing` +\r\n          ` at the same time, they are incompatible settings. If you aren\\'t sure use multiSampleAntialiasing`\r\n      );\r\n    }\r\n\r\n    if (options.pixelArt) {\r\n      uvPadding = 0.25;\r\n    }\r\n\r\n    if (!options.antialiasing || filtering === ImageFiltering.Pixel) {\r\n      uvPadding = 0;\r\n    }\r\n\r\n    // Override with any user option, if non default to .25 for pixel art, 0.01 for everything else\r\n    uvPadding = options.uvPadding ?? uvPadding ?? 0.01;\r\n\r\n    // Canvas 2D fallback can be flagged on\r\n    let useCanvasGraphicsContext = Flags.isEnabled('use-canvas-context');\r\n    if (!useCanvasGraphicsContext) {\r\n      // Attempt webgl first\r\n      try {\r\n        this.graphicsContext = new ExcaliburGraphicsContextWebGL({\r\n          canvasElement: this.canvas,\r\n          enableTransparency: this.enableCanvasTransparency,\r\n          pixelArtSampler: pixelArtSampler,\r\n          antialiasing: nativeContextAntialiasing,\r\n          multiSampleAntialiasing: multiSampleAntialiasing,\r\n          uvPadding: uvPadding,\r\n          powerPreference: options.powerPreference,\r\n          backgroundColor: options.backgroundColor,\r\n          snapToPixel: options.snapToPixel,\r\n          useDrawSorting: options.useDrawSorting,\r\n          garbageCollector: this.garbageCollectorConfig\r\n            ? {\r\n                garbageCollector: this._garbageCollector,\r\n                collectionInterval: this.garbageCollectorConfig.textureCollectInterval\r\n              }\r\n            : null,\r\n          handleContextLost: options.handleContextLost ?? this._handleWebGLContextLost,\r\n          handleContextRestored: options.handleContextRestored\r\n        });\r\n      } catch (e) {\r\n        this._logger.warn(\r\n          `Excalibur could not load webgl for some reason (${(e as Error).message}) and loaded a Canvas 2D fallback. ` +\r\n            `Some features of Excalibur will not work in this mode. \\n\\n` +\r\n            'Read more about this issue at https://excaliburjs.com/docs/performance'\r\n        );\r\n        // fallback to canvas in case of failure\r\n        useCanvasGraphicsContext = true;\r\n      }\r\n    }\r\n\r\n    if (useCanvasGraphicsContext) {\r\n      this.graphicsContext = new ExcaliburGraphicsContext2DCanvas({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        antialiasing: nativeContextAntialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel,\r\n        useDrawSorting: options.useDrawSorting\r\n      });\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: nativeContextAntialiasing,\r\n      canvasImageRendering: canvasImageRendering,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : options.pixelRatio ?? null\r\n    });\r\n\r\n    // TODO REMOVE STATIC!!!\r\n    // Set default filtering based on antialiasing\r\n    TextureLoader.filtering = filtering;\r\n\r\n    if (options.backgroundColor) {\r\n      this.backgroundColor = options.backgroundColor.clone();\r\n    }\r\n\r\n    this.maxFps = options.maxFps ?? this.maxFps;\r\n\r\n    this.fixedUpdateTimestep = options.fixedUpdateTimestep ?? this.fixedUpdateTimestep;\r\n    this.fixedUpdateFps = options.fixedUpdateFps ?? this.fixedUpdateFps;\r\n    this.fixedUpdateTimestep = this.fixedUpdateTimestep || 1000 / this.fixedUpdateFps;\r\n\r\n    this.clock = new StandardClock({\r\n      maxFps: this.maxFps,\r\n      tick: this._mainloop.bind(this),\r\n      onFatalException: (e) => this.onFatalException(e)\r\n    });\r\n\r\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\r\n\r\n    if (typeof options.physics === 'boolean') {\r\n      this.physics = {\r\n        ...getDefaultPhysicsConfig(),\r\n        enabled: options.physics\r\n      };\r\n    } else {\r\n      this.physics = {\r\n        ...getDefaultPhysicsConfig()\r\n      };\r\n      mergeDeep(this.physics, options.physics);\r\n    }\r\n\r\n    this.debug = new DebugConfig(this);\r\n\r\n    this.director = new Director(this, options.scenes);\r\n\r\n    this._initialize(options);\r\n\r\n    (window as any).___EXCALIBUR_DEVTOOL = this;\r\n    Engine.InstanceCount++;\r\n  }\r\n\r\n  private _handleWebGLContextLost = (e: Event) => {\r\n    e.preventDefault();\r\n    this.clock.stop();\r\n    this._logger.fatalOnce('WebGL Graphics Lost', e);\r\n    const container = document.createElement('div');\r\n    container.id = 'ex-webgl-graphics-context-lost';\r\n    container.style.position = 'absolute';\r\n    container.style.zIndex = '99';\r\n    container.style.left = '50%';\r\n    container.style.top = '50%';\r\n    container.style.display = 'flex';\r\n    container.style.flexDirection = 'column';\r\n    container.style.transform = 'translate(-50%, -50%)';\r\n    container.style.backgroundColor = 'white';\r\n    container.style.padding = '10px';\r\n    container.style.borderStyle = 'solid 1px';\r\n\r\n    const div = document.createElement('div');\r\n    div.innerHTML = `\r\n      <h1>There was an issue rendering, please refresh the page.</h1>\r\n      <div>\r\n        <p>WebGL Graphics Context Lost</p>\r\n\r\n        <button id=\"ex-webgl-graphics-reload\">Refresh Page</button>\r\n\r\n        <p>There are a few reasons this might happen:</p>\r\n        <ul>\r\n          <li>Two or more pages are placing a high demand on the GPU</li>\r\n          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>\r\n          <li>The computer has multiple GPUs and the user has switched between them</li>\r\n          <li>Graphics driver has crashed or restarted</li>\r\n          <li>Graphics driver was updated</li>\r\n        </ul>\r\n      </div>\r\n    `;\r\n    container.appendChild(div);\r\n    if (this.canvas?.parentElement) {\r\n      this.canvas.parentElement.appendChild(container);\r\n      const button = div.querySelector('#ex-webgl-graphics-reload');\r\n      button?.addEventListener('click', () => location.reload());\r\n    }\r\n  };\r\n\r\n  private _performanceThresholdTriggered = false;\r\n  private _fpsSamples: number[] = [];\r\n  private _monitorPerformanceThresholdAndTriggerFallback() {\r\n    const { allow } = this._originalOptions.configurePerformanceCanvas2DFallback;\r\n    let { threshold, showPlayerMessage } = this._originalOptions.configurePerformanceCanvas2DFallback;\r\n    if (threshold === undefined) {\r\n      threshold = Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold;\r\n    }\r\n    if (showPlayerMessage === undefined) {\r\n      showPlayerMessage = Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage;\r\n    }\r\n    if (!Flags.isEnabled('use-canvas-context') && allow && this.ready && !this._performanceThresholdTriggered) {\r\n      // Calculate Average fps for last X number of frames after start\r\n      if (this._fpsSamples.length === threshold.numberOfFrames) {\r\n        this._fpsSamples.splice(0, 1);\r\n      }\r\n      this._fpsSamples.push(this.clock.fpsSampler.fps);\r\n      let total = 0;\r\n      for (let i = 0; i < this._fpsSamples.length; i++) {\r\n        total += this._fpsSamples[i];\r\n      }\r\n      const average = total / this._fpsSamples.length;\r\n\r\n      if (this._fpsSamples.length === threshold.numberOfFrames) {\r\n        if (average <= threshold.fps) {\r\n          this._performanceThresholdTriggered = true;\r\n          this._logger.warn(\r\n            `Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.\\n` +\r\n              \"this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.\\n\\n\" +\r\n              'If in Chrome:\\n' +\r\n              '  * Visit Settings > Advanced > System, and ensure \"Use Hardware Acceleration\" is checked.\\n' +\r\n              '  * Visit chrome://flags/#ignore-gpu-blocklist and ensure \"Override software rendering list\" is \"enabled\"\\n' +\r\n              'If in Firefox, visit about:config\\n' +\r\n              '  * Ensure webgl.disabled = false\\n' +\r\n              '  * Ensure webgl.force-enabled = true\\n' +\r\n              '  * Ensure layers.acceleration.force-enabled = true\\n\\n' +\r\n              'Read more about this issue at https://excaliburjs.com/docs/performance'\r\n          );\r\n\r\n          if (showPlayerMessage) {\r\n            this._toaster.toast(\r\n              'Excalibur is encountering performance issues. ' +\r\n                \"It's possible that your browser doesn't have hardware acceleration enabled. \" +\r\n                'Visit [LINK] for more information and potential solutions.',\r\n              'https://excaliburjs.com/docs/performance'\r\n            );\r\n          }\r\n          this.useCanvas2DFallback();\r\n          this.emit('fallbackgraphicscontext', this.graphicsContext);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switches the engine's graphics context to the 2D Canvas.\r\n   * @warning Some features of Excalibur will not work in this mode.\r\n   */\r\n  public useCanvas2DFallback() {\r\n    // Swap out the canvas\r\n    const newCanvas = this.canvas.cloneNode(false) as HTMLCanvasElement;\r\n    this.canvas.parentNode.replaceChild(newCanvas, this.canvas);\r\n    this.canvas = newCanvas;\r\n\r\n    const options = { ...this._originalOptions, antialiasing: this.screen.antialiasing };\r\n    const displayMode = this._originalDisplayMode;\r\n\r\n    // New graphics context\r\n    this.graphicsContext = new ExcaliburGraphicsContext2DCanvas({\r\n      canvasElement: this.canvas,\r\n      enableTransparency: this.enableCanvasTransparency,\r\n      antialiasing: options.antialiasing,\r\n      backgroundColor: options.backgroundColor,\r\n      snapToPixel: options.snapToPixel,\r\n      useDrawSorting: options.useDrawSorting\r\n    });\r\n\r\n    // Reset screen\r\n    if (this.screen) {\r\n      this.screen.dispose();\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: options.antialiasing ?? true,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : options.pixelRatio ?? null\r\n    });\r\n    this.screen.setCurrentCamera(this.currentScene.camera);\r\n\r\n    // Reset pointers\r\n    this.input.pointers.detach();\r\n    const pointerTarget = options && options.pointerScope === PointerScope.Document ? document : this.canvas;\r\n    this.input.pointers = this.input.pointers.recreate(pointerTarget, this);\r\n    this.input.pointers.init();\r\n  }\r\n\r\n  private _disposed = false;\r\n  /**\r\n   * Attempts to completely clean up excalibur resources, including removing the canvas from the dom.\r\n   *\r\n   * To start again you will need to new up an Engine.\r\n   */\r\n  public dispose() {\r\n    if (!this._disposed) {\r\n      this._disposed = true;\r\n      this.stop();\r\n      this._garbageCollector.forceCollectAll();\r\n      this.input.toggleEnabled(false);\r\n      this.canvas.parentNode.removeChild(this.canvas);\r\n      this.canvas = null;\r\n      this.screen.dispose();\r\n      this.graphicsContext.dispose();\r\n      this.graphicsContext = null;\r\n      Engine.InstanceCount--;\r\n    }\r\n  }\r\n\r\n  public isDisposed() {\r\n    return this._disposed;\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   */\r\n  public getWorldBounds() {\r\n    return this.screen.getWorldBounds();\r\n  }\r\n\r\n  /**\r\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\r\n   */\r\n  public get timescale() {\r\n    return this._timescale;\r\n  }\r\n\r\n  /**\r\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\r\n   * when using time-based movement.\r\n   */\r\n  public set timescale(value: number) {\r\n    if (value < 0) {\r\n      Logger.getInstance().warnOnce('engine.timescale to a value less than 0 are ignored');\r\n      return;\r\n    }\r\n\r\n    this._timescale = value;\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Timer} to the {@apilink currentScene}.\r\n   * @param timer  The timer to add to the {@apilink currentScene}.\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    return this.currentScene.addTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Timer} from the {@apilink currentScene}.\r\n   * @param timer  The timer to remove to the {@apilink currentScene}.\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    return this.currentScene.removeTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Scene} to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param key  The name of the scene, must be unique\r\n   * @param scene The scene to add to the engine\r\n   */\r\n  public addScene<TScene extends string>(key: TScene, scene: Scene | SceneConstructor | SceneWithOptions): Engine<TKnownScenes | TScene> {\r\n    this.director.add(key, scene);\r\n    return this as Engine<TKnownScenes | TScene>;\r\n  }\r\n\r\n  /**\r\n   * Removes a {@apilink Scene} instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public removeScene(scene: Scene | SceneConstructor): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param key  The scene key to remove\r\n   */\r\n  public removeScene(key: string): void;\r\n  /**\r\n   * @internal\r\n   */\r\n  public removeScene(entity: any): void {\r\n    this.director.remove(entity);\r\n  }\r\n\r\n  /**\r\n   * Adds a {@apilink Scene} to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param sceneKey  The key of the scene, must be unique\r\n   * @param scene     The scene to add to the engine\r\n   */\r\n  public add(sceneKey: string, scene: Scene | SceneConstructor | SceneWithOptions): void;\r\n  /**\r\n   * Adds a {@apilink Timer} to the {@apilink currentScene}.\r\n   * @param timer  The timer to add to the {@apilink currentScene}.\r\n   */\r\n  public add(timer: Timer): void;\r\n  /**\r\n   * Adds a {@apilink TileMap} to the {@apilink currentScene}, once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n  /**\r\n   * Adds an actor to the {@apilink currentScene} of the game. This is synonymous\r\n   * to calling `engine.currentScene.add(actor)`.\r\n   *\r\n   * Actors can only be drawn if they are a member of a scene, and only\r\n   * the {@apilink currentScene} may be drawn or updated.\r\n   * @param actor  The actor to add to the {@apilink currentScene}\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a {@apilink ScreenElement} to the {@apilink currentScene} of the game,\r\n   * ScreenElements do not participate in collisions, instead the\r\n   * remain in the same place on the screen.\r\n   * @param screenElement  The ScreenElement to add to the {@apilink currentScene}\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    if (arguments.length === 2) {\r\n      this.director.add(<string>arguments[0], <Scene | SceneConstructor | SceneWithOptions>arguments[1]);\r\n      return;\r\n    }\r\n    const maybeDeferred = this.director.getDeferredScene();\r\n    if (maybeDeferred instanceof Scene) {\r\n      maybeDeferred.add(entity);\r\n    } else {\r\n      this.currentScene.add(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a scene instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public remove(scene: Scene | SceneConstructor): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param sceneKey  The scene to remove\r\n   */\r\n  public remove(sceneKey: string): void;\r\n  /**\r\n   * Removes a {@apilink Timer} from the {@apilink currentScene}.\r\n   * @param timer  The timer to remove to the {@apilink currentScene}.\r\n   */\r\n  public remove(timer: Timer): void;\r\n  /**\r\n   * Removes a {@apilink TileMap} from the {@apilink currentScene}, it will no longer be drawn or updated.\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n  /**\r\n   * Removes an actor from the {@apilink currentScene} of the game. This is synonymous\r\n   * to calling `engine.currentScene.removeChild(actor)`.\r\n   * Actors that are removed from a scene will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the {@apilink currentScene}.\r\n   */\r\n  public remove(actor: Actor): void;\r\n  /**\r\n   * Removes a {@apilink ScreenElement} to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the {@apilink currentScene}\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.currentScene.remove(entity);\r\n    }\r\n\r\n    if (entity instanceof Scene || isSceneConstructor(entity)) {\r\n      this.removeScene(entity);\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      this.removeScene(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes the current scene with optionally supplied:\r\n   * * Activation data\r\n   * * Transitions\r\n   * * Loaders\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * game.goToScene('myScene', {\r\n   *   sceneActivationData: {any: 'thing at all'},\r\n   *   destinationIn: new FadeInOut({duration: 1000, direction: 'in'}),\r\n   *   sourceOut: new FadeInOut({duration: 1000, direction: 'out'}),\r\n   *   loader: MyLoader\r\n   * });\r\n   * ```\r\n   *\r\n   * Scenes are defined in the Engine constructor\r\n   * ```typescript\r\n   * const engine = new ex.Engine({\r\n      scenes: {...}\r\n    });\r\n   * ```\r\n   * Or by adding dynamically\r\n   *\r\n   * ```typescript\r\n   * engine.addScene('myScene', new ex.Scene());\r\n   * ```\r\n   * @param destinationScene\r\n   * @param options\r\n   */\r\n  public async goToScene<TData = undefined>(destinationScene: WithRoot<TKnownScenes>, options?: GoToOptions<TData>): Promise<void> {\r\n    await this.scope(async () => {\r\n      await this.director.goToScene(destinationScene, options);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Transforms the current x, y from screen coordinates to world coordinates\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    return this.screen.screenToWorldCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Transforms a world coordinate, to a screen coordinate\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    return this.screen.worldToScreenCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\r\n   */\r\n  private _initialize(options?: EngineOptions) {\r\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\r\n\r\n    // initialize inputs\r\n    const pointerTarget = options && options.pointerScope === PointerScope.Document ? document : this.canvas;\r\n    const grabWindowFocus = this._originalOptions?.grabWindowFocus ?? true;\r\n    this.input = new InputHost({\r\n      pointerTarget,\r\n      grabWindowFocus,\r\n      engine: this\r\n    });\r\n    this.inputMapper = this.input.inputMapper;\r\n\r\n    // Issue #385 make use of the visibility api\r\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\r\n\r\n    this.browser.document.on('visibilitychange', () => {\r\n      if (document.visibilityState === 'hidden') {\r\n        this.events.emit('hidden', new HiddenEvent(this));\r\n        this._logger.debug('Window hidden');\r\n      } else if (document.visibilityState === 'visible') {\r\n        this.events.emit('visible', new VisibleEvent(this));\r\n        this._logger.debug('Window visible');\r\n      }\r\n    });\r\n\r\n    if (!this.canvasElementId && !options.canvasElement) {\r\n      document.body.appendChild(this.canvas);\r\n    }\r\n  }\r\n\r\n  public toggleInputEnabled(enabled: boolean) {\r\n    this._inputEnabled = enabled;\r\n    this.input.toggleEnabled(this._inputEnabled);\r\n  }\r\n\r\n  public onInitialize(engine: Engine) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  private async _overrideInitialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      await this.director.onInitialize();\r\n      await this.onInitialize(engine);\r\n      this.events.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the entire state of the game\r\n   * @param elapsed  Number of milliseconds elapsed since the last update.\r\n   */\r\n  private _update(elapsed: number) {\r\n    if (this._isLoading) {\r\n      // suspend updates until loading is finished\r\n      this._loader?.onUpdate(this, elapsed);\r\n      // Update input listeners\r\n      this.input.update();\r\n      return;\r\n    }\r\n\r\n    // Publish preupdate events\r\n    this.clock.__runScheduledCbs('preupdate');\r\n    this._preupdate(elapsed);\r\n\r\n    // process engine level events\r\n    this.currentScene.update(this, elapsed);\r\n\r\n    // Update graphics postprocessors\r\n    this.graphicsContext.updatePostProcessors(elapsed);\r\n\r\n    // Publish update event\r\n    this.clock.__runScheduledCbs('postupdate');\r\n    this._postupdate(elapsed);\r\n\r\n    // Update input listeners\r\n    this.input.update();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _preupdate(elapsed: number) {\r\n    this.emit('preupdate', new PreUpdateEvent(this, elapsed, this));\r\n    this.onPreUpdate(this, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override method\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPreUpdate(engine: Engine, elapsed: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postupdate(elapsed: number) {\r\n    this.emit('postupdate', new PostUpdateEvent(this, elapsed, this));\r\n    this.onPostUpdate(this, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override method\r\n   * @param engine The reference to the current game engine\r\n   * @param elapsed  The time elapsed since the last update in milliseconds\r\n   */\r\n  public onPostUpdate(engine: Engine, elapsed: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Draws the entire game\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  private _draw(elapsed: number) {\r\n    // Use scene background color if present, fallback to engine\r\n    this.graphicsContext.backgroundColor = this.currentScene.backgroundColor ?? this.backgroundColor;\r\n    this.graphicsContext.beginDrawLifecycle();\r\n    this.graphicsContext.clear();\r\n    this.clock.__runScheduledCbs('predraw');\r\n    this._predraw(this.graphicsContext, elapsed);\r\n\r\n    // Drawing nothing else while loading\r\n    if (this._isLoading) {\r\n      if (!this._hideLoader) {\r\n        this._loader?.canvas.draw(this.graphicsContext, 0, 0);\r\n        this.clock.__runScheduledCbs('postdraw');\r\n        this.graphicsContext.flush();\r\n        this.graphicsContext.endDrawLifecycle();\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.currentScene.draw(this.graphicsContext, elapsed);\r\n\r\n    this.clock.__runScheduledCbs('postdraw');\r\n    this._postdraw(this.graphicsContext, elapsed);\r\n\r\n    // Flush any pending drawings\r\n    this.graphicsContext.flush();\r\n    this.graphicsContext.endDrawLifecycle();\r\n\r\n    this._checkForScreenShots();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _predraw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    this.emit('predraw', new PreDrawEvent(ctx, elapsed, this));\r\n    this.onPreDraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override method to hook into pre draw\r\n   * @param ctx {@link ExcaliburGraphicsContext} for drawing\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  public onPreDraw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postdraw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    this.emit('postdraw', new PostDrawEvent(ctx, elapsed, this));\r\n    this.onPostDraw(ctx, elapsed);\r\n  }\r\n\r\n  /**\r\n   * Safe to override method to hook into pre draw\r\n   * @param ctx {@link ExcaliburGraphicsContext} for drawing\r\n   * @param elapsed  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  public onPostDraw(ctx: ExcaliburGraphicsContext, elapsed: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Enable or disable Excalibur debugging functionality.\r\n   * @param toggle a value that debug drawing will be changed to\r\n   */\r\n  public showDebug(toggle: boolean): void {\r\n    this._isDebug = toggle;\r\n  }\r\n\r\n  /**\r\n   * Toggle Excalibur debugging functionality.\r\n   */\r\n  public toggleDebug(): boolean {\r\n    this._isDebug = !this._isDebug;\r\n    return this._isDebug;\r\n  }\r\n\r\n  /**\r\n   * Returns true when loading is totally complete and the player has clicked start\r\n   */\r\n  public get loadingComplete() {\r\n    return !this._isLoading;\r\n  }\r\n\r\n  private _isLoading = false;\r\n  private _hideLoader = false;\r\n  private _isReadyFuture = new Future<void>();\r\n  public get ready() {\r\n    return this._isReadyFuture.isCompleted;\r\n  }\r\n  public isReady(): Promise<void> {\r\n    return this._isReadyFuture.promise;\r\n  }\r\n\r\n  /**\r\n   * Starts the internal game loop for Excalibur after loading\r\n   * any provided assets.\r\n   * @param loader  Optional {@apilink Loader} to use to load resources. The default loader is {@apilink Loader},\r\n   * override to provide your own custom loader.\r\n   *\r\n   * Note: start() only resolves AFTER the user has clicked the play button\r\n   */\r\n  public async start(loader?: DefaultLoader): Promise<void>;\r\n  /**\r\n   * Starts the internal game loop for Excalibur after configuring any routes, loaders, or transitions\r\n   * @param startOptions Optional {@apilink StartOptions} to configure the routes for scenes in Excalibur\r\n   *\r\n   * Note: start() only resolves AFTER the user has clicked the play button\r\n   */\r\n  public async start(sceneName: WithRoot<TKnownScenes>, options?: StartOptions): Promise<void>;\r\n  /**\r\n   * Starts the internal game loop after any loader is finished\r\n   * @param loader\r\n   */\r\n  public async start(loader?: DefaultLoader): Promise<void>;\r\n  public async start(sceneNameOrLoader?: WithRoot<TKnownScenes> | DefaultLoader, options?: StartOptions): Promise<void> {\r\n    await this.scope(async () => {\r\n      if (!this._compatible) {\r\n        throw new Error('Excalibur is incompatible with your browser');\r\n      }\r\n      this._isLoading = true;\r\n      let loader: DefaultLoader;\r\n      if (sceneNameOrLoader instanceof DefaultLoader) {\r\n        loader = sceneNameOrLoader;\r\n      } else if (typeof sceneNameOrLoader === 'string') {\r\n        this.director.configureStart(sceneNameOrLoader, options);\r\n        loader = this.director.mainLoader;\r\n      }\r\n\r\n      // Start the excalibur clock which drives the mainloop\r\n      this._logger.debug('Starting game clock...');\r\n      this.browser.resume();\r\n      this.clock.start();\r\n      if (this.garbageCollectorConfig) {\r\n        this._garbageCollector.start();\r\n      }\r\n      this._logger.debug('Game clock started');\r\n\r\n      await this.load(loader ?? new Loader());\r\n\r\n      // Initialize before ready\r\n      await this._overrideInitialize(this);\r\n\r\n      this._isReadyFuture.resolve();\r\n      this.emit('start', new GameStartEvent(this));\r\n      return this._isReadyFuture.promise;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the current frames elapsed milliseconds\r\n   */\r\n  public currentFrameElapsedMs = 0;\r\n\r\n  /**\r\n   * Returns the current frame lag when in fixed update mode\r\n   */\r\n  public currentFrameLagMs = 0;\r\n\r\n  private _lagMs = 0;\r\n  private _mainloop(elapsed: number) {\r\n    this.scope(() => {\r\n      this.emit('preframe', new PreFrameEvent(this, this.stats.prevFrame));\r\n      const elapsedMs = elapsed * this.timescale;\r\n      this.currentFrameElapsedMs = elapsedMs;\r\n\r\n      // reset frame stats (reuse existing instances)\r\n      const frameId = this.stats.prevFrame.id + 1;\r\n      this.stats.currFrame.reset();\r\n      this.stats.currFrame.id = frameId;\r\n      this.stats.currFrame.elapsedMs = elapsedMs;\r\n      this.stats.currFrame.fps = this.clock.fpsSampler.fps;\r\n      GraphicsDiagnostics.clear();\r\n\r\n      const beforeUpdate = this.clock.now();\r\n      const fixedTimestepMs = this.fixedUpdateTimestep;\r\n      if (this.fixedUpdateTimestep) {\r\n        this._lagMs += elapsedMs;\r\n        while (this._lagMs >= fixedTimestepMs) {\r\n          this._update(fixedTimestepMs);\r\n          this._lagMs -= fixedTimestepMs;\r\n        }\r\n      } else {\r\n        this._update(elapsedMs);\r\n      }\r\n      const afterUpdate = this.clock.now();\r\n      this.currentFrameLagMs = this._lagMs;\r\n      this._draw(elapsedMs);\r\n      const afterDraw = this.clock.now();\r\n\r\n      this.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\r\n      this.stats.currFrame.duration.draw = afterDraw - afterUpdate;\r\n      this.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n      this.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n\r\n      this.emit('postframe', new PostFrameEvent(this, this.stats.currFrame));\r\n      this.stats.prevFrame.reset(this.stats.currFrame);\r\n\r\n      this._monitorPerformanceThresholdAndTriggerFallback();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stops Excalibur's main loop, useful for pausing the game.\r\n   */\r\n  public stop() {\r\n    if (this.clock.isRunning()) {\r\n      this.emit('stop', new GameStopEvent(this));\r\n      this.browser.pause();\r\n      this.clock.stop();\r\n      this._garbageCollector.stop();\r\n      this._logger.debug('Game stopped');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the Engine's running status, Useful for checking whether engine is running or paused.\r\n   */\r\n  public isRunning() {\r\n    return this.clock.isRunning();\r\n  }\r\n\r\n  private _screenShotRequests: { preserveHiDPIResolution: boolean; resolve: (image: HTMLImageElement) => void }[] = [];\r\n  /**\r\n   * Takes a screen shot of the current viewport and returns it as an\r\n   * HTML Image Element.\r\n   * @param preserveHiDPIResolution in the case of HiDPI return the full scaled backing image, by default false\r\n   */\r\n  public screenshot(preserveHiDPIResolution = false): Promise<HTMLImageElement> {\r\n    const screenShotPromise = new Promise<HTMLImageElement>((resolve) => {\r\n      this._screenShotRequests.push({ preserveHiDPIResolution, resolve });\r\n    });\r\n    return screenShotPromise;\r\n  }\r\n\r\n  private _checkForScreenShots() {\r\n    // We must grab the draw buffer before we yield to the browser\r\n    // the draw buffer is cleared after compositing\r\n    // the reason for the asynchrony is setting `preserveDrawingBuffer: true`\r\n    // forces the browser to copy buffers which can have a mass perf impact on mobile\r\n    for (const request of this._screenShotRequests) {\r\n      const finalWidth = request.preserveHiDPIResolution ? this.canvas.width : this.screen.resolution.width;\r\n      const finalHeight = request.preserveHiDPIResolution ? this.canvas.height : this.screen.resolution.height;\r\n      const screenshot = document.createElement('canvas');\r\n      screenshot.width = finalWidth;\r\n      screenshot.height = finalHeight;\r\n      const ctx = screenshot.getContext('2d');\r\n      ctx.imageSmoothingEnabled = this.screen.antialiasing;\r\n      ctx.drawImage(this.canvas, 0, 0, finalWidth, finalHeight);\r\n\r\n      const result = new Image();\r\n      const raw = screenshot.toDataURL('image/png');\r\n      result.onload = () => {\r\n        request.resolve(result);\r\n      };\r\n      result.src = raw;\r\n    }\r\n    // Reset state\r\n    this._screenShotRequests.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Another option available to you to load resources into the game.\r\n   * Immediately after calling this the game will pause and the loading screen\r\n   * will appear.\r\n   * @param loader  Some {@apilink Loadable} such as a {@apilink Loader} collection, {@apilink Sound}, or {@apilink Texture}.\r\n   */\r\n  public async load(loader: DefaultLoader, hideLoader = false): Promise<void> {\r\n    await this.scope(async () => {\r\n      try {\r\n        // early exit if loaded\r\n        if (loader.isLoaded()) {\r\n          return;\r\n        }\r\n        this._loader = loader;\r\n        this._isLoading = true;\r\n        this._hideLoader = hideLoader;\r\n\r\n        if (loader instanceof Loader) {\r\n          loader.suppressPlayButton = loader.suppressPlayButton || this._suppressPlayButton;\r\n        }\r\n        this._loader.onInitialize(this);\r\n\r\n        await loader.load();\r\n      } catch (e) {\r\n        this._logger.error('Error loading resources, things may not behave properly', e);\r\n        await Promise.resolve();\r\n      } finally {\r\n        this._isLoading = false;\r\n        this._hideLoader = false;\r\n        this._loader = null;\r\n      }\r\n    });\r\n  }\r\n}\r\n","/**\r\n * An enum that represents the types of emitter nozzles\r\n */\r\nexport enum EmitterType {\r\n  /**\r\n   * Constant for the circular emitter type\r\n   */\r\n  Circle = 'circle',\r\n  /**\r\n   * Constant for the rectangular emitter type\r\n   */\r\n  Rectangle = 'rectangle'\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { vec, Vector } from './Math/vector';\r\nimport { Text } from './Graphics/Text';\r\nimport { GraphicsComponent, SpriteFont } from './Graphics';\r\nimport { Font } from './Graphics/Font';\r\nimport { Actor } from './Actor';\r\nimport { ActorArgs } from './Actor';\r\n\r\n/**\r\n * Option for creating a label\r\n */\r\nexport interface LabelOptions {\r\n  /**\r\n   * Specify the label text\r\n   */\r\n  text?: string;\r\n\r\n  /**\r\n   * Specify a max width for the text in pixels, if specified the text will wrap.\r\n   *\r\n   * **Not supported in SpriteFont**\r\n   */\r\n  maxWidth?: number;\r\n  /**\r\n   * Specify the color of the text (does not apply to SpriteFonts)\r\n   */\r\n  color?: Color;\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally specify a sprite font, will take precedence over any other {@apilink Font}\r\n   */\r\n  spriteFont?: SpriteFont;\r\n  /**\r\n   * Specify a custom font\r\n   */\r\n  font?: Font;\r\n}\r\n\r\n/**\r\n * Labels are the way to draw small amounts of text to the screen. They are\r\n * actors and inherit all of the benefits and capabilities.\r\n */\r\nexport class Label extends Actor {\r\n  private _font: Font = new Font();\r\n  private _text: Text = new Text({ text: '', font: this._font });\r\n\r\n  public set maxWidth(width: number | undefined) {\r\n    this._text.maxWidth = width;\r\n  }\r\n\r\n  public get maxWidth(): number | undefined {\r\n    return this._text.maxWidth;\r\n  }\r\n\r\n  public get font(): Font {\r\n    return this._font;\r\n  }\r\n\r\n  public set font(newFont: Font) {\r\n    this._font = newFont;\r\n    this._text.font = newFont;\r\n  }\r\n\r\n  /**\r\n   * The text to draw.\r\n   */\r\n  public get text(): string {\r\n    return this._text.text;\r\n  }\r\n\r\n  public set text(text: string) {\r\n    this._text.text = text;\r\n  }\r\n\r\n  public override get color(): Color {\r\n    return this._text.color;\r\n  }\r\n\r\n  public override set color(color: Color) {\r\n    if (this._text) {\r\n      this._text.color = color;\r\n    }\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this.graphics.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this.graphics.opacity = opacity;\r\n  }\r\n\r\n  private _spriteFont: SpriteFont;\r\n  /**\r\n   * The {@apilink SpriteFont} to use, if any. Overrides {@apilink Font | `font`} if present.\r\n   */\r\n  public get spriteFont(): SpriteFont {\r\n    return this._spriteFont;\r\n  }\r\n\r\n  public set spriteFont(sf: SpriteFont) {\r\n    if (sf) {\r\n      this._spriteFont = sf;\r\n      this._text.font = this._spriteFont;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Build a new label\r\n   * @param options\r\n   */\r\n  constructor(options?: LabelOptions & ActorArgs) {\r\n    super(options);\r\n    const { text, pos, x, y, spriteFont, font, color, maxWidth } = { text: '', ...options };\r\n\r\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\r\n    this.text = text ?? this.text;\r\n    this.font = font ?? this.font;\r\n    this.maxWidth = maxWidth ?? this.maxWidth;\r\n    this.spriteFont = spriteFont ?? this.spriteFont;\r\n    this._text.color = color ?? this.color;\r\n    const gfx = this.get(GraphicsComponent);\r\n    gfx.anchor = Vector.Zero;\r\n    gfx.use(this._text);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the text in the label (in pixels);\r\n   */\r\n  public getTextWidth(): number {\r\n    return this._text.width;\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Actor } from '../Actor';\r\nimport { vec } from '../Math/vector';\r\nimport { Random } from '../Math/Random';\r\nimport { CollisionType } from '../Collision/CollisionType';\r\nimport { randomInRange } from '../Math/util';\r\nimport { EmitterType } from './EmitterType';\r\nimport { Particle, ParticleTransform, ParticleEmitterArgs, ParticleConfig } from './Particles';\r\nimport { RentalPool } from '../Util/RentalPool';\r\n\r\n/**\r\n * Using a particle emitter is a great way to create interesting effects\r\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\r\n * extend {@apilink Actor} allowing you to use all of the features that come with.\r\n *\r\n * These particles are simulated on the CPU in JavaScript\r\n */\r\nexport class ParticleEmitter extends Actor {\r\n  private _particlesToEmit: number = 0;\r\n\r\n  private _particlePool = new RentalPool(\r\n    () => new Particle({}),\r\n    (p) => p,\r\n    500\r\n  );\r\n\r\n  public numParticles: number = 0;\r\n\r\n  /**\r\n   * Random number generator\r\n   */\r\n  public random: Random;\r\n\r\n  /**\r\n   * Gets or sets the isEmitting flag\r\n   */\r\n  public isEmitting: boolean = true;\r\n\r\n  /**\r\n   * Gets or sets the backing deadParticle collection\r\n   */\r\n  public deadParticles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the emission rate for particles (particles/sec)\r\n   */\r\n  public emitRate: number = 1; //particles/sec\r\n\r\n  /**\r\n   * Gets or sets the emitter type for the particle emitter\r\n   */\r\n  public emitterType: EmitterType = EmitterType.Rectangle;\r\n\r\n  /**\r\n   * Gets or sets the emitter radius, only takes effect when the {@apilink emitterType} is {@apilink EmitterType.Circle}\r\n   */\r\n  public radius: number = 0;\r\n\r\n  public particle: ParticleConfig = {\r\n    /**\r\n     * Gets or sets the life of each particle in milliseconds\r\n     */\r\n    life: 2000,\r\n    transform: ParticleTransform.Global,\r\n    graphic: undefined,\r\n    opacity: 1,\r\n    angularVelocity: 0,\r\n    focus: undefined,\r\n    focusAccel: undefined,\r\n    randomRotation: false\r\n  };\r\n\r\n  /**\r\n   * @param config particle emitter options bag\r\n   */\r\n  constructor(config: ParticleEmitterArgs) {\r\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\r\n\r\n    const { particle, x, y, z, pos, isEmitting, emitRate, emitterType, radius, random } = { ...config };\r\n\r\n    this.particle = { ...this.particle, ...particle };\r\n\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.z = z ?? 0;\r\n    this.isEmitting = isEmitting ?? this.isEmitting;\r\n    this.emitRate = emitRate ?? this.emitRate;\r\n    this.emitterType = emitterType ?? this.emitterType;\r\n    this.radius = radius ?? this.radius;\r\n\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n\r\n    this.random = random ?? new Random();\r\n  }\r\n\r\n  public removeParticle(particle: Particle) {\r\n    this.deadParticles.push(particle);\r\n  }\r\n\r\n  private _activeParticles: Particle[] = [];\r\n\r\n  /**\r\n   * Causes the emitter to emit particles\r\n   * @param particleCount  Number of particles to emit right now\r\n   */\r\n  public emitParticles(particleCount: number) {\r\n    if (particleCount <= 0) {\r\n      return;\r\n    }\r\n    particleCount = particleCount | 0; // coerce to int\r\n    for (let i = 0; i < particleCount; i++) {\r\n      const p = this._createParticle();\r\n      if (this?.scene?.world) {\r\n        if (this.particle.transform === ParticleTransform.Global) {\r\n          this.scene.world.add(p);\r\n        } else {\r\n          this.addChild(p);\r\n        }\r\n      }\r\n      this._activeParticles.push(p);\r\n    }\r\n  }\r\n\r\n  public clearParticles() {\r\n    for (let i = 0; i < this._activeParticles.length; i++) {\r\n      this.removeParticle(this._activeParticles[i]);\r\n    }\r\n  }\r\n\r\n  // Creates a new particle given the constraints of the emitter\r\n  private _createParticle(): Particle {\r\n    let ranX = 0;\r\n    let ranY = 0;\r\n\r\n    const angle = randomInRange(this.particle.minAngle || 0, this.particle.maxAngle || Math.PI * 2, this.random);\r\n    const vel = randomInRange(this.particle.minSpeed || 0, this.particle.maxSpeed || 0, this.random);\r\n    const size = this.particle.startSize || randomInRange(this.particle.minSize || 5, this.particle.maxSize || 5, this.random);\r\n    const dx = vel * Math.cos(angle);\r\n    const dy = vel * Math.sin(angle);\r\n\r\n    if (this.emitterType === EmitterType.Rectangle) {\r\n      ranX = randomInRange(0, this.width, this.random);\r\n      ranY = randomInRange(0, this.height, this.random);\r\n    } else if (this.emitterType === EmitterType.Circle) {\r\n      const radius = randomInRange(0, this.radius, this.random);\r\n      ranX = radius * Math.cos(angle);\r\n      ranY = radius * Math.sin(angle);\r\n    }\r\n\r\n    const p = this._particlePool.rent();\r\n    p.configure({\r\n      life: this.particle.life,\r\n      opacity: this.particle.opacity,\r\n      beginColor: this.particle.beginColor,\r\n      endColor: this.particle.endColor,\r\n      pos: vec(ranX, ranY),\r\n      vel: vec(dx, dy),\r\n      acc: this.particle.acc,\r\n      angularVelocity: this.particle.angularVelocity,\r\n      startSize: this.particle.startSize,\r\n      endSize: this.particle.endSize,\r\n      size: size,\r\n      graphic: this.particle.graphic,\r\n      fade: this.particle.fade\r\n    });\r\n    p.registerEmitter(this);\r\n    if (this.particle.randomRotation) {\r\n      p.transform.rotation = randomInRange(0, Math.PI * 2, this.random);\r\n    }\r\n    if (this.particle.focus) {\r\n      p.focus = this.particle.focus.add(vec(this.pos.x, this.pos.y));\r\n      p.focusAccel = this.particle.focusAccel;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public update(engine: Engine, elapsed: number) {\r\n    super.update(engine, elapsed);\r\n\r\n    if (this.isEmitting) {\r\n      this._particlesToEmit += this.emitRate * (elapsed / 1000);\r\n      if (this._particlesToEmit > 1.0) {\r\n        this.emitParticles(Math.floor(this._particlesToEmit));\r\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\r\n      }\r\n    }\r\n\r\n    // deferred removal\r\n    for (let i = 0; i < this.deadParticles.length; i++) {\r\n      if (this?.scene?.world) {\r\n        this.scene.world.remove(this.deadParticles[i], false);\r\n        this._particlePool.return(this.deadParticles[i]);\r\n      }\r\n      const index = this._activeParticles.indexOf(this.deadParticles[i]);\r\n      if (index > -1) {\r\n        this._activeParticles.splice(index, 1);\r\n      }\r\n    }\r\n    this.deadParticles.length = 0;\r\n  }\r\n}\r\n","/**\r\n * Asserts will throw in `process.env.NODE_ENV === 'development'` builds if the expression evaluates false\r\n */\r\nexport function assert(message: string, expression: () => boolean) {\r\n  if (process.env.NODE_ENV === 'development') {\r\n    if (!expression()) {\r\n      throw new Error(message);\r\n    }\r\n  }\r\n}\r\n","import { randomInRange, TwoPI } from '../Math/util';\r\nimport { ExcaliburGraphicsContextWebGL } from '../Graphics/Context/ExcaliburGraphicsContextWebGL';\r\nimport { GpuParticleEmitter } from './GpuParticleEmitter';\r\nimport { ParticleConfig, ParticleTransform } from './Particles';\r\nimport { Random } from '../Math/Random';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { EmitterType } from './EmitterType';\r\nimport { assert } from '../Util/Assert';\r\nimport { vec } from '../Math/vector';\r\n\r\nexport interface GpuParticleConfig extends ParticleConfig {\r\n  /**\r\n   * Only Sprite graphics are supported in GPU particles at the moment\r\n   */\r\n  graphic?: Sprite;\r\n  /**\r\n   * Set the maximum particles to use for this emitter\r\n   */\r\n  maxParticles?: number;\r\n}\r\n\r\n/**\r\n * Container for the GPU Particle State contains the internal state needed for the GPU\r\n * to render particles and maintain state.\r\n */\r\nexport class GpuParticleRenderer {\r\n  static readonly GPU_MAX_PARTICLES: number = 100_000;\r\n  emitter: GpuParticleEmitter;\r\n  emitRate: number = 1;\r\n  particle: GpuParticleConfig;\r\n\r\n  private _initialized: boolean = false;\r\n  private _vaos: WebGLVertexArrayObject[] = [];\r\n  private _buffers: WebGLBuffer[] = [];\r\n  private _random: Random;\r\n\r\n  private _drawIndex = 0;\r\n  private _currentVao!: WebGLVertexArrayObject;\r\n  private _currentBuffer!: WebGLBuffer;\r\n\r\n  private _numInputFloats = 2 + 2 + 1 + 1 + 1;\r\n  private _particleData: Float32Array;\r\n  private _particleIndex = 0;\r\n  private _uploadIndex: number = 0;\r\n\r\n  private _wrappedLife = 0;\r\n  private _wrappedParticles = 0;\r\n  private _particleLife = 0;\r\n\r\n  constructor(emitter: GpuParticleEmitter, random: Random, options: GpuParticleConfig) {\r\n    this.emitter = emitter;\r\n    this.particle = options;\r\n    this._particleData = new Float32Array(this.emitter.maxParticles * this._numInputFloats);\r\n    this._random = random;\r\n    this._particleLife = this.particle.life ?? 2000;\r\n  }\r\n\r\n  public get isInitialized() {\r\n    return this._initialized;\r\n  }\r\n\r\n  public get maxParticles(): number {\r\n    return this.emitter.maxParticles;\r\n  }\r\n\r\n  initialize(gl: WebGL2RenderingContext, context: ExcaliburGraphicsContextWebGL) {\r\n    if (this._initialized) {\r\n      return;\r\n    }\r\n\r\n    const numParticles = this.emitter.maxParticles;\r\n    const numInputFloats = this._numInputFloats;\r\n    const particleData = this._particleData;\r\n    const bytesPerFloat = 4;\r\n\r\n    const particleDataBuffer1 = gl.createBuffer()!;\r\n    const vao1 = gl.createVertexArray()!;\r\n    gl.bindVertexArray(vao1);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, particleDataBuffer1);\r\n    gl.bufferData(gl.ARRAY_BUFFER, numParticles * numInputFloats * bytesPerFloat, gl.DYNAMIC_DRAW);\r\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, particleData);\r\n    let offset = 0;\r\n    // position\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, 0);\r\n    offset += bytesPerFloat * 2;\r\n    // velocity\r\n    gl.vertexAttribPointer(1, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 2;\r\n    // rotation\r\n    gl.vertexAttribPointer(2, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n    // angularVelocity\r\n    gl.vertexAttribPointer(3, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n    // life\r\n    gl.vertexAttribPointer(4, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n\r\n    // enable attributes\r\n    gl.enableVertexAttribArray(0);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.enableVertexAttribArray(2);\r\n    gl.enableVertexAttribArray(3);\r\n    gl.enableVertexAttribArray(4);\r\n\r\n    this._vaos.push(vao1);\r\n    this._buffers.push(particleDataBuffer1);\r\n    // Clean up\r\n    gl.bindVertexArray(null);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n    const particleDataBuffer2 = gl.createBuffer()!;\r\n    const vao2 = gl.createVertexArray()!;\r\n    gl.bindVertexArray(vao2);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, particleDataBuffer2);\r\n    gl.bufferData(gl.ARRAY_BUFFER, numParticles * numInputFloats * bytesPerFloat, gl.DYNAMIC_DRAW);\r\n    offset = 0;\r\n    // position\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, 0);\r\n    offset += bytesPerFloat * 2;\r\n    // velocity\r\n    gl.vertexAttribPointer(1, 2, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 2;\r\n    // rotation\r\n    gl.vertexAttribPointer(2, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n    // angularVelocity\r\n    gl.vertexAttribPointer(3, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n    // life\r\n    gl.vertexAttribPointer(4, 1, gl.FLOAT, false, numInputFloats * bytesPerFloat, offset);\r\n    offset += bytesPerFloat * 1;\r\n\r\n    // enable attributes\r\n    gl.enableVertexAttribArray(0);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.enableVertexAttribArray(2);\r\n    gl.enableVertexAttribArray(3);\r\n    gl.enableVertexAttribArray(4);\r\n\r\n    this._vaos.push(vao2);\r\n    this._buffers.push(particleDataBuffer2);\r\n\r\n    // Clean up\r\n    gl.bindVertexArray(null);\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n    this._currentVao = this._vaos[this._drawIndex % 2];\r\n    this._currentBuffer = this._buffers[(this._drawIndex + 1) % 2];\r\n\r\n    this._initialized = true;\r\n  }\r\n\r\n  private _clearRequested = false;\r\n  clearParticles() {\r\n    this._particleData.fill(0);\r\n    this._clearRequested = true;\r\n  }\r\n\r\n  private _emitted: [life: number, index: number][] = [];\r\n  emitParticles(particleCount: number) {\r\n    const startIndex = this._particleIndex;\r\n    const maxSize = this.maxParticles * this._numInputFloats;\r\n    const endIndex = particleCount * this._numInputFloats + startIndex;\r\n    let countParticle = 0;\r\n    for (let i = startIndex; i < endIndex; i += this._numInputFloats) {\r\n      const angle = this._random.floating(this.particle.minAngle || 0, this.particle.maxAngle || TwoPI);\r\n      const speedX = this._random.floating(this.particle.minSpeed || 0, this.particle.maxSpeed || 0);\r\n      const speedY = this._random.floating(this.particle.minSpeed || 0, this.particle.maxSpeed || 0);\r\n      const dx = speedX * Math.cos(angle);\r\n      const dy = speedY * Math.sin(angle);\r\n      let ranX: number = 0;\r\n      let ranY: number = 0;\r\n      if (this.emitter.emitterType === EmitterType.Rectangle) {\r\n        ranX = this._random.floating(-0.5, 0.5) * this.emitter.width;\r\n        ranY = this._random.floating(-0.5, 0.5) * this.emitter.height;\r\n      } else {\r\n        const radius = this._random.floating(0, this.emitter.radius);\r\n        ranX = radius * Math.cos(angle);\r\n        ranY = radius * Math.sin(angle);\r\n      }\r\n      const tx = this.emitter.transform.apply(vec(ranX, ranY));\r\n      const data = [\r\n        this.particle.transform === ParticleTransform.Local ? ranX : tx.x,\r\n        this.particle.transform === ParticleTransform.Local ? ranY : tx.y, // pos in world space\r\n        dx,\r\n        dy, // velocity\r\n        this.particle.randomRotation ? randomInRange(0, TwoPI, this._random) : this.particle.rotation || 0, // rotation\r\n        this.particle.angularVelocity || 0, // angular velocity\r\n        this._particleLife // life\r\n      ];\r\n\r\n      countParticle++;\r\n      this._particleData.set(data, i % this._particleData.length);\r\n    }\r\n\r\n    if (endIndex >= maxSize) {\r\n      this._wrappedParticles += (endIndex - maxSize) / this._numInputFloats;\r\n      this._wrappedLife = this._particleLife;\r\n    } else if (this._wrappedLife > 0) {\r\n      this._wrappedParticles += particleCount;\r\n    }\r\n\r\n    this._particleIndex = endIndex % maxSize;\r\n    this._emitted.push([this._particleLife, startIndex]);\r\n  }\r\n\r\n  private _uploadEmitted(gl: WebGL2RenderingContext) {\r\n    // upload index is the index of the previous upload\r\n    // particle index is the current index of modification\r\n    if (this._particleIndex !== this._uploadIndex) {\r\n      // Bind one buffer to ARRAY_BUFFER and the other to TFB\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, this._buffers[(this._drawIndex + 1) % 2]);\r\n      if (this._particleIndex >= this._uploadIndex) {\r\n        gl.bufferSubData(\r\n          gl.ARRAY_BUFFER,\r\n          this._uploadIndex * 4, // dst byte offset 4 bytes per float\r\n          this._particleData,\r\n          this._uploadIndex,\r\n          this._particleIndex - this._uploadIndex\r\n        );\r\n      } else {\r\n        // upload before the wrap\r\n        // prettier-ignore\r\n        gl.bufferSubData(\r\n          gl.ARRAY_BUFFER,\r\n          this._uploadIndex * 4,\r\n          this._particleData,\r\n          this._uploadIndex,\r\n          this._particleData.length - this._uploadIndex\r\n        );\r\n        // upload after the wrap if there are any\r\n        if (this._wrappedParticles) {\r\n          // prettier-ignore\r\n          gl.bufferSubData(\r\n            gl.ARRAY_BUFFER,\r\n            0,\r\n            this._particleData,\r\n            0,\r\n            this._wrappedParticles * this._numInputFloats\r\n          );\r\n        }\r\n        this._wrappedLife = this._particleLife;\r\n      }\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n    }\r\n    this._uploadIndex = this._particleIndex % (this.maxParticles * this._numInputFloats);\r\n  }\r\n\r\n  update(elapsed: number) {\r\n    this._particleLife = this.particle.life ?? this._particleLife;\r\n    if (this._wrappedLife > 0) {\r\n      this._wrappedLife -= elapsed;\r\n    } else {\r\n      this._wrappedLife = 0;\r\n      this._wrappedParticles = 0;\r\n    }\r\n    if (!this._emitted.length) {\r\n      return;\r\n    }\r\n    for (let i = this._emitted.length - 1; i >= 0; i--) {\r\n      const particle = this._emitted[i];\r\n      particle[0] -= elapsed;\r\n      const life = particle[0];\r\n      if (life <= 0) {\r\n        this._emitted.splice(i, 1);\r\n      }\r\n    }\r\n\r\n    this._emitted.sort((a, b) => a[0] - b[0]);\r\n  }\r\n\r\n  draw(gl: WebGL2RenderingContext) {\r\n    if (this._initialized) {\r\n      // Emit\r\n      if (this._clearRequested) {\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._buffers[(this._drawIndex + 1) % 2]);\r\n        gl.bufferSubData(gl.ARRAY_BUFFER, 0, this._particleData);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n        this._clearRequested = false;\r\n      } else {\r\n        this._uploadEmitted(gl);\r\n      }\r\n\r\n      // Bind one buffer to ARRAY_BUFFER and the other to transform feedback buffer\r\n      gl.bindVertexArray(this._currentVao);\r\n      gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer);\r\n\r\n      // Perform transform feedback (run the simulation) and the draw call all at once\r\n      if (this._wrappedLife && this._emitted[0] && this._emitted[0][1] > 0) {\r\n        const midpoint = this._emitted[0][1] / this._numInputFloats;\r\n        // draw oldest first (maybe make configurable)\r\n        assert(`midpoint greater than 0, actual: ${midpoint}`, () => midpoint > 0);\r\n        assert(`midpoint is less than max, actual: ${midpoint}`, () => midpoint < this.maxParticles);\r\n        gl.bindBufferRange(\r\n          gl.TRANSFORM_FEEDBACK_BUFFER,\r\n          0,\r\n          this._currentBuffer,\r\n          this._emitted[0][1] * 4,\r\n          (this.maxParticles - midpoint) * this._numInputFloats * 4\r\n        );\r\n        gl.beginTransformFeedback(gl.POINTS);\r\n        gl.drawArrays(gl.POINTS, midpoint, this.maxParticles - midpoint);\r\n        gl.endTransformFeedback();\r\n\r\n        // then draw newer particles\r\n        gl.bindBufferRange(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer, 0, this._emitted[0][1] * 4);\r\n        gl.beginTransformFeedback(gl.POINTS);\r\n        gl.drawArrays(gl.POINTS, 0, midpoint);\r\n        gl.endTransformFeedback();\r\n      } else {\r\n        gl.bindBufferRange(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this._currentBuffer, 0, this._particleData.length * 4);\r\n        gl.beginTransformFeedback(gl.POINTS);\r\n        gl.drawArrays(gl.POINTS, 0, this.maxParticles);\r\n        gl.endTransformFeedback();\r\n      }\r\n\r\n      // Clean up after ourselves to avoid errors.\r\n      gl.bindVertexArray(null);\r\n      gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, null);\r\n\r\n      // flip flop buffers, one will be draw the other simulation\r\n      this._currentVao = this._vaos[this._drawIndex % 2];\r\n      this._currentBuffer = this._buffers[(this._drawIndex + 1) % 2];\r\n      this._drawIndex = (this._drawIndex + 1) % 2;\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Actor } from '../Actor';\r\nimport { EmitterType } from './EmitterType';\r\nimport { ParticleEmitterArgs, ParticleTransform } from './Particles';\r\nimport { GpuParticleConfig, GpuParticleRenderer } from './GpuParticleRenderer';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Random } from '../Math/Random';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { clamp } from '../Math';\r\nimport { ExcaliburGraphicsContextWebGL } from '../Graphics/Context/ExcaliburGraphicsContextWebGL';\r\nimport { ParticleRenderer } from '../Graphics/Context/particle-renderer/particle-renderer';\r\n\r\nexport class GpuParticleEmitter extends Actor {\r\n  public particle: GpuParticleConfig = {\r\n    /**\r\n     * Gets or sets the life of each particle in milliseconds\r\n     */\r\n    life: 2000,\r\n    transform: ParticleTransform.Global,\r\n    graphic: undefined,\r\n    opacity: 1,\r\n    angularVelocity: 0,\r\n    focus: undefined,\r\n    focusAccel: undefined,\r\n    randomRotation: false\r\n  };\r\n\r\n  public graphics = new GraphicsComponent();\r\n  public renderer: GpuParticleRenderer;\r\n  public isEmitting: boolean = false;\r\n  public emitRate: number = 1;\r\n  public emitterType: EmitterType = EmitterType.Rectangle;\r\n  public radius: number = 0;\r\n  public readonly maxParticles: number = 2000;\r\n  random: Random;\r\n\r\n  public get pos() {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  public set pos(pos: Vector) {\r\n    this.transform.pos = pos;\r\n  }\r\n\r\n  public get z() {\r\n    return this.transform.z;\r\n  }\r\n\r\n  public set z(z: number) {\r\n    this.transform.z = z;\r\n  }\r\n\r\n  constructor(config: ParticleEmitterArgs & { maxParticles?: number; particle?: GpuParticleConfig }) {\r\n    super({ name: `GpuParticleEmitter`, width: config.width, height: config.height }); // somewhat goofy way of doing width/height\r\n    this.addComponent(this.graphics, true);\r\n    (this.graphics.onPostDraw as any) = this.draw.bind(this);\r\n\r\n    const { particle, maxParticles, x, y, z, pos, isEmitting, emitRate, emitterType, radius, random } = { ...config };\r\n\r\n    this.maxParticles = clamp(maxParticles ?? this.maxParticles, 0, GpuParticleRenderer.GPU_MAX_PARTICLES);\r\n\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n\r\n    this.z = z ?? 0;\r\n\r\n    this.isEmitting = isEmitting ?? this.isEmitting;\r\n\r\n    this.emitRate = emitRate ?? this.emitRate;\r\n\r\n    this.emitterType = emitterType ?? this.emitterType;\r\n\r\n    this.radius = radius ?? this.radius;\r\n\r\n    this.particle = { ...this.particle, ...particle };\r\n\r\n    this.random = random ?? new Random();\r\n\r\n    this.renderer = new GpuParticleRenderer(this, this.random, this.particle);\r\n  }\r\n\r\n  public _initialize(engine: Engine): void {\r\n    super._initialize(engine);\r\n    const context = engine.graphicsContext as ExcaliburGraphicsContextWebGL;\r\n    this.renderer.initialize(context.__gl, context);\r\n  }\r\n\r\n  private _particlesToEmit = 0;\r\n  public update(engine: Engine, elapsed: number): void {\r\n    super.update(engine, elapsed);\r\n\r\n    if (this.isEmitting) {\r\n      this._particlesToEmit += this.emitRate * (elapsed / 1000);\r\n      if (this._particlesToEmit > 1.0) {\r\n        this.emitParticles(Math.floor(this._particlesToEmit));\r\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\r\n      }\r\n    }\r\n    this.renderer.update(elapsed);\r\n  }\r\n\r\n  public emitParticles(particleCount: number) {\r\n    if (particleCount <= 0) {\r\n      return;\r\n    }\r\n    this.renderer.emitParticles(particleCount | 0); // coerce to integer\r\n  }\r\n\r\n  public clearParticles() {\r\n    this.renderer.clearParticles();\r\n  }\r\n\r\n  draw(ctx: ExcaliburGraphicsContextWebGL, elapsed: number) {\r\n    ctx.draw<ParticleRenderer>('ex.particle', this.renderer, elapsed);\r\n  }\r\n}\r\n","import { BodyComponent } from '../Collision/BodyComponent';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { Collider } from '../Collision/Colliders/Collider';\r\nimport { CollisionType } from '../Collision/CollisionType';\r\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity, EntityEvents } from '../EntityComponentSystem/Entity';\r\nimport { DebugGraphicsComponent, ExcaliburGraphicsContext, Graphic, GraphicsComponent } from '../Graphics';\r\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\r\nimport { DebugConfig } from '../Debug';\r\nimport { PointerComponent } from '../Input/PointerComponent';\r\nimport { PointerEvent } from '../Input/PointerEvent';\r\nimport { EventEmitter } from '../EventEmitter';\r\nimport { HasNestedPointerEvents, PointerEventsToObjectDispatcher } from '../Input/PointerEventsToObjectDispatcher';\r\nimport { PointerEventReceiver } from '../Input/PointerEventReceiver';\r\n\r\nexport type IsometricTilePointerEvents = {\r\n  pointerup: PointerEvent;\r\n  pointerdown: PointerEvent;\r\n  pointermove: PointerEvent;\r\n  pointercancel: PointerEvent;\r\n  pointerenter: PointerEvent;\r\n  pointerleave: PointerEvent;\r\n};\r\n\r\nexport class IsometricTile extends Entity {\r\n  /**\r\n   * Indicates whether this tile is solid\r\n   */\r\n  public solid: boolean = false;\r\n\r\n  public events = new EventEmitter<EntityEvents & IsometricTilePointerEvents>();\r\n\r\n  private _gfx: GraphicsComponent;\r\n  private _tileBounds = new BoundingBox();\r\n  private _graphics: Graphic[] = [];\r\n  public getGraphics(): readonly Graphic[] {\r\n    return this._graphics;\r\n  }\r\n  /**\r\n   * Tile graphics\r\n   */\r\n  public addGraphic(graphic: Graphic, options?: { offset?: Vector }) {\r\n    this._graphics.push(graphic);\r\n    this._gfx.isVisible = this.map.isVisible;\r\n    this._gfx.opacity = this.map.opacity;\r\n    if (options?.offset) {\r\n      this._gfx.offset = options.offset;\r\n    }\r\n    // TODO detect when this changes on the map and apply to all tiles\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  private _recalculateBounds(): BoundingBox {\r\n    let bounds = this._tileBounds.clone();\r\n    for (const graphic of this._graphics) {\r\n      const offset = vec(\r\n        this.map.graphicsOffset.x - this.map.tileWidth / 2,\r\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : graphic.height - this.map.tileHeight)\r\n      );\r\n      bounds = bounds.combine(graphic.localBounds.translate(offset));\r\n    }\r\n    return bounds;\r\n  }\r\n\r\n  public removeGraphic(graphic: Graphic) {\r\n    const index = this._graphics.indexOf(graphic);\r\n    if (index > -1) {\r\n      this._graphics.splice(index, 1);\r\n    }\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  public clearGraphics() {\r\n    this._graphics.length = 0;\r\n    this._gfx.isVisible = false;\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  /**\r\n   * Tile colliders\r\n   */\r\n  private _colliders: Collider[] = [];\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Adds a collider to the IsometricTile\r\n   *\r\n   * **Note!** the {@apilink Tile.solid} must be set to true for it to act as a \"fixed\" collider\r\n   * @param collider\r\n   */\r\n  public addCollider(collider: Collider) {\r\n    this._colliders.push(collider);\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Removes a collider from the IsometricTile\r\n   * @param collider\r\n   */\r\n  public removeCollider(collider: Collider) {\r\n    const index = this._colliders.indexOf(collider);\r\n    if (index > -1) {\r\n      this._colliders.splice(index, 1);\r\n    }\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Clears all colliders from the IsometricTile\r\n   */\r\n  public clearColliders(): void {\r\n    this._colliders.length = 0;\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Integer tile x coordinate\r\n   */\r\n  public readonly x: number;\r\n  /**\r\n   * Integer tile y coordinate\r\n   */\r\n  public readonly y: number;\r\n  /**\r\n   * Reference to the {@apilink IsometricMap} this tile is part of\r\n   */\r\n  public readonly map: IsometricMap;\r\n\r\n  private _transform: TransformComponent;\r\n  private _isometricEntityComponent: IsometricEntityComponent;\r\n\r\n  /**\r\n   * Returns the top left corner of the {@apilink IsometricTile} in world space\r\n   */\r\n  public get pos(): Vector {\r\n    return this.map.tileToWorld(vec(this.x, this.y));\r\n  }\r\n\r\n  /**\r\n   * Returns the center of the {@apilink IsometricTile}\r\n   */\r\n  public get center(): Vector {\r\n    return this.pos.add(vec(0, this.map.tileHeight / 2));\r\n  }\r\n\r\n  /**\r\n   * Arbitrary data storage per tile, useful for any game specific data\r\n   */\r\n  public data = new Map<string, any>();\r\n\r\n  /**\r\n   * Construct a new IsometricTile\r\n   * @param x tile coordinate in x (not world position)\r\n   * @param y tile coordinate in y (not world position)\r\n   * @param graphicsOffset offset that tile should be shifted by (default (0, 0))\r\n   * @param map reference to owning IsometricMap\r\n   */\r\n  constructor(x: number, y: number, graphicsOffset: Vector | null, map: IsometricMap) {\r\n    super([\r\n      new TransformComponent(),\r\n      new GraphicsComponent({\r\n        offset: graphicsOffset ?? Vector.Zero,\r\n        onPostDraw: (gfx, elapsed) => this.draw(gfx, elapsed)\r\n      }),\r\n      new IsometricEntityComponent(map)\r\n    ]);\r\n    this.x = x;\r\n    this.y = y;\r\n    this.map = map;\r\n    this._transform = this.get(TransformComponent);\r\n    this._isometricEntityComponent = this.get(IsometricEntityComponent);\r\n\r\n    const halfTileWidth = this.map.tileWidth / 2;\r\n    const halfTileHeight = this.map.tileHeight / 2;\r\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\r\n    // The x position shifts left with every y step\r\n    const xPos = (this.x - this.y) * halfTileWidth;\r\n    // The y position needs to go down with every x step\r\n    const yPos = (this.x + this.y) * halfTileHeight;\r\n    this._transform.pos = vec(xPos, yPos);\r\n    this._isometricEntityComponent.elevation = map.elevation;\r\n\r\n    this._gfx = this.get(GraphicsComponent);\r\n    this._gfx.isVisible = false; // start not visible\r\n    const totalWidth = this.map.tileWidth;\r\n    const totalHeight = this.map.tileHeight;\r\n\r\n    // initial guess at gfx bounds based on the tile\r\n    const offset = vec(0, this.map.renderFromTopOfGraphic ? totalHeight : 0);\r\n    this._gfx.localBounds = this._tileBounds = new BoundingBox({\r\n      left: -totalWidth / 2,\r\n      top: -totalHeight,\r\n      right: totalWidth / 2,\r\n      bottom: totalHeight\r\n    }).translate(offset);\r\n  }\r\n\r\n  draw(gfx: ExcaliburGraphicsContext, _elapsed: number) {\r\n    const halfTileWidth = this.map.tileWidth / 2;\r\n    gfx.save();\r\n    // shift left origin to corner of map, not the left corner of the first sprite\r\n    gfx.translate(-halfTileWidth, 0);\r\n    for (const graphic of this._graphics) {\r\n      graphic.draw(\r\n        gfx,\r\n        this.map.graphicsOffset.x,\r\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : graphic.height - this.map.tileHeight)\r\n      );\r\n    }\r\n    gfx.restore();\r\n  }\r\n}\r\n\r\nexport interface IsometricMapOptions {\r\n  /**\r\n   * Optionally name the isometric tile map\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally specify the position of the isometric tile map\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\r\n   */\r\n  renderFromTopOfGraphic?: boolean;\r\n  /**\r\n   * Optionally present a graphics offset, this can be useful depending on your tile graphics\r\n   */\r\n  graphicsOffset?: Vector;\r\n  /**\r\n   * Width of an individual tile in pixels, this should be the width of the parallelogram of the base of the tile art asset.\r\n   */\r\n  tileWidth: number;\r\n  /**\r\n   * Height of an individual tile in pixels, this should be the height of the parallelogram of the base of the tile art asset.\r\n   */\r\n  tileHeight: number;\r\n  /**\r\n   * The number of tile columns, or the number of tiles wide\r\n   */\r\n  columns: number;\r\n  /**\r\n   * The number of tile  rows, or the number of tiles high\r\n   */\r\n  rows: number;\r\n\r\n  elevation?: number;\r\n}\r\n\r\n/**\r\n * The IsometricMap is a special tile map that provides isometric rendering support to Excalibur\r\n *\r\n * The tileWidth and tileHeight should be the height and width in pixels of the parallelogram of the base of the tile art asset.\r\n * The tileWidth and tileHeight is not necessarily the same as your graphic pixel width and height.\r\n *\r\n * Please refer to the docs https://excaliburjs.com for more details calculating what your tile width and height should be given\r\n * your art assets.\r\n */\r\nexport class IsometricMap extends Entity implements HasNestedPointerEvents {\r\n  public readonly elevation: number = 0;\r\n\r\n  /**\r\n   * Width of individual tile in pixels\r\n   */\r\n  public readonly tileWidth: number;\r\n  /**\r\n   * Height of individual tile in pixels\r\n   */\r\n  public readonly tileHeight: number;\r\n  /**\r\n   * Number of tiles wide\r\n   */\r\n  public readonly columns: number;\r\n  /**\r\n   * Number of tiles high\r\n   */\r\n  public readonly rows: number;\r\n  /**\r\n   * List containing all of the tiles in IsometricMap\r\n   */\r\n  public readonly tiles: IsometricTile[];\r\n\r\n  /**\r\n   * Whether tiles should be visible\r\n   * @deprecated use isVisible\r\n   */\r\n  public get visible(): boolean {\r\n    return this.isVisible;\r\n  }\r\n\r\n  /**\r\n   * Whether tiles should be visible\r\n   * @deprecated use isVisible\r\n   */\r\n  public set visible(val: boolean) {\r\n    this.isVisible = val;\r\n  }\r\n\r\n  /**\r\n   * Whether tiles should be visible\r\n   */\r\n  public isVisible = true;\r\n\r\n  /**\r\n   * Opacity of tiles\r\n   */\r\n  public opacity = 1.0;\r\n\r\n  /**\r\n   * Render the tile graphic from the top instead of the bottom\r\n   *\r\n   * default is `false` meaning rendering from the bottom\r\n   */\r\n  public renderFromTopOfGraphic: boolean = false;\r\n  public graphicsOffset: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Isometric map {@apilink TransformComponent}\r\n   */\r\n  public transform: TransformComponent;\r\n\r\n  /**\r\n   * Isometric map {@apilink ColliderComponent}\r\n   */\r\n  public collider: ColliderComponent;\r\n\r\n  public pointer: PointerComponent;\r\n\r\n  private _composite!: CompositeCollider;\r\n  private _pointerEventDispatcher: PointerEventsToObjectDispatcher<IsometricTile>;\r\n\r\n  constructor(options: IsometricMapOptions) {\r\n    super(\r\n      [\r\n        new TransformComponent(),\r\n        new BodyComponent({\r\n          type: CollisionType.Fixed\r\n        }),\r\n        new ColliderComponent(),\r\n        new PointerComponent(),\r\n        new DebugGraphicsComponent((ctx, debugFlags) => this.debug(ctx, debugFlags), false)\r\n      ],\r\n      options.name\r\n    );\r\n    const { pos, tileWidth, tileHeight, columns: width, rows: height, renderFromTopOfGraphic, graphicsOffset, elevation } = options;\r\n\r\n    this.transform = this.get(TransformComponent);\r\n    if (pos) {\r\n      this.transform.pos = pos;\r\n    }\r\n\r\n    this.collider = this.get(ColliderComponent);\r\n    if (this.collider) {\r\n      this.collider.set((this._composite = new CompositeCollider([])));\r\n    }\r\n\r\n    this.pointer = this.get(PointerComponent);\r\n\r\n    this.renderFromTopOfGraphic = renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\r\n    this.graphicsOffset = graphicsOffset ?? this.graphicsOffset;\r\n\r\n    this.elevation = elevation ?? this.elevation;\r\n    this.tileWidth = tileWidth;\r\n    this.tileHeight = tileHeight;\r\n    this.columns = width;\r\n    this.rows = height;\r\n\r\n    this._pointerEventDispatcher = new PointerEventsToObjectDispatcher();\r\n\r\n    this.tiles = new Array(width * height);\r\n\r\n    // build up tile representation\r\n    for (let y = 0; y < height; y++) {\r\n      for (let x = 0; x < width; x++) {\r\n        const tile = new IsometricTile(x, y, this.graphicsOffset, this);\r\n        this.tiles[x + y * width] = tile;\r\n        this.addChild(tile);\r\n        this._pointerEventDispatcher.addObject(\r\n          tile,\r\n          (p) => this.getTileByPoint(p.worldPos) === tile,\r\n          () => true\r\n        );\r\n      }\r\n    }\r\n\r\n    this.pointer.localBounds = BoundingBox.fromDimension(\r\n      tileWidth * width * this.transform.scale.x,\r\n      tileHeight * height * this.transform.scale.y,\r\n      vec(0.5, 0)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _processPointerToObject(receiver: PointerEventReceiver) {\r\n    this._pointerEventDispatcher.processPointerToObject(receiver, this.tiles);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _dispatchPointerEvents(receiver: PointerEventReceiver) {\r\n    this._pointerEventDispatcher.dispatchEvents(receiver, this.tiles);\r\n  }\r\n\r\n  public update(): void {\r\n    if (this._collidersDirty) {\r\n      this.updateColliders();\r\n      this._collidersDirty = false;\r\n    }\r\n\r\n    this._pointerEventDispatcher.clear();\r\n  }\r\n\r\n  private _collidersDirty = false;\r\n  public flagCollidersDirty() {\r\n    this._collidersDirty = true;\r\n  }\r\n\r\n  private _originalOffsets = new WeakMap<Collider, Vector>();\r\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\r\n    if (!this._originalOffsets.has(collider)) {\r\n      const originalOffset = collider.offset;\r\n      this._originalOffsets.set(collider, originalOffset);\r\n      return originalOffset;\r\n    } else {\r\n      return this._originalOffsets.get(collider) ?? Vector.Zero;\r\n    }\r\n  }\r\n  public updateColliders() {\r\n    this._composite.clearColliders();\r\n    const pos = this.get(TransformComponent).pos;\r\n    for (const tile of this.tiles) {\r\n      if (tile.solid) {\r\n        for (const collider of tile.getColliders()) {\r\n          const originalOffset = this._getOrSetColliderOriginalOffset(collider);\r\n          collider.offset = this.tileToWorld(vec(tile.x, tile.y))\r\n            .sub(pos)\r\n            .add(originalOffset)\r\n            .sub(vec(this.tileWidth / 2, this.tileHeight)); // We need to unshift height based on drawing\r\n          collider.owner = this;\r\n          this._composite.addCollider(collider);\r\n        }\r\n      }\r\n    }\r\n    this.collider.update();\r\n  }\r\n\r\n  /**\r\n   * Convert world space coordinates to the tile x, y coordinate\r\n   * @param worldCoordinate\r\n   */\r\n  public worldToTile(worldCoordinate: Vector): Vector {\r\n    // TODO I don't think this handles parent transform see TileMap\r\n    worldCoordinate = worldCoordinate.sub(this.transform.globalPos);\r\n\r\n    const halfTileWidth = this.tileWidth / 2;\r\n    const halfTileHeight = this.tileHeight / 2;\r\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\r\n    return vec(\r\n      ~~((worldCoordinate.x / halfTileWidth + worldCoordinate.y / halfTileHeight) / 2),\r\n      ~~((worldCoordinate.y / halfTileHeight - worldCoordinate.x / halfTileWidth) / 2)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Given a tile coordinate, return the top left corner in world space\r\n   * @param tileCoordinate\r\n   */\r\n  public tileToWorld(tileCoordinate: Vector): Vector {\r\n    const halfTileWidth = this.tileWidth / 2;\r\n    const halfTileHeight = this.tileHeight / 2;\r\n    // The x position shifts left with every y step\r\n    const xPos = (tileCoordinate.x - tileCoordinate.y) * halfTileWidth;\r\n    // The y position needs to go down with every x step\r\n    const yPos = (tileCoordinate.x + tileCoordinate.y) * halfTileHeight;\r\n    return vec(xPos, yPos).add(this.transform.pos);\r\n  }\r\n\r\n  /**\r\n   * Returns the {@apilink IsometricTile} by its x and y coordinates\r\n   */\r\n  public getTile(x: number, y: number): IsometricTile | null {\r\n    if (x < 0 || y < 0 || x >= this.columns || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.tiles[x + y * this.columns];\r\n  }\r\n\r\n  /**\r\n   * Returns the {@apilink IsometricTile} by testing a point in world coordinates,\r\n   * returns `null` if no Tile was found.\r\n   */\r\n  public getTileByPoint(point: Vector): IsometricTile | null {\r\n    const tileCoord = this.worldToTile(point);\r\n    const tile = this.getTile(tileCoord.x, tileCoord.y);\r\n    return tile;\r\n  }\r\n\r\n  private _getMaxZIndex(): number {\r\n    let maxZ = Number.NEGATIVE_INFINITY;\r\n    for (const tile of this.tiles) {\r\n      const currentZ = tile.get(TransformComponent).z;\r\n      if (currentZ > maxZ) {\r\n        maxZ = currentZ;\r\n      }\r\n    }\r\n    return maxZ;\r\n  }\r\n\r\n  /**\r\n   * Debug draw for IsometricMap, called internally by excalibur when debug mode is toggled on\r\n   * @param gfx\r\n   */\r\n  public debug(gfx: ExcaliburGraphicsContext, debugFlags: DebugConfig) {\r\n    const { showAll, showPosition, positionColor, positionSize, showGrid, gridColor, gridWidth, showColliderGeometry } =\r\n      debugFlags.isometric;\r\n\r\n    const { geometryColor, geometryLineWidth, geometryPointSize } = debugFlags.collider;\r\n    gfx.save();\r\n    gfx.z = this._getMaxZIndex() + 0.5;\r\n    if (showAll || showGrid) {\r\n      for (let y = 0; y < this.rows + 1; y++) {\r\n        const left = this.tileToWorld(vec(0, y));\r\n        const right = this.tileToWorld(vec(this.columns, y));\r\n        gfx.drawLine(left, right, gridColor, gridWidth);\r\n      }\r\n\r\n      for (let x = 0; x < this.columns + 1; x++) {\r\n        const top = this.tileToWorld(vec(x, 0));\r\n        const bottom = this.tileToWorld(vec(x, this.rows));\r\n        gfx.drawLine(top, bottom, gridColor, gridWidth);\r\n      }\r\n    }\r\n\r\n    if (showAll || showPosition) {\r\n      for (const tile of this.tiles) {\r\n        gfx.drawCircle(this.tileToWorld(vec(tile.x, tile.y)), positionSize, positionColor);\r\n      }\r\n    }\r\n    if (showAll || showColliderGeometry) {\r\n      for (const tile of this.tiles) {\r\n        if (tile.solid) {\r\n          // only draw solid tiles\r\n          for (const collider of tile.getColliders()) {\r\n            collider.debug(gfx, geometryColor, { lineWidth: geometryLineWidth, pointSize: geometryPointSize });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    gfx.restore();\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem';\r\nimport { Action, nextActionId } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * Action that can represent a sequence of actions, this can be useful in conjunction with\r\n * {@apilink ParallelActions} to run multiple sequences in parallel.\r\n */\r\nexport class ActionSequence implements Action {\r\n  id = nextActionId();\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _sequenceContext: ActionContext;\r\n  private _sequenceBuilder: (actionContext: ActionContext) => any;\r\n  constructor(entity: Entity, actionBuilder: (actionContext: ActionContext) => any) {\r\n    this._sequenceBuilder = actionBuilder;\r\n    this._sequenceContext = new ActionContext(entity);\r\n    this._actionQueue = this._sequenceContext.getQueue();\r\n    this._sequenceBuilder(this._sequenceContext);\r\n  }\r\n\r\n  public update(elapsed: number): void {\r\n    this._actionQueue.update(elapsed);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._actionQueue.isComplete();\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._stopped = false;\r\n    this._actionQueue.reset();\r\n  }\r\n\r\n  public clone(entity: Entity) {\r\n    return new ActionSequence(entity, this._sequenceBuilder);\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem';\r\nimport { Action, nextActionId } from '../Action';\r\n\r\n/**\r\n * Action that can run multiple {@apilink Action}s or {@apilink ActionSequence}s at the same time\r\n */\r\nexport class ParallelActions implements Action {\r\n  id = nextActionId();\r\n  private _actions: Action[];\r\n\r\n  constructor(parallelActions: Action[]) {\r\n    this._actions = parallelActions;\r\n  }\r\n\r\n  update(elapsed: number): void {\r\n    for (let i = 0; i < this._actions.length; i++) {\r\n      this._actions[i].update(elapsed);\r\n    }\r\n  }\r\n  isComplete(entity: Entity): boolean {\r\n    return this._actions.every((a) => a.isComplete(entity));\r\n  }\r\n  reset(): void {\r\n    this._actions.forEach((a) => a.reset());\r\n  }\r\n  stop(): void {\r\n    this._actions.forEach((a) => a.stop());\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nexport interface QuadTreeItem {\r\n  bounds: BoundingBox;\r\n}\r\n\r\nexport interface QuadTreeOptions {\r\n  maxDepth?: number;\r\n  capacity: number;\r\n  level?: number;\r\n}\r\n\r\n/**\r\n * QuadTree spatial data structure. Useful for quickly retrieving all objects that might\r\n * be in a specific location.\r\n */\r\nexport class QuadTree<TItem extends QuadTreeItem> {\r\n  private _defaultOptions: QuadTreeOptions = {\r\n    maxDepth: 10,\r\n    capacity: 10,\r\n    level: 0\r\n  };\r\n\r\n  public halfWidth: number;\r\n  public halfHeight: number;\r\n  public items: TItem[] = [];\r\n  private _isDivided = false;\r\n\r\n  public topLeft: QuadTree<TItem> | null = null;\r\n  public topRight: QuadTree<TItem> | null = null;\r\n  public bottomLeft: QuadTree<TItem> | null = null;\r\n  public bottomRight: QuadTree<TItem> | null = null;\r\n\r\n  constructor(\r\n    public bounds: BoundingBox,\r\n    public options?: QuadTreeOptions\r\n  ) {\r\n    this.options = { ...this._defaultOptions, ...options };\r\n    this.halfWidth = bounds.width / 2;\r\n    this.halfHeight = bounds.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Splits the quad tree one level deeper\r\n   */\r\n  private _split() {\r\n    this._isDivided = true;\r\n    const newLevelOptions = {\r\n      maxDepth: this.options.maxDepth,\r\n      capacity: this.options.capacity,\r\n      level: this.options.level + 1\r\n    };\r\n    this.topLeft = new QuadTree<TItem>(\r\n      new BoundingBox({\r\n        left: this.bounds.left,\r\n        top: this.bounds.top,\r\n        right: this.bounds.left + this.halfWidth,\r\n        bottom: this.bounds.top + this.halfHeight\r\n      }),\r\n      newLevelOptions\r\n    );\r\n    this.topRight = new QuadTree<TItem>(\r\n      new BoundingBox({\r\n        left: this.bounds.left + this.halfWidth,\r\n        top: this.bounds.top,\r\n        right: this.bounds.right,\r\n        bottom: this.bounds.top + this.halfHeight\r\n      }),\r\n      newLevelOptions\r\n    );\r\n    this.bottomLeft = new QuadTree<TItem>(\r\n      new BoundingBox({\r\n        left: this.bounds.left,\r\n        top: this.bounds.top + this.halfHeight,\r\n        right: this.bounds.left + this.halfWidth,\r\n        bottom: this.bounds.bottom\r\n      }),\r\n      newLevelOptions\r\n    );\r\n    this.bottomRight = new QuadTree<TItem>(\r\n      new BoundingBox({\r\n        left: this.bounds.left + this.halfWidth,\r\n        top: this.bounds.top + this.halfHeight,\r\n        right: this.bounds.right,\r\n        bottom: this.bounds.bottom\r\n      }),\r\n      newLevelOptions\r\n    );\r\n  }\r\n\r\n  private _insertIntoSubNodes(item: TItem) {\r\n    if (this.topLeft?.bounds.overlaps(item.bounds)) {\r\n      this.topLeft.insert(item);\r\n    }\r\n\r\n    if (this.topRight?.bounds.overlaps(item.bounds)) {\r\n      this.topRight.insert(item);\r\n    }\r\n\r\n    if (this.bottomLeft?.bounds.overlaps(item.bounds)) {\r\n      this.bottomLeft.insert(item);\r\n    }\r\n\r\n    if (this.bottomRight?.bounds.overlaps(item.bounds)) {\r\n      this.bottomRight.insert(item);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Insert an item to be tracked in the QuadTree\r\n   * @param item\r\n   */\r\n  insert(item: TItem): void {\r\n    // add to subnodes if it matches\r\n    if (this._isDivided) {\r\n      this._insertIntoSubNodes(item);\r\n      return;\r\n    }\r\n\r\n    // leaf case\r\n    this.items.push(item);\r\n\r\n    // capacity\r\n    if (this.items.length > this.options.capacity && this.options.level < this.options.maxDepth) {\r\n      if (!this._isDivided) {\r\n        this._split();\r\n      }\r\n      // divide this level's items into it's subnodes\r\n      for (const item of this.items) {\r\n        this._insertIntoSubNodes(item);\r\n      }\r\n      // clear this level\r\n      this.items.length = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a tracked item in the QuadTree\r\n   * @param item\r\n   */\r\n  remove(item: TItem): void {\r\n    if (!this.bounds.overlaps(item.bounds)) {\r\n      return;\r\n    }\r\n\r\n    if (!this._isDivided) {\r\n      const index = this.items.indexOf(item);\r\n      if (index > -1) {\r\n        this.items.splice(index, 1);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this.topLeft?.bounds.overlaps(item.bounds)) {\r\n      this.topLeft.remove(item);\r\n    }\r\n\r\n    if (this.topRight?.bounds.overlaps(item.bounds)) {\r\n      this.topRight.remove(item);\r\n    }\r\n\r\n    if (this.bottomLeft?.bounds.overlaps(item.bounds)) {\r\n      this.bottomLeft.remove(item);\r\n    }\r\n\r\n    if (this.bottomRight?.bounds.overlaps(item.bounds)) {\r\n      this.bottomRight.remove(item);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Query the structure for all objects that intersect the bounding box\r\n   * @param boundingBox\r\n   * @returns items\r\n   */\r\n  query(boundingBox: BoundingBox): TItem[] {\r\n    let results = this.items;\r\n\r\n    if (this._isDivided) {\r\n      if (this.topLeft.bounds.overlaps(boundingBox)) {\r\n        results = results.concat(this.topLeft.query(boundingBox));\r\n      }\r\n      if (this.topRight.bounds.overlaps(boundingBox)) {\r\n        results = results.concat(this.topRight.query(boundingBox));\r\n      }\r\n      if (this.bottomLeft.bounds.overlaps(boundingBox)) {\r\n        results = results.concat(this.bottomLeft.query(boundingBox));\r\n      }\r\n      if (this.bottomRight.bounds.overlaps(boundingBox)) {\r\n        results = results.concat(this.bottomRight.query(boundingBox));\r\n      }\r\n    }\r\n\r\n    results = results.filter((item, index) => {\r\n      return results.indexOf(item) >= index;\r\n    });\r\n\r\n    return results;\r\n  }\r\n\r\n  clear() {\r\n    this.items = [];\r\n    this._isDivided = false;\r\n\r\n    this.topLeft = null;\r\n    this.topRight = null;\r\n    this.bottomLeft = null;\r\n    this.bottomRight = null;\r\n  }\r\n\r\n  getAllItems(): TItem[] {\r\n    let results = this.items;\r\n\r\n    if (this._isDivided) {\r\n      results = results.concat(this.topLeft.getAllItems());\r\n      results = results.concat(this.topRight.getAllItems());\r\n      results = results.concat(this.bottomLeft.getAllItems());\r\n      results = results.concat(this.bottomRight.getAllItems());\r\n    }\r\n\r\n    results = results.filter((item, index) => {\r\n      return results.indexOf(item) >= index;\r\n    });\r\n\r\n    return results;\r\n  }\r\n\r\n  getTreeDepth(): number {\r\n    if (!this._isDivided) {\r\n      return 0;\r\n    }\r\n\r\n    return (\r\n      1 +\r\n      Math.max(this.topLeft.getTreeDepth(), this.topRight.getTreeDepth(), this.bottomLeft.getTreeDepth(), this.bottomRight.getTreeDepth())\r\n    );\r\n  }\r\n\r\n  debug(ctx: ExcaliburGraphicsContext) {\r\n    this.bounds.draw(ctx, Color.Yellow);\r\n    if (this._isDivided) {\r\n      this.topLeft.bounds.draw(ctx, Color.Yellow);\r\n      this.topRight.bounds.draw(ctx, Color.Yellow);\r\n      this.bottomLeft.bounds.draw(ctx, Color.Yellow);\r\n      this.bottomRight.bounds.draw(ctx, Color.Yellow);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './../Engine';\r\nimport * as Events from './../Events';\r\nimport { Scene } from '../Scene';\r\nimport { ExcaliburGraphicsContext } from '../Graphics';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _initialize {\r\n  _initialize(engine: Engine): void;\r\n}\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _add {\r\n  onAdd(scene: Scene): void;\r\n}\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _remove {\r\n  onRemove(engine: Engine): void;\r\n}\r\n\r\n/**\r\n * Type guard checking for internal initialize method\r\n * @internal\r\n * @param a\r\n */\r\nexport function has_initialize(a: any): a is _initialize {\r\n  return !!a._initialize;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_add(a: any): a is _add {\r\n  return !!a.onAdd;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_remove(a: any): a is _remove {\r\n  return !!a.onRemove;\r\n}\r\n\r\nexport interface OnInitialize {\r\n  onInitialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnInitialize(a: any): a is OnInitialize {\r\n  return !!a.onInitialize;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _preupdate {\r\n  _preupdate(engine: Engine, elapsed: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_preupdate(a: any): a is _preupdate {\r\n  return !!a._preupdate;\r\n}\r\n\r\nexport interface OnPreUpdate {\r\n  onPreUpdate(engine: Engine, elapsed: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\r\n  return !!a.onPreUpdate;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _postupdate {\r\n  _postupdate(engine: Engine, elapsed: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_postupdate(a: any): a is _postupdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface OnPostUpdate {\r\n  onPostUpdate(engine: Engine, elapsed: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface CanInitialize {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onInitialize(engine: Engine): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnAdd {\r\n  onAdd(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnAdd(a: any): a is OnAdd {\r\n  return !!a.onAdd;\r\n}\r\n\r\nexport interface CanAdd {\r\n  onAdd(engine: Engine): void;\r\n\r\n  on(eventName: Events.add, handler: (event: Events.AddEvent<any>) => void): void;\r\n  once(eventName: Events.add, handler: (event: Events.AddEvent<any>) => void): void;\r\n  off(eventName: Events.add, handler?: (event: Events.AddEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnRemove {\r\n  onRemove(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnRemove(a: any): a is OnRemove {\r\n  return !!a.onRemove;\r\n}\r\n\r\nexport interface CanRemove {\r\n  onRemove(engine: Engine): void;\r\n\r\n  on(eventName: Events.remove, handler: (event: Events.RemoveEvent<any>) => void): void;\r\n  once(eventName: Events.remove, handler: (event: Events.RemoveEvent<any>) => void): void;\r\n  off(eventName: Events.remove, handler?: (event: Events.RemoveEvent<any>) => void): void;\r\n}\r\n\r\nexport interface SceneActivationContext<TData = undefined> {\r\n  data?: TData;\r\n  previousScene: Scene;\r\n  nextScene: Scene;\r\n  engine: Engine;\r\n}\r\n\r\nexport interface CanActivate<TData = undefined> {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onActivate(context: SceneActivationContext<TData>): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanDeactivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onDeactivate(context: SceneActivationContext<never>): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanUpdate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreUpdate(engine: Engine, elapsed: number): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostUpdate(engine: Engine, elapsed: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnPreDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreDraw(ctx: ExcaliburGraphicsContext, elapsed: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n}\r\n\r\nexport interface OnPostDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostDraw(ctx: ExcaliburGraphicsContext, elapsed: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPreDraw(a: any): a is OnPreDraw {\r\n  return !!a.onPreDraw;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPostDraw(a: any): a is OnPostDraw {\r\n  return !!a.onPostDraw;\r\n}\r\n\r\nexport interface CanBeKilled {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n}\r\n","import { Resource } from './Resource';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\r\nimport { Animation } from '../Graphics/Animation';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { ImageSource } from '../Graphics/ImageSource';\r\n/**\r\n * The {@apilink Texture} object allows games built in Excalibur to load image resources.\r\n * {@apilink Texture} is an {@apilink Loadable} which means it can be passed to a {@apilink Loader}\r\n * to pre-load before starting a level or game.\r\n */\r\nexport class Gif implements Loadable<ImageSource[]> {\r\n  private _resource: Resource<ArrayBuffer>;\r\n\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number = 0;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number = 0;\r\n\r\n  private _stream?: Stream;\r\n  private _gif?: GifParser;\r\n  private _images: ImageSource[] = [];\r\n  private _animation?: Animation;\r\n\r\n  public data: ImageSource[] = [];\r\n  private _sprites: Sprite[] = [];\r\n\r\n  /**\r\n   * @param path       Path to the image resource\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    bustCache = false\r\n  ) {\r\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\r\n  }\r\n\r\n  /**\r\n   * Should excalibur add a cache busting querystring? By default false.\r\n   * Must be set before loading\r\n   */\r\n  public get bustCache() {\r\n    return this._resource.bustCache;\r\n  }\r\n\r\n  public set bustCache(val: boolean) {\r\n    this._resource.bustCache = val;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<ImageSource[]> {\r\n    const arraybuffer = await this._resource.load();\r\n    this._stream = new Stream(arraybuffer);\r\n    this._gif = new GifParser(this._stream);\r\n    const images = this._gif.images.map((i) => new ImageSource(i.src, false));\r\n    // Load all textures\r\n    await Promise.all(images.map((t) => t.load()));\r\n    this.data = this._images = images;\r\n    this._sprites = this._images.map((image) => {\r\n      return image.toSprite();\r\n    });\r\n    return this.data;\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a sprite by id\r\n   * @param id\r\n   */\r\n  public toSprite(id: number = 0): Sprite | null {\r\n    return this._sprites[id] ?? null;\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a spritesheet\r\n   */\r\n  public toSpriteSheet(): SpriteSheet | null {\r\n    const sprites: Sprite[] = this._sprites;\r\n    if (sprites.length) {\r\n      return new SpriteSheet({ sprites });\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Transform the GIF into an animation with duration per frame\r\n   * @param durationPerFrame Optionally override duration per frame\r\n   */\r\n  public toAnimation(durationPerFrame?: number): Animation | null {\r\n    const images = this._gif?.images;\r\n    if (images?.length) {\r\n      const frames = images.map((image, index) => {\r\n        return {\r\n          graphic: this._sprites[index],\r\n          duration: this._gif?.frames[index].delayMs || undefined\r\n        };\r\n      });\r\n      this._animation = new Animation({\r\n        frames,\r\n        frameDuration: durationPerFrame\r\n      });\r\n\r\n      return this._animation;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public get readCheckBytes(): number[] {\r\n    return this._gif?.checkBytes ?? [];\r\n  }\r\n}\r\n\r\nexport interface GifFrame {\r\n  sentinel: number;\r\n  type: string;\r\n  leftPos: number;\r\n  topPos: number;\r\n  width: number;\r\n  height: number;\r\n  lctFlag: boolean;\r\n  lctBytes: [number, number, number][];\r\n  interlaced: boolean;\r\n  sorted: boolean;\r\n  reserved: boolean[];\r\n  lctSize: number;\r\n  lzwMinCodeSize: number;\r\n  pixels: number[];\r\n  delayTime: number;\r\n  delayMs: number;\r\n}\r\n\r\nconst bitsToNum = (ba: any) => {\r\n  return ba.reduce(function (s: number, n: number) {\r\n    return s * 2 + n;\r\n  }, 0);\r\n};\r\n\r\nconst byteToBitArr = (bite: number) => {\r\n  const a = [];\r\n  for (let i = 7; i >= 0; i--) {\r\n    a.push(!!(bite & (1 << i)));\r\n  }\r\n  return a as [boolean, boolean, boolean, boolean, boolean, boolean, boolean, boolean];\r\n};\r\n\r\nexport class Stream {\r\n  data: Uint8Array;\r\n  len: number = 0;\r\n  position: number = 0;\r\n\r\n  constructor(dataArray: ArrayBuffer) {\r\n    this.data = new Uint8Array(dataArray);\r\n    this.len = this.data.byteLength;\r\n    if (this.len === 0) {\r\n      throw new Error('No data loaded from file');\r\n    }\r\n  }\r\n\r\n  public readByte = () => {\r\n    if (this.position >= this.data.byteLength) {\r\n      throw new Error('Attempted to read past end of stream.');\r\n    }\r\n    return this.data[this.position++];\r\n  };\r\n\r\n  public readBytes = (n: number) => {\r\n    const bytes = [];\r\n    for (let i = 0; i < n; i++) {\r\n      bytes.push(this.readByte());\r\n    }\r\n    return bytes;\r\n  };\r\n\r\n  public read = (n: number) => {\r\n    let s = '';\r\n    for (let i = 0; i < n; i++) {\r\n      s += String.fromCharCode(this.readByte());\r\n    }\r\n    return s;\r\n  };\r\n\r\n  public readUnsigned = () => {\r\n    // Little-endian.\r\n    const a = this.readBytes(2);\r\n    return (a[1] << 8) + a[0];\r\n  };\r\n}\r\n\r\nconst lzwDecode = function (minCodeSize: number, data: any) {\r\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\r\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\r\n\r\n  const readCode = function (size: number) {\r\n    let code = 0;\r\n    for (let i = 0; i < size; i++) {\r\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\r\n        code |= 1 << i;\r\n      }\r\n      pos++;\r\n    }\r\n    return code;\r\n  };\r\n\r\n  const output: any[] = [];\r\n\r\n  const clearCode = 1 << minCodeSize;\r\n  const eoiCode = clearCode + 1;\r\n\r\n  let codeSize = minCodeSize + 1;\r\n\r\n  let dict: any[] = [];\r\n\r\n  const clear = function () {\r\n    dict = [];\r\n    codeSize = minCodeSize + 1;\r\n    for (let i = 0; i < clearCode; i++) {\r\n      dict[i] = [i];\r\n    }\r\n    dict[clearCode] = [];\r\n    dict[eoiCode] = null;\r\n  };\r\n\r\n  let code = 0;\r\n  let last = 0;\r\n\r\n  while (true) {\r\n    last = code;\r\n    code = readCode(codeSize);\r\n    if (code === clearCode) {\r\n      clear();\r\n      continue;\r\n    }\r\n    if (code === eoiCode) {\r\n      break;\r\n    }\r\n\r\n    if (code < dict.length) {\r\n      if (last !== clearCode) {\r\n        dict.push(dict[last].concat(dict[code][0]));\r\n      }\r\n    } else {\r\n      if (code !== dict.length) {\r\n        throw new Error('Invalid LZW code.');\r\n      }\r\n      dict.push(dict[last].concat(dict[last][0]));\r\n    }\r\n    output.push.apply(output, dict[code]);\r\n\r\n    if (dict.length === 1 << codeSize && codeSize < 12) {\r\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\r\n      codeSize++;\r\n    }\r\n  }\r\n\r\n  // I don't know if this is technically an error, but some GIFs do it.\r\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\r\n  return output;\r\n};\r\n\r\ninterface GifBlock {\r\n  sentinel: number;\r\n  type: string;\r\n}\r\n\r\ninterface GifHeader {\r\n  sig: string;\r\n  ver: string;\r\n  width: number;\r\n  height: number;\r\n  colorResolution: number;\r\n  globalColorTableSize: number;\r\n  gctFlag: boolean;\r\n  sortedFlag: boolean;\r\n  globalColorTable: [number, number, number][];\r\n  backgroundColorIndex: number;\r\n  pixelAspectRatio: number; // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n}\r\n\r\ninterface GCExtBlock extends GifBlock {\r\n  type: 'ext';\r\n  label: number;\r\n  extType: string;\r\n  reserved: boolean[];\r\n  disposalMethod: number;\r\n  userInputFlag: boolean;\r\n  transparentColorFlag: boolean;\r\n  delayTime: number;\r\n  transparentColorIndex: number;\r\n  terminator: number;\r\n}\r\n\r\n/**\r\n * GifParser for binary format\r\n *\r\n * Roughly based on the documentation https://giflib.sourceforge.net/whatsinagif/index.html\r\n */\r\nexport class GifParser {\r\n  private _st: Stream;\r\n  private _handler: any = {};\r\n  public frames: GifFrame[] = [];\r\n  public images: HTMLImageElement[] = [];\r\n  private _currentFrameCanvas: HTMLCanvasElement;\r\n  private _currentFrameContext: CanvasRenderingContext2D;\r\n  public globalColorTableBytes: [number, number, number][] = [];\r\n  public checkBytes: number[] = [];\r\n  private _gce?: GCExtBlock;\r\n  private _hdr?: GifHeader;\r\n\r\n  constructor(stream: Stream) {\r\n    this._st = stream;\r\n    this._handler = {};\r\n    this._currentFrameCanvas = document.createElement('canvas');\r\n    this._currentFrameContext = this._currentFrameCanvas.getContext('2d')!;\r\n    this.parseHeader();\r\n    this.parseBlocks();\r\n  }\r\n\r\n  parseColorTableBytes = (entries: number) => {\r\n    // Each entry is 3 bytes, for RGB.\r\n    const colorTable: [number, number, number][] = [];\r\n    for (let i = 0; i < entries; i++) {\r\n      const rgb = this._st.readBytes(3) as [number, number, number];\r\n      colorTable.push(rgb);\r\n    }\r\n    return colorTable;\r\n  };\r\n\r\n  readSubBlocks = () => {\r\n    let size, data;\r\n    data = '';\r\n    do {\r\n      size = this._st.readByte();\r\n      data += this._st.read(size);\r\n    } while (size !== 0);\r\n    return data;\r\n  };\r\n\r\n  parseHeader = () => {\r\n    const hdr: GifHeader = {\r\n      sig: '',\r\n      ver: '',\r\n      width: 0,\r\n      height: 0,\r\n      colorResolution: 0,\r\n      globalColorTableSize: 0,\r\n      gctFlag: false,\r\n      sortedFlag: false,\r\n      globalColorTable: [],\r\n      backgroundColorIndex: 0,\r\n      pixelAspectRatio: 0 // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n    };\r\n\r\n    hdr.sig = this._st.read(3);\r\n    hdr.ver = this._st.read(3);\r\n    if (hdr.sig !== 'GIF') {\r\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\r\n    }\r\n\r\n    hdr.width = this._st.readUnsigned();\r\n    hdr.height = this._st.readUnsigned();\r\n\r\n    this._currentFrameCanvas.width = hdr.width;\r\n    this._currentFrameCanvas.height = hdr.height;\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    hdr.gctFlag = bits.shift()!;\r\n    hdr.colorResolution = bitsToNum(bits.splice(0, 3));\r\n    hdr.sortedFlag = bits.shift()!;\r\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    hdr.backgroundColorIndex = this._st.readByte();\r\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n\r\n    if (hdr.gctFlag) {\r\n      // hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\r\n      this.globalColorTableBytes = this.parseColorTableBytes(1 << (hdr.globalColorTableSize + 1));\r\n    }\r\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\r\n      this.checkBytes.push(this._handler.hdr);\r\n    }\r\n  };\r\n\r\n  parseExt = (block: GCExtBlock) => {\r\n    const parseGCExt = (block: GCExtBlock) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 4\r\n\r\n      const bits = byteToBitArr(this._st.readByte());\r\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\r\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\r\n      block.userInputFlag = bits.shift()!;\r\n      block.transparentColorFlag = bits.shift()!;\r\n\r\n      block.delayTime = this._st.readUnsigned();\r\n\r\n      block.transparentColorIndex = this._st.readByte();\r\n\r\n      block.terminator = this._st.readByte(); // always 0\r\n\r\n      if (this._handler.gce && this._handler.gce(block)) {\r\n        this.checkBytes.push(this._handler.gce);\r\n      }\r\n      return block;\r\n    };\r\n\r\n    const parseComExt = (block: any) => {\r\n      block.comment = this.readSubBlocks();\r\n      if (this._handler.com && this._handler.com(block)) {\r\n        this.checkBytes.push(this._handler.com);\r\n      }\r\n    };\r\n\r\n    const parsePTExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 12\r\n      block.ptHeader = this._st.readBytes(12);\r\n      block.ptData = this.readSubBlocks();\r\n      if (this._handler.pte && this._handler.pte(block)) {\r\n        this.checkBytes.push(this._handler.pte);\r\n      }\r\n    };\r\n\r\n    const parseAppExt = (block: any) => {\r\n      const parseNetscapeExt = (block: any) => {\r\n        this.checkBytes.push(this._st.readByte()); // Always 3\r\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\r\n        block.iterations = this._st.readUnsigned();\r\n        block.terminator = this._st.readByte();\r\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\r\n          this.checkBytes.push(this._handler.app);\r\n        }\r\n      };\r\n\r\n      const parseUnknownAppExt = (block: any) => {\r\n        block.appData = this.readSubBlocks();\r\n        // FIXME: This won't work if a handler wants to match on any identifier.\r\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\r\n          this.checkBytes.push(this._handler.app[block.identifier]);\r\n        }\r\n      };\r\n\r\n      this.checkBytes.push(this._st.readByte()); // Always 11\r\n      block.identifier = this._st.read(8);\r\n      block.authCode = this._st.read(3);\r\n      switch (block.identifier) {\r\n        case 'NETSCAPE':\r\n          parseNetscapeExt(block);\r\n          break;\r\n        default:\r\n          parseUnknownAppExt(block);\r\n          break;\r\n      }\r\n    };\r\n\r\n    const parseUnknownExt = (block: any) => {\r\n      block.data = this.readSubBlocks();\r\n      if (this._handler.unknown && this._handler.unknown(block)) {\r\n        this.checkBytes.push(this._handler.unknown);\r\n      }\r\n    };\r\n\r\n    block.label = this._st.readByte();\r\n    switch (block.label) {\r\n      case 0xf9:\r\n        block.extType = 'gce';\r\n        this._gce = parseGCExt(block);\r\n        break;\r\n      case 0xfe:\r\n        block.extType = 'com';\r\n        parseComExt(block);\r\n        break;\r\n      case 0x01:\r\n        block.extType = 'pte';\r\n        parsePTExt(block);\r\n        break;\r\n      case 0xff:\r\n        block.extType = 'app';\r\n        parseAppExt(block);\r\n        break;\r\n      default:\r\n        block.extType = 'unknown';\r\n        parseUnknownExt(block);\r\n        break;\r\n    }\r\n  };\r\n\r\n  parseImg = (img: GifFrame) => {\r\n    const deinterlace = (pixels: number[], width: number) => {\r\n      // Of course this defeats the purpose of interlacing. And it's *probably*\r\n      // the least efficient way it's ever been implemented. But nevertheless...\r\n\r\n      const newPixels: number[] = new Array(pixels.length);\r\n      const rows = pixels.length / width;\r\n      const cpRow = (toRow: number, fromRow: number) => {\r\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\r\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels) as any);\r\n      };\r\n\r\n      const offsets = [0, 4, 2, 1];\r\n      const steps = [8, 8, 4, 2];\r\n\r\n      let fromRow = 0;\r\n      for (let pass = 0; pass < 4; pass++) {\r\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\r\n          cpRow(toRow, fromRow);\r\n          fromRow++;\r\n        }\r\n      }\r\n\r\n      return newPixels;\r\n    };\r\n\r\n    img.leftPos = this._st.readUnsigned();\r\n    img.topPos = this._st.readUnsigned();\r\n    img.width = this._st.readUnsigned();\r\n    img.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    img.lctFlag = bits.shift()!;\r\n    img.interlaced = bits.shift()!;\r\n    img.sorted = bits.shift()!;\r\n    img.reserved = bits.splice(0, 2);\r\n    img.lctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    if (img.lctFlag) {\r\n      img.lctBytes = this.parseColorTableBytes(1 << (img.lctSize + 1));\r\n    }\r\n\r\n    img.lzwMinCodeSize = this._st.readByte();\r\n\r\n    const lzwData = this.readSubBlocks();\r\n\r\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\r\n\r\n    if (img.interlaced) {\r\n      // Move\r\n      img.pixels = deinterlace(img.pixels, img.width);\r\n    }\r\n\r\n    if (this._gce?.delayTime) {\r\n      img.delayMs = this._gce.delayTime * 10;\r\n    }\r\n\r\n    this.frames.push(img);\r\n    this.arrayToImage(img, img.lctFlag ? img.lctBytes : this.globalColorTableBytes);\r\n    if (this._handler.img && this._handler.img(img)) {\r\n      this.checkBytes.push(this._handler);\r\n    }\r\n  };\r\n\r\n  public parseBlocks = () => {\r\n    const block: GifBlock = {\r\n      sentinel: this._st.readByte(),\r\n      type: ''\r\n    };\r\n    const blockChar = String.fromCharCode(block.sentinel);\r\n    switch (blockChar) {\r\n      case '!':\r\n        block.type = 'ext';\r\n        this.parseExt(block as GCExtBlock);\r\n        break;\r\n      case ',':\r\n        block.type = 'img';\r\n        this.parseImg(block as any);\r\n        break;\r\n      case ';':\r\n        block.type = 'eof';\r\n        if (this._handler.eof && this._handler.eof(block)) {\r\n          this.checkBytes.push(this._handler.eof);\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\r\n    }\r\n\r\n    if (block.type !== 'eof') {\r\n      this.parseBlocks();\r\n    }\r\n  };\r\n\r\n  arrayToImage = (frame: GifFrame, colorTable: [number, number, number][]) => {\r\n    const canvas = document.createElement('canvas')!;\r\n    canvas.width = frame.width;\r\n    canvas.height = frame.height;\r\n    const context = canvas.getContext('2d')!;\r\n    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n    let transparentColorIndex = -1;\r\n    if (this._gce?.transparentColorFlag) {\r\n      transparentColorIndex = this._gce.transparentColorIndex;\r\n    }\r\n\r\n    for (let pixel = 0; pixel < frame.pixels.length; pixel++) {\r\n      const colorIndex = frame.pixels[pixel];\r\n      const color = colorTable[colorIndex];\r\n      if (colorIndex === transparentColorIndex) {\r\n        imageData.data.set([0, 0, 0, 0], pixel * 4);\r\n      } else {\r\n        imageData.data.set([...color, 255], pixel * 4);\r\n      }\r\n    }\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    // A value of 1 which tells the decoder to leave the image in place and draw the next image on top of it.\r\n    // A value of 2 would have meant that the canvas should be restored to the background color (as indicated by the logical screen descriptor).\r\n    // A value of 3 is defined to mean that the decoder should restore the canvas to its previous state before the current image was drawn.\r\n    // The behavior for values 4-7 are yet to be defined.\r\n    if (this._gce?.disposalMethod === 1 && this.images.length) {\r\n      this._currentFrameContext.drawImage(this.images[this.images.length - 1]!, 0, 0);\r\n    } else if (this._gce?.disposalMethod === 2 && this._hdr?.gctFlag) {\r\n      const bg = colorTable[this._hdr.backgroundColorIndex];\r\n      this._currentFrameContext.fillStyle = `rgb(${bg[0]}, ${bg[1]}, ${bg[2]})`;\r\n      this._currentFrameContext.fillRect(0, 0, this._hdr.width, this._hdr.height);\r\n    } else {\r\n      this._currentFrameContext.clearRect(0, 0, this._currentFrameCanvas.width, this._currentFrameCanvas.height);\r\n    }\r\n\r\n    this._currentFrameContext.drawImage(canvas, frame.leftPos, frame.topPos, frame.width, frame.height);\r\n\r\n    const img = new Image();\r\n    img.src = this._currentFrameCanvas.toDataURL(); // default is png\r\n    this.images.push(img);\r\n  };\r\n}\r\n","import { Font } from '../Graphics/Font';\r\nimport { FontOptions } from '../Graphics/FontCommon';\r\nimport { GraphicOptions, RasterOptions } from '../Graphics';\r\nimport { Loadable } from '../Interfaces/Loadable';\r\nimport { Resource } from './Resource';\r\n\r\nexport interface FontSourceOptions extends Omit<FontOptions, 'family'>, GraphicOptions, RasterOptions {\r\n  /**\r\n   * Whether or not to cache-bust requests\r\n   */\r\n  bustCache?: boolean;\r\n}\r\n\r\nexport class FontSource implements Loadable<FontFace> {\r\n  private _resource: Resource<Blob>;\r\n  private _isLoaded = false;\r\n  private _options: FontSourceOptions;\r\n\r\n  data!: FontFace;\r\n\r\n  constructor(\r\n    /**\r\n     * Path to the font resource relative from the HTML document hosting the game, or absolute\r\n     */\r\n    public readonly path: string,\r\n    /**\r\n     * The font family name\r\n     */\r\n    public readonly family: string,\r\n    { bustCache, ...options }: FontSourceOptions = {}\r\n  ) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    this._options = options;\r\n  }\r\n\r\n  async load(): Promise<FontFace> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n\r\n    try {\r\n      const blob = await this._resource.load();\r\n      const url = URL.createObjectURL(blob);\r\n\r\n      if (!this.data) {\r\n        this.data = new FontFace(this.family, `url(${url})`);\r\n        document.fonts.add(this.data);\r\n      }\r\n\r\n      await this.data.load();\r\n      this._isLoaded = true;\r\n    } catch (error) {\r\n      throw `Error loading FontSource from path '${this.path}' with error [${(error as Error).message}]`;\r\n    }\r\n    return this.data;\r\n  }\r\n\r\n  isLoaded(): boolean {\r\n    return this._isLoaded;\r\n  }\r\n\r\n  /**\r\n   * Build a font from this FontSource.\r\n   * @param options {FontOptions} Override the font options\r\n   */\r\n  toFont(options?: FontOptions & GraphicOptions & RasterOptions): Font {\r\n    return new Font({ family: this.family, ...this._options, ...options });\r\n  }\r\n}\r\n","import { createContext, useContext } from '../Context';\r\nimport { Engine } from '../Engine';\r\nimport { ScheduledCallbackTiming } from './Clock';\r\nimport { Logger } from './Log';\r\nexport type CoroutineGenerator = () => Generator<any | number | Promise<any> | undefined, void, number>;\r\n\r\nconst InsideCoroutineContext = createContext<boolean>();\r\n\r\nconst generatorFunctionDeclaration = /^\\s*(?:function)?\\*/;\r\n/**\r\n *\r\n */\r\nfunction isCoroutineGenerator(x: any): x is CoroutineGenerator {\r\n  if (typeof x !== 'function') {\r\n    return false;\r\n  }\r\n  if (generatorFunctionDeclaration.test(Function.prototype.toString.call(x))) {\r\n    return true;\r\n  }\r\n  if (!Object.getPrototypeOf) {\r\n    return false;\r\n  }\r\n  return Object.getPrototypeOf(x) === Object.getPrototypeOf(new Function('return function * () {}')());\r\n}\r\n\r\nexport interface CoroutineOptions {\r\n  /**\r\n   * Coroutines run preframe in the clock by default.\r\n   */\r\n  timing?: ScheduledCallbackTiming;\r\n  /**\r\n   * Coroutines auto start by default, set to false to require play();\r\n   */\r\n  autostart?: boolean;\r\n}\r\n\r\ntype Thenable = PromiseLike<void>['then'];\r\n\r\nexport interface CoroutineInstance extends PromiseLike<void> {\r\n  isRunning(): boolean;\r\n  isComplete(): boolean;\r\n  done: Promise<void>;\r\n  generator: Generator<CoroutineInstance | number | Promise<any> | undefined, void, number>;\r\n  start: () => CoroutineInstance;\r\n  cancel: () => void;\r\n  then: Thenable;\r\n  [Symbol.iterator]: () => Generator<CoroutineInstance | number | Promise<any> | undefined, void, number>;\r\n}\r\n\r\n/**\r\n * Excalibur coroutine helper, returns a [[CoroutineInstance]] which is promise-like when complete. Coroutines run before frame update by default.\r\n *\r\n * Each coroutine yield is 1 excalibur frame. Coroutines get passed the elapsed time our of yield. Coroutines\r\n * run internally on the excalibur clock.\r\n *\r\n * If you yield a promise it will be awaited before resumed\r\n * If you yield a number it will wait that many ms before resumed\r\n * @param thisArg set the \"this\" context of the generator, by default is globalThis\r\n * @param engine pass a specific engine to use for running the coroutine\r\n * @param coroutineGenerator coroutine generator function\r\n * @param {CoroutineOptions} options optionally schedule coroutine pre/post update\r\n */\r\nexport function coroutine(\r\n  thisArg: any,\r\n  engine: Engine,\r\n  coroutineGenerator: CoroutineGenerator,\r\n  options?: CoroutineOptions\r\n): CoroutineInstance;\r\n/**\r\n * Excalibur coroutine helper, returns a promise when complete. Coroutines run before frame update.\r\n *\r\n * Each coroutine yield is 1 excalibur frame. Coroutines get passed the elapsed time our of yield. Coroutines\r\n * run internally on the excalibur clock.\r\n *\r\n * If you yield a promise it will be awaited before resumed\r\n * If you yield a number it will wait that many ms before resumed\r\n * @param engine pass a specific engine to use for running the coroutine\r\n * @param coroutineGenerator coroutine generator function\r\n * @param {CoroutineOptions} options optionally schedule coroutine pre/post update\r\n */\r\nexport function coroutine(engine: Engine, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n/**\r\n * Excalibur coroutine helper, returns a promise when complete. Coroutines run before frame update.\r\n *\r\n * Each coroutine yield is 1 excalibur frame. Coroutines get passed the elapsed time our of yield. Coroutines\r\n * run internally on the excalibur clock.\r\n *\r\n * If you yield a promise it will be awaited before resumed\r\n * If you yield a number it will wait that many ms before resumed\r\n * @param coroutineGenerator coroutine generator function\r\n * @param {CoroutineOptions} options optionally schedule coroutine pre/post update\r\n */\r\nexport function coroutine(coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n/**\r\n * Excalibur coroutine helper, returns a promise when complete. Coroutines run before frame update.\r\n *\r\n * Each coroutine yield is 1 excalibur frame. Coroutines get passed the elapsed time our of yield. Coroutines\r\n * run internally on the excalibur clock.\r\n *\r\n * If you yield a promise it will be awaited before resumed\r\n * If you yield a number it will wait that many ms before resumed\r\n * @param thisArg set the \"this\" context of the generator, by default is globalThis\r\n * @param coroutineGenerator coroutine generator function\r\n * @param {CoroutineOptions} options optionally schedule coroutine pre/post update\r\n */\r\nexport function coroutine(thisArg: any, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n/**\r\n *\r\n */\r\nexport function coroutine(...args: any[]): CoroutineInstance {\r\n  const logger = Logger.getInstance();\r\n  let coroutineGenerator: CoroutineGenerator;\r\n  let thisArg: any;\r\n  let options: CoroutineOptions | undefined;\r\n  let passedEngine: Engine | undefined;\r\n\r\n  // coroutine(coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n  if (isCoroutineGenerator(args[0])) {\r\n    thisArg = globalThis;\r\n    coroutineGenerator = args[0];\r\n    options = args[1];\r\n  }\r\n\r\n  // coroutine(thisArg: any, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n  if (isCoroutineGenerator(args[1])) {\r\n    thisArg = args[0];\r\n    coroutineGenerator = args[1];\r\n    options = args[2];\r\n  }\r\n\r\n  // coroutine(thisArg: any, engine: Engine, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n  if (args[1] instanceof Engine) {\r\n    thisArg = args[0];\r\n    passedEngine = args[1];\r\n    coroutineGenerator = args[2];\r\n    options = args[3];\r\n  }\r\n\r\n  // coroutine(engine: Engine, coroutineGenerator: CoroutineGenerator, options?: CoroutineOptions): CoroutineInstance;\r\n  if (args[0] instanceof Engine) {\r\n    thisArg = globalThis;\r\n    passedEngine = args[0];\r\n    coroutineGenerator = args[1];\r\n    options = args[2];\r\n  }\r\n\r\n  const inside = useContext(InsideCoroutineContext);\r\n  const schedule = options?.timing;\r\n  const autostart = inside ? false : options?.autostart ?? true;\r\n  let engine: Engine;\r\n  try {\r\n    engine = passedEngine ?? Engine.useEngine();\r\n  } catch (_) {\r\n    throw Error(\r\n      'Cannot run coroutine without engine parameter outside of an excalibur lifecycle method.\\n' +\r\n        'Pass an engine parameter to ex.coroutine(engine, function * {...})'\r\n    );\r\n  }\r\n\r\n  let started = false;\r\n  let completed = false;\r\n  let cancelled = false;\r\n  const generatorFcn = coroutineGenerator.bind(thisArg) as CoroutineGenerator;\r\n  const generator = generatorFcn();\r\n  let loop: (elapsed: number) => void;\r\n  const complete = new Promise<void>((resolve, reject) => {\r\n    loop = (elapsed: number) => {\r\n      try {\r\n        if (cancelled) {\r\n          completed = true;\r\n          resolve();\r\n          return;\r\n        }\r\n        const { done, value } = InsideCoroutineContext.scope(true, () => generator.next(elapsed));\r\n        if (done || cancelled) {\r\n          completed = true;\r\n          resolve();\r\n          return;\r\n        }\r\n\r\n        if (value instanceof Promise) {\r\n          value.then(() => {\r\n            // schedule next loop\r\n            engine.clock.schedule(loop, 0, schedule);\r\n          });\r\n        } else if (value === undefined || value === void 0) {\r\n          // schedule next frame\r\n          engine.clock.schedule(loop, 0, schedule);\r\n        } else {\r\n          // schedule value milliseconds from now\r\n          engine.clock.schedule(loop, value || 0, schedule);\r\n        }\r\n      } catch (e) {\r\n        reject(e);\r\n        return;\r\n      }\r\n    };\r\n    if (autostart) {\r\n      started = true;\r\n      loop(engine.clock.elapsed()); // run first frame immediately\r\n    }\r\n  });\r\n\r\n  const co: CoroutineInstance = {\r\n    isRunning: () => {\r\n      return started && !cancelled && !completed;\r\n    },\r\n    isComplete: () => {\r\n      return completed;\r\n    },\r\n    cancel: () => {\r\n      cancelled = true;\r\n    },\r\n    start: () => {\r\n      if (!started) {\r\n        started = true;\r\n        loop(engine.clock.elapsed());\r\n      } else {\r\n        logger.warn(\r\n          '.start() was called on a coroutine that was already started, this is probably a bug:\\n',\r\n          Function.prototype.toString.call(generatorFcn)\r\n        );\r\n      }\r\n      return co;\r\n    },\r\n    generator,\r\n    done: complete,\r\n    then: complete.then.bind(complete),\r\n    [Symbol.iterator]: () => {\r\n      // TODO warn if a coroutine is already running\r\n      // TODO warn if a coroutine is cancelled\r\n      return generator;\r\n    }\r\n  };\r\n\r\n  return co;\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Future } from '../Util/Future';\r\nimport { Entity, TransformComponent } from '../EntityComponentSystem';\r\nimport { GraphicsComponent } from '../Graphics';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { Vector } from '../Math/vector';\r\nimport { clamp } from '../Math/util';\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { coroutine, CoroutineInstance } from '../Util/Coroutine';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport interface TransitionOptions {\r\n  /**\r\n   * Transition duration in milliseconds\r\n   */\r\n  duration: number;\r\n\r\n  /**\r\n   * Optionally hides the loader during the transition\r\n   *\r\n   * If either the out or in transition have this set to true, then the loader will be hidden.\r\n   *\r\n   * Default false\r\n   */\r\n  hideLoader?: boolean;\r\n\r\n  /**\r\n   * Optionally blocks user input during a transition\r\n   *\r\n   * Default false\r\n   */\r\n  blockInput?: boolean;\r\n\r\n  /**\r\n   * Optionally specify a easing function, by default linear\r\n   */\r\n  easing?: EasingFunction;\r\n  /**\r\n   * Optionally specify a transition direction, by default 'out'\r\n   *\r\n   * * For 'in' direction transitions start at 1 and complete is at 0\r\n   * * For 'out' direction transitions start at 0 and complete is at 1\r\n   */\r\n  direction?: 'out' | 'in';\r\n}\r\n\r\n/**\r\n * Base Transition that can be extended to provide custom scene transitions in Excalibur.\r\n */\r\nexport class Transition extends Entity {\r\n  private _logger: Logger = Logger.getInstance();\r\n  transform = new TransformComponent();\r\n  graphics = new GraphicsComponent();\r\n  readonly hideLoader: boolean;\r\n  readonly blockInput: boolean;\r\n  readonly duration: number;\r\n  readonly easing: EasingFunction;\r\n  readonly direction: 'out' | 'in';\r\n  private _completeFuture = new Future<void>();\r\n  protected _engine?: Engine;\r\n  private _co?: CoroutineInstance;\r\n\r\n  // State needs to be reset between uses\r\n  public started = false;\r\n  private _currentDistance: number = 0;\r\n  private _currentProgress: number = 0;\r\n\r\n  public done = this._completeFuture.promise;\r\n\r\n  /**\r\n   * Returns a number between [0, 1] indicating what state the transition is in.\r\n   *\r\n   * * For 'out' direction transitions start at 0 and end at 1\r\n   * * For 'in' direction transitions start at 1 and end at 0\r\n   */\r\n  get progress(): number {\r\n    return this._currentProgress;\r\n  }\r\n\r\n  get complete(): boolean {\r\n    if (this.direction === 'out') {\r\n      return this.progress >= 1;\r\n    } else {\r\n      return this.progress <= 0;\r\n    }\r\n  }\r\n\r\n  constructor(options: TransitionOptions) {\r\n    super();\r\n    this.name = `Transition#${this.id}`;\r\n    this.duration = options.duration;\r\n    this.easing = options.easing ?? EasingFunctions.Linear;\r\n    this.direction = options.direction ?? 'out';\r\n    this.hideLoader = options.hideLoader ?? false;\r\n    this.blockInput = options.blockInput ?? false;\r\n    this.transform.coordPlane = CoordPlane.Screen;\r\n    this.transform.pos = Vector.Zero;\r\n    this.transform.z = Infinity; // Transitions sit on top of everything\r\n    this.graphics.anchor = Vector.Zero;\r\n    this.addComponent(this.transform);\r\n    this.addComponent(this.graphics);\r\n\r\n    if (this.direction === 'out') {\r\n      this._currentProgress = 0;\r\n    } else {\r\n      this._currentProgress = 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called before each update.\r\n   *\r\n   * **WARNING BE SURE** to call `super.updateTransition()` if overriding in your own custom implementation\r\n   * @param engine\r\n   * @param elapsed\r\n   */\r\n  public updateTransition(engine: Engine, elapsed: number): void {\r\n    if (this.complete) {\r\n      return;\r\n    }\r\n\r\n    this._currentDistance += clamp(elapsed / this.duration, 0, 1);\r\n    if (this._currentDistance >= 1) {\r\n      this._currentDistance = 1;\r\n    }\r\n\r\n    if (this.direction === 'out') {\r\n      this._currentProgress = clamp(this.easing(this._currentDistance, 0, 1, 1), 0, 1);\r\n    } else {\r\n      this._currentProgress = clamp(this.easing(this._currentDistance, 1, 0, 1), 0, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called right before the previous scene has deactivated.\r\n   *\r\n   * This gives incoming transition a chance to grab info from previous scene if desired\r\n   * @param scene\r\n   */\r\n  async onPreviousSceneDeactivate(scene: Scene) {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called once at the beginning of the transition\r\n   *\r\n   * `progress` is given between 0 and 1\r\n   * @param progress\r\n   */\r\n  onStart(progress: number) {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called every frame of the transition\r\n   *\r\n   * `progress` is given between 0 and 1\r\n   * @param progress\r\n   */\r\n  onUpdate(progress: number) {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called at the end of the transition,\r\n   *\r\n   * `progress` is given between 0 and 1\r\n   * @param progress\r\n   */\r\n  onEnd(progress: number) {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * Overridable lifecycle method, called when the transition is reset\r\n   *\r\n   * Use this to override and provide your own reset logic for internal state in custom transition implementations\r\n   */\r\n  onReset() {\r\n    // override me\r\n  }\r\n\r\n  /**\r\n   * reset() is called by the engine to reset transitions\r\n   */\r\n  reset() {\r\n    this.started = false;\r\n    this._completeFuture = new Future<void>();\r\n    this.done = this._completeFuture.promise;\r\n    this._currentDistance = 0;\r\n    if (this.direction === 'out') {\r\n      this._currentProgress = 0;\r\n    } else {\r\n      this._currentProgress = 1;\r\n    }\r\n    this.onReset();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  _addToTargetScene(engine: Engine, targetScene: Scene): CoroutineInstance {\r\n    const currentScene = targetScene;\r\n    if (this.started) {\r\n      this._logger.warn(`Attempted to add a transition ${this.name} that is already playing.`);\r\n    }\r\n\r\n    if (currentScene.world.entityManager.getById(this.id)) {\r\n      return this._co!;\r\n    }\r\n    this._engine = engine;\r\n    currentScene.add(this);\r\n    const self = this;\r\n    this._co = coroutine(\r\n      engine,\r\n      function* () {\r\n        while (!self.complete) {\r\n          const elapsed = yield; // per frame\r\n          self.updateTransition(self._engine!, elapsed);\r\n          self._execute();\r\n        }\r\n      },\r\n      {\r\n        autostart: false\r\n      }\r\n    );\r\n    return this._co;\r\n  }\r\n\r\n  /**\r\n   * Called internally by excalibur to swap scenes with transition\r\n   * @internal\r\n   */\r\n  async _play() {\r\n    if (this.started) {\r\n      this.reset();\r\n      this._logger.warn(`Attempted to play a transition ${this.name} that is already playing, reset transition.`);\r\n    }\r\n\r\n    if (!this._engine || !this._co) {\r\n      this.reset();\r\n      this._logger.warn(`Attempted to play a transition ${this.name} that hasn't been added`);\r\n    }\r\n\r\n    if (this._co) {\r\n      await this._co.start();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * execute() is called by the engine every frame to update the Transition lifecycle onStart/onUpdate/onEnd\r\n   * @internal\r\n   */\r\n  _execute() {\r\n    if (!this.isInitialized) {\r\n      return;\r\n    }\r\n\r\n    if (!this.started) {\r\n      this.started = true;\r\n      this.onStart(this.progress);\r\n    }\r\n\r\n    this.onUpdate(this.progress);\r\n\r\n    if (this.complete && !this._completeFuture.isCompleted) {\r\n      this.onEnd(this.progress);\r\n      this._completeFuture.resolve();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { Rectangle } from '../Graphics';\r\nimport { Transition, TransitionOptions } from './Transition';\r\n\r\nexport interface FadeOptions {\r\n  duration?: number;\r\n  color?: Color;\r\n}\r\n\r\nexport class FadeInOut extends Transition {\r\n  screenCover!: Rectangle;\r\n  color: Color;\r\n  constructor(options: FadeOptions & TransitionOptions) {\r\n    super({\r\n      ...options,\r\n      duration: options.duration ?? 2000\r\n    });\r\n    this.name = `FadeInOut#${this.id}`;\r\n    this.color = options.color ?? Color.Black;\r\n  }\r\n\r\n  public onInitialize(engine: Engine): void {\r\n    this.transform.pos = engine.screen.unsafeArea.topLeft;\r\n    this.screenCover = new Rectangle({\r\n      width: engine.screen.resolution.width,\r\n      height: engine.screen.resolution.height,\r\n      color: this.color\r\n    });\r\n    this.graphics.add(this.screenCover);\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onReset() {\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onStart(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n\r\n  override onEnd(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n\r\n  override onUpdate(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n}\r\n","import { ImageSource, Sprite } from '../Graphics';\r\nimport { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Transition, TransitionOptions } from './Transition';\r\nimport { vec } from '../Math/vector';\r\n\r\nexport interface CrossFadeOptions {\r\n  duration: number;\r\n}\r\n\r\n/**\r\n * CrossFades between the previous scene and the destination scene\r\n *\r\n * Note: CrossFade only works as an \"in\" transition\r\n */\r\nexport class CrossFade extends Transition {\r\n  engine!: Engine;\r\n  image!: HTMLImageElement;\r\n  screenCover!: Sprite;\r\n  constructor(options: TransitionOptions & CrossFadeOptions) {\r\n    super({ direction: 'in', ...options }); // default the correct direction\r\n    this.name = `CrossFade#${this.id}`;\r\n  }\r\n\r\n  override async onPreviousSceneDeactivate(scene: Scene<unknown>) {\r\n    this.image = await scene.engine.screenshot(true);\r\n    // Firefox is particularly slow\r\n    // needed in case the image isn't ready yet\r\n    await this.image.decode();\r\n  }\r\n\r\n  override onInitialize(engine: Engine): void {\r\n    this.engine = engine;\r\n    this.transform.pos = engine.screen.unsafeArea.topLeft;\r\n    this.screenCover = ImageSource.fromHtmlImageElement(this.image).toSprite();\r\n    this.graphics.add(this.screenCover);\r\n\r\n    // This is because we preserve hidpi res on the screen shot which COULD be bigger than the logical resolution\r\n    this.transform.scale = vec(1 / engine.screen.pixelRatio, 1 / engine.screen.pixelRatio);\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onStart(_progress: number): void {\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onReset() {\r\n    this.graphics.opacity = this.progress;\r\n  }\r\n\r\n  override onEnd(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n\r\n  override onUpdate(progress: number): void {\r\n    this.graphics.opacity = progress;\r\n  }\r\n}\r\n","import { ImageSource, Sprite } from '../Graphics';\r\nimport { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Transition, TransitionOptions } from './Transition';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { Camera } from '../Camera';\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\n\r\nexport interface SlideOptions {\r\n  /**\r\n   * Duration of the transition in milliseconds\r\n   */\r\n  duration: number;\r\n  /**\r\n   * Slide direction for the previous scene to move: up, down, left, right\r\n   */\r\n  slideDirection: 'up' | 'down' | 'left' | 'right';\r\n  /**\r\n   * Optionally select an easing function, by default linear (aka lerp)\r\n   */\r\n  easingFunction?: EasingFunction;\r\n}\r\n\r\n/**\r\n * Slide`s between the previous scene and the destination scene\r\n *\r\n * Note: Slide` only works as an \"in\" transition\r\n */\r\nexport class Slide extends Transition {\r\n  private _image!: HTMLImageElement;\r\n  private _screenCover!: Sprite;\r\n  private _easing = EasingFunctions.Linear;\r\n  private _vectorEasing: EasingFunction<Vector>;\r\n  readonly slideDirection: 'up' | 'down' | 'left' | 'right';\r\n  constructor(options: TransitionOptions & SlideOptions) {\r\n    super({ direction: 'in', ...options }); // default the correct direction\r\n    this.name = `Slide#${this.id}`;\r\n    this.slideDirection = options.slideDirection;\r\n    this.transform.coordPlane = CoordPlane.World;\r\n    this.graphics.forceOnScreen = true;\r\n    this._easing = options.easingFunction ?? this._easing;\r\n    this._vectorEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n  }\r\n\r\n  override async onPreviousSceneDeactivate(scene: Scene<unknown>) {\r\n    this._image = await scene.engine.screenshot(true);\r\n    // Firefox is particularly slow\r\n    // needed in case the image isn't ready yet\r\n    await this._image.decode();\r\n    this._screenCover = ImageSource.fromHtmlImageElement(this._image).toSprite();\r\n  }\r\n\r\n  private _destinationCameraPosition!: Vector;\r\n  private _startCameraPosition!: Vector;\r\n  private _camera!: Camera;\r\n  private _directionOffset!: Vector;\r\n  override onInitialize(engine: Engine): void {\r\n    this._engine = engine;\r\n    switch (this.slideDirection) {\r\n      case 'up': {\r\n        this._directionOffset = vec(0, -engine.screen.resolution.height);\r\n        break;\r\n      }\r\n      case 'down': {\r\n        this._directionOffset = vec(0, engine.screen.resolution.height);\r\n        break;\r\n      }\r\n      case 'left': {\r\n        this._directionOffset = vec(-engine.screen.resolution.width, 0);\r\n        break;\r\n      }\r\n      case 'right': {\r\n        this._directionOffset = vec(engine.screen.resolution.width, 0);\r\n        break;\r\n      }\r\n    }\r\n\r\n    this._camera = this._engine.currentScene.camera;\r\n    this._destinationCameraPosition = this._camera.pos.clone();\r\n\r\n    // For sliding shift the camera and the transition slide by offset\r\n    this._camera.pos = this._camera.pos.add(this._directionOffset);\r\n    this.transform.pos = this.transform.pos.add(this._directionOffset);\r\n\r\n    this._startCameraPosition = this._camera.pos.clone();\r\n\r\n    this.graphics.use(this._screenCover);\r\n\r\n    // This is because we preserve hidpi res on the screen shot which COULD be bigger than the logical resolution\r\n    this.transform.scale = vec(1 / engine.screen.pixelRatio, 1 / engine.screen.pixelRatio);\r\n  }\r\n\r\n  override onUpdate(progress: number): void {\r\n    // in-transitions count down from 1 -> 0, so our \"end\" is swapped\r\n    this._camera.pos = this._vectorEasing(progress, this._destinationCameraPosition, this._startCameraPosition, 1);\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Graphic } from './Graphic';\r\n\r\nexport interface LineOptions {\r\n  start: Vector;\r\n  end: Vector;\r\n  color?: Color;\r\n  thickness?: number;\r\n}\r\nexport class Line extends Graphic {\r\n  readonly start: Vector;\r\n  readonly end: Vector;\r\n  color: Color = Color.Black;\r\n  thickness: number = 1;\r\n  private _localBounds: BoundingBox;\r\n  constructor(options: LineOptions) {\r\n    super();\r\n    const { start, end, color, thickness } = options;\r\n    this.start = start;\r\n    this.end = end;\r\n    this.color = color ?? this.color;\r\n    this.thickness = thickness ?? this.thickness;\r\n    this._localBounds = this._calculateBounds();\r\n    const { width, height } = this._localBounds;\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  public get localBounds() {\r\n    return this._localBounds;\r\n  }\r\n\r\n  private _calculateBounds(): BoundingBox {\r\n    const lineNormal = this.end.sub(this.start).normal();\r\n\r\n    const halfThickness = this.thickness / 2;\r\n\r\n    const points = [\r\n      this.start.add(lineNormal.scale(halfThickness)),\r\n      this.end.add(lineNormal.scale(halfThickness)),\r\n      this.end.add(lineNormal.scale(-halfThickness)),\r\n      this.start.add(lineNormal.scale(-halfThickness))\r\n    ];\r\n\r\n    return BoundingBox.fromPoints(points);\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, _x: number, _y: number): void {\r\n    ctx.drawLine(this.start, this.end, this.color, this.thickness);\r\n  }\r\n\r\n  clone(): Line {\r\n    return new Line({\r\n      start: this.start,\r\n      end: this.end,\r\n      color: this.color,\r\n      thickness: this.thickness\r\n    });\r\n  }\r\n}\r\n","import { ImageFiltering } from './Filtering';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface PolygonOptions {\r\n  points: Vector[];\r\n}\r\n\r\n/**\r\n * A polygon {@apilink Graphic} for drawing arbitrary polygons to the {@apilink ExcaliburGraphicsContext}\r\n *\r\n * Polygons default to {@apilink ImageFiltering.Blended}\r\n */\r\nexport class Polygon extends Raster {\r\n  private _points: Vector[] = [];\r\n  public get points(): Vector[] {\r\n    return this._points;\r\n  }\r\n  public set points(points: Vector[]) {\r\n    this._points = points;\r\n    const min = this.minPoint;\r\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\r\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\r\n    this.flagDirty();\r\n  }\r\n\r\n  public get minPoint() {\r\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\r\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\r\n    return vec(minX, minY);\r\n  }\r\n\r\n  constructor(options: RasterOptions & PolygonOptions) {\r\n    super(options);\r\n    this.points = options.points;\r\n    this.filtering = ImageFiltering.Blended;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Polygon {\r\n    return new Polygon({\r\n      points: this.points.map((p) => p.clone()),\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.points && this.points.length) {\r\n      ctx.beginPath();\r\n      // Iterate through the supplied points and construct a 'polygon'\r\n      const min = this.minPoint.negate();\r\n      const firstPoint = this.points[0].add(min);\r\n      ctx.moveTo(firstPoint.x, firstPoint.y);\r\n      this.points.forEach((point) => {\r\n        ctx.lineTo(point.x + min.x, point.y + min.y);\r\n      });\r\n      ctx.lineTo(firstPoint.x, firstPoint.y);\r\n      ctx.closePath();\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { ImageSource } from './ImageSource';\r\nimport { Logger } from '../Util/Log';\r\nimport { Vector } from '../Math/vector';\r\n\r\n/**\r\n * Nine slice stretch mode\r\n */\r\nexport enum NineSliceStretch {\r\n  /**\r\n   * Stretch the image across a dimension\r\n   */\r\n  Stretch = 'stretch',\r\n  /**\r\n   * Tile the image across a dimension\r\n   */\r\n  Tile = 'tile',\r\n  /**\r\n   * Tile the image across a dimension but only by whole image amounts\r\n   */\r\n  TileFit = 'tile-fit'\r\n}\r\n\r\nexport type NineSliceConfig = GraphicOptions & {\r\n  /**\r\n   * Final width of the nine slice graphic\r\n   */\r\n  width: number;\r\n  /**\r\n   * Final height of the nine slice graphic\r\n   */\r\n  height: number;\r\n  /**\r\n   *  Image source that's loaded from a Loader or individually\r\n   *\r\n   */\r\n  source: ImageSource;\r\n\r\n  /**\r\n   *  Configuration for the source\r\n   *\r\n   *  Details for the source image, including:\r\n   *\r\n   *  width and height as numbers of the source image\r\n   *\r\n   *  and the 9 slice margins\r\n   */\r\n  sourceConfig: {\r\n    width: number;\r\n    height: number;\r\n    topMargin: number;\r\n    leftMargin: number;\r\n    bottomMargin: number;\r\n    rightMargin: number;\r\n  };\r\n\r\n  /**\r\n   *  Configuration for the destination\r\n   *\r\n   *  Details for the destination image, including:\r\n   *\r\n   *  stretching strategies for horizontal and vertical stretching\r\n   *\r\n   *  and flag for drawing the center tile if desired\r\n   */\r\n  destinationConfig: {\r\n    /**\r\n     * Draw the center part of the nine slice, if false it's a completely transparent gap\r\n     */\r\n    drawCenter: boolean;\r\n    /**\r\n     * Horizontal stretch configuration\r\n     */\r\n    horizontalStretch: NineSliceStretch;\r\n    /**\r\n     * Vertical stretch configuration\r\n     */\r\n    verticalStretch: NineSliceStretch;\r\n  };\r\n};\r\n\r\nexport class NineSlice extends Graphic {\r\n  private _imgSource: ImageSource;\r\n  private _sourceSprite?: HTMLImageElement;\r\n  private _canvasA: HTMLCanvasElement;\r\n  private _canvasB: HTMLCanvasElement;\r\n  private _canvasC: HTMLCanvasElement;\r\n  private _canvasD: HTMLCanvasElement;\r\n  private _canvasE: HTMLCanvasElement;\r\n  private _canvasF: HTMLCanvasElement;\r\n  private _canvasG: HTMLCanvasElement;\r\n  private _canvasH: HTMLCanvasElement;\r\n  private _canvasI: HTMLCanvasElement;\r\n\r\n  private _logger = Logger.getInstance();\r\n\r\n  private _config: NineSliceConfig;\r\n  constructor(config: NineSliceConfig) {\r\n    super(config);\r\n    this._config = config;\r\n    this._imgSource = config.source;\r\n\r\n    this._canvasA = document.createElement('canvas');\r\n    this._canvasB = document.createElement('canvas');\r\n    this._canvasC = document.createElement('canvas');\r\n    this._canvasD = document.createElement('canvas');\r\n    this._canvasE = document.createElement('canvas');\r\n    this._canvasF = document.createElement('canvas');\r\n    this._canvasG = document.createElement('canvas');\r\n    this._canvasH = document.createElement('canvas');\r\n    this._canvasI = document.createElement('canvas');\r\n\r\n    this._initialize();\r\n\r\n    this._imgSource.ready.then(() => {\r\n      this._initialize();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sets the target width of the 9 slice (pixels), and recalculates the 9 slice if desired (auto)\r\n   * @param newWidth\r\n   * @param auto\r\n   */\r\n  setTargetWidth(newWidth: number, auto: boolean = false) {\r\n    this._config.width = newWidth;\r\n    if (auto) {\r\n      this._initialize();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the target height of the 9 slice (pixels), and recalculates the 9 slice if desired (auto)\r\n   * @param newHeight\r\n   * @param auto\r\n   */\r\n  setTargetHeight(newHeight: number, auto: boolean = false) {\r\n    this._config.height = newHeight;\r\n    if (auto) {\r\n      this._initialize();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  Sets the 9 slice margins (pixels), and recalculates the 9 slice if desired (auto)\r\n   */\r\n  setMargins(left: number, top: number, right: number, bottom: number, auto: boolean = false) {\r\n    this._config.sourceConfig.leftMargin = left;\r\n    this._config.sourceConfig.topMargin = top;\r\n    this._config.sourceConfig.rightMargin = right;\r\n    this._config.sourceConfig.bottomMargin = bottom;\r\n    if (auto) {\r\n      this._initialize();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  Sets the stretching strategy for the 9 slice, and recalculates the 9 slice if desired (auto)\r\n   *\r\n   */\r\n  setStretch(type: 'horizontal' | 'vertical' | 'both', stretch: NineSliceStretch, auto: boolean = false) {\r\n    if (type === 'horizontal') {\r\n      this._config.destinationConfig.horizontalStretch = stretch;\r\n    } else if (type === 'vertical') {\r\n      this._config.destinationConfig.verticalStretch = stretch;\r\n    } else {\r\n      this._config.destinationConfig.horizontalStretch = stretch;\r\n      this._config.destinationConfig.verticalStretch = stretch;\r\n    }\r\n    if (auto) {\r\n      this._initialize();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  Returns the config of the 9 slice\r\n   */\r\n  getConfig(): NineSliceConfig {\r\n    return this._config;\r\n  }\r\n\r\n  /**\r\n   * Draws 1 of the 9 tiles based on parameters passed in\r\n   * context is the ExcaliburGraphicsContext from the _drawImage function\r\n   * destinationSize is the size of the destination image as a vector (width,height)\r\n   * targetCanvas is the canvas to draw to\r\n   * horizontalStretch and verticalStretch are the horizontal and vertical stretching strategies\r\n   * marginW and marginH are optional margins for the 9 slice for positioning\r\n   * @param context\r\n   * @param targetCanvas\r\n   * @param destinationSize\r\n   * @param horizontalStretch\r\n   * @param verticalStretch\r\n   * @param marginWidth\r\n   * @param marginHeight\r\n   */\r\n  protected _drawTile(\r\n    context: ExcaliburGraphicsContext,\r\n    targetCanvas: HTMLCanvasElement,\r\n    destinationSize: Vector,\r\n    horizontalStretch: NineSliceStretch,\r\n    verticalStretch: NineSliceStretch,\r\n    marginWidth?: number,\r\n    marginHeight?: number\r\n  ) {\r\n    const tempMarginW = marginWidth || 0;\r\n    const tempMarginH = marginHeight || 0;\r\n    let tempSizeX: number, tempPositionX: number, tempSizeY: number, tempPositionY: number;\r\n    const numTilesX = this._getNumberOfTiles(targetCanvas.width, destinationSize.x, horizontalStretch);\r\n    const numTilesY = this._getNumberOfTiles(targetCanvas.height, destinationSize.y, verticalStretch);\r\n\r\n    for (let i = 0; i < numTilesX; i++) {\r\n      for (let j = 0; j < numTilesY; j++) {\r\n        let { tempSize, tempPosition } = this._calculateParams(\r\n          i,\r\n          numTilesX,\r\n          targetCanvas.width,\r\n          destinationSize.x,\r\n          this._config.destinationConfig.horizontalStretch\r\n        );\r\n        tempSizeX = tempSize;\r\n        tempPositionX = tempPosition;\r\n\r\n        ({ tempSize, tempPosition } = this._calculateParams(\r\n          j,\r\n          numTilesY,\r\n          targetCanvas.height,\r\n          destinationSize.y,\r\n          this._config.destinationConfig.verticalStretch\r\n        ));\r\n        tempSizeY = tempSize;\r\n        tempPositionY = tempPosition;\r\n\r\n        context.drawImage(\r\n          targetCanvas,\r\n          0,\r\n          0,\r\n          targetCanvas.width,\r\n          targetCanvas.height,\r\n          tempMarginW + tempPositionX,\r\n          tempMarginH + tempPositionY,\r\n          tempSizeX,\r\n          tempSizeY\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  Draws the 9 slices to the canvas\r\n   */\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this._imgSource.isLoaded()) {\r\n      // Top left, no stretching\r\n\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasA,\r\n\r\n        new Vector(this._config.sourceConfig.leftMargin, this._config.sourceConfig.topMargin),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch\r\n      );\r\n\r\n      // Top, middle, horizontal stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasB,\r\n\r\n        new Vector(\r\n          this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin,\r\n          this._config.sourceConfig.topMargin\r\n        ),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n        this._config.sourceConfig.leftMargin,\r\n        0\r\n      );\r\n\r\n      // Top right, no stretching\r\n\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasC,\r\n\r\n        new Vector(this._config.sourceConfig.rightMargin, this._config.sourceConfig.topMargin),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n\r\n        this._config.width - this._config.sourceConfig.rightMargin,\r\n        0\r\n      );\r\n\r\n      // middle, left, vertical stretching\r\n\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasD,\r\n        new Vector(\r\n          this._config.sourceConfig.leftMargin,\r\n\r\n          this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin\r\n        ),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n        0,\r\n        this._config.sourceConfig.topMargin\r\n      );\r\n\r\n      // center, both stretching\r\n      if (this._config.destinationConfig.drawCenter) {\r\n        this._drawTile(\r\n          ex,\r\n          this._canvasE,\r\n          new Vector(\r\n            this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin,\r\n\r\n            this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin\r\n          ),\r\n          this._config.destinationConfig.horizontalStretch,\r\n          this._config.destinationConfig.verticalStretch,\r\n          this._config.sourceConfig.leftMargin,\r\n          this._config.sourceConfig.topMargin\r\n        );\r\n      }\r\n      // middle, right, vertical stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasF,\r\n\r\n        new Vector(\r\n          this._config.sourceConfig.rightMargin,\r\n\r\n          this._config.height - this._config.sourceConfig.bottomMargin - this._config.sourceConfig.topMargin\r\n        ),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n\r\n        this._config.width - this._config.sourceConfig.rightMargin,\r\n        this._config.sourceConfig.topMargin\r\n      );\r\n\r\n      // bottom left, no stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasG,\r\n        new Vector(this._config.sourceConfig.leftMargin, this._config.sourceConfig.bottomMargin),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n        0,\r\n\r\n        this._config.height - this._config.sourceConfig.bottomMargin\r\n      );\r\n\r\n      // bottom middle, horizontal stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasH,\r\n\r\n        new Vector(\r\n          this._config.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin,\r\n          this._config.sourceConfig.bottomMargin\r\n        ),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n        this._config.sourceConfig.leftMargin,\r\n\r\n        this._config.height - this._config.sourceConfig.bottomMargin\r\n      );\r\n\r\n      // bottom right, no stretching\r\n      this._drawTile(\r\n        ex,\r\n        this._canvasI,\r\n        new Vector(this._config.sourceConfig.rightMargin, this._config.sourceConfig.bottomMargin),\r\n        this._config.destinationConfig.horizontalStretch,\r\n        this._config.destinationConfig.verticalStretch,\r\n\r\n        this._config.width - this._config.sourceConfig.rightMargin,\r\n\r\n        this._config.height - this._config.sourceConfig.bottomMargin\r\n      );\r\n    } else {\r\n      this._logger.warnOnce(\r\n        `NineSlice ImageSource ${this._imgSource.path}` +\r\n          ` is not yet loaded and won't be drawn. Please call .load() or include in a Loader.\\n\\n` +\r\n          `Read https://excaliburjs.com/docs/imagesource for more information.`\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Slices the source sprite into the 9 slice canvases internally\r\n   */\r\n  protected _initialize() {\r\n    this._sourceSprite = this._imgSource.image;\r\n\r\n    // top left slice\r\n    this._canvasA.width = this._config.sourceConfig.leftMargin;\r\n    this._canvasA.height = this._config.sourceConfig.topMargin;\r\n    const aCtx = this._canvasA.getContext('2d');\r\n\r\n    aCtx?.drawImage(this._sourceSprite, 0, 0, this._canvasA.width, this._canvasA.height, 0, 0, this._canvasA.width, this._canvasA.height);\r\n\r\n    // top slice\r\n\r\n    this._canvasB.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\r\n    this._canvasB.height = this._config.sourceConfig.topMargin;\r\n\r\n    const bCtx = this._canvasB.getContext('2d');\r\n    bCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._config.sourceConfig.leftMargin,\r\n      0,\r\n      this._canvasB.width,\r\n      this._canvasB.height,\r\n      0,\r\n      0,\r\n      this._canvasB.width,\r\n      this._canvasB.height\r\n    );\r\n\r\n    // top right slice\r\n    this._canvasC.width = this._config.sourceConfig.rightMargin;\r\n    this._canvasC.height = this._config.sourceConfig.topMargin;\r\n    const cCtx = this._canvasC.getContext('2d');\r\n    cCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._sourceSprite.width - this._config.sourceConfig.rightMargin,\r\n      0,\r\n      this._canvasC.width,\r\n      this._canvasC.height,\r\n      0,\r\n      0,\r\n      this._canvasC.width,\r\n      this._canvasC.height\r\n    );\r\n\r\n    // middle left slice\r\n    this._canvasD.width = this._config.sourceConfig.leftMargin;\r\n    this._canvasD.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\r\n    const dCtx = this._canvasD.getContext('2d');\r\n    dCtx?.drawImage(\r\n      this._sourceSprite,\r\n      0,\r\n      this._config.sourceConfig.topMargin,\r\n      this._canvasD.width,\r\n      this._canvasD.height,\r\n      0,\r\n      0,\r\n      this._canvasD.width,\r\n      this._canvasD.height\r\n    );\r\n\r\n    // middle slice\r\n    this._canvasE.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\r\n    this._canvasE.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\r\n    const eCtx = this._canvasE.getContext('2d');\r\n    eCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._config.sourceConfig.leftMargin,\r\n      this._config.sourceConfig.topMargin,\r\n      this._canvasE.width,\r\n      this._canvasE.height,\r\n      0,\r\n      0,\r\n      this._canvasE.width,\r\n      this._canvasE.height\r\n    );\r\n\r\n    // middle right slice\r\n    this._canvasF.width = this._config.sourceConfig.rightMargin;\r\n    this._canvasF.height = this._config.sourceConfig.height - this._config.sourceConfig.topMargin - this._config.sourceConfig.bottomMargin;\r\n    const fCtx = this._canvasF.getContext('2d');\r\n    fCtx?.drawImage(\r\n      this._sourceSprite,\r\n\r\n      this._config.sourceConfig.width - this._config.sourceConfig.rightMargin,\r\n      this._config.sourceConfig.topMargin,\r\n      this._canvasF.width,\r\n      this._canvasF.height,\r\n      0,\r\n      0,\r\n      this._canvasF.width,\r\n      this._canvasF.height\r\n    );\r\n\r\n    // bottom left slice\r\n    this._canvasG.width = this._config.sourceConfig.leftMargin;\r\n    this._canvasG.height = this._config.sourceConfig.bottomMargin;\r\n    const gCtx = this._canvasG.getContext('2d');\r\n    gCtx?.drawImage(\r\n      this._sourceSprite,\r\n      0,\r\n      this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin,\r\n      this._canvasG.width,\r\n      this._canvasG.height,\r\n      0,\r\n      0,\r\n      this._canvasG.width,\r\n      this._canvasG.height\r\n    );\r\n\r\n    // bottom slice\r\n    this._canvasH.width = this._config.sourceConfig.width - this._config.sourceConfig.leftMargin - this._config.sourceConfig.rightMargin;\r\n    this._canvasH.height = this._config.sourceConfig.bottomMargin;\r\n    const hCtx = this._canvasH.getContext('2d');\r\n    hCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._config.sourceConfig.leftMargin,\r\n      this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin,\r\n      this._canvasH.width,\r\n      this._canvasH.height,\r\n      0,\r\n      0,\r\n      this._canvasH.width,\r\n      this._canvasH.height\r\n    );\r\n\r\n    // bottom right slice\r\n    this._canvasI.width = this._config.sourceConfig.rightMargin;\r\n    this._canvasI.height = this._config.sourceConfig.bottomMargin;\r\n    const iCtx = this._canvasI.getContext('2d');\r\n    iCtx?.drawImage(\r\n      this._sourceSprite,\r\n      this._sourceSprite.width - this._config.sourceConfig.rightMargin,\r\n      this._config.sourceConfig.height - this._config.sourceConfig.bottomMargin,\r\n      this._canvasI.width,\r\n      this._canvasI.height,\r\n      0,\r\n      0,\r\n      this._canvasI.width,\r\n      this._canvasI.height\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Clones the 9 slice\r\n   */\r\n\r\n  clone(): NineSlice {\r\n    return new NineSlice(this._config);\r\n  }\r\n\r\n  /**\r\n   * Returns the number of tiles\r\n   */\r\n  protected _getNumberOfTiles(tileSize: number, destinationSize: number, strategy: NineSliceStretch): number {\r\n    switch (strategy) {\r\n      case NineSliceStretch.Stretch:\r\n        return 1;\r\n      case NineSliceStretch.Tile:\r\n        return Math.ceil(destinationSize / tileSize);\r\n      case NineSliceStretch.TileFit:\r\n        return Math.ceil(destinationSize / tileSize);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the position and size of the tile\r\n   */\r\n  protected _calculateParams(\r\n    tileNum: number,\r\n    numTiles: number,\r\n    tileSize: number,\r\n    destinationSize: number,\r\n    strategy: NineSliceStretch\r\n  ): { tempPosition: number; tempSize: number } {\r\n    switch (strategy) {\r\n      case NineSliceStretch.Stretch:\r\n        return {\r\n          tempPosition: 0,\r\n          tempSize: destinationSize\r\n        };\r\n      case NineSliceStretch.Tile:\r\n        // if last tile, adjust size\r\n        if (tileNum === numTiles - 1) {\r\n          //last tile\r\n          return {\r\n            tempPosition: tileNum * tileSize,\r\n            tempSize: tileSize - (numTiles * tileSize - destinationSize)\r\n          };\r\n        } else {\r\n          return {\r\n            tempPosition: tileNum * tileSize,\r\n            tempSize: tileSize\r\n          };\r\n        }\r\n\r\n      case NineSliceStretch.TileFit:\r\n        const reducedTileSize = destinationSize / numTiles;\r\n        const position = tileNum * reducedTileSize;\r\n        return {\r\n          tempPosition: position,\r\n          tempSize: reducedTileSize\r\n        };\r\n    }\r\n  }\r\n}\r\n","import { ImageFiltering } from './Filtering';\r\nimport { ImageWrapConfiguration } from './ImageSource';\r\nimport { SourceView, Sprite } from './Sprite';\r\nimport { ImageWrapping } from './Wrapping';\r\nimport { Animation, AnimationOptions } from './Animation';\r\nimport { GraphicOptions } from './Graphic';\r\nimport { TiledSprite } from './TiledSprite';\r\nimport { watch } from '../Util/Watch';\r\nimport { Future } from '../Util/Future';\r\n\r\nexport interface TiledAnimationOptions {\r\n  /**\r\n   * Animation to tile\r\n   */\r\n  animation: Animation;\r\n  /**\r\n   * Optionally override source view on frame graphics\r\n   */\r\n  sourceView?: Partial<SourceView>;\r\n  /**\r\n   * Optionally override filtering options\r\n   */\r\n  filtering?: ImageFiltering;\r\n  /**\r\n   * Default wrapping is Repeat for TiledAnimation\r\n   */\r\n  wrapping?: ImageWrapConfiguration | ImageWrapping;\r\n  /**\r\n   * Total width in pixels for the tiling to take place\r\n   */\r\n  width: number;\r\n  /**\r\n   * Total height in pixels for the tiling to take place\r\n   */\r\n  height: number;\r\n}\r\n\r\nexport class TiledAnimation extends Animation {\r\n  private _ready = new Future<void>();\r\n  public ready = this._ready.promise;\r\n  private _tiledWidth: number = 0;\r\n  private _tiledHeight: number = 0;\r\n  private _sourceView: Partial<SourceView> = {};\r\n  constructor(options: GraphicOptions & Omit<AnimationOptions, 'frames'> & TiledAnimationOptions) {\r\n    super({\r\n      ...options,\r\n      frames: options.animation.frames.slice(),\r\n      strategy: options.animation.strategy,\r\n      frameDuration: options.animation.frameDuration,\r\n      speed: options.animation.speed,\r\n      reverse: options.animation.isReversed\r\n    });\r\n    this._sourceView = { ...options.sourceView };\r\n    this._tiledWidth = options.width;\r\n    this._tiledHeight = options.height;\r\n\r\n    const promises: Promise<void>[] = [];\r\n    for (let i = 0; i < this.frames.length; i++) {\r\n      const graphic = this.frames[i].graphic;\r\n      if (graphic && graphic instanceof Sprite) {\r\n        const tiledSprite = new TiledSprite({\r\n          image: graphic.image,\r\n          width: options.width,\r\n          height: options.height,\r\n          sourceView: { ...graphic.sourceView },\r\n          wrapping: options.wrapping,\r\n          filtering: options.filtering\r\n        });\r\n        this.frames[i].graphic = tiledSprite;\r\n\r\n        // There is a new calc'd sourceView when ready\r\n        tiledSprite.ready.then(() => {\r\n          tiledSprite.sourceView = { ...tiledSprite.sourceView, ...this._sourceView };\r\n        });\r\n        promises.push(tiledSprite.ready);\r\n      }\r\n    }\r\n    Promise.all(promises).then(() => this._ready.resolve());\r\n  }\r\n\r\n  public static fromAnimation(animation: Animation, options?: Omit<TiledAnimationOptions, 'animation'>): TiledAnimation {\r\n    return new TiledAnimation({\r\n      width: animation.width,\r\n      height: animation.height,\r\n      ...options,\r\n      animation\r\n    });\r\n  }\r\n\r\n  private _updateSourceView() {\r\n    for (let i = 0; i < this.frames.length; i++) {\r\n      const graphic = this.frames[i].graphic;\r\n      if (graphic && graphic instanceof Sprite) {\r\n        graphic.sourceView = { ...graphic.sourceView, ...this._sourceView };\r\n      }\r\n    }\r\n  }\r\n\r\n  get sourceView(): Partial<SourceView> {\r\n    return watch(this._sourceView, () => this._updateSourceView());\r\n  }\r\n\r\n  set sourceView(sourceView: Partial<SourceView>) {\r\n    this._sourceView = watch(sourceView, () => this._updateSourceView());\r\n    this._updateSourceView();\r\n  }\r\n\r\n  private _updateWidthHeight() {\r\n    for (let i = 0; i < this.frames.length; i++) {\r\n      const graphic = this.frames[i].graphic;\r\n      if (graphic && graphic instanceof Sprite) {\r\n        graphic.sourceView.height = this._tiledHeight || graphic.height;\r\n        graphic.destSize.height = this._tiledHeight || graphic.height;\r\n        graphic.sourceView.width = this._tiledWidth || graphic.width;\r\n        graphic.destSize.width = this._tiledWidth || graphic.width;\r\n      }\r\n    }\r\n  }\r\n\r\n  get width() {\r\n    return this._tiledWidth;\r\n  }\r\n\r\n  get height() {\r\n    return this._tiledHeight;\r\n  }\r\n\r\n  override set width(width: number) {\r\n    this._tiledWidth = width;\r\n    this._updateWidthHeight();\r\n  }\r\n\r\n  override set height(height: number) {\r\n    this._tiledHeight = height;\r\n    this._updateWidthHeight();\r\n  }\r\n}\r\n","import { Flags } from '../Flags';\nimport { Logger } from './Log';\n\n/**\n * Obsolete decorator options\n */\nexport interface ObsoleteOptions {\n  // Optionally specify a custom message\n  message?: string;\n  // Optionally indicate that an alternate method to the obsolete one exists\n  alternateMethod?: string;\n  // Optional show stack trace, by default off\n  showStackTrace?: boolean;\n}\n\nexport const maxMessages = 5;\nconst obsoleteMessage: { [messageCount: string]: number } = {};\nexport const resetObsoleteCounter = () => {\n  for (const message in obsoleteMessage) {\n    obsoleteMessage[message] = 0;\n  }\n};\n\nconst logMessage = (message: string, options: ObsoleteOptions) => {\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\n    Logger.getInstance().warn(message);\n\n    // tslint:disable-next-line: no-console\n    if (console.trace && options.showStackTrace) {\n      // tslint:disable-next-line: no-console\n      console.trace();\n    }\n  }\n  obsoleteMessage[message]++;\n};\n\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nexport function obsolete(options?: ObsoleteOptions): any {\n  options = {\n    message: 'This feature will be removed in future versions of Excalibur.',\n    alternateMethod: null,\n    showStackTrace: false,\n    ...options\n  };\n\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\n    if (\n      descriptor &&\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\n    ) {\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n    }\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n\n    const message =\n      `${methodSignature} is marked obsolete: ${options.message}` +\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n\n    if (!obsoleteMessage[message]) {\n      obsoleteMessage[message] = 0;\n    }\n\n    // If descriptor is null it is a class\n    const method = descriptor ? { ...descriptor } : target;\n    if (!descriptor) {\n      // with es2015 classes we need to change our decoration tactic\n      class DecoratedClass extends method {\n        constructor(...args: any) {\n          logMessage(message, options);\n          super(...args);\n        }\n      }\n      return DecoratedClass;\n    }\n\n    if (descriptor && descriptor.value) {\n      method.value = function (this: any) {\n        logMessage(message, options);\n        return descriptor.value.apply(this, arguments);\n      };\n      return method;\n    }\n\n    if (descriptor && descriptor.get) {\n      method.get = function (this: any) {\n        logMessage(message, options);\n        return descriptor.get.apply(this, arguments);\n      };\n    }\n\n    if (descriptor && descriptor.set) {\n      method.set = function (this: any) {\n        logMessage(message, options);\n        return descriptor.set.apply(this, arguments);\n      };\n    }\n    return method;\n  };\n}\n","import { Future } from './Future';\r\n\r\nclass AsyncWaitQueue<T> {\r\n  // Code from StephenCleary https://gist.github.com/StephenCleary/ba50b2da419c03b9cba1d20cb4654d5e\r\n  private _queue: Future<T>[] = [];\r\n\r\n  public get length(): number {\r\n    return this._queue.length;\r\n  }\r\n\r\n  public enqueue(): Promise<T> {\r\n    const future = new Future<T>();\r\n    this._queue.push(future);\r\n    return future.promise;\r\n  }\r\n\r\n  public dequeue(value: T): void {\r\n    const future = this._queue.shift();\r\n    future.resolve(value);\r\n  }\r\n}\r\n\r\n/**\r\n * Semaphore allows you to limit the amount of async calls happening between `enter()` and `exit()`\r\n *\r\n * This can be useful when limiting the number of http calls, browser api calls, etc either for performance or to work\r\n * around browser limitations like max Image.decode() calls in chromium being 256.\r\n */\r\nexport class Semaphore {\r\n  private _waitQueue = new AsyncWaitQueue();\r\n  constructor(private _count: number) {}\r\n\r\n  public get count() {\r\n    return this._count;\r\n  }\r\n\r\n  public get waiting() {\r\n    return this._waitQueue.length;\r\n  }\r\n\r\n  // eslint-disable-next-line require-await\r\n  public async enter() {\r\n    if (this._count !== 0) {\r\n      this._count--;\r\n      return Promise.resolve();\r\n    }\r\n    return this._waitQueue.enqueue();\r\n  }\r\n\r\n  public exit(count: number = 1) {\r\n    if (count === 0) {\r\n      return;\r\n    }\r\n    while (count !== 0 && this._waitQueue.length !== 0) {\r\n      this._waitQueue.dequeue(null);\r\n      count--;\r\n    }\r\n    this._count += count;\r\n  }\r\n}\r\n","/**\r\n * The current Excalibur version string\r\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\r\n */\r\nexport const EX_VERSION = process.env.__EX_VERSION;\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\n\r\n// This file is used as the bundle entry point and exports everything\r\n// that will be exposed as the `ex` global variable.\r\nexport * from './Flags';\r\nexport * from './Id';\r\nexport * from './Engine';\r\nexport * from './GarbageCollector';\r\nexport * from './Screen';\r\nexport * from './Actor';\r\nexport * from './Math/index';\r\nexport * from './Camera';\r\nexport * from './Debug/index';\r\nexport * from './EventEmitter';\r\nexport * from './Events/MediaEvents';\r\nexport * from './Events';\r\nexport * from './Label';\r\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\r\nexport * from './Particles/index';\r\nexport * from './Scene';\r\n\r\nexport * from './TileMap/index';\r\n\r\nexport * from './Timer';\r\nexport * from './Trigger';\r\nexport * from './ScreenElement';\r\n\r\nexport * from './Actions/index';\r\nexport * from './Collision/Index';\r\n\r\nexport * from './Interfaces/Index';\r\nexport * from './Resources/Index';\r\n\r\nexport * from './EntityComponentSystem/index';\r\n\r\nexport * from './Director/index';\r\n\r\nexport * from './Color';\r\n\r\nexport * from './Graphics/index';\r\n\r\n// ex.Events namespace\r\nimport * as events from './Events';\r\nexport { events as Events };\r\n\r\nexport { WheelEvent } from './Input/WheelEvent';\r\n\r\nexport { PointerEvent } from './Input/PointerEvent';\r\n\r\nexport { WheelDeltaMode } from './Input/WheelDeltaMode';\r\n\r\nexport { PointerButton } from './Input/PointerButton';\r\n\r\nexport { NativePointerButton } from './Input/NativePointerButton';\r\n\r\nexport { CapturePointerConfig } from './Input/CapturePointerConfig';\r\n\r\nexport {\r\n  NativePointerEvent,\r\n  NativeMouseEvent,\r\n  NativeTouchEvent,\r\n  NativeWheelEvent,\r\n  PointerInitOptions,\r\n  PointerEventReceiver\r\n} from './Input/PointerEventReceiver';\r\n\r\nexport { PointerAbstraction } from './Input/PointerAbstraction';\r\nexport { PointerComponent } from './Input/PointerComponent';\r\nexport { PointerSystem } from './Input/PointerSystem';\r\nexport { PointerType } from './Input/PointerType';\r\nexport { PointerScope } from './Input/PointerScope';\r\n\r\nexport {\r\n  Gamepads,\r\n  Gamepad,\r\n  Buttons,\r\n  Axes,\r\n  NavigatorGamepads,\r\n  NavigatorGamepad,\r\n  NavigatorGamepadButton,\r\n  NavigatorGamepadEvent,\r\n  GamepadConfiguration\r\n} from './Input/Gamepad';\r\n\r\nexport { Keys, KeyEvent, KeyboardInitOptions, Keyboard } from './Input/Keyboard';\r\nexport * from './Input/InputHost';\r\nexport * from './Input/InputMapper';\r\n\r\n// ex.Util namespaces\r\nimport * as util from './Util/Index';\r\nexport { util as Util };\r\n\r\nexport * from './Util/Browser';\r\nexport * from './Util/Decorators';\r\nexport * from './Util/Detector';\r\nexport * from './Util/EasingFunctions';\r\nexport * from './Util/Observable';\r\nexport * from './Util/Log';\r\nexport * from './Util/Pool';\r\nexport * from './Util/Fps';\r\nexport * from './Util/Clock';\r\nexport * from './Util/WebAudio';\r\nexport * from './Util/Toaster';\r\nexport * from './Util/StateMachine';\r\nexport * from './Util/Future';\r\nexport * from './Util/Semaphore';\r\nexport * from './Util/Coroutine';\r\nexport * from './Util/Assert';\r\n\r\n// ex.Deprecated\r\n// import * as deprecated from './Deprecated';\r\n// export { deprecated as Deprecated };\r\n// export * from './Deprecated';\r\n","import { ImageFiltering, ImageSource, Loadable, Loader, Resource, TileMap, SpriteFont, SpriteSheet, Vector } from \"excalibur\";\nimport { TiledResource } from '@excaliburjs/plugin-tiled';\n\n// Import paths to work with Parcel\nimport heroPath from '../img/Solaria Demo Pack Update 03/Solaria Demo Pack Update 03/16x16/Sprites/Hero 01.png';\n//import vioPath from '../img/Solaria Demo Pack Update 03/Solaria Demo Pack Update 03/16x16/Sprites/Hero 01.png';\nimport viodanielPath from '../img/Solaria Demo Pack Update 03/Solaria Demo Pack Update 03/16x16/Sprites/characters.png';\nimport tilesetPath from '../img/Solaria Demo Pack Update 03/Solaria Demo Pack Update 03/16x16/Tilesets/Solaria Demo Update 01.png';\n//import tilesetPath from '../img/Solaria Demo Pack Update 03/Solaria Demo Pack Update 03/16x16/Tilesets/tinySLATES.png';\nimport fontPath from '../img/Solaria Demo Pack Update 03/Solaria Demo Pack Update 03/16x16/Sprites/font.png';\n//import tmxPath from '../res/first-level.tmx';\nimport tmxPath from '../res/danielmap.tmx';\nimport tsxPath from '../res/tileset.tsx';\nimport { Player } from \"./player\";\nimport { Chest } from \"./chest\";\nimport { Daniel } from \"./daniel\";\nimport { Vio } from \"./vio\";\n\nexport const Resources = {\n    HeroSpriteSheetPng: new ImageSource(heroPath, false, ImageFiltering.Pixel),\n    TileSetPng: new ImageSource(tilesetPath, false, ImageFiltering.Pixel),\n    FontSpritePng: new ImageSource(fontPath, false, ImageFiltering.Pixel),\n    VioDanielSheetPng: new ImageSource(viodanielPath, false, ImageFiltering.Pixel),\n    TiledMap: new TiledResource(tmxPath, {\n      entityClassNameFactories: {\n        player: (props) => {\n          const player = new Player(props.worldPos);\n          player.z = 99;\n          return player;\n        },\n        chest: (props) => {\n          const chest = new Chest(props.worldPos);\n          chest.z = 99;\n          return chest;\n        },\n        daniel: (props) => {\n          const daniel = new Daniel(props.worldPos);\n          daniel.z = 99;\n          return daniel;\n        },\n        vio: (props) => {\n          const vio = new Vio(props.worldPos);\n          vio.z = 99;\n          return vio;\n        },\n      },\n      // Path map intercepts and redirects to work around parcel's static bundling\n      pathMap: [\n        //{ path: 'first-level.tmx', output: tmxPath },\n        { path: 'danielmap.tmx', output: tmxPath},\n        { path: 'Solaria Demo Update 01.png', output: tilesetPath },\n        //{ path: 'tinySLATES.png', output: tilesetPath },\n        { path: 'tileset.tsx', output: tsxPath }\n      ]\n    }),\n}\n\nexport const loader = new Loader();\nfor (let resource of Object.values(Resources)) {\n    loader.addResource(resource);\n}",null,"(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory((function webpackLoadOptionalExternalModule() { try { return require(\"jsdom\"); } catch(e) {} }()), require(\"excalibur\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"jsdom\", \"excalibur\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory((function webpackLoadOptionalExternalModule() { try { return require(\"jsdom\"); } catch(e) {} }()), require(\"excalibur\"));\n\telse\n\t\troot[\"ex\"] = root[\"ex\"] || {}, root[\"ex\"][\"Plugin\"] = root[\"ex\"][\"Plugin\"] || {}, root[\"ex\"][\"Plugin\"][\"Tiled\"] = factory(root[\"jsdom\"], root[\"ex\"]);\n})(self, (__WEBPACK_EXTERNAL_MODULE__185__, __WEBPACK_EXTERNAL_MODULE__418__) => {\nreturn ","// Top level file is just a mixin of submodules & constants\n'use strict';\n\nvar assign    = require('./lib/utils/common').assign;\n\nvar deflate   = require('./lib/deflate');\nvar inflate   = require('./lib/inflate');\nvar constants = require('./lib/zlib/constants');\n\nvar pako = {};\n\nassign(pako, deflate, inflate, constants);\n\nmodule.exports = pako;\n","'use strict';\n\n\nvar zlib_deflate = require('./zlib/deflate');\nvar utils        = require('./utils/common');\nvar strings      = require('./utils/strings');\nvar msg          = require('./zlib/messages');\nvar ZStream      = require('./zlib/zstream');\n\nvar toString = Object.prototype.toString;\n\n/* Public constants ==========================================================*/\n/* ===========================================================================*/\n\nvar Z_NO_FLUSH      = 0;\nvar Z_FINISH        = 4;\n\nvar Z_OK            = 0;\nvar Z_STREAM_END    = 1;\nvar Z_SYNC_FLUSH    = 2;\n\nvar Z_DEFAULT_COMPRESSION = -1;\n\nvar Z_DEFAULT_STRATEGY    = 0;\n\nvar Z_DEFLATED  = 8;\n\n/* ===========================================================================*/\n\n\n/**\n * class Deflate\n *\n * Generic JS-style wrapper for zlib calls. If you don't need\n * streaming behaviour - use more simple functions: [[deflate]],\n * [[deflateRaw]] and [[gzip]].\n **/\n\n/* internal\n * Deflate.chunks -> Array\n *\n * Chunks of output data, if [[Deflate#onData]] not overridden.\n **/\n\n/**\n * Deflate.result -> Uint8Array|Array\n *\n * Compressed result, generated by default [[Deflate#onData]]\n * and [[Deflate#onEnd]] handlers. Filled after you push last chunk\n * (call [[Deflate#push]] with `Z_FINISH` / `true` param)  or if you\n * push a chunk with explicit flush (call [[Deflate#push]] with\n * `Z_SYNC_FLUSH` param).\n **/\n\n/**\n * Deflate.err -> Number\n *\n * Error code after deflate finished. 0 (Z_OK) on success.\n * You will not need it in real life, because deflate errors\n * are possible only on wrong options or bad `onData` / `onEnd`\n * custom handlers.\n **/\n\n/**\n * Deflate.msg -> String\n *\n * Error message, if [[Deflate.err]] != 0\n **/\n\n\n/**\n * new Deflate(options)\n * - options (Object): zlib deflate options.\n *\n * Creates new deflator instance with specified params. Throws exception\n * on bad params. Supported options:\n *\n * - `level`\n * - `windowBits`\n * - `memLevel`\n * - `strategy`\n * - `dictionary`\n *\n * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)\n * for more information on these.\n *\n * Additional options, for internal needs:\n *\n * - `chunkSize` - size of generated data chunks (16K by default)\n * - `raw` (Boolean) - do raw deflate\n * - `gzip` (Boolean) - create gzip wrapper\n * - `to` (String) - if equal to 'string', then result will be \"binary string\"\n *    (each char code [0..255])\n * - `header` (Object) - custom header for gzip\n *   - `text` (Boolean) - true if compressed data believed to be text\n *   - `time` (Number) - modification time, unix timestamp\n *   - `os` (Number) - operation system code\n *   - `extra` (Array) - array of bytes with extra data (max 65536)\n *   - `name` (String) - file name (binary string)\n *   - `comment` (String) - comment (binary string)\n *   - `hcrc` (Boolean) - true if header crc should be added\n *\n * ##### Example:\n *\n * ```javascript\n * var pako = require('pako')\n *   , chunk1 = Uint8Array([1,2,3,4,5,6,7,8,9])\n *   , chunk2 = Uint8Array([10,11,12,13,14,15,16,17,18,19]);\n *\n * var deflate = new pako.Deflate({ level: 3});\n *\n * deflate.push(chunk1, false);\n * deflate.push(chunk2, true);  // true -> last chunk\n *\n * if (deflate.err) { throw new Error(deflate.err); }\n *\n * console.log(deflate.result);\n * ```\n **/\nfunction Deflate(options) {\n  if (!(this instanceof Deflate)) return new Deflate(options);\n\n  this.options = utils.assign({\n    level: Z_DEFAULT_COMPRESSION,\n    method: Z_DEFLATED,\n    chunkSize: 16384,\n    windowBits: 15,\n    memLevel: 8,\n    strategy: Z_DEFAULT_STRATEGY,\n    to: ''\n  }, options || {});\n\n  var opt = this.options;\n\n  if (opt.raw && (opt.windowBits > 0)) {\n    opt.windowBits = -opt.windowBits;\n  }\n\n  else if (opt.gzip && (opt.windowBits > 0) && (opt.windowBits < 16)) {\n    opt.windowBits += 16;\n  }\n\n  this.err    = 0;      // error code, if happens (0 = Z_OK)\n  this.msg    = '';     // error message\n  this.ended  = false;  // used to avoid multiple onEnd() calls\n  this.chunks = [];     // chunks of compressed data\n\n  this.strm = new ZStream();\n  this.strm.avail_out = 0;\n\n  var status = zlib_deflate.deflateInit2(\n    this.strm,\n    opt.level,\n    opt.method,\n    opt.windowBits,\n    opt.memLevel,\n    opt.strategy\n  );\n\n  if (status !== Z_OK) {\n    throw new Error(msg[status]);\n  }\n\n  if (opt.header) {\n    zlib_deflate.deflateSetHeader(this.strm, opt.header);\n  }\n\n  if (opt.dictionary) {\n    var dict;\n    // Convert data if needed\n    if (typeof opt.dictionary === 'string') {\n      // If we need to compress text, change encoding to utf8.\n      dict = strings.string2buf(opt.dictionary);\n    } else if (toString.call(opt.dictionary) === '[object ArrayBuffer]') {\n      dict = new Uint8Array(opt.dictionary);\n    } else {\n      dict = opt.dictionary;\n    }\n\n    status = zlib_deflate.deflateSetDictionary(this.strm, dict);\n\n    if (status !== Z_OK) {\n      throw new Error(msg[status]);\n    }\n\n    this._dict_set = true;\n  }\n}\n\n/**\n * Deflate#push(data[, mode]) -> Boolean\n * - data (Uint8Array|Array|ArrayBuffer|String): input data. Strings will be\n *   converted to utf8 byte sequence.\n * - mode (Number|Boolean): 0..6 for corresponding Z_NO_FLUSH..Z_TREE modes.\n *   See constants. Skipped or `false` means Z_NO_FLUSH, `true` means Z_FINISH.\n *\n * Sends input data to deflate pipe, generating [[Deflate#onData]] calls with\n * new compressed chunks. Returns `true` on success. The last data block must have\n * mode Z_FINISH (or `true`). That will flush internal pending buffers and call\n * [[Deflate#onEnd]]. For interim explicit flushes (without ending the stream) you\n * can use mode Z_SYNC_FLUSH, keeping the compression context.\n *\n * On fail call [[Deflate#onEnd]] with error code and return false.\n *\n * We strongly recommend to use `Uint8Array` on input for best speed (output\n * array format is detected automatically). Also, don't skip last param and always\n * use the same type in your code (boolean or number). That will improve JS speed.\n *\n * For regular `Array`-s make sure all elements are [0..255].\n *\n * ##### Example\n *\n * ```javascript\n * push(chunk, false); // push one of data chunks\n * ...\n * push(chunk, true);  // push last chunk\n * ```\n **/\nDeflate.prototype.push = function (data, mode) {\n  var strm = this.strm;\n  var chunkSize = this.options.chunkSize;\n  var status, _mode;\n\n  if (this.ended) { return false; }\n\n  _mode = (mode === ~~mode) ? mode : ((mode === true) ? Z_FINISH : Z_NO_FLUSH);\n\n  // Convert data if needed\n  if (typeof data === 'string') {\n    // If we need to compress text, change encoding to utf8.\n    strm.input = strings.string2buf(data);\n  } else if (toString.call(data) === '[object ArrayBuffer]') {\n    strm.input = new Uint8Array(data);\n  } else {\n    strm.input = data;\n  }\n\n  strm.next_in = 0;\n  strm.avail_in = strm.input.length;\n\n  do {\n    if (strm.avail_out === 0) {\n      strm.output = new utils.Buf8(chunkSize);\n      strm.next_out = 0;\n      strm.avail_out = chunkSize;\n    }\n    status = zlib_deflate.deflate(strm, _mode);    /* no bad return value */\n\n    if (status !== Z_STREAM_END && status !== Z_OK) {\n      this.onEnd(status);\n      this.ended = true;\n      return false;\n    }\n    if (strm.avail_out === 0 || (strm.avail_in === 0 && (_mode === Z_FINISH || _mode === Z_SYNC_FLUSH))) {\n      if (this.options.to === 'string') {\n        this.onData(strings.buf2binstring(utils.shrinkBuf(strm.output, strm.next_out)));\n      } else {\n        this.onData(utils.shrinkBuf(strm.output, strm.next_out));\n      }\n    }\n  } while ((strm.avail_in > 0 || strm.avail_out === 0) && status !== Z_STREAM_END);\n\n  // Finalize on the last chunk.\n  if (_mode === Z_FINISH) {\n    status = zlib_deflate.deflateEnd(this.strm);\n    this.onEnd(status);\n    this.ended = true;\n    return status === Z_OK;\n  }\n\n  // callback interim results if Z_SYNC_FLUSH.\n  if (_mode === Z_SYNC_FLUSH) {\n    this.onEnd(Z_OK);\n    strm.avail_out = 0;\n    return true;\n  }\n\n  return true;\n};\n\n\n/**\n * Deflate#onData(chunk) -> Void\n * - chunk (Uint8Array|Array|String): output data. Type of array depends\n *   on js engine support. When string output requested, each chunk\n *   will be string.\n *\n * By default, stores data blocks in `chunks[]` property and glue\n * those in `onEnd`. Override this handler, if you need another behaviour.\n **/\nDeflate.prototype.onData = function (chunk) {\n  this.chunks.push(chunk);\n};\n\n\n/**\n * Deflate#onEnd(status) -> Void\n * - status (Number): deflate status. 0 (Z_OK) on success,\n *   other if not.\n *\n * Called once after you tell deflate that the input stream is\n * complete (Z_FINISH) or should be flushed (Z_SYNC_FLUSH)\n * or if an error happened. By default - join collected chunks,\n * free memory and fill `results` / `err` properties.\n **/\nDeflate.prototype.onEnd = function (status) {\n  // On success - join\n  if (status === Z_OK) {\n    if (this.options.to === 'string') {\n      this.result = this.chunks.join('');\n    } else {\n      this.result = utils.flattenChunks(this.chunks);\n    }\n  }\n  this.chunks = [];\n  this.err = status;\n  this.msg = this.strm.msg;\n};\n\n\n/**\n * deflate(data[, options]) -> Uint8Array|Array|String\n * - data (Uint8Array|Array|String): input data to compress.\n * - options (Object): zlib deflate options.\n *\n * Compress `data` with deflate algorithm and `options`.\n *\n * Supported options are:\n *\n * - level\n * - windowBits\n * - memLevel\n * - strategy\n * - dictionary\n *\n * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)\n * for more information on these.\n *\n * Sugar (options):\n *\n * - `raw` (Boolean) - say that we work with raw stream, if you don't wish to specify\n *   negative windowBits implicitly.\n * - `to` (String) - if equal to 'string', then result will be \"binary string\"\n *    (each char code [0..255])\n *\n * ##### Example:\n *\n * ```javascript\n * var pako = require('pako')\n *   , data = Uint8Array([1,2,3,4,5,6,7,8,9]);\n *\n * console.log(pako.deflate(data));\n * ```\n **/\nfunction deflate(input, options) {\n  var deflator = new Deflate(options);\n\n  deflator.push(input, true);\n\n  // That will never happens, if you don't cheat with options :)\n  if (deflator.err) { throw deflator.msg || msg[deflator.err]; }\n\n  return deflator.result;\n}\n\n\n/**\n * deflateRaw(data[, options]) -> Uint8Array|Array|String\n * - data (Uint8Array|Array|String): input data to compress.\n * - options (Object): zlib deflate options.\n *\n * The same as [[deflate]], but creates raw data, without wrapper\n * (header and adler32 crc).\n **/\nfunction deflateRaw(input, options) {\n  options = options || {};\n  options.raw = true;\n  return deflate(input, options);\n}\n\n\n/**\n * gzip(data[, options]) -> Uint8Array|Array|String\n * - data (Uint8Array|Array|String): input data to compress.\n * - options (Object): zlib deflate options.\n *\n * The same as [[deflate]], but create gzip wrapper instead of\n * deflate one.\n **/\nfunction gzip(input, options) {\n  options = options || {};\n  options.gzip = true;\n  return deflate(input, options);\n}\n\n\nexports.Deflate = Deflate;\nexports.deflate = deflate;\nexports.deflateRaw = deflateRaw;\nexports.gzip = gzip;\n","'use strict';\n\n\nvar zlib_inflate = require('./zlib/inflate');\nvar utils        = require('./utils/common');\nvar strings      = require('./utils/strings');\nvar c            = require('./zlib/constants');\nvar msg          = require('./zlib/messages');\nvar ZStream      = require('./zlib/zstream');\nvar GZheader     = require('./zlib/gzheader');\n\nvar toString = Object.prototype.toString;\n\n/**\n * class Inflate\n *\n * Generic JS-style wrapper for zlib calls. If you don't need\n * streaming behaviour - use more simple functions: [[inflate]]\n * and [[inflateRaw]].\n **/\n\n/* internal\n * inflate.chunks -> Array\n *\n * Chunks of output data, if [[Inflate#onData]] not overridden.\n **/\n\n/**\n * Inflate.result -> Uint8Array|Array|String\n *\n * Uncompressed result, generated by default [[Inflate#onData]]\n * and [[Inflate#onEnd]] handlers. Filled after you push last chunk\n * (call [[Inflate#push]] with `Z_FINISH` / `true` param) or if you\n * push a chunk with explicit flush (call [[Inflate#push]] with\n * `Z_SYNC_FLUSH` param).\n **/\n\n/**\n * Inflate.err -> Number\n *\n * Error code after inflate finished. 0 (Z_OK) on success.\n * Should be checked if broken data possible.\n **/\n\n/**\n * Inflate.msg -> String\n *\n * Error message, if [[Inflate.err]] != 0\n **/\n\n\n/**\n * new Inflate(options)\n * - options (Object): zlib inflate options.\n *\n * Creates new inflator instance with specified params. Throws exception\n * on bad params. Supported options:\n *\n * - `windowBits`\n * - `dictionary`\n *\n * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)\n * for more information on these.\n *\n * Additional options, for internal needs:\n *\n * - `chunkSize` - size of generated data chunks (16K by default)\n * - `raw` (Boolean) - do raw inflate\n * - `to` (String) - if equal to 'string', then result will be converted\n *   from utf8 to utf16 (javascript) string. When string output requested,\n *   chunk length can differ from `chunkSize`, depending on content.\n *\n * By default, when no options set, autodetect deflate/gzip data format via\n * wrapper header.\n *\n * ##### Example:\n *\n * ```javascript\n * var pako = require('pako')\n *   , chunk1 = Uint8Array([1,2,3,4,5,6,7,8,9])\n *   , chunk2 = Uint8Array([10,11,12,13,14,15,16,17,18,19]);\n *\n * var inflate = new pako.Inflate({ level: 3});\n *\n * inflate.push(chunk1, false);\n * inflate.push(chunk2, true);  // true -> last chunk\n *\n * if (inflate.err) { throw new Error(inflate.err); }\n *\n * console.log(inflate.result);\n * ```\n **/\nfunction Inflate(options) {\n  if (!(this instanceof Inflate)) return new Inflate(options);\n\n  this.options = utils.assign({\n    chunkSize: 16384,\n    windowBits: 0,\n    to: ''\n  }, options || {});\n\n  var opt = this.options;\n\n  // Force window size for `raw` data, if not set directly,\n  // because we have no header for autodetect.\n  if (opt.raw && (opt.windowBits >= 0) && (opt.windowBits < 16)) {\n    opt.windowBits = -opt.windowBits;\n    if (opt.windowBits === 0) { opt.windowBits = -15; }\n  }\n\n  // If `windowBits` not defined (and mode not raw) - set autodetect flag for gzip/deflate\n  if ((opt.windowBits >= 0) && (opt.windowBits < 16) &&\n      !(options && options.windowBits)) {\n    opt.windowBits += 32;\n  }\n\n  // Gzip header has no info about windows size, we can do autodetect only\n  // for deflate. So, if window size not set, force it to max when gzip possible\n  if ((opt.windowBits > 15) && (opt.windowBits < 48)) {\n    // bit 3 (16) -> gzipped data\n    // bit 4 (32) -> autodetect gzip/deflate\n    if ((opt.windowBits & 15) === 0) {\n      opt.windowBits |= 15;\n    }\n  }\n\n  this.err    = 0;      // error code, if happens (0 = Z_OK)\n  this.msg    = '';     // error message\n  this.ended  = false;  // used to avoid multiple onEnd() calls\n  this.chunks = [];     // chunks of compressed data\n\n  this.strm   = new ZStream();\n  this.strm.avail_out = 0;\n\n  var status  = zlib_inflate.inflateInit2(\n    this.strm,\n    opt.windowBits\n  );\n\n  if (status !== c.Z_OK) {\n    throw new Error(msg[status]);\n  }\n\n  this.header = new GZheader();\n\n  zlib_inflate.inflateGetHeader(this.strm, this.header);\n\n  // Setup dictionary\n  if (opt.dictionary) {\n    // Convert data if needed\n    if (typeof opt.dictionary === 'string') {\n      opt.dictionary = strings.string2buf(opt.dictionary);\n    } else if (toString.call(opt.dictionary) === '[object ArrayBuffer]') {\n      opt.dictionary = new Uint8Array(opt.dictionary);\n    }\n    if (opt.raw) { //In raw mode we need to set the dictionary early\n      status = zlib_inflate.inflateSetDictionary(this.strm, opt.dictionary);\n      if (status !== c.Z_OK) {\n        throw new Error(msg[status]);\n      }\n    }\n  }\n}\n\n/**\n * Inflate#push(data[, mode]) -> Boolean\n * - data (Uint8Array|Array|ArrayBuffer|String): input data\n * - mode (Number|Boolean): 0..6 for corresponding Z_NO_FLUSH..Z_TREE modes.\n *   See constants. Skipped or `false` means Z_NO_FLUSH, `true` means Z_FINISH.\n *\n * Sends input data to inflate pipe, generating [[Inflate#onData]] calls with\n * new output chunks. Returns `true` on success. The last data block must have\n * mode Z_FINISH (or `true`). That will flush internal pending buffers and call\n * [[Inflate#onEnd]]. For interim explicit flushes (without ending the stream) you\n * can use mode Z_SYNC_FLUSH, keeping the decompression context.\n *\n * On fail call [[Inflate#onEnd]] with error code and return false.\n *\n * We strongly recommend to use `Uint8Array` on input for best speed (output\n * format is detected automatically). Also, don't skip last param and always\n * use the same type in your code (boolean or number). That will improve JS speed.\n *\n * For regular `Array`-s make sure all elements are [0..255].\n *\n * ##### Example\n *\n * ```javascript\n * push(chunk, false); // push one of data chunks\n * ...\n * push(chunk, true);  // push last chunk\n * ```\n **/\nInflate.prototype.push = function (data, mode) {\n  var strm = this.strm;\n  var chunkSize = this.options.chunkSize;\n  var dictionary = this.options.dictionary;\n  var status, _mode;\n  var next_out_utf8, tail, utf8str;\n\n  // Flag to properly process Z_BUF_ERROR on testing inflate call\n  // when we check that all output data was flushed.\n  var allowBufError = false;\n\n  if (this.ended) { return false; }\n  _mode = (mode === ~~mode) ? mode : ((mode === true) ? c.Z_FINISH : c.Z_NO_FLUSH);\n\n  // Convert data if needed\n  if (typeof data === 'string') {\n    // Only binary strings can be decompressed on practice\n    strm.input = strings.binstring2buf(data);\n  } else if (toString.call(data) === '[object ArrayBuffer]') {\n    strm.input = new Uint8Array(data);\n  } else {\n    strm.input = data;\n  }\n\n  strm.next_in = 0;\n  strm.avail_in = strm.input.length;\n\n  do {\n    if (strm.avail_out === 0) {\n      strm.output = new utils.Buf8(chunkSize);\n      strm.next_out = 0;\n      strm.avail_out = chunkSize;\n    }\n\n    status = zlib_inflate.inflate(strm, c.Z_NO_FLUSH);    /* no bad return value */\n\n    if (status === c.Z_NEED_DICT && dictionary) {\n      status = zlib_inflate.inflateSetDictionary(this.strm, dictionary);\n    }\n\n    if (status === c.Z_BUF_ERROR && allowBufError === true) {\n      status = c.Z_OK;\n      allowBufError = false;\n    }\n\n    if (status !== c.Z_STREAM_END && status !== c.Z_OK) {\n      this.onEnd(status);\n      this.ended = true;\n      return false;\n    }\n\n    if (strm.next_out) {\n      if (strm.avail_out === 0 || status === c.Z_STREAM_END || (strm.avail_in === 0 && (_mode === c.Z_FINISH || _mode === c.Z_SYNC_FLUSH))) {\n\n        if (this.options.to === 'string') {\n\n          next_out_utf8 = strings.utf8border(strm.output, strm.next_out);\n\n          tail = strm.next_out - next_out_utf8;\n          utf8str = strings.buf2string(strm.output, next_out_utf8);\n\n          // move tail\n          strm.next_out = tail;\n          strm.avail_out = chunkSize - tail;\n          if (tail) { utils.arraySet(strm.output, strm.output, next_out_utf8, tail, 0); }\n\n          this.onData(utf8str);\n\n        } else {\n          this.onData(utils.shrinkBuf(strm.output, strm.next_out));\n        }\n      }\n    }\n\n    // When no more input data, we should check that internal inflate buffers\n    // are flushed. The only way to do it when avail_out = 0 - run one more\n    // inflate pass. But if output data not exists, inflate return Z_BUF_ERROR.\n    // Here we set flag to process this error properly.\n    //\n    // NOTE. Deflate does not return error in this case and does not needs such\n    // logic.\n    if (strm.avail_in === 0 && strm.avail_out === 0) {\n      allowBufError = true;\n    }\n\n  } while ((strm.avail_in > 0 || strm.avail_out === 0) && status !== c.Z_STREAM_END);\n\n  if (status === c.Z_STREAM_END) {\n    _mode = c.Z_FINISH;\n  }\n\n  // Finalize on the last chunk.\n  if (_mode === c.Z_FINISH) {\n    status = zlib_inflate.inflateEnd(this.strm);\n    this.onEnd(status);\n    this.ended = true;\n    return status === c.Z_OK;\n  }\n\n  // callback interim results if Z_SYNC_FLUSH.\n  if (_mode === c.Z_SYNC_FLUSH) {\n    this.onEnd(c.Z_OK);\n    strm.avail_out = 0;\n    return true;\n  }\n\n  return true;\n};\n\n\n/**\n * Inflate#onData(chunk) -> Void\n * - chunk (Uint8Array|Array|String): output data. Type of array depends\n *   on js engine support. When string output requested, each chunk\n *   will be string.\n *\n * By default, stores data blocks in `chunks[]` property and glue\n * those in `onEnd`. Override this handler, if you need another behaviour.\n **/\nInflate.prototype.onData = function (chunk) {\n  this.chunks.push(chunk);\n};\n\n\n/**\n * Inflate#onEnd(status) -> Void\n * - status (Number): inflate status. 0 (Z_OK) on success,\n *   other if not.\n *\n * Called either after you tell inflate that the input stream is\n * complete (Z_FINISH) or should be flushed (Z_SYNC_FLUSH)\n * or if an error happened. By default - join collected chunks,\n * free memory and fill `results` / `err` properties.\n **/\nInflate.prototype.onEnd = function (status) {\n  // On success - join\n  if (status === c.Z_OK) {\n    if (this.options.to === 'string') {\n      // Glue & convert here, until we teach pako to send\n      // utf8 aligned strings to onData\n      this.result = this.chunks.join('');\n    } else {\n      this.result = utils.flattenChunks(this.chunks);\n    }\n  }\n  this.chunks = [];\n  this.err = status;\n  this.msg = this.strm.msg;\n};\n\n\n/**\n * inflate(data[, options]) -> Uint8Array|Array|String\n * - data (Uint8Array|Array|String): input data to decompress.\n * - options (Object): zlib inflate options.\n *\n * Decompress `data` with inflate/ungzip and `options`. Autodetect\n * format via wrapper header by default. That's why we don't provide\n * separate `ungzip` method.\n *\n * Supported options are:\n *\n * - windowBits\n *\n * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)\n * for more information.\n *\n * Sugar (options):\n *\n * - `raw` (Boolean) - say that we work with raw stream, if you don't wish to specify\n *   negative windowBits implicitly.\n * - `to` (String) - if equal to 'string', then result will be converted\n *   from utf8 to utf16 (javascript) string. When string output requested,\n *   chunk length can differ from `chunkSize`, depending on content.\n *\n *\n * ##### Example:\n *\n * ```javascript\n * var pako = require('pako')\n *   , input = pako.deflate([1,2,3,4,5,6,7,8,9])\n *   , output;\n *\n * try {\n *   output = pako.inflate(input);\n * } catch (err)\n *   console.log(err);\n * }\n * ```\n **/\nfunction inflate(input, options) {\n  var inflator = new Inflate(options);\n\n  inflator.push(input, true);\n\n  // That will never happens, if you don't cheat with options :)\n  if (inflator.err) { throw inflator.msg || msg[inflator.err]; }\n\n  return inflator.result;\n}\n\n\n/**\n * inflateRaw(data[, options]) -> Uint8Array|Array|String\n * - data (Uint8Array|Array|String): input data to decompress.\n * - options (Object): zlib inflate options.\n *\n * The same as [[inflate]], but creates raw data, without wrapper\n * (header and adler32 crc).\n **/\nfunction inflateRaw(input, options) {\n  options = options || {};\n  options.raw = true;\n  return inflate(input, options);\n}\n\n\n/**\n * ungzip(data[, options]) -> Uint8Array|Array|String\n * - data (Uint8Array|Array|String): input data to decompress.\n * - options (Object): zlib inflate options.\n *\n * Just shortcut to [[inflate]], because it autodetects format\n * by header.content. Done for convenience.\n **/\n\n\nexports.Inflate = Inflate;\nexports.inflate = inflate;\nexports.inflateRaw = inflateRaw;\nexports.ungzip  = inflate;\n","'use strict';\n\n\nvar TYPED_OK =  (typeof Uint8Array !== 'undefined') &&\n                (typeof Uint16Array !== 'undefined') &&\n                (typeof Int32Array !== 'undefined');\n\nfunction _has(obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nexports.assign = function (obj /*from1, from2, from3, ...*/) {\n  var sources = Array.prototype.slice.call(arguments, 1);\n  while (sources.length) {\n    var source = sources.shift();\n    if (!source) { continue; }\n\n    if (typeof source !== 'object') {\n      throw new TypeError(source + 'must be non-object');\n    }\n\n    for (var p in source) {\n      if (_has(source, p)) {\n        obj[p] = source[p];\n      }\n    }\n  }\n\n  return obj;\n};\n\n\n// reduce buffer size, avoiding mem copy\nexports.shrinkBuf = function (buf, size) {\n  if (buf.length === size) { return buf; }\n  if (buf.subarray) { return buf.subarray(0, size); }\n  buf.length = size;\n  return buf;\n};\n\n\nvar fnTyped = {\n  arraySet: function (dest, src, src_offs, len, dest_offs) {\n    if (src.subarray && dest.subarray) {\n      dest.set(src.subarray(src_offs, src_offs + len), dest_offs);\n      return;\n    }\n    // Fallback to ordinary array\n    for (var i = 0; i < len; i++) {\n      dest[dest_offs + i] = src[src_offs + i];\n    }\n  },\n  // Join array of chunks to single array.\n  flattenChunks: function (chunks) {\n    var i, l, len, pos, chunk, result;\n\n    // calculate data length\n    len = 0;\n    for (i = 0, l = chunks.length; i < l; i++) {\n      len += chunks[i].length;\n    }\n\n    // join chunks\n    result = new Uint8Array(len);\n    pos = 0;\n    for (i = 0, l = chunks.length; i < l; i++) {\n      chunk = chunks[i];\n      result.set(chunk, pos);\n      pos += chunk.length;\n    }\n\n    return result;\n  }\n};\n\nvar fnUntyped = {\n  arraySet: function (dest, src, src_offs, len, dest_offs) {\n    for (var i = 0; i < len; i++) {\n      dest[dest_offs + i] = src[src_offs + i];\n    }\n  },\n  // Join array of chunks to single array.\n  flattenChunks: function (chunks) {\n    return [].concat.apply([], chunks);\n  }\n};\n\n\n// Enable/Disable typed arrays use, for testing\n//\nexports.setTyped = function (on) {\n  if (on) {\n    exports.Buf8  = Uint8Array;\n    exports.Buf16 = Uint16Array;\n    exports.Buf32 = Int32Array;\n    exports.assign(exports, fnTyped);\n  } else {\n    exports.Buf8  = Array;\n    exports.Buf16 = Array;\n    exports.Buf32 = Array;\n    exports.assign(exports, fnUntyped);\n  }\n};\n\nexports.setTyped(TYPED_OK);\n","// String encode/decode helpers\n'use strict';\n\n\nvar utils = require('./common');\n\n\n// Quick check if we can use fast array to bin string conversion\n//\n// - apply(Array) can fail on Android 2.2\n// - apply(Uint8Array) can fail on iOS 5.1 Safari\n//\nvar STR_APPLY_OK = true;\nvar STR_APPLY_UIA_OK = true;\n\ntry { String.fromCharCode.apply(null, [ 0 ]); } catch (__) { STR_APPLY_OK = false; }\ntry { String.fromCharCode.apply(null, new Uint8Array(1)); } catch (__) { STR_APPLY_UIA_OK = false; }\n\n\n// Table with utf8 lengths (calculated by first byte of sequence)\n// Note, that 5 & 6-byte values and some 4-byte values can not be represented in JS,\n// because max possible codepoint is 0x10ffff\nvar _utf8len = new utils.Buf8(256);\nfor (var q = 0; q < 256; q++) {\n  _utf8len[q] = (q >= 252 ? 6 : q >= 248 ? 5 : q >= 240 ? 4 : q >= 224 ? 3 : q >= 192 ? 2 : 1);\n}\n_utf8len[254] = _utf8len[254] = 1; // Invalid sequence start\n\n\n// convert string to array (typed, when possible)\nexports.string2buf = function (str) {\n  var buf, c, c2, m_pos, i, str_len = str.length, buf_len = 0;\n\n  // count binary size\n  for (m_pos = 0; m_pos < str_len; m_pos++) {\n    c = str.charCodeAt(m_pos);\n    if ((c & 0xfc00) === 0xd800 && (m_pos + 1 < str_len)) {\n      c2 = str.charCodeAt(m_pos + 1);\n      if ((c2 & 0xfc00) === 0xdc00) {\n        c = 0x10000 + ((c - 0xd800) << 10) + (c2 - 0xdc00);\n        m_pos++;\n      }\n    }\n    buf_len += c < 0x80 ? 1 : c < 0x800 ? 2 : c < 0x10000 ? 3 : 4;\n  }\n\n  // allocate buffer\n  buf = new utils.Buf8(buf_len);\n\n  // convert\n  for (i = 0, m_pos = 0; i < buf_len; m_pos++) {\n    c = str.charCodeAt(m_pos);\n    if ((c & 0xfc00) === 0xd800 && (m_pos + 1 < str_len)) {\n      c2 = str.charCodeAt(m_pos + 1);\n      if ((c2 & 0xfc00) === 0xdc00) {\n        c = 0x10000 + ((c - 0xd800) << 10) + (c2 - 0xdc00);\n        m_pos++;\n      }\n    }\n    if (c < 0x80) {\n      /* one byte */\n      buf[i++] = c;\n    } else if (c < 0x800) {\n      /* two bytes */\n      buf[i++] = 0xC0 | (c >>> 6);\n      buf[i++] = 0x80 | (c & 0x3f);\n    } else if (c < 0x10000) {\n      /* three bytes */\n      buf[i++] = 0xE0 | (c >>> 12);\n      buf[i++] = 0x80 | (c >>> 6 & 0x3f);\n      buf[i++] = 0x80 | (c & 0x3f);\n    } else {\n      /* four bytes */\n      buf[i++] = 0xf0 | (c >>> 18);\n      buf[i++] = 0x80 | (c >>> 12 & 0x3f);\n      buf[i++] = 0x80 | (c >>> 6 & 0x3f);\n      buf[i++] = 0x80 | (c & 0x3f);\n    }\n  }\n\n  return buf;\n};\n\n// Helper (used in 2 places)\nfunction buf2binstring(buf, len) {\n  // On Chrome, the arguments in a function call that are allowed is `65534`.\n  // If the length of the buffer is smaller than that, we can use this optimization,\n  // otherwise we will take a slower path.\n  if (len < 65534) {\n    if ((buf.subarray && STR_APPLY_UIA_OK) || (!buf.subarray && STR_APPLY_OK)) {\n      return String.fromCharCode.apply(null, utils.shrinkBuf(buf, len));\n    }\n  }\n\n  var result = '';\n  for (var i = 0; i < len; i++) {\n    result += String.fromCharCode(buf[i]);\n  }\n  return result;\n}\n\n\n// Convert byte array to binary string\nexports.buf2binstring = function (buf) {\n  return buf2binstring(buf, buf.length);\n};\n\n\n// Convert binary string (typed, when possible)\nexports.binstring2buf = function (str) {\n  var buf = new utils.Buf8(str.length);\n  for (var i = 0, len = buf.length; i < len; i++) {\n    buf[i] = str.charCodeAt(i);\n  }\n  return buf;\n};\n\n\n// convert array to string\nexports.buf2string = function (buf, max) {\n  var i, out, c, c_len;\n  var len = max || buf.length;\n\n  // Reserve max possible length (2 words per char)\n  // NB: by unknown reasons, Array is significantly faster for\n  //     String.fromCharCode.apply than Uint16Array.\n  var utf16buf = new Array(len * 2);\n\n  for (out = 0, i = 0; i < len;) {\n    c = buf[i++];\n    // quick process ascii\n    if (c < 0x80) { utf16buf[out++] = c; continue; }\n\n    c_len = _utf8len[c];\n    // skip 5 & 6 byte codes\n    if (c_len > 4) { utf16buf[out++] = 0xfffd; i += c_len - 1; continue; }\n\n    // apply mask on first byte\n    c &= c_len === 2 ? 0x1f : c_len === 3 ? 0x0f : 0x07;\n    // join the rest\n    while (c_len > 1 && i < len) {\n      c = (c << 6) | (buf[i++] & 0x3f);\n      c_len--;\n    }\n\n    // terminated by end of string?\n    if (c_len > 1) { utf16buf[out++] = 0xfffd; continue; }\n\n    if (c < 0x10000) {\n      utf16buf[out++] = c;\n    } else {\n      c -= 0x10000;\n      utf16buf[out++] = 0xd800 | ((c >> 10) & 0x3ff);\n      utf16buf[out++] = 0xdc00 | (c & 0x3ff);\n    }\n  }\n\n  return buf2binstring(utf16buf, out);\n};\n\n\n// Calculate max possible position in utf8 buffer,\n// that will not break sequence. If that's not possible\n// - (very small limits) return max size as is.\n//\n// buf[] - utf8 bytes array\n// max   - length limit (mandatory);\nexports.utf8border = function (buf, max) {\n  var pos;\n\n  max = max || buf.length;\n  if (max > buf.length) { max = buf.length; }\n\n  // go back from last position, until start of sequence found\n  pos = max - 1;\n  while (pos >= 0 && (buf[pos] & 0xC0) === 0x80) { pos--; }\n\n  // Very small and broken sequence,\n  // return max, because we should return something anyway.\n  if (pos < 0) { return max; }\n\n  // If we came to start of buffer - that means buffer is too small,\n  // return max too.\n  if (pos === 0) { return max; }\n\n  return (pos + _utf8len[buf[pos]] > max) ? pos : max;\n};\n","'use strict';\n\n// Note: adler32 takes 12% for level 0 and 2% for level 6.\n// It isn't worth it to make additional optimizations as in original.\n// Small size is preferable.\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\nfunction adler32(adler, buf, len, pos) {\n  var s1 = (adler & 0xffff) |0,\n      s2 = ((adler >>> 16) & 0xffff) |0,\n      n = 0;\n\n  while (len !== 0) {\n    // Set limit ~ twice less than 5552, to keep\n    // s2 in 31-bits, because we force signed ints.\n    // in other case %= will fail.\n    n = len > 2000 ? 2000 : len;\n    len -= n;\n\n    do {\n      s1 = (s1 + buf[pos++]) |0;\n      s2 = (s2 + s1) |0;\n    } while (--n);\n\n    s1 %= 65521;\n    s2 %= 65521;\n  }\n\n  return (s1 | (s2 << 16)) |0;\n}\n\n\nmodule.exports = adler32;\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\nmodule.exports = {\n\n  /* Allowed flush values; see deflate() and inflate() below for details */\n  Z_NO_FLUSH:         0,\n  Z_PARTIAL_FLUSH:    1,\n  Z_SYNC_FLUSH:       2,\n  Z_FULL_FLUSH:       3,\n  Z_FINISH:           4,\n  Z_BLOCK:            5,\n  Z_TREES:            6,\n\n  /* Return codes for the compression/decompression functions. Negative values\n  * are errors, positive values are used for special but normal events.\n  */\n  Z_OK:               0,\n  Z_STREAM_END:       1,\n  Z_NEED_DICT:        2,\n  Z_ERRNO:           -1,\n  Z_STREAM_ERROR:    -2,\n  Z_DATA_ERROR:      -3,\n  //Z_MEM_ERROR:     -4,\n  Z_BUF_ERROR:       -5,\n  //Z_VERSION_ERROR: -6,\n\n  /* compression levels */\n  Z_NO_COMPRESSION:         0,\n  Z_BEST_SPEED:             1,\n  Z_BEST_COMPRESSION:       9,\n  Z_DEFAULT_COMPRESSION:   -1,\n\n\n  Z_FILTERED:               1,\n  Z_HUFFMAN_ONLY:           2,\n  Z_RLE:                    3,\n  Z_FIXED:                  4,\n  Z_DEFAULT_STRATEGY:       0,\n\n  /* Possible values of the data_type field (though see inflate()) */\n  Z_BINARY:                 0,\n  Z_TEXT:                   1,\n  //Z_ASCII:                1, // = Z_TEXT (deprecated)\n  Z_UNKNOWN:                2,\n\n  /* The deflate compression method */\n  Z_DEFLATED:               8\n  //Z_NULL:                 null // Use -1 or null inline, depending on var type\n};\n","'use strict';\n\n// Note: we can't get significant speed boost here.\n// So write code to minimize size - no pregenerated tables\n// and array tools dependencies.\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\n// Use ordinary array, since untyped makes no boost here\nfunction makeTable() {\n  var c, table = [];\n\n  for (var n = 0; n < 256; n++) {\n    c = n;\n    for (var k = 0; k < 8; k++) {\n      c = ((c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1));\n    }\n    table[n] = c;\n  }\n\n  return table;\n}\n\n// Create table on load. Just 255 signed longs. Not a problem.\nvar crcTable = makeTable();\n\n\nfunction crc32(crc, buf, len, pos) {\n  var t = crcTable,\n      end = pos + len;\n\n  crc ^= -1;\n\n  for (var i = pos; i < end; i++) {\n    crc = (crc >>> 8) ^ t[(crc ^ buf[i]) & 0xFF];\n  }\n\n  return (crc ^ (-1)); // >>> 0;\n}\n\n\nmodule.exports = crc32;\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\nvar utils   = require('../utils/common');\nvar trees   = require('./trees');\nvar adler32 = require('./adler32');\nvar crc32   = require('./crc32');\nvar msg     = require('./messages');\n\n/* Public constants ==========================================================*/\n/* ===========================================================================*/\n\n\n/* Allowed flush values; see deflate() and inflate() below for details */\nvar Z_NO_FLUSH      = 0;\nvar Z_PARTIAL_FLUSH = 1;\n//var Z_SYNC_FLUSH    = 2;\nvar Z_FULL_FLUSH    = 3;\nvar Z_FINISH        = 4;\nvar Z_BLOCK         = 5;\n//var Z_TREES         = 6;\n\n\n/* Return codes for the compression/decompression functions. Negative values\n * are errors, positive values are used for special but normal events.\n */\nvar Z_OK            = 0;\nvar Z_STREAM_END    = 1;\n//var Z_NEED_DICT     = 2;\n//var Z_ERRNO         = -1;\nvar Z_STREAM_ERROR  = -2;\nvar Z_DATA_ERROR    = -3;\n//var Z_MEM_ERROR     = -4;\nvar Z_BUF_ERROR     = -5;\n//var Z_VERSION_ERROR = -6;\n\n\n/* compression levels */\n//var Z_NO_COMPRESSION      = 0;\n//var Z_BEST_SPEED          = 1;\n//var Z_BEST_COMPRESSION    = 9;\nvar Z_DEFAULT_COMPRESSION = -1;\n\n\nvar Z_FILTERED            = 1;\nvar Z_HUFFMAN_ONLY        = 2;\nvar Z_RLE                 = 3;\nvar Z_FIXED               = 4;\nvar Z_DEFAULT_STRATEGY    = 0;\n\n/* Possible values of the data_type field (though see inflate()) */\n//var Z_BINARY              = 0;\n//var Z_TEXT                = 1;\n//var Z_ASCII               = 1; // = Z_TEXT\nvar Z_UNKNOWN             = 2;\n\n\n/* The deflate compression method */\nvar Z_DEFLATED  = 8;\n\n/*============================================================================*/\n\n\nvar MAX_MEM_LEVEL = 9;\n/* Maximum value for memLevel in deflateInit2 */\nvar MAX_WBITS = 15;\n/* 32K LZ77 window */\nvar DEF_MEM_LEVEL = 8;\n\n\nvar LENGTH_CODES  = 29;\n/* number of length codes, not counting the special END_BLOCK code */\nvar LITERALS      = 256;\n/* number of literal bytes 0..255 */\nvar L_CODES       = LITERALS + 1 + LENGTH_CODES;\n/* number of Literal or Length codes, including the END_BLOCK code */\nvar D_CODES       = 30;\n/* number of distance codes */\nvar BL_CODES      = 19;\n/* number of codes used to transfer the bit lengths */\nvar HEAP_SIZE     = 2 * L_CODES + 1;\n/* maximum heap size */\nvar MAX_BITS  = 15;\n/* All codes must not exceed MAX_BITS bits */\n\nvar MIN_MATCH = 3;\nvar MAX_MATCH = 258;\nvar MIN_LOOKAHEAD = (MAX_MATCH + MIN_MATCH + 1);\n\nvar PRESET_DICT = 0x20;\n\nvar INIT_STATE = 42;\nvar EXTRA_STATE = 69;\nvar NAME_STATE = 73;\nvar COMMENT_STATE = 91;\nvar HCRC_STATE = 103;\nvar BUSY_STATE = 113;\nvar FINISH_STATE = 666;\n\nvar BS_NEED_MORE      = 1; /* block not completed, need more input or more output */\nvar BS_BLOCK_DONE     = 2; /* block flush performed */\nvar BS_FINISH_STARTED = 3; /* finish started, need only more output at next deflate */\nvar BS_FINISH_DONE    = 4; /* finish done, accept no more input or output */\n\nvar OS_CODE = 0x03; // Unix :) . Don't detect, use this default.\n\nfunction err(strm, errorCode) {\n  strm.msg = msg[errorCode];\n  return errorCode;\n}\n\nfunction rank(f) {\n  return ((f) << 1) - ((f) > 4 ? 9 : 0);\n}\n\nfunction zero(buf) { var len = buf.length; while (--len >= 0) { buf[len] = 0; } }\n\n\n/* =========================================================================\n * Flush as much pending output as possible. All deflate() output goes\n * through this function so some applications may wish to modify it\n * to avoid allocating a large strm->output buffer and copying into it.\n * (See also read_buf()).\n */\nfunction flush_pending(strm) {\n  var s = strm.state;\n\n  //_tr_flush_bits(s);\n  var len = s.pending;\n  if (len > strm.avail_out) {\n    len = strm.avail_out;\n  }\n  if (len === 0) { return; }\n\n  utils.arraySet(strm.output, s.pending_buf, s.pending_out, len, strm.next_out);\n  strm.next_out += len;\n  s.pending_out += len;\n  strm.total_out += len;\n  strm.avail_out -= len;\n  s.pending -= len;\n  if (s.pending === 0) {\n    s.pending_out = 0;\n  }\n}\n\n\nfunction flush_block_only(s, last) {\n  trees._tr_flush_block(s, (s.block_start >= 0 ? s.block_start : -1), s.strstart - s.block_start, last);\n  s.block_start = s.strstart;\n  flush_pending(s.strm);\n}\n\n\nfunction put_byte(s, b) {\n  s.pending_buf[s.pending++] = b;\n}\n\n\n/* =========================================================================\n * Put a short in the pending buffer. The 16-bit value is put in MSB order.\n * IN assertion: the stream state is correct and there is enough room in\n * pending_buf.\n */\nfunction putShortMSB(s, b) {\n//  put_byte(s, (Byte)(b >> 8));\n//  put_byte(s, (Byte)(b & 0xff));\n  s.pending_buf[s.pending++] = (b >>> 8) & 0xff;\n  s.pending_buf[s.pending++] = b & 0xff;\n}\n\n\n/* ===========================================================================\n * Read a new buffer from the current input stream, update the adler32\n * and total number of bytes read.  All deflate() input goes through\n * this function so some applications may wish to modify it to avoid\n * allocating a large strm->input buffer and copying from it.\n * (See also flush_pending()).\n */\nfunction read_buf(strm, buf, start, size) {\n  var len = strm.avail_in;\n\n  if (len > size) { len = size; }\n  if (len === 0) { return 0; }\n\n  strm.avail_in -= len;\n\n  // zmemcpy(buf, strm->next_in, len);\n  utils.arraySet(buf, strm.input, strm.next_in, len, start);\n  if (strm.state.wrap === 1) {\n    strm.adler = adler32(strm.adler, buf, len, start);\n  }\n\n  else if (strm.state.wrap === 2) {\n    strm.adler = crc32(strm.adler, buf, len, start);\n  }\n\n  strm.next_in += len;\n  strm.total_in += len;\n\n  return len;\n}\n\n\n/* ===========================================================================\n * Set match_start to the longest match starting at the given string and\n * return its length. Matches shorter or equal to prev_length are discarded,\n * in which case the result is equal to prev_length and match_start is\n * garbage.\n * IN assertions: cur_match is the head of the hash chain for the current\n *   string (strstart) and its distance is <= MAX_DIST, and prev_length >= 1\n * OUT assertion: the match length is not greater than s->lookahead.\n */\nfunction longest_match(s, cur_match) {\n  var chain_length = s.max_chain_length;      /* max hash chain length */\n  var scan = s.strstart; /* current string */\n  var match;                       /* matched string */\n  var len;                           /* length of current match */\n  var best_len = s.prev_length;              /* best match length so far */\n  var nice_match = s.nice_match;             /* stop if match long enough */\n  var limit = (s.strstart > (s.w_size - MIN_LOOKAHEAD)) ?\n      s.strstart - (s.w_size - MIN_LOOKAHEAD) : 0/*NIL*/;\n\n  var _win = s.window; // shortcut\n\n  var wmask = s.w_mask;\n  var prev  = s.prev;\n\n  /* Stop when cur_match becomes <= limit. To simplify the code,\n   * we prevent matches with the string of window index 0.\n   */\n\n  var strend = s.strstart + MAX_MATCH;\n  var scan_end1  = _win[scan + best_len - 1];\n  var scan_end   = _win[scan + best_len];\n\n  /* The code is optimized for HASH_BITS >= 8 and MAX_MATCH-2 multiple of 16.\n   * It is easy to get rid of this optimization if necessary.\n   */\n  // Assert(s->hash_bits >= 8 && MAX_MATCH == 258, \"Code too clever\");\n\n  /* Do not waste too much time if we already have a good match: */\n  if (s.prev_length >= s.good_match) {\n    chain_length >>= 2;\n  }\n  /* Do not look for matches beyond the end of the input. This is necessary\n   * to make deflate deterministic.\n   */\n  if (nice_match > s.lookahead) { nice_match = s.lookahead; }\n\n  // Assert((ulg)s->strstart <= s->window_size-MIN_LOOKAHEAD, \"need lookahead\");\n\n  do {\n    // Assert(cur_match < s->strstart, \"no future\");\n    match = cur_match;\n\n    /* Skip to next match if the match length cannot increase\n     * or if the match length is less than 2.  Note that the checks below\n     * for insufficient lookahead only occur occasionally for performance\n     * reasons.  Therefore uninitialized memory will be accessed, and\n     * conditional jumps will be made that depend on those values.\n     * However the length of the match is limited to the lookahead, so\n     * the output of deflate is not affected by the uninitialized values.\n     */\n\n    if (_win[match + best_len]     !== scan_end  ||\n        _win[match + best_len - 1] !== scan_end1 ||\n        _win[match]                !== _win[scan] ||\n        _win[++match]              !== _win[scan + 1]) {\n      continue;\n    }\n\n    /* The check at best_len-1 can be removed because it will be made\n     * again later. (This heuristic is not always a win.)\n     * It is not necessary to compare scan[2] and match[2] since they\n     * are always equal when the other bytes match, given that\n     * the hash keys are equal and that HASH_BITS >= 8.\n     */\n    scan += 2;\n    match++;\n    // Assert(*scan == *match, \"match[2]?\");\n\n    /* We check for insufficient lookahead only every 8th comparison;\n     * the 256th check will be made at strstart+258.\n     */\n    do {\n      /*jshint noempty:false*/\n    } while (_win[++scan] === _win[++match] && _win[++scan] === _win[++match] &&\n             _win[++scan] === _win[++match] && _win[++scan] === _win[++match] &&\n             _win[++scan] === _win[++match] && _win[++scan] === _win[++match] &&\n             _win[++scan] === _win[++match] && _win[++scan] === _win[++match] &&\n             scan < strend);\n\n    // Assert(scan <= s->window+(unsigned)(s->window_size-1), \"wild scan\");\n\n    len = MAX_MATCH - (strend - scan);\n    scan = strend - MAX_MATCH;\n\n    if (len > best_len) {\n      s.match_start = cur_match;\n      best_len = len;\n      if (len >= nice_match) {\n        break;\n      }\n      scan_end1  = _win[scan + best_len - 1];\n      scan_end   = _win[scan + best_len];\n    }\n  } while ((cur_match = prev[cur_match & wmask]) > limit && --chain_length !== 0);\n\n  if (best_len <= s.lookahead) {\n    return best_len;\n  }\n  return s.lookahead;\n}\n\n\n/* ===========================================================================\n * Fill the window when the lookahead becomes insufficient.\n * Updates strstart and lookahead.\n *\n * IN assertion: lookahead < MIN_LOOKAHEAD\n * OUT assertions: strstart <= window_size-MIN_LOOKAHEAD\n *    At least one byte has been read, or avail_in == 0; reads are\n *    performed for at least two bytes (required for the zip translate_eol\n *    option -- not supported here).\n */\nfunction fill_window(s) {\n  var _w_size = s.w_size;\n  var p, n, m, more, str;\n\n  //Assert(s->lookahead < MIN_LOOKAHEAD, \"already enough lookahead\");\n\n  do {\n    more = s.window_size - s.lookahead - s.strstart;\n\n    // JS ints have 32 bit, block below not needed\n    /* Deal with !@#$% 64K limit: */\n    //if (sizeof(int) <= 2) {\n    //    if (more == 0 && s->strstart == 0 && s->lookahead == 0) {\n    //        more = wsize;\n    //\n    //  } else if (more == (unsigned)(-1)) {\n    //        /* Very unlikely, but possible on 16 bit machine if\n    //         * strstart == 0 && lookahead == 1 (input done a byte at time)\n    //         */\n    //        more--;\n    //    }\n    //}\n\n\n    /* If the window is almost full and there is insufficient lookahead,\n     * move the upper half to the lower one to make room in the upper half.\n     */\n    if (s.strstart >= _w_size + (_w_size - MIN_LOOKAHEAD)) {\n\n      utils.arraySet(s.window, s.window, _w_size, _w_size, 0);\n      s.match_start -= _w_size;\n      s.strstart -= _w_size;\n      /* we now have strstart >= MAX_DIST */\n      s.block_start -= _w_size;\n\n      /* Slide the hash table (could be avoided with 32 bit values\n       at the expense of memory usage). We slide even when level == 0\n       to keep the hash table consistent if we switch back to level > 0\n       later. (Using level 0 permanently is not an optimal usage of\n       zlib, so we don't care about this pathological case.)\n       */\n\n      n = s.hash_size;\n      p = n;\n      do {\n        m = s.head[--p];\n        s.head[p] = (m >= _w_size ? m - _w_size : 0);\n      } while (--n);\n\n      n = _w_size;\n      p = n;\n      do {\n        m = s.prev[--p];\n        s.prev[p] = (m >= _w_size ? m - _w_size : 0);\n        /* If n is not on any hash chain, prev[n] is garbage but\n         * its value will never be used.\n         */\n      } while (--n);\n\n      more += _w_size;\n    }\n    if (s.strm.avail_in === 0) {\n      break;\n    }\n\n    /* If there was no sliding:\n     *    strstart <= WSIZE+MAX_DIST-1 && lookahead <= MIN_LOOKAHEAD - 1 &&\n     *    more == window_size - lookahead - strstart\n     * => more >= window_size - (MIN_LOOKAHEAD-1 + WSIZE + MAX_DIST-1)\n     * => more >= window_size - 2*WSIZE + 2\n     * In the BIG_MEM or MMAP case (not yet supported),\n     *   window_size == input_size + MIN_LOOKAHEAD  &&\n     *   strstart + s->lookahead <= input_size => more >= MIN_LOOKAHEAD.\n     * Otherwise, window_size == 2*WSIZE so more >= 2.\n     * If there was sliding, more >= WSIZE. So in all cases, more >= 2.\n     */\n    //Assert(more >= 2, \"more < 2\");\n    n = read_buf(s.strm, s.window, s.strstart + s.lookahead, more);\n    s.lookahead += n;\n\n    /* Initialize the hash value now that we have some input: */\n    if (s.lookahead + s.insert >= MIN_MATCH) {\n      str = s.strstart - s.insert;\n      s.ins_h = s.window[str];\n\n      /* UPDATE_HASH(s, s->ins_h, s->window[str + 1]); */\n      s.ins_h = ((s.ins_h << s.hash_shift) ^ s.window[str + 1]) & s.hash_mask;\n//#if MIN_MATCH != 3\n//        Call update_hash() MIN_MATCH-3 more times\n//#endif\n      while (s.insert) {\n        /* UPDATE_HASH(s, s->ins_h, s->window[str + MIN_MATCH-1]); */\n        s.ins_h = ((s.ins_h << s.hash_shift) ^ s.window[str + MIN_MATCH - 1]) & s.hash_mask;\n\n        s.prev[str & s.w_mask] = s.head[s.ins_h];\n        s.head[s.ins_h] = str;\n        str++;\n        s.insert--;\n        if (s.lookahead + s.insert < MIN_MATCH) {\n          break;\n        }\n      }\n    }\n    /* If the whole input has less than MIN_MATCH bytes, ins_h is garbage,\n     * but this is not important since only literal bytes will be emitted.\n     */\n\n  } while (s.lookahead < MIN_LOOKAHEAD && s.strm.avail_in !== 0);\n\n  /* If the WIN_INIT bytes after the end of the current data have never been\n   * written, then zero those bytes in order to avoid memory check reports of\n   * the use of uninitialized (or uninitialised as Julian writes) bytes by\n   * the longest match routines.  Update the high water mark for the next\n   * time through here.  WIN_INIT is set to MAX_MATCH since the longest match\n   * routines allow scanning to strstart + MAX_MATCH, ignoring lookahead.\n   */\n//  if (s.high_water < s.window_size) {\n//    var curr = s.strstart + s.lookahead;\n//    var init = 0;\n//\n//    if (s.high_water < curr) {\n//      /* Previous high water mark below current data -- zero WIN_INIT\n//       * bytes or up to end of window, whichever is less.\n//       */\n//      init = s.window_size - curr;\n//      if (init > WIN_INIT)\n//        init = WIN_INIT;\n//      zmemzero(s->window + curr, (unsigned)init);\n//      s->high_water = curr + init;\n//    }\n//    else if (s->high_water < (ulg)curr + WIN_INIT) {\n//      /* High water mark at or above current data, but below current data\n//       * plus WIN_INIT -- zero out to current data plus WIN_INIT, or up\n//       * to end of window, whichever is less.\n//       */\n//      init = (ulg)curr + WIN_INIT - s->high_water;\n//      if (init > s->window_size - s->high_water)\n//        init = s->window_size - s->high_water;\n//      zmemzero(s->window + s->high_water, (unsigned)init);\n//      s->high_water += init;\n//    }\n//  }\n//\n//  Assert((ulg)s->strstart <= s->window_size - MIN_LOOKAHEAD,\n//    \"not enough room for search\");\n}\n\n/* ===========================================================================\n * Copy without compression as much as possible from the input stream, return\n * the current block state.\n * This function does not insert new strings in the dictionary since\n * uncompressible data is probably not useful. This function is used\n * only for the level=0 compression option.\n * NOTE: this function should be optimized to avoid extra copying from\n * window to pending_buf.\n */\nfunction deflate_stored(s, flush) {\n  /* Stored blocks are limited to 0xffff bytes, pending_buf is limited\n   * to pending_buf_size, and each stored block has a 5 byte header:\n   */\n  var max_block_size = 0xffff;\n\n  if (max_block_size > s.pending_buf_size - 5) {\n    max_block_size = s.pending_buf_size - 5;\n  }\n\n  /* Copy as much as possible from input to output: */\n  for (;;) {\n    /* Fill the window as much as possible: */\n    if (s.lookahead <= 1) {\n\n      //Assert(s->strstart < s->w_size+MAX_DIST(s) ||\n      //  s->block_start >= (long)s->w_size, \"slide too late\");\n//      if (!(s.strstart < s.w_size + (s.w_size - MIN_LOOKAHEAD) ||\n//        s.block_start >= s.w_size)) {\n//        throw  new Error(\"slide too late\");\n//      }\n\n      fill_window(s);\n      if (s.lookahead === 0 && flush === Z_NO_FLUSH) {\n        return BS_NEED_MORE;\n      }\n\n      if (s.lookahead === 0) {\n        break;\n      }\n      /* flush the current block */\n    }\n    //Assert(s->block_start >= 0L, \"block gone\");\n//    if (s.block_start < 0) throw new Error(\"block gone\");\n\n    s.strstart += s.lookahead;\n    s.lookahead = 0;\n\n    /* Emit a stored block if pending_buf will be full: */\n    var max_start = s.block_start + max_block_size;\n\n    if (s.strstart === 0 || s.strstart >= max_start) {\n      /* strstart == 0 is possible when wraparound on 16-bit machine */\n      s.lookahead = s.strstart - max_start;\n      s.strstart = max_start;\n      /*** FLUSH_BLOCK(s, 0); ***/\n      flush_block_only(s, false);\n      if (s.strm.avail_out === 0) {\n        return BS_NEED_MORE;\n      }\n      /***/\n\n\n    }\n    /* Flush if we may have to slide, otherwise block_start may become\n     * negative and the data will be gone:\n     */\n    if (s.strstart - s.block_start >= (s.w_size - MIN_LOOKAHEAD)) {\n      /*** FLUSH_BLOCK(s, 0); ***/\n      flush_block_only(s, false);\n      if (s.strm.avail_out === 0) {\n        return BS_NEED_MORE;\n      }\n      /***/\n    }\n  }\n\n  s.insert = 0;\n\n  if (flush === Z_FINISH) {\n    /*** FLUSH_BLOCK(s, 1); ***/\n    flush_block_only(s, true);\n    if (s.strm.avail_out === 0) {\n      return BS_FINISH_STARTED;\n    }\n    /***/\n    return BS_FINISH_DONE;\n  }\n\n  if (s.strstart > s.block_start) {\n    /*** FLUSH_BLOCK(s, 0); ***/\n    flush_block_only(s, false);\n    if (s.strm.avail_out === 0) {\n      return BS_NEED_MORE;\n    }\n    /***/\n  }\n\n  return BS_NEED_MORE;\n}\n\n/* ===========================================================================\n * Compress as much as possible from the input stream, return the current\n * block state.\n * This function does not perform lazy evaluation of matches and inserts\n * new strings in the dictionary only for unmatched strings or for short\n * matches. It is used only for the fast compression options.\n */\nfunction deflate_fast(s, flush) {\n  var hash_head;        /* head of the hash chain */\n  var bflush;           /* set if current block must be flushed */\n\n  for (;;) {\n    /* Make sure that we always have enough lookahead, except\n     * at the end of the input file. We need MAX_MATCH bytes\n     * for the next match, plus MIN_MATCH bytes to insert the\n     * string following the next match.\n     */\n    if (s.lookahead < MIN_LOOKAHEAD) {\n      fill_window(s);\n      if (s.lookahead < MIN_LOOKAHEAD && flush === Z_NO_FLUSH) {\n        return BS_NEED_MORE;\n      }\n      if (s.lookahead === 0) {\n        break; /* flush the current block */\n      }\n    }\n\n    /* Insert the string window[strstart .. strstart+2] in the\n     * dictionary, and set hash_head to the head of the hash chain:\n     */\n    hash_head = 0/*NIL*/;\n    if (s.lookahead >= MIN_MATCH) {\n      /*** INSERT_STRING(s, s.strstart, hash_head); ***/\n      s.ins_h = ((s.ins_h << s.hash_shift) ^ s.window[s.strstart + MIN_MATCH - 1]) & s.hash_mask;\n      hash_head = s.prev[s.strstart & s.w_mask] = s.head[s.ins_h];\n      s.head[s.ins_h] = s.strstart;\n      /***/\n    }\n\n    /* Find the longest match, discarding those <= prev_length.\n     * At this point we have always match_length < MIN_MATCH\n     */\n    if (hash_head !== 0/*NIL*/ && ((s.strstart - hash_head) <= (s.w_size - MIN_LOOKAHEAD))) {\n      /* To simplify the code, we prevent matches with the string\n       * of window index 0 (in particular we have to avoid a match\n       * of the string with itself at the start of the input file).\n       */\n      s.match_length = longest_match(s, hash_head);\n      /* longest_match() sets match_start */\n    }\n    if (s.match_length >= MIN_MATCH) {\n      // check_match(s, s.strstart, s.match_start, s.match_length); // for debug only\n\n      /*** _tr_tally_dist(s, s.strstart - s.match_start,\n                     s.match_length - MIN_MATCH, bflush); ***/\n      bflush = trees._tr_tally(s, s.strstart - s.match_start, s.match_length - MIN_MATCH);\n\n      s.lookahead -= s.match_length;\n\n      /* Insert new strings in the hash table only if the match length\n       * is not too large. This saves time but degrades compression.\n       */\n      if (s.match_length <= s.max_lazy_match/*max_insert_length*/ && s.lookahead >= MIN_MATCH) {\n        s.match_length--; /* string at strstart already in table */\n        do {\n          s.strstart++;\n          /*** INSERT_STRING(s, s.strstart, hash_head); ***/\n          s.ins_h = ((s.ins_h << s.hash_shift) ^ s.window[s.strstart + MIN_MATCH - 1]) & s.hash_mask;\n          hash_head = s.prev[s.strstart & s.w_mask] = s.head[s.ins_h];\n          s.head[s.ins_h] = s.strstart;\n          /***/\n          /* strstart never exceeds WSIZE-MAX_MATCH, so there are\n           * always MIN_MATCH bytes ahead.\n           */\n        } while (--s.match_length !== 0);\n        s.strstart++;\n      } else\n      {\n        s.strstart += s.match_length;\n        s.match_length = 0;\n        s.ins_h = s.window[s.strstart];\n        /* UPDATE_HASH(s, s.ins_h, s.window[s.strstart+1]); */\n        s.ins_h = ((s.ins_h << s.hash_shift) ^ s.window[s.strstart + 1]) & s.hash_mask;\n\n//#if MIN_MATCH != 3\n//                Call UPDATE_HASH() MIN_MATCH-3 more times\n//#endif\n        /* If lookahead < MIN_MATCH, ins_h is garbage, but it does not\n         * matter since it will be recomputed at next deflate call.\n         */\n      }\n    } else {\n      /* No match, output a literal byte */\n      //Tracevv((stderr,\"%c\", s.window[s.strstart]));\n      /*** _tr_tally_lit(s, s.window[s.strstart], bflush); ***/\n      bflush = trees._tr_tally(s, 0, s.window[s.strstart]);\n\n      s.lookahead--;\n      s.strstart++;\n    }\n    if (bflush) {\n      /*** FLUSH_BLOCK(s, 0); ***/\n      flush_block_only(s, false);\n      if (s.strm.avail_out === 0) {\n        return BS_NEED_MORE;\n      }\n      /***/\n    }\n  }\n  s.insert = ((s.strstart < (MIN_MATCH - 1)) ? s.strstart : MIN_MATCH - 1);\n  if (flush === Z_FINISH) {\n    /*** FLUSH_BLOCK(s, 1); ***/\n    flush_block_only(s, true);\n    if (s.strm.avail_out === 0) {\n      return BS_FINISH_STARTED;\n    }\n    /***/\n    return BS_FINISH_DONE;\n  }\n  if (s.last_lit) {\n    /*** FLUSH_BLOCK(s, 0); ***/\n    flush_block_only(s, false);\n    if (s.strm.avail_out === 0) {\n      return BS_NEED_MORE;\n    }\n    /***/\n  }\n  return BS_BLOCK_DONE;\n}\n\n/* ===========================================================================\n * Same as above, but achieves better compression. We use a lazy\n * evaluation for matches: a match is finally adopted only if there is\n * no better match at the next window position.\n */\nfunction deflate_slow(s, flush) {\n  var hash_head;          /* head of hash chain */\n  var bflush;              /* set if current block must be flushed */\n\n  var max_insert;\n\n  /* Process the input block. */\n  for (;;) {\n    /* Make sure that we always have enough lookahead, except\n     * at the end of the input file. We need MAX_MATCH bytes\n     * for the next match, plus MIN_MATCH bytes to insert the\n     * string following the next match.\n     */\n    if (s.lookahead < MIN_LOOKAHEAD) {\n      fill_window(s);\n      if (s.lookahead < MIN_LOOKAHEAD && flush === Z_NO_FLUSH) {\n        return BS_NEED_MORE;\n      }\n      if (s.lookahead === 0) { break; } /* flush the current block */\n    }\n\n    /* Insert the string window[strstart .. strstart+2] in the\n     * dictionary, and set hash_head to the head of the hash chain:\n     */\n    hash_head = 0/*NIL*/;\n    if (s.lookahead >= MIN_MATCH) {\n      /*** INSERT_STRING(s, s.strstart, hash_head); ***/\n      s.ins_h = ((s.ins_h << s.hash_shift) ^ s.window[s.strstart + MIN_MATCH - 1]) & s.hash_mask;\n      hash_head = s.prev[s.strstart & s.w_mask] = s.head[s.ins_h];\n      s.head[s.ins_h] = s.strstart;\n      /***/\n    }\n\n    /* Find the longest match, discarding those <= prev_length.\n     */\n    s.prev_length = s.match_length;\n    s.prev_match = s.match_start;\n    s.match_length = MIN_MATCH - 1;\n\n    if (hash_head !== 0/*NIL*/ && s.prev_length < s.max_lazy_match &&\n        s.strstart - hash_head <= (s.w_size - MIN_LOOKAHEAD)/*MAX_DIST(s)*/) {\n      /* To simplify the code, we prevent matches with the string\n       * of window index 0 (in particular we have to avoid a match\n       * of the string with itself at the start of the input file).\n       */\n      s.match_length = longest_match(s, hash_head);\n      /* longest_match() sets match_start */\n\n      if (s.match_length <= 5 &&\n         (s.strategy === Z_FILTERED || (s.match_length === MIN_MATCH && s.strstart - s.match_start > 4096/*TOO_FAR*/))) {\n\n        /* If prev_match is also MIN_MATCH, match_start is garbage\n         * but we will ignore the current match anyway.\n         */\n        s.match_length = MIN_MATCH - 1;\n      }\n    }\n    /* If there was a match at the previous step and the current\n     * match is not better, output the previous match:\n     */\n    if (s.prev_length >= MIN_MATCH && s.match_length <= s.prev_length) {\n      max_insert = s.strstart + s.lookahead - MIN_MATCH;\n      /* Do not insert strings in hash table beyond this. */\n\n      //check_match(s, s.strstart-1, s.prev_match, s.prev_length);\n\n      /***_tr_tally_dist(s, s.strstart - 1 - s.prev_match,\n                     s.prev_length - MIN_MATCH, bflush);***/\n      bflush = trees._tr_tally(s, s.strstart - 1 - s.prev_match, s.prev_length - MIN_MATCH);\n      /* Insert in hash table all strings up to the end of the match.\n       * strstart-1 and strstart are already inserted. If there is not\n       * enough lookahead, the last two strings are not inserted in\n       * the hash table.\n       */\n      s.lookahead -= s.prev_length - 1;\n      s.prev_length -= 2;\n      do {\n        if (++s.strstart <= max_insert) {\n          /*** INSERT_STRING(s, s.strstart, hash_head); ***/\n          s.ins_h = ((s.ins_h << s.hash_shift) ^ s.window[s.strstart + MIN_MATCH - 1]) & s.hash_mask;\n          hash_head = s.prev[s.strstart & s.w_mask] = s.head[s.ins_h];\n          s.head[s.ins_h] = s.strstart;\n          /***/\n        }\n      } while (--s.prev_length !== 0);\n      s.match_available = 0;\n      s.match_length = MIN_MATCH - 1;\n      s.strstart++;\n\n      if (bflush) {\n        /*** FLUSH_BLOCK(s, 0); ***/\n        flush_block_only(s, false);\n        if (s.strm.avail_out === 0) {\n          return BS_NEED_MORE;\n        }\n        /***/\n      }\n\n    } else if (s.match_available) {\n      /* If there was no match at the previous position, output a\n       * single literal. If there was a match but the current match\n       * is longer, truncate the previous match to a single literal.\n       */\n      //Tracevv((stderr,\"%c\", s->window[s->strstart-1]));\n      /*** _tr_tally_lit(s, s.window[s.strstart-1], bflush); ***/\n      bflush = trees._tr_tally(s, 0, s.window[s.strstart - 1]);\n\n      if (bflush) {\n        /*** FLUSH_BLOCK_ONLY(s, 0) ***/\n        flush_block_only(s, false);\n        /***/\n      }\n      s.strstart++;\n      s.lookahead--;\n      if (s.strm.avail_out === 0) {\n        return BS_NEED_MORE;\n      }\n    } else {\n      /* There is no previous match to compare with, wait for\n       * the next step to decide.\n       */\n      s.match_available = 1;\n      s.strstart++;\n      s.lookahead--;\n    }\n  }\n  //Assert (flush != Z_NO_FLUSH, \"no flush?\");\n  if (s.match_available) {\n    //Tracevv((stderr,\"%c\", s->window[s->strstart-1]));\n    /*** _tr_tally_lit(s, s.window[s.strstart-1], bflush); ***/\n    bflush = trees._tr_tally(s, 0, s.window[s.strstart - 1]);\n\n    s.match_available = 0;\n  }\n  s.insert = s.strstart < MIN_MATCH - 1 ? s.strstart : MIN_MATCH - 1;\n  if (flush === Z_FINISH) {\n    /*** FLUSH_BLOCK(s, 1); ***/\n    flush_block_only(s, true);\n    if (s.strm.avail_out === 0) {\n      return BS_FINISH_STARTED;\n    }\n    /***/\n    return BS_FINISH_DONE;\n  }\n  if (s.last_lit) {\n    /*** FLUSH_BLOCK(s, 0); ***/\n    flush_block_only(s, false);\n    if (s.strm.avail_out === 0) {\n      return BS_NEED_MORE;\n    }\n    /***/\n  }\n\n  return BS_BLOCK_DONE;\n}\n\n\n/* ===========================================================================\n * For Z_RLE, simply look for runs of bytes, generate matches only of distance\n * one.  Do not maintain a hash table.  (It will be regenerated if this run of\n * deflate switches away from Z_RLE.)\n */\nfunction deflate_rle(s, flush) {\n  var bflush;            /* set if current block must be flushed */\n  var prev;              /* byte at distance one to match */\n  var scan, strend;      /* scan goes up to strend for length of run */\n\n  var _win = s.window;\n\n  for (;;) {\n    /* Make sure that we always have enough lookahead, except\n     * at the end of the input file. We need MAX_MATCH bytes\n     * for the longest run, plus one for the unrolled loop.\n     */\n    if (s.lookahead <= MAX_MATCH) {\n      fill_window(s);\n      if (s.lookahead <= MAX_MATCH && flush === Z_NO_FLUSH) {\n        return BS_NEED_MORE;\n      }\n      if (s.lookahead === 0) { break; } /* flush the current block */\n    }\n\n    /* See how many times the previous byte repeats */\n    s.match_length = 0;\n    if (s.lookahead >= MIN_MATCH && s.strstart > 0) {\n      scan = s.strstart - 1;\n      prev = _win[scan];\n      if (prev === _win[++scan] && prev === _win[++scan] && prev === _win[++scan]) {\n        strend = s.strstart + MAX_MATCH;\n        do {\n          /*jshint noempty:false*/\n        } while (prev === _win[++scan] && prev === _win[++scan] &&\n                 prev === _win[++scan] && prev === _win[++scan] &&\n                 prev === _win[++scan] && prev === _win[++scan] &&\n                 prev === _win[++scan] && prev === _win[++scan] &&\n                 scan < strend);\n        s.match_length = MAX_MATCH - (strend - scan);\n        if (s.match_length > s.lookahead) {\n          s.match_length = s.lookahead;\n        }\n      }\n      //Assert(scan <= s->window+(uInt)(s->window_size-1), \"wild scan\");\n    }\n\n    /* Emit match if have run of MIN_MATCH or longer, else emit literal */\n    if (s.match_length >= MIN_MATCH) {\n      //check_match(s, s.strstart, s.strstart - 1, s.match_length);\n\n      /*** _tr_tally_dist(s, 1, s.match_length - MIN_MATCH, bflush); ***/\n      bflush = trees._tr_tally(s, 1, s.match_length - MIN_MATCH);\n\n      s.lookahead -= s.match_length;\n      s.strstart += s.match_length;\n      s.match_length = 0;\n    } else {\n      /* No match, output a literal byte */\n      //Tracevv((stderr,\"%c\", s->window[s->strstart]));\n      /*** _tr_tally_lit(s, s.window[s.strstart], bflush); ***/\n      bflush = trees._tr_tally(s, 0, s.window[s.strstart]);\n\n      s.lookahead--;\n      s.strstart++;\n    }\n    if (bflush) {\n      /*** FLUSH_BLOCK(s, 0); ***/\n      flush_block_only(s, false);\n      if (s.strm.avail_out === 0) {\n        return BS_NEED_MORE;\n      }\n      /***/\n    }\n  }\n  s.insert = 0;\n  if (flush === Z_FINISH) {\n    /*** FLUSH_BLOCK(s, 1); ***/\n    flush_block_only(s, true);\n    if (s.strm.avail_out === 0) {\n      return BS_FINISH_STARTED;\n    }\n    /***/\n    return BS_FINISH_DONE;\n  }\n  if (s.last_lit) {\n    /*** FLUSH_BLOCK(s, 0); ***/\n    flush_block_only(s, false);\n    if (s.strm.avail_out === 0) {\n      return BS_NEED_MORE;\n    }\n    /***/\n  }\n  return BS_BLOCK_DONE;\n}\n\n/* ===========================================================================\n * For Z_HUFFMAN_ONLY, do not look for matches.  Do not maintain a hash table.\n * (It will be regenerated if this run of deflate switches away from Huffman.)\n */\nfunction deflate_huff(s, flush) {\n  var bflush;             /* set if current block must be flushed */\n\n  for (;;) {\n    /* Make sure that we have a literal to write. */\n    if (s.lookahead === 0) {\n      fill_window(s);\n      if (s.lookahead === 0) {\n        if (flush === Z_NO_FLUSH) {\n          return BS_NEED_MORE;\n        }\n        break;      /* flush the current block */\n      }\n    }\n\n    /* Output a literal byte */\n    s.match_length = 0;\n    //Tracevv((stderr,\"%c\", s->window[s->strstart]));\n    /*** _tr_tally_lit(s, s.window[s.strstart], bflush); ***/\n    bflush = trees._tr_tally(s, 0, s.window[s.strstart]);\n    s.lookahead--;\n    s.strstart++;\n    if (bflush) {\n      /*** FLUSH_BLOCK(s, 0); ***/\n      flush_block_only(s, false);\n      if (s.strm.avail_out === 0) {\n        return BS_NEED_MORE;\n      }\n      /***/\n    }\n  }\n  s.insert = 0;\n  if (flush === Z_FINISH) {\n    /*** FLUSH_BLOCK(s, 1); ***/\n    flush_block_only(s, true);\n    if (s.strm.avail_out === 0) {\n      return BS_FINISH_STARTED;\n    }\n    /***/\n    return BS_FINISH_DONE;\n  }\n  if (s.last_lit) {\n    /*** FLUSH_BLOCK(s, 0); ***/\n    flush_block_only(s, false);\n    if (s.strm.avail_out === 0) {\n      return BS_NEED_MORE;\n    }\n    /***/\n  }\n  return BS_BLOCK_DONE;\n}\n\n/* Values for max_lazy_match, good_match and max_chain_length, depending on\n * the desired pack level (0..9). The values given below have been tuned to\n * exclude worst case performance for pathological files. Better values may be\n * found for specific files.\n */\nfunction Config(good_length, max_lazy, nice_length, max_chain, func) {\n  this.good_length = good_length;\n  this.max_lazy = max_lazy;\n  this.nice_length = nice_length;\n  this.max_chain = max_chain;\n  this.func = func;\n}\n\nvar configuration_table;\n\nconfiguration_table = [\n  /*      good lazy nice chain */\n  new Config(0, 0, 0, 0, deflate_stored),          /* 0 store only */\n  new Config(4, 4, 8, 4, deflate_fast),            /* 1 max speed, no lazy matches */\n  new Config(4, 5, 16, 8, deflate_fast),           /* 2 */\n  new Config(4, 6, 32, 32, deflate_fast),          /* 3 */\n\n  new Config(4, 4, 16, 16, deflate_slow),          /* 4 lazy matches */\n  new Config(8, 16, 32, 32, deflate_slow),         /* 5 */\n  new Config(8, 16, 128, 128, deflate_slow),       /* 6 */\n  new Config(8, 32, 128, 256, deflate_slow),       /* 7 */\n  new Config(32, 128, 258, 1024, deflate_slow),    /* 8 */\n  new Config(32, 258, 258, 4096, deflate_slow)     /* 9 max compression */\n];\n\n\n/* ===========================================================================\n * Initialize the \"longest match\" routines for a new zlib stream\n */\nfunction lm_init(s) {\n  s.window_size = 2 * s.w_size;\n\n  /*** CLEAR_HASH(s); ***/\n  zero(s.head); // Fill with NIL (= 0);\n\n  /* Set the default configuration parameters:\n   */\n  s.max_lazy_match = configuration_table[s.level].max_lazy;\n  s.good_match = configuration_table[s.level].good_length;\n  s.nice_match = configuration_table[s.level].nice_length;\n  s.max_chain_length = configuration_table[s.level].max_chain;\n\n  s.strstart = 0;\n  s.block_start = 0;\n  s.lookahead = 0;\n  s.insert = 0;\n  s.match_length = s.prev_length = MIN_MATCH - 1;\n  s.match_available = 0;\n  s.ins_h = 0;\n}\n\n\nfunction DeflateState() {\n  this.strm = null;            /* pointer back to this zlib stream */\n  this.status = 0;            /* as the name implies */\n  this.pending_buf = null;      /* output still pending */\n  this.pending_buf_size = 0;  /* size of pending_buf */\n  this.pending_out = 0;       /* next pending byte to output to the stream */\n  this.pending = 0;           /* nb of bytes in the pending buffer */\n  this.wrap = 0;              /* bit 0 true for zlib, bit 1 true for gzip */\n  this.gzhead = null;         /* gzip header information to write */\n  this.gzindex = 0;           /* where in extra, name, or comment */\n  this.method = Z_DEFLATED; /* can only be DEFLATED */\n  this.last_flush = -1;   /* value of flush param for previous deflate call */\n\n  this.w_size = 0;  /* LZ77 window size (32K by default) */\n  this.w_bits = 0;  /* log2(w_size)  (8..16) */\n  this.w_mask = 0;  /* w_size - 1 */\n\n  this.window = null;\n  /* Sliding window. Input bytes are read into the second half of the window,\n   * and move to the first half later to keep a dictionary of at least wSize\n   * bytes. With this organization, matches are limited to a distance of\n   * wSize-MAX_MATCH bytes, but this ensures that IO is always\n   * performed with a length multiple of the block size.\n   */\n\n  this.window_size = 0;\n  /* Actual size of window: 2*wSize, except when the user input buffer\n   * is directly used as sliding window.\n   */\n\n  this.prev = null;\n  /* Link to older string with same hash index. To limit the size of this\n   * array to 64K, this link is maintained only for the last 32K strings.\n   * An index in this array is thus a window index modulo 32K.\n   */\n\n  this.head = null;   /* Heads of the hash chains or NIL. */\n\n  this.ins_h = 0;       /* hash index of string to be inserted */\n  this.hash_size = 0;   /* number of elements in hash table */\n  this.hash_bits = 0;   /* log2(hash_size) */\n  this.hash_mask = 0;   /* hash_size-1 */\n\n  this.hash_shift = 0;\n  /* Number of bits by which ins_h must be shifted at each input\n   * step. It must be such that after MIN_MATCH steps, the oldest\n   * byte no longer takes part in the hash key, that is:\n   *   hash_shift * MIN_MATCH >= hash_bits\n   */\n\n  this.block_start = 0;\n  /* Window position at the beginning of the current output block. Gets\n   * negative when the window is moved backwards.\n   */\n\n  this.match_length = 0;      /* length of best match */\n  this.prev_match = 0;        /* previous match */\n  this.match_available = 0;   /* set if previous match exists */\n  this.strstart = 0;          /* start of string to insert */\n  this.match_start = 0;       /* start of matching string */\n  this.lookahead = 0;         /* number of valid bytes ahead in window */\n\n  this.prev_length = 0;\n  /* Length of the best match at previous step. Matches not greater than this\n   * are discarded. This is used in the lazy match evaluation.\n   */\n\n  this.max_chain_length = 0;\n  /* To speed up deflation, hash chains are never searched beyond this\n   * length.  A higher limit improves compression ratio but degrades the\n   * speed.\n   */\n\n  this.max_lazy_match = 0;\n  /* Attempt to find a better match only when the current match is strictly\n   * smaller than this value. This mechanism is used only for compression\n   * levels >= 4.\n   */\n  // That's alias to max_lazy_match, don't use directly\n  //this.max_insert_length = 0;\n  /* Insert new strings in the hash table only if the match length is not\n   * greater than this length. This saves time but degrades compression.\n   * max_insert_length is used only for compression levels <= 3.\n   */\n\n  this.level = 0;     /* compression level (1..9) */\n  this.strategy = 0;  /* favor or force Huffman coding*/\n\n  this.good_match = 0;\n  /* Use a faster search when the previous match is longer than this */\n\n  this.nice_match = 0; /* Stop searching when current match exceeds this */\n\n              /* used by trees.c: */\n\n  /* Didn't use ct_data typedef below to suppress compiler warning */\n\n  // struct ct_data_s dyn_ltree[HEAP_SIZE];   /* literal and length tree */\n  // struct ct_data_s dyn_dtree[2*D_CODES+1]; /* distance tree */\n  // struct ct_data_s bl_tree[2*BL_CODES+1];  /* Huffman tree for bit lengths */\n\n  // Use flat array of DOUBLE size, with interleaved fata,\n  // because JS does not support effective\n  this.dyn_ltree  = new utils.Buf16(HEAP_SIZE * 2);\n  this.dyn_dtree  = new utils.Buf16((2 * D_CODES + 1) * 2);\n  this.bl_tree    = new utils.Buf16((2 * BL_CODES + 1) * 2);\n  zero(this.dyn_ltree);\n  zero(this.dyn_dtree);\n  zero(this.bl_tree);\n\n  this.l_desc   = null;         /* desc. for literal tree */\n  this.d_desc   = null;         /* desc. for distance tree */\n  this.bl_desc  = null;         /* desc. for bit length tree */\n\n  //ush bl_count[MAX_BITS+1];\n  this.bl_count = new utils.Buf16(MAX_BITS + 1);\n  /* number of codes at each bit length for an optimal tree */\n\n  //int heap[2*L_CODES+1];      /* heap used to build the Huffman trees */\n  this.heap = new utils.Buf16(2 * L_CODES + 1);  /* heap used to build the Huffman trees */\n  zero(this.heap);\n\n  this.heap_len = 0;               /* number of elements in the heap */\n  this.heap_max = 0;               /* element of largest frequency */\n  /* The sons of heap[n] are heap[2*n] and heap[2*n+1]. heap[0] is not used.\n   * The same heap array is used to build all trees.\n   */\n\n  this.depth = new utils.Buf16(2 * L_CODES + 1); //uch depth[2*L_CODES+1];\n  zero(this.depth);\n  /* Depth of each subtree used as tie breaker for trees of equal frequency\n   */\n\n  this.l_buf = 0;          /* buffer index for literals or lengths */\n\n  this.lit_bufsize = 0;\n  /* Size of match buffer for literals/lengths.  There are 4 reasons for\n   * limiting lit_bufsize to 64K:\n   *   - frequencies can be kept in 16 bit counters\n   *   - if compression is not successful for the first block, all input\n   *     data is still in the window so we can still emit a stored block even\n   *     when input comes from standard input.  (This can also be done for\n   *     all blocks if lit_bufsize is not greater than 32K.)\n   *   - if compression is not successful for a file smaller than 64K, we can\n   *     even emit a stored file instead of a stored block (saving 5 bytes).\n   *     This is applicable only for zip (not gzip or zlib).\n   *   - creating new Huffman trees less frequently may not provide fast\n   *     adaptation to changes in the input data statistics. (Take for\n   *     example a binary file with poorly compressible code followed by\n   *     a highly compressible string table.) Smaller buffer sizes give\n   *     fast adaptation but have of course the overhead of transmitting\n   *     trees more frequently.\n   *   - I can't count above 4\n   */\n\n  this.last_lit = 0;      /* running index in l_buf */\n\n  this.d_buf = 0;\n  /* Buffer index for distances. To simplify the code, d_buf and l_buf have\n   * the same number of elements. To use different lengths, an extra flag\n   * array would be necessary.\n   */\n\n  this.opt_len = 0;       /* bit length of current block with optimal trees */\n  this.static_len = 0;    /* bit length of current block with static trees */\n  this.matches = 0;       /* number of string matches in current block */\n  this.insert = 0;        /* bytes at end of window left to insert */\n\n\n  this.bi_buf = 0;\n  /* Output buffer. bits are inserted starting at the bottom (least\n   * significant bits).\n   */\n  this.bi_valid = 0;\n  /* Number of valid bits in bi_buf.  All bits above the last valid bit\n   * are always zero.\n   */\n\n  // Used for window memory init. We safely ignore it for JS. That makes\n  // sense only for pointers and memory check tools.\n  //this.high_water = 0;\n  /* High water mark offset in window for initialized bytes -- bytes above\n   * this are set to zero in order to avoid memory check warnings when\n   * longest match routines access bytes past the input.  This is then\n   * updated to the new high water mark.\n   */\n}\n\n\nfunction deflateResetKeep(strm) {\n  var s;\n\n  if (!strm || !strm.state) {\n    return err(strm, Z_STREAM_ERROR);\n  }\n\n  strm.total_in = strm.total_out = 0;\n  strm.data_type = Z_UNKNOWN;\n\n  s = strm.state;\n  s.pending = 0;\n  s.pending_out = 0;\n\n  if (s.wrap < 0) {\n    s.wrap = -s.wrap;\n    /* was made negative by deflate(..., Z_FINISH); */\n  }\n  s.status = (s.wrap ? INIT_STATE : BUSY_STATE);\n  strm.adler = (s.wrap === 2) ?\n    0  // crc32(0, Z_NULL, 0)\n  :\n    1; // adler32(0, Z_NULL, 0)\n  s.last_flush = Z_NO_FLUSH;\n  trees._tr_init(s);\n  return Z_OK;\n}\n\n\nfunction deflateReset(strm) {\n  var ret = deflateResetKeep(strm);\n  if (ret === Z_OK) {\n    lm_init(strm.state);\n  }\n  return ret;\n}\n\n\nfunction deflateSetHeader(strm, head) {\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  if (strm.state.wrap !== 2) { return Z_STREAM_ERROR; }\n  strm.state.gzhead = head;\n  return Z_OK;\n}\n\n\nfunction deflateInit2(strm, level, method, windowBits, memLevel, strategy) {\n  if (!strm) { // === Z_NULL\n    return Z_STREAM_ERROR;\n  }\n  var wrap = 1;\n\n  if (level === Z_DEFAULT_COMPRESSION) {\n    level = 6;\n  }\n\n  if (windowBits < 0) { /* suppress zlib wrapper */\n    wrap = 0;\n    windowBits = -windowBits;\n  }\n\n  else if (windowBits > 15) {\n    wrap = 2;           /* write gzip wrapper instead */\n    windowBits -= 16;\n  }\n\n\n  if (memLevel < 1 || memLevel > MAX_MEM_LEVEL || method !== Z_DEFLATED ||\n    windowBits < 8 || windowBits > 15 || level < 0 || level > 9 ||\n    strategy < 0 || strategy > Z_FIXED) {\n    return err(strm, Z_STREAM_ERROR);\n  }\n\n\n  if (windowBits === 8) {\n    windowBits = 9;\n  }\n  /* until 256-byte window bug fixed */\n\n  var s = new DeflateState();\n\n  strm.state = s;\n  s.strm = strm;\n\n  s.wrap = wrap;\n  s.gzhead = null;\n  s.w_bits = windowBits;\n  s.w_size = 1 << s.w_bits;\n  s.w_mask = s.w_size - 1;\n\n  s.hash_bits = memLevel + 7;\n  s.hash_size = 1 << s.hash_bits;\n  s.hash_mask = s.hash_size - 1;\n  s.hash_shift = ~~((s.hash_bits + MIN_MATCH - 1) / MIN_MATCH);\n\n  s.window = new utils.Buf8(s.w_size * 2);\n  s.head = new utils.Buf16(s.hash_size);\n  s.prev = new utils.Buf16(s.w_size);\n\n  // Don't need mem init magic for JS.\n  //s.high_water = 0;  /* nothing written to s->window yet */\n\n  s.lit_bufsize = 1 << (memLevel + 6); /* 16K elements by default */\n\n  s.pending_buf_size = s.lit_bufsize * 4;\n\n  //overlay = (ushf *) ZALLOC(strm, s->lit_bufsize, sizeof(ush)+2);\n  //s->pending_buf = (uchf *) overlay;\n  s.pending_buf = new utils.Buf8(s.pending_buf_size);\n\n  // It is offset from `s.pending_buf` (size is `s.lit_bufsize * 2`)\n  //s->d_buf = overlay + s->lit_bufsize/sizeof(ush);\n  s.d_buf = 1 * s.lit_bufsize;\n\n  //s->l_buf = s->pending_buf + (1+sizeof(ush))*s->lit_bufsize;\n  s.l_buf = (1 + 2) * s.lit_bufsize;\n\n  s.level = level;\n  s.strategy = strategy;\n  s.method = method;\n\n  return deflateReset(strm);\n}\n\nfunction deflateInit(strm, level) {\n  return deflateInit2(strm, level, Z_DEFLATED, MAX_WBITS, DEF_MEM_LEVEL, Z_DEFAULT_STRATEGY);\n}\n\n\nfunction deflate(strm, flush) {\n  var old_flush, s;\n  var beg, val; // for gzip header write only\n\n  if (!strm || !strm.state ||\n    flush > Z_BLOCK || flush < 0) {\n    return strm ? err(strm, Z_STREAM_ERROR) : Z_STREAM_ERROR;\n  }\n\n  s = strm.state;\n\n  if (!strm.output ||\n      (!strm.input && strm.avail_in !== 0) ||\n      (s.status === FINISH_STATE && flush !== Z_FINISH)) {\n    return err(strm, (strm.avail_out === 0) ? Z_BUF_ERROR : Z_STREAM_ERROR);\n  }\n\n  s.strm = strm; /* just in case */\n  old_flush = s.last_flush;\n  s.last_flush = flush;\n\n  /* Write the header */\n  if (s.status === INIT_STATE) {\n\n    if (s.wrap === 2) { // GZIP header\n      strm.adler = 0;  //crc32(0L, Z_NULL, 0);\n      put_byte(s, 31);\n      put_byte(s, 139);\n      put_byte(s, 8);\n      if (!s.gzhead) { // s->gzhead == Z_NULL\n        put_byte(s, 0);\n        put_byte(s, 0);\n        put_byte(s, 0);\n        put_byte(s, 0);\n        put_byte(s, 0);\n        put_byte(s, s.level === 9 ? 2 :\n                    (s.strategy >= Z_HUFFMAN_ONLY || s.level < 2 ?\n                     4 : 0));\n        put_byte(s, OS_CODE);\n        s.status = BUSY_STATE;\n      }\n      else {\n        put_byte(s, (s.gzhead.text ? 1 : 0) +\n                    (s.gzhead.hcrc ? 2 : 0) +\n                    (!s.gzhead.extra ? 0 : 4) +\n                    (!s.gzhead.name ? 0 : 8) +\n                    (!s.gzhead.comment ? 0 : 16)\n        );\n        put_byte(s, s.gzhead.time & 0xff);\n        put_byte(s, (s.gzhead.time >> 8) & 0xff);\n        put_byte(s, (s.gzhead.time >> 16) & 0xff);\n        put_byte(s, (s.gzhead.time >> 24) & 0xff);\n        put_byte(s, s.level === 9 ? 2 :\n                    (s.strategy >= Z_HUFFMAN_ONLY || s.level < 2 ?\n                     4 : 0));\n        put_byte(s, s.gzhead.os & 0xff);\n        if (s.gzhead.extra && s.gzhead.extra.length) {\n          put_byte(s, s.gzhead.extra.length & 0xff);\n          put_byte(s, (s.gzhead.extra.length >> 8) & 0xff);\n        }\n        if (s.gzhead.hcrc) {\n          strm.adler = crc32(strm.adler, s.pending_buf, s.pending, 0);\n        }\n        s.gzindex = 0;\n        s.status = EXTRA_STATE;\n      }\n    }\n    else // DEFLATE header\n    {\n      var header = (Z_DEFLATED + ((s.w_bits - 8) << 4)) << 8;\n      var level_flags = -1;\n\n      if (s.strategy >= Z_HUFFMAN_ONLY || s.level < 2) {\n        level_flags = 0;\n      } else if (s.level < 6) {\n        level_flags = 1;\n      } else if (s.level === 6) {\n        level_flags = 2;\n      } else {\n        level_flags = 3;\n      }\n      header |= (level_flags << 6);\n      if (s.strstart !== 0) { header |= PRESET_DICT; }\n      header += 31 - (header % 31);\n\n      s.status = BUSY_STATE;\n      putShortMSB(s, header);\n\n      /* Save the adler32 of the preset dictionary: */\n      if (s.strstart !== 0) {\n        putShortMSB(s, strm.adler >>> 16);\n        putShortMSB(s, strm.adler & 0xffff);\n      }\n      strm.adler = 1; // adler32(0L, Z_NULL, 0);\n    }\n  }\n\n//#ifdef GZIP\n  if (s.status === EXTRA_STATE) {\n    if (s.gzhead.extra/* != Z_NULL*/) {\n      beg = s.pending;  /* start of bytes to update crc */\n\n      while (s.gzindex < (s.gzhead.extra.length & 0xffff)) {\n        if (s.pending === s.pending_buf_size) {\n          if (s.gzhead.hcrc && s.pending > beg) {\n            strm.adler = crc32(strm.adler, s.pending_buf, s.pending - beg, beg);\n          }\n          flush_pending(strm);\n          beg = s.pending;\n          if (s.pending === s.pending_buf_size) {\n            break;\n          }\n        }\n        put_byte(s, s.gzhead.extra[s.gzindex] & 0xff);\n        s.gzindex++;\n      }\n      if (s.gzhead.hcrc && s.pending > beg) {\n        strm.adler = crc32(strm.adler, s.pending_buf, s.pending - beg, beg);\n      }\n      if (s.gzindex === s.gzhead.extra.length) {\n        s.gzindex = 0;\n        s.status = NAME_STATE;\n      }\n    }\n    else {\n      s.status = NAME_STATE;\n    }\n  }\n  if (s.status === NAME_STATE) {\n    if (s.gzhead.name/* != Z_NULL*/) {\n      beg = s.pending;  /* start of bytes to update crc */\n      //int val;\n\n      do {\n        if (s.pending === s.pending_buf_size) {\n          if (s.gzhead.hcrc && s.pending > beg) {\n            strm.adler = crc32(strm.adler, s.pending_buf, s.pending - beg, beg);\n          }\n          flush_pending(strm);\n          beg = s.pending;\n          if (s.pending === s.pending_buf_size) {\n            val = 1;\n            break;\n          }\n        }\n        // JS specific: little magic to add zero terminator to end of string\n        if (s.gzindex < s.gzhead.name.length) {\n          val = s.gzhead.name.charCodeAt(s.gzindex++) & 0xff;\n        } else {\n          val = 0;\n        }\n        put_byte(s, val);\n      } while (val !== 0);\n\n      if (s.gzhead.hcrc && s.pending > beg) {\n        strm.adler = crc32(strm.adler, s.pending_buf, s.pending - beg, beg);\n      }\n      if (val === 0) {\n        s.gzindex = 0;\n        s.status = COMMENT_STATE;\n      }\n    }\n    else {\n      s.status = COMMENT_STATE;\n    }\n  }\n  if (s.status === COMMENT_STATE) {\n    if (s.gzhead.comment/* != Z_NULL*/) {\n      beg = s.pending;  /* start of bytes to update crc */\n      //int val;\n\n      do {\n        if (s.pending === s.pending_buf_size) {\n          if (s.gzhead.hcrc && s.pending > beg) {\n            strm.adler = crc32(strm.adler, s.pending_buf, s.pending - beg, beg);\n          }\n          flush_pending(strm);\n          beg = s.pending;\n          if (s.pending === s.pending_buf_size) {\n            val = 1;\n            break;\n          }\n        }\n        // JS specific: little magic to add zero terminator to end of string\n        if (s.gzindex < s.gzhead.comment.length) {\n          val = s.gzhead.comment.charCodeAt(s.gzindex++) & 0xff;\n        } else {\n          val = 0;\n        }\n        put_byte(s, val);\n      } while (val !== 0);\n\n      if (s.gzhead.hcrc && s.pending > beg) {\n        strm.adler = crc32(strm.adler, s.pending_buf, s.pending - beg, beg);\n      }\n      if (val === 0) {\n        s.status = HCRC_STATE;\n      }\n    }\n    else {\n      s.status = HCRC_STATE;\n    }\n  }\n  if (s.status === HCRC_STATE) {\n    if (s.gzhead.hcrc) {\n      if (s.pending + 2 > s.pending_buf_size) {\n        flush_pending(strm);\n      }\n      if (s.pending + 2 <= s.pending_buf_size) {\n        put_byte(s, strm.adler & 0xff);\n        put_byte(s, (strm.adler >> 8) & 0xff);\n        strm.adler = 0; //crc32(0L, Z_NULL, 0);\n        s.status = BUSY_STATE;\n      }\n    }\n    else {\n      s.status = BUSY_STATE;\n    }\n  }\n//#endif\n\n  /* Flush as much pending output as possible */\n  if (s.pending !== 0) {\n    flush_pending(strm);\n    if (strm.avail_out === 0) {\n      /* Since avail_out is 0, deflate will be called again with\n       * more output space, but possibly with both pending and\n       * avail_in equal to zero. There won't be anything to do,\n       * but this is not an error situation so make sure we\n       * return OK instead of BUF_ERROR at next call of deflate:\n       */\n      s.last_flush = -1;\n      return Z_OK;\n    }\n\n    /* Make sure there is something to do and avoid duplicate consecutive\n     * flushes. For repeated and useless calls with Z_FINISH, we keep\n     * returning Z_STREAM_END instead of Z_BUF_ERROR.\n     */\n  } else if (strm.avail_in === 0 && rank(flush) <= rank(old_flush) &&\n    flush !== Z_FINISH) {\n    return err(strm, Z_BUF_ERROR);\n  }\n\n  /* User must not provide more input after the first FINISH: */\n  if (s.status === FINISH_STATE && strm.avail_in !== 0) {\n    return err(strm, Z_BUF_ERROR);\n  }\n\n  /* Start a new block or continue the current one.\n   */\n  if (strm.avail_in !== 0 || s.lookahead !== 0 ||\n    (flush !== Z_NO_FLUSH && s.status !== FINISH_STATE)) {\n    var bstate = (s.strategy === Z_HUFFMAN_ONLY) ? deflate_huff(s, flush) :\n      (s.strategy === Z_RLE ? deflate_rle(s, flush) :\n        configuration_table[s.level].func(s, flush));\n\n    if (bstate === BS_FINISH_STARTED || bstate === BS_FINISH_DONE) {\n      s.status = FINISH_STATE;\n    }\n    if (bstate === BS_NEED_MORE || bstate === BS_FINISH_STARTED) {\n      if (strm.avail_out === 0) {\n        s.last_flush = -1;\n        /* avoid BUF_ERROR next call, see above */\n      }\n      return Z_OK;\n      /* If flush != Z_NO_FLUSH && avail_out == 0, the next call\n       * of deflate should use the same flush parameter to make sure\n       * that the flush is complete. So we don't have to output an\n       * empty block here, this will be done at next call. This also\n       * ensures that for a very small output buffer, we emit at most\n       * one empty block.\n       */\n    }\n    if (bstate === BS_BLOCK_DONE) {\n      if (flush === Z_PARTIAL_FLUSH) {\n        trees._tr_align(s);\n      }\n      else if (flush !== Z_BLOCK) { /* FULL_FLUSH or SYNC_FLUSH */\n\n        trees._tr_stored_block(s, 0, 0, false);\n        /* For a full flush, this empty block will be recognized\n         * as a special marker by inflate_sync().\n         */\n        if (flush === Z_FULL_FLUSH) {\n          /*** CLEAR_HASH(s); ***/             /* forget history */\n          zero(s.head); // Fill with NIL (= 0);\n\n          if (s.lookahead === 0) {\n            s.strstart = 0;\n            s.block_start = 0;\n            s.insert = 0;\n          }\n        }\n      }\n      flush_pending(strm);\n      if (strm.avail_out === 0) {\n        s.last_flush = -1; /* avoid BUF_ERROR at next call, see above */\n        return Z_OK;\n      }\n    }\n  }\n  //Assert(strm->avail_out > 0, \"bug2\");\n  //if (strm.avail_out <= 0) { throw new Error(\"bug2\");}\n\n  if (flush !== Z_FINISH) { return Z_OK; }\n  if (s.wrap <= 0) { return Z_STREAM_END; }\n\n  /* Write the trailer */\n  if (s.wrap === 2) {\n    put_byte(s, strm.adler & 0xff);\n    put_byte(s, (strm.adler >> 8) & 0xff);\n    put_byte(s, (strm.adler >> 16) & 0xff);\n    put_byte(s, (strm.adler >> 24) & 0xff);\n    put_byte(s, strm.total_in & 0xff);\n    put_byte(s, (strm.total_in >> 8) & 0xff);\n    put_byte(s, (strm.total_in >> 16) & 0xff);\n    put_byte(s, (strm.total_in >> 24) & 0xff);\n  }\n  else\n  {\n    putShortMSB(s, strm.adler >>> 16);\n    putShortMSB(s, strm.adler & 0xffff);\n  }\n\n  flush_pending(strm);\n  /* If avail_out is zero, the application will call deflate again\n   * to flush the rest.\n   */\n  if (s.wrap > 0) { s.wrap = -s.wrap; }\n  /* write the trailer only once! */\n  return s.pending !== 0 ? Z_OK : Z_STREAM_END;\n}\n\nfunction deflateEnd(strm) {\n  var status;\n\n  if (!strm/*== Z_NULL*/ || !strm.state/*== Z_NULL*/) {\n    return Z_STREAM_ERROR;\n  }\n\n  status = strm.state.status;\n  if (status !== INIT_STATE &&\n    status !== EXTRA_STATE &&\n    status !== NAME_STATE &&\n    status !== COMMENT_STATE &&\n    status !== HCRC_STATE &&\n    status !== BUSY_STATE &&\n    status !== FINISH_STATE\n  ) {\n    return err(strm, Z_STREAM_ERROR);\n  }\n\n  strm.state = null;\n\n  return status === BUSY_STATE ? err(strm, Z_DATA_ERROR) : Z_OK;\n}\n\n\n/* =========================================================================\n * Initializes the compression dictionary from the given byte\n * sequence without producing any compressed output.\n */\nfunction deflateSetDictionary(strm, dictionary) {\n  var dictLength = dictionary.length;\n\n  var s;\n  var str, n;\n  var wrap;\n  var avail;\n  var next;\n  var input;\n  var tmpDict;\n\n  if (!strm/*== Z_NULL*/ || !strm.state/*== Z_NULL*/) {\n    return Z_STREAM_ERROR;\n  }\n\n  s = strm.state;\n  wrap = s.wrap;\n\n  if (wrap === 2 || (wrap === 1 && s.status !== INIT_STATE) || s.lookahead) {\n    return Z_STREAM_ERROR;\n  }\n\n  /* when using zlib wrappers, compute Adler-32 for provided dictionary */\n  if (wrap === 1) {\n    /* adler32(strm->adler, dictionary, dictLength); */\n    strm.adler = adler32(strm.adler, dictionary, dictLength, 0);\n  }\n\n  s.wrap = 0;   /* avoid computing Adler-32 in read_buf */\n\n  /* if dictionary would fill window, just replace the history */\n  if (dictLength >= s.w_size) {\n    if (wrap === 0) {            /* already empty otherwise */\n      /*** CLEAR_HASH(s); ***/\n      zero(s.head); // Fill with NIL (= 0);\n      s.strstart = 0;\n      s.block_start = 0;\n      s.insert = 0;\n    }\n    /* use the tail */\n    // dictionary = dictionary.slice(dictLength - s.w_size);\n    tmpDict = new utils.Buf8(s.w_size);\n    utils.arraySet(tmpDict, dictionary, dictLength - s.w_size, s.w_size, 0);\n    dictionary = tmpDict;\n    dictLength = s.w_size;\n  }\n  /* insert dictionary into window and hash */\n  avail = strm.avail_in;\n  next = strm.next_in;\n  input = strm.input;\n  strm.avail_in = dictLength;\n  strm.next_in = 0;\n  strm.input = dictionary;\n  fill_window(s);\n  while (s.lookahead >= MIN_MATCH) {\n    str = s.strstart;\n    n = s.lookahead - (MIN_MATCH - 1);\n    do {\n      /* UPDATE_HASH(s, s->ins_h, s->window[str + MIN_MATCH-1]); */\n      s.ins_h = ((s.ins_h << s.hash_shift) ^ s.window[str + MIN_MATCH - 1]) & s.hash_mask;\n\n      s.prev[str & s.w_mask] = s.head[s.ins_h];\n\n      s.head[s.ins_h] = str;\n      str++;\n    } while (--n);\n    s.strstart = str;\n    s.lookahead = MIN_MATCH - 1;\n    fill_window(s);\n  }\n  s.strstart += s.lookahead;\n  s.block_start = s.strstart;\n  s.insert = s.lookahead;\n  s.lookahead = 0;\n  s.match_length = s.prev_length = MIN_MATCH - 1;\n  s.match_available = 0;\n  strm.next_in = next;\n  strm.input = input;\n  strm.avail_in = avail;\n  s.wrap = wrap;\n  return Z_OK;\n}\n\n\nexports.deflateInit = deflateInit;\nexports.deflateInit2 = deflateInit2;\nexports.deflateReset = deflateReset;\nexports.deflateResetKeep = deflateResetKeep;\nexports.deflateSetHeader = deflateSetHeader;\nexports.deflate = deflate;\nexports.deflateEnd = deflateEnd;\nexports.deflateSetDictionary = deflateSetDictionary;\nexports.deflateInfo = 'pako deflate (from Nodeca project)';\n\n/* Not implemented\nexports.deflateBound = deflateBound;\nexports.deflateCopy = deflateCopy;\nexports.deflateParams = deflateParams;\nexports.deflatePending = deflatePending;\nexports.deflatePrime = deflatePrime;\nexports.deflateTune = deflateTune;\n*/\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\nfunction GZheader() {\n  /* true if compressed data believed to be text */\n  this.text       = 0;\n  /* modification time */\n  this.time       = 0;\n  /* extra flags (not used when writing a gzip file) */\n  this.xflags     = 0;\n  /* operating system */\n  this.os         = 0;\n  /* pointer to extra field or Z_NULL if none */\n  this.extra      = null;\n  /* extra field length (valid if extra != Z_NULL) */\n  this.extra_len  = 0; // Actually, we don't need it in JS,\n                       // but leave for few code modifications\n\n  //\n  // Setup limits is not necessary because in js we should not preallocate memory\n  // for inflate use constant limit in 65536 bytes\n  //\n\n  /* space at extra (only when reading header) */\n  // this.extra_max  = 0;\n  /* pointer to zero-terminated file name or Z_NULL */\n  this.name       = '';\n  /* space at name (only when reading header) */\n  // this.name_max   = 0;\n  /* pointer to zero-terminated comment or Z_NULL */\n  this.comment    = '';\n  /* space at comment (only when reading header) */\n  // this.comm_max   = 0;\n  /* true if there was or will be a header crc */\n  this.hcrc       = 0;\n  /* true when done reading gzip header (not used when writing a gzip file) */\n  this.done       = false;\n}\n\nmodule.exports = GZheader;\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\n// See state defs from inflate.js\nvar BAD = 30;       /* got a data error -- remain here until reset */\nvar TYPE = 12;      /* i: waiting for type bits, including last-flag bit */\n\n/*\n   Decode literal, length, and distance codes and write out the resulting\n   literal and match bytes until either not enough input or output is\n   available, an end-of-block is encountered, or a data error is encountered.\n   When large enough input and output buffers are supplied to inflate(), for\n   example, a 16K input buffer and a 64K output buffer, more than 95% of the\n   inflate execution time is spent in this routine.\n\n   Entry assumptions:\n\n        state.mode === LEN\n        strm.avail_in >= 6\n        strm.avail_out >= 258\n        start >= strm.avail_out\n        state.bits < 8\n\n   On return, state.mode is one of:\n\n        LEN -- ran out of enough output space or enough available input\n        TYPE -- reached end of block code, inflate() to interpret next block\n        BAD -- error in block data\n\n   Notes:\n\n    - The maximum input bits used by a length/distance pair is 15 bits for the\n      length code, 5 bits for the length extra, 15 bits for the distance code,\n      and 13 bits for the distance extra.  This totals 48 bits, or six bytes.\n      Therefore if strm.avail_in >= 6, then there is enough input to avoid\n      checking for available input while decoding.\n\n    - The maximum bytes that a single length/distance pair can output is 258\n      bytes, which is the maximum length that can be coded.  inflate_fast()\n      requires strm.avail_out >= 258 for each loop to avoid checking for\n      output space.\n */\nmodule.exports = function inflate_fast(strm, start) {\n  var state;\n  var _in;                    /* local strm.input */\n  var last;                   /* have enough input while in < last */\n  var _out;                   /* local strm.output */\n  var beg;                    /* inflate()'s initial strm.output */\n  var end;                    /* while out < end, enough space available */\n//#ifdef INFLATE_STRICT\n  var dmax;                   /* maximum distance from zlib header */\n//#endif\n  var wsize;                  /* window size or zero if not using window */\n  var whave;                  /* valid bytes in the window */\n  var wnext;                  /* window write index */\n  // Use `s_window` instead `window`, avoid conflict with instrumentation tools\n  var s_window;               /* allocated sliding window, if wsize != 0 */\n  var hold;                   /* local strm.hold */\n  var bits;                   /* local strm.bits */\n  var lcode;                  /* local strm.lencode */\n  var dcode;                  /* local strm.distcode */\n  var lmask;                  /* mask for first level of length codes */\n  var dmask;                  /* mask for first level of distance codes */\n  var here;                   /* retrieved table entry */\n  var op;                     /* code bits, operation, extra bits, or */\n                              /*  window position, window bytes to copy */\n  var len;                    /* match length, unused bytes */\n  var dist;                   /* match distance */\n  var from;                   /* where to copy match from */\n  var from_source;\n\n\n  var input, output; // JS specific, because we have no pointers\n\n  /* copy state to local variables */\n  state = strm.state;\n  //here = state.here;\n  _in = strm.next_in;\n  input = strm.input;\n  last = _in + (strm.avail_in - 5);\n  _out = strm.next_out;\n  output = strm.output;\n  beg = _out - (start - strm.avail_out);\n  end = _out + (strm.avail_out - 257);\n//#ifdef INFLATE_STRICT\n  dmax = state.dmax;\n//#endif\n  wsize = state.wsize;\n  whave = state.whave;\n  wnext = state.wnext;\n  s_window = state.window;\n  hold = state.hold;\n  bits = state.bits;\n  lcode = state.lencode;\n  dcode = state.distcode;\n  lmask = (1 << state.lenbits) - 1;\n  dmask = (1 << state.distbits) - 1;\n\n\n  /* decode literals and length/distances until end-of-block or not enough\n     input data or output space */\n\n  top:\n  do {\n    if (bits < 15) {\n      hold += input[_in++] << bits;\n      bits += 8;\n      hold += input[_in++] << bits;\n      bits += 8;\n    }\n\n    here = lcode[hold & lmask];\n\n    dolen:\n    for (;;) { // Goto emulation\n      op = here >>> 24/*here.bits*/;\n      hold >>>= op;\n      bits -= op;\n      op = (here >>> 16) & 0xff/*here.op*/;\n      if (op === 0) {                          /* literal */\n        //Tracevv((stderr, here.val >= 0x20 && here.val < 0x7f ?\n        //        \"inflate:         literal '%c'\\n\" :\n        //        \"inflate:         literal 0x%02x\\n\", here.val));\n        output[_out++] = here & 0xffff/*here.val*/;\n      }\n      else if (op & 16) {                     /* length base */\n        len = here & 0xffff/*here.val*/;\n        op &= 15;                           /* number of extra bits */\n        if (op) {\n          if (bits < op) {\n            hold += input[_in++] << bits;\n            bits += 8;\n          }\n          len += hold & ((1 << op) - 1);\n          hold >>>= op;\n          bits -= op;\n        }\n        //Tracevv((stderr, \"inflate:         length %u\\n\", len));\n        if (bits < 15) {\n          hold += input[_in++] << bits;\n          bits += 8;\n          hold += input[_in++] << bits;\n          bits += 8;\n        }\n        here = dcode[hold & dmask];\n\n        dodist:\n        for (;;) { // goto emulation\n          op = here >>> 24/*here.bits*/;\n          hold >>>= op;\n          bits -= op;\n          op = (here >>> 16) & 0xff/*here.op*/;\n\n          if (op & 16) {                      /* distance base */\n            dist = here & 0xffff/*here.val*/;\n            op &= 15;                       /* number of extra bits */\n            if (bits < op) {\n              hold += input[_in++] << bits;\n              bits += 8;\n              if (bits < op) {\n                hold += input[_in++] << bits;\n                bits += 8;\n              }\n            }\n            dist += hold & ((1 << op) - 1);\n//#ifdef INFLATE_STRICT\n            if (dist > dmax) {\n              strm.msg = 'invalid distance too far back';\n              state.mode = BAD;\n              break top;\n            }\n//#endif\n            hold >>>= op;\n            bits -= op;\n            //Tracevv((stderr, \"inflate:         distance %u\\n\", dist));\n            op = _out - beg;                /* max distance in output */\n            if (dist > op) {                /* see if copy from window */\n              op = dist - op;               /* distance back in window */\n              if (op > whave) {\n                if (state.sane) {\n                  strm.msg = 'invalid distance too far back';\n                  state.mode = BAD;\n                  break top;\n                }\n\n// (!) This block is disabled in zlib defaults,\n// don't enable it for binary compatibility\n//#ifdef INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR\n//                if (len <= op - whave) {\n//                  do {\n//                    output[_out++] = 0;\n//                  } while (--len);\n//                  continue top;\n//                }\n//                len -= op - whave;\n//                do {\n//                  output[_out++] = 0;\n//                } while (--op > whave);\n//                if (op === 0) {\n//                  from = _out - dist;\n//                  do {\n//                    output[_out++] = output[from++];\n//                  } while (--len);\n//                  continue top;\n//                }\n//#endif\n              }\n              from = 0; // window index\n              from_source = s_window;\n              if (wnext === 0) {           /* very common case */\n                from += wsize - op;\n                if (op < len) {         /* some from window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = _out - dist;  /* rest from output */\n                  from_source = output;\n                }\n              }\n              else if (wnext < op) {      /* wrap around window */\n                from += wsize + wnext - op;\n                op -= wnext;\n                if (op < len) {         /* some from end of window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = 0;\n                  if (wnext < len) {  /* some from start of window */\n                    op = wnext;\n                    len -= op;\n                    do {\n                      output[_out++] = s_window[from++];\n                    } while (--op);\n                    from = _out - dist;      /* rest from output */\n                    from_source = output;\n                  }\n                }\n              }\n              else {                      /* contiguous in window */\n                from += wnext - op;\n                if (op < len) {         /* some from window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = _out - dist;  /* rest from output */\n                  from_source = output;\n                }\n              }\n              while (len > 2) {\n                output[_out++] = from_source[from++];\n                output[_out++] = from_source[from++];\n                output[_out++] = from_source[from++];\n                len -= 3;\n              }\n              if (len) {\n                output[_out++] = from_source[from++];\n                if (len > 1) {\n                  output[_out++] = from_source[from++];\n                }\n              }\n            }\n            else {\n              from = _out - dist;          /* copy direct from output */\n              do {                        /* minimum length is three */\n                output[_out++] = output[from++];\n                output[_out++] = output[from++];\n                output[_out++] = output[from++];\n                len -= 3;\n              } while (len > 2);\n              if (len) {\n                output[_out++] = output[from++];\n                if (len > 1) {\n                  output[_out++] = output[from++];\n                }\n              }\n            }\n          }\n          else if ((op & 64) === 0) {          /* 2nd level distance code */\n            here = dcode[(here & 0xffff)/*here.val*/ + (hold & ((1 << op) - 1))];\n            continue dodist;\n          }\n          else {\n            strm.msg = 'invalid distance code';\n            state.mode = BAD;\n            break top;\n          }\n\n          break; // need to emulate goto via \"continue\"\n        }\n      }\n      else if ((op & 64) === 0) {              /* 2nd level length code */\n        here = lcode[(here & 0xffff)/*here.val*/ + (hold & ((1 << op) - 1))];\n        continue dolen;\n      }\n      else if (op & 32) {                     /* end-of-block */\n        //Tracevv((stderr, \"inflate:         end of block\\n\"));\n        state.mode = TYPE;\n        break top;\n      }\n      else {\n        strm.msg = 'invalid literal/length code';\n        state.mode = BAD;\n        break top;\n      }\n\n      break; // need to emulate goto via \"continue\"\n    }\n  } while (_in < last && _out < end);\n\n  /* return unused bytes (on entry, bits < 8, so in won't go too far back) */\n  len = bits >> 3;\n  _in -= len;\n  bits -= len << 3;\n  hold &= (1 << bits) - 1;\n\n  /* update state and return */\n  strm.next_in = _in;\n  strm.next_out = _out;\n  strm.avail_in = (_in < last ? 5 + (last - _in) : 5 - (_in - last));\n  strm.avail_out = (_out < end ? 257 + (end - _out) : 257 - (_out - end));\n  state.hold = hold;\n  state.bits = bits;\n  return;\n};\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\nvar utils         = require('../utils/common');\nvar adler32       = require('./adler32');\nvar crc32         = require('./crc32');\nvar inflate_fast  = require('./inffast');\nvar inflate_table = require('./inftrees');\n\nvar CODES = 0;\nvar LENS = 1;\nvar DISTS = 2;\n\n/* Public constants ==========================================================*/\n/* ===========================================================================*/\n\n\n/* Allowed flush values; see deflate() and inflate() below for details */\n//var Z_NO_FLUSH      = 0;\n//var Z_PARTIAL_FLUSH = 1;\n//var Z_SYNC_FLUSH    = 2;\n//var Z_FULL_FLUSH    = 3;\nvar Z_FINISH        = 4;\nvar Z_BLOCK         = 5;\nvar Z_TREES         = 6;\n\n\n/* Return codes for the compression/decompression functions. Negative values\n * are errors, positive values are used for special but normal events.\n */\nvar Z_OK            = 0;\nvar Z_STREAM_END    = 1;\nvar Z_NEED_DICT     = 2;\n//var Z_ERRNO         = -1;\nvar Z_STREAM_ERROR  = -2;\nvar Z_DATA_ERROR    = -3;\nvar Z_MEM_ERROR     = -4;\nvar Z_BUF_ERROR     = -5;\n//var Z_VERSION_ERROR = -6;\n\n/* The deflate compression method */\nvar Z_DEFLATED  = 8;\n\n\n/* STATES ====================================================================*/\n/* ===========================================================================*/\n\n\nvar    HEAD = 1;       /* i: waiting for magic header */\nvar    FLAGS = 2;      /* i: waiting for method and flags (gzip) */\nvar    TIME = 3;       /* i: waiting for modification time (gzip) */\nvar    OS = 4;         /* i: waiting for extra flags and operating system (gzip) */\nvar    EXLEN = 5;      /* i: waiting for extra length (gzip) */\nvar    EXTRA = 6;      /* i: waiting for extra bytes (gzip) */\nvar    NAME = 7;       /* i: waiting for end of file name (gzip) */\nvar    COMMENT = 8;    /* i: waiting for end of comment (gzip) */\nvar    HCRC = 9;       /* i: waiting for header crc (gzip) */\nvar    DICTID = 10;    /* i: waiting for dictionary check value */\nvar    DICT = 11;      /* waiting for inflateSetDictionary() call */\nvar        TYPE = 12;      /* i: waiting for type bits, including last-flag bit */\nvar        TYPEDO = 13;    /* i: same, but skip check to exit inflate on new block */\nvar        STORED = 14;    /* i: waiting for stored size (length and complement) */\nvar        COPY_ = 15;     /* i/o: same as COPY below, but only first time in */\nvar        COPY = 16;      /* i/o: waiting for input or output to copy stored block */\nvar        TABLE = 17;     /* i: waiting for dynamic block table lengths */\nvar        LENLENS = 18;   /* i: waiting for code length code lengths */\nvar        CODELENS = 19;  /* i: waiting for length/lit and distance code lengths */\nvar            LEN_ = 20;      /* i: same as LEN below, but only first time in */\nvar            LEN = 21;       /* i: waiting for length/lit/eob code */\nvar            LENEXT = 22;    /* i: waiting for length extra bits */\nvar            DIST = 23;      /* i: waiting for distance code */\nvar            DISTEXT = 24;   /* i: waiting for distance extra bits */\nvar            MATCH = 25;     /* o: waiting for output space to copy string */\nvar            LIT = 26;       /* o: waiting for output space to write literal */\nvar    CHECK = 27;     /* i: waiting for 32-bit check value */\nvar    LENGTH = 28;    /* i: waiting for 32-bit length (gzip) */\nvar    DONE = 29;      /* finished check, done -- remain here until reset */\nvar    BAD = 30;       /* got a data error -- remain here until reset */\nvar    MEM = 31;       /* got an inflate() memory error -- remain here until reset */\nvar    SYNC = 32;      /* looking for synchronization bytes to restart inflate() */\n\n/* ===========================================================================*/\n\n\n\nvar ENOUGH_LENS = 852;\nvar ENOUGH_DISTS = 592;\n//var ENOUGH =  (ENOUGH_LENS+ENOUGH_DISTS);\n\nvar MAX_WBITS = 15;\n/* 32K LZ77 window */\nvar DEF_WBITS = MAX_WBITS;\n\n\nfunction zswap32(q) {\n  return  (((q >>> 24) & 0xff) +\n          ((q >>> 8) & 0xff00) +\n          ((q & 0xff00) << 8) +\n          ((q & 0xff) << 24));\n}\n\n\nfunction InflateState() {\n  this.mode = 0;             /* current inflate mode */\n  this.last = false;          /* true if processing last block */\n  this.wrap = 0;              /* bit 0 true for zlib, bit 1 true for gzip */\n  this.havedict = false;      /* true if dictionary provided */\n  this.flags = 0;             /* gzip header method and flags (0 if zlib) */\n  this.dmax = 0;              /* zlib header max distance (INFLATE_STRICT) */\n  this.check = 0;             /* protected copy of check value */\n  this.total = 0;             /* protected copy of output count */\n  // TODO: may be {}\n  this.head = null;           /* where to save gzip header information */\n\n  /* sliding window */\n  this.wbits = 0;             /* log base 2 of requested window size */\n  this.wsize = 0;             /* window size or zero if not using window */\n  this.whave = 0;             /* valid bytes in the window */\n  this.wnext = 0;             /* window write index */\n  this.window = null;         /* allocated sliding window, if needed */\n\n  /* bit accumulator */\n  this.hold = 0;              /* input bit accumulator */\n  this.bits = 0;              /* number of bits in \"in\" */\n\n  /* for string and stored block copying */\n  this.length = 0;            /* literal or length of data to copy */\n  this.offset = 0;            /* distance back to copy string from */\n\n  /* for table and code decoding */\n  this.extra = 0;             /* extra bits needed */\n\n  /* fixed and dynamic code tables */\n  this.lencode = null;          /* starting table for length/literal codes */\n  this.distcode = null;         /* starting table for distance codes */\n  this.lenbits = 0;           /* index bits for lencode */\n  this.distbits = 0;          /* index bits for distcode */\n\n  /* dynamic table building */\n  this.ncode = 0;             /* number of code length code lengths */\n  this.nlen = 0;              /* number of length code lengths */\n  this.ndist = 0;             /* number of distance code lengths */\n  this.have = 0;              /* number of code lengths in lens[] */\n  this.next = null;              /* next available space in codes[] */\n\n  this.lens = new utils.Buf16(320); /* temporary storage for code lengths */\n  this.work = new utils.Buf16(288); /* work area for code table building */\n\n  /*\n   because we don't have pointers in js, we use lencode and distcode directly\n   as buffers so we don't need codes\n  */\n  //this.codes = new utils.Buf32(ENOUGH);       /* space for code tables */\n  this.lendyn = null;              /* dynamic table for length/literal codes (JS specific) */\n  this.distdyn = null;             /* dynamic table for distance codes (JS specific) */\n  this.sane = 0;                   /* if false, allow invalid distance too far */\n  this.back = 0;                   /* bits back of last unprocessed length/lit */\n  this.was = 0;                    /* initial length of match */\n}\n\nfunction inflateResetKeep(strm) {\n  var state;\n\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  strm.total_in = strm.total_out = state.total = 0;\n  strm.msg = ''; /*Z_NULL*/\n  if (state.wrap) {       /* to support ill-conceived Java test suite */\n    strm.adler = state.wrap & 1;\n  }\n  state.mode = HEAD;\n  state.last = 0;\n  state.havedict = 0;\n  state.dmax = 32768;\n  state.head = null/*Z_NULL*/;\n  state.hold = 0;\n  state.bits = 0;\n  //state.lencode = state.distcode = state.next = state.codes;\n  state.lencode = state.lendyn = new utils.Buf32(ENOUGH_LENS);\n  state.distcode = state.distdyn = new utils.Buf32(ENOUGH_DISTS);\n\n  state.sane = 1;\n  state.back = -1;\n  //Tracev((stderr, \"inflate: reset\\n\"));\n  return Z_OK;\n}\n\nfunction inflateReset(strm) {\n  var state;\n\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  state.wsize = 0;\n  state.whave = 0;\n  state.wnext = 0;\n  return inflateResetKeep(strm);\n\n}\n\nfunction inflateReset2(strm, windowBits) {\n  var wrap;\n  var state;\n\n  /* get the state */\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n\n  /* extract wrap request from windowBits parameter */\n  if (windowBits < 0) {\n    wrap = 0;\n    windowBits = -windowBits;\n  }\n  else {\n    wrap = (windowBits >> 4) + 1;\n    if (windowBits < 48) {\n      windowBits &= 15;\n    }\n  }\n\n  /* set number of window bits, free window if different */\n  if (windowBits && (windowBits < 8 || windowBits > 15)) {\n    return Z_STREAM_ERROR;\n  }\n  if (state.window !== null && state.wbits !== windowBits) {\n    state.window = null;\n  }\n\n  /* update state and reset the rest of it */\n  state.wrap = wrap;\n  state.wbits = windowBits;\n  return inflateReset(strm);\n}\n\nfunction inflateInit2(strm, windowBits) {\n  var ret;\n  var state;\n\n  if (!strm) { return Z_STREAM_ERROR; }\n  //strm.msg = Z_NULL;                 /* in case we return an error */\n\n  state = new InflateState();\n\n  //if (state === Z_NULL) return Z_MEM_ERROR;\n  //Tracev((stderr, \"inflate: allocated\\n\"));\n  strm.state = state;\n  state.window = null/*Z_NULL*/;\n  ret = inflateReset2(strm, windowBits);\n  if (ret !== Z_OK) {\n    strm.state = null/*Z_NULL*/;\n  }\n  return ret;\n}\n\nfunction inflateInit(strm) {\n  return inflateInit2(strm, DEF_WBITS);\n}\n\n\n/*\n Return state with length and distance decoding tables and index sizes set to\n fixed code decoding.  Normally this returns fixed tables from inffixed.h.\n If BUILDFIXED is defined, then instead this routine builds the tables the\n first time it's called, and returns those tables the first time and\n thereafter.  This reduces the size of the code by about 2K bytes, in\n exchange for a little execution time.  However, BUILDFIXED should not be\n used for threaded applications, since the rewriting of the tables and virgin\n may not be thread-safe.\n */\nvar virgin = true;\n\nvar lenfix, distfix; // We have no pointers in JS, so keep tables separate\n\nfunction fixedtables(state) {\n  /* build fixed huffman tables if first call (may not be thread safe) */\n  if (virgin) {\n    var sym;\n\n    lenfix = new utils.Buf32(512);\n    distfix = new utils.Buf32(32);\n\n    /* literal/length table */\n    sym = 0;\n    while (sym < 144) { state.lens[sym++] = 8; }\n    while (sym < 256) { state.lens[sym++] = 9; }\n    while (sym < 280) { state.lens[sym++] = 7; }\n    while (sym < 288) { state.lens[sym++] = 8; }\n\n    inflate_table(LENS,  state.lens, 0, 288, lenfix,   0, state.work, { bits: 9 });\n\n    /* distance table */\n    sym = 0;\n    while (sym < 32) { state.lens[sym++] = 5; }\n\n    inflate_table(DISTS, state.lens, 0, 32,   distfix, 0, state.work, { bits: 5 });\n\n    /* do this just once */\n    virgin = false;\n  }\n\n  state.lencode = lenfix;\n  state.lenbits = 9;\n  state.distcode = distfix;\n  state.distbits = 5;\n}\n\n\n/*\n Update the window with the last wsize (normally 32K) bytes written before\n returning.  If window does not exist yet, create it.  This is only called\n when a window is already in use, or when output has been written during this\n inflate call, but the end of the deflate stream has not been reached yet.\n It is also called to create a window for dictionary data when a dictionary\n is loaded.\n\n Providing output buffers larger than 32K to inflate() should provide a speed\n advantage, since only the last 32K of output is copied to the sliding window\n upon return from inflate(), and since all distances after the first 32K of\n output will fall in the output data, making match copies simpler and faster.\n The advantage may be dependent on the size of the processor's data caches.\n */\nfunction updatewindow(strm, src, end, copy) {\n  var dist;\n  var state = strm.state;\n\n  /* if it hasn't been done already, allocate space for the window */\n  if (state.window === null) {\n    state.wsize = 1 << state.wbits;\n    state.wnext = 0;\n    state.whave = 0;\n\n    state.window = new utils.Buf8(state.wsize);\n  }\n\n  /* copy state->wsize or less output bytes into the circular window */\n  if (copy >= state.wsize) {\n    utils.arraySet(state.window, src, end - state.wsize, state.wsize, 0);\n    state.wnext = 0;\n    state.whave = state.wsize;\n  }\n  else {\n    dist = state.wsize - state.wnext;\n    if (dist > copy) {\n      dist = copy;\n    }\n    //zmemcpy(state->window + state->wnext, end - copy, dist);\n    utils.arraySet(state.window, src, end - copy, dist, state.wnext);\n    copy -= dist;\n    if (copy) {\n      //zmemcpy(state->window, end - copy, copy);\n      utils.arraySet(state.window, src, end - copy, copy, 0);\n      state.wnext = copy;\n      state.whave = state.wsize;\n    }\n    else {\n      state.wnext += dist;\n      if (state.wnext === state.wsize) { state.wnext = 0; }\n      if (state.whave < state.wsize) { state.whave += dist; }\n    }\n  }\n  return 0;\n}\n\nfunction inflate(strm, flush) {\n  var state;\n  var input, output;          // input/output buffers\n  var next;                   /* next input INDEX */\n  var put;                    /* next output INDEX */\n  var have, left;             /* available input and output */\n  var hold;                   /* bit buffer */\n  var bits;                   /* bits in bit buffer */\n  var _in, _out;              /* save starting available input and output */\n  var copy;                   /* number of stored or match bytes to copy */\n  var from;                   /* where to copy match bytes from */\n  var from_source;\n  var here = 0;               /* current decoding table entry */\n  var here_bits, here_op, here_val; // paked \"here\" denormalized (JS specific)\n  //var last;                   /* parent table entry */\n  var last_bits, last_op, last_val; // paked \"last\" denormalized (JS specific)\n  var len;                    /* length to copy for repeats, bits to drop */\n  var ret;                    /* return code */\n  var hbuf = new utils.Buf8(4);    /* buffer for gzip header crc calculation */\n  var opts;\n\n  var n; // temporary var for NEED_BITS\n\n  var order = /* permutation of code lengths */\n    [ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ];\n\n\n  if (!strm || !strm.state || !strm.output ||\n      (!strm.input && strm.avail_in !== 0)) {\n    return Z_STREAM_ERROR;\n  }\n\n  state = strm.state;\n  if (state.mode === TYPE) { state.mode = TYPEDO; }    /* skip check */\n\n\n  //--- LOAD() ---\n  put = strm.next_out;\n  output = strm.output;\n  left = strm.avail_out;\n  next = strm.next_in;\n  input = strm.input;\n  have = strm.avail_in;\n  hold = state.hold;\n  bits = state.bits;\n  //---\n\n  _in = have;\n  _out = left;\n  ret = Z_OK;\n\n  inf_leave: // goto emulation\n  for (;;) {\n    switch (state.mode) {\n      case HEAD:\n        if (state.wrap === 0) {\n          state.mode = TYPEDO;\n          break;\n        }\n        //=== NEEDBITS(16);\n        while (bits < 16) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        if ((state.wrap & 2) && hold === 0x8b1f) {  /* gzip header */\n          state.check = 0/*crc32(0L, Z_NULL, 0)*/;\n          //=== CRC2(state.check, hold);\n          hbuf[0] = hold & 0xff;\n          hbuf[1] = (hold >>> 8) & 0xff;\n          state.check = crc32(state.check, hbuf, 2, 0);\n          //===//\n\n          //=== INITBITS();\n          hold = 0;\n          bits = 0;\n          //===//\n          state.mode = FLAGS;\n          break;\n        }\n        state.flags = 0;           /* expect zlib header */\n        if (state.head) {\n          state.head.done = false;\n        }\n        if (!(state.wrap & 1) ||   /* check if zlib header allowed */\n          (((hold & 0xff)/*BITS(8)*/ << 8) + (hold >> 8)) % 31) {\n          strm.msg = 'incorrect header check';\n          state.mode = BAD;\n          break;\n        }\n        if ((hold & 0x0f)/*BITS(4)*/ !== Z_DEFLATED) {\n          strm.msg = 'unknown compression method';\n          state.mode = BAD;\n          break;\n        }\n        //--- DROPBITS(4) ---//\n        hold >>>= 4;\n        bits -= 4;\n        //---//\n        len = (hold & 0x0f)/*BITS(4)*/ + 8;\n        if (state.wbits === 0) {\n          state.wbits = len;\n        }\n        else if (len > state.wbits) {\n          strm.msg = 'invalid window size';\n          state.mode = BAD;\n          break;\n        }\n        state.dmax = 1 << len;\n        //Tracev((stderr, \"inflate:   zlib header ok\\n\"));\n        strm.adler = state.check = 1/*adler32(0L, Z_NULL, 0)*/;\n        state.mode = hold & 0x200 ? DICTID : TYPE;\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        break;\n      case FLAGS:\n        //=== NEEDBITS(16); */\n        while (bits < 16) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.flags = hold;\n        if ((state.flags & 0xff) !== Z_DEFLATED) {\n          strm.msg = 'unknown compression method';\n          state.mode = BAD;\n          break;\n        }\n        if (state.flags & 0xe000) {\n          strm.msg = 'unknown header flags set';\n          state.mode = BAD;\n          break;\n        }\n        if (state.head) {\n          state.head.text = ((hold >> 8) & 1);\n        }\n        if (state.flags & 0x0200) {\n          //=== CRC2(state.check, hold);\n          hbuf[0] = hold & 0xff;\n          hbuf[1] = (hold >>> 8) & 0xff;\n          state.check = crc32(state.check, hbuf, 2, 0);\n          //===//\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        state.mode = TIME;\n        /* falls through */\n      case TIME:\n        //=== NEEDBITS(32); */\n        while (bits < 32) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        if (state.head) {\n          state.head.time = hold;\n        }\n        if (state.flags & 0x0200) {\n          //=== CRC4(state.check, hold)\n          hbuf[0] = hold & 0xff;\n          hbuf[1] = (hold >>> 8) & 0xff;\n          hbuf[2] = (hold >>> 16) & 0xff;\n          hbuf[3] = (hold >>> 24) & 0xff;\n          state.check = crc32(state.check, hbuf, 4, 0);\n          //===\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        state.mode = OS;\n        /* falls through */\n      case OS:\n        //=== NEEDBITS(16); */\n        while (bits < 16) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        if (state.head) {\n          state.head.xflags = (hold & 0xff);\n          state.head.os = (hold >> 8);\n        }\n        if (state.flags & 0x0200) {\n          //=== CRC2(state.check, hold);\n          hbuf[0] = hold & 0xff;\n          hbuf[1] = (hold >>> 8) & 0xff;\n          state.check = crc32(state.check, hbuf, 2, 0);\n          //===//\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        state.mode = EXLEN;\n        /* falls through */\n      case EXLEN:\n        if (state.flags & 0x0400) {\n          //=== NEEDBITS(16); */\n          while (bits < 16) {\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n          }\n          //===//\n          state.length = hold;\n          if (state.head) {\n            state.head.extra_len = hold;\n          }\n          if (state.flags & 0x0200) {\n            //=== CRC2(state.check, hold);\n            hbuf[0] = hold & 0xff;\n            hbuf[1] = (hold >>> 8) & 0xff;\n            state.check = crc32(state.check, hbuf, 2, 0);\n            //===//\n          }\n          //=== INITBITS();\n          hold = 0;\n          bits = 0;\n          //===//\n        }\n        else if (state.head) {\n          state.head.extra = null/*Z_NULL*/;\n        }\n        state.mode = EXTRA;\n        /* falls through */\n      case EXTRA:\n        if (state.flags & 0x0400) {\n          copy = state.length;\n          if (copy > have) { copy = have; }\n          if (copy) {\n            if (state.head) {\n              len = state.head.extra_len - state.length;\n              if (!state.head.extra) {\n                // Use untyped array for more convenient processing later\n                state.head.extra = new Array(state.head.extra_len);\n              }\n              utils.arraySet(\n                state.head.extra,\n                input,\n                next,\n                // extra field is limited to 65536 bytes\n                // - no need for additional size check\n                copy,\n                /*len + copy > state.head.extra_max - len ? state.head.extra_max : copy,*/\n                len\n              );\n              //zmemcpy(state.head.extra + len, next,\n              //        len + copy > state.head.extra_max ?\n              //        state.head.extra_max - len : copy);\n            }\n            if (state.flags & 0x0200) {\n              state.check = crc32(state.check, input, copy, next);\n            }\n            have -= copy;\n            next += copy;\n            state.length -= copy;\n          }\n          if (state.length) { break inf_leave; }\n        }\n        state.length = 0;\n        state.mode = NAME;\n        /* falls through */\n      case NAME:\n        if (state.flags & 0x0800) {\n          if (have === 0) { break inf_leave; }\n          copy = 0;\n          do {\n            // TODO: 2 or 1 bytes?\n            len = input[next + copy++];\n            /* use constant limit because in js we should not preallocate memory */\n            if (state.head && len &&\n                (state.length < 65536 /*state.head.name_max*/)) {\n              state.head.name += String.fromCharCode(len);\n            }\n          } while (len && copy < have);\n\n          if (state.flags & 0x0200) {\n            state.check = crc32(state.check, input, copy, next);\n          }\n          have -= copy;\n          next += copy;\n          if (len) { break inf_leave; }\n        }\n        else if (state.head) {\n          state.head.name = null;\n        }\n        state.length = 0;\n        state.mode = COMMENT;\n        /* falls through */\n      case COMMENT:\n        if (state.flags & 0x1000) {\n          if (have === 0) { break inf_leave; }\n          copy = 0;\n          do {\n            len = input[next + copy++];\n            /* use constant limit because in js we should not preallocate memory */\n            if (state.head && len &&\n                (state.length < 65536 /*state.head.comm_max*/)) {\n              state.head.comment += String.fromCharCode(len);\n            }\n          } while (len && copy < have);\n          if (state.flags & 0x0200) {\n            state.check = crc32(state.check, input, copy, next);\n          }\n          have -= copy;\n          next += copy;\n          if (len) { break inf_leave; }\n        }\n        else if (state.head) {\n          state.head.comment = null;\n        }\n        state.mode = HCRC;\n        /* falls through */\n      case HCRC:\n        if (state.flags & 0x0200) {\n          //=== NEEDBITS(16); */\n          while (bits < 16) {\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n          }\n          //===//\n          if (hold !== (state.check & 0xffff)) {\n            strm.msg = 'header crc mismatch';\n            state.mode = BAD;\n            break;\n          }\n          //=== INITBITS();\n          hold = 0;\n          bits = 0;\n          //===//\n        }\n        if (state.head) {\n          state.head.hcrc = ((state.flags >> 9) & 1);\n          state.head.done = true;\n        }\n        strm.adler = state.check = 0;\n        state.mode = TYPE;\n        break;\n      case DICTID:\n        //=== NEEDBITS(32); */\n        while (bits < 32) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        strm.adler = state.check = zswap32(hold);\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        state.mode = DICT;\n        /* falls through */\n      case DICT:\n        if (state.havedict === 0) {\n          //--- RESTORE() ---\n          strm.next_out = put;\n          strm.avail_out = left;\n          strm.next_in = next;\n          strm.avail_in = have;\n          state.hold = hold;\n          state.bits = bits;\n          //---\n          return Z_NEED_DICT;\n        }\n        strm.adler = state.check = 1/*adler32(0L, Z_NULL, 0)*/;\n        state.mode = TYPE;\n        /* falls through */\n      case TYPE:\n        if (flush === Z_BLOCK || flush === Z_TREES) { break inf_leave; }\n        /* falls through */\n      case TYPEDO:\n        if (state.last) {\n          //--- BYTEBITS() ---//\n          hold >>>= bits & 7;\n          bits -= bits & 7;\n          //---//\n          state.mode = CHECK;\n          break;\n        }\n        //=== NEEDBITS(3); */\n        while (bits < 3) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.last = (hold & 0x01)/*BITS(1)*/;\n        //--- DROPBITS(1) ---//\n        hold >>>= 1;\n        bits -= 1;\n        //---//\n\n        switch ((hold & 0x03)/*BITS(2)*/) {\n          case 0:                             /* stored block */\n            //Tracev((stderr, \"inflate:     stored block%s\\n\",\n            //        state.last ? \" (last)\" : \"\"));\n            state.mode = STORED;\n            break;\n          case 1:                             /* fixed block */\n            fixedtables(state);\n            //Tracev((stderr, \"inflate:     fixed codes block%s\\n\",\n            //        state.last ? \" (last)\" : \"\"));\n            state.mode = LEN_;             /* decode codes */\n            if (flush === Z_TREES) {\n              //--- DROPBITS(2) ---//\n              hold >>>= 2;\n              bits -= 2;\n              //---//\n              break inf_leave;\n            }\n            break;\n          case 2:                             /* dynamic block */\n            //Tracev((stderr, \"inflate:     dynamic codes block%s\\n\",\n            //        state.last ? \" (last)\" : \"\"));\n            state.mode = TABLE;\n            break;\n          case 3:\n            strm.msg = 'invalid block type';\n            state.mode = BAD;\n        }\n        //--- DROPBITS(2) ---//\n        hold >>>= 2;\n        bits -= 2;\n        //---//\n        break;\n      case STORED:\n        //--- BYTEBITS() ---// /* go to byte boundary */\n        hold >>>= bits & 7;\n        bits -= bits & 7;\n        //---//\n        //=== NEEDBITS(32); */\n        while (bits < 32) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        if ((hold & 0xffff) !== ((hold >>> 16) ^ 0xffff)) {\n          strm.msg = 'invalid stored block lengths';\n          state.mode = BAD;\n          break;\n        }\n        state.length = hold & 0xffff;\n        //Tracev((stderr, \"inflate:       stored length %u\\n\",\n        //        state.length));\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        state.mode = COPY_;\n        if (flush === Z_TREES) { break inf_leave; }\n        /* falls through */\n      case COPY_:\n        state.mode = COPY;\n        /* falls through */\n      case COPY:\n        copy = state.length;\n        if (copy) {\n          if (copy > have) { copy = have; }\n          if (copy > left) { copy = left; }\n          if (copy === 0) { break inf_leave; }\n          //--- zmemcpy(put, next, copy); ---\n          utils.arraySet(output, input, next, copy, put);\n          //---//\n          have -= copy;\n          next += copy;\n          left -= copy;\n          put += copy;\n          state.length -= copy;\n          break;\n        }\n        //Tracev((stderr, \"inflate:       stored end\\n\"));\n        state.mode = TYPE;\n        break;\n      case TABLE:\n        //=== NEEDBITS(14); */\n        while (bits < 14) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.nlen = (hold & 0x1f)/*BITS(5)*/ + 257;\n        //--- DROPBITS(5) ---//\n        hold >>>= 5;\n        bits -= 5;\n        //---//\n        state.ndist = (hold & 0x1f)/*BITS(5)*/ + 1;\n        //--- DROPBITS(5) ---//\n        hold >>>= 5;\n        bits -= 5;\n        //---//\n        state.ncode = (hold & 0x0f)/*BITS(4)*/ + 4;\n        //--- DROPBITS(4) ---//\n        hold >>>= 4;\n        bits -= 4;\n        //---//\n//#ifndef PKZIP_BUG_WORKAROUND\n        if (state.nlen > 286 || state.ndist > 30) {\n          strm.msg = 'too many length or distance symbols';\n          state.mode = BAD;\n          break;\n        }\n//#endif\n        //Tracev((stderr, \"inflate:       table sizes ok\\n\"));\n        state.have = 0;\n        state.mode = LENLENS;\n        /* falls through */\n      case LENLENS:\n        while (state.have < state.ncode) {\n          //=== NEEDBITS(3);\n          while (bits < 3) {\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n          }\n          //===//\n          state.lens[order[state.have++]] = (hold & 0x07);//BITS(3);\n          //--- DROPBITS(3) ---//\n          hold >>>= 3;\n          bits -= 3;\n          //---//\n        }\n        while (state.have < 19) {\n          state.lens[order[state.have++]] = 0;\n        }\n        // We have separate tables & no pointers. 2 commented lines below not needed.\n        //state.next = state.codes;\n        //state.lencode = state.next;\n        // Switch to use dynamic table\n        state.lencode = state.lendyn;\n        state.lenbits = 7;\n\n        opts = { bits: state.lenbits };\n        ret = inflate_table(CODES, state.lens, 0, 19, state.lencode, 0, state.work, opts);\n        state.lenbits = opts.bits;\n\n        if (ret) {\n          strm.msg = 'invalid code lengths set';\n          state.mode = BAD;\n          break;\n        }\n        //Tracev((stderr, \"inflate:       code lengths ok\\n\"));\n        state.have = 0;\n        state.mode = CODELENS;\n        /* falls through */\n      case CODELENS:\n        while (state.have < state.nlen + state.ndist) {\n          for (;;) {\n            here = state.lencode[hold & ((1 << state.lenbits) - 1)];/*BITS(state.lenbits)*/\n            here_bits = here >>> 24;\n            here_op = (here >>> 16) & 0xff;\n            here_val = here & 0xffff;\n\n            if ((here_bits) <= bits) { break; }\n            //--- PULLBYTE() ---//\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n            //---//\n          }\n          if (here_val < 16) {\n            //--- DROPBITS(here.bits) ---//\n            hold >>>= here_bits;\n            bits -= here_bits;\n            //---//\n            state.lens[state.have++] = here_val;\n          }\n          else {\n            if (here_val === 16) {\n              //=== NEEDBITS(here.bits + 2);\n              n = here_bits + 2;\n              while (bits < n) {\n                if (have === 0) { break inf_leave; }\n                have--;\n                hold += input[next++] << bits;\n                bits += 8;\n              }\n              //===//\n              //--- DROPBITS(here.bits) ---//\n              hold >>>= here_bits;\n              bits -= here_bits;\n              //---//\n              if (state.have === 0) {\n                strm.msg = 'invalid bit length repeat';\n                state.mode = BAD;\n                break;\n              }\n              len = state.lens[state.have - 1];\n              copy = 3 + (hold & 0x03);//BITS(2);\n              //--- DROPBITS(2) ---//\n              hold >>>= 2;\n              bits -= 2;\n              //---//\n            }\n            else if (here_val === 17) {\n              //=== NEEDBITS(here.bits + 3);\n              n = here_bits + 3;\n              while (bits < n) {\n                if (have === 0) { break inf_leave; }\n                have--;\n                hold += input[next++] << bits;\n                bits += 8;\n              }\n              //===//\n              //--- DROPBITS(here.bits) ---//\n              hold >>>= here_bits;\n              bits -= here_bits;\n              //---//\n              len = 0;\n              copy = 3 + (hold & 0x07);//BITS(3);\n              //--- DROPBITS(3) ---//\n              hold >>>= 3;\n              bits -= 3;\n              //---//\n            }\n            else {\n              //=== NEEDBITS(here.bits + 7);\n              n = here_bits + 7;\n              while (bits < n) {\n                if (have === 0) { break inf_leave; }\n                have--;\n                hold += input[next++] << bits;\n                bits += 8;\n              }\n              //===//\n              //--- DROPBITS(here.bits) ---//\n              hold >>>= here_bits;\n              bits -= here_bits;\n              //---//\n              len = 0;\n              copy = 11 + (hold & 0x7f);//BITS(7);\n              //--- DROPBITS(7) ---//\n              hold >>>= 7;\n              bits -= 7;\n              //---//\n            }\n            if (state.have + copy > state.nlen + state.ndist) {\n              strm.msg = 'invalid bit length repeat';\n              state.mode = BAD;\n              break;\n            }\n            while (copy--) {\n              state.lens[state.have++] = len;\n            }\n          }\n        }\n\n        /* handle error breaks in while */\n        if (state.mode === BAD) { break; }\n\n        /* check for end-of-block code (better have one) */\n        if (state.lens[256] === 0) {\n          strm.msg = 'invalid code -- missing end-of-block';\n          state.mode = BAD;\n          break;\n        }\n\n        /* build code tables -- note: do not change the lenbits or distbits\n           values here (9 and 6) without reading the comments in inftrees.h\n           concerning the ENOUGH constants, which depend on those values */\n        state.lenbits = 9;\n\n        opts = { bits: state.lenbits };\n        ret = inflate_table(LENS, state.lens, 0, state.nlen, state.lencode, 0, state.work, opts);\n        // We have separate tables & no pointers. 2 commented lines below not needed.\n        // state.next_index = opts.table_index;\n        state.lenbits = opts.bits;\n        // state.lencode = state.next;\n\n        if (ret) {\n          strm.msg = 'invalid literal/lengths set';\n          state.mode = BAD;\n          break;\n        }\n\n        state.distbits = 6;\n        //state.distcode.copy(state.codes);\n        // Switch to use dynamic table\n        state.distcode = state.distdyn;\n        opts = { bits: state.distbits };\n        ret = inflate_table(DISTS, state.lens, state.nlen, state.ndist, state.distcode, 0, state.work, opts);\n        // We have separate tables & no pointers. 2 commented lines below not needed.\n        // state.next_index = opts.table_index;\n        state.distbits = opts.bits;\n        // state.distcode = state.next;\n\n        if (ret) {\n          strm.msg = 'invalid distances set';\n          state.mode = BAD;\n          break;\n        }\n        //Tracev((stderr, 'inflate:       codes ok\\n'));\n        state.mode = LEN_;\n        if (flush === Z_TREES) { break inf_leave; }\n        /* falls through */\n      case LEN_:\n        state.mode = LEN;\n        /* falls through */\n      case LEN:\n        if (have >= 6 && left >= 258) {\n          //--- RESTORE() ---\n          strm.next_out = put;\n          strm.avail_out = left;\n          strm.next_in = next;\n          strm.avail_in = have;\n          state.hold = hold;\n          state.bits = bits;\n          //---\n          inflate_fast(strm, _out);\n          //--- LOAD() ---\n          put = strm.next_out;\n          output = strm.output;\n          left = strm.avail_out;\n          next = strm.next_in;\n          input = strm.input;\n          have = strm.avail_in;\n          hold = state.hold;\n          bits = state.bits;\n          //---\n\n          if (state.mode === TYPE) {\n            state.back = -1;\n          }\n          break;\n        }\n        state.back = 0;\n        for (;;) {\n          here = state.lencode[hold & ((1 << state.lenbits) - 1)];  /*BITS(state.lenbits)*/\n          here_bits = here >>> 24;\n          here_op = (here >>> 16) & 0xff;\n          here_val = here & 0xffff;\n\n          if (here_bits <= bits) { break; }\n          //--- PULLBYTE() ---//\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n          //---//\n        }\n        if (here_op && (here_op & 0xf0) === 0) {\n          last_bits = here_bits;\n          last_op = here_op;\n          last_val = here_val;\n          for (;;) {\n            here = state.lencode[last_val +\n                    ((hold & ((1 << (last_bits + last_op)) - 1))/*BITS(last.bits + last.op)*/ >> last_bits)];\n            here_bits = here >>> 24;\n            here_op = (here >>> 16) & 0xff;\n            here_val = here & 0xffff;\n\n            if ((last_bits + here_bits) <= bits) { break; }\n            //--- PULLBYTE() ---//\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n            //---//\n          }\n          //--- DROPBITS(last.bits) ---//\n          hold >>>= last_bits;\n          bits -= last_bits;\n          //---//\n          state.back += last_bits;\n        }\n        //--- DROPBITS(here.bits) ---//\n        hold >>>= here_bits;\n        bits -= here_bits;\n        //---//\n        state.back += here_bits;\n        state.length = here_val;\n        if (here_op === 0) {\n          //Tracevv((stderr, here.val >= 0x20 && here.val < 0x7f ?\n          //        \"inflate:         literal '%c'\\n\" :\n          //        \"inflate:         literal 0x%02x\\n\", here.val));\n          state.mode = LIT;\n          break;\n        }\n        if (here_op & 32) {\n          //Tracevv((stderr, \"inflate:         end of block\\n\"));\n          state.back = -1;\n          state.mode = TYPE;\n          break;\n        }\n        if (here_op & 64) {\n          strm.msg = 'invalid literal/length code';\n          state.mode = BAD;\n          break;\n        }\n        state.extra = here_op & 15;\n        state.mode = LENEXT;\n        /* falls through */\n      case LENEXT:\n        if (state.extra) {\n          //=== NEEDBITS(state.extra);\n          n = state.extra;\n          while (bits < n) {\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n          }\n          //===//\n          state.length += hold & ((1 << state.extra) - 1)/*BITS(state.extra)*/;\n          //--- DROPBITS(state.extra) ---//\n          hold >>>= state.extra;\n          bits -= state.extra;\n          //---//\n          state.back += state.extra;\n        }\n        //Tracevv((stderr, \"inflate:         length %u\\n\", state.length));\n        state.was = state.length;\n        state.mode = DIST;\n        /* falls through */\n      case DIST:\n        for (;;) {\n          here = state.distcode[hold & ((1 << state.distbits) - 1)];/*BITS(state.distbits)*/\n          here_bits = here >>> 24;\n          here_op = (here >>> 16) & 0xff;\n          here_val = here & 0xffff;\n\n          if ((here_bits) <= bits) { break; }\n          //--- PULLBYTE() ---//\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n          //---//\n        }\n        if ((here_op & 0xf0) === 0) {\n          last_bits = here_bits;\n          last_op = here_op;\n          last_val = here_val;\n          for (;;) {\n            here = state.distcode[last_val +\n                    ((hold & ((1 << (last_bits + last_op)) - 1))/*BITS(last.bits + last.op)*/ >> last_bits)];\n            here_bits = here >>> 24;\n            here_op = (here >>> 16) & 0xff;\n            here_val = here & 0xffff;\n\n            if ((last_bits + here_bits) <= bits) { break; }\n            //--- PULLBYTE() ---//\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n            //---//\n          }\n          //--- DROPBITS(last.bits) ---//\n          hold >>>= last_bits;\n          bits -= last_bits;\n          //---//\n          state.back += last_bits;\n        }\n        //--- DROPBITS(here.bits) ---//\n        hold >>>= here_bits;\n        bits -= here_bits;\n        //---//\n        state.back += here_bits;\n        if (here_op & 64) {\n          strm.msg = 'invalid distance code';\n          state.mode = BAD;\n          break;\n        }\n        state.offset = here_val;\n        state.extra = (here_op) & 15;\n        state.mode = DISTEXT;\n        /* falls through */\n      case DISTEXT:\n        if (state.extra) {\n          //=== NEEDBITS(state.extra);\n          n = state.extra;\n          while (bits < n) {\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n          }\n          //===//\n          state.offset += hold & ((1 << state.extra) - 1)/*BITS(state.extra)*/;\n          //--- DROPBITS(state.extra) ---//\n          hold >>>= state.extra;\n          bits -= state.extra;\n          //---//\n          state.back += state.extra;\n        }\n//#ifdef INFLATE_STRICT\n        if (state.offset > state.dmax) {\n          strm.msg = 'invalid distance too far back';\n          state.mode = BAD;\n          break;\n        }\n//#endif\n        //Tracevv((stderr, \"inflate:         distance %u\\n\", state.offset));\n        state.mode = MATCH;\n        /* falls through */\n      case MATCH:\n        if (left === 0) { break inf_leave; }\n        copy = _out - left;\n        if (state.offset > copy) {         /* copy from window */\n          copy = state.offset - copy;\n          if (copy > state.whave) {\n            if (state.sane) {\n              strm.msg = 'invalid distance too far back';\n              state.mode = BAD;\n              break;\n            }\n// (!) This block is disabled in zlib defaults,\n// don't enable it for binary compatibility\n//#ifdef INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR\n//          Trace((stderr, \"inflate.c too far\\n\"));\n//          copy -= state.whave;\n//          if (copy > state.length) { copy = state.length; }\n//          if (copy > left) { copy = left; }\n//          left -= copy;\n//          state.length -= copy;\n//          do {\n//            output[put++] = 0;\n//          } while (--copy);\n//          if (state.length === 0) { state.mode = LEN; }\n//          break;\n//#endif\n          }\n          if (copy > state.wnext) {\n            copy -= state.wnext;\n            from = state.wsize - copy;\n          }\n          else {\n            from = state.wnext - copy;\n          }\n          if (copy > state.length) { copy = state.length; }\n          from_source = state.window;\n        }\n        else {                              /* copy from output */\n          from_source = output;\n          from = put - state.offset;\n          copy = state.length;\n        }\n        if (copy > left) { copy = left; }\n        left -= copy;\n        state.length -= copy;\n        do {\n          output[put++] = from_source[from++];\n        } while (--copy);\n        if (state.length === 0) { state.mode = LEN; }\n        break;\n      case LIT:\n        if (left === 0) { break inf_leave; }\n        output[put++] = state.length;\n        left--;\n        state.mode = LEN;\n        break;\n      case CHECK:\n        if (state.wrap) {\n          //=== NEEDBITS(32);\n          while (bits < 32) {\n            if (have === 0) { break inf_leave; }\n            have--;\n            // Use '|' instead of '+' to make sure that result is signed\n            hold |= input[next++] << bits;\n            bits += 8;\n          }\n          //===//\n          _out -= left;\n          strm.total_out += _out;\n          state.total += _out;\n          if (_out) {\n            strm.adler = state.check =\n                /*UPDATE(state.check, put - _out, _out);*/\n                (state.flags ? crc32(state.check, output, _out, put - _out) : adler32(state.check, output, _out, put - _out));\n\n          }\n          _out = left;\n          // NB: crc32 stored as signed 32-bit int, zswap32 returns signed too\n          if ((state.flags ? hold : zswap32(hold)) !== state.check) {\n            strm.msg = 'incorrect data check';\n            state.mode = BAD;\n            break;\n          }\n          //=== INITBITS();\n          hold = 0;\n          bits = 0;\n          //===//\n          //Tracev((stderr, \"inflate:   check matches trailer\\n\"));\n        }\n        state.mode = LENGTH;\n        /* falls through */\n      case LENGTH:\n        if (state.wrap && state.flags) {\n          //=== NEEDBITS(32);\n          while (bits < 32) {\n            if (have === 0) { break inf_leave; }\n            have--;\n            hold += input[next++] << bits;\n            bits += 8;\n          }\n          //===//\n          if (hold !== (state.total & 0xffffffff)) {\n            strm.msg = 'incorrect length check';\n            state.mode = BAD;\n            break;\n          }\n          //=== INITBITS();\n          hold = 0;\n          bits = 0;\n          //===//\n          //Tracev((stderr, \"inflate:   length matches trailer\\n\"));\n        }\n        state.mode = DONE;\n        /* falls through */\n      case DONE:\n        ret = Z_STREAM_END;\n        break inf_leave;\n      case BAD:\n        ret = Z_DATA_ERROR;\n        break inf_leave;\n      case MEM:\n        return Z_MEM_ERROR;\n      case SYNC:\n        /* falls through */\n      default:\n        return Z_STREAM_ERROR;\n    }\n  }\n\n  // inf_leave <- here is real place for \"goto inf_leave\", emulated via \"break inf_leave\"\n\n  /*\n     Return from inflate(), updating the total counts and the check value.\n     If there was no progress during the inflate() call, return a buffer\n     error.  Call updatewindow() to create and/or update the window state.\n     Note: a memory error from inflate() is non-recoverable.\n   */\n\n  //--- RESTORE() ---\n  strm.next_out = put;\n  strm.avail_out = left;\n  strm.next_in = next;\n  strm.avail_in = have;\n  state.hold = hold;\n  state.bits = bits;\n  //---\n\n  if (state.wsize || (_out !== strm.avail_out && state.mode < BAD &&\n                      (state.mode < CHECK || flush !== Z_FINISH))) {\n    if (updatewindow(strm, strm.output, strm.next_out, _out - strm.avail_out)) {\n      state.mode = MEM;\n      return Z_MEM_ERROR;\n    }\n  }\n  _in -= strm.avail_in;\n  _out -= strm.avail_out;\n  strm.total_in += _in;\n  strm.total_out += _out;\n  state.total += _out;\n  if (state.wrap && _out) {\n    strm.adler = state.check = /*UPDATE(state.check, strm.next_out - _out, _out);*/\n      (state.flags ? crc32(state.check, output, _out, strm.next_out - _out) : adler32(state.check, output, _out, strm.next_out - _out));\n  }\n  strm.data_type = state.bits + (state.last ? 64 : 0) +\n                    (state.mode === TYPE ? 128 : 0) +\n                    (state.mode === LEN_ || state.mode === COPY_ ? 256 : 0);\n  if (((_in === 0 && _out === 0) || flush === Z_FINISH) && ret === Z_OK) {\n    ret = Z_BUF_ERROR;\n  }\n  return ret;\n}\n\nfunction inflateEnd(strm) {\n\n  if (!strm || !strm.state /*|| strm->zfree == (free_func)0*/) {\n    return Z_STREAM_ERROR;\n  }\n\n  var state = strm.state;\n  if (state.window) {\n    state.window = null;\n  }\n  strm.state = null;\n  return Z_OK;\n}\n\nfunction inflateGetHeader(strm, head) {\n  var state;\n\n  /* check state */\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  if ((state.wrap & 2) === 0) { return Z_STREAM_ERROR; }\n\n  /* save header structure */\n  state.head = head;\n  head.done = false;\n  return Z_OK;\n}\n\nfunction inflateSetDictionary(strm, dictionary) {\n  var dictLength = dictionary.length;\n\n  var state;\n  var dictid;\n  var ret;\n\n  /* check state */\n  if (!strm /* == Z_NULL */ || !strm.state /* == Z_NULL */) { return Z_STREAM_ERROR; }\n  state = strm.state;\n\n  if (state.wrap !== 0 && state.mode !== DICT) {\n    return Z_STREAM_ERROR;\n  }\n\n  /* check for correct dictionary identifier */\n  if (state.mode === DICT) {\n    dictid = 1; /* adler32(0, null, 0)*/\n    /* dictid = adler32(dictid, dictionary, dictLength); */\n    dictid = adler32(dictid, dictionary, dictLength, 0);\n    if (dictid !== state.check) {\n      return Z_DATA_ERROR;\n    }\n  }\n  /* copy dictionary to window using updatewindow(), which will amend the\n   existing dictionary if appropriate */\n  ret = updatewindow(strm, dictionary, dictLength, dictLength);\n  if (ret) {\n    state.mode = MEM;\n    return Z_MEM_ERROR;\n  }\n  state.havedict = 1;\n  // Tracev((stderr, \"inflate:   dictionary set\\n\"));\n  return Z_OK;\n}\n\nexports.inflateReset = inflateReset;\nexports.inflateReset2 = inflateReset2;\nexports.inflateResetKeep = inflateResetKeep;\nexports.inflateInit = inflateInit;\nexports.inflateInit2 = inflateInit2;\nexports.inflate = inflate;\nexports.inflateEnd = inflateEnd;\nexports.inflateGetHeader = inflateGetHeader;\nexports.inflateSetDictionary = inflateSetDictionary;\nexports.inflateInfo = 'pako inflate (from Nodeca project)';\n\n/* Not implemented\nexports.inflateCopy = inflateCopy;\nexports.inflateGetDictionary = inflateGetDictionary;\nexports.inflateMark = inflateMark;\nexports.inflatePrime = inflatePrime;\nexports.inflateSync = inflateSync;\nexports.inflateSyncPoint = inflateSyncPoint;\nexports.inflateUndermine = inflateUndermine;\n*/\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\nvar utils = require('../utils/common');\n\nvar MAXBITS = 15;\nvar ENOUGH_LENS = 852;\nvar ENOUGH_DISTS = 592;\n//var ENOUGH = (ENOUGH_LENS+ENOUGH_DISTS);\n\nvar CODES = 0;\nvar LENS = 1;\nvar DISTS = 2;\n\nvar lbase = [ /* Length codes 257..285 base */\n  3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,\n  35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0\n];\n\nvar lext = [ /* Length codes 257..285 extra */\n  16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18,\n  19, 19, 19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 16, 72, 78\n];\n\nvar dbase = [ /* Distance codes 0..29 base */\n  1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,\n  257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,\n  8193, 12289, 16385, 24577, 0, 0\n];\n\nvar dext = [ /* Distance codes 0..29 extra */\n  16, 16, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22,\n  23, 23, 24, 24, 25, 25, 26, 26, 27, 27,\n  28, 28, 29, 29, 64, 64\n];\n\nmodule.exports = function inflate_table(type, lens, lens_index, codes, table, table_index, work, opts)\n{\n  var bits = opts.bits;\n      //here = opts.here; /* table entry for duplication */\n\n  var len = 0;               /* a code's length in bits */\n  var sym = 0;               /* index of code symbols */\n  var min = 0, max = 0;          /* minimum and maximum code lengths */\n  var root = 0;              /* number of index bits for root table */\n  var curr = 0;              /* number of index bits for current table */\n  var drop = 0;              /* code bits to drop for sub-table */\n  var left = 0;                   /* number of prefix codes available */\n  var used = 0;              /* code entries in table used */\n  var huff = 0;              /* Huffman code */\n  var incr;              /* for incrementing code, index */\n  var fill;              /* index for replicating entries */\n  var low;               /* low bits for current root entry */\n  var mask;              /* mask for low root bits */\n  var next;             /* next available space in table */\n  var base = null;     /* base value table to use */\n  var base_index = 0;\n//  var shoextra;    /* extra bits table to use */\n  var end;                    /* use base and extra for symbol > end */\n  var count = new utils.Buf16(MAXBITS + 1); //[MAXBITS+1];    /* number of codes of each length */\n  var offs = new utils.Buf16(MAXBITS + 1); //[MAXBITS+1];     /* offsets in table for each length */\n  var extra = null;\n  var extra_index = 0;\n\n  var here_bits, here_op, here_val;\n\n  /*\n   Process a set of code lengths to create a canonical Huffman code.  The\n   code lengths are lens[0..codes-1].  Each length corresponds to the\n   symbols 0..codes-1.  The Huffman code is generated by first sorting the\n   symbols by length from short to long, and retaining the symbol order\n   for codes with equal lengths.  Then the code starts with all zero bits\n   for the first code of the shortest length, and the codes are integer\n   increments for the same length, and zeros are appended as the length\n   increases.  For the deflate format, these bits are stored backwards\n   from their more natural integer increment ordering, and so when the\n   decoding tables are built in the large loop below, the integer codes\n   are incremented backwards.\n\n   This routine assumes, but does not check, that all of the entries in\n   lens[] are in the range 0..MAXBITS.  The caller must assure this.\n   1..MAXBITS is interpreted as that code length.  zero means that that\n   symbol does not occur in this code.\n\n   The codes are sorted by computing a count of codes for each length,\n   creating from that a table of starting indices for each length in the\n   sorted table, and then entering the symbols in order in the sorted\n   table.  The sorted table is work[], with that space being provided by\n   the caller.\n\n   The length counts are used for other purposes as well, i.e. finding\n   the minimum and maximum length codes, determining if there are any\n   codes at all, checking for a valid set of lengths, and looking ahead\n   at length counts to determine sub-table sizes when building the\n   decoding tables.\n   */\n\n  /* accumulate lengths for codes (assumes lens[] all in 0..MAXBITS) */\n  for (len = 0; len <= MAXBITS; len++) {\n    count[len] = 0;\n  }\n  for (sym = 0; sym < codes; sym++) {\n    count[lens[lens_index + sym]]++;\n  }\n\n  /* bound code lengths, force root to be within code lengths */\n  root = bits;\n  for (max = MAXBITS; max >= 1; max--) {\n    if (count[max] !== 0) { break; }\n  }\n  if (root > max) {\n    root = max;\n  }\n  if (max === 0) {                     /* no symbols to code at all */\n    //table.op[opts.table_index] = 64;  //here.op = (var char)64;    /* invalid code marker */\n    //table.bits[opts.table_index] = 1;   //here.bits = (var char)1;\n    //table.val[opts.table_index++] = 0;   //here.val = (var short)0;\n    table[table_index++] = (1 << 24) | (64 << 16) | 0;\n\n\n    //table.op[opts.table_index] = 64;\n    //table.bits[opts.table_index] = 1;\n    //table.val[opts.table_index++] = 0;\n    table[table_index++] = (1 << 24) | (64 << 16) | 0;\n\n    opts.bits = 1;\n    return 0;     /* no symbols, but wait for decoding to report error */\n  }\n  for (min = 1; min < max; min++) {\n    if (count[min] !== 0) { break; }\n  }\n  if (root < min) {\n    root = min;\n  }\n\n  /* check for an over-subscribed or incomplete set of lengths */\n  left = 1;\n  for (len = 1; len <= MAXBITS; len++) {\n    left <<= 1;\n    left -= count[len];\n    if (left < 0) {\n      return -1;\n    }        /* over-subscribed */\n  }\n  if (left > 0 && (type === CODES || max !== 1)) {\n    return -1;                      /* incomplete set */\n  }\n\n  /* generate offsets into symbol table for each length for sorting */\n  offs[1] = 0;\n  for (len = 1; len < MAXBITS; len++) {\n    offs[len + 1] = offs[len] + count[len];\n  }\n\n  /* sort symbols by length, by symbol order within each length */\n  for (sym = 0; sym < codes; sym++) {\n    if (lens[lens_index + sym] !== 0) {\n      work[offs[lens[lens_index + sym]]++] = sym;\n    }\n  }\n\n  /*\n   Create and fill in decoding tables.  In this loop, the table being\n   filled is at next and has curr index bits.  The code being used is huff\n   with length len.  That code is converted to an index by dropping drop\n   bits off of the bottom.  For codes where len is less than drop + curr,\n   those top drop + curr - len bits are incremented through all values to\n   fill the table with replicated entries.\n\n   root is the number of index bits for the root table.  When len exceeds\n   root, sub-tables are created pointed to by the root entry with an index\n   of the low root bits of huff.  This is saved in low to check for when a\n   new sub-table should be started.  drop is zero when the root table is\n   being filled, and drop is root when sub-tables are being filled.\n\n   When a new sub-table is needed, it is necessary to look ahead in the\n   code lengths to determine what size sub-table is needed.  The length\n   counts are used for this, and so count[] is decremented as codes are\n   entered in the tables.\n\n   used keeps track of how many table entries have been allocated from the\n   provided *table space.  It is checked for LENS and DIST tables against\n   the constants ENOUGH_LENS and ENOUGH_DISTS to guard against changes in\n   the initial root table size constants.  See the comments in inftrees.h\n   for more information.\n\n   sym increments through all symbols, and the loop terminates when\n   all codes of length max, i.e. all codes, have been processed.  This\n   routine permits incomplete codes, so another loop after this one fills\n   in the rest of the decoding tables with invalid code markers.\n   */\n\n  /* set up for code type */\n  // poor man optimization - use if-else instead of switch,\n  // to avoid deopts in old v8\n  if (type === CODES) {\n    base = extra = work;    /* dummy value--not used */\n    end = 19;\n\n  } else if (type === LENS) {\n    base = lbase;\n    base_index -= 257;\n    extra = lext;\n    extra_index -= 257;\n    end = 256;\n\n  } else {                    /* DISTS */\n    base = dbase;\n    extra = dext;\n    end = -1;\n  }\n\n  /* initialize opts for loop */\n  huff = 0;                   /* starting code */\n  sym = 0;                    /* starting code symbol */\n  len = min;                  /* starting code length */\n  next = table_index;              /* current table to fill in */\n  curr = root;                /* current table index bits */\n  drop = 0;                   /* current bits to drop from code for index */\n  low = -1;                   /* trigger new sub-table when len > root */\n  used = 1 << root;          /* use root table entries */\n  mask = used - 1;            /* mask for comparing low */\n\n  /* check available table space */\n  if ((type === LENS && used > ENOUGH_LENS) ||\n    (type === DISTS && used > ENOUGH_DISTS)) {\n    return 1;\n  }\n\n  /* process all codes and make table entries */\n  for (;;) {\n    /* create table entry */\n    here_bits = len - drop;\n    if (work[sym] < end) {\n      here_op = 0;\n      here_val = work[sym];\n    }\n    else if (work[sym] > end) {\n      here_op = extra[extra_index + work[sym]];\n      here_val = base[base_index + work[sym]];\n    }\n    else {\n      here_op = 32 + 64;         /* end of block */\n      here_val = 0;\n    }\n\n    /* replicate for those indices with low len bits equal to huff */\n    incr = 1 << (len - drop);\n    fill = 1 << curr;\n    min = fill;                 /* save offset to next table */\n    do {\n      fill -= incr;\n      table[next + (huff >> drop) + fill] = (here_bits << 24) | (here_op << 16) | here_val |0;\n    } while (fill !== 0);\n\n    /* backwards increment the len-bit code huff */\n    incr = 1 << (len - 1);\n    while (huff & incr) {\n      incr >>= 1;\n    }\n    if (incr !== 0) {\n      huff &= incr - 1;\n      huff += incr;\n    } else {\n      huff = 0;\n    }\n\n    /* go to next symbol, update count, len */\n    sym++;\n    if (--count[len] === 0) {\n      if (len === max) { break; }\n      len = lens[lens_index + work[sym]];\n    }\n\n    /* create new sub-table if needed */\n    if (len > root && (huff & mask) !== low) {\n      /* if first time, transition to sub-tables */\n      if (drop === 0) {\n        drop = root;\n      }\n\n      /* increment past last table */\n      next += min;            /* here min is 1 << curr */\n\n      /* determine length of next table */\n      curr = len - drop;\n      left = 1 << curr;\n      while (curr + drop < max) {\n        left -= count[curr + drop];\n        if (left <= 0) { break; }\n        curr++;\n        left <<= 1;\n      }\n\n      /* check for enough space */\n      used += 1 << curr;\n      if ((type === LENS && used > ENOUGH_LENS) ||\n        (type === DISTS && used > ENOUGH_DISTS)) {\n        return 1;\n      }\n\n      /* point entry in root table to sub-table */\n      low = huff & mask;\n      /*table.op[low] = curr;\n      table.bits[low] = root;\n      table.val[low] = next - opts.table_index;*/\n      table[low] = (root << 24) | (curr << 16) | (next - table_index) |0;\n    }\n  }\n\n  /* fill in remaining table entry if code is incomplete (guaranteed to have\n   at most one remaining entry, since if the code is incomplete, the\n   maximum code length that was allowed to get this far is one bit) */\n  if (huff !== 0) {\n    //table.op[next + huff] = 64;            /* invalid code marker */\n    //table.bits[next + huff] = len - drop;\n    //table.val[next + huff] = 0;\n    table[next + huff] = ((len - drop) << 24) | (64 << 16) |0;\n  }\n\n  /* set return parameters */\n  //opts.table_index += used;\n  opts.bits = root;\n  return 0;\n};\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\nmodule.exports = {\n  2:      'need dictionary',     /* Z_NEED_DICT       2  */\n  1:      'stream end',          /* Z_STREAM_END      1  */\n  0:      '',                    /* Z_OK              0  */\n  '-1':   'file error',          /* Z_ERRNO         (-1) */\n  '-2':   'stream error',        /* Z_STREAM_ERROR  (-2) */\n  '-3':   'data error',          /* Z_DATA_ERROR    (-3) */\n  '-4':   'insufficient memory', /* Z_MEM_ERROR     (-4) */\n  '-5':   'buffer error',        /* Z_BUF_ERROR     (-5) */\n  '-6':   'incompatible version' /* Z_VERSION_ERROR (-6) */\n};\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\n/* eslint-disable space-unary-ops */\n\nvar utils = require('../utils/common');\n\n/* Public constants ==========================================================*/\n/* ===========================================================================*/\n\n\n//var Z_FILTERED          = 1;\n//var Z_HUFFMAN_ONLY      = 2;\n//var Z_RLE               = 3;\nvar Z_FIXED               = 4;\n//var Z_DEFAULT_STRATEGY  = 0;\n\n/* Possible values of the data_type field (though see inflate()) */\nvar Z_BINARY              = 0;\nvar Z_TEXT                = 1;\n//var Z_ASCII             = 1; // = Z_TEXT\nvar Z_UNKNOWN             = 2;\n\n/*============================================================================*/\n\n\nfunction zero(buf) { var len = buf.length; while (--len >= 0) { buf[len] = 0; } }\n\n// From zutil.h\n\nvar STORED_BLOCK = 0;\nvar STATIC_TREES = 1;\nvar DYN_TREES    = 2;\n/* The three kinds of block type */\n\nvar MIN_MATCH    = 3;\nvar MAX_MATCH    = 258;\n/* The minimum and maximum match lengths */\n\n// From deflate.h\n/* ===========================================================================\n * Internal compression state.\n */\n\nvar LENGTH_CODES  = 29;\n/* number of length codes, not counting the special END_BLOCK code */\n\nvar LITERALS      = 256;\n/* number of literal bytes 0..255 */\n\nvar L_CODES       = LITERALS + 1 + LENGTH_CODES;\n/* number of Literal or Length codes, including the END_BLOCK code */\n\nvar D_CODES       = 30;\n/* number of distance codes */\n\nvar BL_CODES      = 19;\n/* number of codes used to transfer the bit lengths */\n\nvar HEAP_SIZE     = 2 * L_CODES + 1;\n/* maximum heap size */\n\nvar MAX_BITS      = 15;\n/* All codes must not exceed MAX_BITS bits */\n\nvar Buf_size      = 16;\n/* size of bit buffer in bi_buf */\n\n\n/* ===========================================================================\n * Constants\n */\n\nvar MAX_BL_BITS = 7;\n/* Bit length codes must not exceed MAX_BL_BITS bits */\n\nvar END_BLOCK   = 256;\n/* end of block literal code */\n\nvar REP_3_6     = 16;\n/* repeat previous bit length 3-6 times (2 bits of repeat count) */\n\nvar REPZ_3_10   = 17;\n/* repeat a zero length 3-10 times  (3 bits of repeat count) */\n\nvar REPZ_11_138 = 18;\n/* repeat a zero length 11-138 times  (7 bits of repeat count) */\n\n/* eslint-disable comma-spacing,array-bracket-spacing */\nvar extra_lbits =   /* extra bits for each length code */\n  [0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];\n\nvar extra_dbits =   /* extra bits for each distance code */\n  [0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];\n\nvar extra_blbits =  /* extra bits for each bit length code */\n  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];\n\nvar bl_order =\n  [16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];\n/* eslint-enable comma-spacing,array-bracket-spacing */\n\n/* The lengths of the bit length codes are sent in order of decreasing\n * probability, to avoid transmitting the lengths for unused bit length codes.\n */\n\n/* ===========================================================================\n * Local data. These are initialized only once.\n */\n\n// We pre-fill arrays with 0 to avoid uninitialized gaps\n\nvar DIST_CODE_LEN = 512; /* see definition of array dist_code below */\n\n// !!!! Use flat array instead of structure, Freq = i*2, Len = i*2+1\nvar static_ltree  = new Array((L_CODES + 2) * 2);\nzero(static_ltree);\n/* The static literal tree. Since the bit lengths are imposed, there is no\n * need for the L_CODES extra codes used during heap construction. However\n * The codes 286 and 287 are needed to build a canonical tree (see _tr_init\n * below).\n */\n\nvar static_dtree  = new Array(D_CODES * 2);\nzero(static_dtree);\n/* The static distance tree. (Actually a trivial tree since all codes use\n * 5 bits.)\n */\n\nvar _dist_code    = new Array(DIST_CODE_LEN);\nzero(_dist_code);\n/* Distance codes. The first 256 values correspond to the distances\n * 3 .. 258, the last 256 values correspond to the top 8 bits of\n * the 15 bit distances.\n */\n\nvar _length_code  = new Array(MAX_MATCH - MIN_MATCH + 1);\nzero(_length_code);\n/* length code for each normalized match length (0 == MIN_MATCH) */\n\nvar base_length   = new Array(LENGTH_CODES);\nzero(base_length);\n/* First normalized length for each code (0 = MIN_MATCH) */\n\nvar base_dist     = new Array(D_CODES);\nzero(base_dist);\n/* First normalized distance for each code (0 = distance of 1) */\n\n\nfunction StaticTreeDesc(static_tree, extra_bits, extra_base, elems, max_length) {\n\n  this.static_tree  = static_tree;  /* static tree or NULL */\n  this.extra_bits   = extra_bits;   /* extra bits for each code or NULL */\n  this.extra_base   = extra_base;   /* base index for extra_bits */\n  this.elems        = elems;        /* max number of elements in the tree */\n  this.max_length   = max_length;   /* max bit length for the codes */\n\n  // show if `static_tree` has data or dummy - needed for monomorphic objects\n  this.has_stree    = static_tree && static_tree.length;\n}\n\n\nvar static_l_desc;\nvar static_d_desc;\nvar static_bl_desc;\n\n\nfunction TreeDesc(dyn_tree, stat_desc) {\n  this.dyn_tree = dyn_tree;     /* the dynamic tree */\n  this.max_code = 0;            /* largest code with non zero frequency */\n  this.stat_desc = stat_desc;   /* the corresponding static tree */\n}\n\n\n\nfunction d_code(dist) {\n  return dist < 256 ? _dist_code[dist] : _dist_code[256 + (dist >>> 7)];\n}\n\n\n/* ===========================================================================\n * Output a short LSB first on the stream.\n * IN assertion: there is enough room in pendingBuf.\n */\nfunction put_short(s, w) {\n//    put_byte(s, (uch)((w) & 0xff));\n//    put_byte(s, (uch)((ush)(w) >> 8));\n  s.pending_buf[s.pending++] = (w) & 0xff;\n  s.pending_buf[s.pending++] = (w >>> 8) & 0xff;\n}\n\n\n/* ===========================================================================\n * Send a value on a given number of bits.\n * IN assertion: length <= 16 and value fits in length bits.\n */\nfunction send_bits(s, value, length) {\n  if (s.bi_valid > (Buf_size - length)) {\n    s.bi_buf |= (value << s.bi_valid) & 0xffff;\n    put_short(s, s.bi_buf);\n    s.bi_buf = value >> (Buf_size - s.bi_valid);\n    s.bi_valid += length - Buf_size;\n  } else {\n    s.bi_buf |= (value << s.bi_valid) & 0xffff;\n    s.bi_valid += length;\n  }\n}\n\n\nfunction send_code(s, c, tree) {\n  send_bits(s, tree[c * 2]/*.Code*/, tree[c * 2 + 1]/*.Len*/);\n}\n\n\n/* ===========================================================================\n * Reverse the first len bits of a code, using straightforward code (a faster\n * method would use a table)\n * IN assertion: 1 <= len <= 15\n */\nfunction bi_reverse(code, len) {\n  var res = 0;\n  do {\n    res |= code & 1;\n    code >>>= 1;\n    res <<= 1;\n  } while (--len > 0);\n  return res >>> 1;\n}\n\n\n/* ===========================================================================\n * Flush the bit buffer, keeping at most 7 bits in it.\n */\nfunction bi_flush(s) {\n  if (s.bi_valid === 16) {\n    put_short(s, s.bi_buf);\n    s.bi_buf = 0;\n    s.bi_valid = 0;\n\n  } else if (s.bi_valid >= 8) {\n    s.pending_buf[s.pending++] = s.bi_buf & 0xff;\n    s.bi_buf >>= 8;\n    s.bi_valid -= 8;\n  }\n}\n\n\n/* ===========================================================================\n * Compute the optimal bit lengths for a tree and update the total bit length\n * for the current block.\n * IN assertion: the fields freq and dad are set, heap[heap_max] and\n *    above are the tree nodes sorted by increasing frequency.\n * OUT assertions: the field len is set to the optimal bit length, the\n *     array bl_count contains the frequencies for each bit length.\n *     The length opt_len is updated; static_len is also updated if stree is\n *     not null.\n */\nfunction gen_bitlen(s, desc)\n//    deflate_state *s;\n//    tree_desc *desc;    /* the tree descriptor */\n{\n  var tree            = desc.dyn_tree;\n  var max_code        = desc.max_code;\n  var stree           = desc.stat_desc.static_tree;\n  var has_stree       = desc.stat_desc.has_stree;\n  var extra           = desc.stat_desc.extra_bits;\n  var base            = desc.stat_desc.extra_base;\n  var max_length      = desc.stat_desc.max_length;\n  var h;              /* heap index */\n  var n, m;           /* iterate over the tree elements */\n  var bits;           /* bit length */\n  var xbits;          /* extra bits */\n  var f;              /* frequency */\n  var overflow = 0;   /* number of elements with bit length too large */\n\n  for (bits = 0; bits <= MAX_BITS; bits++) {\n    s.bl_count[bits] = 0;\n  }\n\n  /* In a first pass, compute the optimal bit lengths (which may\n   * overflow in the case of the bit length tree).\n   */\n  tree[s.heap[s.heap_max] * 2 + 1]/*.Len*/ = 0; /* root of the heap */\n\n  for (h = s.heap_max + 1; h < HEAP_SIZE; h++) {\n    n = s.heap[h];\n    bits = tree[tree[n * 2 + 1]/*.Dad*/ * 2 + 1]/*.Len*/ + 1;\n    if (bits > max_length) {\n      bits = max_length;\n      overflow++;\n    }\n    tree[n * 2 + 1]/*.Len*/ = bits;\n    /* We overwrite tree[n].Dad which is no longer needed */\n\n    if (n > max_code) { continue; } /* not a leaf node */\n\n    s.bl_count[bits]++;\n    xbits = 0;\n    if (n >= base) {\n      xbits = extra[n - base];\n    }\n    f = tree[n * 2]/*.Freq*/;\n    s.opt_len += f * (bits + xbits);\n    if (has_stree) {\n      s.static_len += f * (stree[n * 2 + 1]/*.Len*/ + xbits);\n    }\n  }\n  if (overflow === 0) { return; }\n\n  // Trace((stderr,\"\\nbit length overflow\\n\"));\n  /* This happens for example on obj2 and pic of the Calgary corpus */\n\n  /* Find the first bit length which could increase: */\n  do {\n    bits = max_length - 1;\n    while (s.bl_count[bits] === 0) { bits--; }\n    s.bl_count[bits]--;      /* move one leaf down the tree */\n    s.bl_count[bits + 1] += 2; /* move one overflow item as its brother */\n    s.bl_count[max_length]--;\n    /* The brother of the overflow item also moves one step up,\n     * but this does not affect bl_count[max_length]\n     */\n    overflow -= 2;\n  } while (overflow > 0);\n\n  /* Now recompute all bit lengths, scanning in increasing frequency.\n   * h is still equal to HEAP_SIZE. (It is simpler to reconstruct all\n   * lengths instead of fixing only the wrong ones. This idea is taken\n   * from 'ar' written by Haruhiko Okumura.)\n   */\n  for (bits = max_length; bits !== 0; bits--) {\n    n = s.bl_count[bits];\n    while (n !== 0) {\n      m = s.heap[--h];\n      if (m > max_code) { continue; }\n      if (tree[m * 2 + 1]/*.Len*/ !== bits) {\n        // Trace((stderr,\"code %d bits %d->%d\\n\", m, tree[m].Len, bits));\n        s.opt_len += (bits - tree[m * 2 + 1]/*.Len*/) * tree[m * 2]/*.Freq*/;\n        tree[m * 2 + 1]/*.Len*/ = bits;\n      }\n      n--;\n    }\n  }\n}\n\n\n/* ===========================================================================\n * Generate the codes for a given tree and bit counts (which need not be\n * optimal).\n * IN assertion: the array bl_count contains the bit length statistics for\n * the given tree and the field len is set for all tree elements.\n * OUT assertion: the field code is set for all tree elements of non\n *     zero code length.\n */\nfunction gen_codes(tree, max_code, bl_count)\n//    ct_data *tree;             /* the tree to decorate */\n//    int max_code;              /* largest code with non zero frequency */\n//    ushf *bl_count;            /* number of codes at each bit length */\n{\n  var next_code = new Array(MAX_BITS + 1); /* next code value for each bit length */\n  var code = 0;              /* running code value */\n  var bits;                  /* bit index */\n  var n;                     /* code index */\n\n  /* The distribution counts are first used to generate the code values\n   * without bit reversal.\n   */\n  for (bits = 1; bits <= MAX_BITS; bits++) {\n    next_code[bits] = code = (code + bl_count[bits - 1]) << 1;\n  }\n  /* Check that the bit counts in bl_count are consistent. The last code\n   * must be all ones.\n   */\n  //Assert (code + bl_count[MAX_BITS]-1 == (1<<MAX_BITS)-1,\n  //        \"inconsistent bit counts\");\n  //Tracev((stderr,\"\\ngen_codes: max_code %d \", max_code));\n\n  for (n = 0;  n <= max_code; n++) {\n    var len = tree[n * 2 + 1]/*.Len*/;\n    if (len === 0) { continue; }\n    /* Now reverse the bits */\n    tree[n * 2]/*.Code*/ = bi_reverse(next_code[len]++, len);\n\n    //Tracecv(tree != static_ltree, (stderr,\"\\nn %3d %c l %2d c %4x (%x) \",\n    //     n, (isgraph(n) ? n : ' '), len, tree[n].Code, next_code[len]-1));\n  }\n}\n\n\n/* ===========================================================================\n * Initialize the various 'constant' tables.\n */\nfunction tr_static_init() {\n  var n;        /* iterates over tree elements */\n  var bits;     /* bit counter */\n  var length;   /* length value */\n  var code;     /* code value */\n  var dist;     /* distance index */\n  var bl_count = new Array(MAX_BITS + 1);\n  /* number of codes at each bit length for an optimal tree */\n\n  // do check in _tr_init()\n  //if (static_init_done) return;\n\n  /* For some embedded targets, global variables are not initialized: */\n/*#ifdef NO_INIT_GLOBAL_POINTERS\n  static_l_desc.static_tree = static_ltree;\n  static_l_desc.extra_bits = extra_lbits;\n  static_d_desc.static_tree = static_dtree;\n  static_d_desc.extra_bits = extra_dbits;\n  static_bl_desc.extra_bits = extra_blbits;\n#endif*/\n\n  /* Initialize the mapping length (0..255) -> length code (0..28) */\n  length = 0;\n  for (code = 0; code < LENGTH_CODES - 1; code++) {\n    base_length[code] = length;\n    for (n = 0; n < (1 << extra_lbits[code]); n++) {\n      _length_code[length++] = code;\n    }\n  }\n  //Assert (length == 256, \"tr_static_init: length != 256\");\n  /* Note that the length 255 (match length 258) can be represented\n   * in two different ways: code 284 + 5 bits or code 285, so we\n   * overwrite length_code[255] to use the best encoding:\n   */\n  _length_code[length - 1] = code;\n\n  /* Initialize the mapping dist (0..32K) -> dist code (0..29) */\n  dist = 0;\n  for (code = 0; code < 16; code++) {\n    base_dist[code] = dist;\n    for (n = 0; n < (1 << extra_dbits[code]); n++) {\n      _dist_code[dist++] = code;\n    }\n  }\n  //Assert (dist == 256, \"tr_static_init: dist != 256\");\n  dist >>= 7; /* from now on, all distances are divided by 128 */\n  for (; code < D_CODES; code++) {\n    base_dist[code] = dist << 7;\n    for (n = 0; n < (1 << (extra_dbits[code] - 7)); n++) {\n      _dist_code[256 + dist++] = code;\n    }\n  }\n  //Assert (dist == 256, \"tr_static_init: 256+dist != 512\");\n\n  /* Construct the codes of the static literal tree */\n  for (bits = 0; bits <= MAX_BITS; bits++) {\n    bl_count[bits] = 0;\n  }\n\n  n = 0;\n  while (n <= 143) {\n    static_ltree[n * 2 + 1]/*.Len*/ = 8;\n    n++;\n    bl_count[8]++;\n  }\n  while (n <= 255) {\n    static_ltree[n * 2 + 1]/*.Len*/ = 9;\n    n++;\n    bl_count[9]++;\n  }\n  while (n <= 279) {\n    static_ltree[n * 2 + 1]/*.Len*/ = 7;\n    n++;\n    bl_count[7]++;\n  }\n  while (n <= 287) {\n    static_ltree[n * 2 + 1]/*.Len*/ = 8;\n    n++;\n    bl_count[8]++;\n  }\n  /* Codes 286 and 287 do not exist, but we must include them in the\n   * tree construction to get a canonical Huffman tree (longest code\n   * all ones)\n   */\n  gen_codes(static_ltree, L_CODES + 1, bl_count);\n\n  /* The static distance tree is trivial: */\n  for (n = 0; n < D_CODES; n++) {\n    static_dtree[n * 2 + 1]/*.Len*/ = 5;\n    static_dtree[n * 2]/*.Code*/ = bi_reverse(n, 5);\n  }\n\n  // Now data ready and we can init static trees\n  static_l_desc = new StaticTreeDesc(static_ltree, extra_lbits, LITERALS + 1, L_CODES, MAX_BITS);\n  static_d_desc = new StaticTreeDesc(static_dtree, extra_dbits, 0,          D_CODES, MAX_BITS);\n  static_bl_desc = new StaticTreeDesc(new Array(0), extra_blbits, 0,         BL_CODES, MAX_BL_BITS);\n\n  //static_init_done = true;\n}\n\n\n/* ===========================================================================\n * Initialize a new block.\n */\nfunction init_block(s) {\n  var n; /* iterates over tree elements */\n\n  /* Initialize the trees. */\n  for (n = 0; n < L_CODES;  n++) { s.dyn_ltree[n * 2]/*.Freq*/ = 0; }\n  for (n = 0; n < D_CODES;  n++) { s.dyn_dtree[n * 2]/*.Freq*/ = 0; }\n  for (n = 0; n < BL_CODES; n++) { s.bl_tree[n * 2]/*.Freq*/ = 0; }\n\n  s.dyn_ltree[END_BLOCK * 2]/*.Freq*/ = 1;\n  s.opt_len = s.static_len = 0;\n  s.last_lit = s.matches = 0;\n}\n\n\n/* ===========================================================================\n * Flush the bit buffer and align the output on a byte boundary\n */\nfunction bi_windup(s)\n{\n  if (s.bi_valid > 8) {\n    put_short(s, s.bi_buf);\n  } else if (s.bi_valid > 0) {\n    //put_byte(s, (Byte)s->bi_buf);\n    s.pending_buf[s.pending++] = s.bi_buf;\n  }\n  s.bi_buf = 0;\n  s.bi_valid = 0;\n}\n\n/* ===========================================================================\n * Copy a stored block, storing first the length and its\n * one's complement if requested.\n */\nfunction copy_block(s, buf, len, header)\n//DeflateState *s;\n//charf    *buf;    /* the input data */\n//unsigned len;     /* its length */\n//int      header;  /* true if block header must be written */\n{\n  bi_windup(s);        /* align on byte boundary */\n\n  if (header) {\n    put_short(s, len);\n    put_short(s, ~len);\n  }\n//  while (len--) {\n//    put_byte(s, *buf++);\n//  }\n  utils.arraySet(s.pending_buf, s.window, buf, len, s.pending);\n  s.pending += len;\n}\n\n/* ===========================================================================\n * Compares to subtrees, using the tree depth as tie breaker when\n * the subtrees have equal frequency. This minimizes the worst case length.\n */\nfunction smaller(tree, n, m, depth) {\n  var _n2 = n * 2;\n  var _m2 = m * 2;\n  return (tree[_n2]/*.Freq*/ < tree[_m2]/*.Freq*/ ||\n         (tree[_n2]/*.Freq*/ === tree[_m2]/*.Freq*/ && depth[n] <= depth[m]));\n}\n\n/* ===========================================================================\n * Restore the heap property by moving down the tree starting at node k,\n * exchanging a node with the smallest of its two sons if necessary, stopping\n * when the heap property is re-established (each father smaller than its\n * two sons).\n */\nfunction pqdownheap(s, tree, k)\n//    deflate_state *s;\n//    ct_data *tree;  /* the tree to restore */\n//    int k;               /* node to move down */\n{\n  var v = s.heap[k];\n  var j = k << 1;  /* left son of k */\n  while (j <= s.heap_len) {\n    /* Set j to the smallest of the two sons: */\n    if (j < s.heap_len &&\n      smaller(tree, s.heap[j + 1], s.heap[j], s.depth)) {\n      j++;\n    }\n    /* Exit if v is smaller than both sons */\n    if (smaller(tree, v, s.heap[j], s.depth)) { break; }\n\n    /* Exchange v with the smallest son */\n    s.heap[k] = s.heap[j];\n    k = j;\n\n    /* And continue down the tree, setting j to the left son of k */\n    j <<= 1;\n  }\n  s.heap[k] = v;\n}\n\n\n// inlined manually\n// var SMALLEST = 1;\n\n/* ===========================================================================\n * Send the block data compressed using the given Huffman trees\n */\nfunction compress_block(s, ltree, dtree)\n//    deflate_state *s;\n//    const ct_data *ltree; /* literal tree */\n//    const ct_data *dtree; /* distance tree */\n{\n  var dist;           /* distance of matched string */\n  var lc;             /* match length or unmatched char (if dist == 0) */\n  var lx = 0;         /* running index in l_buf */\n  var code;           /* the code to send */\n  var extra;          /* number of extra bits to send */\n\n  if (s.last_lit !== 0) {\n    do {\n      dist = (s.pending_buf[s.d_buf + lx * 2] << 8) | (s.pending_buf[s.d_buf + lx * 2 + 1]);\n      lc = s.pending_buf[s.l_buf + lx];\n      lx++;\n\n      if (dist === 0) {\n        send_code(s, lc, ltree); /* send a literal byte */\n        //Tracecv(isgraph(lc), (stderr,\" '%c' \", lc));\n      } else {\n        /* Here, lc is the match length - MIN_MATCH */\n        code = _length_code[lc];\n        send_code(s, code + LITERALS + 1, ltree); /* send the length code */\n        extra = extra_lbits[code];\n        if (extra !== 0) {\n          lc -= base_length[code];\n          send_bits(s, lc, extra);       /* send the extra length bits */\n        }\n        dist--; /* dist is now the match distance - 1 */\n        code = d_code(dist);\n        //Assert (code < D_CODES, \"bad d_code\");\n\n        send_code(s, code, dtree);       /* send the distance code */\n        extra = extra_dbits[code];\n        if (extra !== 0) {\n          dist -= base_dist[code];\n          send_bits(s, dist, extra);   /* send the extra distance bits */\n        }\n      } /* literal or match pair ? */\n\n      /* Check that the overlay between pending_buf and d_buf+l_buf is ok: */\n      //Assert((uInt)(s->pending) < s->lit_bufsize + 2*lx,\n      //       \"pendingBuf overflow\");\n\n    } while (lx < s.last_lit);\n  }\n\n  send_code(s, END_BLOCK, ltree);\n}\n\n\n/* ===========================================================================\n * Construct one Huffman tree and assigns the code bit strings and lengths.\n * Update the total bit length for the current block.\n * IN assertion: the field freq is set for all tree elements.\n * OUT assertions: the fields len and code are set to the optimal bit length\n *     and corresponding code. The length opt_len is updated; static_len is\n *     also updated if stree is not null. The field max_code is set.\n */\nfunction build_tree(s, desc)\n//    deflate_state *s;\n//    tree_desc *desc; /* the tree descriptor */\n{\n  var tree     = desc.dyn_tree;\n  var stree    = desc.stat_desc.static_tree;\n  var has_stree = desc.stat_desc.has_stree;\n  var elems    = desc.stat_desc.elems;\n  var n, m;          /* iterate over heap elements */\n  var max_code = -1; /* largest code with non zero frequency */\n  var node;          /* new node being created */\n\n  /* Construct the initial heap, with least frequent element in\n   * heap[SMALLEST]. The sons of heap[n] are heap[2*n] and heap[2*n+1].\n   * heap[0] is not used.\n   */\n  s.heap_len = 0;\n  s.heap_max = HEAP_SIZE;\n\n  for (n = 0; n < elems; n++) {\n    if (tree[n * 2]/*.Freq*/ !== 0) {\n      s.heap[++s.heap_len] = max_code = n;\n      s.depth[n] = 0;\n\n    } else {\n      tree[n * 2 + 1]/*.Len*/ = 0;\n    }\n  }\n\n  /* The pkzip format requires that at least one distance code exists,\n   * and that at least one bit should be sent even if there is only one\n   * possible code. So to avoid special checks later on we force at least\n   * two codes of non zero frequency.\n   */\n  while (s.heap_len < 2) {\n    node = s.heap[++s.heap_len] = (max_code < 2 ? ++max_code : 0);\n    tree[node * 2]/*.Freq*/ = 1;\n    s.depth[node] = 0;\n    s.opt_len--;\n\n    if (has_stree) {\n      s.static_len -= stree[node * 2 + 1]/*.Len*/;\n    }\n    /* node is 0 or 1 so it does not have extra bits */\n  }\n  desc.max_code = max_code;\n\n  /* The elements heap[heap_len/2+1 .. heap_len] are leaves of the tree,\n   * establish sub-heaps of increasing lengths:\n   */\n  for (n = (s.heap_len >> 1/*int /2*/); n >= 1; n--) { pqdownheap(s, tree, n); }\n\n  /* Construct the Huffman tree by repeatedly combining the least two\n   * frequent nodes.\n   */\n  node = elems;              /* next internal node of the tree */\n  do {\n    //pqremove(s, tree, n);  /* n = node of least frequency */\n    /*** pqremove ***/\n    n = s.heap[1/*SMALLEST*/];\n    s.heap[1/*SMALLEST*/] = s.heap[s.heap_len--];\n    pqdownheap(s, tree, 1/*SMALLEST*/);\n    /***/\n\n    m = s.heap[1/*SMALLEST*/]; /* m = node of next least frequency */\n\n    s.heap[--s.heap_max] = n; /* keep the nodes sorted by frequency */\n    s.heap[--s.heap_max] = m;\n\n    /* Create a new node father of n and m */\n    tree[node * 2]/*.Freq*/ = tree[n * 2]/*.Freq*/ + tree[m * 2]/*.Freq*/;\n    s.depth[node] = (s.depth[n] >= s.depth[m] ? s.depth[n] : s.depth[m]) + 1;\n    tree[n * 2 + 1]/*.Dad*/ = tree[m * 2 + 1]/*.Dad*/ = node;\n\n    /* and insert the new node in the heap */\n    s.heap[1/*SMALLEST*/] = node++;\n    pqdownheap(s, tree, 1/*SMALLEST*/);\n\n  } while (s.heap_len >= 2);\n\n  s.heap[--s.heap_max] = s.heap[1/*SMALLEST*/];\n\n  /* At this point, the fields freq and dad are set. We can now\n   * generate the bit lengths.\n   */\n  gen_bitlen(s, desc);\n\n  /* The field len is now set, we can generate the bit codes */\n  gen_codes(tree, max_code, s.bl_count);\n}\n\n\n/* ===========================================================================\n * Scan a literal or distance tree to determine the frequencies of the codes\n * in the bit length tree.\n */\nfunction scan_tree(s, tree, max_code)\n//    deflate_state *s;\n//    ct_data *tree;   /* the tree to be scanned */\n//    int max_code;    /* and its largest code of non zero frequency */\n{\n  var n;                     /* iterates over all tree elements */\n  var prevlen = -1;          /* last emitted length */\n  var curlen;                /* length of current code */\n\n  var nextlen = tree[0 * 2 + 1]/*.Len*/; /* length of next code */\n\n  var count = 0;             /* repeat count of the current code */\n  var max_count = 7;         /* max repeat count */\n  var min_count = 4;         /* min repeat count */\n\n  if (nextlen === 0) {\n    max_count = 138;\n    min_count = 3;\n  }\n  tree[(max_code + 1) * 2 + 1]/*.Len*/ = 0xffff; /* guard */\n\n  for (n = 0; n <= max_code; n++) {\n    curlen = nextlen;\n    nextlen = tree[(n + 1) * 2 + 1]/*.Len*/;\n\n    if (++count < max_count && curlen === nextlen) {\n      continue;\n\n    } else if (count < min_count) {\n      s.bl_tree[curlen * 2]/*.Freq*/ += count;\n\n    } else if (curlen !== 0) {\n\n      if (curlen !== prevlen) { s.bl_tree[curlen * 2]/*.Freq*/++; }\n      s.bl_tree[REP_3_6 * 2]/*.Freq*/++;\n\n    } else if (count <= 10) {\n      s.bl_tree[REPZ_3_10 * 2]/*.Freq*/++;\n\n    } else {\n      s.bl_tree[REPZ_11_138 * 2]/*.Freq*/++;\n    }\n\n    count = 0;\n    prevlen = curlen;\n\n    if (nextlen === 0) {\n      max_count = 138;\n      min_count = 3;\n\n    } else if (curlen === nextlen) {\n      max_count = 6;\n      min_count = 3;\n\n    } else {\n      max_count = 7;\n      min_count = 4;\n    }\n  }\n}\n\n\n/* ===========================================================================\n * Send a literal or distance tree in compressed form, using the codes in\n * bl_tree.\n */\nfunction send_tree(s, tree, max_code)\n//    deflate_state *s;\n//    ct_data *tree; /* the tree to be scanned */\n//    int max_code;       /* and its largest code of non zero frequency */\n{\n  var n;                     /* iterates over all tree elements */\n  var prevlen = -1;          /* last emitted length */\n  var curlen;                /* length of current code */\n\n  var nextlen = tree[0 * 2 + 1]/*.Len*/; /* length of next code */\n\n  var count = 0;             /* repeat count of the current code */\n  var max_count = 7;         /* max repeat count */\n  var min_count = 4;         /* min repeat count */\n\n  /* tree[max_code+1].Len = -1; */  /* guard already set */\n  if (nextlen === 0) {\n    max_count = 138;\n    min_count = 3;\n  }\n\n  for (n = 0; n <= max_code; n++) {\n    curlen = nextlen;\n    nextlen = tree[(n + 1) * 2 + 1]/*.Len*/;\n\n    if (++count < max_count && curlen === nextlen) {\n      continue;\n\n    } else if (count < min_count) {\n      do { send_code(s, curlen, s.bl_tree); } while (--count !== 0);\n\n    } else if (curlen !== 0) {\n      if (curlen !== prevlen) {\n        send_code(s, curlen, s.bl_tree);\n        count--;\n      }\n      //Assert(count >= 3 && count <= 6, \" 3_6?\");\n      send_code(s, REP_3_6, s.bl_tree);\n      send_bits(s, count - 3, 2);\n\n    } else if (count <= 10) {\n      send_code(s, REPZ_3_10, s.bl_tree);\n      send_bits(s, count - 3, 3);\n\n    } else {\n      send_code(s, REPZ_11_138, s.bl_tree);\n      send_bits(s, count - 11, 7);\n    }\n\n    count = 0;\n    prevlen = curlen;\n    if (nextlen === 0) {\n      max_count = 138;\n      min_count = 3;\n\n    } else if (curlen === nextlen) {\n      max_count = 6;\n      min_count = 3;\n\n    } else {\n      max_count = 7;\n      min_count = 4;\n    }\n  }\n}\n\n\n/* ===========================================================================\n * Construct the Huffman tree for the bit lengths and return the index in\n * bl_order of the last bit length code to send.\n */\nfunction build_bl_tree(s) {\n  var max_blindex;  /* index of last bit length code of non zero freq */\n\n  /* Determine the bit length frequencies for literal and distance trees */\n  scan_tree(s, s.dyn_ltree, s.l_desc.max_code);\n  scan_tree(s, s.dyn_dtree, s.d_desc.max_code);\n\n  /* Build the bit length tree: */\n  build_tree(s, s.bl_desc);\n  /* opt_len now includes the length of the tree representations, except\n   * the lengths of the bit lengths codes and the 5+5+4 bits for the counts.\n   */\n\n  /* Determine the number of bit length codes to send. The pkzip format\n   * requires that at least 4 bit length codes be sent. (appnote.txt says\n   * 3 but the actual value used is 4.)\n   */\n  for (max_blindex = BL_CODES - 1; max_blindex >= 3; max_blindex--) {\n    if (s.bl_tree[bl_order[max_blindex] * 2 + 1]/*.Len*/ !== 0) {\n      break;\n    }\n  }\n  /* Update opt_len to include the bit length tree and counts */\n  s.opt_len += 3 * (max_blindex + 1) + 5 + 5 + 4;\n  //Tracev((stderr, \"\\ndyn trees: dyn %ld, stat %ld\",\n  //        s->opt_len, s->static_len));\n\n  return max_blindex;\n}\n\n\n/* ===========================================================================\n * Send the header for a block using dynamic Huffman trees: the counts, the\n * lengths of the bit length codes, the literal tree and the distance tree.\n * IN assertion: lcodes >= 257, dcodes >= 1, blcodes >= 4.\n */\nfunction send_all_trees(s, lcodes, dcodes, blcodes)\n//    deflate_state *s;\n//    int lcodes, dcodes, blcodes; /* number of codes for each tree */\n{\n  var rank;                    /* index in bl_order */\n\n  //Assert (lcodes >= 257 && dcodes >= 1 && blcodes >= 4, \"not enough codes\");\n  //Assert (lcodes <= L_CODES && dcodes <= D_CODES && blcodes <= BL_CODES,\n  //        \"too many codes\");\n  //Tracev((stderr, \"\\nbl counts: \"));\n  send_bits(s, lcodes - 257, 5); /* not +255 as stated in appnote.txt */\n  send_bits(s, dcodes - 1,   5);\n  send_bits(s, blcodes - 4,  4); /* not -3 as stated in appnote.txt */\n  for (rank = 0; rank < blcodes; rank++) {\n    //Tracev((stderr, \"\\nbl code %2d \", bl_order[rank]));\n    send_bits(s, s.bl_tree[bl_order[rank] * 2 + 1]/*.Len*/, 3);\n  }\n  //Tracev((stderr, \"\\nbl tree: sent %ld\", s->bits_sent));\n\n  send_tree(s, s.dyn_ltree, lcodes - 1); /* literal tree */\n  //Tracev((stderr, \"\\nlit tree: sent %ld\", s->bits_sent));\n\n  send_tree(s, s.dyn_dtree, dcodes - 1); /* distance tree */\n  //Tracev((stderr, \"\\ndist tree: sent %ld\", s->bits_sent));\n}\n\n\n/* ===========================================================================\n * Check if the data type is TEXT or BINARY, using the following algorithm:\n * - TEXT if the two conditions below are satisfied:\n *    a) There are no non-portable control characters belonging to the\n *       \"black list\" (0..6, 14..25, 28..31).\n *    b) There is at least one printable character belonging to the\n *       \"white list\" (9 {TAB}, 10 {LF}, 13 {CR}, 32..255).\n * - BINARY otherwise.\n * - The following partially-portable control characters form a\n *   \"gray list\" that is ignored in this detection algorithm:\n *   (7 {BEL}, 8 {BS}, 11 {VT}, 12 {FF}, 26 {SUB}, 27 {ESC}).\n * IN assertion: the fields Freq of dyn_ltree are set.\n */\nfunction detect_data_type(s) {\n  /* black_mask is the bit mask of black-listed bytes\n   * set bits 0..6, 14..25, and 28..31\n   * 0xf3ffc07f = binary 11110011111111111100000001111111\n   */\n  var black_mask = 0xf3ffc07f;\n  var n;\n\n  /* Check for non-textual (\"black-listed\") bytes. */\n  for (n = 0; n <= 31; n++, black_mask >>>= 1) {\n    if ((black_mask & 1) && (s.dyn_ltree[n * 2]/*.Freq*/ !== 0)) {\n      return Z_BINARY;\n    }\n  }\n\n  /* Check for textual (\"white-listed\") bytes. */\n  if (s.dyn_ltree[9 * 2]/*.Freq*/ !== 0 || s.dyn_ltree[10 * 2]/*.Freq*/ !== 0 ||\n      s.dyn_ltree[13 * 2]/*.Freq*/ !== 0) {\n    return Z_TEXT;\n  }\n  for (n = 32; n < LITERALS; n++) {\n    if (s.dyn_ltree[n * 2]/*.Freq*/ !== 0) {\n      return Z_TEXT;\n    }\n  }\n\n  /* There are no \"black-listed\" or \"white-listed\" bytes:\n   * this stream either is empty or has tolerated (\"gray-listed\") bytes only.\n   */\n  return Z_BINARY;\n}\n\n\nvar static_init_done = false;\n\n/* ===========================================================================\n * Initialize the tree data structures for a new zlib stream.\n */\nfunction _tr_init(s)\n{\n\n  if (!static_init_done) {\n    tr_static_init();\n    static_init_done = true;\n  }\n\n  s.l_desc  = new TreeDesc(s.dyn_ltree, static_l_desc);\n  s.d_desc  = new TreeDesc(s.dyn_dtree, static_d_desc);\n  s.bl_desc = new TreeDesc(s.bl_tree, static_bl_desc);\n\n  s.bi_buf = 0;\n  s.bi_valid = 0;\n\n  /* Initialize the first block of the first file: */\n  init_block(s);\n}\n\n\n/* ===========================================================================\n * Send a stored block\n */\nfunction _tr_stored_block(s, buf, stored_len, last)\n//DeflateState *s;\n//charf *buf;       /* input block */\n//ulg stored_len;   /* length of input block */\n//int last;         /* one if this is the last block for a file */\n{\n  send_bits(s, (STORED_BLOCK << 1) + (last ? 1 : 0), 3);    /* send block type */\n  copy_block(s, buf, stored_len, true); /* with header */\n}\n\n\n/* ===========================================================================\n * Send one empty static block to give enough lookahead for inflate.\n * This takes 10 bits, of which 7 may remain in the bit buffer.\n */\nfunction _tr_align(s) {\n  send_bits(s, STATIC_TREES << 1, 3);\n  send_code(s, END_BLOCK, static_ltree);\n  bi_flush(s);\n}\n\n\n/* ===========================================================================\n * Determine the best encoding for the current block: dynamic trees, static\n * trees or store, and output the encoded block to the zip file.\n */\nfunction _tr_flush_block(s, buf, stored_len, last)\n//DeflateState *s;\n//charf *buf;       /* input block, or NULL if too old */\n//ulg stored_len;   /* length of input block */\n//int last;         /* one if this is the last block for a file */\n{\n  var opt_lenb, static_lenb;  /* opt_len and static_len in bytes */\n  var max_blindex = 0;        /* index of last bit length code of non zero freq */\n\n  /* Build the Huffman trees unless a stored block is forced */\n  if (s.level > 0) {\n\n    /* Check if the file is binary or text */\n    if (s.strm.data_type === Z_UNKNOWN) {\n      s.strm.data_type = detect_data_type(s);\n    }\n\n    /* Construct the literal and distance trees */\n    build_tree(s, s.l_desc);\n    // Tracev((stderr, \"\\nlit data: dyn %ld, stat %ld\", s->opt_len,\n    //        s->static_len));\n\n    build_tree(s, s.d_desc);\n    // Tracev((stderr, \"\\ndist data: dyn %ld, stat %ld\", s->opt_len,\n    //        s->static_len));\n    /* At this point, opt_len and static_len are the total bit lengths of\n     * the compressed block data, excluding the tree representations.\n     */\n\n    /* Build the bit length tree for the above two trees, and get the index\n     * in bl_order of the last bit length code to send.\n     */\n    max_blindex = build_bl_tree(s);\n\n    /* Determine the best encoding. Compute the block lengths in bytes. */\n    opt_lenb = (s.opt_len + 3 + 7) >>> 3;\n    static_lenb = (s.static_len + 3 + 7) >>> 3;\n\n    // Tracev((stderr, \"\\nopt %lu(%lu) stat %lu(%lu) stored %lu lit %u \",\n    //        opt_lenb, s->opt_len, static_lenb, s->static_len, stored_len,\n    //        s->last_lit));\n\n    if (static_lenb <= opt_lenb) { opt_lenb = static_lenb; }\n\n  } else {\n    // Assert(buf != (char*)0, \"lost buf\");\n    opt_lenb = static_lenb = stored_len + 5; /* force a stored block */\n  }\n\n  if ((stored_len + 4 <= opt_lenb) && (buf !== -1)) {\n    /* 4: two words for the lengths */\n\n    /* The test buf != NULL is only necessary if LIT_BUFSIZE > WSIZE.\n     * Otherwise we can't have processed more than WSIZE input bytes since\n     * the last block flush, because compression would have been\n     * successful. If LIT_BUFSIZE <= WSIZE, it is never too late to\n     * transform a block into a stored block.\n     */\n    _tr_stored_block(s, buf, stored_len, last);\n\n  } else if (s.strategy === Z_FIXED || static_lenb === opt_lenb) {\n\n    send_bits(s, (STATIC_TREES << 1) + (last ? 1 : 0), 3);\n    compress_block(s, static_ltree, static_dtree);\n\n  } else {\n    send_bits(s, (DYN_TREES << 1) + (last ? 1 : 0), 3);\n    send_all_trees(s, s.l_desc.max_code + 1, s.d_desc.max_code + 1, max_blindex + 1);\n    compress_block(s, s.dyn_ltree, s.dyn_dtree);\n  }\n  // Assert (s->compressed_len == s->bits_sent, \"bad compressed size\");\n  /* The above check is made mod 2^32, for files larger than 512 MB\n   * and uLong implemented on 32 bits.\n   */\n  init_block(s);\n\n  if (last) {\n    bi_windup(s);\n  }\n  // Tracev((stderr,\"\\ncomprlen %lu(%lu) \", s->compressed_len>>3,\n  //       s->compressed_len-7*last));\n}\n\n/* ===========================================================================\n * Save the match info and tally the frequency counts. Return true if\n * the current block must be flushed.\n */\nfunction _tr_tally(s, dist, lc)\n//    deflate_state *s;\n//    unsigned dist;  /* distance of matched string */\n//    unsigned lc;    /* match length-MIN_MATCH or unmatched char (if dist==0) */\n{\n  //var out_length, in_length, dcode;\n\n  s.pending_buf[s.d_buf + s.last_lit * 2]     = (dist >>> 8) & 0xff;\n  s.pending_buf[s.d_buf + s.last_lit * 2 + 1] = dist & 0xff;\n\n  s.pending_buf[s.l_buf + s.last_lit] = lc & 0xff;\n  s.last_lit++;\n\n  if (dist === 0) {\n    /* lc is the unmatched char */\n    s.dyn_ltree[lc * 2]/*.Freq*/++;\n  } else {\n    s.matches++;\n    /* Here, lc is the match length - MIN_MATCH */\n    dist--;             /* dist = match distance - 1 */\n    //Assert((ush)dist < (ush)MAX_DIST(s) &&\n    //       (ush)lc <= (ush)(MAX_MATCH-MIN_MATCH) &&\n    //       (ush)d_code(dist) < (ush)D_CODES,  \"_tr_tally: bad match\");\n\n    s.dyn_ltree[(_length_code[lc] + LITERALS + 1) * 2]/*.Freq*/++;\n    s.dyn_dtree[d_code(dist) * 2]/*.Freq*/++;\n  }\n\n// (!) This block is disabled in zlib defaults,\n// don't enable it for binary compatibility\n\n//#ifdef TRUNCATE_BLOCK\n//  /* Try to guess if it is profitable to stop the current block here */\n//  if ((s.last_lit & 0x1fff) === 0 && s.level > 2) {\n//    /* Compute an upper bound for the compressed length */\n//    out_length = s.last_lit*8;\n//    in_length = s.strstart - s.block_start;\n//\n//    for (dcode = 0; dcode < D_CODES; dcode++) {\n//      out_length += s.dyn_dtree[dcode*2]/*.Freq*/ * (5 + extra_dbits[dcode]);\n//    }\n//    out_length >>>= 3;\n//    //Tracev((stderr,\"\\nlast_lit %u, in %ld, out ~%ld(%ld%%) \",\n//    //       s->last_lit, in_length, out_length,\n//    //       100L - out_length*100L/in_length));\n//    if (s.matches < (s.last_lit>>1)/*int /2*/ && out_length < (in_length>>1)/*int /2*/) {\n//      return true;\n//    }\n//  }\n//#endif\n\n  return (s.last_lit === s.lit_bufsize - 1);\n  /* We avoid equality with lit_bufsize because of wraparound at 64K\n   * on 16 bit machines and because stored blocks are restricted to\n   * 64K-1 bytes.\n   */\n}\n\nexports._tr_init  = _tr_init;\nexports._tr_stored_block = _tr_stored_block;\nexports._tr_flush_block  = _tr_flush_block;\nexports._tr_tally = _tr_tally;\nexports._tr_align = _tr_align;\n","'use strict';\n\n// (C) 1995-2013 Jean-loup Gailly and Mark Adler\n// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin\n//\n// This software is provided 'as-is', without any express or implied\n// warranty. In no event will the authors be held liable for any damages\n// arising from the use of this software.\n//\n// Permission is granted to anyone to use this software for any purpose,\n// including commercial applications, and to alter it and redistribute it\n// freely, subject to the following restrictions:\n//\n// 1. The origin of this software must not be misrepresented; you must not\n//   claim that you wrote the original software. If you use this software\n//   in a product, an acknowledgment in the product documentation would be\n//   appreciated but is not required.\n// 2. Altered source versions must be plainly marked as such, and must not be\n//   misrepresented as being the original software.\n// 3. This notice may not be removed or altered from any source distribution.\n\nfunction ZStream() {\n  /* next input byte */\n  this.input = null; // JS specific, because we have no pointers\n  this.next_in = 0;\n  /* number of bytes available at input */\n  this.avail_in = 0;\n  /* total number of input bytes read so far */\n  this.total_in = 0;\n  /* next output byte should be put there */\n  this.output = null; // JS specific, because we have no pointers\n  this.next_out = 0;\n  /* remaining free space at output */\n  this.avail_out = 0;\n  /* total number of bytes output so far */\n  this.total_out = 0;\n  /* last error message, NULL if no error */\n  this.msg = ''/*Z_NULL*/;\n  /* not visible by applications */\n  this.state = null;\n  /* best guess about the data type: binary or text */\n  this.data_type = 2/*Z_UNKNOWN*/;\n  /* adler32 value of the uncompressed data */\n  this.adler = 0;\n}\n\nmodule.exports = ZStream;\n","module.exports = __WEBPACK_EXTERNAL_MODULE__418__;","if(typeof __WEBPACK_EXTERNAL_MODULE__185__ === 'undefined') { var e = new Error(\"Cannot find module 'jsdom'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE__185__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var util;\n(function (util) {\n    util.assertEqual = (val) => val;\n    function assertIs(_arg) { }\n    util.assertIs = assertIs;\n    function assertNever(_x) {\n        throw new Error();\n    }\n    util.assertNever = assertNever;\n    util.arrayToEnum = (items) => {\n        const obj = {};\n        for (const item of items) {\n            obj[item] = item;\n        }\n        return obj;\n    };\n    util.getValidEnumValues = (obj) => {\n        const validKeys = util.objectKeys(obj).filter((k) => typeof obj[obj[k]] !== \"number\");\n        const filtered = {};\n        for (const k of validKeys) {\n            filtered[k] = obj[k];\n        }\n        return util.objectValues(filtered);\n    };\n    util.objectValues = (obj) => {\n        return util.objectKeys(obj).map(function (e) {\n            return obj[e];\n        });\n    };\n    util.objectKeys = typeof Object.keys === \"function\" // eslint-disable-line ban/ban\n        ? (obj) => Object.keys(obj) // eslint-disable-line ban/ban\n        : (object) => {\n            const keys = [];\n            for (const key in object) {\n                if (Object.prototype.hasOwnProperty.call(object, key)) {\n                    keys.push(key);\n                }\n            }\n            return keys;\n        };\n    util.find = (arr, checker) => {\n        for (const item of arr) {\n            if (checker(item))\n                return item;\n        }\n        return undefined;\n    };\n    util.isInteger = typeof Number.isInteger === \"function\"\n        ? (val) => Number.isInteger(val) // eslint-disable-line ban/ban\n        : (val) => typeof val === \"number\" && isFinite(val) && Math.floor(val) === val;\n    function joinValues(array, separator = \" | \") {\n        return array\n            .map((val) => (typeof val === \"string\" ? `'${val}'` : val))\n            .join(separator);\n    }\n    util.joinValues = joinValues;\n    util.jsonStringifyReplacer = (_, value) => {\n        if (typeof value === \"bigint\") {\n            return value.toString();\n        }\n        return value;\n    };\n})(util || (util = {}));\nvar objectUtil;\n(function (objectUtil) {\n    objectUtil.mergeShapes = (first, second) => {\n        return {\n            ...first,\n            ...second, // second overwrites first\n        };\n    };\n})(objectUtil || (objectUtil = {}));\nconst ZodParsedType = util.arrayToEnum([\n    \"string\",\n    \"nan\",\n    \"number\",\n    \"integer\",\n    \"float\",\n    \"boolean\",\n    \"date\",\n    \"bigint\",\n    \"symbol\",\n    \"function\",\n    \"undefined\",\n    \"null\",\n    \"array\",\n    \"object\",\n    \"unknown\",\n    \"promise\",\n    \"void\",\n    \"never\",\n    \"map\",\n    \"set\",\n]);\nconst getParsedType = (data) => {\n    const t = typeof data;\n    switch (t) {\n        case \"undefined\":\n            return ZodParsedType.undefined;\n        case \"string\":\n            return ZodParsedType.string;\n        case \"number\":\n            return isNaN(data) ? ZodParsedType.nan : ZodParsedType.number;\n        case \"boolean\":\n            return ZodParsedType.boolean;\n        case \"function\":\n            return ZodParsedType.function;\n        case \"bigint\":\n            return ZodParsedType.bigint;\n        case \"symbol\":\n            return ZodParsedType.symbol;\n        case \"object\":\n            if (Array.isArray(data)) {\n                return ZodParsedType.array;\n            }\n            if (data === null) {\n                return ZodParsedType.null;\n            }\n            if (data.then &&\n                typeof data.then === \"function\" &&\n                data.catch &&\n                typeof data.catch === \"function\") {\n                return ZodParsedType.promise;\n            }\n            if (typeof Map !== \"undefined\" && data instanceof Map) {\n                return ZodParsedType.map;\n            }\n            if (typeof Set !== \"undefined\" && data instanceof Set) {\n                return ZodParsedType.set;\n            }\n            if (typeof Date !== \"undefined\" && data instanceof Date) {\n                return ZodParsedType.date;\n            }\n            return ZodParsedType.object;\n        default:\n            return ZodParsedType.unknown;\n    }\n};\n\nconst ZodIssueCode = util.arrayToEnum([\n    \"invalid_type\",\n    \"invalid_literal\",\n    \"custom\",\n    \"invalid_union\",\n    \"invalid_union_discriminator\",\n    \"invalid_enum_value\",\n    \"unrecognized_keys\",\n    \"invalid_arguments\",\n    \"invalid_return_type\",\n    \"invalid_date\",\n    \"invalid_string\",\n    \"too_small\",\n    \"too_big\",\n    \"invalid_intersection_types\",\n    \"not_multiple_of\",\n    \"not_finite\",\n]);\nconst quotelessJson = (obj) => {\n    const json = JSON.stringify(obj, null, 2);\n    return json.replace(/\"([^\"]+)\":/g, \"$1:\");\n};\nclass ZodError extends Error {\n    get errors() {\n        return this.issues;\n    }\n    constructor(issues) {\n        super();\n        this.issues = [];\n        this.addIssue = (sub) => {\n            this.issues = [...this.issues, sub];\n        };\n        this.addIssues = (subs = []) => {\n            this.issues = [...this.issues, ...subs];\n        };\n        const actualProto = new.target.prototype;\n        if (Object.setPrototypeOf) {\n            // eslint-disable-next-line ban/ban\n            Object.setPrototypeOf(this, actualProto);\n        }\n        else {\n            this.__proto__ = actualProto;\n        }\n        this.name = \"ZodError\";\n        this.issues = issues;\n    }\n    format(_mapper) {\n        const mapper = _mapper ||\n            function (issue) {\n                return issue.message;\n            };\n        const fieldErrors = { _errors: [] };\n        const processError = (error) => {\n            for (const issue of error.issues) {\n                if (issue.code === \"invalid_union\") {\n                    issue.unionErrors.map(processError);\n                }\n                else if (issue.code === \"invalid_return_type\") {\n                    processError(issue.returnTypeError);\n                }\n                else if (issue.code === \"invalid_arguments\") {\n                    processError(issue.argumentsError);\n                }\n                else if (issue.path.length === 0) {\n                    fieldErrors._errors.push(mapper(issue));\n                }\n                else {\n                    let curr = fieldErrors;\n                    let i = 0;\n                    while (i < issue.path.length) {\n                        const el = issue.path[i];\n                        const terminal = i === issue.path.length - 1;\n                        if (!terminal) {\n                            curr[el] = curr[el] || { _errors: [] };\n                            // if (typeof el === \"string\") {\n                            //   curr[el] = curr[el] || { _errors: [] };\n                            // } else if (typeof el === \"number\") {\n                            //   const errorArray: any = [];\n                            //   errorArray._errors = [];\n                            //   curr[el] = curr[el] || errorArray;\n                            // }\n                        }\n                        else {\n                            curr[el] = curr[el] || { _errors: [] };\n                            curr[el]._errors.push(mapper(issue));\n                        }\n                        curr = curr[el];\n                        i++;\n                    }\n                }\n            }\n        };\n        processError(this);\n        return fieldErrors;\n    }\n    static assert(value) {\n        if (!(value instanceof ZodError)) {\n            throw new Error(`Not a ZodError: ${value}`);\n        }\n    }\n    toString() {\n        return this.message;\n    }\n    get message() {\n        return JSON.stringify(this.issues, util.jsonStringifyReplacer, 2);\n    }\n    get isEmpty() {\n        return this.issues.length === 0;\n    }\n    flatten(mapper = (issue) => issue.message) {\n        const fieldErrors = {};\n        const formErrors = [];\n        for (const sub of this.issues) {\n            if (sub.path.length > 0) {\n                fieldErrors[sub.path[0]] = fieldErrors[sub.path[0]] || [];\n                fieldErrors[sub.path[0]].push(mapper(sub));\n            }\n            else {\n                formErrors.push(mapper(sub));\n            }\n        }\n        return { formErrors, fieldErrors };\n    }\n    get formErrors() {\n        return this.flatten();\n    }\n}\nZodError.create = (issues) => {\n    const error = new ZodError(issues);\n    return error;\n};\n\nconst errorMap = (issue, _ctx) => {\n    let message;\n    switch (issue.code) {\n        case ZodIssueCode.invalid_type:\n            if (issue.received === ZodParsedType.undefined) {\n                message = \"Required\";\n            }\n            else {\n                message = `Expected ${issue.expected}, received ${issue.received}`;\n            }\n            break;\n        case ZodIssueCode.invalid_literal:\n            message = `Invalid literal value, expected ${JSON.stringify(issue.expected, util.jsonStringifyReplacer)}`;\n            break;\n        case ZodIssueCode.unrecognized_keys:\n            message = `Unrecognized key(s) in object: ${util.joinValues(issue.keys, \", \")}`;\n            break;\n        case ZodIssueCode.invalid_union:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_union_discriminator:\n            message = `Invalid discriminator value. Expected ${util.joinValues(issue.options)}`;\n            break;\n        case ZodIssueCode.invalid_enum_value:\n            message = `Invalid enum value. Expected ${util.joinValues(issue.options)}, received '${issue.received}'`;\n            break;\n        case ZodIssueCode.invalid_arguments:\n            message = `Invalid function arguments`;\n            break;\n        case ZodIssueCode.invalid_return_type:\n            message = `Invalid function return type`;\n            break;\n        case ZodIssueCode.invalid_date:\n            message = `Invalid date`;\n            break;\n        case ZodIssueCode.invalid_string:\n            if (typeof issue.validation === \"object\") {\n                if (\"includes\" in issue.validation) {\n                    message = `Invalid input: must include \"${issue.validation.includes}\"`;\n                    if (typeof issue.validation.position === \"number\") {\n                        message = `${message} at one or more positions greater than or equal to ${issue.validation.position}`;\n                    }\n                }\n                else if (\"startsWith\" in issue.validation) {\n                    message = `Invalid input: must start with \"${issue.validation.startsWith}\"`;\n                }\n                else if (\"endsWith\" in issue.validation) {\n                    message = `Invalid input: must end with \"${issue.validation.endsWith}\"`;\n                }\n                else {\n                    util.assertNever(issue.validation);\n                }\n            }\n            else if (issue.validation !== \"regex\") {\n                message = `Invalid ${issue.validation}`;\n            }\n            else {\n                message = \"Invalid\";\n            }\n            break;\n        case ZodIssueCode.too_small:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `more than`} ${issue.minimum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `over`} ${issue.minimum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact\n                    ? `exactly equal to `\n                    : issue.inclusive\n                        ? `greater than or equal to `\n                        : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact\n                    ? `exactly equal to `\n                    : issue.inclusive\n                        ? `greater than or equal to `\n                        : `greater than `}${new Date(Number(issue.minimum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.too_big:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `less than`} ${issue.maximum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `under`} ${issue.maximum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact\n                    ? `exactly`\n                    : issue.inclusive\n                        ? `less than or equal to`\n                        : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"bigint\")\n                message = `BigInt must be ${issue.exact\n                    ? `exactly`\n                    : issue.inclusive\n                        ? `less than or equal to`\n                        : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact\n                    ? `exactly`\n                    : issue.inclusive\n                        ? `smaller than or equal to`\n                        : `smaller than`} ${new Date(Number(issue.maximum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.custom:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_intersection_types:\n            message = `Intersection results could not be merged`;\n            break;\n        case ZodIssueCode.not_multiple_of:\n            message = `Number must be a multiple of ${issue.multipleOf}`;\n            break;\n        case ZodIssueCode.not_finite:\n            message = \"Number must be finite\";\n            break;\n        default:\n            message = _ctx.defaultError;\n            util.assertNever(issue);\n    }\n    return { message };\n};\n\nlet overrideErrorMap = errorMap;\nfunction setErrorMap(map) {\n    overrideErrorMap = map;\n}\nfunction getErrorMap() {\n    return overrideErrorMap;\n}\n\nconst makeIssue = (params) => {\n    const { data, path, errorMaps, issueData } = params;\n    const fullPath = [...path, ...(issueData.path || [])];\n    const fullIssue = {\n        ...issueData,\n        path: fullPath,\n    };\n    if (issueData.message !== undefined) {\n        return {\n            ...issueData,\n            path: fullPath,\n            message: issueData.message,\n        };\n    }\n    let errorMessage = \"\";\n    const maps = errorMaps\n        .filter((m) => !!m)\n        .slice()\n        .reverse();\n    for (const map of maps) {\n        errorMessage = map(fullIssue, { data, defaultError: errorMessage }).message;\n    }\n    return {\n        ...issueData,\n        path: fullPath,\n        message: errorMessage,\n    };\n};\nconst EMPTY_PATH = [];\nfunction addIssueToContext(ctx, issueData) {\n    const overrideMap = getErrorMap();\n    const issue = makeIssue({\n        issueData: issueData,\n        data: ctx.data,\n        path: ctx.path,\n        errorMaps: [\n            ctx.common.contextualErrorMap, // contextual error map is first priority\n            ctx.schemaErrorMap, // then schema-bound map if available\n            overrideMap, // then global override map\n            overrideMap === errorMap ? undefined : errorMap, // then global default map\n        ].filter((x) => !!x),\n    });\n    ctx.common.issues.push(issue);\n}\nclass ParseStatus {\n    constructor() {\n        this.value = \"valid\";\n    }\n    dirty() {\n        if (this.value === \"valid\")\n            this.value = \"dirty\";\n    }\n    abort() {\n        if (this.value !== \"aborted\")\n            this.value = \"aborted\";\n    }\n    static mergeArray(status, results) {\n        const arrayValue = [];\n        for (const s of results) {\n            if (s.status === \"aborted\")\n                return INVALID;\n            if (s.status === \"dirty\")\n                status.dirty();\n            arrayValue.push(s.value);\n        }\n        return { status: status.value, value: arrayValue };\n    }\n    static async mergeObjectAsync(status, pairs) {\n        const syncPairs = [];\n        for (const pair of pairs) {\n            const key = await pair.key;\n            const value = await pair.value;\n            syncPairs.push({\n                key,\n                value,\n            });\n        }\n        return ParseStatus.mergeObjectSync(status, syncPairs);\n    }\n    static mergeObjectSync(status, pairs) {\n        const finalObject = {};\n        for (const pair of pairs) {\n            const { key, value } = pair;\n            if (key.status === \"aborted\")\n                return INVALID;\n            if (value.status === \"aborted\")\n                return INVALID;\n            if (key.status === \"dirty\")\n                status.dirty();\n            if (value.status === \"dirty\")\n                status.dirty();\n            if (key.value !== \"__proto__\" &&\n                (typeof value.value !== \"undefined\" || pair.alwaysSet)) {\n                finalObject[key.value] = value.value;\n            }\n        }\n        return { status: status.value, value: finalObject };\n    }\n}\nconst INVALID = Object.freeze({\n    status: \"aborted\",\n});\nconst DIRTY = (value) => ({ status: \"dirty\", value });\nconst OK = (value) => ({ status: \"valid\", value });\nconst isAborted = (x) => x.status === \"aborted\";\nconst isDirty = (x) => x.status === \"dirty\";\nconst isValid = (x) => x.status === \"valid\";\nconst isAsync = (x) => typeof Promise !== \"undefined\" && x instanceof Promise;\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nfunction __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nvar errorUtil;\n(function (errorUtil) {\n    errorUtil.errToObj = (message) => typeof message === \"string\" ? { message } : message || {};\n    errorUtil.toString = (message) => typeof message === \"string\" ? message : message === null || message === void 0 ? void 0 : message.message;\n})(errorUtil || (errorUtil = {}));\n\nvar _ZodEnum_cache, _ZodNativeEnum_cache;\nclass ParseInputLazyPath {\n    constructor(parent, value, path, key) {\n        this._cachedPath = [];\n        this.parent = parent;\n        this.data = value;\n        this._path = path;\n        this._key = key;\n    }\n    get path() {\n        if (!this._cachedPath.length) {\n            if (this._key instanceof Array) {\n                this._cachedPath.push(...this._path, ...this._key);\n            }\n            else {\n                this._cachedPath.push(...this._path, this._key);\n            }\n        }\n        return this._cachedPath;\n    }\n}\nconst handleResult = (ctx, result) => {\n    if (isValid(result)) {\n        return { success: true, data: result.value };\n    }\n    else {\n        if (!ctx.common.issues.length) {\n            throw new Error(\"Validation failed but no issues detected.\");\n        }\n        return {\n            success: false,\n            get error() {\n                if (this._error)\n                    return this._error;\n                const error = new ZodError(ctx.common.issues);\n                this._error = error;\n                return this._error;\n            },\n        };\n    }\n};\nfunction processCreateParams(params) {\n    if (!params)\n        return {};\n    const { errorMap, invalid_type_error, required_error, description } = params;\n    if (errorMap && (invalid_type_error || required_error)) {\n        throw new Error(`Can't use \"invalid_type_error\" or \"required_error\" in conjunction with custom error map.`);\n    }\n    if (errorMap)\n        return { errorMap: errorMap, description };\n    const customMap = (iss, ctx) => {\n        var _a, _b;\n        const { message } = params;\n        if (iss.code === \"invalid_enum_value\") {\n            return { message: message !== null && message !== void 0 ? message : ctx.defaultError };\n        }\n        if (typeof ctx.data === \"undefined\") {\n            return { message: (_a = message !== null && message !== void 0 ? message : required_error) !== null && _a !== void 0 ? _a : ctx.defaultError };\n        }\n        if (iss.code !== \"invalid_type\")\n            return { message: ctx.defaultError };\n        return { message: (_b = message !== null && message !== void 0 ? message : invalid_type_error) !== null && _b !== void 0 ? _b : ctx.defaultError };\n    };\n    return { errorMap: customMap, description };\n}\nclass ZodType {\n    get description() {\n        return this._def.description;\n    }\n    _getType(input) {\n        return getParsedType(input.data);\n    }\n    _getOrReturnCtx(input, ctx) {\n        return (ctx || {\n            common: input.parent.common,\n            data: input.data,\n            parsedType: getParsedType(input.data),\n            schemaErrorMap: this._def.errorMap,\n            path: input.path,\n            parent: input.parent,\n        });\n    }\n    _processInputParams(input) {\n        return {\n            status: new ParseStatus(),\n            ctx: {\n                common: input.parent.common,\n                data: input.data,\n                parsedType: getParsedType(input.data),\n                schemaErrorMap: this._def.errorMap,\n                path: input.path,\n                parent: input.parent,\n            },\n        };\n    }\n    _parseSync(input) {\n        const result = this._parse(input);\n        if (isAsync(result)) {\n            throw new Error(\"Synchronous parse encountered promise.\");\n        }\n        return result;\n    }\n    _parseAsync(input) {\n        const result = this._parse(input);\n        return Promise.resolve(result);\n    }\n    parse(data, params) {\n        const result = this.safeParse(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    safeParse(data, params) {\n        var _a;\n        const ctx = {\n            common: {\n                issues: [],\n                async: (_a = params === null || params === void 0 ? void 0 : params.async) !== null && _a !== void 0 ? _a : false,\n                contextualErrorMap: params === null || params === void 0 ? void 0 : params.errorMap,\n            },\n            path: (params === null || params === void 0 ? void 0 : params.path) || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const result = this._parseSync({ data, path: ctx.path, parent: ctx });\n        return handleResult(ctx, result);\n    }\n    \"~validate\"(data) {\n        var _a, _b;\n        const ctx = {\n            common: {\n                issues: [],\n                async: !!this[\"~standard\"].async,\n            },\n            path: [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        if (!this[\"~standard\"].async) {\n            try {\n                const result = this._parseSync({ data, path: [], parent: ctx });\n                return isValid(result)\n                    ? {\n                        value: result.value,\n                    }\n                    : {\n                        issues: ctx.common.issues,\n                    };\n            }\n            catch (err) {\n                if ((_b = (_a = err === null || err === void 0 ? void 0 : err.message) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === null || _b === void 0 ? void 0 : _b.includes(\"encountered\")) {\n                    this[\"~standard\"].async = true;\n                }\n                ctx.common = {\n                    issues: [],\n                    async: true,\n                };\n            }\n        }\n        return this._parseAsync({ data, path: [], parent: ctx }).then((result) => isValid(result)\n            ? {\n                value: result.value,\n            }\n            : {\n                issues: ctx.common.issues,\n            });\n    }\n    async parseAsync(data, params) {\n        const result = await this.safeParseAsync(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    async safeParseAsync(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                contextualErrorMap: params === null || params === void 0 ? void 0 : params.errorMap,\n                async: true,\n            },\n            path: (params === null || params === void 0 ? void 0 : params.path) || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const maybeAsyncResult = this._parse({ data, path: ctx.path, parent: ctx });\n        const result = await (isAsync(maybeAsyncResult)\n            ? maybeAsyncResult\n            : Promise.resolve(maybeAsyncResult));\n        return handleResult(ctx, result);\n    }\n    refine(check, message) {\n        const getIssueProperties = (val) => {\n            if (typeof message === \"string\" || typeof message === \"undefined\") {\n                return { message };\n            }\n            else if (typeof message === \"function\") {\n                return message(val);\n            }\n            else {\n                return message;\n            }\n        };\n        return this._refinement((val, ctx) => {\n            const result = check(val);\n            const setError = () => ctx.addIssue({\n                code: ZodIssueCode.custom,\n                ...getIssueProperties(val),\n            });\n            if (typeof Promise !== \"undefined\" && result instanceof Promise) {\n                return result.then((data) => {\n                    if (!data) {\n                        setError();\n                        return false;\n                    }\n                    else {\n                        return true;\n                    }\n                });\n            }\n            if (!result) {\n                setError();\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    refinement(check, refinementData) {\n        return this._refinement((val, ctx) => {\n            if (!check(val)) {\n                ctx.addIssue(typeof refinementData === \"function\"\n                    ? refinementData(val, ctx)\n                    : refinementData);\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    _refinement(refinement) {\n        return new ZodEffects({\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"refinement\", refinement },\n        });\n    }\n    superRefine(refinement) {\n        return this._refinement(refinement);\n    }\n    constructor(def) {\n        /** Alias of safeParseAsync */\n        this.spa = this.safeParseAsync;\n        this._def = def;\n        this.parse = this.parse.bind(this);\n        this.safeParse = this.safeParse.bind(this);\n        this.parseAsync = this.parseAsync.bind(this);\n        this.safeParseAsync = this.safeParseAsync.bind(this);\n        this.spa = this.spa.bind(this);\n        this.refine = this.refine.bind(this);\n        this.refinement = this.refinement.bind(this);\n        this.superRefine = this.superRefine.bind(this);\n        this.optional = this.optional.bind(this);\n        this.nullable = this.nullable.bind(this);\n        this.nullish = this.nullish.bind(this);\n        this.array = this.array.bind(this);\n        this.promise = this.promise.bind(this);\n        this.or = this.or.bind(this);\n        this.and = this.and.bind(this);\n        this.transform = this.transform.bind(this);\n        this.brand = this.brand.bind(this);\n        this.default = this.default.bind(this);\n        this.catch = this.catch.bind(this);\n        this.describe = this.describe.bind(this);\n        this.pipe = this.pipe.bind(this);\n        this.readonly = this.readonly.bind(this);\n        this.isNullable = this.isNullable.bind(this);\n        this.isOptional = this.isOptional.bind(this);\n        this[\"~standard\"] = {\n            version: 1,\n            vendor: \"zod\",\n            validate: (data) => this[\"~validate\"](data),\n        };\n    }\n    optional() {\n        return ZodOptional.create(this, this._def);\n    }\n    nullable() {\n        return ZodNullable.create(this, this._def);\n    }\n    nullish() {\n        return this.nullable().optional();\n    }\n    array() {\n        return ZodArray.create(this);\n    }\n    promise() {\n        return ZodPromise.create(this, this._def);\n    }\n    or(option) {\n        return ZodUnion.create([this, option], this._def);\n    }\n    and(incoming) {\n        return ZodIntersection.create(this, incoming, this._def);\n    }\n    transform(transform) {\n        return new ZodEffects({\n            ...processCreateParams(this._def),\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"transform\", transform },\n        });\n    }\n    default(def) {\n        const defaultValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodDefault({\n            ...processCreateParams(this._def),\n            innerType: this,\n            defaultValue: defaultValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodDefault,\n        });\n    }\n    brand() {\n        return new ZodBranded({\n            typeName: ZodFirstPartyTypeKind.ZodBranded,\n            type: this,\n            ...processCreateParams(this._def),\n        });\n    }\n    catch(def) {\n        const catchValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodCatch({\n            ...processCreateParams(this._def),\n            innerType: this,\n            catchValue: catchValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodCatch,\n        });\n    }\n    describe(description) {\n        const This = this.constructor;\n        return new This({\n            ...this._def,\n            description,\n        });\n    }\n    pipe(target) {\n        return ZodPipeline.create(this, target);\n    }\n    readonly() {\n        return ZodReadonly.create(this);\n    }\n    isOptional() {\n        return this.safeParse(undefined).success;\n    }\n    isNullable() {\n        return this.safeParse(null).success;\n    }\n}\nconst cuidRegex = /^c[^\\s-]{8,}$/i;\nconst cuid2Regex = /^[0-9a-z]+$/;\nconst ulidRegex = /^[0-9A-HJKMNP-TV-Z]{26}$/i;\n// const uuidRegex =\n//   /^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i;\nconst uuidRegex = /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/i;\nconst nanoidRegex = /^[a-z0-9_-]{21}$/i;\nconst jwtRegex = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]*$/;\nconst durationRegex = /^[-+]?P(?!$)(?:(?:[-+]?\\d+Y)|(?:[-+]?\\d+[.,]\\d+Y$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:(?:[-+]?\\d+W)|(?:[-+]?\\d+[.,]\\d+W$))?(?:(?:[-+]?\\d+D)|(?:[-+]?\\d+[.,]\\d+D$))?(?:T(?=[\\d+-])(?:(?:[-+]?\\d+H)|(?:[-+]?\\d+[.,]\\d+H$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:[-+]?\\d+(?:[.,]\\d+)?S)?)??$/;\n// from https://stackoverflow.com/a/46181/1550155\n// old version: too slow, didn't support unicode\n// const emailRegex = /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i;\n//old email regex\n// const emailRegex = /^(([^<>()[\\].,;:\\s@\"]+(\\.[^<>()[\\].,;:\\s@\"]+)*)|(\".+\"))@((?!-)([^<>()[\\].,;:\\s@\"]+\\.)+[^<>()[\\].,;:\\s@\"]{1,})[^-<>()[\\].,;:\\s@\"]$/i;\n// eslint-disable-next-line\n// const emailRegex =\n//   /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$/;\n// const emailRegex =\n//   /^[a-zA-Z0-9\\.\\!\\#\\$\\%\\&\\'\\*\\+\\/\\=\\?\\^\\_\\`\\{\\|\\}\\~\\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n// const emailRegex =\n//   /^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])$/i;\nconst emailRegex = /^(?!\\.)(?!.*\\.\\.)([A-Z0-9_'+\\-\\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\\-]*\\.)+[A-Z]{2,}$/i;\n// const emailRegex =\n//   /^[a-z0-9.!#$%&*+/=?^_`{|}~-]+@[a-z0-9-]+(?:\\.[a-z0-9\\-]+)*$/i;\n// from https://thekevinscott.com/emojis-in-javascript/#writing-a-regular-expression\nconst _emojiRegex = `^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$`;\nlet emojiRegex;\n// faster, simpler, safer\nconst ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/;\nconst ipv4CidrRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/(3[0-2]|[12]?[0-9])$/;\n// const ipv6Regex =\n// /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;\nconst ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;\nconst ipv6CidrRegex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/;\n// https://stackoverflow.com/questions/7860392/determine-if-string-is-in-base64-using-javascript\nconst base64Regex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n// https://base64.guru/standards/base64url\nconst base64urlRegex = /^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/;\n// simple\n// const dateRegexSource = `\\\\d{4}-\\\\d{2}-\\\\d{2}`;\n// no leap year validation\n// const dateRegexSource = `\\\\d{4}-((0[13578]|10|12)-31|(0[13-9]|1[0-2])-30|(0[1-9]|1[0-2])-(0[1-9]|1\\\\d|2\\\\d))`;\n// with leap year validation\nconst dateRegexSource = `((\\\\d\\\\d[2468][048]|\\\\d\\\\d[13579][26]|\\\\d\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\\\d|30)|(02)-(0[1-9]|1\\\\d|2[0-8])))`;\nconst dateRegex = new RegExp(`^${dateRegexSource}$`);\nfunction timeRegexSource(args) {\n    // let regex = `\\\\d{2}:\\\\d{2}:\\\\d{2}`;\n    let regex = `([01]\\\\d|2[0-3]):[0-5]\\\\d:[0-5]\\\\d`;\n    if (args.precision) {\n        regex = `${regex}\\\\.\\\\d{${args.precision}}`;\n    }\n    else if (args.precision == null) {\n        regex = `${regex}(\\\\.\\\\d+)?`;\n    }\n    return regex;\n}\nfunction timeRegex(args) {\n    return new RegExp(`^${timeRegexSource(args)}$`);\n}\n// Adapted from https://stackoverflow.com/a/3143231\nfunction datetimeRegex(args) {\n    let regex = `${dateRegexSource}T${timeRegexSource(args)}`;\n    const opts = [];\n    opts.push(args.local ? `Z?` : `Z`);\n    if (args.offset)\n        opts.push(`([+-]\\\\d{2}:?\\\\d{2})`);\n    regex = `${regex}(${opts.join(\"|\")})`;\n    return new RegExp(`^${regex}$`);\n}\nfunction isValidIP(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4Regex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6Regex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nfunction isValidJWT(jwt, alg) {\n    if (!jwtRegex.test(jwt))\n        return false;\n    try {\n        const [header] = jwt.split(\".\");\n        // Convert base64url to base64\n        const base64 = header\n            .replace(/-/g, \"+\")\n            .replace(/_/g, \"/\")\n            .padEnd(header.length + ((4 - (header.length % 4)) % 4), \"=\");\n        const decoded = JSON.parse(atob(base64));\n        if (typeof decoded !== \"object\" || decoded === null)\n            return false;\n        if (!decoded.typ || !decoded.alg)\n            return false;\n        if (alg && decoded.alg !== alg)\n            return false;\n        return true;\n    }\n    catch (_a) {\n        return false;\n    }\n}\nfunction isValidCidr(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4CidrRegex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6CidrRegex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nclass ZodString extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = String(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.string) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.string,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.length < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.length > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"length\") {\n                const tooBig = input.data.length > check.value;\n                const tooSmall = input.data.length < check.value;\n                if (tooBig || tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    if (tooBig) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_big,\n                            maximum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    else if (tooSmall) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_small,\n                            minimum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"email\") {\n                if (!emailRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"email\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"emoji\") {\n                if (!emojiRegex) {\n                    emojiRegex = new RegExp(_emojiRegex, \"u\");\n                }\n                if (!emojiRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"emoji\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"uuid\") {\n                if (!uuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"uuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"nanoid\") {\n                if (!nanoidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"nanoid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid\") {\n                if (!cuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid2\") {\n                if (!cuid2Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid2\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ulid\") {\n                if (!ulidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ulid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"url\") {\n                try {\n                    new URL(input.data);\n                }\n                catch (_a) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"regex\") {\n                check.regex.lastIndex = 0;\n                const testResult = check.regex.test(input.data);\n                if (!testResult) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"regex\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"trim\") {\n                input.data = input.data.trim();\n            }\n            else if (check.kind === \"includes\") {\n                if (!input.data.includes(check.value, check.position)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { includes: check.value, position: check.position },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"toLowerCase\") {\n                input.data = input.data.toLowerCase();\n            }\n            else if (check.kind === \"toUpperCase\") {\n                input.data = input.data.toUpperCase();\n            }\n            else if (check.kind === \"startsWith\") {\n                if (!input.data.startsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { startsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"endsWith\") {\n                if (!input.data.endsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { endsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"datetime\") {\n                const regex = datetimeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"datetime\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"date\") {\n                const regex = dateRegex;\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"date\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"time\") {\n                const regex = timeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"time\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"duration\") {\n                if (!durationRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"duration\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ip\") {\n                if (!isValidIP(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ip\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"jwt\") {\n                if (!isValidJWT(input.data, check.alg)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"jwt\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cidr\") {\n                if (!isValidCidr(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cidr\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64\") {\n                if (!base64Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64url\") {\n                if (!base64urlRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _regex(regex, validation, message) {\n        return this.refinement((data) => regex.test(data), {\n            validation,\n            code: ZodIssueCode.invalid_string,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    _addCheck(check) {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    email(message) {\n        return this._addCheck({ kind: \"email\", ...errorUtil.errToObj(message) });\n    }\n    url(message) {\n        return this._addCheck({ kind: \"url\", ...errorUtil.errToObj(message) });\n    }\n    emoji(message) {\n        return this._addCheck({ kind: \"emoji\", ...errorUtil.errToObj(message) });\n    }\n    uuid(message) {\n        return this._addCheck({ kind: \"uuid\", ...errorUtil.errToObj(message) });\n    }\n    nanoid(message) {\n        return this._addCheck({ kind: \"nanoid\", ...errorUtil.errToObj(message) });\n    }\n    cuid(message) {\n        return this._addCheck({ kind: \"cuid\", ...errorUtil.errToObj(message) });\n    }\n    cuid2(message) {\n        return this._addCheck({ kind: \"cuid2\", ...errorUtil.errToObj(message) });\n    }\n    ulid(message) {\n        return this._addCheck({ kind: \"ulid\", ...errorUtil.errToObj(message) });\n    }\n    base64(message) {\n        return this._addCheck({ kind: \"base64\", ...errorUtil.errToObj(message) });\n    }\n    base64url(message) {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return this._addCheck({\n            kind: \"base64url\",\n            ...errorUtil.errToObj(message),\n        });\n    }\n    jwt(options) {\n        return this._addCheck({ kind: \"jwt\", ...errorUtil.errToObj(options) });\n    }\n    ip(options) {\n        return this._addCheck({ kind: \"ip\", ...errorUtil.errToObj(options) });\n    }\n    cidr(options) {\n        return this._addCheck({ kind: \"cidr\", ...errorUtil.errToObj(options) });\n    }\n    datetime(options) {\n        var _a, _b;\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"datetime\",\n                precision: null,\n                offset: false,\n                local: false,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"datetime\",\n            precision: typeof (options === null || options === void 0 ? void 0 : options.precision) === \"undefined\" ? null : options === null || options === void 0 ? void 0 : options.precision,\n            offset: (_a = options === null || options === void 0 ? void 0 : options.offset) !== null && _a !== void 0 ? _a : false,\n            local: (_b = options === null || options === void 0 ? void 0 : options.local) !== null && _b !== void 0 ? _b : false,\n            ...errorUtil.errToObj(options === null || options === void 0 ? void 0 : options.message),\n        });\n    }\n    date(message) {\n        return this._addCheck({ kind: \"date\", message });\n    }\n    time(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"time\",\n                precision: null,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"time\",\n            precision: typeof (options === null || options === void 0 ? void 0 : options.precision) === \"undefined\" ? null : options === null || options === void 0 ? void 0 : options.precision,\n            ...errorUtil.errToObj(options === null || options === void 0 ? void 0 : options.message),\n        });\n    }\n    duration(message) {\n        return this._addCheck({ kind: \"duration\", ...errorUtil.errToObj(message) });\n    }\n    regex(regex, message) {\n        return this._addCheck({\n            kind: \"regex\",\n            regex: regex,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    includes(value, options) {\n        return this._addCheck({\n            kind: \"includes\",\n            value: value,\n            position: options === null || options === void 0 ? void 0 : options.position,\n            ...errorUtil.errToObj(options === null || options === void 0 ? void 0 : options.message),\n        });\n    }\n    startsWith(value, message) {\n        return this._addCheck({\n            kind: \"startsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    endsWith(value, message) {\n        return this._addCheck({\n            kind: \"endsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    min(minLength, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    max(maxLength, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    length(len, message) {\n        return this._addCheck({\n            kind: \"length\",\n            value: len,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    /**\n     * Equivalent to `.min(1)`\n     */\n    nonempty(message) {\n        return this.min(1, errorUtil.errToObj(message));\n    }\n    trim() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"trim\" }],\n        });\n    }\n    toLowerCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toLowerCase\" }],\n        });\n    }\n    toUpperCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toUpperCase\" }],\n        });\n    }\n    get isDatetime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"datetime\");\n    }\n    get isDate() {\n        return !!this._def.checks.find((ch) => ch.kind === \"date\");\n    }\n    get isTime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"time\");\n    }\n    get isDuration() {\n        return !!this._def.checks.find((ch) => ch.kind === \"duration\");\n    }\n    get isEmail() {\n        return !!this._def.checks.find((ch) => ch.kind === \"email\");\n    }\n    get isURL() {\n        return !!this._def.checks.find((ch) => ch.kind === \"url\");\n    }\n    get isEmoji() {\n        return !!this._def.checks.find((ch) => ch.kind === \"emoji\");\n    }\n    get isUUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"uuid\");\n    }\n    get isNANOID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"nanoid\");\n    }\n    get isCUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid\");\n    }\n    get isCUID2() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid2\");\n    }\n    get isULID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ulid\");\n    }\n    get isIP() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ip\");\n    }\n    get isCIDR() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cidr\");\n    }\n    get isBase64() {\n        return !!this._def.checks.find((ch) => ch.kind === \"base64\");\n    }\n    get isBase64url() {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return !!this._def.checks.find((ch) => ch.kind === \"base64url\");\n    }\n    get minLength() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxLength() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodString.create = (params) => {\n    var _a;\n    return new ZodString({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodString,\n        coerce: (_a = params === null || params === void 0 ? void 0 : params.coerce) !== null && _a !== void 0 ? _a : false,\n        ...processCreateParams(params),\n    });\n};\n// https://stackoverflow.com/questions/3966484/why-does-modulus-operator-return-fractional-number-in-javascript/31711034#31711034\nfunction floatSafeRemainder(val, step) {\n    const valDecCount = (val.toString().split(\".\")[1] || \"\").length;\n    const stepDecCount = (step.toString().split(\".\")[1] || \"\").length;\n    const decCount = valDecCount > stepDecCount ? valDecCount : stepDecCount;\n    const valInt = parseInt(val.toFixed(decCount).replace(\".\", \"\"));\n    const stepInt = parseInt(step.toFixed(decCount).replace(\".\", \"\"));\n    return (valInt % stepInt) / Math.pow(10, decCount);\n}\nclass ZodNumber extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n        this.step = this.multipleOf;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Number(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.number) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.number,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"int\") {\n                if (!util.isInteger(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_type,\n                        expected: \"integer\",\n                        received: \"float\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"min\") {\n                const tooSmall = check.inclusive\n                    ? input.data < check.value\n                    : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive\n                    ? input.data > check.value\n                    : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (floatSafeRemainder(input.data, check.value) !== 0) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"finite\") {\n                if (!Number.isFinite(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_finite,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    int(message) {\n        return this._addCheck({\n            kind: \"int\",\n            message: errorUtil.toString(message),\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value: value,\n            message: errorUtil.toString(message),\n        });\n    }\n    finite(message) {\n        return this._addCheck({\n            kind: \"finite\",\n            message: errorUtil.toString(message),\n        });\n    }\n    safe(message) {\n        return this._addCheck({\n            kind: \"min\",\n            inclusive: true,\n            value: Number.MIN_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        })._addCheck({\n            kind: \"max\",\n            inclusive: true,\n            value: Number.MAX_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n    get isInt() {\n        return !!this._def.checks.find((ch) => ch.kind === \"int\" ||\n            (ch.kind === \"multipleOf\" && util.isInteger(ch.value)));\n    }\n    get isFinite() {\n        let max = null, min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"finite\" ||\n                ch.kind === \"int\" ||\n                ch.kind === \"multipleOf\") {\n                return true;\n            }\n            else if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n            else if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return Number.isFinite(min) && Number.isFinite(max);\n    }\n}\nZodNumber.create = (params) => {\n    return new ZodNumber({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodNumber,\n        coerce: (params === null || params === void 0 ? void 0 : params.coerce) || false,\n        ...processCreateParams(params),\n    });\n};\nclass ZodBigInt extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            try {\n                input.data = BigInt(input.data);\n            }\n            catch (_a) {\n                return this._getInvalidInput(input);\n            }\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.bigint) {\n            return this._getInvalidInput(input);\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                const tooSmall = check.inclusive\n                    ? input.data < check.value\n                    : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        type: \"bigint\",\n                        minimum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive\n                    ? input.data > check.value\n                    : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        type: \"bigint\",\n                        maximum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (input.data % check.value !== BigInt(0)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _getInvalidInput(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.bigint,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodBigInt.create = (params) => {\n    var _a;\n    return new ZodBigInt({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodBigInt,\n        coerce: (_a = params === null || params === void 0 ? void 0 : params.coerce) !== null && _a !== void 0 ? _a : false,\n        ...processCreateParams(params),\n    });\n};\nclass ZodBoolean extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Boolean(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.boolean) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.boolean,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodBoolean.create = (params) => {\n    return new ZodBoolean({\n        typeName: ZodFirstPartyTypeKind.ZodBoolean,\n        coerce: (params === null || params === void 0 ? void 0 : params.coerce) || false,\n        ...processCreateParams(params),\n    });\n};\nclass ZodDate extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = new Date(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.date) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.date,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (isNaN(input.data.getTime())) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_date,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.getTime() < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        minimum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.getTime() > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        maximum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return {\n            status: status.value,\n            value: new Date(input.data.getTime()),\n        };\n    }\n    _addCheck(check) {\n        return new ZodDate({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    min(minDate, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    max(maxDate, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    get minDate() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min != null ? new Date(min) : null;\n    }\n    get maxDate() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max != null ? new Date(max) : null;\n    }\n}\nZodDate.create = (params) => {\n    return new ZodDate({\n        checks: [],\n        coerce: (params === null || params === void 0 ? void 0 : params.coerce) || false,\n        typeName: ZodFirstPartyTypeKind.ZodDate,\n        ...processCreateParams(params),\n    });\n};\nclass ZodSymbol extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.symbol) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.symbol,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodSymbol.create = (params) => {\n    return new ZodSymbol({\n        typeName: ZodFirstPartyTypeKind.ZodSymbol,\n        ...processCreateParams(params),\n    });\n};\nclass ZodUndefined extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.undefined,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodUndefined.create = (params) => {\n    return new ZodUndefined({\n        typeName: ZodFirstPartyTypeKind.ZodUndefined,\n        ...processCreateParams(params),\n    });\n};\nclass ZodNull extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.null) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.null,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodNull.create = (params) => {\n    return new ZodNull({\n        typeName: ZodFirstPartyTypeKind.ZodNull,\n        ...processCreateParams(params),\n    });\n};\nclass ZodAny extends ZodType {\n    constructor() {\n        super(...arguments);\n        // to prevent instances of other classes from extending ZodAny. this causes issues with catchall in ZodObject.\n        this._any = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodAny.create = (params) => {\n    return new ZodAny({\n        typeName: ZodFirstPartyTypeKind.ZodAny,\n        ...processCreateParams(params),\n    });\n};\nclass ZodUnknown extends ZodType {\n    constructor() {\n        super(...arguments);\n        // required\n        this._unknown = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodUnknown.create = (params) => {\n    return new ZodUnknown({\n        typeName: ZodFirstPartyTypeKind.ZodUnknown,\n        ...processCreateParams(params),\n    });\n};\nclass ZodNever extends ZodType {\n    _parse(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.never,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n}\nZodNever.create = (params) => {\n    return new ZodNever({\n        typeName: ZodFirstPartyTypeKind.ZodNever,\n        ...processCreateParams(params),\n    });\n};\nclass ZodVoid extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.void,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodVoid.create = (params) => {\n    return new ZodVoid({\n        typeName: ZodFirstPartyTypeKind.ZodVoid,\n        ...processCreateParams(params),\n    });\n};\nclass ZodArray extends ZodType {\n    _parse(input) {\n        const { ctx, status } = this._processInputParams(input);\n        const def = this._def;\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (def.exactLength !== null) {\n            const tooBig = ctx.data.length > def.exactLength.value;\n            const tooSmall = ctx.data.length < def.exactLength.value;\n            if (tooBig || tooSmall) {\n                addIssueToContext(ctx, {\n                    code: tooBig ? ZodIssueCode.too_big : ZodIssueCode.too_small,\n                    minimum: (tooSmall ? def.exactLength.value : undefined),\n                    maximum: (tooBig ? def.exactLength.value : undefined),\n                    type: \"array\",\n                    inclusive: true,\n                    exact: true,\n                    message: def.exactLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.minLength !== null) {\n            if (ctx.data.length < def.minLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxLength !== null) {\n            if (ctx.data.length > def.maxLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.all([...ctx.data].map((item, i) => {\n                return def.type._parseAsync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n            })).then((result) => {\n                return ParseStatus.mergeArray(status, result);\n            });\n        }\n        const result = [...ctx.data].map((item, i) => {\n            return def.type._parseSync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n        });\n        return ParseStatus.mergeArray(status, result);\n    }\n    get element() {\n        return this._def.type;\n    }\n    min(minLength, message) {\n        return new ZodArray({\n            ...this._def,\n            minLength: { value: minLength, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxLength, message) {\n        return new ZodArray({\n            ...this._def,\n            maxLength: { value: maxLength, message: errorUtil.toString(message) },\n        });\n    }\n    length(len, message) {\n        return new ZodArray({\n            ...this._def,\n            exactLength: { value: len, message: errorUtil.toString(message) },\n        });\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodArray.create = (schema, params) => {\n    return new ZodArray({\n        type: schema,\n        minLength: null,\n        maxLength: null,\n        exactLength: null,\n        typeName: ZodFirstPartyTypeKind.ZodArray,\n        ...processCreateParams(params),\n    });\n};\nfunction deepPartialify(schema) {\n    if (schema instanceof ZodObject) {\n        const newShape = {};\n        for (const key in schema.shape) {\n            const fieldSchema = schema.shape[key];\n            newShape[key] = ZodOptional.create(deepPartialify(fieldSchema));\n        }\n        return new ZodObject({\n            ...schema._def,\n            shape: () => newShape,\n        });\n    }\n    else if (schema instanceof ZodArray) {\n        return new ZodArray({\n            ...schema._def,\n            type: deepPartialify(schema.element),\n        });\n    }\n    else if (schema instanceof ZodOptional) {\n        return ZodOptional.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodNullable) {\n        return ZodNullable.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodTuple) {\n        return ZodTuple.create(schema.items.map((item) => deepPartialify(item)));\n    }\n    else {\n        return schema;\n    }\n}\nclass ZodObject extends ZodType {\n    constructor() {\n        super(...arguments);\n        this._cached = null;\n        /**\n         * @deprecated In most cases, this is no longer needed - unknown properties are now silently stripped.\n         * If you want to pass through unknown properties, use `.passthrough()` instead.\n         */\n        this.nonstrict = this.passthrough;\n        // extend<\n        //   Augmentation extends ZodRawShape,\n        //   NewOutput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_output\"]\n        //       : k extends keyof Output\n        //       ? Output[k]\n        //       : never;\n        //   }>,\n        //   NewInput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_input\"]\n        //       : k extends keyof Input\n        //       ? Input[k]\n        //       : never;\n        //   }>\n        // >(\n        //   augmentation: Augmentation\n        // ): ZodObject<\n        //   extendShape<T, Augmentation>,\n        //   UnknownKeys,\n        //   Catchall,\n        //   NewOutput,\n        //   NewInput\n        // > {\n        //   return new ZodObject({\n        //     ...this._def,\n        //     shape: () => ({\n        //       ...this._def.shape(),\n        //       ...augmentation,\n        //     }),\n        //   }) as any;\n        // }\n        /**\n         * @deprecated Use `.extend` instead\n         *  */\n        this.augment = this.extend;\n    }\n    _getCached() {\n        if (this._cached !== null)\n            return this._cached;\n        const shape = this._def.shape();\n        const keys = util.objectKeys(shape);\n        return (this._cached = { shape, keys });\n    }\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.object) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const { status, ctx } = this._processInputParams(input);\n        const { shape, keys: shapeKeys } = this._getCached();\n        const extraKeys = [];\n        if (!(this._def.catchall instanceof ZodNever &&\n            this._def.unknownKeys === \"strip\")) {\n            for (const key in ctx.data) {\n                if (!shapeKeys.includes(key)) {\n                    extraKeys.push(key);\n                }\n            }\n        }\n        const pairs = [];\n        for (const key of shapeKeys) {\n            const keyValidator = shape[key];\n            const value = ctx.data[key];\n            pairs.push({\n                key: { status: \"valid\", value: key },\n                value: keyValidator._parse(new ParseInputLazyPath(ctx, value, ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (this._def.catchall instanceof ZodNever) {\n            const unknownKeys = this._def.unknownKeys;\n            if (unknownKeys === \"passthrough\") {\n                for (const key of extraKeys) {\n                    pairs.push({\n                        key: { status: \"valid\", value: key },\n                        value: { status: \"valid\", value: ctx.data[key] },\n                    });\n                }\n            }\n            else if (unknownKeys === \"strict\") {\n                if (extraKeys.length > 0) {\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.unrecognized_keys,\n                        keys: extraKeys,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (unknownKeys === \"strip\") ;\n            else {\n                throw new Error(`Internal ZodObject error: invalid unknownKeys value.`);\n            }\n        }\n        else {\n            // run catchall validation\n            const catchall = this._def.catchall;\n            for (const key of extraKeys) {\n                const value = ctx.data[key];\n                pairs.push({\n                    key: { status: \"valid\", value: key },\n                    value: catchall._parse(new ParseInputLazyPath(ctx, value, ctx.path, key) //, ctx.child(key), value, getParsedType(value)\n                    ),\n                    alwaysSet: key in ctx.data,\n                });\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.resolve()\n                .then(async () => {\n                const syncPairs = [];\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    syncPairs.push({\n                        key,\n                        value,\n                        alwaysSet: pair.alwaysSet,\n                    });\n                }\n                return syncPairs;\n            })\n                .then((syncPairs) => {\n                return ParseStatus.mergeObjectSync(status, syncPairs);\n            });\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get shape() {\n        return this._def.shape();\n    }\n    strict(message) {\n        errorUtil.errToObj;\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strict\",\n            ...(message !== undefined\n                ? {\n                    errorMap: (issue, ctx) => {\n                        var _a, _b, _c, _d;\n                        const defaultError = (_c = (_b = (_a = this._def).errorMap) === null || _b === void 0 ? void 0 : _b.call(_a, issue, ctx).message) !== null && _c !== void 0 ? _c : ctx.defaultError;\n                        if (issue.code === \"unrecognized_keys\")\n                            return {\n                                message: (_d = errorUtil.errToObj(message).message) !== null && _d !== void 0 ? _d : defaultError,\n                            };\n                        return {\n                            message: defaultError,\n                        };\n                    },\n                }\n                : {}),\n        });\n    }\n    strip() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strip\",\n        });\n    }\n    passthrough() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"passthrough\",\n        });\n    }\n    // const AugmentFactory =\n    //   <Def extends ZodObjectDef>(def: Def) =>\n    //   <Augmentation extends ZodRawShape>(\n    //     augmentation: Augmentation\n    //   ): ZodObject<\n    //     extendShape<ReturnType<Def[\"shape\"]>, Augmentation>,\n    //     Def[\"unknownKeys\"],\n    //     Def[\"catchall\"]\n    //   > => {\n    //     return new ZodObject({\n    //       ...def,\n    //       shape: () => ({\n    //         ...def.shape(),\n    //         ...augmentation,\n    //       }),\n    //     }) as any;\n    //   };\n    extend(augmentation) {\n        return new ZodObject({\n            ...this._def,\n            shape: () => ({\n                ...this._def.shape(),\n                ...augmentation,\n            }),\n        });\n    }\n    /**\n     * Prior to zod@1.0.12 there was a bug in the\n     * inferred type of merged objects. Please\n     * upgrade if you are experiencing issues.\n     */\n    merge(merging) {\n        const merged = new ZodObject({\n            unknownKeys: merging._def.unknownKeys,\n            catchall: merging._def.catchall,\n            shape: () => ({\n                ...this._def.shape(),\n                ...merging._def.shape(),\n            }),\n            typeName: ZodFirstPartyTypeKind.ZodObject,\n        });\n        return merged;\n    }\n    // merge<\n    //   Incoming extends AnyZodObject,\n    //   Augmentation extends Incoming[\"shape\"],\n    //   NewOutput extends {\n    //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_output\"]\n    //       : k extends keyof Output\n    //       ? Output[k]\n    //       : never;\n    //   },\n    //   NewInput extends {\n    //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_input\"]\n    //       : k extends keyof Input\n    //       ? Input[k]\n    //       : never;\n    //   }\n    // >(\n    //   merging: Incoming\n    // ): ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"],\n    //   NewOutput,\n    //   NewInput\n    // > {\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    setKey(key, schema) {\n        return this.augment({ [key]: schema });\n    }\n    // merge<Incoming extends AnyZodObject>(\n    //   merging: Incoming\n    // ): //ZodObject<T & Incoming[\"_shape\"], UnknownKeys, Catchall> = (merging) => {\n    // ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"]\n    // > {\n    //   // const mergedShape = objectUtil.mergeShapes(\n    //   //   this._def.shape(),\n    //   //   merging._def.shape()\n    //   // );\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    catchall(index) {\n        return new ZodObject({\n            ...this._def,\n            catchall: index,\n        });\n    }\n    pick(mask) {\n        const shape = {};\n        util.objectKeys(mask).forEach((key) => {\n            if (mask[key] && this.shape[key]) {\n                shape[key] = this.shape[key];\n            }\n        });\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    omit(mask) {\n        const shape = {};\n        util.objectKeys(this.shape).forEach((key) => {\n            if (!mask[key]) {\n                shape[key] = this.shape[key];\n            }\n        });\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    /**\n     * @deprecated\n     */\n    deepPartial() {\n        return deepPartialify(this);\n    }\n    partial(mask) {\n        const newShape = {};\n        util.objectKeys(this.shape).forEach((key) => {\n            const fieldSchema = this.shape[key];\n            if (mask && !mask[key]) {\n                newShape[key] = fieldSchema;\n            }\n            else {\n                newShape[key] = fieldSchema.optional();\n            }\n        });\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    required(mask) {\n        const newShape = {};\n        util.objectKeys(this.shape).forEach((key) => {\n            if (mask && !mask[key]) {\n                newShape[key] = this.shape[key];\n            }\n            else {\n                const fieldSchema = this.shape[key];\n                let newField = fieldSchema;\n                while (newField instanceof ZodOptional) {\n                    newField = newField._def.innerType;\n                }\n                newShape[key] = newField;\n            }\n        });\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    keyof() {\n        return createZodEnum(util.objectKeys(this.shape));\n    }\n}\nZodObject.create = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.strictCreate = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strict\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.lazycreate = (shape, params) => {\n    return new ZodObject({\n        shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nclass ZodUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const options = this._def.options;\n        function handleResults(results) {\n            // return first issue-free validation if it exists\n            for (const result of results) {\n                if (result.result.status === \"valid\") {\n                    return result.result;\n                }\n            }\n            for (const result of results) {\n                if (result.result.status === \"dirty\") {\n                    // add issues from dirty option\n                    ctx.common.issues.push(...result.ctx.common.issues);\n                    return result.result;\n                }\n            }\n            // return invalid\n            const unionErrors = results.map((result) => new ZodError(result.ctx.common.issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return Promise.all(options.map(async (option) => {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                return {\n                    result: await option._parseAsync({\n                        data: ctx.data,\n                        path: ctx.path,\n                        parent: childCtx,\n                    }),\n                    ctx: childCtx,\n                };\n            })).then(handleResults);\n        }\n        else {\n            let dirty = undefined;\n            const issues = [];\n            for (const option of options) {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                const result = option._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: childCtx,\n                });\n                if (result.status === \"valid\") {\n                    return result;\n                }\n                else if (result.status === \"dirty\" && !dirty) {\n                    dirty = { result, ctx: childCtx };\n                }\n                if (childCtx.common.issues.length) {\n                    issues.push(childCtx.common.issues);\n                }\n            }\n            if (dirty) {\n                ctx.common.issues.push(...dirty.ctx.common.issues);\n                return dirty.result;\n            }\n            const unionErrors = issues.map((issues) => new ZodError(issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n    }\n    get options() {\n        return this._def.options;\n    }\n}\nZodUnion.create = (types, params) => {\n    return new ZodUnion({\n        options: types,\n        typeName: ZodFirstPartyTypeKind.ZodUnion,\n        ...processCreateParams(params),\n    });\n};\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\n//////////                                 //////////\n//////////      ZodDiscriminatedUnion      //////////\n//////////                                 //////////\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\nconst getDiscriminator = (type) => {\n    if (type instanceof ZodLazy) {\n        return getDiscriminator(type.schema);\n    }\n    else if (type instanceof ZodEffects) {\n        return getDiscriminator(type.innerType());\n    }\n    else if (type instanceof ZodLiteral) {\n        return [type.value];\n    }\n    else if (type instanceof ZodEnum) {\n        return type.options;\n    }\n    else if (type instanceof ZodNativeEnum) {\n        // eslint-disable-next-line ban/ban\n        return util.objectValues(type.enum);\n    }\n    else if (type instanceof ZodDefault) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else if (type instanceof ZodUndefined) {\n        return [undefined];\n    }\n    else if (type instanceof ZodNull) {\n        return [null];\n    }\n    else if (type instanceof ZodOptional) {\n        return [undefined, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodNullable) {\n        return [null, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodBranded) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodReadonly) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodCatch) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else {\n        return [];\n    }\n};\nclass ZodDiscriminatedUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const discriminator = this.discriminator;\n        const discriminatorValue = ctx.data[discriminator];\n        const option = this.optionsMap.get(discriminatorValue);\n        if (!option) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union_discriminator,\n                options: Array.from(this.optionsMap.keys()),\n                path: [discriminator],\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return option._parseAsync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n        else {\n            return option._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n    }\n    get discriminator() {\n        return this._def.discriminator;\n    }\n    get options() {\n        return this._def.options;\n    }\n    get optionsMap() {\n        return this._def.optionsMap;\n    }\n    /**\n     * The constructor of the discriminated union schema. Its behaviour is very similar to that of the normal z.union() constructor.\n     * However, it only allows a union of objects, all of which need to share a discriminator property. This property must\n     * have a different value for each object in the union.\n     * @param discriminator the name of the discriminator property\n     * @param types an array of object schemas\n     * @param params\n     */\n    static create(discriminator, options, params) {\n        // Get all the valid discriminator values\n        const optionsMap = new Map();\n        // try {\n        for (const type of options) {\n            const discriminatorValues = getDiscriminator(type.shape[discriminator]);\n            if (!discriminatorValues.length) {\n                throw new Error(`A discriminator value for key \\`${discriminator}\\` could not be extracted from all schema options`);\n            }\n            for (const value of discriminatorValues) {\n                if (optionsMap.has(value)) {\n                    throw new Error(`Discriminator property ${String(discriminator)} has duplicate value ${String(value)}`);\n                }\n                optionsMap.set(value, type);\n            }\n        }\n        return new ZodDiscriminatedUnion({\n            typeName: ZodFirstPartyTypeKind.ZodDiscriminatedUnion,\n            discriminator,\n            options,\n            optionsMap,\n            ...processCreateParams(params),\n        });\n    }\n}\nfunction mergeValues(a, b) {\n    const aType = getParsedType(a);\n    const bType = getParsedType(b);\n    if (a === b) {\n        return { valid: true, data: a };\n    }\n    else if (aType === ZodParsedType.object && bType === ZodParsedType.object) {\n        const bKeys = util.objectKeys(b);\n        const sharedKeys = util\n            .objectKeys(a)\n            .filter((key) => bKeys.indexOf(key) !== -1);\n        const newObj = { ...a, ...b };\n        for (const key of sharedKeys) {\n            const sharedValue = mergeValues(a[key], b[key]);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newObj[key] = sharedValue.data;\n        }\n        return { valid: true, data: newObj };\n    }\n    else if (aType === ZodParsedType.array && bType === ZodParsedType.array) {\n        if (a.length !== b.length) {\n            return { valid: false };\n        }\n        const newArray = [];\n        for (let index = 0; index < a.length; index++) {\n            const itemA = a[index];\n            const itemB = b[index];\n            const sharedValue = mergeValues(itemA, itemB);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newArray.push(sharedValue.data);\n        }\n        return { valid: true, data: newArray };\n    }\n    else if (aType === ZodParsedType.date &&\n        bType === ZodParsedType.date &&\n        +a === +b) {\n        return { valid: true, data: a };\n    }\n    else {\n        return { valid: false };\n    }\n}\nclass ZodIntersection extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const handleParsed = (parsedLeft, parsedRight) => {\n            if (isAborted(parsedLeft) || isAborted(parsedRight)) {\n                return INVALID;\n            }\n            const merged = mergeValues(parsedLeft.value, parsedRight.value);\n            if (!merged.valid) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.invalid_intersection_types,\n                });\n                return INVALID;\n            }\n            if (isDirty(parsedLeft) || isDirty(parsedRight)) {\n                status.dirty();\n            }\n            return { status: status.value, value: merged.data };\n        };\n        if (ctx.common.async) {\n            return Promise.all([\n                this._def.left._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n                this._def.right._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n            ]).then(([left, right]) => handleParsed(left, right));\n        }\n        else {\n            return handleParsed(this._def.left._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }), this._def.right._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }));\n        }\n    }\n}\nZodIntersection.create = (left, right, params) => {\n    return new ZodIntersection({\n        left: left,\n        right: right,\n        typeName: ZodFirstPartyTypeKind.ZodIntersection,\n        ...processCreateParams(params),\n    });\n};\nclass ZodTuple extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (ctx.data.length < this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_small,\n                minimum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            return INVALID;\n        }\n        const rest = this._def.rest;\n        if (!rest && ctx.data.length > this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_big,\n                maximum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            status.dirty();\n        }\n        const items = [...ctx.data]\n            .map((item, itemIndex) => {\n            const schema = this._def.items[itemIndex] || this._def.rest;\n            if (!schema)\n                return null;\n            return schema._parse(new ParseInputLazyPath(ctx, item, ctx.path, itemIndex));\n        })\n            .filter((x) => !!x); // filter nulls\n        if (ctx.common.async) {\n            return Promise.all(items).then((results) => {\n                return ParseStatus.mergeArray(status, results);\n            });\n        }\n        else {\n            return ParseStatus.mergeArray(status, items);\n        }\n    }\n    get items() {\n        return this._def.items;\n    }\n    rest(rest) {\n        return new ZodTuple({\n            ...this._def,\n            rest,\n        });\n    }\n}\nZodTuple.create = (schemas, params) => {\n    if (!Array.isArray(schemas)) {\n        throw new Error(\"You must pass an array of schemas to z.tuple([ ... ])\");\n    }\n    return new ZodTuple({\n        items: schemas,\n        typeName: ZodFirstPartyTypeKind.ZodTuple,\n        rest: null,\n        ...processCreateParams(params),\n    });\n};\nclass ZodRecord extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const pairs = [];\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        for (const key in ctx.data) {\n            pairs.push({\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, key)),\n                value: valueType._parse(new ParseInputLazyPath(ctx, ctx.data[key], ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (ctx.common.async) {\n            return ParseStatus.mergeObjectAsync(status, pairs);\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get element() {\n        return this._def.valueType;\n    }\n    static create(first, second, third) {\n        if (second instanceof ZodType) {\n            return new ZodRecord({\n                keyType: first,\n                valueType: second,\n                typeName: ZodFirstPartyTypeKind.ZodRecord,\n                ...processCreateParams(third),\n            });\n        }\n        return new ZodRecord({\n            keyType: ZodString.create(),\n            valueType: first,\n            typeName: ZodFirstPartyTypeKind.ZodRecord,\n            ...processCreateParams(second),\n        });\n    }\n}\nclass ZodMap extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.map) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.map,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        const pairs = [...ctx.data.entries()].map(([key, value], index) => {\n            return {\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, [index, \"key\"])),\n                value: valueType._parse(new ParseInputLazyPath(ctx, value, ctx.path, [index, \"value\"])),\n            };\n        });\n        if (ctx.common.async) {\n            const finalMap = new Map();\n            return Promise.resolve().then(async () => {\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    if (key.status === \"aborted\" || value.status === \"aborted\") {\n                        return INVALID;\n                    }\n                    if (key.status === \"dirty\" || value.status === \"dirty\") {\n                        status.dirty();\n                    }\n                    finalMap.set(key.value, value.value);\n                }\n                return { status: status.value, value: finalMap };\n            });\n        }\n        else {\n            const finalMap = new Map();\n            for (const pair of pairs) {\n                const key = pair.key;\n                const value = pair.value;\n                if (key.status === \"aborted\" || value.status === \"aborted\") {\n                    return INVALID;\n                }\n                if (key.status === \"dirty\" || value.status === \"dirty\") {\n                    status.dirty();\n                }\n                finalMap.set(key.value, value.value);\n            }\n            return { status: status.value, value: finalMap };\n        }\n    }\n}\nZodMap.create = (keyType, valueType, params) => {\n    return new ZodMap({\n        valueType,\n        keyType,\n        typeName: ZodFirstPartyTypeKind.ZodMap,\n        ...processCreateParams(params),\n    });\n};\nclass ZodSet extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.set) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.set,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const def = this._def;\n        if (def.minSize !== null) {\n            if (ctx.data.size < def.minSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minSize.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxSize !== null) {\n            if (ctx.data.size > def.maxSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxSize.message,\n                });\n                status.dirty();\n            }\n        }\n        const valueType = this._def.valueType;\n        function finalizeSet(elements) {\n            const parsedSet = new Set();\n            for (const element of elements) {\n                if (element.status === \"aborted\")\n                    return INVALID;\n                if (element.status === \"dirty\")\n                    status.dirty();\n                parsedSet.add(element.value);\n            }\n            return { status: status.value, value: parsedSet };\n        }\n        const elements = [...ctx.data.values()].map((item, i) => valueType._parse(new ParseInputLazyPath(ctx, item, ctx.path, i)));\n        if (ctx.common.async) {\n            return Promise.all(elements).then((elements) => finalizeSet(elements));\n        }\n        else {\n            return finalizeSet(elements);\n        }\n    }\n    min(minSize, message) {\n        return new ZodSet({\n            ...this._def,\n            minSize: { value: minSize, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxSize, message) {\n        return new ZodSet({\n            ...this._def,\n            maxSize: { value: maxSize, message: errorUtil.toString(message) },\n        });\n    }\n    size(size, message) {\n        return this.min(size, message).max(size, message);\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodSet.create = (valueType, params) => {\n    return new ZodSet({\n        valueType,\n        minSize: null,\n        maxSize: null,\n        typeName: ZodFirstPartyTypeKind.ZodSet,\n        ...processCreateParams(params),\n    });\n};\nclass ZodFunction extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.validate = this.implement;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.function) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.function,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        function makeArgsIssue(args, error) {\n            return makeIssue({\n                data: args,\n                path: ctx.path,\n                errorMaps: [\n                    ctx.common.contextualErrorMap,\n                    ctx.schemaErrorMap,\n                    getErrorMap(),\n                    errorMap,\n                ].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_arguments,\n                    argumentsError: error,\n                },\n            });\n        }\n        function makeReturnsIssue(returns, error) {\n            return makeIssue({\n                data: returns,\n                path: ctx.path,\n                errorMaps: [\n                    ctx.common.contextualErrorMap,\n                    ctx.schemaErrorMap,\n                    getErrorMap(),\n                    errorMap,\n                ].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_return_type,\n                    returnTypeError: error,\n                },\n            });\n        }\n        const params = { errorMap: ctx.common.contextualErrorMap };\n        const fn = ctx.data;\n        if (this._def.returns instanceof ZodPromise) {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(async function (...args) {\n                const error = new ZodError([]);\n                const parsedArgs = await me._def.args\n                    .parseAsync(args, params)\n                    .catch((e) => {\n                    error.addIssue(makeArgsIssue(args, e));\n                    throw error;\n                });\n                const result = await Reflect.apply(fn, this, parsedArgs);\n                const parsedReturns = await me._def.returns._def.type\n                    .parseAsync(result, params)\n                    .catch((e) => {\n                    error.addIssue(makeReturnsIssue(result, e));\n                    throw error;\n                });\n                return parsedReturns;\n            });\n        }\n        else {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(function (...args) {\n                const parsedArgs = me._def.args.safeParse(args, params);\n                if (!parsedArgs.success) {\n                    throw new ZodError([makeArgsIssue(args, parsedArgs.error)]);\n                }\n                const result = Reflect.apply(fn, this, parsedArgs.data);\n                const parsedReturns = me._def.returns.safeParse(result, params);\n                if (!parsedReturns.success) {\n                    throw new ZodError([makeReturnsIssue(result, parsedReturns.error)]);\n                }\n                return parsedReturns.data;\n            });\n        }\n    }\n    parameters() {\n        return this._def.args;\n    }\n    returnType() {\n        return this._def.returns;\n    }\n    args(...items) {\n        return new ZodFunction({\n            ...this._def,\n            args: ZodTuple.create(items).rest(ZodUnknown.create()),\n        });\n    }\n    returns(returnType) {\n        return new ZodFunction({\n            ...this._def,\n            returns: returnType,\n        });\n    }\n    implement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    strictImplement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    static create(args, returns, params) {\n        return new ZodFunction({\n            args: (args\n                ? args\n                : ZodTuple.create([]).rest(ZodUnknown.create())),\n            returns: returns || ZodUnknown.create(),\n            typeName: ZodFirstPartyTypeKind.ZodFunction,\n            ...processCreateParams(params),\n        });\n    }\n}\nclass ZodLazy extends ZodType {\n    get schema() {\n        return this._def.getter();\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const lazySchema = this._def.getter();\n        return lazySchema._parse({ data: ctx.data, path: ctx.path, parent: ctx });\n    }\n}\nZodLazy.create = (getter, params) => {\n    return new ZodLazy({\n        getter: getter,\n        typeName: ZodFirstPartyTypeKind.ZodLazy,\n        ...processCreateParams(params),\n    });\n};\nclass ZodLiteral extends ZodType {\n    _parse(input) {\n        if (input.data !== this._def.value) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_literal,\n                expected: this._def.value,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n    get value() {\n        return this._def.value;\n    }\n}\nZodLiteral.create = (value, params) => {\n    return new ZodLiteral({\n        value: value,\n        typeName: ZodFirstPartyTypeKind.ZodLiteral,\n        ...processCreateParams(params),\n    });\n};\nfunction createZodEnum(values, params) {\n    return new ZodEnum({\n        values,\n        typeName: ZodFirstPartyTypeKind.ZodEnum,\n        ...processCreateParams(params),\n    });\n}\nclass ZodEnum extends ZodType {\n    constructor() {\n        super(...arguments);\n        _ZodEnum_cache.set(this, void 0);\n    }\n    _parse(input) {\n        if (typeof input.data !== \"string\") {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!__classPrivateFieldGet(this, _ZodEnum_cache, \"f\")) {\n            __classPrivateFieldSet(this, _ZodEnum_cache, new Set(this._def.values), \"f\");\n        }\n        if (!__classPrivateFieldGet(this, _ZodEnum_cache, \"f\").has(input.data)) {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get options() {\n        return this._def.values;\n    }\n    get enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Values() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    extract(values, newDef = this._def) {\n        return ZodEnum.create(values, {\n            ...this._def,\n            ...newDef,\n        });\n    }\n    exclude(values, newDef = this._def) {\n        return ZodEnum.create(this.options.filter((opt) => !values.includes(opt)), {\n            ...this._def,\n            ...newDef,\n        });\n    }\n}\n_ZodEnum_cache = new WeakMap();\nZodEnum.create = createZodEnum;\nclass ZodNativeEnum extends ZodType {\n    constructor() {\n        super(...arguments);\n        _ZodNativeEnum_cache.set(this, void 0);\n    }\n    _parse(input) {\n        const nativeEnumValues = util.getValidEnumValues(this._def.values);\n        const ctx = this._getOrReturnCtx(input);\n        if (ctx.parsedType !== ZodParsedType.string &&\n            ctx.parsedType !== ZodParsedType.number) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!__classPrivateFieldGet(this, _ZodNativeEnum_cache, \"f\")) {\n            __classPrivateFieldSet(this, _ZodNativeEnum_cache, new Set(util.getValidEnumValues(this._def.values)), \"f\");\n        }\n        if (!__classPrivateFieldGet(this, _ZodNativeEnum_cache, \"f\").has(input.data)) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get enum() {\n        return this._def.values;\n    }\n}\n_ZodNativeEnum_cache = new WeakMap();\nZodNativeEnum.create = (values, params) => {\n    return new ZodNativeEnum({\n        values: values,\n        typeName: ZodFirstPartyTypeKind.ZodNativeEnum,\n        ...processCreateParams(params),\n    });\n};\nclass ZodPromise extends ZodType {\n    unwrap() {\n        return this._def.type;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.promise &&\n            ctx.common.async === false) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.promise,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const promisified = ctx.parsedType === ZodParsedType.promise\n            ? ctx.data\n            : Promise.resolve(ctx.data);\n        return OK(promisified.then((data) => {\n            return this._def.type.parseAsync(data, {\n                path: ctx.path,\n                errorMap: ctx.common.contextualErrorMap,\n            });\n        }));\n    }\n}\nZodPromise.create = (schema, params) => {\n    return new ZodPromise({\n        type: schema,\n        typeName: ZodFirstPartyTypeKind.ZodPromise,\n        ...processCreateParams(params),\n    });\n};\nclass ZodEffects extends ZodType {\n    innerType() {\n        return this._def.schema;\n    }\n    sourceType() {\n        return this._def.schema._def.typeName === ZodFirstPartyTypeKind.ZodEffects\n            ? this._def.schema.sourceType()\n            : this._def.schema;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const effect = this._def.effect || null;\n        const checkCtx = {\n            addIssue: (arg) => {\n                addIssueToContext(ctx, arg);\n                if (arg.fatal) {\n                    status.abort();\n                }\n                else {\n                    status.dirty();\n                }\n            },\n            get path() {\n                return ctx.path;\n            },\n        };\n        checkCtx.addIssue = checkCtx.addIssue.bind(checkCtx);\n        if (effect.type === \"preprocess\") {\n            const processed = effect.transform(ctx.data, checkCtx);\n            if (ctx.common.async) {\n                return Promise.resolve(processed).then(async (processed) => {\n                    if (status.value === \"aborted\")\n                        return INVALID;\n                    const result = await this._def.schema._parseAsync({\n                        data: processed,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                    if (result.status === \"aborted\")\n                        return INVALID;\n                    if (result.status === \"dirty\")\n                        return DIRTY(result.value);\n                    if (status.value === \"dirty\")\n                        return DIRTY(result.value);\n                    return result;\n                });\n            }\n            else {\n                if (status.value === \"aborted\")\n                    return INVALID;\n                const result = this._def.schema._parseSync({\n                    data: processed,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (result.status === \"aborted\")\n                    return INVALID;\n                if (result.status === \"dirty\")\n                    return DIRTY(result.value);\n                if (status.value === \"dirty\")\n                    return DIRTY(result.value);\n                return result;\n            }\n        }\n        if (effect.type === \"refinement\") {\n            const executeRefinement = (acc) => {\n                const result = effect.refinement(acc, checkCtx);\n                if (ctx.common.async) {\n                    return Promise.resolve(result);\n                }\n                if (result instanceof Promise) {\n                    throw new Error(\"Async refinement encountered during synchronous parse operation. Use .parseAsync instead.\");\n                }\n                return acc;\n            };\n            if (ctx.common.async === false) {\n                const inner = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inner.status === \"aborted\")\n                    return INVALID;\n                if (inner.status === \"dirty\")\n                    status.dirty();\n                // return value is ignored\n                executeRefinement(inner.value);\n                return { status: status.value, value: inner.value };\n            }\n            else {\n                return this._def.schema\n                    ._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx })\n                    .then((inner) => {\n                    if (inner.status === \"aborted\")\n                        return INVALID;\n                    if (inner.status === \"dirty\")\n                        status.dirty();\n                    return executeRefinement(inner.value).then(() => {\n                        return { status: status.value, value: inner.value };\n                    });\n                });\n            }\n        }\n        if (effect.type === \"transform\") {\n            if (ctx.common.async === false) {\n                const base = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (!isValid(base))\n                    return base;\n                const result = effect.transform(base.value, checkCtx);\n                if (result instanceof Promise) {\n                    throw new Error(`Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.`);\n                }\n                return { status: status.value, value: result };\n            }\n            else {\n                return this._def.schema\n                    ._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx })\n                    .then((base) => {\n                    if (!isValid(base))\n                        return base;\n                    return Promise.resolve(effect.transform(base.value, checkCtx)).then((result) => ({ status: status.value, value: result }));\n                });\n            }\n        }\n        util.assertNever(effect);\n    }\n}\nZodEffects.create = (schema, effect, params) => {\n    return new ZodEffects({\n        schema,\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        effect,\n        ...processCreateParams(params),\n    });\n};\nZodEffects.createWithPreprocess = (preprocess, schema, params) => {\n    return new ZodEffects({\n        schema,\n        effect: { type: \"preprocess\", transform: preprocess },\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        ...processCreateParams(params),\n    });\n};\nclass ZodOptional extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.undefined) {\n            return OK(undefined);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodOptional.create = (type, params) => {\n    return new ZodOptional({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodOptional,\n        ...processCreateParams(params),\n    });\n};\nclass ZodNullable extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.null) {\n            return OK(null);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodNullable.create = (type, params) => {\n    return new ZodNullable({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodNullable,\n        ...processCreateParams(params),\n    });\n};\nclass ZodDefault extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        let data = ctx.data;\n        if (ctx.parsedType === ZodParsedType.undefined) {\n            data = this._def.defaultValue();\n        }\n        return this._def.innerType._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    removeDefault() {\n        return this._def.innerType;\n    }\n}\nZodDefault.create = (type, params) => {\n    return new ZodDefault({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodDefault,\n        defaultValue: typeof params.default === \"function\"\n            ? params.default\n            : () => params.default,\n        ...processCreateParams(params),\n    });\n};\nclass ZodCatch extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        // newCtx is used to not collect issues from inner types in ctx\n        const newCtx = {\n            ...ctx,\n            common: {\n                ...ctx.common,\n                issues: [],\n            },\n        };\n        const result = this._def.innerType._parse({\n            data: newCtx.data,\n            path: newCtx.path,\n            parent: {\n                ...newCtx,\n            },\n        });\n        if (isAsync(result)) {\n            return result.then((result) => {\n                return {\n                    status: \"valid\",\n                    value: result.status === \"valid\"\n                        ? result.value\n                        : this._def.catchValue({\n                            get error() {\n                                return new ZodError(newCtx.common.issues);\n                            },\n                            input: newCtx.data,\n                        }),\n                };\n            });\n        }\n        else {\n            return {\n                status: \"valid\",\n                value: result.status === \"valid\"\n                    ? result.value\n                    : this._def.catchValue({\n                        get error() {\n                            return new ZodError(newCtx.common.issues);\n                        },\n                        input: newCtx.data,\n                    }),\n            };\n        }\n    }\n    removeCatch() {\n        return this._def.innerType;\n    }\n}\nZodCatch.create = (type, params) => {\n    return new ZodCatch({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodCatch,\n        catchValue: typeof params.catch === \"function\" ? params.catch : () => params.catch,\n        ...processCreateParams(params),\n    });\n};\nclass ZodNaN extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.nan) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.nan,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n}\nZodNaN.create = (params) => {\n    return new ZodNaN({\n        typeName: ZodFirstPartyTypeKind.ZodNaN,\n        ...processCreateParams(params),\n    });\n};\nconst BRAND = Symbol(\"zod_brand\");\nclass ZodBranded extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const data = ctx.data;\n        return this._def.type._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    unwrap() {\n        return this._def.type;\n    }\n}\nclass ZodPipeline extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.common.async) {\n            const handleAsync = async () => {\n                const inResult = await this._def.in._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inResult.status === \"aborted\")\n                    return INVALID;\n                if (inResult.status === \"dirty\") {\n                    status.dirty();\n                    return DIRTY(inResult.value);\n                }\n                else {\n                    return this._def.out._parseAsync({\n                        data: inResult.value,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                }\n            };\n            return handleAsync();\n        }\n        else {\n            const inResult = this._def.in._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n            if (inResult.status === \"aborted\")\n                return INVALID;\n            if (inResult.status === \"dirty\") {\n                status.dirty();\n                return {\n                    status: \"dirty\",\n                    value: inResult.value,\n                };\n            }\n            else {\n                return this._def.out._parseSync({\n                    data: inResult.value,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n            }\n        }\n    }\n    static create(a, b) {\n        return new ZodPipeline({\n            in: a,\n            out: b,\n            typeName: ZodFirstPartyTypeKind.ZodPipeline,\n        });\n    }\n}\nclass ZodReadonly extends ZodType {\n    _parse(input) {\n        const result = this._def.innerType._parse(input);\n        const freeze = (data) => {\n            if (isValid(data)) {\n                data.value = Object.freeze(data.value);\n            }\n            return data;\n        };\n        return isAsync(result)\n            ? result.then((data) => freeze(data))\n            : freeze(result);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodReadonly.create = (type, params) => {\n    return new ZodReadonly({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodReadonly,\n        ...processCreateParams(params),\n    });\n};\nfunction custom(check, params = {}, \n/**\n * @deprecated\n *\n * Pass `fatal` into the params object instead:\n *\n * ```ts\n * z.string().custom((val) => val.length > 5, { fatal: false })\n * ```\n *\n */\nfatal) {\n    if (check)\n        return ZodAny.create().superRefine((data, ctx) => {\n            var _a, _b;\n            if (!check(data)) {\n                const p = typeof params === \"function\"\n                    ? params(data)\n                    : typeof params === \"string\"\n                        ? { message: params }\n                        : params;\n                const _fatal = (_b = (_a = p.fatal) !== null && _a !== void 0 ? _a : fatal) !== null && _b !== void 0 ? _b : true;\n                const p2 = typeof p === \"string\" ? { message: p } : p;\n                ctx.addIssue({ code: \"custom\", ...p2, fatal: _fatal });\n            }\n        });\n    return ZodAny.create();\n}\nconst late = {\n    object: ZodObject.lazycreate,\n};\nvar ZodFirstPartyTypeKind;\n(function (ZodFirstPartyTypeKind) {\n    ZodFirstPartyTypeKind[\"ZodString\"] = \"ZodString\";\n    ZodFirstPartyTypeKind[\"ZodNumber\"] = \"ZodNumber\";\n    ZodFirstPartyTypeKind[\"ZodNaN\"] = \"ZodNaN\";\n    ZodFirstPartyTypeKind[\"ZodBigInt\"] = \"ZodBigInt\";\n    ZodFirstPartyTypeKind[\"ZodBoolean\"] = \"ZodBoolean\";\n    ZodFirstPartyTypeKind[\"ZodDate\"] = \"ZodDate\";\n    ZodFirstPartyTypeKind[\"ZodSymbol\"] = \"ZodSymbol\";\n    ZodFirstPartyTypeKind[\"ZodUndefined\"] = \"ZodUndefined\";\n    ZodFirstPartyTypeKind[\"ZodNull\"] = \"ZodNull\";\n    ZodFirstPartyTypeKind[\"ZodAny\"] = \"ZodAny\";\n    ZodFirstPartyTypeKind[\"ZodUnknown\"] = \"ZodUnknown\";\n    ZodFirstPartyTypeKind[\"ZodNever\"] = \"ZodNever\";\n    ZodFirstPartyTypeKind[\"ZodVoid\"] = \"ZodVoid\";\n    ZodFirstPartyTypeKind[\"ZodArray\"] = \"ZodArray\";\n    ZodFirstPartyTypeKind[\"ZodObject\"] = \"ZodObject\";\n    ZodFirstPartyTypeKind[\"ZodUnion\"] = \"ZodUnion\";\n    ZodFirstPartyTypeKind[\"ZodDiscriminatedUnion\"] = \"ZodDiscriminatedUnion\";\n    ZodFirstPartyTypeKind[\"ZodIntersection\"] = \"ZodIntersection\";\n    ZodFirstPartyTypeKind[\"ZodTuple\"] = \"ZodTuple\";\n    ZodFirstPartyTypeKind[\"ZodRecord\"] = \"ZodRecord\";\n    ZodFirstPartyTypeKind[\"ZodMap\"] = \"ZodMap\";\n    ZodFirstPartyTypeKind[\"ZodSet\"] = \"ZodSet\";\n    ZodFirstPartyTypeKind[\"ZodFunction\"] = \"ZodFunction\";\n    ZodFirstPartyTypeKind[\"ZodLazy\"] = \"ZodLazy\";\n    ZodFirstPartyTypeKind[\"ZodLiteral\"] = \"ZodLiteral\";\n    ZodFirstPartyTypeKind[\"ZodEnum\"] = \"ZodEnum\";\n    ZodFirstPartyTypeKind[\"ZodEffects\"] = \"ZodEffects\";\n    ZodFirstPartyTypeKind[\"ZodNativeEnum\"] = \"ZodNativeEnum\";\n    ZodFirstPartyTypeKind[\"ZodOptional\"] = \"ZodOptional\";\n    ZodFirstPartyTypeKind[\"ZodNullable\"] = \"ZodNullable\";\n    ZodFirstPartyTypeKind[\"ZodDefault\"] = \"ZodDefault\";\n    ZodFirstPartyTypeKind[\"ZodCatch\"] = \"ZodCatch\";\n    ZodFirstPartyTypeKind[\"ZodPromise\"] = \"ZodPromise\";\n    ZodFirstPartyTypeKind[\"ZodBranded\"] = \"ZodBranded\";\n    ZodFirstPartyTypeKind[\"ZodPipeline\"] = \"ZodPipeline\";\n    ZodFirstPartyTypeKind[\"ZodReadonly\"] = \"ZodReadonly\";\n})(ZodFirstPartyTypeKind || (ZodFirstPartyTypeKind = {}));\nconst instanceOfType = (\n// const instanceOfType = <T extends new (...args: any[]) => any>(\ncls, params = {\n    message: `Input not instance of ${cls.name}`,\n}) => custom((data) => data instanceof cls, params);\nconst stringType = ZodString.create;\nconst numberType = ZodNumber.create;\nconst nanType = ZodNaN.create;\nconst bigIntType = ZodBigInt.create;\nconst booleanType = ZodBoolean.create;\nconst dateType = ZodDate.create;\nconst symbolType = ZodSymbol.create;\nconst undefinedType = ZodUndefined.create;\nconst nullType = ZodNull.create;\nconst anyType = ZodAny.create;\nconst unknownType = ZodUnknown.create;\nconst neverType = ZodNever.create;\nconst voidType = ZodVoid.create;\nconst arrayType = ZodArray.create;\nconst objectType = ZodObject.create;\nconst strictObjectType = ZodObject.strictCreate;\nconst unionType = ZodUnion.create;\nconst discriminatedUnionType = ZodDiscriminatedUnion.create;\nconst intersectionType = ZodIntersection.create;\nconst tupleType = ZodTuple.create;\nconst recordType = ZodRecord.create;\nconst mapType = ZodMap.create;\nconst setType = ZodSet.create;\nconst functionType = ZodFunction.create;\nconst lazyType = ZodLazy.create;\nconst literalType = ZodLiteral.create;\nconst enumType = ZodEnum.create;\nconst nativeEnumType = ZodNativeEnum.create;\nconst promiseType = ZodPromise.create;\nconst effectsType = ZodEffects.create;\nconst optionalType = ZodOptional.create;\nconst nullableType = ZodNullable.create;\nconst preprocessType = ZodEffects.createWithPreprocess;\nconst pipelineType = ZodPipeline.create;\nconst ostring = () => stringType().optional();\nconst onumber = () => numberType().optional();\nconst oboolean = () => booleanType().optional();\nconst coerce = {\n    string: ((arg) => ZodString.create({ ...arg, coerce: true })),\n    number: ((arg) => ZodNumber.create({ ...arg, coerce: true })),\n    boolean: ((arg) => ZodBoolean.create({\n        ...arg,\n        coerce: true,\n    })),\n    bigint: ((arg) => ZodBigInt.create({ ...arg, coerce: true })),\n    date: ((arg) => ZodDate.create({ ...arg, coerce: true })),\n};\nconst NEVER = INVALID;\n\nvar z = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    defaultErrorMap: errorMap,\n    setErrorMap: setErrorMap,\n    getErrorMap: getErrorMap,\n    makeIssue: makeIssue,\n    EMPTY_PATH: EMPTY_PATH,\n    addIssueToContext: addIssueToContext,\n    ParseStatus: ParseStatus,\n    INVALID: INVALID,\n    DIRTY: DIRTY,\n    OK: OK,\n    isAborted: isAborted,\n    isDirty: isDirty,\n    isValid: isValid,\n    isAsync: isAsync,\n    get util () { return util; },\n    get objectUtil () { return objectUtil; },\n    ZodParsedType: ZodParsedType,\n    getParsedType: getParsedType,\n    ZodType: ZodType,\n    datetimeRegex: datetimeRegex,\n    ZodString: ZodString,\n    ZodNumber: ZodNumber,\n    ZodBigInt: ZodBigInt,\n    ZodBoolean: ZodBoolean,\n    ZodDate: ZodDate,\n    ZodSymbol: ZodSymbol,\n    ZodUndefined: ZodUndefined,\n    ZodNull: ZodNull,\n    ZodAny: ZodAny,\n    ZodUnknown: ZodUnknown,\n    ZodNever: ZodNever,\n    ZodVoid: ZodVoid,\n    ZodArray: ZodArray,\n    ZodObject: ZodObject,\n    ZodUnion: ZodUnion,\n    ZodDiscriminatedUnion: ZodDiscriminatedUnion,\n    ZodIntersection: ZodIntersection,\n    ZodTuple: ZodTuple,\n    ZodRecord: ZodRecord,\n    ZodMap: ZodMap,\n    ZodSet: ZodSet,\n    ZodFunction: ZodFunction,\n    ZodLazy: ZodLazy,\n    ZodLiteral: ZodLiteral,\n    ZodEnum: ZodEnum,\n    ZodNativeEnum: ZodNativeEnum,\n    ZodPromise: ZodPromise,\n    ZodEffects: ZodEffects,\n    ZodTransformer: ZodEffects,\n    ZodOptional: ZodOptional,\n    ZodNullable: ZodNullable,\n    ZodDefault: ZodDefault,\n    ZodCatch: ZodCatch,\n    ZodNaN: ZodNaN,\n    BRAND: BRAND,\n    ZodBranded: ZodBranded,\n    ZodPipeline: ZodPipeline,\n    ZodReadonly: ZodReadonly,\n    custom: custom,\n    Schema: ZodType,\n    ZodSchema: ZodType,\n    late: late,\n    get ZodFirstPartyTypeKind () { return ZodFirstPartyTypeKind; },\n    coerce: coerce,\n    any: anyType,\n    array: arrayType,\n    bigint: bigIntType,\n    boolean: booleanType,\n    date: dateType,\n    discriminatedUnion: discriminatedUnionType,\n    effect: effectsType,\n    'enum': enumType,\n    'function': functionType,\n    'instanceof': instanceOfType,\n    intersection: intersectionType,\n    lazy: lazyType,\n    literal: literalType,\n    map: mapType,\n    nan: nanType,\n    nativeEnum: nativeEnumType,\n    never: neverType,\n    'null': nullType,\n    nullable: nullableType,\n    number: numberType,\n    object: objectType,\n    oboolean: oboolean,\n    onumber: onumber,\n    optional: optionalType,\n    ostring: ostring,\n    pipeline: pipelineType,\n    preprocess: preprocessType,\n    promise: promiseType,\n    record: recordType,\n    set: setType,\n    strictObject: strictObjectType,\n    string: stringType,\n    symbol: symbolType,\n    transformer: effectsType,\n    tuple: tupleType,\n    'undefined': undefinedType,\n    union: unionType,\n    unknown: unknownType,\n    'void': voidType,\n    NEVER: NEVER,\n    ZodIssueCode: ZodIssueCode,\n    quotelessJson: quotelessJson,\n    ZodError: ZodError\n});\n\nexport { BRAND, DIRTY, EMPTY_PATH, INVALID, NEVER, OK, ParseStatus, ZodType as Schema, ZodAny, ZodArray, ZodBigInt, ZodBoolean, ZodBranded, ZodCatch, ZodDate, ZodDefault, ZodDiscriminatedUnion, ZodEffects, ZodEnum, ZodError, ZodFirstPartyTypeKind, ZodFunction, ZodIntersection, ZodIssueCode, ZodLazy, ZodLiteral, ZodMap, ZodNaN, ZodNativeEnum, ZodNever, ZodNull, ZodNullable, ZodNumber, ZodObject, ZodOptional, ZodParsedType, ZodPipeline, ZodPromise, ZodReadonly, ZodRecord, ZodType as ZodSchema, ZodSet, ZodString, ZodSymbol, ZodEffects as ZodTransformer, ZodTuple, ZodType, ZodUndefined, ZodUnion, ZodUnknown, ZodVoid, addIssueToContext, anyType as any, arrayType as array, bigIntType as bigint, booleanType as boolean, coerce, custom, dateType as date, datetimeRegex, z as default, errorMap as defaultErrorMap, discriminatedUnionType as discriminatedUnion, effectsType as effect, enumType as enum, functionType as function, getErrorMap, getParsedType, instanceOfType as instanceof, intersectionType as intersection, isAborted, isAsync, isDirty, isValid, late, lazyType as lazy, literalType as literal, makeIssue, mapType as map, nanType as nan, nativeEnumType as nativeEnum, neverType as never, nullType as null, nullableType as nullable, numberType as number, objectType as object, objectUtil, oboolean, onumber, optionalType as optional, ostring, pipelineType as pipeline, preprocessType as preprocess, promiseType as promise, quotelessJson, recordType as record, setType as set, setErrorMap, strictObjectType as strictObject, stringType as string, symbolType as symbol, effectsType as transformer, tupleType as tuple, undefinedType as undefined, unionType as union, unknownType as unknown, util, voidType as void, z };\n","import { z } from 'zod';\n\nconst TiledIntProperty = z.object({\n   name: z.string(),\n   type: z.literal('int'),\n   value: z.number().int()\n})\n\nconst TiledBoolProperty = z.object({\n   name: z.string(),\n   type: z.literal('bool'),\n   value: z.boolean()\n})\n\nconst TiledFloatProperty = z.object({\n   name: z.string(),\n   type: z.literal('float'),\n   value: z.number()\n})\n\nconst TiledStringProperty = z.object({\n   name: z.string(),\n   type: z.literal('string'),\n   value: z.string()\n})\n\nconst TiledFileProperty = z.object({\n   name: z.string(),\n   type: z.literal('file'),\n   value: z.string()\n})\n\nconst TiledColorProperty = z.object({\n   name: z.string(),\n   type: z.literal('color'),\n   value: z.string()\n})\n\nconst TiledObjectProperty = z.object({\n   name: z.string(),\n   type: z.literal('object'),\n   value: z.number()\n})\n\nconst TiledProperty = z.discriminatedUnion(\"type\", [\n   TiledIntProperty,\n   TiledBoolProperty,\n   TiledFloatProperty,\n   TiledStringProperty,\n   TiledFileProperty,\n   TiledColorProperty,\n   TiledObjectProperty\n]);\n\nconst TiledTileLayerBase = z.object({\n   name: z.string(),\n   type: z.literal(\"tilelayer\"),\n   class: z.string().optional(),\n   height: z.number(),\n   width: z.number(),\n   x: z.number(),\n   y: z.number(),\n   id: z.number(),\n   opacity: z.number(),\n   properties: z.array(TiledProperty).optional(),\n   visible: z.boolean(),\n   tintcolor: z.string().optional(),\n   parallaxx: z.number().optional(),\n   parallaxy: z.number().optional(),\n   offsetx: z.number().optional(),\n   offsety: z.number().optional(),\n});\n\nconst TiledTileLayerCSV = TiledTileLayerBase.extend({\n   data: z.array(z.number()),\n   encoding: z.literal('csv')\n})\n\nconst TiledTileLayerGZIP = TiledTileLayerBase.extend({\n   data: z.array(z.number()),\n   encoding: z.literal('base64'),\n   compression: z.literal('gzip'),\n})\n\nconst TiledTileLayerZLib = TiledTileLayerBase.extend({\n   data: z.array(z.number()),\n   encoding: z.literal('base64'),\n   compression: z.literal('zlib'),\n})\n\nconst TiledTileLayerZStandard = TiledTileLayerBase.extend({\n   data: z.array(z.number()),\n   encoding: z.literal('base64'),\n   compression: z.literal('zstandard'),\n})\n\nconst TiledTileLayerBase64 = TiledTileLayerBase.extend({\n   data: z.string(),\n   encoding: z.literal('base64'),\n   compression: z.string().optional(),\n});\n\n\nconst TiledTileLayerChunkBase64 = z.object({\n   x: z.number(),\n   y: z.number(),\n   width: z.number(),\n   height: z.number(),\n   data: z.string()\n});\nconst TiledTileLayerChunkCSV = z.object({\n   x: z.number(),\n   y: z.number(),\n   width: z.number(),\n   height: z.number(),\n   data: z.array(z.number())\n});\n\nconst TiledTileLayerChunk = z.union([\n   TiledTileLayerChunkBase64,\n   TiledTileLayerChunkCSV\n]);\n\nexport const TiledTileLayerInfinite = TiledTileLayerBase.extend({\n   startx: z.number(),\n   starty: z.number(),\n   chunks: z.array(TiledTileLayerChunk),\n   encoding: z.string().optional(),\n   compression: z.string().optional(),\n   data: z.undefined()\n});\n\nexport const TiledTileLayer = z.union([\n   TiledTileLayerBase64,\n   TiledTileLayerCSV,\n   TiledTileLayerGZIP,\n   TiledTileLayerZLib,\n   TiledTileLayerZStandard,\n   TiledTileLayerInfinite\n]);\n\nexport function needsDecoding(x: TiledTileLayer): x is TiledTileLayer & { encoding: 'base64', data: string, compression: string } {\n   return (x as any).encoding === 'base64';\n}\n\nexport function isCSV(x: TiledTileLayer): x is TiledTileLayer & { encoding: 'csv', data: number[] } {\n   return (x as any).encoding === 'csv' || Array.isArray((x as any).data);\n}\n\nconst TiledPoint = z.object({\n   x: z.number(),\n   y: z.number()\n});\n\nconst TiledPolygon = z.array(TiledPoint);\n\nexport const TiledText = z.object({\n   text: z.string(),\n   color: z.string().optional(),\n   fontfamily: z.string().optional(),\n   pixelsize: z.number().optional(),\n   wrap: z.boolean().optional(),\n   halign: z.union([z.literal('left'), z.literal('center'), z.literal('right'), z.literal('justify')]).optional(),\n   valign: z.union([z.literal('top'), z.literal('center'), z.literal('bottom')]).optional()\n})\n\nconst TiledObject = z.object({\n   id: z.number().optional(), // Template files might not have an id for some reason\n   name: z.string().optional(),\n   type: z.string().optional(),\n   x: z.number().optional(), // template files dont have x/y sometimes\n   y: z.number().optional(), // template files dont have x/y sometimes\n   rotation: z.number().optional(),\n   height: z.number().optional(),\n   width: z.number().optional(),\n   visible: z.boolean().optional(),\n   gid: z.number().optional(),\n   text: TiledText.optional(),\n   point: z.boolean().optional(),\n   ellipse: z.boolean().optional(),\n   polyline: z.array(TiledPoint).optional(),\n   polygon: TiledPolygon.optional(),\n   template: z.string().optional(),\n   properties: z.array(TiledProperty).optional(),\n});\n\nconst TiledAnimation = z.object({\n   duration: z.number(),\n   tileid: z.number()\n});\n\nconst TiledObjectLayer = z.object({\n   name: z.string(),\n   draworder: z.string(),\n   type: z.literal(\"objectgroup\"),\n   class: z.string().optional(),\n   x: z.number(),\n   y: z.number(),\n   id: z.number(),\n   color: z.string().optional(),\n   tintcolor: z.string().optional(),\n   parallaxx: z.number().optional(),\n   parallaxy: z.number().optional(),\n   offsetx: z.number().optional(),\n   offsety: z.number().optional(),\n   opacity: z.number(),\n   properties: z.array(TiledProperty).optional(),\n   visible: z.boolean(),\n   objects: z.array(TiledObject)\n});\n\nconst TiledImageLayer = z.object({\n   name: z.string(),\n   x: z.number(),\n   y: z.number(),\n   id: z.number(),\n   type: z.literal('imagelayer'),\n   class: z.string().optional(),\n   image: z.string().optional(),\n   opacity: z.number(),\n   properties: z.array(TiledProperty).optional(),\n   visible: z.boolean(),\n   tintcolor: z.string().optional(),\n   repeatx: z.boolean().optional(),\n   repeaty: z.boolean().optional(),\n   parallaxx: z.number().optional(),\n   parallaxy: z.number().optional(),\n   offsetx: z.number().optional(),\n   offsety: z.number().optional(),\n   transparentcolor: z.string().optional()\n});\n\n\n// FIXME recursive Group Layer definition\nconst TiledLayer = z.union([\n   TiledTileLayer,\n   TiledImageLayer,\n   TiledObjectLayer\n]);\n\n\nconst TiledObjectGroup = z.object({\n   draworder: z.string(),\n   id: z.number().optional(), // sometimes tiled doesn't put an id here :( inconsistent\n   name: z.string(),\n   x: z.number(),\n   y: z.number(),\n   opacity: z.number(),\n   tintcolor: z.string().optional(),\n   type: z.literal(\"objectgroup\"),\n   visible: z.boolean(),\n   objects: z.array(TiledObject),\n   properties: z.array(TiledProperty).optional()\n})\n\nexport const TiledTile = z.object({\n   id: z.number(),\n   type: z.string().optional(),\n   animation: z.array(TiledAnimation).optional(),\n   objectgroup: TiledObjectGroup.optional(),\n   probability: z.number().optional(),\n   properties: z.array(TiledProperty).optional(),\n   // Tiles can be collections of images\n   image: z.string().optional(),\n   imageheight: z.number().optional(),\n   imagewidth: z.number().optional()\n})\n\nconst TiledTilesetEmbedded = z.object({\n   name: z.string(),\n   firstgid: z.number().optional(),\n   class: z.string().optional(),\n   objectalignment: z.union([\n      z.literal('topleft'),\n      z.literal('top'),\n      z.literal('topright'),\n      z.literal('left'),\n      z.literal('center'),\n      z.literal('right'),\n      z.literal('bottomleft'),\n      z.literal('bottom'),\n      z.literal('bottomright'),\n   ]).optional(),\n   // optional image/width/height if collection of images\n   image: z.string().optional(),\n   imagewidth: z.number().optional(),\n   imageheight: z.number().optional(),\n   columns: z.number(),\n   tileheight: z.number(),\n   tilewidth: z.number(),\n   tilecount: z.number(),\n\n   grid: z.object({\n      height: z.number(),\n      width: z.number(),\n      orientation: z.union([z.literal('isometric'), z.literal('orthogonal')])\n   }).optional(),\n   // Can specify a drawing offset\n   tileoffset: TiledPoint.optional(),\n   spacing: z.number(),\n   margin: z.number(),\n   tiles: z.array(TiledTile).optional(),\n   properties: z.array(TiledProperty).optional()\n});\n\nexport function isTiledTilesetSingleImage(x: TiledTileset): x is TiledTilesetEmbedded & { image: string, imagewidth: number, imageheight: number } {\n   return !!(x as TiledTilesetEmbedded).image;\n}\n\nexport function isTiledTilesetCollectionOfImages(x: TiledTileset): x is Omit<TiledTilesetEmbedded, 'image' | 'imagewidth' | 'imageheight'> {\n   return !!!(x as TiledTilesetEmbedded).image;\n}\n\nexport const TiledTilesetFile = TiledTilesetEmbedded.extend({\n   tiledversion: z.string().optional(),\n   type: z.literal('tileset'),\n   version: z.string().optional()\n});\n\nconst TiledTilesetExternal = z.object({\n   firstgid: z.number(),\n   source: z.string()\n});\n\nexport const TiledTileset = z.union([TiledTilesetEmbedded, TiledTilesetExternal]);\n\nexport const TiledTemplate = z.object({\n   object: TiledObject.extend({ id: z.number().optional() }),\n   tileset: TiledTilesetExternal.optional(),\n   type: z.literal('template')\n});\n\nexport const TiledMap = z.object({\n   type: z.string(),\n   class: z.string().optional(),\n   tiledversion: z.string(),\n   version: z.string(),\n   width: z.number(),\n   height: z.number(),\n   tilewidth: z.number(),\n   tileheight: z.number(),\n   compressionlevel: z.number().optional(),\n   infinite: z.boolean(),\n   nextlayerid: z.number(),\n   nextobjectid: z.number(),\n   parallaxoriginx: z.number().optional(),\n   parallaxoriginy: z.number().optional(),\n   hexsidelength: z.number().optional(),\n   staggeraxis: z.literal('y').or(z.literal('x')).optional(),\n   staggerindex: z.literal('odd').or(z.literal('even')).optional(),\n   orientation: z.union([z.literal(\"isometric\"), z.literal(\"orthogonal\"), z.literal(\"staggered\"), z.literal(\"hexagonal\")]),\n   renderorder: z.union([z.literal(\"right-down\"), z.literal(\"right-up\"), z.literal(\"left-down\"), z.literal(\"left-up\")]),\n   backgroundcolor: z.string().optional(),\n   layers: z.array(TiledLayer),\n   tilesets: z.array(TiledTileset),\n   properties: z.array(TiledProperty).optional()\n})\n\nexport type TiledObjectGroup = z.infer<typeof TiledObjectGroup>;\nexport type TiledObject = z.infer<typeof TiledObject>;\nexport type TiledTile = z.infer<typeof TiledTile>;\nexport type TiledText = z.infer<typeof TiledText>;\n\nexport type TiledTileset = z.infer<typeof TiledTileset>;\nexport type TiledTilesetEmbedded = z.infer<typeof TiledTilesetEmbedded>;\nexport type TiledTilesetExternal = z.infer<typeof TiledTilesetExternal>;\nexport type TiledTilesetFile = z.infer<typeof TiledTilesetFile>;\n\nexport type TiledTemplate = z.infer<typeof TiledTemplate>;\n\nexport type TiledMap = z.infer<typeof TiledMap>;\nexport type TiledTileLayer = z.infer<typeof TiledTileLayer>;\nexport type TiledTileLayerInfinite = z.infer<typeof TiledTileLayerInfinite>;\nexport type TiledObjectLayer = z.infer<typeof TiledObjectLayer>;\nexport type TiledImageLayer = z.infer<typeof TiledImageLayer>;\nexport type TiledLayer = z.infer<typeof TiledLayer>;\nexport type TiledProperty = z.infer<typeof TiledProperty>;\nexport type TiledPropertyTypes = Pick<TiledProperty, 'type'>['type'];\n\nexport function isInfiniteLayer(tileLayer: TiledTileLayer): tileLayer is TiledTileLayerInfinite {\n   return !!(tileLayer as TiledTileLayerInfinite).chunks;\n}\n\nexport function isTiledTilesetEmbedded(ts: TiledTileset): ts is TiledTilesetEmbedded {\n   return !!!(ts as TiledTilesetExternal).source;\n}\n\nexport function isTiledTilesetExternal(ts: TiledTileset): ts is TiledTilesetExternal {\n   return !!(ts as TiledTilesetExternal).source;\n}\n\n\nclass BoundingBox {\n   constructor(public x: number, public y: number, public width: number, public height: number) { }\n\n   combine(other: BoundingBox) {\n\n      const right = this.x + this.width;\n      const bottom = this.y + this.height;\n\n      const otherRight = other.x + other.width;\n      const otherBottom = other.y + other.height;\n\n      const endRight = Math.max(right, otherRight);\n      const endBottom = Math.max(bottom, otherBottom);\n\n\n      const compositeBB = new BoundingBox(\n         Math.min(this.x, other.x),\n         Math.min(this.y, other.y),\n         endRight - Math.min(this.x, other.x),\n         endBottom - Math.min(this.y, other.y)\n      );\n      return compositeBB;\n   }\n\n}\n\nexport class TiledParser {\n\n   _coerceNumber(value: any) {\n      return +value;\n   }\n   _coerceBoolean(value: any) {\n      switch(value) {\n         case \"0\": return false;\n         case \"false\": return false;\n         case \"true\": return true;\n         default: return !!(Boolean(value));\n      }\n   }\n\n   _coerceType(type: TiledPropertyTypes, value: string) {\n      if (type === 'bool') {\n         return this._coerceBoolean(value);\n      }\n\n      if (type === 'int' || type === 'float') {\n         return this._coerceNumber(value);\n      }\n\n      if (type === 'object') {\n         return this._coerceNumber(value);\n      }\n      return value;\n   }\n\n   _parsePropertiesNode(propertiesNode: Element, target: any) {\n      const properties = [];\n      if (propertiesNode) {\n         for (let prop of propertiesNode.children) {\n            const type = prop.getAttribute('type') as TiledPropertyTypes ?? 'string'; // if no type is set it's string!\n            let value: any = prop.getAttribute('value');\n            if (!value) {\n               value = prop.innerHTML;\n            }\n            properties.push({\n               name: prop.getAttribute('name'),\n               type: type,\n               value: this._coerceType(type, value as string)\n            })\n         }\n      }\n      target.properties = properties;\n   }\n\n   _parseAttributes(node: Element, target: any) {\n      // attribute names to coerce into numbers\n      const numberProps = [\n         'width',\n         'height',\n         'columns',\n         'firstgid',\n         'spacing',\n         'margin',\n         'tilecount',\n         'tilewidth',\n         'tileheight',\n         'opacity',\n         'compressionlevel',\n         'nextlayerid',\n         'nextobjectid',\n         'parallaxoriginx',\n         'parallaxoriginy',\n         'parallaxx',\n         'parallaxy',\n         'hexsidelength',\n         'offsetx',\n         'offsety',\n         'id',\n         'gid',\n         'x',\n         'y',\n         'rotation',\n         'probability'\n      ];\n\n      // attribute names to coerce into booleans\n      const booleanProps = [\n         \"infinite\",\n         'visible',\n         'repeatx',\n         'repeaty',\n      ]\n\n      for (let attribute of node.attributes) {\n         if (numberProps.indexOf(attribute.name as any) > -1) {\n            target[attribute.name] = this._coerceNumber(attribute.value);\n         } else if (booleanProps.indexOf(attribute.name as any) > -1) {\n            target[attribute.name] = this._coerceBoolean(attribute.value);\n         } else {\n            target[attribute.name] = attribute.value;\n         }\n      }\n   }\n\n   /**\n    * Takes an xml string and uses an available parser (DOMParser in browser or JSDOM in Node.js)\n    * to produce a DOM object compatible with at least DOM Level 3.\n    * @param xml\n    * @returns\n    */\n   _parseToDocument(xml: string): Document {\n      if (typeof DOMParser !== 'undefined') {\n         const domParser = new DOMParser();\n         return domParser.parseFromString(xml, 'application/xml');\n      }\n\n      try {\n         const { JSDOM } = require('jsdom');\n         const dom = new JSDOM(xml, {\n            contentType: 'application/xml',\n            encoding: 'utf-8',\n         });\n         return dom.window.document as Document;\n      } catch (e) { /* ignored */ }\n\n      const error = new Error('Could not find DOM parser');\n      console.error(error.message, error);\n      throw error;\n   }\n\n   parseObject(objectNode: Element, strict = true): TiledObject {\n      const object: any = {};\n      object.type = '';\n      object.x = 0;\n      object.y = 0;\n\n      if (!objectNode.getAttribute('template')) {\n         object.visible = true;\n         object.name = '';\n         object.rotation = 0;\n         object.height = 0;\n         object.width = 0;\n      }\n\n      this._parseAttributes(objectNode, object);\n\n\n      const propertiesNode = objectNode.querySelector('properties') as Element;\n      if (propertiesNode) {\n         this._parsePropertiesNode(propertiesNode, object);\n      }\n\n      const text = objectNode.querySelector('text') as Element;\n      if (text) {\n         object.text = {\n            text: text.textContent\n         }\n\n         const fontfamily = text.getAttribute('fontfamily');\n         if (fontfamily) {\n            object.text.fontfamily = fontfamily;\n         }\n\n         const color = text.getAttribute('color');\n         if (color) {\n            object.text.color = color;\n         }\n\n         const pixelsize = text.getAttribute('pixelsize');\n         if (pixelsize) {\n            object.text.pixelsize = this._coerceNumber(pixelsize);\n         }\n\n         const wrap = text.getAttribute('wrap');\n         if (wrap) {\n            object.text.wrap = this._coerceBoolean(wrap);\n         }\n\n         const valign = text.getAttribute('valign');\n         if (valign) {\n            object.text.valign = valign;\n         }\n         const halign = text.getAttribute('halign');\n         if (halign) {\n            object.text.halign = halign;\n         }\n      }\n\n      const point = objectNode.querySelector('point');\n      if (point) {\n         object.point = true;\n      }\n\n      const ellipse = objectNode.querySelector('ellipse');\n      if (ellipse) {\n         object.ellipse = true;\n      }\n\n\n      const polygon = objectNode.querySelector('polygon');\n      if (polygon) {\n         const points = polygon.getAttribute('points')?.split(' ');\n         object.polygon = [];\n         if (points) {\n            points.forEach(p => {\n               const point = p.split(',');\n               object.polygon.push({\n                  x: +point[0],\n                  y: +point[1]\n               })\n            })\n         }\n      }\n\n      const polyline = objectNode.querySelector('polyline');\n      if (polyline) {\n         const points = polyline.getAttribute('points')?.split(' ');\n         object.polyline = [];\n         if (points) {\n            points.forEach(p => {\n               const point = p.split(',');\n               object.polyline.push({\n                  x: +point[0],\n                  y: +point[1]\n               })\n            })\n         }\n      }\n\n      if (strict) {\n         try {\n            return TiledObject.parse(object);\n         } catch (e) {\n            console.error('Could not parse object', object, e);\n            throw e;\n         }\n      }\n      return object as TiledObject;\n   }\n\n   parseTileset(tilesetNode: Element, strict = true): TiledTileset {\n      const tileset: any = {};\n      tileset.spacing = 0;\n      tileset.margin = 0;\n      this._parseAttributes(tilesetNode, tileset);\n\n      if (tileset.source) {\n         try {\n            return TiledTileset.parse(tileset);\n         } catch (e) {\n            console.error('Could not parse external tileset', tileset, e);\n         }\n      }\n\n      for (let tilesetChild of tilesetNode.children) {\n         switch (tilesetChild.tagName) {\n            case 'properties': {\n               this._parsePropertiesNode(tilesetChild, tileset);\n               break;\n            }\n            case 'tileoffset': {\n               const tileoffset: any = {};\n               this._parseAttributes(tilesetChild, tileoffset);\n               tileset.tileoffset = tileoffset;\n               break;\n            }\n            case 'grid': {\n               const grid: any = {};\n               this._parseAttributes(tilesetChild, grid);\n               tileset.grid = grid;\n               break;\n            }\n            case 'image': {\n               tileset.image = tilesetChild.getAttribute('source');\n               tileset.imagewidth = this._coerceNumber(tilesetChild.getAttribute('width'));\n               tileset.imageheight = this._coerceNumber(tilesetChild.getAttribute('height'));\n               break;\n            }\n            case 'tile': {\n               if (!tileset.tiles) {\n                  tileset.tiles = [];\n               }\n               const tile: any = {};\n               this._parseAttributes(tilesetChild, tile);\n               for (let tileChild of tilesetChild.children) {\n                  switch (tileChild.tagName) {\n                     case 'image': {\n                        tile.image = tileChild.getAttribute('source');\n                        tile.imagewidth = this._coerceNumber(tileChild.getAttribute('width'));\n                        tile.imageheight = this._coerceNumber(tileChild.getAttribute('height'));\n                        break;\n                     }\n                     case 'objectgroup': {\n                        const objectgroup: any = {};\n                        objectgroup.type = 'objectgroup';\n                        objectgroup.name = \"\";\n                        objectgroup.visible = true;\n                        objectgroup.x = 0;\n                        objectgroup.y = 0;\n                        objectgroup.opacity = 1;\n                        objectgroup.objects = [];\n                        this._parseAttributes(tileChild, objectgroup);\n                        tile.objectgroup = objectgroup;\n\n                        for (let objectChild of tileChild.children) {\n                           const object = this.parseObject(objectChild, strict);\n                           objectgroup.objects.push(object);\n                        }\n                        break;\n                     }\n                     case 'animation': {\n                        const animation: any = [];\n                        for (let frameChild of tileChild.children) {\n                           animation.push({\n                              duration: this._coerceNumber(frameChild.getAttribute('duration')),\n                              tileid: this._coerceNumber(frameChild.getAttribute('tileid'))\n                           })\n                        }\n\n                        tile.animation = animation;\n                        break;\n                     }\n                     case 'properties': {\n                        this._parsePropertiesNode(tileChild, tile);\n                        break;\n                     }\n                  }\n               }\n\n               if (strict) {\n                  try {\n                     tileset.tiles.push(TiledTile.parse(tile));\n                  } catch (e) {\n                     console.error('Could not parse Tile', tile, e);\n                     throw e;\n                  }\n               } else {\n                  tileset.tiles.push(tile as TiledTile);\n               }\n               break;\n            }\n         }\n      }\n      if (strict) {\n         try {\n            return TiledTileset.parse(tileset);\n         } catch (e) {\n            console.error('Could not parse Tileset', tileset, e);\n            throw e;\n         }\n      }\n      return tileset as TiledTileset;\n   }\n\n   _largestBounds = new BoundingBox(0, 0, 0, 0);\n   parseTileLayer(layerNode: Element, infinite: boolean, strict = true): TiledLayer {\n      const layer: any = {};\n      layer.type = 'tilelayer';\n      layer.x = 0;\n      layer.y = 0;\n      layer.opacity = 1;\n      layer.visible = true;\n      this._parseAttributes(layerNode, layer);\n\n      for (let layerChild of layerNode.children) {\n         switch (layerChild.tagName) {\n            case 'properties': {\n               this._parsePropertiesNode(layerChild, layer);\n               break;\n            }\n            case 'data': {\n               const encoding = layerChild.getAttribute('encoding');\n               // technically breaking compat, but this is useful\n               if (encoding) {\n                  layer.encoding = encoding;\n               }\n\n               const compression = layerChild.getAttribute('compression');\n               if (compression) {\n                  layer.compression = compression;\n               }\n               if (infinite) {\n                  layer.width = 0;\n                  layer.height = 0;\n                  layer.chunks = [];\n                  // Tiled appears to have an undocumented minimum bounds\n                  let bounds: BoundingBox = new BoundingBox(0, 0, 0, 0);\n                  for (let chunkTag of layerChild.children) {\n                     if (chunkTag.tagName === 'chunk') {\n                        const chunk: any = {};\n                        this._parseAttributes(chunkTag, chunk);\n                        switch (layer.encoding) {\n                           case 'base64': {\n                              chunk.data = chunkTag.textContent?.trim();\n                              break;\n                           }\n                           case 'csv': {\n                              chunk.data = chunkTag.textContent?.split(',').map(id => +id);\n                              break;\n                           }\n                        }\n\n                        // combining bounding boxes actually probably is easiest here\n                        const chunkBounds = new BoundingBox(chunk.x, chunk.y, chunk.width, chunk.height);\n\n                        bounds = bounds.combine(chunkBounds);\n\n                        layer.chunks.push(chunk);\n                     }\n                  }\n\n                  layer.width = bounds.width;\n                  layer.height = bounds.height;\n                  layer.startx = bounds.x;\n                  layer.starty = bounds.y;\n\n                  this._largestBounds = this._largestBounds.combine(new BoundingBox(layer.startx, layer.starty, layer.width, layer.height));\n\n               } else {\n                  switch (layer.encoding) {\n                     case 'base64': {\n                        layer.data = layerChild.textContent?.trim();\n                        break;\n                     }\n                     case 'csv': {\n                        layer.data = layerChild.textContent?.split(',').map(id => +id);\n                        break;\n                     }\n                  }\n               }\n            }\n         }\n      }\n      if (strict) {\n         try {\n            return TiledLayer.parse(layer);\n         } catch (e) {\n            console.error('Could not parse tiled tile layer', layer, e);\n            throw e;\n         }\n      }\n      return layer as TiledLayer;\n   }\n\n   parseObjectGroup(groupNode: Element, strict = true): TiledLayer {\n      const group: any = {};\n      group.type = 'objectgroup';\n      group.draworder = 'topdown';\n      group.visible = true;\n      group.x = 0;\n      group.y = 0;\n      group.opacity = 1;\n      group.objects = [];\n      this._parseAttributes(groupNode, group);\n      for (let groupChild of groupNode.children) {\n         switch (groupChild.tagName) {\n            case 'properties': {\n               this._parsePropertiesNode(groupChild, group);\n               break;\n            }\n            case 'object': {\n               const object = this.parseObject(groupChild, strict);\n               group.objects.push(object);\n               break;\n            }\n         }\n      }\n\n      if (strict) {\n         try {\n            return TiledLayer.parse(group);\n         } catch (e) {\n            console.error('Could not parse object group', group, e);\n            throw e;\n         }\n      }\n      return group as TiledLayer;\n   }\n\n   parseImageLayer(imageNode: Element, strict = true): TiledLayer {\n      const imageLayer: any = {};\n      imageLayer.type = 'imagelayer';\n      imageLayer.visible = true;\n      imageLayer.x = 0;\n      imageLayer.y = 0;\n      imageLayer.opacity = 1;\n\n      const image = imageNode.querySelector('image');\n      imageLayer.image = image?.getAttribute('source');\n\n      const properties = imageNode.querySelector('properties');\n      if (properties) {\n         this._parsePropertiesNode(properties, imageLayer);\n      }\n\n      const transparentcolor = image?.getAttribute('trans');\n      if (transparentcolor) {\n         imageLayer.transparentcolor = '#' + transparentcolor;\n      }\n\n      this._parseAttributes(imageNode, imageLayer);\n\n      if (strict) {\n         try {\n            return TiledLayer.parse(imageLayer);\n         } catch (e) {\n            console.error('Could not parse layer', imageLayer, e);\n            throw e;\n         }\n      }\n      return imageLayer as TiledLayer;\n   }\n\n   parseExternalTemplate(txXml: string, strict = true): TiledTemplate {\n      const doc = this._parseToDocument(txXml);\n      const templateElement = doc.querySelector('template') as Element;\n      const template: any = {};\n      template.type = 'template';\n      const objectElement = templateElement.querySelector('object');\n      if (objectElement) {\n         template.object = this.parseObject(objectElement, strict);\n      }\n\n      const tileSetElement = templateElement.querySelector('tileset');\n      if (tileSetElement) {\n         template.tileset = this.parseTileset(tileSetElement, strict);\n      }\n\n      if (strict) {\n         try {\n            return TiledTemplate.parse(template);\n         } catch (e) {\n            console.error('Could not parse template', template, e);\n            throw e;\n         }\n      }\n      return template as TiledTemplate;\n   }\n\n   /**\n    * Takes Tiled tmx xml and produces the equivalent Tiled txj (json) content\n    * @param tsxXml \n    */\n   parseExternalTileset(tsxXml: string, strict = true): TiledTilesetFile {\n      const doc = this._parseToDocument(tsxXml);\n      const tilesetElement = doc.querySelector('tileset') as Element;\n\n      const tileset = this.parseTileset(tilesetElement, strict);\n\n      (tileset as any).type = 'tileset';\n      this._parseAttributes(tilesetElement, tileset);\n\n\n      if (strict) {\n         try {\n            return TiledTilesetFile.parse(tileset);\n         } catch (e) {\n            console.error('Could not parse tileset file', tileset, e);\n            throw e;\n         }\n      }\n      return tileset as TiledTilesetFile;\n   }\n\n\n   /**\n    * Takes Tiled tmx xml and produces the equivalent Tiled tmj (json) content\n    * @param tmxXml \n    * @returns \n    */\n   parse(tmxXml: string, strict = true): TiledMap {\n      const doc = this._parseToDocument(tmxXml);\n      const mapElement = doc.querySelector('map') as Element;\n\n      const tiledMap: any = {};\n      tiledMap.type = 'map';\n      tiledMap.compressionlevel = -1;\n      tiledMap.layers = [];\n      tiledMap.tilesets = [];\n\n      this._parseAttributes(mapElement, tiledMap);\n\n      const parseHelper = (node: Element, strict = true) => {\n         switch (node.tagName) {\n            case 'group': {\n               // recurse through groups!\n               // currently we support groups by flattening them, no group types\n               for (let child of node.children) {\n                  parseHelper(child, strict);\n               }\n               break;\n            }\n            case 'layer': {\n               const layer = this.parseTileLayer(node, tiledMap.infinite, strict);\n               tiledMap.layers.push(layer);\n               \n               break;\n            }\n            case 'properties': {\n               this._parsePropertiesNode(node, tiledMap);\n               break;\n            }\n            case 'tileset': {\n               const tileset = this.parseTileset(node, strict);\n               tiledMap.tilesets.push(tileset);\n               break;\n            }\n            case 'objectgroup': {\n               const objectgroup = this.parseObjectGroup(node, strict);\n               tiledMap.layers.push(objectgroup);\n               break;\n            }\n            case 'imagelayer': {\n               const imageLayer = this.parseImageLayer(node, strict);\n               tiledMap.layers.push(imageLayer);\n               break;\n            }\n         }\n      }\n\n      // Parse all layers\n      for (let mapChild of mapElement.children) {\n         parseHelper(mapChild, strict);\n      }\n\n      if (strict) {\n         try {\n            return TiledMap.parse(tiledMap);\n         } catch (e) {\n            console.error('Could not parse Tiled map', e);\n            throw e;\n         }\n      }\n\n      return tiledMap as TiledMap;\n   }\n}","let init;\nlet instance;\nlet heap;\nconst IMPORT_OBJECT = {\n  env: {\n    emscripten_notify_memory_growth: function (index) {\n      heap = new Uint8Array(instance.exports.memory.buffer);\n    }\n  }\n};\n/**\r\n * ZSTD (Zstandard) decoder.\r\n */\nclass ZSTDDecoder {\n  init() {\n    if (init) return init;\n    if (typeof fetch !== 'undefined') {\n      // Web.\n      init = fetch('data:application/wasm;base64,' + wasm).then(response => response.arrayBuffer()).then(arrayBuffer => WebAssembly.instantiate(arrayBuffer, IMPORT_OBJECT)).then(this._init);\n    } else {\n      // Node.js.\n      init = WebAssembly.instantiate(Buffer.from(wasm, 'base64'), IMPORT_OBJECT).then(this._init);\n    }\n    return init;\n  }\n  _init(result) {\n    instance = result.instance;\n    IMPORT_OBJECT.env.emscripten_notify_memory_growth(0); // initialize heap.\n  }\n\n  decode(array, uncompressedSize = 0) {\n    if (!instance) throw new Error(`ZSTDDecoder: Await .init() before decoding.`);\n    // Write compressed data into WASM memory.\n    const compressedSize = array.byteLength;\n    const compressedPtr = instance.exports.malloc(compressedSize);\n    heap.set(array, compressedPtr);\n    // Decompress into WASM memory.\n    uncompressedSize = uncompressedSize || Number(instance.exports.ZSTD_findDecompressedSize(compressedPtr, compressedSize));\n    const uncompressedPtr = instance.exports.malloc(uncompressedSize);\n    const actualSize = instance.exports.ZSTD_decompress(uncompressedPtr, uncompressedSize, compressedPtr, compressedSize);\n    // Read decompressed data and free WASM memory.\n    const dec = heap.slice(uncompressedPtr, uncompressedPtr + actualSize);\n    instance.exports.free(compressedPtr);\n    instance.exports.free(uncompressedPtr);\n    return dec;\n  }\n}\n/**\r\n * BSD License\r\n *\r\n * For Zstandard software\r\n *\r\n * Copyright (c) 2016-present, Yann Collet, Facebook, Inc. All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *    list of conditions and the following disclaimer.\r\n *\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *    this list of conditions and the following disclaimer in the documentation\r\n *    and/or other materials provided with the distribution.\r\n *\r\n *  * Neither the name Facebook nor the names of its contributors may be used to\r\n *    endorse or promote products derived from this software without specific\r\n *    prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR\r\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\r\n * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n */\n// wasm:begin\nconst wasm = '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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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';\n// wasm:end\n\nexport { ZSTDDecoder };\n//# sourceMappingURL=zstddec.modern.js.map\n","// gzip & zlib\nimport { inflate as pakoInflate } from 'pako';\n// zstd\nimport { ZSTDDecoder } from 'zstddec';\n\nexport class Decoder {\n   /**\n    * Decodes any compressed/encoded Tiled data and produces the canonical list of Tiled gids\n    * @param data \n    * @param options \n    */\n   static decode(data: string, compression?: string): Promise<number[]> {\n      var i: number,\n         j: number,\n         l: number,\n         tmp: number,\n         placeHolders: number,\n         arr: Uint8Array;\n\n      if (data.length % 4 > 0) {\n         throw new Error('Invalid string. Length must be a multiple of 4')\n      }\n\n      var PLUS = '+'.charCodeAt(0);\n      var SLASH = '/'.charCodeAt(0);\n      var NUMBER = '0'.charCodeAt(0);\n      var LOWER = 'a'.charCodeAt(0);\n      var UPPER = 'A'.charCodeAt(0);\n      var PLUS_URL_SAFE = '-'.charCodeAt(0);\n      var SLASH_URL_SAFE = '_'.charCodeAt(0);\n\n      function decode(elt: string): number {\n         var code = elt.charCodeAt(0)\n         if (code === PLUS || code === PLUS_URL_SAFE) return 62 // '+'\n         if (code === SLASH || code === SLASH_URL_SAFE) return 63 // '/'\n         if (code < NUMBER) return -1 // no match\n         if (code < NUMBER + 10) return code - NUMBER + 26 + 26\n         if (code < UPPER + 26) return code - UPPER\n         if (code < LOWER + 26) return code - LOWER + 26\n         throw Error('Could not decode elt');\n      }\n\n      // the number of equal signs (place holders)\n      // if there are two placeholders, than the two characters before it\n      // represent one byte\n      // if there is only one, then the three characters before it represent 2 bytes\n      // this is just a cheap hack to not do indexOf twice\n      var len = data.length\n      placeHolders = data.charAt(len - 2) === '=' ? 2 : data.charAt(len - 1) === '=' ? 1 : 0\n\n      // base64 is 4/3 + up to two characters of the original data\n      arr = new Uint8Array(data.length * 3 / 4 - placeHolders)\n\n      // if there are placeholders, only get up to the last complete 4 chars\n      l = placeHolders > 0 ? data.length - 4 : data.length\n\n      var L = 0\n\n      function push(v: number) {\n         arr[L++] = v\n      }\n\n      for (i = 0, j = 0; i < l; i += 4, j += 3) {\n         tmp = (decode(data.charAt(i)) << 18) | (decode(data.charAt(i + 1)) << 12) | (decode(data.charAt(i + 2)) << 6) | decode(data.charAt(i + 3))\n         push((tmp & 0xFF0000) >> 16)\n         push((tmp & 0xFF00) >> 8)\n         push(tmp & 0xFF)\n      }\n\n      if (placeHolders === 2) {\n         tmp = (decode(data.charAt(i)) << 2) | (decode(data.charAt(i + 1)) >> 4)\n         push(tmp & 0xFF)\n      } else if (placeHolders === 1) {\n         tmp = (decode(data.charAt(i)) << 10) | (decode(data.charAt(i + 1)) << 4) | (decode(data.charAt(i + 2)) >> 2)\n         push((tmp >> 8) & 0xFF)\n         push(tmp & 0xFF)\n      }\n\n      return new Promise(resolve => {\n         const toNumber = function (byteArray: number[] | Uint8Array) {\n            var value = 0;\n\n            for (var i = byteArray.length - 1; i >= 0; i--) {\n               value = (value * 256) + byteArray[i] * 1;\n            }\n\n            return value;\n         };\n\n         // Byte array\n         // handle compression\n         if (\"zlib\" === compression || \"gzip\" === compression) {\n            arr = pakoInflate( arr );\n\n            var resultLen = arr.length / 4;\n            var result = new Array<number>(resultLen);\n\n            for (i = 0; i < resultLen; i++) {\n               result[i] = toNumber(arr.slice(i * 4, i * 4 + 4));\n            }\n            resolve(result);\n         }\n\n         if (\"zstd\" === compression) {\n            const decoder = new ZSTDDecoder();\n            decoder.init().then(() => {\n               arr = decoder.decode(arr);\n               var resultLen = arr.length / 4;\n               var result = new Array<number>(resultLen);\n\n               for (i = 0; i < resultLen; i++) {\n                  result[i] = toNumber(arr.slice(i * 4, i * 4 + 4));\n               }\n               resolve(result);\n            });\n         }\n\n         // no compression just base64\n         if (!compression) {\n            var resultLen = arr.length / 4;\n            var result = new Array<number>(resultLen);\n            for (i = 0; i < resultLen; i++) {\n               result[i] = toNumber(arr.slice(i * 4, i * 4 + 4));\n            }\n            resolve(result);\n         }\n      });\n   }\n}","\r\n/**\r\n * Special excalibur properties\r\n */\r\nexport const ExcaliburTiledProperties = {\r\n   TileData: {\r\n      Tiled: 'ex-tiled'\r\n   },\r\n   ZIndex: {\r\n      /**\r\n       * Override the default z-index based on the ordering in Tiled\r\n       */\r\n      ZIndex: 'zindex'\r\n   },\r\n   Camera: {\r\n      /**\r\n       * Boolean property on an object to treat as the excalibur camera if truthy\r\n       * \r\n       * Warning, the plugin will use the first object it finds with this property!\r\n       */\r\n      Camera: 'camera',\r\n      Zoom: 'zoom'\r\n   },\r\n   Animation: {\r\n      /**\r\n       * String property with any value from the ex.AnimationStrategy enum (case insensitive)\r\n       */\r\n      Strategy: 'animationstrategy'\r\n   },\r\n   Layer: {\r\n      /**\r\n       * Boolean property on a TileLayer, if truthy any tile on the layer will be treated as solid\r\n       * \r\n       * Boolean property on a ObjectLayer, if truthy any object will be created as an actor, objects\r\n       * will have a default collision type of preventcollision, see the collisiontype property.\r\n       */\r\n      Solid: 'solid'\r\n   },\r\n   Collision: {\r\n      /**\r\n       * String property with any value from the ex.CollisionType enum (case insensitive)\r\n       */\r\n      Type: 'collisiontype'\r\n   }\r\n} as const;","\r\n\r\nexport type FileLoader = (path: string, contentType: 'json' | 'xml') => Promise<string | any>;\r\n\r\nexport const FetchLoader: FileLoader = async (path: string, contentType: 'json' | 'xml') => {\r\n   const response = await fetch(path);\r\n   switch(contentType.toLowerCase()) {\r\n      case 'xml': return await response.text();\r\n      case 'json': return await response.json();\r\n      default: return await response.text();\r\n   }\r\n}","\r\nexport const byNameCaseInsensitive = (name?: string) => {\r\n   return <TObject extends {name?: string}>(object: TObject) => {\r\n      if (object?.name && name) {\r\n         return object.name.toLocaleLowerCase().localeCompare(name.toLocaleLowerCase()) === 0;\r\n      }\r\n      return object?.name === name;\r\n   }\r\n}\r\n\r\nexport const byClassCaseInsensitive = (className?: string) => {\r\n   return <TObject extends {class?: string}>(object: TObject) => {\r\n      if (object?.class && className) {\r\n         return object.class.toLocaleLowerCase().localeCompare(className.toLocaleLowerCase()) === 0;\r\n      }\r\n      return object?.class === className;\r\n   }\r\n}\r\n\r\nconst copyPropsLowerCase = (properties: Map<string, string | number | boolean>) => {\r\n   const lowercase = new Map<string, string | number | boolean>();\r\n   for (let [key, value] of properties) {\r\n      let normalizedValue = value;\r\n      if (typeof value === 'string') {\r\n         normalizedValue = value.toLocaleLowerCase();\r\n      }\r\n      lowercase.set(key.toLocaleLowerCase(), normalizedValue);\r\n   }\r\n   return lowercase;\r\n}\r\n\r\nexport const byPropertyCaseInsensitive = (propertyName: string, value?: any) => {\r\n   return <TObject extends {properties: Map<string, string | number | boolean>}>(object: TObject) => {\r\n      const lowercase = copyPropsLowerCase(object.properties);\r\n\r\n      if (value !== undefined) {\r\n         let normalizedValue = value;\r\n         if (typeof value === 'string') {\r\n            normalizedValue = value.toLocaleLowerCase();\r\n         }\r\n\r\n         return lowercase.get(propertyName.toLocaleLowerCase()) === normalizedValue;\r\n      } else {\r\n         return lowercase.has(propertyName.toLocaleLowerCase());\r\n      }\r\n   }\r\n}","// Most significant byte of 32 bit id contains flags for flipping\r\n// See https://doc.mapeditor.org/en/stable/reference/tmx-map-format/#tile-flipping\r\nexport const FLIPPED_HORIZONTALLY_FLAG = 0x80000000;\r\nexport const FLIPPED_VERTICALLY_FLAG   = 0x40000000;\r\nexport const FLIPPED_DIAGONALLY_FLAG   = 0x20000000;\r\n\r\n/**\r\n * Inspects gid for horizontal flag\r\n * @param gid \r\n */\r\nexport const isFlippedHorizontally = (gid: number): boolean => {\r\n   return !!(gid & FLIPPED_HORIZONTALLY_FLAG);\r\n}\r\n\r\n/**\r\n * Inspects gid for vertical flag\r\n * @param gid \r\n */\r\nexport const isFlippedVertically = (gid: number): boolean => {\r\n   return !!(gid & FLIPPED_VERTICALLY_FLAG);\r\n}\r\n\r\n/**\r\n * Inspects gid for diagonal flag (anti-diagonal flip enables tile rotation)\r\n * @param gid \r\n */\r\nexport const isFlippedDiagonally = (gid: number): boolean => {\r\n   return !!(gid & FLIPPED_DIAGONALLY_FLAG);\r\n}\r\n\r\n\r\n/**\r\n * Removes bit flags from gid\r\n * @param gid \r\n */\r\nexport const getCanonicalGid = (gid: number): number => {\r\n   return gid & ~(FLIPPED_HORIZONTALLY_FLAG |\r\n                       FLIPPED_VERTICALLY_FLAG |\r\n                       FLIPPED_DIAGONALLY_FLAG);\r\n\r\n}\r\n","export interface CanLoad {\r\n   load(): Promise<any>;\r\n}\r\n\r\n/**\r\n * Read through cache for loadables\r\n */\r\nexport class LoaderCache<T extends CanLoad> {\r\n   private _loaded = false;\r\n   cache = new Map<string, T>();\r\n\r\n   constructor(public readonly type: new (...args: any[]) => T){}\r\n\r\n   getOrAdd(...args: any[]): T {\r\n      let resource = this.cache.get(args.join('+'));\r\n      if (resource) {\r\n         return resource;\r\n      }\r\n\r\n      resource = new this.type(...args);\r\n      this.cache.set(args.join('+'), resource);\r\n      return resource;\r\n   }\r\n\r\n   values(): T[] {\r\n      if (this._loaded) {\r\n         return Array.from(this.cache.values());\r\n      }\r\n      throw new Error(`Read through cache not yet loaded! No values to return!`);\r\n   }\r\n\r\n   async load() {\r\n      const resources = Array.from(this.cache.entries());\r\n      const results = await Promise.allSettled(resources.map(i => i[1].load()));\r\n\r\n      // Check for errors loading resources\r\n      let errored = 0;\r\n      for (let i = 0; i < results.length; i++) {\r\n         const result = results[i];\r\n         if (result.status === 'rejected') {\r\n            console.error(`Error loading resource at ${resources[i][0]}, is your pathMap correct? or your Tiled map corrupted?`, result.reason);\r\n            errored++;\r\n         }\r\n      }\r\n      if (errored) {\r\n         throw new Error(`Error loading ${errored} resources`);\r\n      }\r\n      this._loaded = true;\r\n   }\r\n}","import { TiledProperty } from \"../parser/tiled-parser\";\r\n\r\nexport interface Properties {\r\n   /**\r\n    * Tiled properties are all lowercased when imported.\r\n    *\r\n    * These are all converted to lowercase keys, and lowercase if the value is a string\r\n    */\r\n   properties: Map<string, string | number | boolean>;\r\n}\r\n\r\n/**\r\n * Maps the tiled source properties, to a JS property map with all keys/values normalized to lowercase where appropriate\r\n * @param target \r\n * @param sourceProps \r\n */\r\nexport function mapProps<T extends Properties>(target: T, sourceProps?: TiledProperty[]) {\r\n   try {\r\n      if (sourceProps) {\r\n         for (const prop of sourceProps) {\r\n            let value = prop.value;\r\n            if (typeof prop.value === 'string') {\r\n               value = prop.value.toLocaleLowerCase();\r\n            }\r\n            target.properties.set(prop.name.toLocaleLowerCase(), value);\r\n         }\r\n      }\r\n   } catch (e) {\r\n      console.error(`Unable to map properties onto ${target}`, e);\r\n   }\r\n}","\r\n\r\nexport type PathMap = { path: string | RegExp, output: string }[];\r\n\r\nexport function filenameFromPath(inputPath: string): string {\r\n   const filenameExpression = /[^/\\\\&\\?]+\\.\\w{2,4}(?=([\\#\\?&].*$|$))/ig\r\n\r\n   const matches = inputPath.match(filenameExpression);\r\n\r\n   if (matches) {\r\n      const match = matches[0];\r\n      return match;\r\n   }\r\n\r\n   throw new Error(`Could not locate filename from path: ${inputPath}`);\r\n}\r\n\r\nexport function mapPath(inputPath: string, pathMap: PathMap): string {\r\n\r\n   for (const { path, output } of pathMap) {\r\n      if (typeof path === 'string') {\r\n         if (inputPath.includes(path)) {\r\n            return output;\r\n         }\r\n      } else {\r\n         const match = inputPath.match(path);\r\n         if (match) {\r\n            return output.replace('[match]', match[0]);;\r\n         }\r\n      }\r\n   }\r\n   return inputPath;\r\n}\r\n\r\nexport function pathInMap(inputPath: string, pathMap?: PathMap): boolean {\r\n   if (!pathMap) return false;\r\n   for (const { path, output } of pathMap) {\r\n      if (typeof path === 'string') {\r\n         if (inputPath.includes(path)) {\r\n            return true;\r\n         }\r\n      } else {\r\n         const match = inputPath.match(path);\r\n         if (match) {\r\n            return true;\r\n         }\r\n      }\r\n   }\r\n   return false;\r\n}\r\n\r\n\r\nexport function pathRelativeToBase(basePath: string, relativeToBase: string, pathMap?: PathMap) {\r\n   if (pathInMap(relativeToBase, pathMap) && pathMap) {\r\n      return mapPath(relativeToBase, pathMap);\r\n   }\r\n\r\n   // Use absolute path if specified\r\n   if (relativeToBase.indexOf('/') === 0) {\r\n      return relativeToBase;\r\n   }\r\n\r\n   const originSplit = basePath.split('/');\r\n   const relativeSplit = relativeToBase.split('/');\r\n   // if origin path is a file, remove it so it's a directory\r\n   if (originSplit[originSplit.length - 1].includes('.')) {\r\n      originSplit.pop();\r\n   }\r\n   return originSplit.concat(relativeSplit).join('/');\r\n}","import { BaseAlign, Color, Font, FontUnit, TextAlign, Vector, vec } from \"excalibur\";\r\nimport { Text as ExText } from 'excalibur';\r\nimport { TiledObject, TiledObjectGroup, TiledText } from \"../parser/tiled-parser\";\r\nimport { Properties, mapProps } from \"./properties\";\r\nimport { Template } from \"./template\";\r\nimport { filenameFromPath } from \"./path-util\";\r\nimport { Tileset } from \"./tileset\";\r\nimport { TiledResource } from \"./tiled-resource\";\r\n\r\nexport interface PluginObjectProps {\r\n   tiledObject: TiledObject;\r\n}\r\n/**\r\n * Plugin object represents the base class of a generic instance of an object used in a map.\r\n *\r\n * It could be more specific as well.\r\n */\r\nexport class PluginObject implements Properties {\r\n   id: number;\r\n   x: number;\r\n   y: number;\r\n   name?: string;\r\n   class?: string;\r\n   tiledObject: TiledObject;\r\n   properties = new Map<string, string | number | boolean>();\r\n   constructor(props: PluginObjectProps) {\r\n      this.tiledObject = props.tiledObject;\r\n      this.name = this.tiledObject.name;\r\n      // Yes this is class in the Tiled UI, it switched from Type -> Class but not all the representations match\r\n      // class mostly synonymous with type in tiled except for a few instances\r\n      this.class = this.tiledObject.type; \r\n      this.id = this.tiledObject.id ?? -1;\r\n      this.x = this.tiledObject.x ?? 0;\r\n      this.y = this.tiledObject.y ?? 0;\r\n   }\r\n}\r\n\r\n/**\r\n * Represents a template instance in a map.\r\n *\r\n * Inherits properties, class, and name from template if not overridden.\r\n */\r\nexport class TemplateObject extends PluginObject {\r\n   public source: string;\r\n   public template: Template;\r\n   public tiledTemplate: TiledObject;\r\n   constructor(tiledObject: TiledObject, template: Template) {\r\n      super({tiledObject});\r\n      if (!tiledObject.template) throw new Error('Invalid template');\r\n      this.source = tiledObject.template\r\n      this.tiledTemplate = tiledObject;\r\n      this.template = template;\r\n\r\n      // Inherited from template object\r\n      if (template.object) {\r\n         this.name = this.name || template.object.name;\r\n         this.class = this.class || template.object.class;\r\n         for (const [key, value] of template.object.properties.entries()) {\r\n            if (!this.properties.has(key)) {\r\n               this.properties.set(key, value);\r\n            }\r\n         }\r\n      }\r\n\r\n      // Inherited from tileset\r\n      if (template.tileset && template.object.tiledObject.gid) {\r\n         const tile = template.tileset.getTileByGid(template.object.tiledObject.gid);\r\n         if (tile) {\r\n            this.class = this.class || tile.class;\r\n            for (const [key, value] of tile.properties.entries()) {\r\n               if (!this.properties.has(key)) {\r\n                  this.properties.set(key, value);\r\n               }\r\n            }\r\n         }\r\n      }\r\n\r\n      \r\n   }\r\n}\r\n\r\n/**\r\n * Represents an instance of an inserted tile object in a map.\r\n */\r\nexport class InsertedTile extends PluginObject {\r\n   constructor(tiledObject: TiledObject, public readonly gid: number, public readonly width: number, public readonly height: number) {\r\n      super({tiledObject});\r\n   }\r\n}\r\n\r\n/**\r\n * Represents an instance of a point object in a map\r\n */\r\nexport class Point extends PluginObject {}\r\n\r\n/**\r\n * Represents an instance of a Text object in a map\r\n */\r\nexport class Text extends PluginObject {\r\n   text: ExText;\r\n   font: Font;\r\n   \r\n   constructor(tiledObject: TiledObject, text: TiledText, width: number, textQuality: number) {\r\n      super({tiledObject});\r\n\r\n      this.font = new Font({\r\n         family: text.fontfamily ?? 'sans-serif',\r\n         color: text.color ? Color.fromHex(text.color) : Color.Black,\r\n         size: text.pixelsize ?? 16,\r\n         unit: FontUnit.Px,\r\n         textAlign: this._textAlignFromTiled(text.halign),\r\n         baseAlign: this._textBaselineFromTiled(text.valign),\r\n         quality: textQuality\r\n      })\r\n\r\n      const textWrap = text.wrap ?? false;\r\n\r\n      this.text = new ExText({\r\n         text: text.text,\r\n         font: this.font,\r\n         ...(textWrap ? {\r\n            maxWidth: width + 10 // FIXME: need to bump by a few pixels for some reason\r\n         }: {})\r\n      });\r\n   }\r\n   _textBaselineFromTiled(code: Pick<TiledText, 'valign'>['valign']){\r\n      switch(code) {\r\n         case 'bottom': {\r\n            return BaseAlign.Bottom;\r\n         }\r\n         case 'center': {\r\n            return BaseAlign.Middle;\r\n         }\r\n         case 'top': {\r\n            return BaseAlign.Top;\r\n         }\r\n         default: {\r\n            return BaseAlign.Top;\r\n         }\r\n      }\r\n   }\r\n\r\n   _textAlignFromTiled(code: Pick<TiledText,'halign'>['halign']) {\r\n      switch(code) {\r\n         case 'left': {\r\n            return TextAlign.Left\r\n         }\r\n         case 'center': {\r\n            return TextAlign.Center\r\n         }\r\n         case 'right': {\r\n            return TextAlign.Right\r\n         }\r\n         case 'justify': {\r\n            return TextAlign.Start\r\n         }\r\n         default: {\r\n            return TextAlign.Left;\r\n         }\r\n      }\r\n   }\r\n}\r\n\r\n/**\r\n * Represents an instance of an ellipse object in a map.\r\n */\r\nexport class Ellipse extends PluginObject {\r\n   constructor(tiledObject: TiledObject, public readonly width: number, public readonly height: number) {\r\n      super({tiledObject});\r\n   }\r\n}\r\n\r\n/**\r\n * Represents an instance of a rectangle object in a map.\r\n */\r\nexport class Rectangle extends PluginObject {\r\n\r\n   constructor(tiledObject: TiledObject, public readonly width: number, public readonly height: number, public readonly anchor: Vector) {\r\n      super({tiledObject});\r\n   }\r\n}\r\n\r\n/**\r\n * Represents an instance of a polygon object in a map.\r\n */\r\nexport class Polygon extends PluginObject {\r\n   /**\r\n    * Transformed world space points\r\n    */\r\n   public readonly points: Vector[] = [];\r\n   /**\r\n    * Local space points\r\n    */\r\n   public readonly localPoints: Vector[] = [];\r\n   constructor(tiledObject: TiledObject, points: {x: number, y: number}[]) {\r\n      super({tiledObject});\r\n      this.localPoints = points.map(p => vec(p.x, p.y));\r\n      this.points = points.map(p => vec(p.x, p.y).add(vec(this.x, this.y)));\r\n   }\r\n}\r\n\r\n/**\r\n * Represents an instance of a polyline object in a map\r\n */\r\nexport class Polyline extends PluginObject {\r\n   public readonly points: Vector[] = []\r\n   constructor(tiledObject: TiledObject, points: {x: number, y: number}[]) {\r\n      super({tiledObject});\r\n      this.points = points.map(p => vec(p.x, p.y));\r\n   }\r\n}\r\n\r\nexport type ObjectTypes = Polygon | Polyline | Rectangle | Ellipse | Text | Point | InsertedTile | PluginObject;\r\n\r\n/**\r\n * Parses a TiledObject and returns a friendly plugin object.\r\n * @param object \r\n * @param resource \r\n * @returns \r\n */\r\nexport function parseObject(object: TiledObject, resource?: TiledResource): PluginObject {\r\n   let newObject: PluginObject;\r\n   if (object.point) {\r\n      // Template objects don't have an id for some reason\r\n      newObject = new Point({tiledObject: object});\r\n   } else if (object.ellipse) {\r\n      if (object.width && object.height) {\r\n         // if defaulted the circle center is accurate, otherwise need to be offset by radius\r\n         newObject = new Ellipse(object, object.width, object.height);\r\n         newObject.x += object.width / 2;\r\n         newObject.y += object.height / 2;\r\n      } else {\r\n         // Tiled undocumented default is 20x20\r\n         newObject = new Ellipse(object, 20, 20);\r\n      }\r\n   } else if (object.polygon) {\r\n      newObject = new Polygon(object, object.polygon);\r\n   } else if (object.polyline) {\r\n      newObject = new Polyline(object, object.polyline);\r\n   } else if(object.text) {\r\n      newObject = new Text(object, object.text, object.width ?? 0, resource?.textQuality ?? 4);\r\n   } else if (object.gid) {\r\n      newObject = new InsertedTile(object, object.gid,  object.width ?? 0, object.height ?? 0);\r\n\r\n      // Check for inherited class names & properties from tileset\r\n      const tileset = resource?.getTilesetForTileGid(object.gid);\r\n      let className = object.type;\r\n      if (tileset) {\r\n         const tile = tileset?.getTileByGid(object.gid);\r\n         className = className || tile?.class;\r\n         if (tile?.properties) {\r\n            for (const [key, value] of tile.properties.entries()) {\r\n               if (!newObject.properties.has(key)) {\r\n                  newObject.properties.set(key, value);\r\n               }\r\n            }\r\n         }\r\n      }\r\n      newObject.class = className;\r\n   } else if (object.template && resource) {\r\n      // FIXME This is problematic if you have files with the same name but different paths\r\n      const template = resource.templates.find(t => filenameFromPath(t.templatePath) === filenameFromPath(object.template!));\r\n      if (template) {\r\n         newObject = new TemplateObject(object, template);\r\n      } else {\r\n         // This is truly an error situation\r\n         throw new Error(`Template object id ${object.id} with name ${object.name} is missing a loaded template file, there should be one loaded from ${object.template}! Is your tiled map or template corrupted?`);\r\n      }\r\n   } else { // rectangle\r\n      if (object.width && object.height) {\r\n         // if defaulted the rectangle center is accurate, otherwise need to be offset by radius\r\n         newObject = new Rectangle(object, object.width, object.height, Vector.Zero);\r\n      } else {\r\n         // Tiled undocumented default is 20x20 AND pivots around the center\r\n         newObject = new Rectangle(object, 20, 20, Vector.Half);\r\n      }\r\n   }\r\n   mapProps(newObject, object.properties);\r\n   return newObject;\r\n}\r\n\r\n/**\r\n * Parses a Tiled Object Group and returns friendly plugin objects.\r\n * @param tiledObjectGroup \r\n * @param resource \r\n * @returns \r\n */\r\nexport function parseObjects(tiledObjectGroup: TiledObjectGroup, resource?: TiledResource) {\r\n   const objects: PluginObject[] = [];\r\n   for (const object of tiledObjectGroup.objects) {\r\n      let newObject: PluginObject = parseObject(object, resource);\r\n      objects.push(newObject);\r\n   }\r\n   return objects;\r\n}","import { TiledTemplate } from \"../parser/tiled-parser\";\r\nimport { PluginObject } from \"./objects\";\r\nimport { Tileset } from \"./tileset\";\r\n\r\nexport interface TemplateOptions {\r\n   templatePath: string;\r\n   object: PluginObject,\r\n   tiledTemplate: TiledTemplate,\r\n   tileset?: Tileset\r\n}\r\n\r\n/**\r\n * Templates are basically a mini tiled resource, they have a self contained object and optionally a tileset\r\n *\r\n * They can be used to instance objects in ObjectLayers, or as part of Tile Collider definitions\r\n */\r\nexport class Template {\r\n   templatePath: string;\r\n   tiledTemplate: TiledTemplate;\r\n   object: PluginObject;\r\n   tileset?: Tileset;\r\n\r\n   constructor(options: TemplateOptions) {\r\n      const { templatePath, object, tiledTemplate, tileset } = options;\r\n      this.templatePath = templatePath;\r\n      this.object = object;\r\n      this.tiledTemplate = tiledTemplate;\r\n      this.tileset = tileset;\r\n   }\r\n}","import { AffineMatrix, Collider, Animation, Frame, Graphic, Shape, Sprite, SpriteSheet, Vector, vec, AnimationStrategy, ImageSource, BoundingBox } from \"excalibur\";\r\nimport { getCanonicalGid, isFlippedDiagonally, isFlippedHorizontally, isFlippedVertically } from \"./gid-util\";\r\nimport { TiledTile, TiledTileset, isTiledTilesetCollectionOfImages, isTiledTilesetSingleImage } from \"../parser/tiled-parser\";\r\nimport { Ellipse, Polygon, Rectangle, parseObjects } from \"./objects\";\r\nimport { Properties, mapProps } from \"./properties\";\r\nimport { PluginObject } from \"./objects\";\r\nimport { byClassCaseInsensitive, byPropertyCaseInsensitive } from \"./filter-util\";\r\n\r\n\r\nexport interface TileOptions {\r\n   id: number;\r\n   tileset: Tileset;\r\n   tiledTile: TiledTile;\r\n   image?: ImageSource;\r\n}\r\n\r\n/**\r\n * Friendly plugin representation of tiled Tile\r\n */\r\nexport class Tile implements Properties {\r\n   id: number;\r\n   tileset: Tileset;\r\n   tiledTile: TiledTile;\r\n   class?: string;\r\n   graphic?: Graphic;\r\n   objects: PluginObject[] = [];\r\n   colliders: Collider[] = [];\r\n   animation: { tileid: number, duration: number }[] = [];\r\n   properties = new Map<string, string | number | boolean>()\r\n   constructor(options: TileOptions) {\r\n      const { id, tileset, tiledTile } = options;\r\n      this.id = id;\r\n      this.tileset = tileset;\r\n      this.tiledTile = tiledTile;\r\n      this.class = tiledTile.type;\r\n\r\n      mapProps(this, tiledTile.properties);\r\n\r\n      if (tiledTile.objectgroup && tiledTile.objectgroup.objects) {\r\n         this.objects = parseObjects(tiledTile.objectgroup);\r\n      }\r\n\r\n      if (tiledTile.animation) {\r\n         this.animation = tiledTile.animation;\r\n      }\r\n\r\n   }\r\n}\r\n\r\nexport interface TilesetOptions {\r\n   name: string;\r\n   tiledTileset: TiledTileset;\r\n   firstGid: number;\r\n   image?: ImageSource;\r\n   tileToImage?: Map<TiledTile, ImageSource>;\r\n}\r\n\r\n/**\r\n * Friendly plugin representation of Tiled tilesets\r\n */\r\nexport class Tileset implements Properties {\r\n   // FIXME fill mode\r\n   name: string;\r\n   class?: string;\r\n   firstGid = -1;\r\n   tileCount: number = 0;\r\n   tiledTileset: TiledTileset;\r\n   tileWidth: number = 0;\r\n   tileHeight: number = 0;\r\n   tileOffset: Vector = vec(0, 0);\r\n   spritesheet!: SpriteSheet;\r\n   tiles: Tile[] = [];\r\n   objectalignment: string = 'bottomleft';\r\n   orientation: 'isometric' | 'orthogonal' = 'orthogonal';\r\n   properties = new Map<string, string | number | boolean>();\r\n\r\n   horizontalFlipTransform!: AffineMatrix;\r\n   verticalFlipTransform!: AffineMatrix;\r\n   diagonalFlipTransform!: AffineMatrix;\r\n\r\n   constructor(options: TilesetOptions) {\r\n      const { name, tiledTileset, image, tileToImage, firstGid } = options;\r\n      this.name = name;\r\n      this.tiledTileset = tiledTileset;\r\n      this.firstGid = firstGid;\r\n\r\n      if (isTiledTilesetSingleImage(tiledTileset)) {\r\n         mapProps(this, tiledTileset.properties);\r\n         const spacing = tiledTileset.spacing;\r\n         const columns = Math.floor((tiledTileset.imagewidth + spacing) / (tiledTileset.tilewidth + spacing));\r\n         const rows = Math.floor((tiledTileset.imageheight + spacing) / (tiledTileset.tileheight + spacing));\r\n         this.class = tiledTileset.class;\r\n         this.orientation = tiledTileset.grid?.orientation ?? 'orthogonal';\r\n         this.horizontalFlipTransform = AffineMatrix.identity().translate(tiledTileset.tilewidth, 0).scale(-1, 1);\r\n         this.verticalFlipTransform = AffineMatrix.identity().translate(0, tiledTileset.tileheight).scale(1, -1);\r\n         this.diagonalFlipTransform = AffineMatrix.identity().translate(0, 0).rotate(-Math.PI / 2).scale(-1, 1);\r\n         this.objectalignment = tiledTileset.objectalignment ?? (this.orientation === 'orthogonal' ? 'bottomleft' : 'bottom');\r\n         if (image) {\r\n            this.spritesheet =  SpriteSheet.fromImageSource({\r\n               image,\r\n               grid: {\r\n                  rows,\r\n                  columns,\r\n                  spriteWidth: tiledTileset.tilewidth,\r\n                  spriteHeight: tiledTileset.tileheight\r\n               },\r\n               spacing: {\r\n                  originOffset: {\r\n                     x: tiledTileset.margin ?? 0,\r\n                     y: tiledTileset.margin ?? 0\r\n                  },\r\n                  margin: {\r\n                     x: tiledTileset.spacing ?? 0,\r\n                     y: tiledTileset.spacing ?? 0\r\n                  }\r\n               }\r\n            });\r\n         }\r\n         this.tileCount = tiledTileset.tilecount;\r\n         this.tileWidth = tiledTileset.tilewidth;\r\n         this.tileHeight = tiledTileset.tileheight;\r\n         if (tiledTileset.tileoffset) {\r\n            this.tileOffset = vec(tiledTileset.tileoffset.x, tiledTileset.tileoffset.y);\r\n         }\r\n         if (tiledTileset.tiles) {\r\n            for (const tile of tiledTileset.tiles) {\r\n               this.tiles.push(new Tile({\r\n                  id: tile.id,\r\n                  tileset: this,\r\n                  tiledTile: tile,\r\n                  ...({ image })\r\n               }))\r\n            }\r\n         }\r\n      }\r\n      if (isTiledTilesetCollectionOfImages(tiledTileset) && tiledTileset.firstgid !== undefined) {\r\n         this.horizontalFlipTransform = AffineMatrix.identity().translate(tiledTileset.tilewidth, 0).scale(-1, 1);\r\n         this.verticalFlipTransform = AffineMatrix.identity().translate(0, tiledTileset.tileheight).scale(1, -1);\r\n         this.diagonalFlipTransform = AffineMatrix.identity().translate(0, 0).rotate(-Math.PI / 2).scale(-1, 1);\r\n         this.objectalignment = tiledTileset.objectalignment ?? (this.orientation === 'orthogonal' ? 'bottomleft' : 'bottom');\r\n         this.orientation = tiledTileset.grid?.orientation ?? 'orthogonal';\r\n         this.tileCount = tiledTileset.tilecount;\r\n         this.tileWidth = tiledTileset.tilewidth;\r\n         this.tileHeight = tiledTileset.tileheight;\r\n         if (tiledTileset.tileoffset) {\r\n            this.tileOffset = vec(tiledTileset.tileoffset.x, tiledTileset.tileoffset.y);\r\n         }\r\n         let sprites: Sprite[] = []\r\n         if (tiledTileset.tiles) {\r\n            for (const tile of tiledTileset.tiles) {\r\n               const image = tileToImage?.get(tile);\r\n               if (image) {\r\n                  sprites.push(image.toSprite())\r\n               }\r\n               this.tiles.push(new Tile({\r\n                  id: tile.id,\r\n                  tileset: this,\r\n                  tiledTile: tile,\r\n                  ...({ image })\r\n               }))\r\n            }\r\n         }\r\n         if (tileToImage) {\r\n            this.spritesheet = new SpriteSheet({ sprites });\r\n         }\r\n      }\r\n   }\r\n\r\n   getTilesetAlignmentAnchor(overrideAlignment?: string) {\r\n      // https://doc.mapeditor.org/en/stable/manual/editing-tilesets/#tileset-properties\r\n      switch(overrideAlignment ?? this.objectalignment) {\r\n         case 'topleft' : {\r\n            return vec(0, 0);\r\n         }\r\n         case 'top' : {\r\n            return vec(0.5, 0);\r\n         }\r\n         case 'topright' : {\r\n            return vec(1, 0);\r\n         }\r\n         case 'left' : {\r\n            return vec(0, .5);\r\n         }\r\n         case 'center' : {\r\n            return vec(0.5, 0.5);\r\n         }\r\n         case 'right' : {\r\n            return vec(1, .5);\r\n         }\r\n         case 'bottomleft' : {\r\n            return vec(0, 1);\r\n         }\r\n         case 'bottom' : {\r\n            return vec(0.5, 1);\r\n         }\r\n         case 'bottomright' : {\r\n            return vec(1, 1);\r\n         }\r\n         default: { // default is bottom left\r\n            return vec(0, 1);\r\n         }\r\n      }\r\n   }\r\n\r\n\r\n   /**\r\n    * Returns any specially configured tiles by gid, Tiled assigns a different id to tiles\r\n    * this helps retrieve tiles by a more common id\r\n    * @param gid\r\n    */\r\n   getTileByGid(gid: number): Tile | undefined {\r\n      const normalizedGid = getCanonicalGid(gid);\r\n      const tileIndex = normalizedGid - this.firstGid;\r\n      const tile = this.tiles.find(t => t.id === tileIndex);\r\n      return tile;\r\n   }\r\n\r\n   getTilesByClassName(className: string): Tile[] {\r\n      return this.tiles.filter(byClassCaseInsensitive(className));\r\n   }\r\n\r\n   getTilesByProperty(name: string, value?: any): Tile[] {\r\n      return this.tiles.filter(byPropertyCaseInsensitive(name, value));\r\n   }\r\n\r\n   getSpriteForGid(gid: number): Sprite {\r\n      const h = isFlippedHorizontally(gid);\r\n      const v = isFlippedVertically(gid);\r\n      const d = isFlippedDiagonally(gid);\r\n      const normalizedGid = getCanonicalGid(gid);\r\n      const spriteIndex = normalizedGid - this.firstGid;\r\n      if (this.spritesheet) {\r\n         let sprite = this.spritesheet.sprites[spriteIndex];\r\n         if (d || h || v) {\r\n            sprite = sprite.clone();\r\n         }\r\n         // See https://github.com/mapeditor/tiled/issues/2119#issuecomment-491533214\r\n         if (d) {\r\n            sprite.rotation = -Math.PI / 2;\r\n            sprite.scale = vec(-1, 1);\r\n         }\r\n         if (h) {\r\n            sprite.scale = vec((d ? 1 : -1) * sprite.scale.x, (d ? -1 : 1) * sprite.scale.y);\r\n         }\r\n         if (v) {\r\n            sprite.scale = vec((d ? -1 : 1) * sprite.scale.x, (d ? 1 : -1) * sprite.scale.y);\r\n         }\r\n         return sprite;\r\n      }\r\n      throw new Error(`Tileset: [${this.name}] Could not find sprite for gid: [${gid}] normalized gid: [${normalizedGid}]`);\r\n   }\r\n\r\n   private _isometricTiledCoordToWorld(isoCoord: Vector): Vector {\r\n      // Transformation sourced from:\r\n      // https://discourse.mapeditor.org/t/how-to-get-cartesian-coords-of-objects-from-tileds-isometric-map/4623/3\r\n      const originX = 0;\r\n      const tileWidth = this.tileWidth;\r\n      // This is slightly different in tilesets because the grid aligns with actual image rectangles\r\n      // Tiled Resource DOES not, and aligns with the \"logical\" height\r\n      const halftileHeight = this.tileHeight / 2; \r\n      const tileY = isoCoord.y / halftileHeight;\r\n      const tileX = isoCoord.x / halftileHeight;\r\n      return vec(\r\n         (tileX - tileY) * tileWidth / 2 + originX,\r\n         (tileX + tileY) * halftileHeight / 2);\r\n   }\r\n\r\n   /**\r\n    * Returns any excalibur colliders setup for a Tile by gid\r\n    * \r\n    * By default it returns the collider in local coordinates, but sometimes you might need the collider in world coordinates\r\n    *\r\n    * Currently only supports Polygons, Boxes, and Ellipses*\r\n    *\r\n    * - Note: Ellipses can only be circles, the minimum dimension will be used to make a circle.\r\n    * @param gid\r\n    */\r\n   getCollidersForGid(gid: number, options?: { anchor?: Vector, scale?: Vector, orientationOverride?: 'isometric' | 'orthogonal', offset?: Vector }): Collider[] {\r\n      let { anchor, scale, orientationOverride, offset } = {\r\n         anchor: Vector.Zero,\r\n         scale: Vector.One,\r\n         offset: Vector.Zero,\r\n         orientationOverride: undefined,\r\n         ...options\r\n      };\r\n      const orientation = orientationOverride ?? this.orientation;\r\n      const tile = this.getTileByGid(gid);\r\n      const result: Collider[] = [];\r\n      if (tile && tile.objects) {\r\n         for (let object of tile.objects) {\r\n            if (object instanceof Polygon) {\r\n               // This is the offset into the first point (local space)\r\n               let points = object.points.map(p => p.scale(scale));\r\n               points = this._applyFlipsToPoints(points, gid);\r\n               if (orientation === 'isometric') {\r\n                  points = points.map(p => this._isometricTiledCoordToWorld(p));\r\n               }\r\n               points = points.map(p => p.add(offset));\r\n               let poly = Shape.Polygon(points, Vector.Zero, true);\r\n               if (!poly.isConvex()) {\r\n                  result.push(poly.triangulate());\r\n               } else {\r\n                  result.push(poly);\r\n               }\r\n            }\r\n            if (object instanceof Rectangle) {\r\n               const bb = BoundingBox.fromDimension(\r\n                  object.width * scale.x,\r\n                  object.height * scale.y,\r\n                  anchor);\r\n               let points = bb.getPoints().map(p => p.add(vec(object.x, object.y)));\r\n               if (orientation === 'isometric') {\r\n                  points = points.map(p => this._isometricTiledCoordToWorld(p));\r\n               }\r\n               points = this._applyFlipsToPoints(points, gid);\r\n               points = points.map(p => p.add(offset));\r\n               const box = Shape.Polygon(points);\r\n               result.push(box);\r\n            }\r\n            if (object instanceof Ellipse) {\r\n               // This is the offset into the first point (local space)\r\n               let offsetPoint = vec(object.x, object.y);\r\n               if (orientation === 'isometric') {\r\n                  offsetPoint = this._isometricTiledCoordToWorld(offsetPoint);\r\n               }\r\n               offsetPoint = offsetPoint.add(offset);\r\n               const radius = Math.min(object.width / 2, object.height / 2);\r\n               const circle = Shape.Circle(radius, offsetPoint.scale(scale));\r\n               result.push(circle);\r\n            }\r\n         }\r\n      }\r\n      return result;\r\n   }\r\n\r\n   /**\r\n    * Transforms points based on any gid transformations\r\n    * @param points\r\n    * @param gid\r\n    */\r\n   private _applyFlipsToPoints(points: Vector[], gid: number): Vector[] {\r\n      const h = isFlippedHorizontally(gid);\r\n      const v = isFlippedVertically(gid);\r\n      const d = isFlippedDiagonally(gid);\r\n      if (d) {\r\n         points = points.map(p => this.diagonalFlipTransform.multiply(p));\r\n      }\r\n      if (h) {\r\n         points = points.map(p => this.horizontalFlipTransform.multiply(p));\r\n      }\r\n      if (v) {\r\n         points = points.map(p => this.verticalFlipTransform.multiply(p));\r\n      }\r\n      return points;\r\n   }\r\n\r\n   public getAnimationForGid(gid: number): Animation | null {\r\n      const tile = this.getTileByGid(gid);\r\n      if (tile && tile.animation?.length) {\r\n         let exFrames: Frame[] = [];\r\n         for (let frame of tile.animation) {\r\n            exFrames.push({\r\n               graphic: this.getSpriteForGid(frame.tileid + this.firstGid),\r\n               duration: frame.duration\r\n            });\r\n         }\r\n         return new Animation({\r\n            frames: exFrames,\r\n            strategy: AnimationStrategy.Loop\r\n         });\r\n      }\r\n      return null;\r\n   }\r\n}","import { ImageSource, Loadable } from \"excalibur\";\r\nimport { Tileset } from \"./tileset\";\r\nimport { TiledParser, TiledTile, TiledTilesetFile, isTiledTilesetCollectionOfImages, isTiledTilesetSingleImage } from \"../parser/tiled-parser\";\r\nimport { FetchLoader, FileLoader } from \"./file-loader\";\r\nimport { PathMap, pathRelativeToBase } from \"./path-util\";\r\nimport { LoaderCache } from \"./loader-cache\";\r\n\r\nexport interface TilesetResourceOptions {\r\n   orientation?: 'isometric' | 'orthogonal';\r\n   headless?: boolean;\r\n   strict?: boolean;\r\n   parser?: TiledParser;\r\n   fileLoader?: FileLoader;\r\n   imageLoader?: LoaderCache<ImageSource>;\r\n   pathMap?: PathMap;\r\n}\r\n\r\nexport class TilesetResource implements Loadable<Tileset> {\r\n   data!: Tileset;\r\n   public readonly firstGid: number;\r\n   public readonly strict: boolean = true;\r\n   public readonly headless: boolean = false;\r\n   public readonly orientation: 'isometric' | 'orthogonal' = 'orthogonal';\r\n\r\n   private fileLoader: FileLoader = FetchLoader;\r\n   private imageLoader: LoaderCache<ImageSource>;\r\n   private pathMap?: PathMap;\r\n   private parser: TiledParser;\r\n\r\n   constructor(public path: string, firstGid: number, options?: TilesetResourceOptions) {\r\n      const { fileLoader, parser, pathMap, imageLoader, strict, headless, orientation } = { ...options };\r\n      this.headless = headless ?? this.headless;\r\n      this.orientation = orientation ?? this.orientation;\r\n      this.strict = strict ?? this.strict;\r\n      this.fileLoader = fileLoader ?? this.fileLoader;\r\n      this.imageLoader = imageLoader ?? new LoaderCache(ImageSource);\r\n      this.parser = parser ?? new TiledParser();\r\n      this.firstGid = firstGid;\r\n      this.pathMap = pathMap;\r\n   }\r\n\r\n   async load(): Promise<Tileset> {\r\n      const tilesetType = this.path.includes('.tsx') ? 'xml' : 'json';\r\n      try {\r\n         const tilesetData = await this.fileLoader(this.path, tilesetType);\r\n         let tileset: TiledTilesetFile;\r\n\r\n         if (tilesetType === 'json') {\r\n            // Verify TMJ is correct\r\n            if (this.strict) {\r\n               tileset = TiledTilesetFile.parse(tilesetData);\r\n            } else {\r\n               tileset = tilesetData as TiledTilesetFile;\r\n            }\r\n         } else {\r\n            // Parse & Verify TMX tileset\r\n            tileset = this.parser.parseExternalTileset(tilesetData, this.strict);\r\n         }\r\n\r\n         if (isTiledTilesetSingleImage(tileset)) {\r\n            const imagePath = pathRelativeToBase(this.path, tileset.image, this.pathMap);\r\n            const image = this.headless ? undefined : this.imageLoader.getOrAdd(imagePath);\r\n            this.data = new Tileset({\r\n               name: tileset.name,\r\n               tiledTileset: tileset,\r\n               firstGid: this.firstGid,\r\n               ...({ image }),\r\n            });\r\n         }\r\n\r\n         if (isTiledTilesetCollectionOfImages(tileset)) {\r\n            const tileToImage = this.headless ? undefined : new Map<TiledTile, ImageSource>();\r\n            if (tileToImage) {\r\n               const images: ImageSource[] = [];\r\n               if (tileset.tiles) {\r\n                  for (let tile of tileset.tiles) {\r\n                     if (tile.image) {\r\n                        const imagePath = pathRelativeToBase(this.path, tile.image, this.pathMap);\r\n                        const image = this.imageLoader.getOrAdd(imagePath);\r\n                        tileToImage.set(tile, image);\r\n                        images.push(image);\r\n                     }\r\n                  }\r\n               }\r\n            }\r\n\r\n            tileset.firstgid = this.firstGid;\r\n            this.data = new Tileset({\r\n               name: tileset.name,\r\n               tiledTileset: tileset,\r\n               firstGid: this.firstGid,\r\n               ...({ tileToImage }),\r\n            });\r\n         }\r\n\r\n         if (!this.headless) {\r\n            await this.imageLoader.load();\r\n         }\r\n\r\n         if (this.data) {\r\n            return this.data\r\n         }\r\n\r\n      } catch (e) {\r\n         console.error(`Could not load tileset at path ${this.path}`);\r\n         throw e;\r\n      }\r\n      throw new Error(`No tileset at path ${this.path}`);\r\n   }\r\n\r\n   isLoaded(): boolean {\r\n      return !!this.data;\r\n   }\r\n}\r\n","import { ImageSource, Loadable } from \"excalibur\";\r\nimport { TiledParser, TiledTemplate } from \"../parser/tiled-parser\";\r\nimport { FetchLoader, FileLoader } from \"./file-loader\";\r\nimport { LoaderCache } from \"./loader-cache\";\r\nimport { parseObject } from \"./objects\";\r\nimport { PathMap, pathRelativeToBase } from \"./path-util\";\r\nimport { Tileset } from \"./tileset\";\r\nimport { Template } from \"./template\";\r\nimport { TilesetResource, TilesetResourceOptions } from \"./tileset-resource\";\r\n\r\nexport interface TemplateResourceOptions {\r\n   headless?: boolean;\r\n   strict?: boolean;\r\n   parser?: TiledParser,\r\n   fileLoader?: FileLoader,\r\n   imageLoader?: LoaderCache<ImageSource>,\r\n   pathMap?: PathMap\r\n}\r\n\r\n/**\r\n * Templates are basically a mini tiled resource, they have a self contained object and optionally a tileset\r\n * \r\n * They can be used to instance objects in ObjectLayers, or as part of Tile Collider definitions\r\n */\r\nexport class TemplateResource implements Loadable<Template> {\r\n   /**\r\n    * [[Template]] is only accessible after .load()\r\n    * \r\n    * Check .isLoaded() to know if it has been loaded\r\n    */\r\n   data!: Template;\r\n   public readonly headless: boolean = false;\r\n   public readonly strict: boolean = true;\r\n\r\n   private parser: TiledParser;\r\n   private fileLoader: FileLoader = FetchLoader;\r\n   private imageLoader: LoaderCache<ImageSource>;\r\n   private pathMap?: PathMap;\r\n\r\n   constructor(public readonly templatePath: string, options?: TemplateResourceOptions) {\r\n      const { fileLoader, parser, pathMap, imageLoader, strict, headless } = {...options};\r\n      this.headless = headless ?? this.headless;\r\n      this.strict = strict ?? this.strict;\r\n      this.fileLoader = fileLoader ?? this.fileLoader;\r\n      this.imageLoader = imageLoader ?? new LoaderCache(ImageSource);\r\n      this.parser = parser ?? new TiledParser();\r\n      this.pathMap = pathMap;\r\n   }\r\n\r\n   isLoaded(): boolean {\r\n      return !!this.data;\r\n   }\r\n\r\n   async load() {\r\n      const templateType = this.templatePath.includes('.tx') ? 'xml' : 'json';\r\n      try {\r\n         const content = await this.fileLoader(this.templatePath, templateType);\r\n         let template: TiledTemplate;\r\n         if (templateType === 'xml') {\r\n            template = this.parser.parseExternalTemplate(content, this.strict);\r\n         } else {\r\n            if (this.strict) {\r\n               template = TiledTemplate.parse(content);\r\n            } else {\r\n               template = content as TiledTemplate;\r\n            }\r\n         }\r\n         const tiledTemplate = template;\r\n         const object = parseObject(template.object);\r\n         let tileset: Tileset | undefined = undefined;\r\n         if (template.tileset) {\r\n            // Template tilesets are not included in the TiledResource list because their gids can collide with map tilesets\r\n            const tilesetPath = pathRelativeToBase(this.templatePath, template.tileset.source, this.pathMap);\r\n            const tilesetResource = new TilesetResource(tilesetPath, template.tileset.firstgid, {\r\n               headless: this.headless,\r\n               strict: this.strict,\r\n               fileLoader: this.fileLoader,\r\n               imageLoader: this.imageLoader,\r\n               parser: this.parser,\r\n               pathMap: this.pathMap\r\n            } satisfies TilesetResourceOptions);\r\n\r\n            tileset = await tilesetResource.load();\r\n         }\r\n\r\n         return this.data = new Template({\r\n            templatePath: this.templatePath,\r\n            tiledTemplate,\r\n            object,\r\n            tileset\r\n         });\r\n\r\n      } catch (e) {\r\n\r\n         console.error(`Could not load template at ${this.templatePath}, check to see if your pathMap is correct or if you're Tiled map is corrupted`);\r\n         throw e;\r\n      }\r\n   }\r\n}","import { Component } from \"excalibur\";\r\nimport { PluginObject } from \"./objects\";\r\n\r\nexport interface TiledDataComponentOptions {\r\n   tiledObject: PluginObject;\r\n}\r\nexport class TiledDataComponent extends Component {\r\n   public tiledObject: PluginObject;\r\n   constructor(options: TiledDataComponentOptions){\r\n      super();\r\n      const {tiledObject} = options;\r\n      this.tiledObject = tiledObject;\r\n   }\r\n}","import { Component } from \"excalibur\";\r\nimport { TiledTileLayer } from \"../parser/tiled-parser\";\r\n\r\nexport interface TiledLayerDataComponentOptions {\r\n   tiledTileLayer: TiledTileLayer;\r\n}\r\n\r\nexport class TiledLayerDataComponent extends Component {\r\n   public readonly tiledTileLayer: TiledTileLayer;\r\n   constructor(options: TiledLayerDataComponentOptions) {\r\n      super();\r\n      const { tiledTileLayer } = options;\r\n      this.tiledTileLayer = tiledTileLayer;\r\n   }\r\n}","import { Color, ParallaxComponent, Vector, vec, GraphicsComponent, Logger, AnimationStrategy, IsometricMap, PolygonCollider, CircleCollider, IsometricTile, IsometricEntityComponent } from \"excalibur\";\nimport { mapProps } from \"./properties\";\nimport { TiledTileLayer, isCSV, isInfiniteLayer, needsDecoding } from \"../parser/tiled-parser\";\nimport { Decoder } from \"./decoder\";\nimport { TiledResource } from \"./tiled-resource\";\nimport { getCanonicalGid } from \"./gid-util\";\nimport { ExcaliburTiledProperties } from \"./excalibur-properties\";\nimport { TiledLayerDataComponent } from \"./tiled-layer-component\";\nimport { Layer } from \"./layer\";\nimport { Tile } from \"./tileset\";\nimport { byClassCaseInsensitive, byPropertyCaseInsensitive } from \"./filter-util\";\n\nexport interface IsometricTileInfo {\n   /**\n    * Tiled based information for the tile\n    */\n   tiledTile?: Tile;\n   /**\n    * Excalibur tile abstraction\n    */\n   exTile: IsometricTile;\n}\n\nexport class IsoTileLayer implements Layer {\n   private logger = Logger.getInstance();\n   public readonly name: string;\n   class?: string | undefined;\n   /**\n    * Number of tiles wide\n    */\n   public readonly width: number = 0;\n   /**\n    * Number of tiles high\n    */\n   public readonly height: number = 0;\n\n   properties = new Map<string, string | number | boolean>();\n\n   /**\n    * Original list of gids for this layer from tiled\n    */\n   data: number[] = [];\n\n   /**\n    * Excalibur IsometricMap structure for drawing in excalibur\n    */\n   isometricMap!: IsometricMap;\n\n   private _gidToTileInfo = new Map<number, IsometricTileInfo[]>();\n\n   constructor(public tiledTileLayer: TiledTileLayer, public resource: TiledResource, public readonly order: number) {\n      this.name = tiledTileLayer.name;\n      this.class = tiledTileLayer.class;\n      this.width = tiledTileLayer.width;\n      this.height = tiledTileLayer.height;\n      mapProps(this, tiledTileLayer.properties);\n   }\n\n   /**\n    * Returns the excalibur tiles that match a tiled gid\n    */\n   getTilesByGid(gid: number): IsometricTileInfo[] {\n      return this._gidToTileInfo.get(gid) ?? [];\n   }\n\n   /**\n    * Returns the excalibur tiles that match a tiled class name\n    * @param className\n    */\n   getTilesByClassName(className: string): IsometricTileInfo[] {\n      const tiles = this.isometricMap.tiles.filter(t => {\n         const maybeTiled = t.data.get(ExcaliburTiledProperties.TileData.Tiled) as Tile | undefined;\n         if (maybeTiled) {\n            return byClassCaseInsensitive(className)(maybeTiled);\n         }\n         return false;\n      });\n\n      return tiles.map(t => ({\n         exTile: t,\n         tiledTile: t.data.get(ExcaliburTiledProperties.TileData.Tiled)\n      }))\n   }\n\n   /**\n    * Returns the excalibur tiles that match a tiled property and optional value\n    * @param name\n    * @param value\n    */\n   getTilesByProperty(name: string, value?: any): IsometricTileInfo[] {\n      const tiles = this.isometricMap.tiles.filter(t => {\n         const maybeTiled = t.data.get(ExcaliburTiledProperties.TileData.Tiled) as Tile | undefined;\n         if (maybeTiled) {\n            return byPropertyCaseInsensitive(name, value)(maybeTiled);\n         }\n         return false;\n      });\n\n      return tiles.map(t => ({\n         exTile: t,\n         tiledTile: t.data.get(ExcaliburTiledProperties.TileData.Tiled)\n      }))\n   }\n\n   getTileByPoint(worldPos: Vector): IsometricTileInfo | null {\n      if (!this.isometricMap) {\n         this.logger.warn('IsometricMap has not yet been loaded! getTileByPoint() will only return null');\n         return null;\n      }\n      if (this.isometricMap) {\n         const exTile = this.isometricMap.getTileByPoint(worldPos);\n         if (!exTile) return null;\n         const tileIndex = this.isometricMap.tiles.indexOf(exTile);\n         const gid = getCanonicalGid(this.data[tileIndex]);\n\n         if (gid <= 0) {\n            return null;\n         }\n\n         const tileset = this.resource.getTilesetForTileGid(gid);\n         const tiledTile = tileset.getTileByGid(gid);\n\n         return { tiledTile, exTile };\n      }\n      return null;\n   }\n\n   private _recordTileData(gid: number, tile: IsometricTile) {\n      let tiles: IsometricTileInfo[] | undefined = this._gidToTileInfo.get(gid);\n      let tileset = this.resource.getTilesetForTileGid(gid);\n      let maybeTile = tileset.getTileByGid(gid);\n      if (!tiles) {\n         tiles = [{exTile: tile, tiledTile: maybeTile}];\n      } else {\n         tiles.push({exTile: tile, tiledTile: maybeTile});\n      }\n      this._gidToTileInfo.set(gid, tiles);\n      tile.data.set(ExcaliburTiledProperties.TileData.Tiled, maybeTile);\n   }\n\n   private updateTile(tile: IsometricTile, gid: number, hasTint: boolean, tint: Color, isSolidLayer: boolean) {\n      this._recordTileData(gid, tile);\n      if (this.resource.useExcaliburWiring && isSolidLayer) {\n         tile.solid = true;\n      }\n\n      const iso = tile.get(IsometricEntityComponent);\n      if (iso) {\n         iso.elevation = this.order;\n      }\n\n      const tileset = this.resource.getTilesetForTileGid(gid);\n      let sprite = tileset.getSpriteForGid(gid);\n      if (hasTint) {\n         sprite = sprite.clone();\n         sprite.tint = tint;\n      }\n      tile.addGraphic(sprite, { offset: tileset.tileOffset });\n\n      let offset = tile.pos;\n      if (tileset.orientation === 'orthogonal') {\n         // Odd rendering case when mixing/matching iso maps with orthogonal tilesets\n         offset = vec(0, 0);\n      } else {\n         const halfWidth = this.resource.map.tilewidth / 2;\n         const height = this.resource.map.tileheight;\n         offset = vec(halfWidth, height);\n      }\n\n      // the whole tilemap uses a giant composite collider relative to the Tilemap\n      // not individual tiles\n      const colliders = tileset.getCollidersForGid(gid, { offset });\n      for (let collider of colliders) {\n         tile.addCollider(collider);\n      }\n\n      let animation = tileset.getAnimationForGid(gid);\n      if (animation) {\n         if (hasTint) {\n            animation = animation.clone();\n            animation.tint = tint;\n         }\n         tile.clearGraphics();\n         tile.addGraphic(animation, { offset: tileset.tileOffset });\n         if (this.resource.useExcaliburWiring) {\n            const tileObj = tileset.getTileByGid(gid);\n            const strategy = tileObj?.properties.get(ExcaliburTiledProperties.Animation.Strategy);\n            if (strategy && typeof strategy === 'string') {\n               switch (strategy.toLowerCase()) {\n                  case AnimationStrategy.End.toLowerCase(): {\n                     animation.strategy = AnimationStrategy.End;\n                     break;\n                  }\n                  case AnimationStrategy.Freeze.toLowerCase(): {\n                     animation.strategy = AnimationStrategy.Freeze;\n                     break;\n                  }\n                  case AnimationStrategy.Loop.toLowerCase(): {\n                     animation.strategy = AnimationStrategy.Loop;\n                     break;\n                  }\n                  case AnimationStrategy.PingPong.toLowerCase(): {\n                     animation.strategy = AnimationStrategy.PingPong;\n                     break;\n                  }\n                  default: {\n                     // unknown animation strategy\n                     this.logger.warn(`Unknown animation strategy in tileset ${tileset.name} on tile gid ${gid}: ${strategy}`);\n                     break;\n                  }\n               }\n            }\n         }\n      }\n   }\n\n   async load(): Promise<void> {\n      const layer = this.tiledTileLayer;\n      const isSolidLayer = !!this.properties.get(ExcaliburTiledProperties.Layer.Solid);\n      const opacity = this.tiledTileLayer.opacity;\n      const hasTint = !!this.tiledTileLayer.tintcolor;\n      const tint = this.tiledTileLayer.tintcolor ? Color.fromHex(this.tiledTileLayer.tintcolor) : Color.Transparent;\n      const pos = vec(layer.offsetx ?? 0, layer.offsety ?? 0);\n      if (this.tiledTileLayer.data && needsDecoding(this.tiledTileLayer)) {\n         this.data = await Decoder.decode(this.tiledTileLayer.data, this.tiledTileLayer.compression);\n      } else if (this.tiledTileLayer.data && isCSV(this.tiledTileLayer)) {\n         this.data = this.tiledTileLayer.data;\n      }\n\n      let order = this.order;\n      let zoverride = this.properties.get(ExcaliburTiledProperties.ZIndex.ZIndex) as number | undefined;\n      if (typeof zoverride === 'number') {\n         order = zoverride;\n      }\n\n\n\n      if (this.resource.map.infinite && isInfiniteLayer(this.tiledTileLayer)) {\n         const start = this.resource.isometricTiledCoordToWorld(this.tiledTileLayer.startx, this.tiledTileLayer.starty);\n         const infiniteStartPos = vec(\n            start.x * this.resource.map.tilewidth,\n            start.y * this.resource.map.tileheight);\n         this.isometricMap = new IsometricMap({\n            name: this.name,\n            pos: pos.add(infiniteStartPos),\n            tileHeight: this.resource.map.tileheight,\n            tileWidth: this.resource.map.tilewidth,\n            columns: layer.width,\n            rows: layer.height,\n            elevation: order\n         });\n      } else {\n         this.isometricMap = new IsometricMap({\n            name: this.name,\n            pos,\n            tileWidth: this.resource.map.tilewidth,\n            tileHeight: this.resource.map.tileheight,\n            columns: layer.width,\n            rows: layer.height,\n            elevation: order\n         });\n      }\n\n      // TODO make these optional params in the ctor\n      this.isometricMap.visible = this.tiledTileLayer.visible;\n      this.isometricMap.opacity = this.tiledTileLayer.opacity;\n      this.isometricMap.addComponent(new TiledLayerDataComponent({ tiledTileLayer: layer }));\n      if (layer.parallaxx || layer.parallaxy) {\n         const factor = vec(layer.parallaxx ?? 1, layer.parallaxy ?? 1);\n         this.isometricMap.addComponent(new ParallaxComponent(factor));\n      }\n\n      if (this.resource.map.infinite && isInfiniteLayer(this.tiledTileLayer)) {\n         const tileLayer = this.tiledTileLayer;\n         for (let chunk of this.tiledTileLayer.chunks) {\n            let chunkData: number[] = [];\n            if (needsDecoding(this.tiledTileLayer)) {\n               chunkData = await Decoder.decode(chunk.data as unknown as string, tileLayer.compression);\n            } else if (isCSV(this.tiledTileLayer)) {\n               chunkData = chunk.data as number[];\n            }\n            for (let i = 0; i < chunkData.length; i++) {\n               const gid = chunkData[i];\n               if (gid != 0) {\n                  // Map from chunk to big tile map\n                  const tileX = (i % chunk.width) + (chunk.x - this.tiledTileLayer.startx);\n                  const tileY = Math.floor(i / chunk.width) + (chunk.y - this.tiledTileLayer.starty);\n                  const tile = this.isometricMap.tiles[tileX + tileY * layer.width];\n                  this.updateTile(tile, gid, hasTint, tint, isSolidLayer);\n               }\n            }\n         }\n      } else {\n         // Read tiled data into Excalibur's tilemap type\n         for (let i = 0; i < this.data.length; i++) {\n            let gid = this.data[i];\n            if (gid !== 0) {\n               const tile = this.isometricMap.tiles[i];\n               this.updateTile(tile, gid, hasTint, tint, isSolidLayer);\n            }\n         }\n      }\n   }\n}\n","import { Color, ParallaxComponent, TileMap, Vector, vec, GraphicsComponent, Logger, AnimationStrategy, TransformComponent, Tile as ExTile } from \"excalibur\";\nimport { mapProps } from \"./properties\";\nimport { TiledTileLayer, isCSV, isInfiniteLayer, needsDecoding } from \"../parser/tiled-parser\";\nimport { Decoder } from \"./decoder\";\nimport { TiledResource } from \"./tiled-resource\";\nimport { getCanonicalGid } from \"./gid-util\";\nimport { ExcaliburTiledProperties } from \"./excalibur-properties\";\nimport { TiledLayerDataComponent } from \"./tiled-layer-component\";\nimport { Layer } from \"./layer\";\nimport { Tile } from \"./tileset\";\nimport { byClassCaseInsensitive, byPropertyCaseInsensitive } from \"./filter-util\";\n\n/**\n * Tile information for both excalibur and tiled tile representations\n */\nexport interface TileInfo {\n   /**\n    * Tiled based information for the tile\n    */\n   tiledTile?: Tile;\n   /**\n    * Excalibur tile abstraction\n    */\n   exTile: ExTile;\n}\n\nexport class TileLayer implements Layer {\n   private logger = Logger.getInstance();\n   public readonly name: string;\n   public readonly class?: string;\n   /**\n    * Number of tiles wide\n    */\n   public readonly width: number = 0;\n   /**\n    * Number of tiles high\n    */\n   public readonly height: number = 0;\n\n   properties = new Map<string, string | number | boolean>();\n\n   /**\n    * Original list of gids for this layer from tiled\n    */\n   data: number[] = [];\n\n   /**\n    * Excalibur TileMap structure for drawing in excalibur\n    */\n   tilemap!: TileMap;\n\n   private _gidToTileInfo = new Map<number, TileInfo[]>();\n\n   /**\n    * Returns the excalibur tiles that match a tiled gid\n    */\n   getTilesByGid(gid: number): TileInfo[] {\n      return this._gidToTileInfo.get(gid) ?? [];\n   }\n\n   /**\n    * Returns the excalibur tiles that match a tiled class name\n    * @param className\n    */\n   getTilesByClassName(className: string): TileInfo[] {\n      const tiles = this.tilemap.tiles.filter(t => {\n         const maybeTiled = t.data.get(ExcaliburTiledProperties.TileData.Tiled) as Tile | undefined;\n         if (maybeTiled) {\n            return byClassCaseInsensitive(className)(maybeTiled);\n         }\n         return false;\n      });\n\n      return tiles.map(t => ({\n         exTile: t,\n         tiledTile: t.data.get(ExcaliburTiledProperties.TileData.Tiled)\n      }))\n   }\n\n   /**\n    * Returns the excalibur tiles that match a tiled property and optional value\n    * @param name\n    * @param value\n    */\n   getTilesByProperty(name: string, value?: any): TileInfo[] {\n      const tiles = this.tilemap.tiles.filter(t => {\n         const maybeTiled = t.data.get(ExcaliburTiledProperties.TileData.Tiled) as Tile | undefined;\n         if (maybeTiled) {\n            return byPropertyCaseInsensitive(name, value)(maybeTiled);\n         }\n         return false;\n      });\n\n      return tiles.map(t => ({\n         exTile: t,\n         tiledTile: t.data.get(ExcaliburTiledProperties.TileData.Tiled)\n      }))\n   }\n\n   getTileByPoint(worldPos: Vector): TileInfo | null {\n      if (!this.tilemap) {\n         this.logger.warn('Tilemap has not yet been loaded! getTileByPoint() will only return null');\n         return null;\n      }\n      if (this.tilemap) {\n         const exTile = this.tilemap.getTileByPoint(worldPos);\n         if (!exTile) return null;\n         const tileIndex = this.tilemap.tiles.indexOf(exTile);\n         const gid = getCanonicalGid(this.data[tileIndex]);\n\n         if (gid <= 0) {\n            return null;\n         }\n\n         const tileset = this.resource.getTilesetForTileGid(gid);\n         const tiledTile = tileset.getTileByGid(gid);\n\n         return { tiledTile, exTile };\n      }\n      return null;\n   }\n\n   getTileByCoordinate(x: number, y: number): TileInfo | null {\n      if (!this.tilemap) {\n         this.logger.warn('Tilemap has not yet been loaded! getTileByCoordinate() will only return null');\n         return null;\n      }\n      if (this.tilemap) {\n         const exTile = this.tilemap.getTile(x, y)!;\n         const tileIndex = this.tilemap.tiles.indexOf(exTile!);\n         const gid = getCanonicalGid(this.data[tileIndex]);\n\n         if (gid <= 0) {\n            return null;\n         }\n\n         const tileset = this.resource.getTilesetForTileGid(gid);\n         const tiledTile = tileset.getTileByGid(gid);\n\n         return { tiledTile, exTile };\n      }\n      return null;\n   }\n\n   constructor(public tiledTileLayer: TiledTileLayer, public resource: TiledResource, public readonly order: number) {\n      this.name = tiledTileLayer.name;\n      this.class = tiledTileLayer.class;\n      this.width = tiledTileLayer.width;\n      this.height = tiledTileLayer.height;\n      mapProps(this, tiledTileLayer.properties);\n   }\n\n   private _recordTileData(gid: number, tile: ExTile) {\n      let tiles: TileInfo[] | undefined = this._gidToTileInfo.get(gid);\n      let tileset = this.resource.getTilesetForTileGid(gid);\n      let maybeTile = tileset.getTileByGid(gid);\n      if (!tiles) {\n         tiles = [{exTile: tile, tiledTile: maybeTile}];\n      } else {\n         tiles.push({exTile: tile, tiledTile: maybeTile});\n      }\n      this._gidToTileInfo.set(gid, tiles);\n      tile.data.set(ExcaliburTiledProperties.TileData.Tiled, maybeTile);\n   }\n\n   private updateTile(tile: ExTile, gid: number, hasTint: boolean, tint: Color, isSolidLayer: boolean) {\n      this._recordTileData(gid, tile);\n      if (this.resource.useExcaliburWiring && isSolidLayer) {\n         tile.solid = true;\n      }\n\n      const tileset = this.resource.getTilesetForTileGid(gid);\n      const headless = this.resource.headless;\n\n      if (!headless) {\n         let sprite = tileset.getSpriteForGid(gid);\n         if (hasTint) {\n            sprite = sprite.clone();\n            sprite.tint = tint;\n         }\n         tile.addGraphic(sprite, { offset: tileset.tileOffset });\n      }\n\n      // the whole tilemap uses a giant composite collider relative to the Tilemap\n      // not individual tiles\n      const colliders = tileset.getCollidersForGid(gid);\n      for (let collider of colliders) {\n         tile.addCollider(collider);\n      }\n\n      let animation = headless ? null : tileset.getAnimationForGid(gid);\n      if (animation) {\n         if (hasTint) {\n            animation = animation.clone();\n            animation.tint = tint;\n         }\n         tile.clearGraphics();\n         tile.addGraphic(animation, { offset: tileset.tileOffset });\n         if (this.resource.useExcaliburWiring) {\n            const tileObj = tileset.getTileByGid(gid);\n            const strategy = tileObj?.properties.get(ExcaliburTiledProperties.Animation.Strategy);\n            if (strategy && typeof strategy === 'string') {\n               switch (strategy.toLowerCase()) {\n                  case AnimationStrategy.End.toLowerCase(): {\n                     animation.strategy = AnimationStrategy.End;\n                     break;\n                  }\n                  case AnimationStrategy.Freeze.toLowerCase(): {\n                     animation.strategy = AnimationStrategy.Freeze;\n                     break;\n                  }\n                  case AnimationStrategy.Loop.toLowerCase(): {\n                     animation.strategy = AnimationStrategy.Loop;\n                     break;\n                  }\n                  case AnimationStrategy.PingPong.toLowerCase(): {\n                     animation.strategy = AnimationStrategy.PingPong;\n                     break;\n                  }\n                  default: {\n                     // unknown animation strategy\n                     this.logger.warn(`Unknown animation strategy in tileset ${tileset.name} on tile gid ${gid}: ${strategy}`);\n                     break;\n                  }\n               }\n            }\n         }\n      }\n   }\n\n   async load() {\n      const opacity = this.tiledTileLayer.opacity;\n      const hasTint = !!this.tiledTileLayer.tintcolor;\n      const tint = this.tiledTileLayer.tintcolor ? Color.fromHex(this.tiledTileLayer.tintcolor) : Color.Transparent;\n      const isSolidLayer = !!this.properties.get(ExcaliburTiledProperties.Layer.Solid);\n      const layer = this.tiledTileLayer;\n      const pos = vec(layer.offsetx ?? 0, layer.offsety ?? 0);\n      if (this.tiledTileLayer.data && needsDecoding(this.tiledTileLayer)) {\n         this.data = await Decoder.decode(this.tiledTileLayer.data, this.tiledTileLayer.compression);\n      } else if (this.tiledTileLayer.data && isCSV(this.tiledTileLayer)) {\n         this.data = this.tiledTileLayer.data;\n      }\n\n      // Create tilemap infinite or not\n      if (this.resource.map.infinite && isInfiniteLayer(this.tiledTileLayer)) {\n         const infiniteStartPos = vec(\n            this.tiledTileLayer.startx * this.resource.map.tilewidth,\n            this.tiledTileLayer.starty * this.resource.map.tileheight);\n         this.tilemap = new TileMap({\n            name: this.name,\n            pos: pos.add(infiniteStartPos),\n            tileHeight: this.resource.map.tileheight,\n            tileWidth: this.resource.map.tilewidth,\n            columns: layer.width,\n            rows: layer.height\n         });\n      } else {\n         this.tilemap = new TileMap({\n            name: this.name,\n            pos,\n            tileWidth: this.resource.map.tilewidth,\n            tileHeight: this.resource.map.tileheight,\n            columns: layer.width,\n            rows: layer.height,\n         });\n      }\n\n      // Common tilemap props\n      this.tilemap.addComponent(new TiledLayerDataComponent({ tiledTileLayer: layer }));\n      const tx = this.tilemap.get(TransformComponent);\n      if (tx) {\n         tx.z = this.order;\n         let zoverride = this.properties.get(ExcaliburTiledProperties.ZIndex.ZIndex) as number | undefined;\n         if (typeof zoverride === 'number') {\n            tx.z = zoverride;\n         }\n      }\n      const graphics = this.tilemap.get(GraphicsComponent);\n      if (graphics) {\n         graphics.visible = this.tiledTileLayer.visible;\n         graphics.opacity = opacity;\n      }\n      if (layer.parallaxx || layer.parallaxy) {\n         const factor = vec(layer.parallaxx ?? 1, layer.parallaxy ?? 1);\n         this.tilemap.addComponent(new ParallaxComponent(factor));\n      }\n\n      // Parse tilemap data infinite or not\n      if (this.resource.map.infinite && isInfiniteLayer(this.tiledTileLayer)) {\n         const tileLayer = this.tiledTileLayer;\n         for (let chunk of this.tiledTileLayer.chunks) {\n            let chunkData: number[] = [];\n            if (needsDecoding(this.tiledTileLayer)) {\n               chunkData = await Decoder.decode(chunk.data as unknown as string, tileLayer.compression);\n            } else if (isCSV(this.tiledTileLayer)) {\n               chunkData = chunk.data as number[];\n            }\n\n            for (let i = 0; i < chunkData.length; i++) {\n               const gid = chunkData[i];\n               if (gid != 0) {\n                  // Map from chunk to big tile map\n                  const tileX = (i % chunk.width) + (chunk.x - this.tiledTileLayer.startx);\n                  const tileY = Math.floor(i / chunk.width) + (chunk.y - this.tiledTileLayer.starty);\n                  const tile = this.tilemap.tiles[tileX + tileY * layer.width];\n                  this.updateTile(tile, gid, hasTint, tint, isSolidLayer);\n               }\n            }\n         }\n      } else {\n         // Read tiled data into Excalibur's tilemap type\n         for (let i = 0; i < this.data.length; i++) {\n            let gid = this.data[i];\n            if (gid !== 0) {\n               const tile = this.tilemap.tiles[i];\n               this.updateTile(tile, gid, hasTint, tint, isSolidLayer);\n            }\n         }\n      }\n   }\n}\n\n\n\n\n","import { Actor, CollisionType, Color, Entity, GraphicsComponent, IsometricEntityComponent, Logger, Shape, Vector, toRadians, vec } from \"excalibur\";\r\nimport { Layer } from \"./layer\";\r\nimport { InsertedTile, PluginObject, TemplateObject, Text, Polygon, Rectangle, Ellipse, parseObjects } from \"./objects\";\r\nimport { TiledObjectLayer } from \"../parser/tiled-parser\";\r\nimport { FactoryProps, TiledResource } from \"./tiled-resource\";\r\nimport { mapProps } from \"./properties\";\r\nimport { byClassCaseInsensitive, byNameCaseInsensitive, byPropertyCaseInsensitive } from \"./filter-util\";\r\nimport { Tileset } from \"./tileset\";\r\nimport { ExcaliburTiledProperties } from \"./excalibur-properties\";\r\nimport { TiledDataComponent } from \"./tiled-data-component\";\r\n\r\nexport class ObjectLayer implements Layer {\r\n   private logger = Logger.getInstance();\r\n\r\n   public readonly name: string;\r\n   public readonly class?: string;\r\n   properties = new Map<string, string | number | boolean>();\r\n   objects: PluginObject[] = [];\r\n   entities: Entity[] = [];\r\n   private _objectToEntity = new Map<PluginObject, Entity>();\r\n   private _entityToObject = new Map<Entity, PluginObject>();\r\n   private _loaded = false;\r\n   constructor(public tiledObjectLayer: TiledObjectLayer, public resource: TiledResource, public readonly order: number) {\r\n      this.name = tiledObjectLayer.name;\r\n      this.class = tiledObjectLayer.class;\r\n\r\n      mapProps(this, tiledObjectLayer.properties);\r\n   }\r\n\r\n   private _logLoadedWarning<TMethod extends keyof ObjectLayer>(name: TMethod) {\r\n      this.logger.warn(`ObjectLayer ${this.name} is not yet loaded, ${name}() will always be empty!`);\r\n   }\r\n\r\n   getObjectsByName(name: string): PluginObject[] {\r\n      if (!this._loaded) this._logLoadedWarning('getObjectsByName');\r\n      return this.objects.filter(byNameCaseInsensitive(name));\r\n   }\r\n\r\n   getEntitiesByName(name: string): Entity[] {\r\n      if (!this._loaded) this._logLoadedWarning('getEntitiesByName');\r\n      return this.entities.filter(byNameCaseInsensitive(name));\r\n   }\r\n\r\n   getEntityByObject(object: PluginObject): Entity | undefined {\r\n      if (!this._loaded) this._logLoadedWarning('getEntityByObject');\r\n      return this._objectToEntity.get(object);\r\n   }\r\n\r\n   getObjectByEntity(actor: Entity): PluginObject | undefined {\r\n      if (!this._loaded) this._logLoadedWarning('getObjectByEntity');\r\n      return this._entityToObject.get(actor);\r\n   }\r\n\r\n   /**\r\n    * Search for a tiled object that has a property name, and optionally specify a value\r\n    * @param propertyName \r\n    * @param value \r\n    * @returns \r\n    */\r\n   getObjectsByProperty(propertyName: string, value?: any): PluginObject[] {\r\n      if (!this._loaded) this._logLoadedWarning('getObjectsByProperty');\r\n      return this.objects.filter(byPropertyCaseInsensitive(propertyName, value));\r\n   }\r\n   /**\r\n    * Search for actors that were created from tiled objects\r\n    * @returns \r\n    */\r\n   getEntitiesByProperty(propertyName: string, value?: any): Entity[] {\r\n      if (!this._loaded) this._logLoadedWarning('getEntitiesByProperty');\r\n      return this.getObjectsByProperty(propertyName, value).map(o => this._objectToEntity.get(o)).filter(a => !!a) as Entity[];\r\n   }\r\n\r\n   /**\r\n    * Search for an Tiled object by it's Tiled class name\r\n    * @returns \r\n    */\r\n   getObjectsByClassName(className: string): PluginObject[] {\r\n      if (!this._loaded) this._logLoadedWarning('getObjectsByClassName');\r\n      return this.objects.filter(byClassCaseInsensitive(className));\r\n   }\r\n\r\n   /**\r\n    * Search for an Actor created by the plugin by it's Tiled object\r\n    * @param className \r\n    * @returns \r\n    */\r\n   getEntitiesByClassName(className: string): Entity[] {\r\n      if (!this._loaded) this._logLoadedWarning('getEntitiesByClassName');\r\n      return this.getObjectsByClassName(className).map(o => this._objectToEntity.get(o)).filter(a => !!a) as Entity[];\r\n   }\r\n\r\n\r\n   getTemplates(): TemplateObject[] {\r\n      if (!this._loaded) this._logLoadedWarning('getTemplates');\r\n      return this.objects.filter(o => o instanceof TemplateObject) as TemplateObject[];\r\n   }\r\n\r\n   /**\r\n    * Runs or re-runs a specific registered factory given a class name on this object layer\r\n    * @param className\r\n    */\r\n   runFactory(className: string) {\r\n      const offset = vec(this.tiledObjectLayer.offsetx ?? 0, this.tiledObjectLayer.offsety ?? 0);\r\n      // create a copy of the objects to prevent editing the current collection\r\n      const objects = this.objects.slice();\r\n      for (let object of objects) {\r\n         let objectType = object.class;\r\n         if (object instanceof TemplateObject) {\r\n            objectType = objectType ? objectType : object.template.object.class;\r\n         }\r\n\r\n         if (className !== objectType) continue;\r\n\r\n         let worldPos = vec((object.x ?? 0) + offset.x, (object.y ?? 0) + offset.y);\r\n\r\n         // When isometric, Tiled positions are in isometric coordinates\r\n         if (this.resource.map.orientation === 'isometric') {\r\n            worldPos = this.resource.isometricTiledCoordToWorld(worldPos.x, worldPos.y);\r\n         }\r\n\r\n         const factory = this.resource.factories.get(className);\r\n         if (factory) {\r\n            // TODO does this entity get added to the scene?\r\n            const entity = factory({\r\n               worldPos,\r\n               name: object.name,\r\n               class: objectType,\r\n               layer: this,\r\n               object,\r\n               properties: object.properties\r\n            } satisfies FactoryProps);\r\n            if (entity) {\r\n               this._recordObjectEntityMapping(object, entity);\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   _actorFromObject(object: PluginObject, newActor: Actor, tileset?: Tileset): void {\r\n      const headless = this.resource.headless;\r\n      const hasTint = !!this.tiledObjectLayer.tintcolor;\r\n      const tint = this.tiledObjectLayer.tintcolor ? Color.fromHex(this.tiledObjectLayer.tintcolor) : Color.White;\r\n\r\n      if (object instanceof InsertedTile && tileset) {\r\n         // handle case where we have isometric map but orthogonal tileset!s\r\n         const overrideAlignment = this.resource.map.orientation === 'isometric' && tileset.orientation === 'orthogonal' ? 'bottom' : undefined;\r\n         const anchor = tileset.getTilesetAlignmentAnchor(overrideAlignment);\r\n         // Inserted tiles pivot from the bottom left in Tiled\r\n         newActor.anchor = anchor;\r\n         const scaleX = (object.tiledObject.width ?? this.resource.map.tilewidth) / this.resource.map.tilewidth;\r\n         const scaleY = (object.tiledObject.width ?? this.resource.map.tilewidth) / this.resource.map.tilewidth;\r\n         const scale = vec(scaleX, scaleY);\r\n\r\n         if (!headless) {\r\n            // need to clone because we are modify sprite properties, sprites are shared by default\r\n            const sprite = tileset.getSpriteForGid(object.gid).clone();\r\n            sprite.destSize.width = object.tiledObject.width ?? sprite.width;\r\n            sprite.destSize.height = object.tiledObject.height ?? sprite.height;\r\n            if (hasTint) {\r\n               sprite.tint = tint;\r\n            }\r\n\r\n            newActor.graphics.use(sprite);\r\n            newActor.graphics.offset = tileset.tileOffset;\r\n\r\n            const animation = tileset.getAnimationForGid(object.gid);\r\n            if (animation) {\r\n               const animationScaled = animation.clone();\r\n               animationScaled.scale = scale;\r\n               if (hasTint) {\r\n                  animationScaled.tint = tint;\r\n               }\r\n               newActor.graphics.use(animationScaled);\r\n               newActor.graphics.offset = tileset.tileOffset;\r\n            }\r\n         }\r\n\r\n         // insertable tiles have an x, y, width, height, gid\r\n         // by default they pivot from the bottom left (0, 1)\r\n         const width = (object.tiledObject.width ?? 0);\r\n         const height = (object.tiledObject.height ?? 0);\r\n         const offsetx = -width * anchor.x;\r\n         const offsety = -height * anchor.y;\r\n         const halfTileWidth = this.resource.map.tilewidth / 2;\r\n         const tileHeight = this.resource.map.tileheight;\r\n         let offset = vec(offsetx, offsety);\r\n         if (this.resource.map.orientation === 'isometric') {\r\n            offset = vec(offsetx + halfTileWidth, offsety + tileHeight);\r\n            if (tileset.orientation === 'orthogonal') {\r\n               // Handling odd case where the tileset is orthogonal but the map is isometric\r\n               offset = offset.sub(vec(halfTileWidth, tileHeight));\r\n            }\r\n         }\r\n\r\n         const colliders = tileset.getCollidersForGid(object.gid, { anchor: Vector.Zero, scale, offset });\r\n         if (colliders.length) {\r\n            newActor.collider.useCompositeCollider(colliders);\r\n         } else {\r\n            let width = object.width;\r\n            let height = object.height;\r\n            if (this.resource.map.orientation === 'isometric') {\r\n               // Isometric uses height to organize grid alignment\r\n               const dimension = object.height / 2;\r\n               width = dimension;\r\n               height = dimension;\r\n            }\r\n            // Anchor at 1,1 for isometric is a quirk of the coord transformation\r\n            let boxCollider = Shape.Box(width, height, this.resource.map.orientation === 'isometric' ? vec(1, 1) : vec(0, 1));\r\n            if (this.resource.map.orientation === 'isometric') {\r\n               boxCollider.points = boxCollider.points.map(p => this.resource.isometricTiledCoordToWorld(p.x, p.y));\r\n            }\r\n            newActor.collider.set(boxCollider);\r\n         }\r\n      }\r\n\r\n      if (object instanceof Text) {\r\n         newActor.graphics.use(object.text);\r\n      }\r\n\r\n      if (object instanceof Polygon) {\r\n         let pos = vec(object.x, object.y);\r\n         let points = object.localPoints;\r\n\r\n         if (this.resource.map.orientation === 'isometric') {\r\n            pos = this.resource.isometricTiledCoordToWorld(pos.x, pos.y);\r\n            points = points.map(p => this.resource.isometricTiledCoordToWorld(p.x, p.y));\r\n         }\r\n\r\n         newActor.anchor = vec(0, 1);\r\n         newActor.pos = pos;\r\n         const polygon = Shape.Polygon(points, Vector.Zero, true);\r\n         if (!polygon.isConvex()) {\r\n            newActor.collider.set(polygon.triangulate());\r\n         } else {\r\n            newActor.collider.set(polygon);\r\n         }\r\n      }\r\n\r\n      if (object instanceof Rectangle) {\r\n         newActor.anchor = object.anchor;\r\n         let boxCollider = Shape.Box(object.width, object.height, object.anchor);\r\n         if (this.resource.map.orientation === 'isometric') {\r\n            boxCollider.points = boxCollider.points.map(p => this.resource.isometricTiledCoordToWorld(p.x, p.y));\r\n         }\r\n         newActor.collider.set(boxCollider);\r\n      }\r\n\r\n      if (object instanceof Ellipse) {\r\n         // FIXME: Circles are positioned differently in isometric as ellipses and currently arent supported\r\n         // FIXME: Excalibur doesn't support ellipses :( fallback to circle\r\n         // pick the smallest dimension and that's our radius\r\n         newActor.collider.useCircleCollider(Math.min(object.width, object.height) / 2);\r\n      }\r\n   }\r\n\r\n   async load() {\r\n      const opacity = this.tiledObjectLayer.opacity;\r\n      const offset = vec(this.tiledObjectLayer.offsetx ?? 0, this.tiledObjectLayer.offsety ?? 0);\r\n      const objects = parseObjects(this.tiledObjectLayer, this.resource);\r\n\r\n      for (let object of objects) {\r\n         let worldPos = vec((object.x ?? 0) + offset.x, (object.y ?? 0) + offset.y);\r\n\r\n         // When isometric, Tiled positions are in isometric coordinates\r\n         if (this.resource.map.orientation === 'isometric') {\r\n            worldPos = this.resource.isometricTiledCoordToWorld(worldPos.x, worldPos.y);\r\n         }\r\n\r\n         let objectType = object.class;\r\n         if (object instanceof TemplateObject) {\r\n            objectType = objectType ? objectType : object.template.object.class;\r\n         }\r\n         if (objectType) {\r\n            const factory = this.resource.factories.get(objectType);\r\n            if (factory) {\r\n               const entity = factory({\r\n                  worldPos,\r\n                  name: object.name,\r\n                  class: objectType,\r\n                  layer: this,\r\n                  object,\r\n                  properties: object.properties\r\n               } satisfies FactoryProps);\r\n               if (entity) {\r\n                  this._recordObjectEntityMapping(object, entity);\r\n               }\r\n               continue; // If we do a factor method we skip any default processing\r\n            }\r\n         }\r\n\r\n         let zindex = undefined;\r\n         let zoverride = this.properties.get(ExcaliburTiledProperties.ZIndex.ZIndex) as number | undefined;\r\n         if (typeof zoverride === 'number') {\r\n            zindex = zoverride;\r\n         }\r\n\r\n         const newActor = new Actor({\r\n            name: object.tiledObject.name,\r\n            pos: worldPos,\r\n            anchor: Vector.Zero,\r\n            rotation: toRadians(object.tiledObject.rotation ?? 0),\r\n            z: zindex\r\n         });\r\n         const graphics = newActor.get(GraphicsComponent);\r\n         if (graphics) {\r\n            graphics.visible = this.tiledObjectLayer.visible && (object.tiledObject.visible === undefined ? true : !!object.tiledObject.visible);\r\n            graphics.opacity = opacity;\r\n         }\r\n\r\n         if (this.resource.map.orientation === 'isometric') {\r\n            const iso = new IsometricEntityComponent({\r\n               rows: this.resource.map.height,\r\n               columns: this.resource.map.width,\r\n               tileWidth: this.resource.map.tilewidth,\r\n               tileHeight: this.resource.map.tileheight\r\n            });\r\n            iso.elevation = zindex ?? this.order;\r\n            newActor.addComponent(iso);\r\n         }\r\n\r\n         if (this.resource.useExcaliburWiring) {\r\n            const collisionType = object.properties.get(ExcaliburTiledProperties.Collision.Type);\r\n            if (collisionType && typeof collisionType === 'string') {\r\n               switch (collisionType.toLowerCase()) {\r\n                  case CollisionType.Active.toLowerCase(): {\r\n                     newActor.body.collisionType = CollisionType.Active;\r\n                     break;\r\n                  }\r\n                  case CollisionType.Fixed.toLowerCase(): {\r\n                     newActor.body.collisionType = CollisionType.Fixed;\r\n                     break;\r\n                  }\r\n                  case CollisionType.Passive.toLowerCase(): {\r\n                     newActor.body.collisionType = CollisionType.Passive;\r\n                     break;\r\n                  }\r\n                  case CollisionType.PreventCollision.toLowerCase(): {\r\n                     newActor.body.collisionType = CollisionType.PreventCollision;\r\n                     break;\r\n                  }\r\n                  default: {\r\n                     this.logger.warn(`Unknown collision type in layer ${this.name}, for object id ${object.id} and name ${object.name}: ${collisionType}`);\r\n                     break;\r\n                  }\r\n               }\r\n            }\r\n         }\r\n\r\n\r\n         if (object instanceof TemplateObject) {\r\n            // templates reference their own tilesets\r\n            const tileset = object.template.tileset;\r\n            if (object.template.object) {\r\n               this._actorFromObject(object.template.object, newActor, tileset);\r\n            }\r\n         } else {\r\n            let tileset: Tileset | undefined;\r\n            if (object instanceof InsertedTile) {\r\n               tileset = this.resource.getTilesetForTileGid(object.gid);\r\n            }\r\n            this._actorFromObject(object, newActor, tileset);\r\n         }\r\n\r\n         this._recordObjectEntityMapping(object, newActor);\r\n      }\r\n\r\n      this._loaded = true;\r\n   }\r\n\r\n   private _recordObjectEntityMapping(object: PluginObject, entity: Entity) {\r\n      entity.addComponent(new TiledDataComponent({\r\n         tiledObject: object\r\n      }));\r\n      this.objects.push(object);\r\n      this.entities.push(entity);\r\n      this._objectToEntity.set(object, entity);\r\n      this._entityToObject.set(entity, object);\r\n   }\r\n}","export const semver = /^[v^~<>=]*?(\\d+)(?:\\.([x*]|\\d+)(?:\\.([x*]|\\d+)(?:\\.([x*]|\\d+))?(?:-([\\da-z\\-]+(?:\\.[\\da-z\\-]+)*))?(?:\\+[\\da-z\\-]+(?:\\.[\\da-z\\-]+)*)?)?)?$/i;\nexport const validateAndParse = (version) => {\n    if (typeof version !== 'string') {\n        throw new TypeError('Invalid argument expected string');\n    }\n    const match = version.match(semver);\n    if (!match) {\n        throw new Error(`Invalid argument not valid semver ('${version}' received)`);\n    }\n    match.shift();\n    return match;\n};\nconst isWildcard = (s) => s === '*' || s === 'x' || s === 'X';\nconst tryParse = (v) => {\n    const n = parseInt(v, 10);\n    return isNaN(n) ? v : n;\n};\nconst forceType = (a, b) => typeof a !== typeof b ? [String(a), String(b)] : [a, b];\nconst compareStrings = (a, b) => {\n    if (isWildcard(a) || isWildcard(b))\n        return 0;\n    const [ap, bp] = forceType(tryParse(a), tryParse(b));\n    if (ap > bp)\n        return 1;\n    if (ap < bp)\n        return -1;\n    return 0;\n};\nexport const compareSegments = (a, b) => {\n    for (let i = 0; i < Math.max(a.length, b.length); i++) {\n        const r = compareStrings(a[i] || '0', b[i] || '0');\n        if (r !== 0)\n            return r;\n    }\n    return 0;\n};\n//# sourceMappingURL=utils.js.map","import { compareVersions } from './compareVersions.js';\n/**\n * Compare [semver](https://semver.org/) version strings using the specified operator.\n *\n * @param v1 First version to compare\n * @param v2 Second version to compare\n * @param operator Allowed arithmetic operator to use\n * @returns `true` if the comparison between the firstVersion and the secondVersion satisfies the operator, `false` otherwise.\n *\n * @example\n * ```\n * compare('10.1.8', '10.0.4', '>'); // return true\n * compare('10.0.1', '10.0.1', '='); // return true\n * compare('10.1.1', '10.2.2', '<'); // return true\n * compare('10.1.1', '10.2.2', '<='); // return true\n * compare('10.1.1', '10.2.2', '>='); // return false\n * ```\n */\nexport const compare = (v1, v2, operator) => {\n    // validate input operator\n    assertValidOperator(operator);\n    // since result of compareVersions can only be -1 or 0 or 1\n    // a simple map can be used to replace switch\n    const res = compareVersions(v1, v2);\n    return operatorResMap[operator].includes(res);\n};\nconst operatorResMap = {\n    '>': [1],\n    '>=': [0, 1],\n    '=': [0],\n    '<=': [-1, 0],\n    '<': [-1],\n    '!=': [-1, 1],\n};\nconst allowedOperators = Object.keys(operatorResMap);\nconst assertValidOperator = (op) => {\n    if (typeof op !== 'string') {\n        throw new TypeError(`Invalid operator type, expected string but got ${typeof op}`);\n    }\n    if (allowedOperators.indexOf(op) === -1) {\n        throw new Error(`Invalid operator, expected one of ${allowedOperators.join('|')}`);\n    }\n};\n//# sourceMappingURL=compare.js.map","import { compareSegments, validateAndParse } from './utils.js';\n/**\n * Compare [semver](https://semver.org/) version strings to find greater, equal or lesser.\n * This library supports the full semver specification, including comparing versions with different number of digits like `1.0.0`, `1.0`, `1`, and pre-release versions like `1.0.0-alpha`.\n * @param v1 - First version to compare\n * @param v2 - Second version to compare\n * @returns Numeric value compatible with the [Array.sort(fn) interface](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort#Parameters).\n */\nexport const compareVersions = (v1, v2) => {\n    // validate input and split into segments\n    const n1 = validateAndParse(v1);\n    const n2 = validateAndParse(v2);\n    // pop off the patch\n    const p1 = n1.pop();\n    const p2 = n2.pop();\n    // validate numbers\n    const r = compareSegments(n1, n2);\n    if (r !== 0)\n        return r;\n    // validate pre-release\n    if (p1 && p2) {\n        return compareSegments(p1.split('.'), p2.split('.'));\n    }\n    else if (p1 || p2) {\n        return p1 ? -1 : 1;\n    }\n    return 0;\n};\n//# sourceMappingURL=compareVersions.js.map","import { Actor, Color, ImageSource, ParallaxComponent, Vector, vec } from \"excalibur\";\r\nimport { Layer } from \"./layer\";\r\nimport { TiledImageLayer } from \"../parser/tiled-parser\";\r\nimport { TiledResource } from \"./tiled-resource\";\r\nimport { mapProps } from \"./properties\";\r\nimport { pathRelativeToBase } from \"./path-util\";\r\n\r\nexport class ImageLayer implements Layer {\r\n   public readonly name: string;\r\n   public readonly class?: string;\r\n   properties = new Map<string, string | number | boolean>();\r\n   image: ImageSource | null = null;\r\n   imageActor: Actor | null = null;\r\n   constructor(public tiledImageLayer: TiledImageLayer, public resource: TiledResource, public readonly order: number) {\r\n      this.name = tiledImageLayer.name;\r\n      this.class = tiledImageLayer.class;\r\n      mapProps(this, tiledImageLayer.properties);\r\n      if (tiledImageLayer.image) {\r\n         this.image = new ImageSource(pathRelativeToBase(this.resource.path, tiledImageLayer.image, this.resource.pathMap))\r\n      }\r\n   }\r\n   async load(): Promise<void> {\r\n      const opacity = this.tiledImageLayer.opacity;\r\n      const hasTint = !!this.tiledImageLayer.tintcolor;\r\n      const tint = this.tiledImageLayer.tintcolor ? Color.fromHex(this.tiledImageLayer.tintcolor) : Color.White;\r\n      const offset = vec(this.tiledImageLayer.offsetx ?? 0, this.tiledImageLayer.offsety ?? 0);\r\n      const parallaxx = this.tiledImageLayer.parallaxx ?? 1;\r\n      const parallaxy = this.tiledImageLayer.parallaxy ?? 1;\r\n      if (this.image) {\r\n         if (!this.resource.headless) {\r\n            await this.image.load();\r\n         }\r\n         this.imageActor = new Actor({\r\n            name: this.tiledImageLayer.name,\r\n            pos: offset,\r\n            anchor: Vector.Zero,\r\n            z: this.order\r\n         });\r\n         this.imageActor.addComponent(new ParallaxComponent(vec(parallaxx, parallaxy)))\r\n         // FIXME when excalibur supports tiling we should use it here for repeatx/repeaty!\r\n         const sprite = this.image.toSprite();\r\n         this.imageActor.graphics.use(sprite);\r\n         this.imageActor.graphics.visible = this.tiledImageLayer.visible;\r\n         this.imageActor.graphics.opacity = opacity;\r\n         if (hasTint) {\r\n            sprite.tint = tint;\r\n         }\r\n      }\r\n   }\r\n}","import { BoundingBox, Color, Entity, ImageSource, Loadable, Logger, Scene, TransformComponent, Vector, vec } from \"excalibur\";\r\nimport { TiledMap, TiledParser, TiledTile, isTiledTilesetCollectionOfImages, isTiledTilesetEmbedded, isTiledTilesetExternal, isTiledTilesetSingleImage } from \"../parser/tiled-parser\";\r\nimport { Tile, Tileset } from \"./tileset\";\r\nimport { Layer } from \"./layer\";\r\nimport { IsometricTileInfo } from \"./iso-tile-layer\";\r\nimport { TileInfo } from \"./tile-layer\";\r\nimport { IsoTileLayer } from \"./iso-tile-layer\";\r\nimport { TileLayer } from \"./tile-layer\";\r\nimport { ObjectLayer } from './object-layer';\r\nimport { Template } from \"./template\";\r\nimport { compare } from \"compare-versions\";\r\nimport { getCanonicalGid } from \"./gid-util\";\r\nimport { PathMap, pathRelativeToBase } from \"./path-util\";\r\nimport { PluginObject } from \"./objects\";\r\nimport { byClassCaseInsensitive, byNameCaseInsensitive, byPropertyCaseInsensitive } from \"./filter-util\";\r\nimport { ExcaliburTiledProperties } from \"./excalibur-properties\";\r\nimport { FetchLoader, FileLoader } from './file-loader';\r\nimport { TilesetResource, TilesetResourceOptions } from \"./tileset-resource\";\r\nimport { LoaderCache } from \"./loader-cache\";\r\nimport { TemplateResource, TemplateResourceOptions } from \"./template-resource\";\r\nimport { ImageLayer } from \"./image-layer\";\r\n\r\nexport interface TiledAddToSceneOptions {\r\n   pos: Vector;\r\n}\r\n\r\nexport interface TiledResourceOptions {\r\n\r\n   /**\r\n    * Plugin will operate in headless mode and skip all graphics related\r\n    * excalibur items including creating ImageSource's for Tiled items.\r\n    *\r\n    * Default false.\r\n    */\r\n   headless?: boolean;\r\n\r\n   /**\r\n    * Add a starting z index for the layers to use. By default the layers count up from 0.\r\n    *\r\n    * If you'd like to manually override a z-index on a layer use the 'zindex' custom property on a layer.\r\n    */\r\n   startZIndex?: number;\r\n\r\n   /**\r\n    * Default true. If false, only tilemap will be parsed and displayed, it's up to you to wire up any excalibur behavior.\r\n    * Automatically wires excalibur to the following\r\n    * * Wire up current scene camera\r\n    * * Make Actors/Tiles with colliders on Tiled tiles & Tiled objects\r\n    * * Support solid layers\r\n    *\r\n    * Read more at excaliburjs.com!\r\n    */\r\n   useExcaliburWiring?: boolean;\r\n\r\n   /**\r\n    * Sets excalibur's background color to match the Tiled map\r\n    */\r\n   useMapBackgroundColor?: boolean;\r\n\r\n\r\n   /**\r\n    * Keeps the camera viewport within the bounds of the TileMap, uses the first tile layer's bounds.\r\n    *\r\n    * Defaults true, if false the camera will use the layer bounds to keep the camera from showing the background.\r\n    */\r\n   useTilemapCameraStrategy?: boolean\r\n\r\n   /**\r\n    * Plugin detects the map type based on extension, if you know better you can force an override.\r\n    */\r\n   mapFormatOverride?: 'TMX' | 'TMJ';\r\n\r\n   /**\r\n    * The pathMap helps work around odd things bundlers do with static files by providing a way to redirect the original\r\n    * source paths in the Tiled files to new locations.\r\n    *\r\n    * When the Tiled resource comes across something that matches `path`, it will use the output string instead.\r\n    * \r\n    * Example:\r\n    * ```typescript\r\n    * const newResource = new TiledResource('./example-city.tmx', {\r\n    *     pathMap: [\r\n    *        // If the \"path\" is included in the source path, the output will be used\r\n    *        { path: 'cone.tx', output: '/static/assets/cone.tx' },\r\n    *        // Regex matching with special [match] in output string that is replaced with the first match from the regex\r\n    *        { path: /(.*\\..*$)/, output: '/static/assets/[match]'}\r\n    *     ]\r\n    *  }\r\n    * ```\r\n    */\r\n   pathMap?: PathMap;\r\n\r\n   /**\r\n    * Optionally provide a custom file loader implementation instead of using the built in ajax (fetch) loader\r\n    * that takes a path and returns file data\r\n    * \r\n    */\r\n   fileLoader?: FileLoader;\r\n\r\n   /**\r\n    * By default `true`, means Tiled files must pass the plugins Typed parse pass.\r\n    *\r\n    * If you have something that the Tiled plugin does not expect, you can set this to false and it will do it's best\r\n    * to parse the Tiled source map file.\r\n    */\r\n   strict?: boolean;\r\n\r\n   /**\r\n    * Configure the text quality to use in Excalibur's Text implementation for the Tiled resources that involve text\r\n    *\r\n    * By default it's 4 for 4x scaled bitmap\r\n    */\r\n   textQuality?: number;\r\n\r\n   /**\r\n    * Configure custom Actor/Entity factory functions to construct Actors/Entities\r\n    * given a Tiled class name.\r\n    */\r\n   entityClassNameFactories?: Record<string, (props: FactoryProps) => Entity | undefined>;\r\n}\r\n\r\nexport interface FactoryProps {\r\n   /**\r\n    * Excalibur world position\r\n    */\r\n   worldPos: Vector;\r\n   /**\r\n    * Tiled name in UI\r\n    */\r\n   name?: string;\r\n   /**\r\n    * Tiled class in UI (internally in Tiled is represented as the string 'type')\r\n    */\r\n   class: string;\r\n   /**\r\n    * Layer (either TileLayer or ObjectLayer) that this object is part of\r\n    */\r\n   layer: Layer;\r\n   /**\r\n    * If using an object layer or a tile object property, the object will be passed.\r\n    */\r\n   object?: PluginObject;\r\n   /**\r\n    * Tiled properties, these are all converted to lowercase keys, and lowercase if the value is a string\r\n    */\r\n   properties: Record<string, any>;\r\n}\r\n\r\nexport class TiledResource implements Loadable<any> {\r\n   private logger = Logger.getInstance();\r\n   /**\r\n    * Currently the latest tested and supported version of Tiled\r\n    * with the Excalibur Tiled plugin\r\n    */\r\n   public static supportedTiledVersion = '1.10.1';\r\n   data: any;\r\n\r\n   /**\r\n    * The original tiled map representation in Tiled JSON/TMJ format\r\n    * \r\n    * If loaded from a Tiled TMX file, it has been converted to the same JSON/TMJ format\r\n    */\r\n   map!: TiledMap;\r\n   /**\r\n    * A list of Tilesets from Tiled in a friendly data structure (original TSX/TSJ is available on that type)\r\n    */\r\n   tilesets: Tileset[] = [];\r\n   /**\r\n    * A list of Templates from Tiled in a friendly data structure (original TX/TJ is available on that type)\r\n    */\r\n   templates: Template[] = [];\r\n   /**\r\n    * A list of Layers from Tiled in a friendly data structure (original layer format is available on that type)\r\n    *\r\n    * Layers can either be an ObjectLayer, TileLayer, or ImageLayer\r\n    *\r\n    * GroupLayers don't exist in the plugin, they are flattened and the proper order preserved.\r\n    */\r\n   layers: Layer[] = [];\r\n\r\n   public readonly mapFormat: 'TMX' | 'TMJ' = 'TMX';\r\n   public readonly strict: boolean = true;\r\n\r\n   public factories = new Map<string, (props: FactoryProps) => Entity | undefined>();\r\n\r\n   public parser = new TiledParser();\r\n\r\n   public fileLoader: FileLoader = FetchLoader;\r\n\r\n   public pathMap: PathMap | undefined;\r\n\r\n   public readonly startZIndex: number = 0;\r\n   public readonly textQuality: number = 4;\r\n   public readonly useExcaliburWiring: boolean = true;\r\n   public readonly useMapBackgroundColor: boolean = false;\r\n   public readonly useTilemapCameraStrategy: boolean = false;\r\n   public readonly headless: boolean = false;\r\n\r\n   private _imageLoader = new LoaderCache(ImageSource);\r\n   private _tilesetLoader = new LoaderCache(TilesetResource);\r\n   private _templateLoader = new LoaderCache(TemplateResource);\r\n   constructor(public readonly path: string, options?: TiledResourceOptions) {\r\n      const {\r\n         mapFormatOverride,\r\n         textQuality,\r\n         entityClassNameFactories,\r\n         useExcaliburWiring,\r\n         useTilemapCameraStrategy,\r\n         useMapBackgroundColor,\r\n         pathMap,\r\n         fileLoader,\r\n         strict,\r\n         headless,\r\n         startZIndex\r\n      } = { ...options };\r\n      this.strict = strict ?? this.strict;\r\n      this.headless = headless ?? this.headless;\r\n      this.useExcaliburWiring = useExcaliburWiring ?? this.useExcaliburWiring;\r\n      this.useTilemapCameraStrategy = useTilemapCameraStrategy ?? this.useTilemapCameraStrategy;\r\n      this.useMapBackgroundColor = useMapBackgroundColor ?? this.useMapBackgroundColor;\r\n      this.textQuality = textQuality ?? this.textQuality;\r\n      this.startZIndex = startZIndex ?? this.startZIndex;\r\n      this.fileLoader = fileLoader ?? this.fileLoader;\r\n      this.pathMap = pathMap;\r\n      for (const key in entityClassNameFactories) {\r\n         this.registerEntityFactory(key, entityClassNameFactories[key]);\r\n      }\r\n      this.mapFormat = mapFormatOverride ?? (path.includes('.tmx') ? 'TMX' : 'TMJ');\r\n   }\r\n\r\n   /**\r\n    * Registers an entity factory to run on load, if added after load it will be run immediately\r\n    * @param className \r\n    * @param factory \r\n    */\r\n   registerEntityFactory(className: string, factory: (props: FactoryProps) => Entity | undefined): void {\r\n      if (this.factories.has(className)) {\r\n         console.warn(`Another factory has already been registered for tiled class/type \"${className}\", this is probably a bug.`);\r\n      }\r\n      this.factories.set(className, factory);\r\n      if (this.isLoaded()) {\r\n         for (let objectLayer of this.getObjectLayers()) {\r\n            objectLayer.runFactory(className);\r\n         }\r\n      }\r\n   }\r\n\r\n   unregisterEntityFactory(className: string) {\r\n      if (!this.factories.has(className)) {\r\n         console.warn(`No factory has been registered for tiled class/type \"${className}\", cannot unregister!`);\r\n      }\r\n      this.factories.delete(className);\r\n   }\r\n\r\n   /**\r\n    * Given a gid, find the Tileset it belongs to in the map!\r\n    * @param gid \r\n    * @returns \r\n    */\r\n   getTilesetForTileGid(gid: number): Tileset {\r\n      const normalizedGid = getCanonicalGid(gid)\r\n      if (this.tilesets) {\r\n         for (let tileset of this.tilesets) {\r\n            if (normalizedGid >= tileset.firstGid && normalizedGid <= tileset.firstGid + tileset.tileCount - 1) {\r\n               return tileset;\r\n            }\r\n         }\r\n      }\r\n      throw Error(`No tileset exists for tiled gid [${gid}] normalized [${normalizedGid}]!`);\r\n   }\r\n\r\n   /**\r\n    * Queries for tilesets in the map by name (case insensitive)\r\n    * @param name \r\n    * @returns \r\n    */\r\n   getTilesetByName(name: string): Tileset[] {\r\n      return this.tilesets.filter(byNameCaseInsensitive(name));\r\n   }\r\n   /**\r\n    * Queries for tilesets in the map by class name (case insensitive)\r\n    * @param className \r\n    * @returns \r\n    */\r\n   getTilesetByClassName(className: string): Tileset[] {\r\n      return this.tilesets.filter(byClassCaseInsensitive(className));\r\n   }\r\n\r\n   /**\r\n    * Queries for tilesets in the map by property and an optional value (case insensitive)\r\n    * @param propertyName \r\n    * @param value \r\n    * @returns \r\n    */\r\n   getTilesetByProperty(propertyName: string, value?: any): Tileset[] {\r\n      return this.tilesets.filter(byPropertyCaseInsensitive(propertyName, value));\r\n   }\r\n\r\n   /**\r\n    * Queries ALL tilesets tile data in the map for a specific class name (case insensitive)\r\n    * @param className \r\n    * @returns \r\n    */\r\n   getTileMetadataByClassName(className: string): Tile[] {\r\n      let results: Tile[] = [];\r\n      for (let tileset of this.tilesets) {\r\n         results = results.concat(tileset.tiles.filter(byClassCaseInsensitive(className)));\r\n      }\r\n      return results;\r\n   }\r\n\r\n   /**\r\n    * Queries ALL tilesets tile data in the map for a specific property and an optional value (case insensitive)\r\n    * @param name \r\n    * @param value \r\n    * @returns \r\n    */\r\n   getTileMetadataByProperty(name: string, value?: any): Tile[] {\r\n      let results: Tile[] = [];\r\n      for (let tileset of this.tilesets) {\r\n         results = results.concat(tileset.tiles.filter(byPropertyCaseInsensitive(name, value)));\r\n      }\r\n      return results;\r\n   }\r\n\r\n\r\n   /**\r\n    * Queries ALL tile layers tile instances in the map for a specific gid\r\n    * @param className \r\n    * @returns \r\n    */\r\n   getTilesByGid(gid: number): TileInfo[] | IsometricTileInfo[] {\r\n      if (this.map.orientation === 'orthogonal') {\r\n         let results: TileInfo[] = [];\r\n         for (let layer of this.getTileLayers()) {\r\n            results = results.concat(layer.getTilesByGid(gid));\r\n         }\r\n         return results;\r\n      } else {\r\n         let results: IsometricTileInfo[] = [];\r\n         for (let layer of this.getIsoTileLayers()) {\r\n            results = results.concat(layer.getTilesByGid(gid));\r\n         }\r\n         return results;\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Queries ALL tile layers tile instances in the map for a specific class name (case insensitive)\r\n    * @param className \r\n    * @returns \r\n    */\r\n   getTilesByClassName(className: string): TileInfo[] | IsometricTileInfo[] {\r\n      if (this.map.orientation === 'orthogonal') {\r\n         let results: TileInfo[] = [];\r\n         for (let layer of this.getTileLayers()) {\r\n            results = results.concat(layer.getTilesByClassName(className));\r\n         }\r\n         return results;\r\n      } else {\r\n         let results: IsometricTileInfo[] = [];\r\n         for (let layer of this.getIsoTileLayers()) {\r\n            results = results.concat(layer.getTilesByClassName(className));\r\n         }\r\n         return results;\r\n      }\r\n   }\r\n\r\n   /**\r\n    *  Queries ALL tile layers tile instances in the map for a specific property and an optional value (case insensitive)\r\n    * @param name \r\n    * @param value \r\n    * @returns \r\n    */\r\n   getTilesByProperty(name: string, value?: any): TileInfo[] | IsometricTileInfo[] {\r\n      if (this.map.orientation === 'orthogonal') {\r\n         let results: TileInfo[] = [];\r\n         for (let layer of this.getTileLayers()) {\r\n            results = results.concat(layer.getTilesByProperty(name, value));\r\n         }\r\n         return results;\r\n      } else {\r\n         let results: IsometricTileInfo[] = [];\r\n         for (let layer of this.getIsoTileLayers()) {\r\n            results = results.concat(layer.getTilesByProperty(name, value));\r\n         }\r\n         return results;\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Returns a tile by the world position from a layer. (Uses the first layer name that matches case insensitive).\r\n    * @param layerName \r\n    * @param worldPos \r\n    * @returns \r\n    */\r\n   getTileByPoint(layerName: string, worldPos: Vector): TileInfo | IsometricTileInfo | null {\r\n      if (this.map.orientation === 'isometric') {\r\n         const layer = this.getIsoTileLayers().find(byNameCaseInsensitive(layerName));\r\n         if (layer) {\r\n            return layer.getTileByPoint(worldPos);\r\n         }\r\n      } else {\r\n         const layer = this.getTileLayers().find(byNameCaseInsensitive(layerName));\r\n         if (layer) {\r\n            return layer.getTileByPoint(worldPos);\r\n         }\r\n      }\r\n\r\n      return null;\r\n   }\r\n\r\n   /**\r\n    * Returns a tile by the world position from a layer. (Uses the first layer name that matches case insensitive).\r\n    * @param layerName \r\n    * @param worldPos \r\n    * @returns \r\n    */\r\n   getTilesByPoint(worldPos: Vector): TileInfo[] | IsometricTileInfo[] {\r\n      if (this.map.orientation === 'orthogonal') {\r\n         let results: TileInfo[] = [];\r\n         for (let layer of this.getTileLayers()) {\r\n            const maybeTile = layer.getTileByPoint(worldPos);\r\n            if (maybeTile) {\r\n               results.push(maybeTile);\r\n            }\r\n         }\r\n         return results;\r\n      } else {\r\n         let results: IsometricTileInfo[] = [];\r\n         for (let layer of this.getIsoTileLayers()) {\r\n            const maybeTile = layer.getTileByPoint(worldPos);\r\n            if (maybeTile) {\r\n               results.push(maybeTile);\r\n            }\r\n         }\r\n         return results;\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Queries all layers for objects that match a name (case insensitive)\r\n    * @param name \r\n    * @returns \r\n    */\r\n   getObjectsByName(name: string): PluginObject[] {\r\n      let results: PluginObject[] = [];\r\n      for (let objectlayer of this.getObjectLayers()) {\r\n         results = results.concat(objectlayer.getObjectsByName(name));\r\n      }\r\n      return results;\r\n   }\r\n\r\n   getEntitiesByName(name: string): Entity[] {\r\n      let results: Entity[] = [];\r\n      for (let objectlayer of this.getObjectLayers()) {\r\n         results = results.concat(objectlayer.getEntitiesByName(name));\r\n      }\r\n      return results;\r\n   }\r\n\r\n   getEntityByObject(object: PluginObject): Entity | undefined {\r\n      for (let objectlayer of this.getObjectLayers()) {\r\n         const entity = objectlayer.getEntityByObject(object);\r\n         if (entity) {\r\n            return entity;\r\n         }\r\n      }\r\n      return;\r\n   }\r\n\r\n   getObjectByEntity(actor: Entity): PluginObject | undefined {\r\n      for (let objectlayer of this.getObjectLayers()) {\r\n         const object = objectlayer.getObjectByEntity(actor);\r\n         if (object) {\r\n            return object;\r\n         }\r\n      }\r\n      return;\r\n   }\r\n\r\n   /**\r\n    * Search for a tiled object that has a property name, and optionally specify a value\r\n    * @param propertyName \r\n    * @param value \r\n    * @returns \r\n    */\r\n   getObjectsByProperty(propertyName: string, value?: any): PluginObject[] {\r\n      let results: PluginObject[] = [];\r\n      for (let objectlayer of this.getObjectLayers()) {\r\n         results = results.concat(objectlayer.getObjectsByProperty(propertyName, value));\r\n      }\r\n      return results;\r\n   }\r\n   /**\r\n    * Search for actors that were created from tiled objects\r\n    * @returns \r\n    */\r\n   getEntitiesByProperty(propertyName: string, value?: any): Entity[] {\r\n      let results: Entity[] = [];\r\n      for (let objectlayer of this.getObjectLayers()) {\r\n         results = results.concat(objectlayer.getEntitiesByProperty(propertyName, value));\r\n      }\r\n      return results;\r\n   }\r\n\r\n   /**\r\n    * Search for an Tiled object by it's Tiled class name\r\n    * @returns \r\n    */\r\n   getObjectsByClassName(className: string): PluginObject[] {\r\n      let results: PluginObject[] = [];\r\n      for (let objectlayer of this.getObjectLayers()) {\r\n         results = results.concat(objectlayer.getObjectsByClassName(className));\r\n      }\r\n      return results;\r\n   }\r\n\r\n   /**\r\n    * Search for an Actor created by the plugin by it's Tiled object\r\n    * @param className \r\n    * @returns \r\n    */\r\n   getEntitiesByClassName(className: string): Entity[] {\r\n      let results: Entity[] = [];\r\n      for (let objectlayer of this.getObjectLayers()) {\r\n         results = results.concat(objectlayer.getEntitiesByClassName(className));\r\n      }\r\n      return results;\r\n   }\r\n\r\n   /**\r\n    * Returns a tile by x, y integer coordinate from a layer. (Uses the first layer name that matches case insensitive).\r\n    * @param layerName \r\n    * @param x \r\n    * @param y \r\n    * @returns \r\n    */\r\n   getTileByCoordinate(layerName: string, x: number, y: number): TileInfo | null {\r\n      const layer = this.getTileLayers().find(byNameCaseInsensitive(layerName));\r\n      if (layer) {\r\n         return layer.getTileByCoordinate(x, y);\r\n      }\r\n\r\n      return null;\r\n   }\r\n\r\n   getImageLayers(name?: string): ImageLayer[] {\r\n      const layers = this.layers.filter(l => l instanceof ImageLayer) as ImageLayer[];\r\n      if (name) {\r\n         return layers.filter(byNameCaseInsensitive(name));\r\n      }\r\n      return layers;\r\n   }\r\n\r\n   getTileLayers(name?: string): TileLayer[] {\r\n      const layers = this.layers.filter(l => l instanceof TileLayer) as TileLayer[];\r\n      if (name) {\r\n         return layers.filter(byNameCaseInsensitive(name));\r\n      }\r\n      return layers;\r\n   }\r\n\r\n   getIsoTileLayers(name?: string): IsoTileLayer[] {\r\n      const layers = this.layers.filter(l => l instanceof IsoTileLayer) as IsoTileLayer[];\r\n      if (name) {\r\n         return layers.filter(byNameCaseInsensitive(name));\r\n      }\r\n      return layers;\r\n   }\r\n\r\n   getObjectLayers(name?: string): ObjectLayer[] {\r\n      const layers = this.layers.filter(l => l instanceof ObjectLayer) as ObjectLayer[];\r\n      if (name) {\r\n         return layers.filter(byNameCaseInsensitive(name));\r\n      }\r\n      return layers;\r\n   }\r\n\r\n   getLayersByName(name: string): Layer[] {\r\n      return this.layers.filter(byNameCaseInsensitive(name));\r\n   }\r\n\r\n   getLayersByClassName(className: string): Layer[] {\r\n      return this.layers.filter(byClassCaseInsensitive(className));\r\n   }\r\n\r\n   getLayersByProperty(propertyName: string, value?: any): Layer[] {\r\n      return this.layers.filter(byPropertyCaseInsensitive(propertyName, value));\r\n   }\r\n\r\n   private _parseMap(data: any) {\r\n      if (this.mapFormat === 'TMX') {\r\n         return this.parser.parse(data, this.strict);\r\n      } else {\r\n         return data as TiledMap;\r\n      }\r\n   }\r\n\r\n   async load(): Promise<any> {\r\n      const data = await this.fileLoader(this.path, this.mapFormat === 'TMX' ? 'xml' : 'json');\r\n\r\n      // Parse initial Tiled map structure\r\n      let map: TiledMap;\r\n      if (this.strict) {\r\n         try {\r\n            map = this._parseMap(data);\r\n         } catch (e) {\r\n            console.error(`Could not parse tiled map from location ${this.path}, attempted to interpret as ${this.mapFormat}.\\nExcalibur only supports the latest version of Tiled formats as of the plugin's release.`);\r\n            console.error(`Is your map file corrupted or being interpreted as the wrong type?`)\r\n            throw e;\r\n         }\r\n      } else {\r\n         map = this._parseMap(data);\r\n      }\r\n\r\n      if (compare(TiledResource.supportedTiledVersion, map.tiledversion ?? '0.0.0', \">\")) {\r\n         console.warn(`The excalibur tiled plugin officially supports ${TiledResource.supportedTiledVersion}+, the current map has tiled version ${map.tiledversion}`)\r\n      }\r\n\r\n      this.map = map;\r\n\r\n      this._collectTilesets();\r\n      this._collectTemplates();\r\n\r\n      // Load all the stuff!\r\n      await Promise.all([\r\n         this._tilesetLoader.load(),\r\n         (this.headless ? Promise.resolve() : this._imageLoader.load()),\r\n         this._templateLoader.load()\r\n      ]);\r\n\r\n      // Friendly data structures are needed before layer parsing\r\n      this.tilesets = [...this.tilesets, ...this._tilesetLoader.values().map(t => t.data)];\r\n      this.templates = this._templateLoader.values().map(t => t.data);\r\n\r\n      // Layers\r\n      let friendlyLayers: Layer[] = [];\r\n      let order = this.startZIndex;\r\n      for (const layer of this.map.layers) {\r\n         if (layer.type === 'tilelayer') {\r\n            if (this.map.orientation === 'isometric') {\r\n               const isolayer = new IsoTileLayer(layer, this, order);\r\n               friendlyLayers.push(isolayer);\r\n            }\r\n            if (this.map.orientation === 'orthogonal') {\r\n               const tilelayer = new TileLayer(layer, this, order);\r\n               friendlyLayers.push(tilelayer);\r\n            }\r\n         }\r\n         if (layer.type === 'objectgroup') {\r\n            const objectlayer = new ObjectLayer(layer, this, order);\r\n            friendlyLayers.push(objectlayer);\r\n         }\r\n         if (layer.type === 'imagelayer') {\r\n            const imagelayer = new ImageLayer(layer, this, order);\r\n            friendlyLayers.push(imagelayer);\r\n         }\r\n         order++;\r\n      }\r\n      // Layer loading depends on data from previous load step\r\n      await Promise.all(friendlyLayers.map(layer => layer.load()));\r\n      this.layers = friendlyLayers;\r\n   }\r\n\r\n   private _collectTilesets() {\r\n      // Resolve initial tilesets either embedded or external\r\n      for (const tileset of this.map.tilesets) {\r\n         // Embedded are technically already loaded\r\n         if (isTiledTilesetEmbedded(tileset)) {\r\n            if (isTiledTilesetSingleImage(tileset)) {\r\n               const imagePath = pathRelativeToBase(this.path, tileset.image, this.pathMap);\r\n               const image = this._imageLoader.getOrAdd(imagePath);\r\n               const friendlyTileset = new Tileset({\r\n                  name: tileset.name,\r\n                  tiledTileset: tileset,\r\n                  image,\r\n                  firstGid: tileset.firstgid!\r\n               });\r\n               this.tilesets.push(friendlyTileset);\r\n            }\r\n            if (isTiledTilesetCollectionOfImages(tileset)) {\r\n               const tileToImage = new Map<TiledTile, ImageSource>();\r\n               if (tileset.tiles) {\r\n                  for (let tile of tileset.tiles) {\r\n                     if (tile.image) {\r\n                        const imagePath = pathRelativeToBase(this.path, tile.image, this.pathMap);\r\n                        const image = this._imageLoader.getOrAdd(imagePath);\r\n                        tileToImage.set(tile, image);\r\n                     }\r\n                  }\r\n               }\r\n               const friendlyTileset = new Tileset({\r\n                  name: tileset.name,\r\n                  tiledTileset: tileset,\r\n                  tileToImage,\r\n                  firstGid: tileset.firstgid!\r\n               });\r\n               this.tilesets.push(friendlyTileset);\r\n            }\r\n         }\r\n         if (isTiledTilesetExternal(tileset)) {\r\n            const sourcePath = pathRelativeToBase(this.path, tileset.source, this.pathMap);\r\n            this._tilesetLoader.getOrAdd(sourcePath, tileset.firstgid,\r\n               {\r\n                  strict: this.strict,\r\n                  headless: this.headless,\r\n                  parser: this.parser,\r\n                  fileLoader: this.fileLoader,\r\n                  imageLoader: this._imageLoader,\r\n                  pathMap: this.pathMap\r\n               } satisfies TilesetResourceOptions);\r\n         }\r\n      }\r\n   }\r\n\r\n   private _collectTemplates() {\r\n      // Scan for template references in object files\r\n      let templates: string[] = [];\r\n      for (const layer of this.map.layers) {\r\n         if (layer.type === 'objectgroup') {\r\n            let templateObjects = layer.objects.filter(o => o.template).map(o => o.template) as string[];\r\n            templates = templates.concat(templateObjects);\r\n         }\r\n      }\r\n      // unique template paths\r\n      const uniqueTemplatePaths = templates.filter((value, index, array) => {\r\n         return array.findIndex(path => path === value) === index;\r\n      });\r\n\r\n      // Load Friendly templates\r\n      for (const templatePath of uniqueTemplatePaths) {\r\n         const mappedPath = pathRelativeToBase(this.path, templatePath, this.pathMap);\r\n         this._templateLoader.getOrAdd(mappedPath, {\r\n            strict: this.strict,\r\n            headless: this.headless,\r\n            parser: this.parser,\r\n            fileLoader: this.fileLoader,\r\n            imageLoader: this._imageLoader,\r\n            pathMap: this.pathMap\r\n         } satisfies TemplateResourceOptions)\r\n      }\r\n   }\r\n\r\n   addToScene(scene: Scene, options?: TiledAddToSceneOptions) {\r\n      if (!this.isLoaded()) {\r\n         this.logger.warn(`TiledResource ${this.path} is not loaded! Nothing will be wired into excalibur!`);\r\n         return;\r\n      }\r\n      const defaultOptions: TiledAddToSceneOptions = {\r\n         pos: vec(0, 0)\r\n      };\r\n      const { pos } = { ...defaultOptions, ...options };\r\n      for (const layer of this.layers) {\r\n         if (layer instanceof TileLayer) {\r\n            layer.tilemap.pos = layer.tilemap.pos.add(pos);\r\n            scene.add(layer.tilemap);\r\n         }\r\n         if (layer instanceof IsoTileLayer) {\r\n            scene.add(layer.isometricMap);\r\n         }\r\n         if (layer instanceof ObjectLayer) {\r\n            for (const entity of layer.entities) {\r\n               const tx = entity.get(TransformComponent);\r\n               if (tx) {\r\n                  tx.pos = tx.pos.add(pos);\r\n               }\r\n               scene.add(entity);\r\n            }\r\n         }\r\n         if (layer instanceof ImageLayer) {\r\n            if (layer.imageActor) {\r\n               layer.imageActor.pos = layer.imageActor.pos.add(pos);\r\n               scene.add(layer.imageActor);\r\n            }\r\n         }\r\n      }\r\n\r\n      if (this.useExcaliburWiring) {\r\n         const objects = this.getObjectsByProperty(ExcaliburTiledProperties.Camera.Camera, true);\r\n         if (objects && objects.length) {\r\n            const cameraObject = objects[0];\r\n            let zoom = 1;\r\n            const zoomProp = cameraObject.properties.get(ExcaliburTiledProperties.Camera.Zoom);\r\n            if (zoomProp && typeof zoomProp === 'number') {\r\n               zoom = zoomProp;\r\n            }\r\n\r\n            if (this.map.orientation === 'isometric') {\r\n               scene.camera.pos = this.isometricTiledCoordToWorld(cameraObject.x, cameraObject.y);\r\n            } else {\r\n               scene.camera.pos = vec(cameraObject.x, cameraObject.y);\r\n            }\r\n            scene.camera.zoom = zoom;\r\n         }\r\n      }\r\n\r\n      if (this.useTilemapCameraStrategy) {\r\n         const firstLayer = this.getTileLayers()[0];\r\n         if (firstLayer) {\r\n            const mapBounds = BoundingBox.fromDimension(\r\n               this.map.width * this.map.tilewidth,\r\n               this.map.height * this.map.tileheight,\r\n               Vector.Zero, pos.add(firstLayer.tilemap.pos));\r\n            scene.camera.strategy.limitCameraBounds(mapBounds);\r\n         }\r\n      }\r\n\r\n      if (this.useMapBackgroundColor) {\r\n         if (this.map.backgroundcolor) {\r\n            scene.backgroundColor = Color.fromHex(this.map.backgroundcolor);\r\n         }\r\n      }\r\n   }\r\n\r\n   isometricTiledCoordToWorld(x: number, y: number): Vector {\r\n      // Transformation sourced from:\r\n      // https://discourse.mapeditor.org/t/how-to-get-cartesian-coords-of-objects-from-tileds-isometric-map/4623/3\r\n      const originX = 0;\r\n      const tileWidth = this.map.tilewidth;\r\n      const tileHeight = this.map.tileheight;\r\n      const tileY = y / tileHeight;\r\n      const tileX = x / tileHeight;\r\n      return vec(\r\n         (tileX - tileY) * tileWidth / 2 + originX,\r\n         (tileX + tileY) * tileHeight / 2);\r\n   }\r\n\r\n   isLoaded(): boolean {\r\n      return !!this.map;\r\n   }\r\n}","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nconst base64 = require('base64-js')\nconst ieee754 = require('ieee754')\nconst customInspectSymbol =\n  (typeof Symbol === 'function' && typeof Symbol['for'] === 'function') // eslint-disable-line dot-notation\n    ? Symbol['for']('nodejs.util.inspect.custom') // eslint-disable-line dot-notation\n    : null\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\nconst K_MAX_LENGTH = 0x7fffffff\nexports.kMaxLength = K_MAX_LENGTH\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Print warning and recommend using `buffer` v4.x which has an Object\n *               implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * We report that the browser does not support typed arrays if the are not subclassable\n * using __proto__. Firefox 4-29 lacks support for adding new properties to `Uint8Array`\n * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438). IE 10 lacks support\n * for __proto__ and has a buggy typed array implementation.\n */\nBuffer.TYPED_ARRAY_SUPPORT = typedArraySupport()\n\nif (!Buffer.TYPED_ARRAY_SUPPORT && typeof console !== 'undefined' &&\n    typeof console.error === 'function') {\n  console.error(\n    'This browser lacks typed array (Uint8Array) support which is required by ' +\n    '`buffer` v5.x. Use `buffer` v4.x if you require old browser support.'\n  )\n}\n\nfunction typedArraySupport () {\n  // Can typed array instances can be augmented?\n  try {\n    const arr = new Uint8Array(1)\n    const proto = { foo: function () { return 42 } }\n    Object.setPrototypeOf(proto, Uint8Array.prototype)\n    Object.setPrototypeOf(arr, proto)\n    return arr.foo() === 42\n  } catch (e) {\n    return false\n  }\n}\n\nObject.defineProperty(Buffer.prototype, 'parent', {\n  enumerable: true,\n  get: function () {\n    if (!Buffer.isBuffer(this)) return undefined\n    return this.buffer\n  }\n})\n\nObject.defineProperty(Buffer.prototype, 'offset', {\n  enumerable: true,\n  get: function () {\n    if (!Buffer.isBuffer(this)) return undefined\n    return this.byteOffset\n  }\n})\n\nfunction createBuffer (length) {\n  if (length > K_MAX_LENGTH) {\n    throw new RangeError('The value \"' + length + '\" is invalid for option \"size\"')\n  }\n  // Return an augmented `Uint8Array` instance\n  const buf = new Uint8Array(length)\n  Object.setPrototypeOf(buf, Buffer.prototype)\n  return buf\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new TypeError(\n        'The \"string\" argument must be of type string. Received type number'\n      )\n    }\n    return allocUnsafe(arg)\n  }\n  return from(arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\nfunction from (value, encodingOrOffset, length) {\n  if (typeof value === 'string') {\n    return fromString(value, encodingOrOffset)\n  }\n\n  if (ArrayBuffer.isView(value)) {\n    return fromArrayView(value)\n  }\n\n  if (value == null) {\n    throw new TypeError(\n      'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +\n      'or Array-like Object. Received type ' + (typeof value)\n    )\n  }\n\n  if (isInstance(value, ArrayBuffer) ||\n      (value && isInstance(value.buffer, ArrayBuffer))) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof SharedArrayBuffer !== 'undefined' &&\n      (isInstance(value, SharedArrayBuffer) ||\n      (value && isInstance(value.buffer, SharedArrayBuffer)))) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'number') {\n    throw new TypeError(\n      'The \"value\" argument must not be of type number. Received type number'\n    )\n  }\n\n  const valueOf = value.valueOf && value.valueOf()\n  if (valueOf != null && valueOf !== value) {\n    return Buffer.from(valueOf, encodingOrOffset, length)\n  }\n\n  const b = fromObject(value)\n  if (b) return b\n\n  if (typeof Symbol !== 'undefined' && Symbol.toPrimitive != null &&\n      typeof value[Symbol.toPrimitive] === 'function') {\n    return Buffer.from(value[Symbol.toPrimitive]('string'), encodingOrOffset, length)\n  }\n\n  throw new TypeError(\n    'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +\n    'or Array-like Object. Received type ' + (typeof value)\n  )\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(value, encodingOrOffset, length)\n}\n\n// Note: Change prototype *after* Buffer.from is defined to workaround Chrome bug:\n// https://github.com/feross/buffer/pull/148\nObject.setPrototypeOf(Buffer.prototype, Uint8Array.prototype)\nObject.setPrototypeOf(Buffer, Uint8Array)\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be of type number')\n  } else if (size < 0) {\n    throw new RangeError('The value \"' + size + '\" is invalid for option \"size\"')\n  }\n}\n\nfunction alloc (size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpreted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(size).fill(fill, encoding)\n      : createBuffer(size).fill(fill)\n  }\n  return createBuffer(size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(size, fill, encoding)\n}\n\nfunction allocUnsafe (size) {\n  assertSize(size)\n  return createBuffer(size < 0 ? 0 : checked(size) | 0)\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(size)\n}\n\nfunction fromString (string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('Unknown encoding: ' + encoding)\n  }\n\n  const length = byteLength(string, encoding) | 0\n  let buf = createBuffer(length)\n\n  const actual = buf.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    buf = buf.slice(0, actual)\n  }\n\n  return buf\n}\n\nfunction fromArrayLike (array) {\n  const length = array.length < 0 ? 0 : checked(array.length) | 0\n  const buf = createBuffer(length)\n  for (let i = 0; i < length; i += 1) {\n    buf[i] = array[i] & 255\n  }\n  return buf\n}\n\nfunction fromArrayView (arrayView) {\n  if (isInstance(arrayView, Uint8Array)) {\n    const copy = new Uint8Array(arrayView)\n    return fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength)\n  }\n  return fromArrayLike(arrayView)\n}\n\nfunction fromArrayBuffer (array, byteOffset, length) {\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\"offset\" is outside of buffer bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\"length\" is outside of buffer bounds')\n  }\n\n  let buf\n  if (byteOffset === undefined && length === undefined) {\n    buf = new Uint8Array(array)\n  } else if (length === undefined) {\n    buf = new Uint8Array(array, byteOffset)\n  } else {\n    buf = new Uint8Array(array, byteOffset, length)\n  }\n\n  // Return an augmented `Uint8Array` instance\n  Object.setPrototypeOf(buf, Buffer.prototype)\n\n  return buf\n}\n\nfunction fromObject (obj) {\n  if (Buffer.isBuffer(obj)) {\n    const len = checked(obj.length) | 0\n    const buf = createBuffer(len)\n\n    if (buf.length === 0) {\n      return buf\n    }\n\n    obj.copy(buf, 0, 0, len)\n    return buf\n  }\n\n  if (obj.length !== undefined) {\n    if (typeof obj.length !== 'number' || numberIsNaN(obj.length)) {\n      return createBuffer(0)\n    }\n    return fromArrayLike(obj)\n  }\n\n  if (obj.type === 'Buffer' && Array.isArray(obj.data)) {\n    return fromArrayLike(obj.data)\n  }\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < K_MAX_LENGTH` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= K_MAX_LENGTH) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + K_MAX_LENGTH.toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return b != null && b._isBuffer === true &&\n    b !== Buffer.prototype // so Buffer.isBuffer(Buffer.prototype) will be false\n}\n\nBuffer.compare = function compare (a, b) {\n  if (isInstance(a, Uint8Array)) a = Buffer.from(a, a.offset, a.byteLength)\n  if (isInstance(b, Uint8Array)) b = Buffer.from(b, b.offset, b.byteLength)\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError(\n      'The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array'\n    )\n  }\n\n  if (a === b) return 0\n\n  let x = a.length\n  let y = b.length\n\n  for (let i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!Array.isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  let i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  const buffer = Buffer.allocUnsafe(length)\n  let pos = 0\n  for (i = 0; i < list.length; ++i) {\n    let buf = list[i]\n    if (isInstance(buf, Uint8Array)) {\n      if (pos + buf.length > buffer.length) {\n        if (!Buffer.isBuffer(buf)) buf = Buffer.from(buf)\n        buf.copy(buffer, pos)\n      } else {\n        Uint8Array.prototype.set.call(\n          buffer,\n          buf,\n          pos\n        )\n      }\n    } else if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    } else {\n      buf.copy(buffer, pos)\n    }\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (ArrayBuffer.isView(string) || isInstance(string, ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    throw new TypeError(\n      'The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. ' +\n      'Received type ' + typeof string\n    )\n  }\n\n  const len = string.length\n  const mustMatch = (arguments.length > 2 && arguments[2] === true)\n  if (!mustMatch && len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  let loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) {\n          return mustMatch ? -1 : utf8ToBytes(string).length // assume utf8\n        }\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  let loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coercion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// This property is used by `Buffer.isBuffer` (and the `is-buffer` npm package)\n// to detect a Buffer instance. It's not possible to use `instanceof Buffer`\n// reliably in a browserify context because there could be multiple different\n// copies of the 'buffer' package in use. This method works even for Buffer\n// instances that were created from another copy of the `buffer` package.\n// See: https://github.com/feross/buffer/issues/154\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  const i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  const len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (let i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  const len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (let i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  const len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (let i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  const length = this.length\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.toLocaleString = Buffer.prototype.toString\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  let str = ''\n  const max = exports.INSPECT_MAX_BYTES\n  str = this.toString('hex', 0, max).replace(/(.{2})/g, '$1 ').trim()\n  if (this.length > max) str += ' ... '\n  return '<Buffer ' + str + '>'\n}\nif (customInspectSymbol) {\n  Buffer.prototype[customInspectSymbol] = Buffer.prototype.inspect\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (isInstance(target, Uint8Array)) {\n    target = Buffer.from(target, target.offset, target.byteLength)\n  }\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError(\n      'The \"target\" argument must be one of type Buffer or Uint8Array. ' +\n      'Received type ' + (typeof target)\n    )\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  let x = thisEnd - thisStart\n  let y = end - start\n  const len = Math.min(x, y)\n\n  const thisCopy = this.slice(thisStart, thisEnd)\n  const targetCopy = target.slice(start, end)\n\n  for (let i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset // Coerce to Number.\n  if (numberIsNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [val], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  let indexSize = 1\n  let arrLength = arr.length\n  let valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  let i\n  if (dir) {\n    let foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      let found = true\n      for (let j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  const remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  const strLen = string.length\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  let i\n  for (i = 0; i < length; ++i) {\n    const parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (numberIsNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset >>> 0\n    if (isFinite(length)) {\n      length = length >>> 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  const remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  let loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return asciiWrite(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  const res = []\n\n  let i = start\n  while (i < end) {\n    const firstByte = buf[i]\n    let codePoint = null\n    let bytesPerSequence = (firstByte > 0xEF)\n      ? 4\n      : (firstByte > 0xDF)\n          ? 3\n          : (firstByte > 0xBF)\n              ? 2\n              : 1\n\n    if (i + bytesPerSequence <= end) {\n      let secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nconst MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  const len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  let res = ''\n  let i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  let ret = ''\n  end = Math.min(buf.length, end)\n\n  for (let i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  let ret = ''\n  end = Math.min(buf.length, end)\n\n  for (let i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  const len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  let out = ''\n  for (let i = start; i < end; ++i) {\n    out += hexSliceLookupTable[buf[i]]\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  const bytes = buf.slice(start, end)\n  let res = ''\n  // If bytes.length is odd, the last 8 bits must be ignored (same as node.js)\n  for (let i = 0; i < bytes.length - 1; i += 2) {\n    res += String.fromCharCode(bytes[i] + (bytes[i + 1] * 256))\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  const len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  const newBuf = this.subarray(start, end)\n  // Return an augmented `Uint8Array` instance\n  Object.setPrototypeOf(newBuf, Buffer.prototype)\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUintLE =\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let val = this[offset]\n  let mul = 1\n  let i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUintBE =\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  let val = this[offset + --byteLength]\n  let mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUint8 =\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUint16LE =\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUint16BE =\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUint32LE =\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUint32BE =\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readBigUInt64LE = defineBigIntMethod(function readBigUInt64LE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const lo = first +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 24\n\n  const hi = this[++offset] +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    last * 2 ** 24\n\n  return BigInt(lo) + (BigInt(hi) << BigInt(32))\n})\n\nBuffer.prototype.readBigUInt64BE = defineBigIntMethod(function readBigUInt64BE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const hi = first * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    this[++offset]\n\n  const lo = this[++offset] * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    last\n\n  return (BigInt(hi) << BigInt(32)) + BigInt(lo)\n})\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let val = this[offset]\n  let mul = 1\n  let i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let i = byteLength\n  let mul = 1\n  let val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  const val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  const val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readBigInt64LE = defineBigIntMethod(function readBigInt64LE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const val = this[offset + 4] +\n    this[offset + 5] * 2 ** 8 +\n    this[offset + 6] * 2 ** 16 +\n    (last << 24) // Overflow\n\n  return (BigInt(val) << BigInt(32)) +\n    BigInt(first +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 24)\n})\n\nBuffer.prototype.readBigInt64BE = defineBigIntMethod(function readBigInt64BE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const val = (first << 24) + // Overflow\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    this[++offset]\n\n  return (BigInt(val) << BigInt(32)) +\n    BigInt(this[++offset] * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    last)\n})\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUintLE =\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    const maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  let mul = 1\n  let i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUintBE =\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    const maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  let i = byteLength - 1\n  let mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUint8 =\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeUint16LE =\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  return offset + 2\n}\n\nBuffer.prototype.writeUint16BE =\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  this[offset] = (value >>> 8)\n  this[offset + 1] = (value & 0xff)\n  return offset + 2\n}\n\nBuffer.prototype.writeUint32LE =\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  this[offset + 3] = (value >>> 24)\n  this[offset + 2] = (value >>> 16)\n  this[offset + 1] = (value >>> 8)\n  this[offset] = (value & 0xff)\n  return offset + 4\n}\n\nBuffer.prototype.writeUint32BE =\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  this[offset] = (value >>> 24)\n  this[offset + 1] = (value >>> 16)\n  this[offset + 2] = (value >>> 8)\n  this[offset + 3] = (value & 0xff)\n  return offset + 4\n}\n\nfunction wrtBigUInt64LE (buf, value, offset, min, max) {\n  checkIntBI(value, min, max, buf, offset, 7)\n\n  let lo = Number(value & BigInt(0xffffffff))\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  let hi = Number(value >> BigInt(32) & BigInt(0xffffffff))\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  return offset\n}\n\nfunction wrtBigUInt64BE (buf, value, offset, min, max) {\n  checkIntBI(value, min, max, buf, offset, 7)\n\n  let lo = Number(value & BigInt(0xffffffff))\n  buf[offset + 7] = lo\n  lo = lo >> 8\n  buf[offset + 6] = lo\n  lo = lo >> 8\n  buf[offset + 5] = lo\n  lo = lo >> 8\n  buf[offset + 4] = lo\n  let hi = Number(value >> BigInt(32) & BigInt(0xffffffff))\n  buf[offset + 3] = hi\n  hi = hi >> 8\n  buf[offset + 2] = hi\n  hi = hi >> 8\n  buf[offset + 1] = hi\n  hi = hi >> 8\n  buf[offset] = hi\n  return offset + 8\n}\n\nBuffer.prototype.writeBigUInt64LE = defineBigIntMethod(function writeBigUInt64LE (value, offset = 0) {\n  return wrtBigUInt64LE(this, value, offset, BigInt(0), BigInt('0xffffffffffffffff'))\n})\n\nBuffer.prototype.writeBigUInt64BE = defineBigIntMethod(function writeBigUInt64BE (value, offset = 0) {\n  return wrtBigUInt64BE(this, value, offset, BigInt(0), BigInt('0xffffffffffffffff'))\n})\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    const limit = Math.pow(2, (8 * byteLength) - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  let i = 0\n  let mul = 1\n  let sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    const limit = Math.pow(2, (8 * byteLength) - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  let i = byteLength - 1\n  let mul = 1\n  let sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  this[offset] = (value >>> 8)\n  this[offset + 1] = (value & 0xff)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  this[offset + 2] = (value >>> 16)\n  this[offset + 3] = (value >>> 24)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  this[offset] = (value >>> 24)\n  this[offset + 1] = (value >>> 16)\n  this[offset + 2] = (value >>> 8)\n  this[offset + 3] = (value & 0xff)\n  return offset + 4\n}\n\nBuffer.prototype.writeBigInt64LE = defineBigIntMethod(function writeBigInt64LE (value, offset = 0) {\n  return wrtBigUInt64LE(this, value, offset, -BigInt('0x8000000000000000'), BigInt('0x7fffffffffffffff'))\n})\n\nBuffer.prototype.writeBigInt64BE = defineBigIntMethod(function writeBigInt64BE (value, offset = 0) {\n  return wrtBigUInt64BE(this, value, offset, -BigInt('0x8000000000000000'), BigInt('0x7fffffffffffffff'))\n})\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!Buffer.isBuffer(target)) throw new TypeError('argument should be a Buffer')\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('Index out of range')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  const len = end - start\n\n  if (this === target && typeof Uint8Array.prototype.copyWithin === 'function') {\n    // Use built-in when available, missing from IE11\n    this.copyWithin(targetStart, start, end)\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, end),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n    if (val.length === 1) {\n      const code = val.charCodeAt(0)\n      if ((encoding === 'utf8' && code < 128) ||\n          encoding === 'latin1') {\n        // Fast path: If `val` fits into a single byte, use that numeric value.\n        val = code\n      }\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  } else if (typeof val === 'boolean') {\n    val = Number(val)\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  let i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    const bytes = Buffer.isBuffer(val)\n      ? val\n      : Buffer.from(val, encoding)\n    const len = bytes.length\n    if (len === 0) {\n      throw new TypeError('The value \"' + val +\n        '\" is invalid for argument \"value\"')\n    }\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// CUSTOM ERRORS\n// =============\n\n// Simplified versions from Node, changed for Buffer-only usage\nconst errors = {}\nfunction E (sym, getMessage, Base) {\n  errors[sym] = class NodeError extends Base {\n    constructor () {\n      super()\n\n      Object.defineProperty(this, 'message', {\n        value: getMessage.apply(this, arguments),\n        writable: true,\n        configurable: true\n      })\n\n      // Add the error code to the name to include it in the stack trace.\n      this.name = `${this.name} [${sym}]`\n      // Access the stack to generate the error message including the error code\n      // from the name.\n      this.stack // eslint-disable-line no-unused-expressions\n      // Reset the name to the actual name.\n      delete this.name\n    }\n\n    get code () {\n      return sym\n    }\n\n    set code (value) {\n      Object.defineProperty(this, 'code', {\n        configurable: true,\n        enumerable: true,\n        value,\n        writable: true\n      })\n    }\n\n    toString () {\n      return `${this.name} [${sym}]: ${this.message}`\n    }\n  }\n}\n\nE('ERR_BUFFER_OUT_OF_BOUNDS',\n  function (name) {\n    if (name) {\n      return `${name} is outside of buffer bounds`\n    }\n\n    return 'Attempt to access memory outside buffer bounds'\n  }, RangeError)\nE('ERR_INVALID_ARG_TYPE',\n  function (name, actual) {\n    return `The \"${name}\" argument must be of type number. Received type ${typeof actual}`\n  }, TypeError)\nE('ERR_OUT_OF_RANGE',\n  function (str, range, input) {\n    let msg = `The value of \"${str}\" is out of range.`\n    let received = input\n    if (Number.isInteger(input) && Math.abs(input) > 2 ** 32) {\n      received = addNumericalSeparator(String(input))\n    } else if (typeof input === 'bigint') {\n      received = String(input)\n      if (input > BigInt(2) ** BigInt(32) || input < -(BigInt(2) ** BigInt(32))) {\n        received = addNumericalSeparator(received)\n      }\n      received += 'n'\n    }\n    msg += ` It must be ${range}. Received ${received}`\n    return msg\n  }, RangeError)\n\nfunction addNumericalSeparator (val) {\n  let res = ''\n  let i = val.length\n  const start = val[0] === '-' ? 1 : 0\n  for (; i >= start + 4; i -= 3) {\n    res = `_${val.slice(i - 3, i)}${res}`\n  }\n  return `${val.slice(0, i)}${res}`\n}\n\n// CHECK FUNCTIONS\n// ===============\n\nfunction checkBounds (buf, offset, byteLength) {\n  validateNumber(offset, 'offset')\n  if (buf[offset] === undefined || buf[offset + byteLength] === undefined) {\n    boundsError(offset, buf.length - (byteLength + 1))\n  }\n}\n\nfunction checkIntBI (value, min, max, buf, offset, byteLength) {\n  if (value > max || value < min) {\n    const n = typeof min === 'bigint' ? 'n' : ''\n    let range\n    if (byteLength > 3) {\n      if (min === 0 || min === BigInt(0)) {\n        range = `>= 0${n} and < 2${n} ** ${(byteLength + 1) * 8}${n}`\n      } else {\n        range = `>= -(2${n} ** ${(byteLength + 1) * 8 - 1}${n}) and < 2 ** ` +\n                `${(byteLength + 1) * 8 - 1}${n}`\n      }\n    } else {\n      range = `>= ${min}${n} and <= ${max}${n}`\n    }\n    throw new errors.ERR_OUT_OF_RANGE('value', range, value)\n  }\n  checkBounds(buf, offset, byteLength)\n}\n\nfunction validateNumber (value, name) {\n  if (typeof value !== 'number') {\n    throw new errors.ERR_INVALID_ARG_TYPE(name, 'number', value)\n  }\n}\n\nfunction boundsError (value, length, type) {\n  if (Math.floor(value) !== value) {\n    validateNumber(value, type)\n    throw new errors.ERR_OUT_OF_RANGE(type || 'offset', 'an integer', value)\n  }\n\n  if (length < 0) {\n    throw new errors.ERR_BUFFER_OUT_OF_BOUNDS()\n  }\n\n  throw new errors.ERR_OUT_OF_RANGE(type || 'offset',\n                                    `>= ${type ? 1 : 0} and <= ${length}`,\n                                    value)\n}\n\n// HELPER FUNCTIONS\n// ================\n\nconst INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node takes equal signs as end of the Base64 encoding\n  str = str.split('=')[0]\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = str.trim().replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  let codePoint\n  const length = string.length\n  let leadSurrogate = null\n  const bytes = []\n\n  for (let i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  const byteArray = []\n  for (let i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  let c, hi, lo\n  const byteArray = []\n  for (let i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  let i\n  for (i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\n// ArrayBuffer or Uint8Array objects from other contexts (i.e. iframes) do not pass\n// the `instanceof` check but they should be treated as of that type.\n// See: https://github.com/feross/buffer/issues/166\nfunction isInstance (obj, type) {\n  return obj instanceof type ||\n    (obj != null && obj.constructor != null && obj.constructor.name != null &&\n      obj.constructor.name === type.name)\n}\nfunction numberIsNaN (obj) {\n  // For IE11 support\n  return obj !== obj // eslint-disable-line no-self-compare\n}\n\n// Create lookup table for `toString('hex')`\n// See: https://github.com/feross/buffer/issues/219\nconst hexSliceLookupTable = (function () {\n  const alphabet = '0123456789abcdef'\n  const table = new Array(256)\n  for (let i = 0; i < 16; ++i) {\n    const i16 = i * 16\n    for (let j = 0; j < 16; ++j) {\n      table[i16 + j] = alphabet[i] + alphabet[j]\n    }\n  }\n  return table\n})()\n\n// Return not function with Error if BigInt not supported\nfunction defineBigIntMethod (fn) {\n  return typeof BigInt === 'undefined' ? BufferBigIntNotDefined : fn\n}\n\nfunction BufferBigIntNotDefined () {\n  throw new Error('BigInt not supported')\n}\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","\"use strict\";","module.exports = require('./helpers/bundle-url').getBundleURL('aNMIV') + \"Hero 01.fbf7482f.png\" + \"?\" + Date.now();","\"use strict\";\n\nvar bundleURL = {};\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n  return value;\n}\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n  return '/';\n}\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\n// TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^/]+/);\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n  return matches[0];\n}\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","module.exports = require('./helpers/bundle-url').getBundleURL('aNMIV') + \"characters.64448117.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('aNMIV') + \"Solaria Demo Update 01.0c919eb3.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('aNMIV') + \"font.6ecda039.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('aNMIV') + \"danielmap.ea72e55b.tmx\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('aNMIV') + \"tileset.4656db16.tsx\" + \"?\" + Date.now();","import * as ex from 'excalibur';\nimport { Resources } from './resources';\nimport { Config } from './config';\nimport { Chest } from './chest';\nimport { CustomText } from './customtext';\nimport { DialogManager } from './dialogmanager';\nimport { Daniel } from './daniel';\nimport { Vio } from './vio';\nimport { GameStatus } from './gamestatus';\n\nexport class Player extends ex.Actor {\n    constructor(pos: ex.Vector) {\n        super({\n            pos,\n            width: 16,\n            height: 16,\n            collisionType: ex.CollisionType.Active\n        })\n    }\n\n    current_graphics = \"\"; \n    //private _textengine: CustomText;\n    onInitialize(engine: ex.Engine): void {\n        engine.currentScene.camera.strategy.lockToActor(this);\n        const playerSpriteSheet = ex.SpriteSheet.fromImageSource({\n            image: Resources.HeroSpriteSheetPng as ex.ImageSource,\n            grid: {\n                spriteWidth: 16,\n                spriteHeight: 16,\n                rows: 8,\n                columns: 8\n            }\n        });\n        \n        const leftIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('left-idle', leftIdle);\n\n        const rightIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('right-idle', rightIdle);\n\n\n        const upIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('up-idle', upIdle);\n\n        const downIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('down-idle', downIdle);\n\n        this.current_graphics = 'down-idle';\n\n        // Joystick is handled globally via GameStatus.joystickVector (updated in main when joystick emits events)\n\n\n        const leftWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 5) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 5) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 5) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 5) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('left-walk', leftWalk);\n\n        const rightWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('right-walk', rightWalk);\n\n        const upWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('up-walk', upWalk);\n\n        const downWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('down-walk', downWalk);\n    }\n    private _currentAnim = 'down-idle';\n\n    onPreUpdate(engine: ex.Engine, elapsedMs: number): void {\n        let dir = ex.Vector.Zero;\n        this.graphics.use(this._currentAnim = this.current_graphics);\n        const ratio = 1;\n        const threshold = 0.4;\n\n        const gp = engine.input.gamepads.at(0);\n        const up = gp.getButton(ex.Buttons.DpadUp);\n        const down = gp.getButton(ex.Buttons.DpadDown);\n        const left = gp.getButton(ex.Buttons.DpadLeft);\n        const right = gp.getButton(ex.Buttons.DpadRight);\n\n        // Check if Player was frozen\n        if (DialogManager.freeze_player == false) {\n            // UP\n            if (\n                engine.input.keyboard.isHeld(ex.Keys.ArrowUp)\n                ||\n                (up > threshold && up >= down * ratio && up >= left * ratio && up >= right * ratio && left == 0 && right == 0)\n                ||\n                (GameStatus.joystickVector.y < -0.3) // joystick y < 0 means up\n            ) {\n                dir.y = -1;\n                this.graphics.use(this._currentAnim = 'up-walk');\n                this.current_graphics = 'up-idle';\n            }\n\n            // DOWN\n            else if (\n                engine.input.keyboard.isHeld(ex.Keys.ArrowDown)\n                ||\n                (down > threshold && down >= up * ratio && down >= left * ratio && down >= right * ratio && left == 0 && right == 0)\n                ||\n                (GameStatus.joystickVector.y > 0.3) // joystick y > 0 means down\n            ) {\n                dir.y = 1;\n                this.graphics.use(this._currentAnim = 'down-walk');\n                this.current_graphics = 'down-idle';\n            }\n\n            // RIGHT\n            else if (\n                engine.input.keyboard.isHeld(ex.Keys.ArrowRight)\n                ||\n                (right > 0)//&& right >= left * ratio && right >= up * ratio && right >= down * ratio)\n                ||\n                (GameStatus.joystickVector.x > 0.3)\n            ) {\n                dir.x = 1;\n                this.graphics.use(this._currentAnim = 'right-walk');\n                this.current_graphics = 'right-idle';\n            }\n\n            // LEFT\n            else if (\n                engine.input.keyboard.isHeld(ex.Keys.ArrowLeft)\n                ||\n                (left > 0)//&& left >= right * ratio && left >= up * ratio && left >= down * ratio)\n                ||\n                (GameStatus.joystickVector.x < -0.3)\n            ) {\n                dir.x = -1;\n                this.graphics.use(this._currentAnim = 'left-walk');\n                this.current_graphics = 'left-idle';\n            }\n            \n            if (dir.x !== 0 && dir.y !== 0) {\n                dir = dir.normalize();\n            }\n            \n            this.vel = dir.scale(Config.PlayerSpeed);\n\n            //if (gp.getButton(ex.Buttons.Face1) > 0){\n            //   this.graphics.use(this._currentAnim = 'right-walk');\n            //}\n        }\n\n    }\n\n    onPreCollisionResolve(self: ex.Collider, other: ex.Collider, side: ex.Side, contact: ex.CollisionContact): void {\n        const otherOwner = other.owner;\n        if (otherOwner instanceof ex.TileMap) {\n            for (let contactPoint of contact.points) {\n                // Nudge into the tile zone by direction\n                const maybeTile = otherOwner.getTileByPoint(contactPoint.add(this.vel.normalize()));\n                if (maybeTile?.solid) {\n                    const targetMidW = maybeTile.pos.x + (maybeTile.width / 2);\n                    const targetMidH = maybeTile.pos.y + (maybeTile.height / 2);\n                    // This logic causes player to slide to nearest edge to go around objects.\n                    if (this._currentAnim === 'left-walk' || this._currentAnim === 'right-walk') {\n                        if (this.pos.y < targetMidH) { \n                            this.pos.y -= 1;\n                        } else {\n                            this.pos.y += 1;\n                        }\n                    } else { // source.facing === 'up' || source.facing === 'down'\n                        if (this.pos.x < targetMidW) { \n                            this.pos.x -= 1;\n                        } else {\n                            this.pos.x += 1;\n                        }\n                    }\n                    break;\n                }\n            }\n        }\n        if (otherOwner instanceof Chest) {\n            otherOwner.open();\n            DialogManager.say(\"Du hast die Truhe mit dem Schatz gefunden!\", true);\n        }\n\n        if (otherOwner instanceof Daniel) {\n            if (GameStatus.schatz_gefunden == false) {\n            DialogManager.say(\"DANIEL: Oh nein, wir haben unseren Schatz verloren, findest du ihn wieder?\", true);\n            } else {\n                DialogManager.say(\"DANIEL: SURPRISE!!\", true);\n            }\n        }\n\n        if (otherOwner instanceof Vio) {\n            if (GameStatus.schatz_gefunden == false) {\n            DialogManager.say(\"VIO: Oh nein, wir haben unseren Schatz verloren, findest du ihn wieder?\", true);\n            } else {\n                DialogManager.say(\"VIO: Danke, du hast unsere Eheringe gefunden. Wir haben am 20.12. geheiratet!      SURPRISE!!!\", true);\n            }\n        }\n\n    }\n}","export const Config = {\n    PlayerSpeed: 3*16*2, // pixels/sec\n    PlayerFrameSpeed: 200, // ms\n}","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n","import * as ex from 'excalibur';\nimport { Resources } from './resources';\nimport { Config } from './config';\nimport { GameStatus } from './gamestatus';\n\nexport class Chest extends ex.Actor {\n    constructor(pos: ex.Vector) {\n        super({\n            pos,\n            width: 16,\n            height: 16,\n            collisionType: ex.CollisionType.Fixed\n        })\n    }\n\n    current_graphics = \"closed\"; \n\n    onInitialize(engine: ex.Engine): void {\n        const chestSpriteSheet = ex.SpriteSheet.fromImageSource({\n            image: Resources.TileSetPng as ex.ImageSource,\n            grid: {\n                spriteWidth: 16,\n                spriteHeight: 16,\n                rows: 15,\n                columns: 28\n            }\n        });\n\n        const closed = new ex.Animation({\n            frames: [\n                {graphic: chestSpriteSheet.getSprite(6, 8) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('closed', closed);\n\n        const open = new ex.Animation({\n            frames: [\n                {graphic: chestSpriteSheet.getSprite(6, 9) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('open', open);\n    }\n\n    private _currentAnim = 'closed';\n\n    onPreUpdate(engine: ex.Engine, elapsedMs: number): void {\n        this.graphics.use(this._currentAnim = this.current_graphics);\n    }\n\n    onPreCollisionResolve(self: ex.Collider, other: ex.Collider, side: ex.Side, contact: ex.CollisionContact): void {\n    }\n\n    public open(): void {\n        this.graphics.use(this._currentAnim = 'open');\n        this.current_graphics='open';\n        GameStatus.schatz_gefunden = true;\n    }\n}","import * as ex from 'excalibur';\nimport nipplejs from \"nipplejs\";\n\nexport class GameStatus {\n\n    static schatz_gefunden = false;\n\n    // nipplejs joystick instance\n    static joystick : nipplejs.Joystick | null = null;\n\n    // Shared joystick vector (updated by main when joystick emits events)\n    static joystickVector: ex.Vector = ex.vec(0, 0);\n\n}","// DialogManager.ts\nimport { CustomText } from './customtext';\n\nexport class DialogManager {\n  static textUi: CustomText;\n  static freeze_player = false;\n\n  static init(textUi: CustomText) {\n    this.textUi = textUi;\n  }\n\n  static say(text: string, freeze: boolean) {\n    if (this.textUi) this.textUi.setDialogue(text);\n      this.freeze_player = freeze;\n  }\n}\n","import * as ex from 'excalibur';\nimport { Resources } from './resources';\nimport { Config } from './config';\nimport { Chest } from './chest';\nimport { CustomText } from './customtext';\nimport { DialogManager } from './dialogmanager';\n\nexport class Daniel extends ex.Actor {\n    constructor(pos: ex.Vector) {\n        super({\n            pos,\n            width: 16,\n            height: 24,\n            collisionType: ex.CollisionType.Fixed\n        })\n    }\n\n    current_graphics = \"\"; \n    //private _textengine: CustomText;\n    onInitialize(engine: ex.Engine): void {\n        const playerSpriteSheet = ex.SpriteSheet.fromImageSource({\n            image: Resources.VioDanielSheetPng as ex.ImageSource,\n            grid: {\n                spriteWidth: 32,\n                spriteHeight: 48,\n                rows: 16,\n                columns: 28\n            }\n        });\n        \n        const leftIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(8, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(9, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(10, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(11, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('left-idle', leftIdle);\n\n        const rightIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('right-idle', rightIdle);\n\n\n        const upIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('up-idle', upIdle);\n\n        const downIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(12, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(13, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(14, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(15, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        downIdle.scale = ex.vec(0.5,0.5);\n        this.graphics.add('down-idle', downIdle);\n\n        this.current_graphics = 'down-idle';\n\n        const leftWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 5) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 5) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 5) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 5) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('left-walk', leftWalk);\n\n        const rightWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('right-walk', rightWalk);\n\n        const upWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('up-walk', upWalk);\n\n        const downWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('down-walk', downWalk);\n    }\n    private _currentAnim = 'down-idle';\n\n    onPreUpdate(engine: ex.Engine, elapsedMs: number): void {\n        let dir = ex.Vector.Zero;\n        this.graphics.use(this._currentAnim = this.current_graphics);\n\n        if (true) {\n            dir.y = -1;\n            //this.graphics.use(this._currentAnim = 'up-walk');\n            //this.current_graphics = 'up-idle';\n        }\n\n    }\n\n    onPreCollisionResolve(self: ex.Collider, other: ex.Collider, side: ex.Side, contact: ex.CollisionContact): void {\n    }\n}","import * as ex from 'excalibur';\nimport { Resources } from './resources';\nimport { Config } from './config';\nimport { Chest } from './chest';\nimport { CustomText } from './customtext';\nimport { DialogManager } from './dialogmanager';\n\nexport class Vio extends ex.Actor {\n    constructor(pos: ex.Vector) {\n        super({\n            pos,\n            width: 16,\n            height: 24,\n            collisionType: ex.CollisionType.Fixed\n        })\n    }\n\n    current_graphics = \"\"; \n    //private _textengine: CustomText;\n    onInitialize(engine: ex.Engine): void {\n        const playerSpriteSheet = ex.SpriteSheet.fromImageSource({\n            image: Resources.VioDanielSheetPng as ex.ImageSource,\n            grid: {\n                spriteWidth: 32,\n                spriteHeight: 48,\n                rows: 16,\n                columns: 28\n            }\n        });\n        \n        const leftIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(8, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(9, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(10, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(11, 1) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('left-idle', leftIdle);\n\n        const rightIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 2) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('right-idle', rightIdle);\n\n\n        const upIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 3) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('up-idle', upIdle);\n\n        const downIdle = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(4, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(5, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(6, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(7, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        downIdle.scale = ex.vec(0.5,0.5);\n        this.graphics.add('down-idle', downIdle);\n\n        this.current_graphics = 'down-idle';\n\n        const leftWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(8, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(9, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(10, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(11, 0) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        })\n        this.graphics.add('left-walk', leftWalk);\n\n        const rightWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 6) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('right-walk', rightWalk);\n\n        const upWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 7) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('up-walk', upWalk);\n\n        const downWalk = new ex.Animation({\n            frames: [\n                {graphic: playerSpriteSheet.getSprite(0, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(1, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(2, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n                {graphic: playerSpriteSheet.getSprite(3, 4) as ex.Sprite, duration: Config.PlayerFrameSpeed},\n            ]\n        });\n        this.graphics.add('down-walk', downWalk);\n    }\n    private _currentAnim = 'down-idle';\n\n    onPreUpdate(engine: ex.Engine, elapsedMs: number): void {\n        let dir = ex.Vector.Zero;\n        this.graphics.use(this._currentAnim = this.current_graphics);\n\n        if (true) {\n            dir.y = -1;\n            //this.graphics.use(this._currentAnim = 'up-walk');\n            //this.current_graphics = 'up-idle';\n        }\n\n    }\n\n    onPreCollisionResolve(self: ex.Collider, other: ex.Collider, side: ex.Side, contact: ex.CollisionContact): void {\n    }\n}","import * as ex from 'excalibur';\nimport { DialogManager } from './dialogmanager';\n\nexport class CustomText extends ex.Actor {\n    private dialogEl: HTMLElement | null = null;\n    private innerEl: HTMLElement | null = null;\n    private moreEl: HTMLElement | null = null;\n    private segments: string[] = [];\n    private currentSegment = 0;\n    private prevGamepadFace1Pressed = false;\n    private fullText = '';\n\n    // layout/calc cache\n    private fontSizePx: number | null = null;\n    private lineHeightPx: number | null = null;\n    private charsPerLine: number | null = null;\n    private linesPerBox: number = 3;\n    private lastOrientation: 'portrait' | 'landscape' | null = null;\n\n    constructor(pos: ex.Vector, width: number, height: number) {\n        super({\n            pos,\n            width: 16,\n            height: 16,\n            collisionType: ex.CollisionType.PreventCollision,\n            anchor: new ex.Vector(0, 0),\n            z: 100\n        })\n    }\n\n    onInitialize(engine: ex.Engine): void {\n        // Find or create the dialog overlay elements\n        this.dialogEl = document.getElementById('dialog');\n        this.innerEl = this.dialogEl?.querySelector('.dialog-text') as HTMLElement | null;\n        this.moreEl = this.dialogEl?.querySelector('.dialog-more') as HTMLElement | null;\n\n        // B button hook: pointerup advances dialog (consistent with release behavior)\n        const btnB = document.getElementById('btn-b');\n        if (btnB) {\n            btnB.addEventListener('pointerup', (e) => {\n                e.preventDefault();\n                this.advance();\n            });\n            btnB.addEventListener('pointerdown', (e) => e.preventDefault());\n        }\n\n        if (this.dialogEl) {\n            // Advance on pointer release (not pointerdown) to avoid skipping multiple segments while holding\n            this.dialogEl.addEventListener('pointerup', (e) => {\n                e.preventDefault();\n                this.advance();\n            });\n            // Prevent accidental pointerdown interactions propagating to the canvas\n            this.dialogEl.addEventListener('pointerdown', (e) => e.preventDefault());\n\n            // Recompute segmentation and font sizing only when the orientation actually changes\n            window.addEventListener('resize', () => {\n                const current = window.innerHeight >= window.innerWidth ? 'portrait' : 'landscape';\n                if (current !== this.lastOrientation) {\n                    this.lastOrientation = current;\n                    if (this.isVisible() && this.fullText) {\n                        const prev = this.currentSegment;\n                        // recompute sizing and resegment\n                        this.computeSizing();\n                        this.setDialogue(this.fullText);\n                        // jump to the nearest segment index so the player doesn't lose place\n                        this.currentSegment = Math.min(prev, this.segments.length - 1);\n                        this.showSegment(this.currentSegment);\n                    } else {\n                        // update sizing for next dialog\n                        this.computeSizing();\n                    }\n                }\n            });\n\n            // Also compute sizing at initialization\n            this.computeSizing();\n        }\n    }\n\n    onPreUpdate(engine: ex.Engine, elapsed: number): void {\n        const gp = engine.input.gamepads.at(0);\n        // advance on release: keyboard.wasReleased, pointerup handled via DOM event, gamepad release detected here\n        if (engine.input.keyboard.wasReleased(ex.Keys.Space) && this.isVisible()) {\n            this.advance();\n        }\n\n        const face1Pressed = gp.getButton(ex.Buttons.Face1) > 0;\n        if (this.prevGamepadFace1Pressed && !face1Pressed && this.isVisible()) {\n            // button was released\n            this.advance();\n        }\n        this.prevGamepadFace1Pressed = face1Pressed;\n    }\n\n    private isVisible() {\n        return this.dialogEl?.classList.contains('visible') ?? false;\n    }\n\n    private computeSizing() {\n        if (!this.innerEl || !this.dialogEl) return;\n        // Ensure dialog is rendered (not display:none) while measuring  temporarily show hidden dialog to get real sizes\n        let restoredStyles = false;\n        let oldDisplay = '';\n        let oldVisibility = '';\n        if (!this.isVisible()) {\n            oldDisplay = this.dialogEl.style.display;\n            oldVisibility = this.dialogEl.style.visibility;\n            this.dialogEl.style.display = 'flex';\n            this.dialogEl.style.visibility = 'hidden';\n            // Force layout\n            this.dialogEl.getBoundingClientRect();\n            restoredStyles = true;\n        }\n\n        const container = this.innerEl;\n        const compStyle = window.getComputedStyle(container);\n        const containerWidth = container.clientWidth;\n        const containerHeight = container.clientHeight;\n\n        // Restore previous visibility if we changed it\n        if (restoredStyles && this.dialogEl) {\n            this.dialogEl.style.display = oldDisplay;\n            this.dialogEl.style.visibility = oldVisibility;\n        }\n        console.log('containerwidth', containerWidth, 'containerheight', containerHeight);\n        // If still zero (fallback), compute from canvas third (no arbitrary subtraction)\n        let effectiveHeight = containerHeight > 0 ? containerHeight : 0;\n        if (effectiveHeight != 0) {\n            const canvas = document.getElementById('game') as HTMLCanvasElement | null;\n            if (canvas) {\n                const crect = canvas.getBoundingClientRect();\n                // Use exact third of canvas height (no extra subtraction)\n                effectiveHeight = Math.max(10, Math.floor(crect.height / 3));\n                console.log('crect.height', crect.height, '=> effectiveHeight', effectiveHeight);\n            } else {\n                effectiveHeight = Math.max(10, Math.floor(window.innerHeight * 0.33));\n                console.log('window.innerHeight', window.innerHeight, '=> effectiveHeight', effectiveHeight);\n            }\n        }\n        // Target three lines with small line gap\n        const targetLines = 7;\n        const targetLineHeightFactor = 1.05;\n        const usableHeight = effectiveHeight; // inner content area\n\n        // Compute font size so exactly targetLines fit the container\n        const fontSizePx = Math.max(10, Math.floor((usableHeight / targetLines) / targetLineHeightFactor));\n        const lineHeightPx = Math.max(12, Math.round(fontSizePx * targetLineHeightFactor));\n        console.log(usableHeight);\n        // Apply computed font sizing to ensure exact fit\n        container.style.fontSize = fontSizePx + 'px';\n        container.style.lineHeight = lineHeightPx + 'px';\n\n        // Measure average character width for the chosen font size\n        const meas = document.createElement('span');\n        meas.style.visibility = 'hidden';\n        meas.style.position = 'absolute';\n        meas.style.whiteSpace = 'nowrap';\n        meas.style.fontFamily = compStyle.fontFamily;\n        meas.style.fontSize = fontSizePx + 'px';\n        meas.textContent = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n        document.body.appendChild(meas);\n        const avgCharWidth = meas.getBoundingClientRect().width / (meas.textContent?.length || 1);\n        document.body.removeChild(meas);\n\n        const charsPerLine = Math.max(8, Math.floor(containerWidth / avgCharWidth));\n        const linesPerBox = targetLines; // we sized the font to fit 3 lines\n\n        // Store into cache fields rather than remeasuring later\n        this.fontSizePx = fontSizePx;\n        this.lineHeightPx = lineHeightPx;\n        this.charsPerLine = charsPerLine;\n        this.linesPerBox = linesPerBox-2;\n        this.lastOrientation = window.innerHeight >= window.innerWidth ? 'portrait' : 'landscape';\n    }\n\n    private show() {\n        if (!this.dialogEl) return;\n        this.dialogEl.classList.add('visible');\n        this.dialogEl.setAttribute('aria-hidden', 'false');\n        // Block player controls while dialog is visible\n        DialogManager.freeze_player = true;\n        // reset gamepad press tracking to avoid accidental immediate advance\n        this.prevGamepadFace1Pressed = false;\n    }\n\n    private hide() {\n        if (!this.dialogEl) return;\n        this.dialogEl.classList.remove('visible');\n        this.dialogEl.setAttribute('aria-hidden', 'true');\n        // Ensure player is unfrozen when dialog finishes\n        DialogManager.freeze_player = false;\n    }\n\n    private showSegment(index: number) {\n        if (!this.innerEl) return;\n        this.innerEl.textContent = this.segments[index] ?? '';\n        // update 'more' indicator\n        if (this.moreEl) {\n            if (this.currentSegment < this.segments.length - 1) {\n                this.moreEl.style.opacity = '1';\n            } else {\n                this.moreEl.style.opacity = '0';\n            }\n        }\n    }\n\n    /** Advance to the next segment (internal) */\n    private advance() {\n        if (this.currentSegment < this.segments.length - 1) {\n            this.currentSegment += 1;\n            this.showSegment(this.currentSegment);\n        } else {\n            this.hide();\n            this.segments = [];\n            this.currentSegment = 0;\n        }\n    }\n\n    /** Public method for external UI (e.g., B button) to advance */\n    public next() {\n        if (this.isVisible()) this.advance();\n    }\n\n    public setDialogue(dialogue_text: string) {\n        // Store full text for potential re-segmentation on resize\n        this.fullText = dialogue_text;\n        // Segment the text to fit into the dialog box (lower third).\n        if (!this.innerEl || !this.dialogEl) {\n            // Fallback: just show entire text in a single segment\n            this.segments = [dialogue_text];\n            this.currentSegment = 0;\n            this.show();\n            this.showSegment(0);\n            return;\n        }\n\n        // Ensure sizing is computed and only recompute when orientation changed\n        const currentOrientation = window.innerHeight >= window.innerWidth ? 'portrait' : 'landscape';\n        if (this.lastOrientation === null || this.lastOrientation !== currentOrientation) {\n            this.computeSizing();\n        }\n\n        // Re-read container width for segmentation fallback\n        const container = this.innerEl;\n        const compStyle = window.getComputedStyle(container);\n        const containerWidth = container.clientWidth;\n\n        // Build segments by words, ensuring we don't cut words when possible\n        const charsPerLine = this.charsPerLine ?? Math.max(8, Math.floor(containerWidth / 8));\n        const linesPerBox = this.linesPerBox;\n        const maxChars = charsPerLine * linesPerBox;\n\n        const words = dialogue_text.split(/(\\s+)/); // keep whitespace\n        const segments: string[] = [];\n        let current = '';\n\n        for (const w of words) {\n            const test = current + w;\n            if (test.length > maxChars && current.length > 0) {\n                segments.push(current.trim());\n                // If single word too large, split it\n                if (w.length > maxChars) {\n                    let part = '';\n                    for (let i = 0; i < w.length; i++) {\n                        part += w[i];\n                        if (part.length >= maxChars) {\n                            segments.push(part);\n                            part = '';\n                        }\n                    }\n                    current = part;\n                } else {\n                    current = w;\n                }\n            } else {\n                current = test;\n            }\n        }\n        if (current.trim().length > 0) segments.push(current.trim());\n\n        this.segments = segments.length ? segments : [dialogue_text];\n        this.currentSegment = 0;\n        this.showSegment(0);\n        this.show();\n    }\n}\n","!function(t,i){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=i():\"function\"==typeof define&&define.amd?define(\"nipplejs\",[],i):\"object\"==typeof exports?exports.nipplejs=i():t.nipplejs=i()}(window,function(){return function(t){var i={};function e(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:o})},e.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&\"object\"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&i&&\"string\"!=typeof t)for(var n in t)e.d(o,n,function(i){return t[i]}.bind(null,n));return o},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,\"a\",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p=\"\",e(e.s=0)}([function(t,i,e){\"use strict\";e.r(i);var o,n=function(t,i){var e=i.x-t.x,o=i.y-t.y;return Math.sqrt(e*e+o*o)},s=function(t){return t*(Math.PI/180)},r=function(t){return t*(180/Math.PI)},d=new Map,a=function(t){d.has(t)&&clearTimeout(d.get(t)),d.set(t,setTimeout(t,100))},p=function(t,i,e){for(var o,n=i.split(/[ ,]+/g),s=0;s<n.length;s+=1)o=n[s],t.addEventListener?t.addEventListener(o,e,!1):t.attachEvent&&t.attachEvent(o,e)},c=function(t,i,e){for(var o,n=i.split(/[ ,]+/g),s=0;s<n.length;s+=1)o=n[s],t.removeEventListener?t.removeEventListener(o,e):t.detachEvent&&t.detachEvent(o,e)},l=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},u=function(t,i){i.top||i.right||i.bottom||i.left?(t.style.top=i.top,t.style.right=i.right,t.style.bottom=i.bottom,t.style.left=i.left):(t.style.left=i.x+\"px\",t.style.top=i.y+\"px\")},f=function(t,i,e){var o=y(t);for(var n in o)if(o.hasOwnProperty(n))if(\"string\"==typeof i)o[n]=i+\" \"+e;else{for(var s=\"\",r=0,d=i.length;r<d;r+=1)s+=i[r]+\" \"+e+\", \";o[n]=s.slice(0,-2)}return o},y=function(t){var i={};i[t]=\"\";return[\"webkit\",\"Moz\",\"o\"].forEach(function(e){i[e+t.charAt(0).toUpperCase()+t.slice(1)]=\"\"}),i},m=function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t},v=function(t,i){if(t.length)for(var e=0,o=t.length;e<o;e+=1)i(t[e]);else i(t)},g=!!(\"ontouchstart\"in window),b=!!window.PointerEvent,x=!!window.MSPointerEvent,O={start:\"mousedown\",move:\"mousemove\",end:\"mouseup\"},w={};function _(){}b?o={start:\"pointerdown\",move:\"pointermove\",end:\"pointerup, pointercancel\"}:x?o={start:\"MSPointerDown\",move:\"MSPointerMove\",end:\"MSPointerUp\"}:g?(o={start:\"touchstart\",move:\"touchmove\",end:\"touchend, touchcancel\"},w=O):o=O,_.prototype.on=function(t,i){var e,o=t.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var n=0;n<o.length;n+=1)e=o[n],this._handlers_[e]=this._handlers_[e]||[],this._handlers_[e].push(i);return this},_.prototype.off=function(t,i){return this._handlers_=this._handlers_||{},void 0===t?this._handlers_={}:void 0===i?this._handlers_[t]=null:this._handlers_[t]&&this._handlers_[t].indexOf(i)>=0&&this._handlers_[t].splice(this._handlers_[t].indexOf(i),1),this},_.prototype.trigger=function(t,i){var e,o=this,n=t.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var s=0;s<n.length;s+=1)e=n[s],o._handlers_[e]&&o._handlers_[e].length&&o._handlers_[e].forEach(function(t){t.call(o,{type:e,target:o},i)})},_.prototype.config=function(t){this.options=this.defaults||{},t&&(this.options=function(t,i){var e={};for(var o in t)t.hasOwnProperty(o)&&i.hasOwnProperty(o)?e[o]=i[o]:t.hasOwnProperty(o)&&(e[o]=t[o]);return e}(this.options,t))},_.prototype.bindEvt=function(t,i){var e=this;return e._domHandlers_=e._domHandlers_||{},e._domHandlers_[i]=function(){\"function\"==typeof e[\"on\"+i]?e[\"on\"+i].apply(e,arguments):console.warn('[WARNING] : Missing \"on'+i+'\" handler.')},p(t,o[i],e._domHandlers_[i]),w[i]&&p(t,w[i],e._domHandlers_[i]),e},_.prototype.unbindEvt=function(t,i){return this._domHandlers_=this._domHandlers_||{},c(t,o[i],this._domHandlers_[i]),w[i]&&c(t,w[i],this._domHandlers_[i]),delete this._domHandlers_[i],this};var T=_;function k(t,i){return this.identifier=i.identifier,this.position=i.position,this.frontPosition=i.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:\"white\",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:\"dynamic\",zone:document.body,lockX:!1,lockY:!1,shape:\"circle\"},this.config(i),\"dynamic\"===this.options.mode&&(this.options.restOpacity=0),this.id=k.id,k.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}k.prototype=new T,k.constructor=k,k.id=0,k.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement(\"div\"),this.ui.back=document.createElement(\"div\"),this.ui.front=document.createElement(\"div\"),this.ui.el.className=\"nipple collection_\"+this.collection.id,this.ui.back.className=\"back\",this.ui.front.className=\"front\",this.ui.el.setAttribute(\"id\",\"nipple_\"+this.collection.id+\"_\"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)},k.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+\"ms\",i=function(t,i){var e=y(t);for(var o in e)e.hasOwnProperty(o)&&(e[o]=i);return e}(\"borderRadius\",\"50%\"),e=f(\"transition\",\"opacity\",t),o={};return o.el={position:\"absolute\",opacity:this.options.restOpacity,display:\"block\",zIndex:999},o.back={position:\"absolute\",display:\"block\",width:this.options.size+\"px\",height:this.options.size+\"px\",left:0,marginLeft:-this.options.size/2+\"px\",marginTop:-this.options.size/2+\"px\",background:this.options.color,opacity:\".5\"},o.front={width:this.options.size/2+\"px\",height:this.options.size/2+\"px\",position:\"absolute\",display:\"block\",left:0,marginLeft:-this.options.size/4+\"px\",marginTop:-this.options.size/4+\"px\",background:this.options.color,opacity:\".5\",transform:\"translate(0px, 0px)\"},m(o.el,e),\"circle\"===this.options.shape&&m(o.back,i),m(o.front,i),this.applyStyles(o),this},k.prototype.applyStyles=function(t){for(var i in this.ui)if(this.ui.hasOwnProperty(i))for(var e in t[i])this.ui[i].style[e]=t[i][e];return this},k.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)},k.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)},k.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger(\"destroyed\",this.instance),this.removeFromDom(),this.off()},k.prototype.show=function(t){var i=this;return i.options.dataOnly?i:(clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.addToDom(),i.restCallback(),setTimeout(function(){i.ui.el.style.opacity=1},0),i.showTimeout=setTimeout(function(){i.trigger(\"shown\",i.instance),\"function\"==typeof t&&t.call(this)},i.options.fadeTime),i)},k.prototype.hide=function(t){var i=this;if(i.options.dataOnly)return i;if(i.ui.el.style.opacity=i.options.restOpacity,clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.removeTimeout=setTimeout(function(){var e=\"dynamic\"===i.options.mode?\"none\":\"block\";i.ui.el.style.display=e,\"function\"==typeof t&&t.call(i),i.trigger(\"hidden\",i.instance)},i.options.fadeTime),i.options.restJoystick){var e=i.options.restJoystick,o={};o.x=!0===e||!1!==e.x?0:i.instance.frontPosition.x,o.y=!0===e||!1!==e.y?0:i.instance.frontPosition.y,i.setPosition(t,o)}return i},k.prototype.setPosition=function(t,i){var e=this;e.frontPosition={x:i.x,y:i.y};var o=e.options.fadeTime+\"ms\",n={};n.front=f(\"transition\",[\"transform\"],o);var s={front:{}};s.front={transform:\"translate(\"+e.frontPosition.x+\"px,\"+e.frontPosition.y+\"px)\"},e.applyStyles(n),e.applyStyles(s),e.restTimeout=setTimeout(function(){\"function\"==typeof t&&t.call(e),e.restCallback()},e.options.fadeTime)},k.prototype.restCallback=function(){var t={};t.front=f(\"transition\",\"none\",\"\"),this.applyStyles(t),this.trigger(\"rested\",this.instance)},k.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},k.prototype.computeDirection=function(t){var i,e,o,n=t.angle.radian,s=Math.PI/4,r=Math.PI/2;if(n>s&&n<3*s&&!t.lockX?i=\"up\":n>-s&&n<=s&&!t.lockY?i=\"left\":n>3*-s&&n<=-s&&!t.lockX?i=\"down\":t.lockY||(i=\"right\"),t.lockY||(e=n>-r&&n<r?\"left\":\"right\"),t.lockX||(o=n>0?\"up\":\"down\"),t.force>this.options.threshold){var d,a={};for(d in this.direction)this.direction.hasOwnProperty(d)&&(a[d]=this.direction[d]);var p={};for(d in this.direction={x:e,y:o,angle:i},t.direction=this.direction,a)a[d]===this.direction[d]&&(p[d]=!0);if(p.x&&p.y&&p.angle)return t;p.x&&p.y||this.trigger(\"plain\",t),p.x||this.trigger(\"plain:\"+e,t),p.y||this.trigger(\"plain:\"+o,t),p.angle||this.trigger(\"dir dir:\"+i,t)}else this.resetDirection();return t};var P=k;function E(t,i){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=t,this.id=E.id,E.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:\"dynamic\",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:\"white\",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:\"circle\",dynamicPage:!1,follow:!1},this.config(i),\"static\"!==this.options.mode&&\"semi\"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var e=getComputedStyle(this.options.zone.parentElement);return e&&\"flex\"===e.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}E.prototype=new T,E.constructor=E,E.id=0,E.prototype.prepareNipples=function(){var t=this.nipples;t.on=this.on.bind(this),t.off=this.off.bind(this),t.options=this.options,t.destroy=this.destroy.bind(this),t.ids=this.ids,t.id=this.id,t.processOnMove=this.processOnMove.bind(this),t.processOnEnd=this.processOnEnd.bind(this),t.get=function(i){if(void 0===i)return t[0];for(var e=0,o=t.length;e<o;e+=1)if(t[e].identifier===i)return t[e];return!1}},E.prototype.bindings=function(){this.bindEvt(this.options.zone,\"start\"),this.options.zone.style.touchAction=\"none\",this.options.zone.style.msTouchAction=\"none\"},E.prototype.begin=function(){var t=this.options;if(\"static\"===t.mode){var i=this.createNipple(t.position,this.manager.getIdentifier());i.add(),this.idles.push(i)}},E.prototype.createNipple=function(t,i){var e=this.manager.scroll,o={},n=this.options,s=this.parentIsFlex?e.x:e.x+this.box.left,r=this.parentIsFlex?e.y:e.y+this.box.top;if(t.x&&t.y)o={x:t.x-s,y:t.y-r};else if(t.top||t.right||t.bottom||t.left){var d=document.createElement(\"DIV\");d.style.display=\"hidden\",d.style.top=t.top,d.style.right=t.right,d.style.bottom=t.bottom,d.style.left=t.left,d.style.position=\"absolute\",n.zone.appendChild(d);var a=d.getBoundingClientRect();n.zone.removeChild(d),o=t,t={x:a.left+e.x,y:a.top+e.y}}var p=new P(this,{color:n.color,size:n.size,threshold:n.threshold,fadeTime:n.fadeTime,dataOnly:n.dataOnly,restJoystick:n.restJoystick,restOpacity:n.restOpacity,mode:n.mode,identifier:i,position:t,zone:n.zone,frontPosition:{x:0,y:0},shape:n.shape});return n.dataOnly||(u(p.ui.el,o),u(p.ui.front,p.frontPosition)),this.nipples.push(p),this.trigger(\"added \"+p.identifier+\":added\",p),this.manager.trigger(\"added \"+p.identifier+\":added\",p),this.bindNipple(p),p},E.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},E.prototype.bindNipple=function(t){var i,e=this,o=function(t,o){i=t.type+\" \"+o.id+\":\"+t.type,e.trigger(i,o)};t.on(\"destroyed\",e.onDestroyed.bind(e)),t.on(\"shown hidden rested dir plain\",o),t.on(\"dir:up dir:right dir:down dir:left\",o),t.on(\"plain:up plain:right plain:down plain:left\",o)},E.prototype.pressureFn=function(t,i,e){var o=this,n=0;clearInterval(o.pressureIntervals[e]),o.pressureIntervals[e]=setInterval(function(){var e=t.force||t.pressure||t.webkitForce||0;e!==n&&(i.trigger(\"pressure\",e),o.trigger(\"pressure \"+i.identifier+\":pressure\",e),n=e)}.bind(o),100)},E.prototype.onstart=function(t){var i=this,e=i.options,o=t;t=l(t),i.updateBox();return v(t,function(n){i.actives.length<e.maxNumberOfNipples?i.processOnStart(n):o.type.match(/^touch/)&&(Object.keys(i.manager.ids).forEach(function(e){if(Object.values(o.touches).findIndex(function(t){return t.identifier===e})<0){var n=[t[0]];n.identifier=e,i.processOnEnd(n)}}),i.actives.length<e.maxNumberOfNipples&&i.processOnStart(n))}),i.manager.bindDocument(),!1},E.prototype.processOnStart=function(t){var i,e=this,o=e.options,s=e.manager.getIdentifier(t),r=t.force||t.pressure||t.webkitForce||0,d={x:t.pageX,y:t.pageY},a=e.getOrCreate(s,d);a.identifier!==s&&e.manager.removeIdentifier(a.identifier),a.identifier=s;var p=function(i){i.trigger(\"start\",i),e.trigger(\"start \"+i.id+\":start\",i),i.show(),r>0&&e.pressureFn(t,i,i.identifier),e.processOnMove(t)};if((i=e.idles.indexOf(a))>=0&&e.idles.splice(i,1),e.actives.push(a),e.ids.push(a.identifier),\"semi\"!==o.mode)p(a);else{if(!(n(d,a.position)<=o.catchDistance))return a.destroy(),void e.processOnStart(t);p(a)}return a},E.prototype.getOrCreate=function(t,i){var e,o=this.options;return/(semi|static)/.test(o.mode)?(e=this.idles[0])?(this.idles.splice(0,1),e):\"semi\"===o.mode?this.createNipple(i,t):(console.warn(\"Coudln't find the needed nipple.\"),!1):e=this.createNipple(i,t)},E.prototype.processOnMove=function(t){var i=this.options,e=this.manager.getIdentifier(t),o=this.nipples.get(e),d=this.manager.scroll;if(function(t){return isNaN(t.buttons)?0!==t.pressure:0!==t.buttons}(t)){if(!o)return console.error(\"Found zombie joystick with ID \"+e),void this.manager.removeIdentifier(e);if(i.dynamicPage){var a=o.el.getBoundingClientRect();o.position={x:d.x+a.left,y:d.y+a.top}}o.identifier=e;var p=o.options.size/2,c={x:t.pageX,y:t.pageY};i.lockX&&(c.y=o.position.y),i.lockY&&(c.x=o.position.x);var l,h,u,f,y,m,v,g,b,x,O=n(c,o.position),w=(l=c,h=o.position,u=h.x-l.x,f=h.y-l.y,r(Math.atan2(f,u))),_=s(w),T=O/p,k={distance:O,position:c};if(\"circle\"===o.options.shape?(y=Math.min(O,p),v=o.position,g=y,x={x:0,y:0},b=s(b=w),x.x=v.x-g*Math.cos(b),x.y=v.y-g*Math.sin(b),m=x):(m=function(t,i,e){return{x:Math.min(Math.max(t.x,i.x-e),i.x+e),y:Math.min(Math.max(t.y,i.y-e),i.y+e)}}(c,o.position,p),y=n(m,o.position)),i.follow){if(O>p){var P=c.x-m.x,E=c.y-m.y;o.position.x+=P,o.position.y+=E,o.el.style.top=o.position.y-(this.box.top+d.y)+\"px\",o.el.style.left=o.position.x-(this.box.left+d.x)+\"px\",O=n(c,o.position)}}else c=m,O=y;var I=c.x-o.position.x,z=c.y-o.position.y;o.frontPosition={x:I,y:z},i.dataOnly||(o.ui.front.style.transform=\"translate(\"+I+\"px,\"+z+\"px)\");var D={identifier:o.identifier,position:c,force:T,pressure:t.force||t.pressure||t.webkitForce||0,distance:O,angle:{radian:_,degree:w},vector:{x:I/p,y:-z/p},raw:k,instance:o,lockX:i.lockX,lockY:i.lockY};(D=o.computeDirection(D)).angle={radian:s(180-w),degree:180-w},o.trigger(\"move\",D),this.trigger(\"move \"+o.id+\":move\",D)}else this.processOnEnd(t)},E.prototype.processOnEnd=function(t){var i=this,e=i.options,o=i.manager.getIdentifier(t),n=i.nipples.get(o),s=i.manager.removeIdentifier(n.identifier);n&&(e.dataOnly||n.hide(function(){\"dynamic\"===e.mode&&(n.trigger(\"removed\",n),i.trigger(\"removed \"+n.id+\":removed\",n),i.manager.trigger(\"removed \"+n.id+\":removed\",n),n.destroy())}),clearInterval(i.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger(\"end\",n),i.trigger(\"end \"+n.id+\":end\",n),i.ids.indexOf(n.identifier)>=0&&i.ids.splice(i.ids.indexOf(n.identifier),1),i.actives.indexOf(n)>=0&&i.actives.splice(i.actives.indexOf(n),1),/(semi|static)/.test(e.mode)?i.idles.push(n):i.nipples.indexOf(n)>=0&&i.nipples.splice(i.nipples.indexOf(n),1),i.manager.unbindDocument(),/(semi|static)/.test(e.mode)&&(i.manager.ids[s.id]=s.identifier))},E.prototype.onDestroyed=function(t,i){this.nipples.indexOf(i)>=0&&this.nipples.splice(this.nipples.indexOf(i),1),this.actives.indexOf(i)>=0&&this.actives.splice(this.actives.indexOf(i),1),this.idles.indexOf(i)>=0&&this.idles.splice(this.idles.indexOf(i),1),this.ids.indexOf(i.identifier)>=0&&this.ids.splice(this.ids.indexOf(i.identifier),1),this.manager.removeIdentifier(i.identifier),this.manager.unbindDocument()},E.prototype.destroy=function(){for(var t in this.unbindEvt(this.options.zone,\"start\"),this.nipples.forEach(function(t){t.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(t)&&clearInterval(this.pressureIntervals[t]);this.trigger(\"destroyed\",this.nipples),this.manager.unbindDocument(),this.off()};var I=E;function z(t){var i=this;i.ids={},i.index=0,i.collections=[],i.scroll=h(),i.config(t),i.prepareCollections();var e=function(){var t;i.collections.forEach(function(e){e.forEach(function(e){t=e.el.getBoundingClientRect(),e.position={x:i.scroll.x+t.left,y:i.scroll.y+t.top}})})};p(window,\"resize\",function(){a(e)});var o=function(){i.scroll=h()};return p(window,\"scroll\",function(){a(o)}),i.collections}z.prototype=new T,z.constructor=z,z.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(i){var e;return t.collections.every(function(t){return!(e=t.get(i))}),e}},z.prototype.create=function(t){return this.createCollection(t)},z.prototype.createCollection=function(t){var i=new I(this,t);return this.bindCollection(i),this.collections.push(i),i},z.prototype.bindCollection=function(t){var i,e=this,o=function(t,o){i=t.type+\" \"+o.id+\":\"+t.type,e.trigger(i,o)};t.on(\"destroyed\",e.onDestroyed.bind(e)),t.on(\"shown hidden rested dir plain\",o),t.on(\"dir:up dir:right dir:down dir:left\",o),t.on(\"plain:up plain:right plain:down plain:left\",o)},z.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,\"move\").bindEvt(document,\"end\"),this.binded=!0)},z.prototype.unbindDocument=function(t){Object.keys(this.ids).length&&!0!==t||(this.unbindEvt(document,\"move\").unbindEvt(document,\"end\"),this.binded=!1)},z.prototype.getIdentifier=function(t){var i;return t?void 0===(i=void 0===t.identifier?t.pointerId:t.identifier)&&(i=this.latest||0):i=this.index,void 0===this.ids[i]&&(this.ids[i]=this.index,this.index+=1),this.latest=i,this.ids[i]},z.prototype.removeIdentifier=function(t){var i={};for(var e in this.ids)if(this.ids[e]===t){i.id=e,i.identifier=this.ids[e],delete this.ids[e];break}return i},z.prototype.onmove=function(t){return this.onAny(\"move\",t),!1},z.prototype.onend=function(t){return this.onAny(\"end\",t),!1},z.prototype.oncancel=function(t){return this.onAny(\"end\",t),!1},z.prototype.onAny=function(t,i){var e,o=this,n=\"processOn\"+t.charAt(0).toUpperCase()+t.slice(1);i=l(i);return v(i,function(t){e=o.getIdentifier(t),v(o.collections,function(t,i,e){e.ids.indexOf(i)>=0&&(e[n](t),t._found_=!0)}.bind(null,t,e)),t._found_||o.removeIdentifier(e)}),!1},z.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(t){t.destroy()}),this.off()},z.prototype.onDestroyed=function(t,i){if(this.collections.indexOf(i)<0)return!1;this.collections.splice(this.collections.indexOf(i),1)};var D=new z;i.default={create:function(t){return D.create(t)},factory:D}}]).default});"],"names":["root","factory","exports","module","define","amd","self","___CSS_LOADER_EXPORT___","push","id","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","PointerScope","RotationType","polyfill","window","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","requestIdleCallback","cb","start","Date","now","setTimeout","didTimeout","timeRemaining","Math","max","cancelIdleCallback","clearTimeout","Flags","useCanvasGraphicsContext","enable","useLegacyImageRenderer","freeze","_FROZEN","_reset","_FLAGS","flagName","Error","disable","isEnabled","show","keys","createId","type","Future","constructor","_isCompleted","promise","_resolver","_rejecter","isCompleted","error","EventEmitter","_paused","_empty","_listeners","_listenersOnce","_pipes","clear","on","eventName","handler","close","off","once","newListeners","filter","h","newOnceListeners","emit","event","listeners","onces","pipe","emitter","indexOf","splice","unpipe","pause","unpause","BITMASK32","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Array","s","_index","_twist","mag01","y","nextInt","next","floating","min","integer","floor","bool","likelihood","pickOne","array","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","result","currentPick","tempArray","slice","index","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","TwoPI","PI","frac","x","ceil","sign","val","clamp","approximatelyEqual","val1","val2","tolerance","abs","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","from","to","_x","randomInRange","random","randomIntInRange","round","Vector","Zero","One","Half","Up","Down","Left","Right","fromAngle","cos","sin","isValid","vec","isNaN","Infinity","distance","vec1","vec2","sqrt","pow","_y","setTo","equals","vector","EQUALS_EPSILON","v","deltaX","deltaY","squareDistance","clampMagnitude","magnitude","newSize","size","newLength","normalize","scale","newMagnitude","average","add","sizeOrScale","dest","sub","addEqual","subEqual","scaleEqual","dot","cross","num","perpendicular","normal","negate","toAngle","atan2","angleBetween","rotationType","startAngleRadians","endAngleRadians","rotationClockwise","rotationAntiClockwise","ShortestPath","LongestPath","Clockwise","CounterClockwise","rotate","anchor","sinAngle","cosAngle","clone","fixed","toFixed","Color","g","b","fromRGB","fromRGBString","string","match","parseInt","parseFloat","fromHex","hex","fromHSL","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","c","hexRepresentation","String","fillStyle","Black","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Rose","Pink","Magenta","Violet","Purple","Blue","Azure","Cyan","Viridian","Teal","Green","Chartreuse","Transparent","ExcaliburBlue","Brown","hue2rgb","p","q","t","LogLevel","Side","MatrixLocations","Logger","_appenders","defaultLevel","Info","_logOnceSet","Set","_INSTANCE","addAppender","ConsoleAppender","getInstance","appender","clearAppenders","_log","level","args","len","log","_logOnce","serialized","has","debug","Debug","debugOnce","info","infoOnce","warn","Warn","warnOnce","errorOnce","fatal","Fatal","fatalOnce","console","consoleArgs","unshift","apply","ScreenAppender","options","_messages","_pos","_color","_options","canvas","document","createElement","_ctx","getContext","style","position","zIndex","body","appendChild","_positionScreenAppenderCanvas","engine","events","width","resolution","height","pagePos","screenToPageCoordinates","left","top","xPos","message","clearRect","pos","fillText","getOpposite","side","Top","Bottom","None","fromDirection","direction","BoundingBox","leftOrOptions","right","bottom","_points","reset","getSideFromIntersection","intersection","fromPoints","points","minX","minY","maxX","maxY","fromDimension","hasZeroDimensions","center","topLeft","bottomRight","topRight","bottomLeft","translate","point","getPoints","shifted","transform","matrix","xa1","xa2","xb1","xb2","ya1","ya2","yb1","yb2","matrixPos","getPosition","getPerimeter","_left","_right","_top","_bottom","rayCast","ray","farClipDistance","tMin","tMax","xInv","dir","Number","MAX_VALUE","yInv","tx1","tx2","ty1","ty2","rayCastTime","contains","combine","other","compositeBB","dimensions","overlaps","epsilon","e","totalBoundingBox","intersect","overlapX","overlapY","intersectWithSide","bb","draw","ex","drawRect","el","getBoundingClientRect","rect","scrollX","scrollY","addItemToArray","removeItemFromArray","fail","delay","milliseconds","clock","future","schedule","bind","omit","object","newObj","includes","isObject","isArray","mergeDeep","target","sources","source","shift","assign","Matrix","Float32Array","_scaleX","_scaleSignX","_scaleY","_scaleSignY","ortho","near","far","mat","toDOMMatrix","DOMMatrix","fromFloat32Array","identity","translation","sx","sy","rotation","vectorOrMatrix","resultX","resultY","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","AffineMatrix","Float64Array","_scale","determinant","inverse","det","signX","signY","multiplyQuadInPlace","quad","resultTopLeftX","resultTopLeftY","resultTopRightX","resultTopRightY","resultBottomLeftX","resultBottomLeftY","resultBottomRightX","resultBottomRightY","to4x4","xScaleSq","yScaleSq","RentalPool","builder","cleaner","preAllocate","_pool","_size","grow","amount","rent","clean","pop","TransformStack","_transforms","_currentTransform","save","restore","return","current","ContextState","opacity","z","tint","material","StateStack","_states","_cloneState","ResourceEvents","Complete","Load","LoadStart","Progress","Resource","path","responseType","bustCache","logger","isLoaded","_cacheBust","uri","test","load","request","XMLHttpRequest","open","addEventListener","status","response","statusText","Blob","errorText","send","watch","change","__isProxy","Proxy","set","createHandler","typeType","Graphic","isStale","_transformStale","flipHorizontal","_flipHorizontal","flipVertical","_flipVertical","_rotation","origin","_origin","_ID","showDebug","_width","_height","cloneGraphicOptions","localBounds","_preDraw","_drawImage","_postDraw","_rotate","_flip","scaleDirX","scaleDirY","Sprite","image","super","_logger","_dirty","sourceView","destSize","_updateSpriteDimensions","ready","then","newWidth","newHeight","nativeWidth","nativeHeight","drawImage","ImageFiltering","ImageWrapping","parseImageFiltering","Pixel","Blended","parseImageWrapping","Clamp","Repeat","Mirror","TextureLoader","gl","_garbageCollector","_textureMap","Map","_collect","_gl","name","dataset","originalSrc","_LOGGER","delete","_MAX_TEXTURE_SIZE","getParameter","MAX_TEXTURE_SIZE","collectionInterval","garbageCollector","registerCollector","dispose","forceUpdate","filtering","wrapping","wrappingConfig","tex","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","touch","createTexture","checkImageSizeSupportedAndLog","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","xWrap","yWrap","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","REPEAT","MIRRORED_REPEAT","TEXTURE_WRAP_T","filterMode","TEXTURE_MIN_FILTER","NEAREST","LINEAR","TEXTURE_MAG_FILTER","addCollectableResource","texture","deleteTexture","ImageSourceAttributeConstants","Filtering","WrappingX","WrappingY","ImageSource","naturalWidth","naturalHeight","_src","src","pathOrBase64","bustCacheOrOptions","Image","_readyFuture","_resource","endsWith","fromHtmlImageElement","imageSource","setAttribute","fromHtmlCanvasElement","toBlob","blob","url","URL","createObjectURL","onload","revokeObjectURL","fromSvgString","svgSource","loadedFuture","toSprite","unload","SpriteFont","_text","alphabet","shadow","caseInsensitive","spacing","lineHeight","spriteSheet","_getCharacterSprites","text","results","textToRender","toLocaleLowerCase","letterIndex","letter","spriteIndex","letterSprite","sprites","measureText","maxWidth","lines","_getLinesFromText","maxWidthLine","reduce","sprite","xCursor","yCursor","line","render","bounds","offset","_cachedText","_cachedRenderWidth","_cachedLines","split","newLine","TiledSprite","_ready","_applyTiling","fromSprite","spriteCanvas","tiledImageSource","SpriteSheet","rows","columns","getSprite","spriteWithOptions","getTiledSprite","fromImageSourceWithSourceViews","sourceViews","fromImageSource","grid","cols","spriteWidth","spriteHeight","originOffset","margin","offsetDefaults","marginDefaults","DebugText","fontSheet","_imageSource","_spriteSheet","_spriteFont","write","ctx","RenderSource","_texture","use","activeTexture","TEXTURE0","RenderTarget","antialias","samples","transparency","MAX_SAMPLES","drawingBufferFormat","bufferFormat","RGBA8","RGB8","_setupRenderBuffer","_setupFramebuffer","setResolution","_frameTexture","_renderBuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorageMultisample","renderBuffer","renderFrameBuffer","_renderFrameBuffer","frameBuffer","_frameBuffer","frameTexture","createRenderbuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferRenderbuffer","COLOR_ATTACHMENT0","attachmentPoint","framebufferTexture2D","toRenderSource","blitRenderBufferToFrameBuffer","blitToScreen","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER","clearBufferfv","COLOR","blitFramebuffer","COLOR_BUFFER_BIT","copyToTexture","copyTexImage2D","viewport","getGlTypeSizeBytes","INT","UNSIGNED_INT","FLOAT","SHORT","UNSIGNED_SHORT","BYTE","isAttributeInSource","variable","matches","RegExp","exec","getGLTypeFromSource","groups","BOOL","getAttributeComponentSize","LOW_FLOAT","HIGH_FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","getAttributePointerType","getMaxShaderComplexity","numIfs","assembleTestShader","testShader","testComplexity","replace","canCompile","shader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","Shader","compiled","_compiled","uniforms","attributes","vertexSource","fragmentSource","onPreLink","onPostCompile","_onPreLink","_onPostCompile","deleteProgram","program","useProgram","_ACTIVE_SHADER_INSTANCE","isCurrentlyBound","compile","vertexShader","_compileShader","VERTEX_SHADER","fragmentShader","_createProgram","getAttributes","attribute","getUniforms","uniform","uniformCount","getProgramParameter","ACTIVE_UNIFORMS","getActiveUniform","uniformLocation","getUniformLocation","glType","location","attributeCount","ACTIVE_ATTRIBUTES","getActiveAttrib","attributeLocation","getAttribLocation","normalized","setTexture","slotNumber","setUniformInt","setUniform","trySetUniformInt","trySetUniform","setUniformIntArray","trySetUniformIntArray","setUniformBoolean","trySetUniformBoolean","setUniformFloat","trySetUniformFloat","setUniformFloatArray","trySetUniformFloatArray","setUniformFloatVector","trySetUniformFloatVector","setUniformFloatColor","trySetUniformFloatColor","setUniformMatrix","setUniformAffineMatrix","trySetUniformMatrix","uniformType","createProgram","attachShader","linkProgram","LINK_STATUS","getProgramInfoLog","typeName","errorInfo","getShaderInfoLog","_processSourceForError","errorLineStart","search","errorLineEnd","_","error2","VertexBuffer","buffer","createBuffer","bufferData","bindBuffer","ARRAY_BUFFER","STATIC_DRAW","DYNAMIC_DRAW","unbind","upload","count","bufferSubData","deleteBuffer","VertexLayout","vertexBuffer","_vertexBuffer","_attributes","_suppressWarnings","_layout","_vertexTotalSizeBytes","_initialized","suppressWarnings","_shader","initialize","totalVertexSizeBytes","shaderAttributes","attrib","componentsPerVertex","vertAttribute","typeSize","_vao","createVertexArray","bindVertexArray","vert","vertexAttribIPointer","vertexAttribPointer","enableVertexAttribArray","uploadBuffer","GraphicsDiagnostics","DrawCallCount","DrawnImagesCount","LineRenderer","priority","_maxLines","_vertexIndex","_lineCount","_startScratch","_endScratch","context","_context","end","_isFull","flush","getTransform","finalStart","finalEnd","hasPendingDraws","drawArrays","LINES","PointRenderer","_maxPoints","_pointCount","_buffer","snapToPixel","finalPoint","pixelSnapEpsilon","POINTS","ScreenPassPainter","renderWithPostProcessor","postprocessor","getShader","getLayout","onDraw","TRIANGLES","renderToScreen","QuadIndexBuffer","numberOfQuads","useUint16","ELEMENT_ARRAY_BUFFER","totalVertices","maxUint16","maxUint16Index","bufferGlType","Uint16Array","Uint32Array","currentQuad","ImageRenderer","_maxImages","_maxTextures","_imageCount","_textures","_textureIndex","_textureToIndex","_images","_imageToWidth","_imageToHeight","_view","_dest","_quad","_defaultTint","pixelArtSampler","uvPadding","maxTexture","MAX_TEXTURE_IMAGE_UNITS","maxComplexity","transformedFrag","_transformFragmentSource","_quads","maxTextures","newSource","texturePickerBuilder","_addImageAsTexture","maybeFiltering","getAttribute","wrapX","wrapY","force","textureLoader","removeAttribute","_bindTextures","_getTextureIdForImage","maybeTexture","_getImageWidth","maybeWidth","_getImageHeight","maybeHeight","swidth","sheight","dx","dy","dwidth","dheight","maybeImageWidth","maybeImageHeight","sw","sh","textureId","imageWidth","imageHeight","uvx0","uvy0","uvx1","uvy1","txWidth","txHeight","drawElements","RectangleRenderer","_maxRectangles","_rectangleCount","_transparent","_scratch1","_scratch2","_scratch3","_scratch4","drawLine","drawRectangle","thickness","halfThick","startTop","startBottom","endTop","endBottom","stroke","strokeThickness","CircleRenderer","_maxCircles","_circleCount","radius","Pool","recycler","maxObjects","totalAllocations","objects","disableWarnings","preallocate","using","done","borrow","poolIndex","DrawCall","renderer","state","Material","graphicsContext","images","_name","_vertexSource","_fragmentSource","ExcaliburGraphicsContextWebGL","_graphicsContext","_initialize","addImageSource","graphicsContextWebGL","__gl","_maxTextureSlots","isUsingScreenTexture","update","textureUniformName","removeImageSource","textureName","_loadImageSource","imageElement","uploadAndBind","startingTextureSlot","textureSlot","entries","MaterialRenderer","vertexIndex","view","topLeftScreen","bottomRightScreen","screenUVX0","screenUVY0","screenUVX1","screenUVY1","performance","materialScreenTexture","CoordPlane","AnimationDirection","AnimationStrategy","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","WatchVector","original","newX","newY","_parent","_children","flagDirty","_globalPos","parent","_globalScale","globalScaleX","globalScale","globalScaleY","_z","_isDirty","_isInverseDirty","_matrix","_inverse","_scratch","children","globalPos","localPos","canonRotation","globalRotation","inverseRotation","inverseScale","globalZ","_calculateMatrix","applyInverse","setTransform","isMirrored","cloneWithParent","isComponentCtor","Component","owner","newComponent","Observable","observers","subscriptions","register","observer","subscribe","func","unregister","unsubscribe","notifyAll","observersLength","notify","subscriptionsLength","TransformComponent","_parentComponent","_transform","_addChildTransform","child","childTxComponent","zIndexChanged$","_coordPlane","World","onAdd","childrenAdded$","childrenRemoved$","onRemove","_previousOwner","oldz","coordPlane","component","AnimationEvents","Frame","Loop","End","Animation","frames","strategy","frameDuration","_idempotencyToken","_firstTick","_currentFrame","_timeLeftInFrame","_pingPongDirection","_done","_playing","_speed","_reversed","speed","totalDuration","reverse","goToFrame","f","maybeFrame","currentFrame","graphic","fromSpriteSheet","spriteSheetIndex","durationPerFrame","maxIndex","invalidIndices","duration","fromSpriteSheetCoordinates","frameCoordinates","durationPerFrameMs","defaultDuration","coord","currentFrameIndex","currentFrameTimeLeft","isPlaying","isReversed","Backward","Forward","play","canFinish","Freeze","frameNumber","frameIndex","_nextFrame","PingPong","tick","elapsed","idempotencyToken","GraphicsGroup","useAnchor","members","_updateDimensions","member","useBounds","_isAnimationOrGroup","Raster","lineCap","quality","_smoothing","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","bitmapHeight","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperties","execute","imageSmoothingEnabled","setLineDash","getLineDash","strokeStyle","FontUnit","TextAlign","BaseAlign","FontStyle","Direction","EventTypes","x1","y1","x2","y2","cap","beginPath","moveTo","lineTo","closePath","arc","roundRect","fill","br","tl","tr","bl","defaultRadius","quadraticCurveTo","circle","FontTextInstance","font","_textFragments","disposed","_setDimension","_lastHashCode","getHashCode","_applyFont","metrics","textHeight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","actualBoundingBoxLeft","actualBoundingBoxRight","textBounds","bitmap","lineHeightRatio","fontString","textAlign","baseAlign","includeColor","resetTransform","textBaseline","shadowColor","blur","shadowBlur","shadowOffsetX","shadowOffsetY","_drawText","strokeText","_splitTextBitmap","textImages","currentX","currentY","_ex","hashCode","frag","FontCache","hash","_MEASURE_CACHE","measurement","measureTextWithoutCache","getTextInstance","textInstance","_TEXT_CACHE","_TEXT_USAGE","checkAndClearCache","deferred","currentHashCodes","time","FONT_TIMEOUT","forEach","newTextMeasurementCache","cacheSize","clearCache","Font","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textMeasurement","colorOverride","Text","_textWidth","_textHeight","_calculateDimension","_font","hasGraphicsTick","GraphicsComponent","visible","isVisible","_offset","recalculateBounds","_anchor","currentGraphic","graphics","_current","_graphics","forceOnScreen","copyGraphics","onPreDraw","onPostDraw","onPreTransformDraw","onPostTransformDraw","graphicOrOptions","getGraphic","getOptions","getNames","currentOptions","nameOrGraphic","optionsToSet","graphicToSet","remove","hide","_localBounds","offsetX","offsetY","GameEvent","_bubbles","bubbles","stopPropagation","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","PostDrawEvent","PreTransformDrawEvent","PostTransformDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","VisibleEvent","HiddenEvent","PreCollisionEvent","contact","PostCollisionEvent","ContactStartEvent","ContactEndEvent","lastContact","CollisionPreSolveEvent","CollisionPostSolveEvent","CollisionStartEvent","CollisionEndEvent","InitializeEvent","ActivateEvent","DeactivateEvent","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","entity","ExitTriggerEvent","ActionStartEvent","action","ActionCompleteEvent","AddEvent","RemoveEvent","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","EntityEvents","Add","Remove","Initialize","PreUpdate","PostUpdate","Kill","Entity","componentsOrOptions","componentsToAdd","nameToAdd","_tags","componentAdded$","componentRemoved$","tagAdded$","tagRemoved$","components","componentValues","_componentsToRemove","scene","isActive","_isInitialized","_isAdded","silence","silenceWarnings","addComponent","active","kill","unparent","isKilled","tags","hasTag","tag","addTag","removeTag","types","getComponents","values","hasAll","requiredTypes","hasAllTags","requiredTags","removeChild","addChild","getAncestors","removeAllChildren","getDescendants","queue","curr","newEntity","componentInstance","addTemplate","templateEntity","_getClassHierarchyRoot","componentType","getPrototypeOf","removeComponent","dependencies","ctor","rootComponent","typeOrInstance","componentToRemove","componentIndex","clearComponents","processComponentRemoval","isInitialized","isAdded","onInitialize","_add","_remove","_preupdate","onPreUpdate","_postupdate","onPostUpdate","MotionComponent","vel","acc","scaleFactor","angularVelocity","torque","inertia","EulerIntegrator","integrate","motion","totalAcc","seconds","_ACC","_VEL","_POS","_VEL_ACC","_SCALE_FACTOR","_SCALE","Particle","beginColor","endColor","life","fade","_rRate","_gRate","_bRate","_aRate","_currentColor","sizeRate","isOffscreen","particleTransform","ParticleTransform","Global","configure","registerEmitter","_emitter","startSize","endSize","drawPoint","removeParticle","accel","focus","focusAccel","DefaultConfig","ParticleRenderer","transformFeedbackVaryings","INTERLEAVED_ATTRIBS","_getTexture","particle","Local","ImageRendererV2","_components","_quadMesh","_meshBuffer","_transformData","totalSize","vertexAttribDivisor","_bindData","drawArraysInstanced","ExcaliburGraphicsContextWebGLDebug","_webglCtx","_debugText","rectOptions","lineOptions","pointOptions","drawText","_state","_ortho","checkIfResolutionSupported","dim","supported","_renderers","_lazyRenderersFactory","imageRenderer","_isDrawLifecycle","useDrawSorting","_drawCallPool","_drawCallIndex","_drawCalls","_postProcessTargets","_postprocessors","backgroundColor","multiSampleAntialiasing","_isContextLost","_disposed","_totalPostProcessorTime","canvasElement","enableTransparency","antialiasing","powerPreference","handleContextLost","handleContextRestored","premultipliedAlpha","alpha","depth","_init","clearColor","BLEND","blendEquation","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","blendEquationSeparate","blendFuncSeparate","depthMask","lazyRegister","_screenRenderer","_renderTarget","_msaaTarget","rendererName","maybeRenderer","lazyFactory","_isCurrentRenderer","_currentRenderer","beginDrawLifecycle","endDrawLifecycle","drawCall","updateViewport","trace","drawCircle","addPostProcessor","removePostProcessor","clearPostProcessors","updatePostProcessors","find","u","onUpdate","createMaterial","currentTarget","originalSort","firstIndex","sort","originalSortOrder","oldTransform","oldState","currentRendererName","currentRenderer","ExcaliburGraphicsContext2DCanvasDebug","__ctx","strokeRect","ExcaliburGraphicsContext2DCanvas","_resolution","globalAlpha","fillRect","_postprocessor","DisplayMode","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","ScreenEvents","ScreenResize","PixelRatioChange","FullScreenChange","Screen","_antialiasing","_canvasImageRendering","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullscreen","_isDisposed","_fullscreenChangeHandler","fullscreen","isFullScreen","_pixelRatioChangeHandler","_listenForPixelRatio","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","pixelRatio","_resizeHandler","_setResolutionAndViewportByDisplayMode","_contentArea","_unsafeArea","_contentResolution","_displayMode","displayMode","Fixed","_canvas","canvasImageRendering","_browser","browser","_applyDisplayMode","_mediaQueryList","removeListener","nativeComponent","matchMedia","addListener","_resizeObserver","disconnect","removeEventListener","worldToPagePixelRatio","pageOrigin","worldToPageCoordinates","pixelRatioOverride","isHiDpi","FillContainer","FitContainer","FitContainerAndFill","FitContainerAndZoom","parentElement","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","peekViewport","peekResolution","popResolutionAndViewport","currentPixelRatio","newResolutionSupported","imageRendering","widthUnit","heightUnit","documentElement","setProperty","isSmooth","isFullscreen","goFullScreen","elementId","enterFullscreen","maybeElement","getElementById","requestFullscreen","exitFullScreen","exitFullscreen","_viewportToPixels","offsetWidth","offsetHeight","pageToScreenCoordinates","innerWidth","innerHeight","screenHeight","screenWidth","contentArea","screenMarginY","screenMarginX","screenToWorldCoordinates","worldToScreenCoordinates","pageToWorldCoordinates","getWorldBounds","zoom","drawPos","getScreenBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","drawWidth","halfDrawWidth","drawHeight","halfDrawHeight","unsafeArea","_computeFit","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitScreenAndFill","vw","vh","_computeFitAndFill","_computeFitContainerAndFill","clip","_computeFitScreenAndZoom","_computeFitAndZoom","_computeFitContainerAndZoom","scaleX","scaleY","maxScaleFactor","zoomedWidth","zoomedHeight","_computeFitContainer","clientWidth","clientHeight","Window","ResizeObserver","observe","FillScreen","FitScreen","FitScreenAndFill","FitScreenAndZoom","AudioContextFactory","create","WebAudio","unlock","_UNLOCKED","unlockTimeoutTimer","resume","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","isUnlocked","Canvas","cache","ExResponse","any","json","arraybuffer","StateMachine","states","currentState","_currentState","machineDescription","machine","stateName","transitionState","transitions","startState","go","eventData","potentialNewState","onExit","onEnter","onState","saveKey","localStorage","setItem","parse","getItem","WebAudioInstance","_createNewBufferSource","_instance","_audioContext","loop","playbackRate","_playbackRate","_volumeNode","_handleEnd","_playingFuture","_loop","volume","_volume","_stateMachine","in","gain","setTargetAtTime","_duration","getTotalPlaybackDuration","createGain","PLAYING","pausedAt","startedAt","_playStarted","stop","SEEK","STOPPED","PAUSED","isPaused","isStopped","playStarted","seek","getPlaybackPosition","MediaEvent","_value","_path","_val","propagate","layPath","_actor","NativeSoundEvent","track","NativeSoundProcessedEvent","_processedData","canPlayFile","file","Audio","filetype","canPlayType","SoundEvents","VolumeChange","Processed","Pause","Stop","PlaybackEnd","Resume","PlaybackStart","Sound","_tracks","instances","paths","_isStopped","_wasPlayingOnHidden","audiobuffer","decodeAudio","wireEngine","_engine","pauseAudioWhenHidden","instanceCount","some","_resumePlayback","_startPlayback","trackId","_getTrackInstance","getTrackId","resumed","all","complete","newTrack","LoaderEvents","BeforeLoad","AfterLoad","UserAction","LoadResourceStart","LoadResourceEnd","isLoaderConstructor","DefaultLoader","resources","_resources","_numLoaded","_totalTimeMs","_loadingFuture","loadables","addResources","onUserAction","onBeforeLoad","onAfterLoad","addResource","loadable","markResourceComplete","progress","total","textbox","areResourcesLoaded","async","finally","resource","Loader","_image","_imageElement","_imageLoaded","logo","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","textContent","_playButtonStyles","head","startButtonFactory","loadablesOrOptions","_originalOptions","_playButtonShown","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","playButtonText","buttonElement","display","_DEFAULT_LOADER_OPTIONS","showPlayButton","resizeHandler","_positionPlayButton","evt","click","playButtonClicked","startButtonHandler","hidePlayButton","fullscreenAfterLoad","fullscreenContainer","HTMLElement","decode","buttonWidth","buttonHeight","playButtonPosition","logoY","logoX","logoPosition","oldAntialias","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","feature","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","CollisionType","SolverStrategy","ContactSolveBias","CollisionGroupManager","mask","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","existingGroup","group","CollisionGroup","_CURRENT_BIT","groupByName","_STARTING_BIT","category","_category","_mask","canCollide","overlap1","overlap2","collisionGroups","combinedName","combinedMask","collidesWith","padStart","All","Pair","colliderA","colliderB","calculatePairHash","bodyA","BodyComponent","bodyB","collisionType","PreventCollision","collide","hasCollider","collider","idA","idB","Projection","projection","getOverlap","TreeNode","isLeaf","DynamicTree","_config","worldBounds","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","grandParent","sibling","trackCollider","node","updateCollider","untrackCollider","boundsPadding","multdx","velocityMultiplier","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","Ray","numerator","begin","getSlope","divisor","getLength","intersectPoint","getPoint","DynamicTreeCollisionProcessor","_pairs","_collisionPairCache","_colliders","_dynamicCollisionTree","dynamicTree","getColliders","pointOrBounds","maxDistance","collisionGroup","collisionMask","searchAllColliders","maybeBody","ignoreCollisionGroupAll","hit","CompositeCollider","colliders","untrack","_pairExists","broadphase","targets","potentialColliders","j","pair","physics","pairs","continuous","checkForFastBodies","Active","updateDistance","minDimension","disableMinimumSpeedForFastBody","fastBodies","updateVec","oldPos","centerPoint","furthestPoint","getFurthestPoint","minCollider","surfaceEpsilon","minTranslate","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","Collider","composite","touching","VerticalFirst","vertical","horizontal","HorizontalFirst","SpatialPartitionStrategy","getDefaultPhysicsConfig","enabled","gravity","solver","Arcade","substep","compositeStrategy","bodies","canSleepByDefault","sleepEpsilon","wakeThreshold","sleepBias","defaultMass","spatialPartition","SparseHashGrid","sparseHashGrid","arcade","contactSolveBias","realistic","positionIterations","velocityIterations","slop","steeringFactor","warmStart","_compositeStrategy","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","axes","furthestPoints","bestPoint","getInertia","mass","totalInertia","otherColliders","potentialCollider","getClosestLineBetween","maybeLine","minLength","minLine","hits","minHit","minDistance","project","projections","proj","newProjection","LineSegment","slope","intercept","_normal","_dir","_slope","getEdge","midpoint","flip","below","sideVector","clipTime","distanceToPoint","signed","x0","y0","findVectorToPoint","aMinusP","findPoint","hasPoint","currPoint","threshold","arguments","dxc","dyc","dx1","dy1","ClosestLine","line1","line2","EPSILON","line1Dir","line2Dir","d1Squared","d2Squared","closestPoint","denom","closestPointOnLine1","closestPointOnLine2","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","aSides","getSides","bSides","closestLine","PolygonEdgeClosestLine","polygon","edge","otherDirection","rayTowardsOther","thisPoint","thisFace","getClosestFace","edgeLine","asLine","face","PolygonCircleClosestLine","otherWorldPos","p0","circlex","circley","CircleCircleClosestLine","circleA","circleB","thisDirection","rayTowardsThis","otherPoint","CircleEdgeClosestLine","circleWorldPos","EdgeEdgeClosestLine","edgeA","edgeB","CircleCollider","_globalMatrix","_radius","_naturalRadius","_localBoundsDirty","orig","u1","toi","discriminant","toi1","toi2","positiveToi","minToi","shape","PolygonCollider","EdgeCollider","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","scalars","dotProduct","CollisionContact","mtv","tangent","localPoints","_canceled","colliderAId","colliderBId","matchAwake","isSleeping","sleepMotion","isCanceled","cancel","bias","SeparationInfo","localAxis","localSide","localPoint","SeparatingAxis","findPolygonPolygonSeparation","polyA","polyB","findPolygonPolygonSeparationDegenerate","bestSeparation","bestSideIndex","toPolyBSpace","_SCRATCH_MATRIX","toPolyBSpaceRotation","normalsA","normals","pointsA","pointsB","pointsAIndex","_ZERO","_SCRATCH_NORMAL","_SCRATCH_POINT","smallestLocalPoint","smallestPointDistance","pointsBIndex","_SCRATCH_SUB_POINT","bestSide2","separationInfo","SeparationPool","separation","sideId","findCirclePolygonSeparation","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","bestSide","bestAxis","bestOtherPoint","sides","localSides","getLocalSides","vertB","vertSeparation","ScratchZero","ScratchNormal","ScratchMatrix","circleAPos","circleBPos","combinedRadius","mvt","local","sameDir","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","separationB","main","toIncidentFrame","toIncidentFrameRotation","referenceEdgeNormal","minEdge","incidentEdgeIndex","referenceSide","referenceDirection","clipRight","clipLeft","clipPoints","FindContactSeparation","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","registerGraphicsContext","debugDrawCall","drawLines","drawPolygon","firstPoint","drawBounds","boundingBox","drawRay","_localSidesDirty","_transformedPointsDirty","_sidesDirty","_normals","_checkAndUpdateWinding","_calculateNormals","_transformedPoints","_sides","_localSides","isConvex","suppressConvexWarning","_calculateTransformation","_isCounterClockwiseWinding","sum","oldPoint","newPoint","oldDirection","orientation","angleSum","tessellate","polygons","Shape","Polygon","triangulate","triangles","vertices","vertexCount","getPrevIndex","getNextIndex","prev","va","vb","vc","leftArm","rightArm","convexVertices","isPointInTriangle","ab","bc","ca","ap","bp","cp","cross1","cross2","cross3","findEarTip","isEar","cutEarTip","getTransformedPoints","currentSide","mostDirection","testRay","intersectCount","sideIndex","pts","POSITIVE_INFINITY","faceIndex","_cachedMass","_cachedInertia","denominator","iplusone","crossTerm","contactSide","minContactTime","contactIndex","contactTime","scalar","Box","Circle","Edge","Capsule","ColliderComponent","$colliderAdded","$colliderRemoved","_collidersToRemove","_collider","processColliderRemoval","flipped","precollision","Actor","onPreCollisionResolve","postcollision","onPostCollisionResolve","onCollisionStart","onCollisionEnd","useBoxCollider","usePolygonCollider","poly","useCircleCollider","useEdgeCollider","useCompositeCollider","DegreeOfFreedom","__oldTransformCaptured","enableFixedUpdateInterpolate","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","_oldGlobalPos","oldVel","oldAcc","_impulseScratch","_distanceFromCenterScratch","_bodyConfig","config","updatePhysicsConfig","_mass","_DEFAULT_CONFIG","canSleep","updateDefaultPhysicsConfig","newMass","_cachedInverseInertia","inverseMass","sleeping","setSleeping","updateMotion","currentMotion","maybeCollider","inverseInertia","oldGlobalPos","oldRotation","oldScale","applyImpulse","impulse","finalImpulse","X","Y","Rotation","distanceFromCenter","applyLinearImpulse","applyAngularImpulse","captureOldTransform","Rectangle","PointerComponent","useColliderShape","useGraphicsBounds","EasingFunctions","CreateReversibleEasingFunction","easing","CreateVectorEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","ActionQueue","_actions","_currentAction","_completedActions","_entity","clearActions","getActions","getIncompleteActions","getCurrentAction","hasNext","isComplete","_ACTION_ID","nextActionId","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","RepeatForever","lerp","lerpAngle","startAngle","endAngle","shortestPathIsPositive","distance1","distance2","shortDistance","longDistance","lerpVector","inverseLerp","inverseLerpVector","remap","minSource","maxSource","minDestination","maxDestination","remapVector","isMoveByOptions","MoveByWithOptions","_started","_easing","_tx","_motion","_durationMs","_currentMs","_start","_end","currentPos","newPosX","newPosY","velX","velY","MoveBy","_distance","isMoveToOptions","MoveToWithOptions","MoveTo","destX","destY","isRotateToOptions","RotateToWithOptions","_endAngle","_startAngle","_rotationType","rx","RotateTo","_currentNonCannonAngle","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","distanceTraveled","isRotateByOptions","angleRadiansOffset","RotateByWithOptions","RotateBy","isScaleToOptions","ScaleToWithOptions","_endScale","_startScale","newScale","ScaleTo","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","isScaleByOptions","scaleOffset","ScaleByWithOptions","_scaleOffset","ScaleBy","scaleOffsetX","scaleOffsetY","_directionX","_directionY","CallMethod","method","_hasBeenCalled","_method","EaseTo","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","EaseBy","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","Fade","endOpacity","_multiplier","_endOpacity","_remainingTime","_originalTime","Delay","_delay","Die","ActionsComponent","Follow","entityToFollow","followDistance","_followTx","_followMotion","_maximumDistance","_distanceBetween","actorToFollowSpeed","Meet","actor","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","actorToMeetSpeed","Flash","_total","_currentDuration","_material","BezierCurve","_distLookup","controlPoints","_controlPoints","_calculateLookup","arcLength","_arcLength","setControlPoint","totalLength","pt","_getTimeGivenDistance","getTangent","timeSquared","p1","p2","p3","getUniformTangent","desiredDistance","uniformTime","getNormal","getUniformNormal","getUniformPoint","CurveTo","_mode","_curve","mode","CurveBy","_queue","runAction","curveBy","curveTo","easeTo","easeBy","xOrPosOrOptions","yOrSpeed","speedOrUndefined","moveBy","xOffsetOrVectorOrOptions","yOffsetOrSpeed","xOffset","yOffset","rotateTo","angleRadiansOrOptions","rotateBy","angleRadiansOffsetOrOptions","scaleTo","sizeXOrVectorOrOptions","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","scaleBy","sizeOffsetXOrVectorOrOptions","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","blink","flash","die","callMethod","times","repeatForever","follow","meet","toPromise","_getCtx","xOffsetOrVectorOptions","isActor","ActorEvents","CollisionStart","CollisionEnd","PreCollision","PostCollision","PreKill","PostKill","PreDraw","PostDraw","PreTransformDraw","PostTransformDraw","PreDebugDraw","PostDebugDraw","PointerUp","PointerDown","PointerEnter","PointerLeave","PointerMove","PointerCancel","Wheel","PointerDrag","PointerDragEnd","PointerDragEnter","PointerDragLeave","PointerDragMove","EnterViewPort","ExitViewPort","ActionStart","ActionComplete","thePos","theVel","theAcc","theAngle","_handleAnchorChange","_handleOffsetChange","isOffScreen","draggable","_draggable","isDraggable","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","_pointerDragLeaveHandler","_dragging","pe","defaults","_silenceWarnings","pointer","actions","Passive","builtInComponents","_prekill","onPreKill","_postkill","onPostKill","unkill","newZ","getGlobalPos","localCenter","getGlobalScale","getGlobalRotation","recurse","geom","containment","within","otherCollider","me","isScreenElement","ScreenElement","useWorld","coords","Timer","_complete","_totalTimeAlive","_running","_numberOfTicks","interval","repeats","maxNumberOfRepeats","randomRange","_baseInterval","_generateRandomInterval","fcn","numberOfRepeats","_MAX_ID","_callbacks","newInterval","newNumberOfRepeats","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","cancelTimer","ParallaxComponent","parallaxFactor","DebugGraphicsComponent","useTransform","hasNestedEvents","_dispatchPointerEvents","_processPointerToObject","PointerTargetObjectProxy","init","PointerEventsToObjectDispatcher","_proxyPool","_objectToProxy","_proxies","_lastFrameObjectToPointers","_currentFrameObjectToPointers","addObject","proxy","_getProxy","removeObject","_objectCurrentlyUnderPointer","pointerId","_objectWasUnderPointer","_entered","addPointerToObject","maybeProxy","_addPointerToProxy","pointers","dispatchEvents","receiver","sortedObjects","lastFrameEntities","currentFrameEntities","lastMovePerPointer","lastUpPerPointer","lastDownPerPointer","_processDownAndEmit","_processUpAndEmit","_processMoveAndEmit","lastUpDownMoveEvents","_processEnterLeaveAndEmit","_processCancelAndEmit","_processWheelAndEmit","processPointerToObject","objectIndex","currentFramePointerCoords","currentFrameDown","isDragStart","currentFrameUp","isDragEnd","currentFrameMove","isDragging","currentFrameCancel","currentFrameWheel","TileMapEvents","TileMap","flagCollidersDirty","_collidersDirty","flagTilesDirty","tiles","tileWidth","tileHeight","_token","_rows","_cols","renderFromTopOfGraphic","meshingLookBehind","_oldRotation","_originalOffsets","WeakMap","debugFlags","_composite","_oldPos","_oldScale","_pointerEventDispatcher","currentCol","tile","Tile","_getOrSetColliderOriginalOffset","originalOffset","_updateColliders","shareEdges","checkAndCombine","maxLookBack","solid","defaultGeometry","getTileByIndex","getTile","getTileByPoint","_getTileCoordinates","getRows","getColumns","getOnScreenTiles","maybeParallax","oneMinusFactor","parallaxOffset","currentScene","tileStartX","tileStartY","tileEndX","tileEndY","graphicsIndex","graphicsLen","offsets","getGraphicsOffsets","getGraphics","gfx","showAll","showGrid","gridColor","gridWidth","showSolidBounds","showColliderBounds","solidBoundsColor","colliderBoundsColor","showColliderGeometry","tilemap","geometryColor","geometryLineWidth","geometryPointSize","pointSize","_posDirty","_recalculate","_solid","_offsets","addGraphic","removeGraphic","clearGraphics","geometryPos","_geometry","_bounds","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","limitCameraBounds","box","LimitCameraBoundsStrategy","Axis","cam","_eng","currentFocus","getFocus","cameraVel","stretch","boundSizeChecked","focusX","focusY","CameraEvents","Camera","_cameraStrategies","dz","az","_angularVelocity","_posChanged","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_halfWidth","_halfHeight","_snapPos","hasChanged","_follow","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","cameraStrategy","removeStrategy","clearAllStrategies","_screen","currentRes","loadingComplete","res","updateTransform","runStrategies","newZoom","zoomEasing","lerpPoint","moveEasing","_isDoneShaking","fixedUpdateTimestep","blend","currentFrameLagMs","interpolatedPos","snapPos","newCanvasWidth","newCanvasHeight","cameraPos","TriggerEvents","ExitTrigger","EnterTrigger","Trigger","_matchesTarget","_dispatchAction","SystemPriority","Highest","Higher","Average","Lower","Lowest","SystemType","System","EntityManager","_world","entities","_entityIndex","_childAddedHandlerMap","_childRemovedHandlerMap","_createChildAddedHandler","addEntity","_createChildRemovedHandler","removeEntity","_entitiesToRemove","updateEntities","entityIndex","findEntitiesForRemoval","queryManager","childAdded","childRemoved","idOrEntity","childAddedHandler","childRemovedHandler","currFrame","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","Query","requiredComponents","entityAdded$","entityRemoved$","checkAndAdd","getEntities","TagQuery","QueryManager","_queries","_addComponentHandlers","_removeComponentHandlers","_componentToQueriesIndex","_tagQueries","_addTagHandlers","_removeTagHandlers","_tagToQueriesIndex","_createAddComponentHandler","_createRemoveComponentHandler","_createAddTagHandler","_createRemoveTagHandler","createQuery","queries","createTagQuery","maybeAddComponent","maybeRemoveComponent","maybeAddTag","maybeRemoveTag","tagQuery","isSystemConstructor","SystemManager","systems","initialized","systemType","addSystem","systemOrCtor","system","removeSystem","updateSystems","preupdate","postupdate","entityManager","systemManager","queryTags","Update","entityOrSystem","clearEntities","clearSystems","MotionSystem","world","_physicsConfigDirty","$configUpdate","optionalBody","captureOldTransformWithChildren","ArcadeSolver","directionMap","distanceMap","solve","preSolve","aDir","bDir","aDist","bDist","solvePosition","solveVelocity","postSolve","opposite","velAdj","ContactConstraintPoint","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","originalVelocityAndRestitution","aToContactNormal","bToContactNormal","aToContactTangent","bToContactTangent","getRelativeVelocity","velA","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contactPoints","pointIndex","restitution","relativeVelocity","constraints","maxCorrection","steeringForce","impulseForce","impulseDelta","maxFriction","newImpulse","normalVelocity","CollisionSystem","_processor","_physics","collisionProcessor","_configDirty","_lastFrameContacts","_currentFrameContacts","_arcadeSolver","_realisticSolver","_trackCollider","_untrackCollider","colliderComponent","_motionSystem","colliderComp","compositeColliders","getSolver","step","compositeId","substring","runContactStartEnd","Realistic","blendTransform","oldTx","newTx","oldTxWithNewParent","oldGlobalScale","oldGlobalRotation","interpolatedScale","interpolatedRotation","GraphicsSystem","sortedTransforms","_sortedTransforms","Draw","_zHasChanged","_zIndexUpdate","_targetInterpolationTransform","transformIndex","parallax","_applyTransform","_applyOpacity","_drawGraphicsComponent","graphicsComponent","transformComponent","oldFlipHorizontal","oldFlipVertical","isDebug","showBounds","boundsColor","ancestors","ancestor","maybeGraphics","DebugSystem","_collisionSystem","filterSettings","entitySettings","txSettings","motionSettings","colliderSettings","physicsSettings","graphicsSettings","debugDraw","bodySettings","cameraSettings","useFilter","ids","nameQuery","cursor","_pushCameraTransform","debugZIndex","showPosition","positionColor","showPositionLabel","showZIndex","showId","showName","showRotation","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","showOwner","_popCameraTransform","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","contactSize","collisionContactColor","collisionNormalColor","showFocus","focusColor","showZoom","HashGridProxy","gridSize","cells","hasZeroBounds","leftX","rightX","bottomY","topY","cell","proxies","updateBounds","HashGridCell","calculateHashKey","_hashGridCellPool","instance","objectToProxy","proxyFactory","_buildProxy","boundsOrPoint","xCoord","yCoord","proxyIndex","cellIndex","transparent","PointerSystem","_graphicsHashGrid","_entityToPointer","overrideUseColliderShape","overrideUseGraphicsBounds","_sortedEntities","screenPos","maybeGfx","_scene","_receivers","input","_engineReceiver","maybePointer","ActionsSystem","IsometricEntityComponent","mapOrOptions","elevation","IsometricEntitySystem","iso","OffscreenSystem","_worldBounds","entityOffscreen","_isOffscreen","transformedBounds","HashColliderProxy","SparseHashGridCollisionProcessor","_nonPairs","_pairPool","hashGrid","unitRay","dydx","dxdy","unitStepX","unitStepY","startXCoord","startYCoord","stepDir","currentXCoord","currentYCoord","currentRayLengthX","currentRayLengthY","collidersVisited","maxIterations","cellHits","colliderIndex","hit1","hit2","compColliders","_canCollide","proxyId","otherIndex","PhysicsWorld","newConfig","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_enabled","_clonePads","toggleEnabled","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","at","timestamp","bi","ai","navigatorGamepad","Buttons","getButton","pressed","updateButton","Axes","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_axes","_buttons","_buttonsUp","_buttonsDown","isButtonPressed","isButtonHeld","wasButtonPressed","wasButtonReleased","Boolean","buttonIndex","axesIndex","Keys","InputMapper","inputs","_handlers","command","inputHandler","commandHandler","isCrossOriginIframe","noop","KeyEvent","originalEvent","Keyboard","_keys","_keysUp","_keysDown","_releaseAllKeys","ev","code","keyEvent","_handleKeyDown","metaKey","MetaLeft","MetaRight","_handleKeyUp","keyboardOptions","global","grabWindowFocus","getKeys","wasPressed","isHeld","wasReleased","triggerEvent","character","KeyboardEvent","GlobalCoordinates","fromPagePosition","xOrPos","yOrEngine","engineOrUndefined","pageX","pageY","PointerEvent","coordinates","pointerType","nativeEvent","WheelEvent","screenX","screenY","deltaZ","deltaMode","PointerAbstraction","lastPagePos","lastScreenPos","lastWorldPos","_onPointerMove","_onPointerDown","_updateWorldPosition","WheelDeltaMode","NativePointerButton","PointerButton","PointerType","PointerEventReceiver","primary","_activeNativePointerIdsToNormalized","lastFramePointerCoords","currentFramePointerDown","lastFramePointerDown","_pointers","_boundHandle","_handle","_boundWheel","_handleWheel","recreate","eventReceiver","isDown","wasDown","native","isDisposed","touchAction","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode","onmousewheel","grabFocus","detach","_normalizePointerId","nativePointerId","findIndex","preventDefault","eventCoords","globalThis","TouchEvent","Unknown","Touch","changedTouches","_nativeButtonToPointerButton","Mouse","isPointerEvent","_stringToPointerType","ScrollWheelNormalizationFactor","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Line","Page","we","page","clientX","clientY","MouseEvent","pointerSystem","NoButton","Middle","Pen","InputHost","pointerTarget","keyboard","inputMapper","PreLoadEvent","SceneEvents","Activate","Deactivate","PreLoad","isSceneConstructor","Scene","triggers","tileMaps","timers","_timers","_cancelQueue","onPreLoad","loader","onTransition","onActivate","onDeactivate","_initializeChildren","pointerScope","director","getSceneName","_activate","_deactivate","_predraw","_postdraw","removeTimer","timer","_collectActorStats","addTimer","transfer","isTimerActive","isCurrentScene","ui","alive","ColorBlindnessMode","ScreenShader","ColorBlindnessPostProcessor","_colorBlindnessMode","simulate","_simulate","colorBlindnessMode","colorBlindMode","Protanope","Deuteranope","Tritanope","ColorBlindFlags","_colorBlindPostProcessor","correct","colorBlindness","DebugConfig","FrameStats","prevFrame","isometric","positionSize","useTestClock","wasRunning","testClock","toTestClock","useStandardClock","currentClock","standardClock","toStandardClock","_id","_elapsedMs","_fps","_actorStats","remaining","_durationStats","_physicsStats","PhysicsStats","_graphicsStats","drawCalls","drawnImages","otherStats","elapsedMs","fps","fs","_collisions","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","ps","BrowserComponent","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","DefaultAntialiasOptions","nativeContextAntialiasing","DefaultPixelArtOptions","FpsSampler","_samplePeriod","_currentFrameTime","_frames","_previousSampleTime","_beginFrameTime","initialFps","samplePeriod","_nowFn","nowFn","instant","Clock","_onFatalException","_maxFps","_lastTime","_elapsed","_scheduledCbs","_totalElapsed","maxFps","onFatalException","fpsSampler","TestClock","defaultUpdateMs","StandardClock","setFatalExceptionHandler","timeoutMs","timing","scheduledTime","__runScheduledCbs","overrideUpdateMs","fpsInterval","leftover","mainloop","_requestId","_currentTime","_updateMs","run","numberOfSteps","Toaster","_toasterCss","_container","_createFragment","toastMessage","innerText","toast","linkTarget","linkName","className","messageFragments","link","href","finalMessage","dismissBtn","keydownHandler","first","firstChild","insertBefore","DirectorEvents","NavigationStart","Navigation","NavigationEnd","Director","isTransitioning","_isTransitioning","scenes","_sceneToInstance","_sceneToLoader","_sceneToTransition","_loadedScenes","rootScene","currentSceneName","sceneKey","sceneOrOptions","getSceneInstance","_deferredGoto","deferredScene","deferredTransition","_deferredTransition","deferredSceneInstance","_addToTargetScene","swapScene","playTransition","configureStart","startScene","maybeLoaderOrCtor","maybeStartTransition","mainLoader","inTransition","startSceneInstance","_getLoader","sceneName","_getInTransition","sceneOrRoute","_getOutTransition","out","getDeferredScene","maybeDeferred","getSceneDefinition","maybeScene","assertAdded","assertRemoved","outTransition","nameOrScene","sceneOrCtor","potentialSceneOrOptions","goToScene","destinationScene","maybeDest","sourceSceneInstance","sourceScene","engineInputEnabled","maybeSourceOut","maybeDestinationIn","sourceOut","destinationIn","sceneActivationData","hideLoader","maybeLoadScene","_emitEvent","onPreviousSceneDeactivate","sceneDefinition","newScene","sceneToLoad","sceneToLoadInstance","transition","targetScene","currentTransition","sceneInputEnabled","blockInput","_play","previousScene","nextScene","destLoader","sourceName","destinationName","createContext","scope","old","useContext","DefaultGarbageCollectionOptions","textureCollectInterval","GarbageCollector","_collectionMap","_collectors","collectStaleResources","deadline","collector","timeoutInterval","getTimestamp","resourceType","_collectHandle","collect","collectionData","forceCollectAll","EngineEvents","FallbackGraphicsContext","Visible","Hidden","Start","PreFrame","PostFrame","EmitterType","Engine","useEngine","Context","_isDebug","shouldSnapToPixel","version","EX_VERSION","_inputEnabled","_suppressPlayButton","enableCanvasTransparency","stack","_toaster","_timescale","_handleWebGLContextLost","container","flexDirection","borderStyle","div","innerHTML","querySelector","reload","_performanceThresholdTriggered","_fpsSamples","_isLoading","_hideLoader","_isReadyFuture","currentFrameElapsedMs","_lagMs","_screenShotRequests","_DEFAULT_ENGINE_OPTIONS","detector","suppressMinimumBrowserFeatureDetection","_compatible","testMessage","canvasElementId","suppressConsoleBootMessage","garbageCollection","garbageCollectorConfig","enableCanvasContextMenu","_originalDisplayMode","pixelArt","suppressHiDPIScaling","fixedUpdateFps","_mainloop","___EXCALIBUR_DEVTOOL","InstanceCount","_monitorPerformanceThresholdAndTriggerFallback","allow","configurePerformanceCanvas2DFallback","showPlayerMessage","numberOfFrames","useCanvas2DFallback","newCanvas","cloneNode","parentNode","replaceChild","Document","timescale","addScene","removeScene","scrollPreventionMode","visibilityState","toggleInputEnabled","_overrideInitialize","_update","_loader","_draw","_checkForScreenShots","toggle","toggleDebug","isReady","sceneNameOrLoader","frameId","beforeUpdate","fixedTimestepMs","afterUpdate","afterDraw","screenshot","preserveHiDPIResolution","finalWidth","finalHeight","raw","Label","newFont","spriteFont","sf","getTextWidth","ParticleEmitter","_particlesToEmit","_particlePool","numParticles","isEmitting","deadParticles","emitRate","emitterType","randomRotation","_activeParticles","emitParticles","particleCount","_createParticle","clearParticles","ranX","ranY","minAngle","maxAngle","minSpeed","maxSpeed","minSize","maxSize","assert","expression","GpuParticleRenderer","_vaos","_buffers","_drawIndex","_numInputFloats","_particleIndex","_uploadIndex","_wrappedLife","_wrappedParticles","_particleLife","_clearRequested","_emitted","_particleData","maxParticles","_random","numInputFloats","particleData","particleDataBuffer1","vao1","bytesPerFloat","particleDataBuffer2","vao2","_currentVao","_currentBuffer","startIndex","endIndex","_uploadEmitted","bindBufferBase","TRANSFORM_FEEDBACK_BUFFER","bindBufferRange","beginTransformFeedback","endTransformFeedback","GPU_MAX_PARTICLES","GpuParticleEmitter","IsometricTile","_gfx","_recalculateBounds","_tileBounds","graphicsOffset","tileToWorld","_isometricEntityComponent","halfTileWidth","halfTileHeight","yPos","totalWidth","totalHeight","IsometricMap","updateColliders","worldToTile","worldCoordinate","tileCoordinate","tileCoord","_getMaxZIndex","maxZ","NEGATIVE_INFINITY","currentZ","ActionSequence","actionBuilder","_sequenceBuilder","_sequenceContext","ParallelActions","parallelActions","every","QuadTree","_defaultOptions","maxDepth","capacity","items","_isDivided","halfWidth","halfHeight","_split","newLevelOptions","_insertIntoSubNodes","insert","getAllItems","getTreeDepth","has_initialize","has_add","has_remove","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasOnAdd","hasOnRemove","hasPreDraw","hasPostDraw","Gif","_sprites","_stream","Stream","_gif","GifParser","toSpriteSheet","toAnimation","delayMs","_animation","readCheckBytes","checkBytes","bitsToNum","ba","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","fromCharCode","readUnsigned","Uint8Array","stream","_handler","globalColorTableBytes","parseColorTableBytes","colorTable","rgb","_st","readSubBlocks","parseHeader","hdr","sig","ver","colorResolution","globalColorTableSize","gctFlag","sortedFlag","globalColorTable","backgroundColorIndex","pixelAspectRatio","_currentFrameCanvas","bits","parseExt","block","parseGCExt","reserved","disposalMethod","userInputFlag","transparentColorFlag","delayTime","transparentColorIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","_gce","parseImg","img","leftPos","topPos","lctFlag","interlaced","sorted","lctSize","lctBytes","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","charCodeAt","output","clearCode","eoiCode","codeSize","dict","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","steps","pass","deinterlace","arrayToImage","parseBlocks","sentinel","eof","frame","imageData","getImageData","pixel","colorIndex","putImageData","_currentFrameContext","_hdr","bg","FontSource","_isLoaded","FontFace","fonts","toFont","InsideCoroutineContext","generatorFunctionDeclaration","isCoroutineGenerator","Function","coroutine","coroutineGenerator","thisArg","passedEngine","inside","autostart","started","completed","cancelled","generatorFcn","generator","co","iterator","Transition","_currentProgress","_completeFuture","_currentDistance","updateTransition","onStart","onEnd","onReset","_co","_execute","FadeInOut","screenCover","CrossFade","_progress","Slide","slideDirection","easingFunction","_vectorEasing","_screenCover","_directionOffset","_destinationCameraPosition","_startCameraPosition","_calculateBounds","lineNormal","halfThickness","minPoint","NineSliceStretch","NineSlice","_imgSource","_canvasA","_canvasB","_canvasC","_canvasD","_canvasE","_canvasF","_canvasG","_canvasH","_canvasI","setTargetWidth","auto","setTargetHeight","setMargins","sourceConfig","leftMargin","topMargin","rightMargin","bottomMargin","setStretch","destinationConfig","horizontalStretch","verticalStretch","getConfig","_drawTile","targetCanvas","destinationSize","marginWidth","marginHeight","tempMarginW","tempMarginH","tempSizeX","tempPositionX","tempSizeY","tempPositionY","numTilesX","_getNumberOfTiles","numTilesY","tempSize","tempPosition","_calculateParams","drawCenter","_sourceSprite","aCtx","bCtx","cCtx","dCtx","eCtx","fCtx","gCtx","hCtx","iCtx","tileSize","Stretch","TileFit","tileNum","numTiles","reducedTileSize","TiledAnimation","animation","_tiledWidth","_tiledHeight","_sourceView","promises","tiledSprite","fromAnimation","_updateSourceView","_updateWidthHeight","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","showStackTrace","obsolete","alternateMethod","property","descriptor","SyntaxError","DecoratedClass","AsyncWaitQueue","enqueue","dequeue","Semaphore","_count","_waitQueue","waiting","enter","exit","require","__WEBPACK_EXTERNAL_MODULE__185__","__WEBPACK_EXTERNAL_MODULE__418__","pako","zlib_deflate","utils","strings","ZStream","Z_OK","Z_DEFAULT_COMPRESSION","Z_DEFAULT_STRATEGY","Z_DEFLATED","Deflate","chunkSize","windowBits","memLevel","opt","gzip","err","chunks","strm","avail_out","deflateInit2","header","deflateSetHeader","dictionary","string2buf","deflateSetDictionary","_dict_set","deflate","deflator","next_in","avail_in","Buf8","next_out","onData","buf2binstring","shrinkBuf","deflateEnd","chunk","flattenChunks","deflateRaw","zlib_inflate","GZheader","Inflate","inflateInit2","inflateGetHeader","inflateSetDictionary","inflate","inflator","next_out_utf8","tail","utf8str","allowBufError","Z_FINISH","Z_NO_FLUSH","binstring2buf","Z_NEED_DICT","Z_BUF_ERROR","Z_STREAM_END","Z_SYNC_FLUSH","utf8border","buf2string","arraySet","inflateEnd","inflateRaw","ungzip","TYPED_OK","Int32Array","_has","TypeError","buf","subarray","fnTyped","src_offs","dest_offs","fnUntyped","setTyped","Buf16","Buf32","STR_APPLY_OK","STR_APPLY_UIA_OK","__","_utf8len","str","c2","m_pos","str_len","buf_len","c_len","utf16buf","adler","s1","s2","Z_PARTIAL_FLUSH","Z_FULL_FLUSH","Z_BLOCK","Z_TREES","Z_ERRNO","Z_STREAM_ERROR","Z_DATA_ERROR","Z_NO_COMPRESSION","Z_BEST_SPEED","Z_BEST_COMPRESSION","Z_FILTERED","Z_HUFFMAN_ONLY","Z_RLE","Z_FIXED","Z_BINARY","Z_TEXT","Z_UNKNOWN","crcTable","table","makeTable","crc","configuration_table","trees","adler32","crc32","MAX_MEM_LEVEL","L_CODES","LITERALS","D_CODES","BL_CODES","HEAP_SIZE","MAX_BITS","MIN_MATCH","MAX_MATCH","MIN_LOOKAHEAD","INIT_STATE","HCRC_STATE","BUSY_STATE","FINISH_STATE","BS_NEED_MORE","BS_BLOCK_DONE","BS_FINISH_STARTED","BS_FINISH_DONE","errorCode","rank","zero","flush_pending","pending","pending_buf","pending_out","total_out","flush_block_only","_tr_flush_block","block_start","strstart","put_byte","putShortMSB","longest_match","cur_match","chain_length","max_chain_length","scan","best_len","prev_length","nice_match","limit","w_size","_win","wmask","w_mask","strend","scan_end1","scan_end","good_match","lookahead","match_start","fill_window","more","_w_size","window_size","hash_size","wrap","total_in","ins_h","hash_shift","hash_mask","deflate_fast","hash_head","bflush","match_length","_tr_tally","max_lazy_match","last_lit","deflate_slow","max_insert","prev_match","match_available","Config","good_length","max_lazy","nice_length","max_chain","DeflateState","pending_buf_size","gzhead","gzindex","last_flush","w_bits","hash_bits","dyn_ltree","dyn_dtree","bl_tree","l_desc","d_desc","bl_desc","bl_count","heap","heap_len","heap_max","l_buf","lit_bufsize","d_buf","opt_len","static_len","bi_buf","bi_valid","deflateResetKeep","data_type","_tr_init","deflateReset","ret","max_block_size","max_start","deflateInit","old_flush","beg","hcrc","extra","os","bstate","deflate_huff","deflate_rle","_tr_align","_tr_stored_block","avail","tmpDict","dictLength","deflateInfo","xflags","extra_len","_in","_out","dmax","wsize","whave","wnext","s_window","hold","lcode","dcode","lmask","dmask","here","op","from_source","lencode","distcode","lenbits","distbits","dolen","dodist","sane","inflate_fast","inflate_table","LENS","DISTS","HEAD","TYPE","BAD","ENOUGH_LENS","ENOUGH_DISTS","zswap32","InflateState","havedict","flags","check","wbits","ncode","nlen","ndist","have","lens","work","lendyn","distdyn","back","was","inflateResetKeep","inflateReset","inflateReset2","lenfix","distfix","virgin","fixedtables","sym","updatewindow","copy","inflateInit","put","here_bits","here_op","here_val","last_bits","last_op","last_val","opts","hbuf","order","inf_leave","inflateInfo","MAXBITS","lbase","lext","dbase","dext","lens_index","codes","table_index","incr","low","drop","used","huff","base","base_index","offs","extra_index","STORED_BLOCK","LENGTH_CODES","Buf_size","MAX_BL_BITS","END_BLOCK","REP_3_6","REPZ_3_10","REPZ_11_138","extra_lbits","extra_dbits","extra_blbits","bl_order","static_ltree","static_dtree","_dist_code","_length_code","base_length","static_l_desc","static_d_desc","static_bl_desc","base_dist","StaticTreeDesc","static_tree","extra_bits","extra_base","elems","max_length","has_stree","TreeDesc","dyn_tree","stat_desc","max_code","d_code","put_short","w","send_bits","send_code","tree","bi_reverse","gen_codes","next_code","init_block","bi_windup","smaller","_n2","_m2","pqdownheap","compress_block","ltree","dtree","lc","lx","build_tree","desc","stree","xbits","gen_bitlen","scan_tree","curlen","prevlen","nextlen","max_count","min_count","send_tree","static_init_done","stored_len","copy_block","tr_static_init","opt_lenb","static_lenb","max_blindex","black_mask","detect_data_type","build_bl_tree","lcodes","dcodes","blcodes","send_all_trees","STATIC_TREES","bi_flush","util","objectUtil","assertEqual","assertIs","_arg","assertNever","arrayToEnum","getValidEnumValues","validKeys","objectKeys","filtered","objectValues","checker","isInteger","isFinite","joinValues","separator","jsonStringifyReplacer","mergeShapes","second","ZodParsedType","getParsedType","nan","number","boolean","function","bigint","symbol","null","catch","date","ZodIssueCode","ZodError","errors","issues","addIssue","addIssues","subs","actualProto","setPrototypeOf","__proto__","_mapper","mapper","issue","fieldErrors","_errors","processError","unionErrors","returnTypeError","argumentsError","isEmpty","flatten","formErrors","errorMap","invalid_type","received","expected","invalid_literal","unrecognized_keys","invalid_union","invalid_union_discriminator","invalid_enum_value","invalid_arguments","invalid_return_type","invalid_date","invalid_string","validation","startsWith","too_small","exact","inclusive","minimum","too_big","maximum","custom","invalid_intersection_types","not_multiple_of","multipleOf","not_finite","defaultError","overrideErrorMap","getErrorMap","makeIssue","params","errorMaps","issueData","fullPath","fullIssue","errorMessage","maps","addIssueToContext","overrideMap","common","contextualErrorMap","schemaErrorMap","ParseStatus","abort","mergeArray","arrayValue","INVALID","mergeObjectAsync","syncPairs","mergeObjectSync","finalObject","alwaysSet","DIRTY","OK","isAborted","isDirty","isAsync","__classPrivateFieldGet","kind","__classPrivateFieldSet","errorUtil","_ZodEnum_cache","_ZodNativeEnum_cache","SuppressedError","errToObj","ParseInputLazyPath","_cachedPath","_key","handleResult","success","_error","processCreateParams","invalid_type_error","required_error","description","iss","ZodType","_def","_getType","_getOrReturnCtx","parsedType","_processInputParams","_parseSync","_parse","_parseAsync","safeParse","toLowerCase","parseAsync","safeParseAsync","maybeAsyncResult","refine","getIssueProperties","_refinement","setError","refinement","refinementData","ZodEffects","schema","ZodFirstPartyTypeKind","effect","superRefine","def","spa","optional","nullable","nullish","or","and","brand","default","describe","readonly","isNullable","isOptional","vendor","validate","ZodOptional","ZodNullable","ZodArray","ZodPromise","option","ZodUnion","incoming","ZodIntersection","defaultValueFunc","ZodDefault","innerType","defaultValue","ZodBranded","catchValueFunc","ZodCatch","catchValue","This","ZodPipeline","ZodReadonly","cuidRegex","cuid2Regex","ulidRegex","uuidRegex","nanoidRegex","jwtRegex","durationRegex","emailRegex","emojiRegex","ipv4Regex","ipv4CidrRegex","ipv6Regex","ipv6CidrRegex","base64Regex","base64urlRegex","dateRegexSource","dateRegex","timeRegexSource","regex","precision","datetimeRegex","isValidJWT","jwt","alg","padEnd","decoded","atob","typ","isValidCidr","ip","ZodString","coerce","checks","tooBig","tooSmall","lastIndex","trim","toUpperCase","_regex","_addCheck","email","emoji","uuid","nanoid","cuid","cuid2","ulid","base64url","cidr","datetime","maxLength","nonempty","isDatetime","ch","isDate","isTime","isDuration","isEmail","isURL","isEmoji","isUUID","isNANOID","isCUID","isCUID2","isULID","isIP","isCIDR","isBase64","isBase64url","floatSafeRemainder","valDecCount","stepDecCount","decCount","ZodNumber","gte","lte","setLimit","gt","lt","int","positive","negative","nonpositive","nonnegative","finite","safe","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","minValue","maxValue","isInt","ZodBigInt","BigInt","_getInvalidInput","ZodBoolean","ZodDate","getTime","minDate","maxDate","ZodSymbol","ZodUndefined","ZodNull","ZodAny","_any","ZodUnknown","_unknown","ZodNever","never","ZodVoid","void","exactLength","element","deepPartialify","ZodObject","newShape","fieldSchema","unwrap","ZodTuple","_cached","nonstrict","passthrough","augment","extend","_getCached","shapeKeys","extraKeys","catchall","unknownKeys","keyValidator","strict","_d","strip","augmentation","merge","merging","setKey","pick","deepPartial","partial","required","newField","keyof","createZodEnum","strictCreate","lazycreate","childCtx","getDiscriminator","ZodLazy","ZodLiteral","ZodEnum","ZodNativeEnum","enum","ZodDiscriminatedUnion","discriminator","discriminatorValue","optionsMap","discriminatorValues","mergeValues","aType","bType","valid","bKeys","sharedKeys","sharedValue","newArray","handleParsed","parsedLeft","parsedRight","merged","rest","itemIndex","schemas","ZodRecord","keySchema","keyType","valueSchema","valueType","third","ZodMap","finalMap","ZodSet","finalizeSet","elements","parsedSet","ZodFunction","implement","makeArgsIssue","makeReturnsIssue","returns","fn","parsedArgs","Reflect","parsedReturns","parameters","returnType","strictImplement","expectedValues","enumValues","Values","Enum","extract","newDef","exclude","nativeEnumValues","promisified","sourceType","checkCtx","arg","processed","executeRefinement","inner","createWithPreprocess","preprocess","removeDefault","newCtx","removeCatch","ZodNaN","BRAND","inResult","handleAsync","_fatal","late","stringType","numberType","nanType","bigIntType","booleanType","dateType","symbolType","undefinedType","nullType","anyType","unknownType","neverType","voidType","arrayType","objectType","strictObjectType","unionType","discriminatedUnionType","intersectionType","tupleType","recordType","mapType","setType","functionType","lazyType","literalType","enumType","nativeEnumType","promiseType","effectsType","optionalType","nullableType","preprocessType","pipelineType","NEVER","defaultErrorMap","setErrorMap","EMPTY_PATH","ZodTransformer","Schema","ZodSchema","discriminatedUnion","cls","lazy","literal","nativeEnum","oboolean","onumber","ostring","pipeline","record","strictObject","transformer","tuple","union","quotelessJson","TiledIntProperty","TiledBoolProperty","TiledFloatProperty","TiledStringProperty","TiledFileProperty","TiledColorProperty","TiledObjectProperty","TiledProperty","TiledTileLayerBase","class","properties","tintcolor","parallaxx","parallaxy","offsetx","offsety","TiledTileLayerCSV","encoding","TiledTileLayerGZIP","compression","TiledTileLayerZLib","TiledTileLayerZStandard","TiledTileLayerBase64","TiledTileLayerChunkBase64","TiledTileLayerChunkCSV","TiledTileLayerChunk","TiledTileLayerInfinite","startx","starty","TiledTileLayer","needsDecoding","isCSV","TiledPoint","TiledPolygon","TiledText","fontfamily","pixelsize","halign","valign","TiledObject","gid","ellipse","polyline","template","tileid","TiledObjectLayer","draworder","TiledImageLayer","repeatx","repeaty","transparentcolor","TiledLayer","TiledObjectGroup","TiledTile","objectgroup","probability","imageheight","imagewidth","TiledTilesetEmbedded","firstgid","objectalignment","tileheight","tilewidth","tilecount","tileoffset","isTiledTilesetSingleImage","isTiledTilesetCollectionOfImages","TiledTilesetFile","tiledversion","TiledTilesetExternal","TiledTileset","TiledTemplate","tileset","TiledMap","compressionlevel","infinite","nextlayerid","nextobjectid","parallaxoriginx","parallaxoriginy","hexsidelength","staggeraxis","staggerindex","renderorder","backgroundcolor","layers","tilesets","isInfiniteLayer","tileLayer","isTiledTilesetEmbedded","ts","isTiledTilesetExternal","otherRight","otherBottom","endRight","TiledParser","_largestBounds","_coerceNumber","_coerceBoolean","_coerceType","_parsePropertiesNode","propertiesNode","_parseAttributes","numberProps","booleanProps","_parseToDocument","xml","DOMParser","parseFromString","JSDOM","contentType","parseObject","objectNode","parseTileset","tilesetNode","tilesetChild","tagName","tileChild","objectChild","frameChild","parseTileLayer","layerNode","layerChild","chunkTag","chunkBounds","parseObjectGroup","groupNode","groupChild","parseImageLayer","imageNode","imageLayer","parseExternalTemplate","txXml","templateElement","objectElement","tileSetElement","parseExternalTileset","tsxXml","tilesetElement","tmxXml","mapElement","tiledMap","parseHelper","mapChild","IMPORT_OBJECT","env","emscripten_notify_memory_growth","memory","ZSTDDecoder","fetch","wasm","WebAssembly","instantiate","Buffer","uncompressedSize","compressedSize","compressedPtr","malloc","ZSTD_findDecompressedSize","uncompressedPtr","actualSize","ZSTD_decompress","dec","free","Decoder","tmp","placeHolders","PLUS","SLASH","NUMBER","LOWER","UPPER","PLUS_URL_SAFE","SLASH_URL_SAFE","elt","charAt","L","toNumber","byteArray","resultLen","decoder","ExcaliburTiledProperties","TileData","Tiled","ZIndex","Zoom","Strategy","Layer","Solid","Collision","Type","FetchLoader","byNameCaseInsensitive","localeCompare","byClassCaseInsensitive","byPropertyCaseInsensitive","propertyName","lowercase","normalizedValue","copyPropsLowerCase","FLIPPED_HORIZONTALLY_FLAG","FLIPPED_VERTICALLY_FLAG","FLIPPED_DIAGONALLY_FLAG","isFlippedHorizontally","isFlippedVertically","isFlippedDiagonally","getCanonicalGid","LoaderCache","_loaded","getOrAdd","allSettled","errored","reason","mapProps","sourceProps","filenameFromPath","inputPath","mapPath","pathMap","pathInMap","pathRelativeToBase","basePath","relativeToBase","originSplit","relativeSplit","PluginObject","props","tiledObject","TemplateObject","tiledTemplate","getTileByGid","InsertedTile","Point","textQuality","_textAlignFromTiled","_textBaselineFromTiled","textWrap","Center","Ellipse","Polyline","newObject","getTilesetForTileGid","templates","templatePath","parseObjects","tiledObjectGroup","Template","tiledTile","Tileset","firstGid","tileCount","tileOffset","tiledTileset","tileToImage","horizontalFlipTransform","verticalFlipTransform","diagonalFlipTransform","spritesheet","getTilesetAlignmentAnchor","overrideAlignment","tileIndex","getTilesByClassName","getTilesByProperty","getSpriteForGid","normalizedGid","_isometricTiledCoordToWorld","isoCoord","halftileHeight","tileY","tileX","getCollidersForGid","orientationOverride","_applyFlipsToPoints","offsetPoint","getAnimationForGid","exFrames","TilesetResource","headless","fileLoader","parser","imageLoader","tilesetType","tilesetData","imagePath","TemplateResource","templateType","tilesetPath","tilesetResource","TiledDataComponent","TiledLayerDataComponent","tiledTileLayer","IsoTileLayer","_gidToTileInfo","getTilesByGid","isometricMap","maybeTiled","exTile","_recordTileData","maybeTile","updateTile","hasTint","isSolidLayer","useExcaliburWiring","tileObj","zoverride","isometricTiledCoordToWorld","infiniteStartPos","chunkData","TileLayer","getTileByCoordinate","ObjectLayer","tiledObjectLayer","_objectToEntity","_entityToObject","_logLoadedWarning","getObjectsByName","getEntitiesByName","getEntityByObject","getObjectByEntity","getObjectsByProperty","getEntitiesByProperty","getObjectsByClassName","getEntitiesByClassName","getTemplates","runFactory","factories","_recordObjectEntityMapping","_actorFromObject","newActor","animationScaled","dimension","boxCollider","zindex","semver","validateAndParse","isWildcard","tryParse","compareStrings","forceType","compareSegments","compare","v1","v2","operator","assertValidOperator","n1","n2","compareVersions","operatorResMap","allowedOperators","ImageLayer","tiledImageLayer","imageActor","TiledResource","mapFormat","startZIndex","useMapBackgroundColor","useTilemapCameraStrategy","_imageLoader","_tilesetLoader","_templateLoader","mapFormatOverride","entityClassNameFactories","registerEntityFactory","objectLayer","getObjectLayers","unregisterEntityFactory","getTilesetByName","getTilesetByClassName","getTilesetByProperty","getTileMetadataByClassName","getTileMetadataByProperty","getTileLayers","getIsoTileLayers","layerName","getTilesByPoint","objectlayer","getImageLayers","getLayersByName","getLayersByClassName","getLayersByProperty","_parseMap","supportedTiledVersion","_collectTilesets","_collectTemplates","friendlyLayers","isolayer","tilelayer","imagelayer","friendlyTileset","sourcePath","templateObjects","uniqueTemplatePaths","mappedPath","addToScene","defaultOptions","cameraObject","zoomProp","firstLayer","mapBounds"],"version":3,"file":"index.b7a05eb9.js.map","sourceRoot":"/__parcel_source_root/"}